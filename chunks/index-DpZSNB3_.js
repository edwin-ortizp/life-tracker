import{j as e}from"./ui-vendor-DGxrBG5B.js";import{r as h}from"./react-vendor-B6CgFIIW.js";import{C as J,c as W,a as se,b as ae}from"./PageLayout-Bn46ZyXr.js";import{B as y,u as te,a as z}from"../assets/index-DU2Ks861.js";import{T as re,C as G,a as ie,c as ne,d as le}from"./TaskAiReprioritize-CKqihv0F.js";import{S as q,a as H,b as V,c as _,d as L}from"./select-BbsFjDoU.js";import{I as oe}from"./input-D2so7NiP.js";import{a5 as ce,X as $,a6 as de,Z as me,V as ue,h as he,t as Z}from"./chart-vendor-DS0HZnUf.js";import{j as Q,m as pe,n as U,s as xe,e as fe,r as F,t as P,i as K}from"./utils-vendor-zid8MmOQ.js";import{T as je}from"./textarea-BoOEmm0d.js";import{D as ge,e as ye,a as ve,b as De,c as we,f as Ne}from"./dialog--KSabO_H.js";import{D as Te,a as Se,b as Ce,d as X}from"./tokens-Cc9wJW-j.js";import{u as be,R as Oe,T as Ie}from"./useTaskData-Dlo2JOMJ.js";import"./progress-BmMLMWFs.js";const k=({title:v,tasks:p,onToggle:m,onDelete:u,onEdit:x,onView:r})=>{if(p.length===0)return null;const D={do:0,decide:1,delegate:2,delete:3},o=p.sort((n,j)=>{var w,N;const I=D[n.priority||"none"]??4,f=D[j.priority||"none"]??4;return I!==f?I-f:n.dueDate&&j.dueDate?n.dueDate.getTime()-j.dueDate.getTime():!n.dueDate&&!j.dueDate?(((w=j.createdAt)==null?void 0:w.seconds)||0)-(((N=n.createdAt)==null?void 0:N.seconds)||0):n.dueDate?-1:1});return e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-medium text-sm text-gray-500 uppercase tracking-wider pt-4",children:v}),o.map(n=>e.jsx(re,{task:n,onToggle:m,onDelete:u,onEdit:x,onView:r,variant:"list"},n.id))]})},Y={all:"Todas las fechas",today:"Hoy",week:"Esta semana",month:"Este mes",overdue:"Vencidas",noDate:"Sin fecha"},Ee=({tasks:v,onToggle:p,onDelete:m,onEdit:u,onView:x})=>{const[r,D]=h.useState("all"),[o,n]=h.useState("all"),[j,I]=h.useState(!1),[f,w]=h.useState(""),N=h.useMemo(()=>{let s=r==="all"?v:v.filter(a=>a.category===r);if(f.trim()){const a=f.toLowerCase().trim();s=s.filter(A=>A.title.toLowerCase().includes(a)||A.description&&A.description.toLowerCase().includes(a))}const l=new Date,S=Q(l),b=pe(l),g=U(l),c=xe(l),R=fe(l);switch(o){case"today":return s.filter(a=>a.dueDate&&P(a.dueDate,{start:S,end:K(l)}));case"week":return s.filter(a=>a.dueDate&&P(a.dueDate,{start:b,end:g}));case"month":return s.filter(a=>a.dueDate&&P(a.dueDate,{start:c,end:R}));case"overdue":return s.filter(a=>a.dueDate&&F(a.dueDate,S));case"noDate":return s.filter(a=>!a.dueDate);default:return s}},[v,r,o,f]),T=h.useMemo(()=>f.trim()!==""||r!=="all"||o!=="all",[f,r,o]),E=()=>{w(""),D("all"),n("all")},C=h.useMemo(()=>{const s=new Date,l=Q(s),S=K(s),b=U(s);return N.reduce((g,c)=>(c.dueDate&&F(c.dueDate,l)?g.overdue.push(c):c.dueDate?F(c.dueDate,S)?g.today.push(c):F(c.dueDate,b)?g.thisWeek.push(c):g.future.push(c):g.noDate.push(c),g),{overdue:[],today:[],thisWeek:[],future:[],noDate:[]})},[N]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-4 items-stretch sm:items-center",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(ce,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(oe,{placeholder:"Buscar tareas por nombre...",value:f,onChange:s=>w(s.target.value),className:"pl-10 pr-10"}),f&&e.jsx(y,{variant:"ghost",size:"sm",onClick:()=>w(""),className:"absolute right-1 top-1/2 transform -translate-y-1/2 h-6 w-6 p-0 hover:bg-gray-100",children:e.jsx($,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"md:hidden flex gap-2",children:[e.jsxs(y,{variant:T?"default":"outline",onClick:()=>I(!j),className:`flex items-center gap-2 ${T?"bg-blue-600 hover:bg-blue-700":""}`,children:[e.jsx(de,{className:"w-4 h-4"}),"Filtros",T&&e.jsx("span",{className:"bg-white text-blue-600 rounded-full px-2 py-0.5 text-xs font-medium",children:"Activos"})]}),T&&e.jsx(y,{variant:"ghost",onClick:E,className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx($,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"hidden md:flex",children:T&&e.jsxs(y,{variant:"ghost",onClick:E,className:"text-red-600 hover:text-red-700 hover:bg-red-50 flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4"}),"Limpiar filtros"]})})]}),"      ",e.jsxs("div",{className:`space-y-4 md:space-y-0 md:flex md:items-center md:gap-4 ${j?"block":"hidden md:flex"}`,children:[e.jsxs("div",{className:"flex-1 space-y-2 md:space-y-0",children:[e.jsx("span",{className:"text-sm text-gray-500 font-medium block md:inline md:mr-2",children:"Categoría:"}),e.jsxs(q,{value:r,onValueChange:s=>D(s),children:[e.jsx(H,{className:`w-full md:w-[180px] ${r!=="all"?"border-blue-500 bg-blue-50":""}`,children:e.jsx(V,{children:r==="all"?"Todas las categorías":G[r]})}),e.jsxs(_,{children:[e.jsx(L,{value:"all",children:"Todas las categorías"}),Object.entries(ie).map(([s,l])=>e.jsx(L,{value:l,children:G[l]},s))]})]})]}),e.jsxs("div",{className:"flex-1 space-y-2 md:space-y-0",children:[e.jsx("span",{className:"text-sm text-gray-500 font-medium block md:inline md:mr-2",children:"Fecha:"}),e.jsxs(q,{value:o,onValueChange:s=>n(s),children:[e.jsx(H,{className:`w-full md:w-[180px] ${o!=="all"?"border-blue-500 bg-blue-50":""}`,children:e.jsx(V,{children:Y[o]})}),e.jsx(_,{children:Object.entries(Y).map(([s,l])=>e.jsx(L,{value:s,children:l},s))})]})]})]}),e.jsxs("div",{children:[e.jsx(k,{title:"Tareas Vencidas",tasks:C.overdue,onToggle:p,onDelete:m,onEdit:u,onView:x}),e.jsx(k,{title:"Para Hoy",tasks:C.today,onToggle:p,onDelete:m,onEdit:u,onView:x}),e.jsx(k,{title:"Esta Semana",tasks:C.thisWeek,onToggle:p,onDelete:m,onEdit:u,onView:x}),e.jsx(k,{title:"Próximamente",tasks:C.future,onToggle:p,onDelete:m,onEdit:u,onView:x}),e.jsx(k,{title:"Sin Fecha",tasks:C.noDate,onToggle:p,onDelete:m,onEdit:u,onView:x}),N.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:r==="all"&&o==="all"?"No hay tareas pendientes":"No hay tareas pendientes con los filtros seleccionados"})]})]})},Re=({tasks:v,onUpdate:p})=>{const[m,u]=h.useState(!1),[x,r]=h.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs(Te,{children:[e.jsx(Se,{asChild:!0,children:e.jsxs(y,{size:"sm",variant:"outline",className:"flex items-center gap-2 text-blue-600",children:[e.jsx(me,{className:"w-4 h-4"}),"IA"]})}),e.jsxs(Ce,{align:"end",children:[e.jsx(X,{onSelect:()=>u(!0),children:"Sugerir tareas"}),e.jsx(X,{onSelect:()=>r(!0),children:"Repriorizar visibles"})]})]}),e.jsx(ne,{tasks:v,open:m,onOpenChange:u}),e.jsx(le,{tasks:v,onUpdate:p,open:x,onOpenChange:r})]})},Ve=({showFloatingButton:v=!1})=>{const{user:p}=te(),{tasks:m,status:u,error:x,showRecurrenceModal:r,currentTask:D,modalMode:o,addTask:n,editTask:j,toggleTask:I,deleteTask:f,completeRecurrentTask:w,setShowRecurrenceModal:N,openEditModal:T,openCreateModal:E}=be(),[C,s]=h.useState(null),[l,S]=h.useState(!1),[b,g]=h.useState(""),[c,R]=h.useState(!1),a=m.filter(t=>!t.isPrivate),A=()=>{try{const t=JSON.parse(b);if(!Array.isArray(t)){z.error("El JSON debe contener un array de tareas");return}let O=0,i=0;t.forEach(d=>{if(d.title){let M;if(d.dueDate){const B=new Date(d.dueDate);isNaN(B.getTime())?(i++,console.warn(`Fecha inválida para tarea "${d.title}": ${d.dueDate}`)):M=B}n({title:d.title,description:d.description||"",dueDate:M,category:d.category||"personal",priority:d.priority||void 0,isPrivate:!1,isRecurrent:d.isRecurrent||!1,size:d.size||void 0}),O++}}),i>0?z.warning(`${O} tareas importadas. ${i} fechas inválidas fueron omitidas.`):z.success(`${O} tareas importadas correctamente`),g(""),R(!1)}catch(t){z.error("Error al importar las tareas. Verifica el formato JSON."),console.error("Error de importación:",t)}},ee=()=>{const t=a.map(i=>{var d,M;return{title:i.title,description:i.description||"",dueDate:(d=i.dueDate)==null?void 0:d.toISOString(),category:i.category,priority:i.priority,size:i.size,completed:i.completed,isRecurrent:i.isRecurrent||!1,...i.recurrence&&{recurrence:{frequency:i.recurrence.frequency,pattern:i.recurrence.pattern,customDays:i.recurrence.customDays,nextDate:(M=i.recurrence.nextDate)==null?void 0:M.toISOString()}}}}),O=JSON.stringify(t,null,2);navigator.clipboard.writeText(O).then(()=>{z.success("Tareas copiadas al portapapeles con fechas incluidas")})};return p?e.jsxs("div",{className:"space-y-8 relative",children:[e.jsxs(J,{children:[e.jsx(se,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(ae,{children:"Tareas Pendientes"}),e.jsxs("div",{className:"hidden md:flex items-center gap-4",children:[u==="saving"&&e.jsx("span",{className:"text-xs text-blue-500",children:"Guardando..."}),e.jsxs(ge,{open:c,onOpenChange:R,children:[e.jsx(ye,{asChild:!0,children:e.jsxs(y,{size:"sm",variant:"outline",children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"Importar"]})}),e.jsxs(ve,{className:"max-w-4xl",children:[e.jsxs(De,{children:[e.jsx(we,{children:"Importar Tareas"}),e.jsx(Ne,{children:"Pega el JSON con las tareas a importar. Puedes incluir fechas en varios formatos."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(je,{placeholder:`Ejemplo - Importa tareas con fechas en diferentes formatos:
[
  {
    "title": "Completar proyecto importante",
    "description": "Terminar la implementación",
    "dueDate": "2024-12-31",
    "category": "work",
    "priority": "do",
    "size": "grande"
  },
  {
    "title": "Revisión médica anual", 
    "description": "Chequeo general de salud",
    "dueDate": "2024-07-15T09:00:00Z",
    "category": "health",
    "priority": "decide"
  },
  {
    "title": "Tarea flexible",
    "description": "Esta tarea no tiene fecha límite específica",
    "category": "personal",
    "isRecurrent": true
  }
]

Formatos de fecha soportados:
- "2024-12-31" (solo fecha)
- "2024-06-15T14:30:00Z" (fecha y hora ISO)
- "2024-06-15T14:30:00" (fecha y hora local)
- Sin campo "dueDate" = sin fecha asignada

Campos opcionales:
- description, dueDate, priority, size, isRecurrent`,value:b,onChange:t=>g(t.target.value),rows:20,className:"font-mono text-sm"}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(y,{variant:"outline",onClick:()=>R(!1),children:"Cancelar"}),e.jsx(y,{onClick:A,disabled:!b.trim(),children:"Importar Tareas"})]})]})]})]}),e.jsxs(y,{size:"sm",variant:"outline",onClick:ee,children:[e.jsx(he,{className:"w-4 h-4 mr-2"}),"Exportar"]}),e.jsx(Re,{tasks:m,onUpdate:(t,O)=>j(t,O)}),e.jsxs(y,{onClick:()=>E(),size:"sm",children:[e.jsx(Z,{className:"w-4 h-4 mr-2"}),"Nueva Tarea"]})]}),e.jsx("div",{className:"md:hidden",children:u==="saving"&&e.jsx("span",{className:"text-xs text-blue-500",children:"Guardando..."})})]})}),e.jsx(W,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ee,{tasks:m,onToggle:I,onDelete:f,onEdit:T,onView:t=>{s(t),S(!0)}}),x&&e.jsx("p",{className:"text-sm text-red-500",children:x})]})})]}),v&&e.jsx("div",{className:"md:hidden fixed bottom-20 right-4 z-50",children:e.jsx(y,{onClick:()=>E(),size:"lg",className:"w-14 h-14 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 bg-blue-600 hover:bg-blue-700 active:scale-95 border-0 flex items-center justify-center text-white",children:e.jsx(Z,{className:"w-6 h-6 text-white"})})}),e.jsx(Oe,{isOpen:r,onClose:()=>N(),onConfirm:t=>{o==="complete"?w(t):o==="edit"?j(D.id,t):n(t)},task:D||{id:"",title:"",completed:!1,category:"personal",createdAt:{seconds:Date.now()/1e3}},mode:o}),e.jsx(Ie,{task:C,isOpen:l,onClose:()=>S(!1),onEdit:t=>{S(!1),T(t)}})]}):e.jsx(J,{children:e.jsx(W,{className:"p-8 text-center",children:e.jsx("p",{children:"Inicia sesión para gestionar tus tareas"})})})};export{Ve as T,Re as a};
