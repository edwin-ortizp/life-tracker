import{j as e}from"./ui-vendor-DGxrBG5B.js";import{r as m,c as he}from"./react-vendor-B6CgFIIW.js";import{P as _,C as B,c as F}from"./PageLayout-CQ502YZp.js";import{d as U,u as Z,B as v,T as J,b as K,e as X,f as Q,c as ge}from"../assets/index-CZllZBvh.js";import{e as pe,k as ee,j as se,l as fe,m as je,q as ye,w as Y,h as be}from"./firebase-B1tATv4n.js";import{g as te,a as ve}from"./dates-LQzD1DbF.js";import{a9 as Ne,ab as we,X as Se,i as Ce,a5 as ae,g as ne,C as ie,Z as re,j as De}from"./chart-vendor-DS0HZnUf.js";import{A as oe,a as ce}from"./alert-BdSdTxzO.js";import{I as le}from"./input-DyWC7sCN.js";import{Y as He}from"./YearlyActivityGrid-Dw4RT37g.js";import{S as Ee,a as Me,b as Te,c as Ie,d as P}from"./select-CQQJsJq0.js";import{D as de,a as me,b as ue,c as xe,f as Oe}from"./dialog-Ch6bvtCJ.js";import{S as ke}from"./scroll-area-pMBpP9gA.js";import{T as Ae,a as $e,b as ze,c as Le}from"./tabs-C-7Scvnq.js";import{c as Ve,p as qe,D as Re,a as _e,b as Be,d as Fe}from"./tokens-DP8wmanu.js";import{g as Ye}from"./ai-BhB6E9je.js";import{T as Pe}from"./textarea-DJSkO8fg.js";import{D as Ge}from"./DateSelector-CGjErOQW.js";import"./utils-vendor-zid8MmOQ.js";import"./index-4hsSYOGr.js";const V=(t,i)=>pe(U,"negative-habits",`${t}_${i}`),We=async(t,i,o,r,n,a)=>{const c={habitId:r,timestamp:new Date().getTime(),...a?{note:a}:{}},p={...n[o]||{},[r]:c},h={userId:t,yearMonth:i,habits:{...n,[o]:p},updatedAt:ee()},y=V(t,i);await se(y,h,{merge:!0})},Ue=async(t,i,o,r,n)=>{const a={...n[o]||{}};delete a[r];const c={userId:t,yearMonth:i,habits:{...n,[o]:a},updatedAt:ee()},x=V(t,i);await se(x,c,{merge:!0})},Ze=async(t,i)=>{const o={},r=fe(U,"negative-habits");for(const n of i)try{(await je(ye(r,Y("userId","==",t),Y("yearMonth","==",n)))).forEach(c=>{const x=c.data();o[n]=x.habits||{}})}catch(a){console.error(`Error fetching month ${n}:`,a)}return o},q=t=>{const i={totalCount:0,byHabitId:{},byDate:{}};return Object.entries(t).forEach(([o])=>{const[r,n]=o.split("_"),a=parseInt(r);i.totalCount++,i.byHabitId[a]=(i.byHabitId[a]||0)+1,i.byDate[n]=(i.byDate[n]||0)+1}),i},Je=(t,i=5)=>{const o=q(t);return Object.entries(o.byHabitId).sort(([,r],[,n])=>n-r).slice(0,i).map(([r,n])=>({habitId:parseInt(r),count:n}))},Ke=(t,i=3)=>{const o=q(t);return Object.entries(o.byDate).sort(([,r],[,n])=>n-r).slice(0,i).map(([r,n])=>({date:r,count:n}))},Xe=t=>{const i=[],o=new Date(t),r=o.getDay(),n=r===0?-6:1-r;o.setDate(o.getDate()+n);for(let a=0;a<7;a++){const c=new Date(o);c.setDate(o.getDate()+a),i.push({dayName:c.toLocaleDateString("es-ES",{weekday:"short"}),fullDate:te(c)})}return i},Qe=t=>{const i=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0");return`${i}-${o}`},es=t=>{const i=t.getFullYear(),o=t.getMonth()+1,r=[];for(let n=1;n<=o;n++){const a=String(n).padStart(2,"0");r.push(`${i}-${a}`)}return r},ss=()=>{const[t,i]=m.useState({}),[o,r]=m.useState("idle"),[n,a]=m.useState(null),{user:c}=Z(),x=m.useMemo(()=>{const f={};return Object.values(t).forEach(u=>{Object.entries(u).forEach(([j,d])=>{Object.entries(d).forEach(([s,l])=>{f[`${s}_${j}`]=l})})}),f},[t]),p=m.useMemo(()=>({...q(x),topHabits:Je(x),frequentDays:Ke(x)}),[x,t]);return m.useEffect(()=>{if(!c)return;const f=new Date,u=Qe(f);r("loading");const j=be(V(c.uid,u),s=>{if(s.exists()){const l=s.data();i(g=>({...g,[u]:l.habits||{}}))}r("idle")},s=>{a(s instanceof Error?s.message:"Error al cargar los datos"),r("error")});return(async()=>{const s=es(f),l=await Ze(c.uid,s);i(g=>({...g,...l}))})(),()=>j()},[c]),{habits:x,status:o,error:n,stats:p,logHabit:async(f,u,j)=>{if(c)try{r("saving"),a(null);const[d,s]=u.split("-"),l=`${d}-${s}`,g=t[l]||{};await We(c.uid,l,u,f,g,j),r("idle")}catch(d){a(d instanceof Error?d.message:"Error al guardar"),r("error")}},removeLog:async(f,u)=>{if(c)try{r("saving"),a(null);const[j,d]=u.split("-"),s=`${j}-${d}`,l=t[s]||{};await Ue(c.uid,s,u,f,l),r("idle")}catch(j){a(j instanceof Error?j.message:"Error al eliminar"),r("error")}}}},ts=({view:t,onViewChange:i})=>e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(v,{variant:t==="weekly"?"default":"outline",size:"sm",onClick:()=>i("weekly"),className:"gap-2",children:[e.jsx(Ne,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Semanal"})]}),e.jsxs(v,{variant:t==="yearly"?"default":"outline",size:"sm",onClick:()=>i("yearly"),className:"gap-2",children:[e.jsx(we,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Anual"})]})]}),G=({habits:t,completedHabits:i,weekDays:o,onLogHabit:r,onRemoveLog:n,disabled:a})=>e.jsx(J,{children:e.jsxs("div",{className:"grid grid-cols-[minmax(100px,1fr)_repeat(7,minmax(32px,1fr))] gap-1",children:[e.jsx("div",{}),o.map(c=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium",children:c.dayName}),e.jsx("div",{className:"text-[10px] text-gray-400",children:c.fullDate.split("-").slice(1).join("/")})]},c.fullDate)),t.map(c=>e.jsxs(he.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:c.icon}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm",children:c.name}),e.jsx("span",{className:"text-xs text-gray-500",children:c.category})]})]}),o.map(x=>{const p=`${c.id}_${x.fullDate}`,h=i[p];return e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs(K,{children:[e.jsx(X,{asChild:!0,children:e.jsx(v,{variant:h?"destructive":"outline",size:"icon",className:"w-8 h-8 p-0",onClick:()=>h?n(c.id,x.fullDate):r(c.id,x.fullDate),disabled:a,children:h?e.jsx(Se,{className:"w-4 h-4 text-white"}):e.jsx(Ce,{className:"w-4 h-4 text-muted-foreground"})})}),e.jsx(Q,{children:h?"Eliminar registro":"Registrar h√°bito"})]})},p)})]},c.id))]})}),T={health:{icon:"üè•",label:"Salud",description:"H√°bitos que afectan tu salud f√≠sica"},productivity:{icon:"‚è∞",label:"Productividad",description:"H√°bitos que reducen tu eficiencia"},social:{icon:"üë•",label:"Social",description:"H√°bitos que afectan tus relaciones"},emotional:{icon:"üòî",label:"Emocional",description:"H√°bitos que afectan tu bienestar emocional"},finance:{icon:"üí∞",label:"Finanzas",description:"H√°bitos que impactan tus finanzas"},digital:{icon:"üì±",label:"Digital",description:"H√°bitos digitales nocivos"},environment:{icon:"üåç",label:"Ambiente",description:"H√°bitos que impactan al medio ambiente"}},D=[{id:1,name:"Saltarse comidas",icon:"üçΩÔ∏è",category:"health"},{id:2,name:"Dormir poco",icon:"üò¥",category:"health"},{id:3,name:"No hacer ejercicio",icon:"üèÉ",category:"health"},{id:4,name:"Comer en exceso",icon:"ü´Éüèª",category:"health"},{id:25,name:"Comida chatarra",icon:"üçî",category:"health"},{id:26,name:"Exceso de az√∫car",icon:"üç≠",category:"health"},{id:27,name:"Masturbaci√≥n",icon:"üçÜ",category:"health"},{id:5,name:"Procrastinar",icon:"‚è∞",category:"productivity"},{id:6,name:"Distracciones",icon:"üéØ",category:"productivity"},{id:7,name:"Multitarea",icon:"üîÑ",category:"productivity"},{id:8,name:"Desorganizaci√≥n",icon:"üìã",category:"productivity"},{id:24,name:"Exceso de trabajo (Workaholic)",icon:"üçΩÔ∏è",category:"productivity"},{id:9,name:"Aislamiento",icon:"üö∂",category:"social"},{id:10,name:"Conflictos",icon:"üí¢",category:"social"},{id:11,name:"No escuchar",icon:"üëÇ",category:"social"},{id:29,name:"Dejar en visto",icon:"üëÄ",category:"social"},{id:15,name:"Sobrepensar cosas",icon:"üò∞",category:"emotional"},{id:16,name:"Negatividad / Pesimismo",icon:"üåßÔ∏è",category:"emotional"},{id:17,name:"Ser grosero/estresarme",icon:"ü§¨",category:"emotional"},{id:28,name:"Celos compulsivos",icon:"üíÅüèª‚Äç‚ôÇÔ∏è",category:"emotional"},{id:12,name:"Gastos impulsivos",icon:"üí≥",category:"finance"},{id:13,name:"No ahorrar",icon:"üí∞",category:"finance"},{id:14,name:"M√°s Deudas",icon:"üìâ",category:"finance"},{id:18,name:"Exceso de Redes sociales",icon:"üì±",category:"digital"},{id:19,name:"Exceso de Videojuegos",icon:"üéÆ",category:"digital"},{id:20,name:"Exceso de Netflix",icon:"üé¨",category:"digital"},{id:21,name:"Desperdiciar agua",icon:"üíß",category:"environment"},{id:22,name:"No reciclar",icon:"‚ôªÔ∏è",category:"environment"},{id:23,name:"Consumo excesivo",icon:"üõçÔ∏è",category:"environment"}],as=({habits:t,onLogHabit:i,onRemoveLog:o,disabled:r})=>{const n=Xe(new Date),[a,c]=m.useState(""),[x,p]=m.useState(["health"]),[h,y]=m.useState(!1),f=m.useMemo(()=>{const s={};return D.forEach(l=>{s[l.category]||(s[l.category]=[]),!(a&&!l.name.toLowerCase().includes(a.toLowerCase()))&&s[l.category].push(l)}),s},[a]),u=m.useMemo(()=>{const s=D.length,l=Object.values(f).reduce((I,O)=>I+O.length,0),g={},w=new Date().toISOString().split("T")[0];return Object.entries(t).forEach(([I])=>{const[O,L]=I.split("_");if(L===w){const H=D.find(A=>A.id===Number(O));H&&(g[H.category]=(g[H.category]||0)+1)}}),{totalHabits:s,filteredHabits:l,loggedByCategory:g,isFiltered:a.length>0}},[f,t,a]),j=m.useMemo(()=>{const s=new Map;return Object.entries(t).forEach(([l])=>{const[g]=l.split("_"),w=s.get(Number(g))||0;s.set(Number(g),w+1)}),D.filter(l=>s.has(l.id)).sort((l,g)=>(s.get(g.id)||0)-(s.get(l.id)||0)).slice(0,5)},[t]),d=s=>{p(l=>l.includes(s)?l.filter(g=>g!==s):[...l,s])};return e.jsxs("div",{className:"space-y-4",children:["      ",e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsxs("div",{className:"relative w-full sm:w-64",children:[e.jsx(ae,{className:"absolute left-2 top-2.5 h-4 w-4 text-gray-500"}),e.jsx(le,{placeholder:"Buscar h√°bito...",value:a,onChange:s=>c(s.target.value),className:"pl-8 pr-16"}),u.isFiltered&&e.jsxs("div",{className:"absolute right-2 top-2 bg-blue-100 text-blue-800 px-2 py-0.5 rounded-md text-xs font-medium",children:[u.filteredHabits,"/",u.totalHabits]})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsx(v,{variant:"outline",onClick:()=>y(!h),className:"flex-1 sm:flex-none",children:h?"Mostrar m√°s frecuentes":"Mostrar todos"}),Object.keys(u.loggedByCategory).length>0&&e.jsxs("div",{className:"bg-green-100 text-green-800 px-3 py-1.5 rounded-md text-sm font-medium",children:[Object.values(u.loggedByCategory).reduce((s,l)=>s+l,0)," hoy"]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"sm:min-w-[640px]",children:h?e.jsx("div",{className:"space-y-6",children:Object.entries(f).map(([s,l])=>{if(l.length===0)return null;const g=x.includes(s),w=T[s];return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(v,{variant:"ghost",onClick:()=>d(s),className:"w-full flex items-center justify-between p-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:w.icon}),e.jsx("span",{className:"font-medium",children:w.label}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",l.length,")"]}),u.loggedByCategory[s]&&e.jsxs("span",{className:"bg-red-100 text-red-800 px-2 py-0.5 rounded-full text-xs font-medium ml-1",children:[u.loggedByCategory[s]," hoy"]})]}),g?e.jsx(ne,{size:20}):e.jsx(ie,{size:20})]}),g&&e.jsx(G,{habits:l,completedHabits:t,weekDays:n,onLogHabit:i,onRemoveLog:o,disabled:r})]},s)})}):e.jsx(G,{habits:j,completedHabits:t,weekDays:n,onLogHabit:i,onRemoveLog:o,disabled:r})})}),"      ",e.jsxs(oe,{variant:"destructive",children:[" ",e.jsx(ce,{children:h?`Visualizaci√≥n completa de h√°bitos agrupados por categor√≠a${u.isFiltered?` (${u.filteredHabits} de ${u.totalHabits} h√°bitos mostrados)`:""}. Usa el buscador para encontrar h√°bitos espec√≠ficos.`:`Mostrando solo tus ${j.length} h√°bitos m√°s frecuentes. Haz clic en "Mostrar todos" para ver la lista completa.`})]})]})},W=({habits:t,completedHabits:i,onLogHabit:o,onRemoveLog:r})=>{const n=new Date().getFullYear();return e.jsx(J,{children:e.jsx("div",{className:"space-y-6",children:t.map(a=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 sticky top-0 bg-white z-10 py-2",children:[e.jsx("span",{className:"text-xl",children:a.icon}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:a.name}),e.jsx("p",{className:"text-sm text-gray-500",children:a.category})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx(He,{year:n,renderCell:c=>{const x=`${a.id}_${c}`,p=i[x],h=new Date().toISOString().split("T")[0]===c;return e.jsxs(K,{children:[e.jsx(X,{asChild:!0,children:e.jsx(v,{variant:p?"destructive":"ghost",onClick:()=>p?r(a.id,c):o(a.id,c),className:ge("w-1 h-1 p-0 rounded-full border transition-all duration-200 hover:scale-110",p?"bg-red-600 border-red-700 hover:bg-red-700":"bg-gray-100 border-gray-200 hover:bg-gray-200 hover:border-gray-300",h&&"ring-2 ring-blue-400 ring-offset-1"),"aria-label":p?"Eliminar registro":"Registrar h√°bito"})}),e.jsx(Q,{children:e.jsx("p",{className:"text-sm",children:new Date(c).toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})})]},c)}})})]},a.id))})})},ns=({habits:t,onLogHabit:i,onRemoveLog:o})=>{const[r,n]=m.useState(""),[a,c]=m.useState("all"),[x,p]=m.useState(["health"]),[h,y]=m.useState(!1),f=m.useMemo(()=>{const d=new Map;return Object.entries(t).forEach(([s])=>{const[l]=s.split("_"),g=d.get(Number(l))||0;d.set(Number(l),g+1)}),D.filter(s=>d.has(s.id)).sort((s,l)=>(d.get(l.id)||0)-(d.get(s.id)||0)).slice(0,5)},[t]),u=m.useMemo(()=>{const d={};return D.forEach(s=>{r&&!s.name.toLowerCase().includes(r.toLowerCase())||a!=="all"&&s.category!==a||(d[s.category]||(d[s.category]=[]),d[s.category].push(s))}),d},[r,a]),j=d=>{p(s=>s.includes(d)?s.filter(l=>l!==d):[...s,d])};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ae,{className:"absolute left-2 top-2.5 h-4 w-4 text-gray-500"}),e.jsx(le,{placeholder:"Buscar h√°bito...",value:r,onChange:d=>n(d.target.value),className:"pl-8"})]}),e.jsxs(Ee,{value:a,onValueChange:c,children:[e.jsx(Me,{className:"w-full sm:w-[180px]",children:e.jsx(Te,{placeholder:"Categor√≠a"})}),e.jsxs(Ie,{children:[e.jsx(P,{value:"all",children:"Todas las categor√≠as"}),Object.keys(T).map(d=>e.jsx(P,{value:d,children:T[d].label},d))]})]}),e.jsx(v,{variant:"outline",onClick:()=>y(!h),className:"whitespace-nowrap",children:h?"Ver frecuentes":"Ver todos"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"sm:min-w-[800px] pb-4",children:h?e.jsx("div",{className:"space-y-8",children:Object.entries(u).map(([d,s])=>{if(s.length===0)return null;const l=x.includes(d),g=T[d];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(v,{variant:"ghost",onClick:()=>j(d),className:"w-full flex items-center justify-between p-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:g.icon}),e.jsx("span",{className:"font-medium",children:g.label}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",s.length,")"]})]}),l?e.jsx(ne,{size:20}):e.jsx(ie,{size:20})]}),l&&e.jsx(W,{habits:s,completedHabits:t,onLogHabit:i,onRemoveLog:o})]},d)})}):e.jsx(W,{habits:f,completedHabits:t,onLogHabit:i,onRemoveLog:o})})}),e.jsxs(oe,{variant:"destructive",children:[" ",e.jsx(ce,{children:h?"Vista completa de h√°bitos por categor√≠a. Usa los filtros para encontrar h√°bitos espec√≠ficos.":'Mostrando tus h√°bitos m√°s frecuentes. Cambia a "Ver todos" para la lista completa.'})]})]})},is=({category:t,habits:i,onSelectHabit:o})=>{const r=T[t];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:r.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:r.label}),e.jsx("p",{className:"text-sm text-gray-500",children:r.description})]})]}),e.jsx(ke,{className:"h-[300px] pr-4",children:e.jsx("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-3",children:i.map(n=>e.jsxs(v,{variant:"outline",className:"h-auto py-3 px-2 flex flex-col items-center gap-2 group",onClick:()=>o(n.id),children:[e.jsx("span",{className:"text-2xl group-hover:scale-110 transition-transform",children:n.icon}),e.jsx("span",{className:"text-xs text-center line-clamp-2",children:n.name})]},n.id))})})]})},rs=({onSelectHabit:t})=>{const[i,o]=m.useState("health"),r=D.reduce((n,a)=>(n[a.category]||(n[a.category]=[]),n[a.category].push(a),n),{});return e.jsx("div",{className:"w-full",children:e.jsxs(Ae,{defaultValue:i,onValueChange:n=>o(n),className:"w-full",children:[e.jsx($e,{className:"grid grid-cols-4 gap-2 h-auto sm:grid-cols-7",children:Object.entries(T).map(([n,{icon:a,label:c}])=>e.jsxs(ze,{value:n,className:"text-sm flex flex-col gap-1 py-2 h-auto",children:[e.jsx("span",{className:"text-xl",children:a}),e.jsx("span",{className:"hidden sm:inline text-xs",children:c})]},n))}),Object.entries(r).map(([n,a])=>e.jsx(Le,{value:n,className:"mt-4",children:e.jsx(is,{category:n,habits:a,onSelectHabit:t})},n))]})})},os=({isOpen:t,onClose:i,onLogHabit:o,selectedDate:r})=>e.jsx(de,{open:t,onOpenChange:i,children:e.jsxs(me,{className:"sm:max-w-[600px] max-h-[90vh] flex flex-col",children:[e.jsxs(ue,{children:[e.jsx(xe,{children:"Registrar H√°bito Negativo"}),e.jsx("p",{className:"text-sm text-gray-500",children:ve(r)})]}),e.jsx("div",{className:"flex-1 overflow-hidden py-4",children:e.jsx(rs,{onSelectHabit:o})})]})}),N=Ye("negativeHabit"),cs=N?`https://generativelanguage.googleapis.com/v1beta/models/${N.model}:generateContent`:"",ls=({habits:t,open:i,onOpenChange:o})=>{var H,A;const[r,n]=m.useState(!1),a=i!==void 0?i:r,c=o??n,[x,p]=m.useState(""),[h,y]=m.useState(""),[f,u]=m.useState(!1),[j,d]=m.useState(0),s="AIzaSyAW4Ot-z7OH4ZR3OeaN7vcbkEDlWpo1aMY",l=((H=N==null?void 0:N.prompts)==null?void 0:H.impact)??"Explica el impacto de mis h√°bitos negativos de acuerdo con mis registros.",g=((A=N==null?void 0:N.prompts)==null?void 0:A.action)??"Recomienda acciones para reducirlos cada vez que los registro.",w=N==null?void 0:N.params;m.useEffect(()=>{if(a){const b=I();y(`${l}
${g}
${b}`)}else y(""),p("")},[a,t]),m.useEffect(()=>{d(Ve(h))},[h]);const I=()=>{const b={};let S=null,C=null;Object.keys(t).forEach(E=>{const[k,M]=E.split("_"),R=parseInt(k,10);b[R]=(b[R]||0)+1,(!S||M<S)&&(S=M),(!C||M>C)&&(C=M)});const $=S&&C?`Datos del ${S} al ${C}`:"Sin registros",z=D.map(E=>`- ${E.name}: ${b[E.id]||0}`).join(`
`);return`${$}
${z}`},O=async()=>{var b,S,C,$,z;u(!0);try{const k=await(await fetch(`${cs}?key=${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:h}]}],...w})})).json(),M=(z=($=(C=(S=(b=k==null?void 0:k.candidates)==null?void 0:b[0])==null?void 0:S.content)==null?void 0:C.parts)==null?void 0:$[0])==null?void 0:z.text;p(M||"No se pudo obtener sugerencia")}catch{p("Error al consultar la API")}finally{u(!1)}},L=()=>{c(!1),p(""),y(""),d(0)};return e.jsxs(de,{open:a,onOpenChange:b=>b?c(!0):L(),children:[i===void 0&&e.jsxs(v,{size:"sm",variant:"outline",onClick:()=>c(!0),className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4"}),"Analizar h√°bitos"]}),e.jsxs(me,{className:"w-full sm:max-w-5xl max-h-[90vh] overflow-auto",children:[e.jsxs(ue,{children:[e.jsx(xe,{children:"Sugerencias sobre h√°bitos negativos"}),e.jsx(Oe,{children:"Impacto y acciones recomendadas."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Pe,{value:h,onChange:b=>y(b.target.value),className:"max-h-[500px] overflow-y-auto"}),e.jsxs("p",{className:"text-xs text-right",children:["Tokens: ",j," ",j>3500&&e.jsx("span",{className:"text-red-500",children:"¬°Prompt demasiado largo!"})]}),e.jsxs(v,{onClick:O,disabled:f||!s,className:"w-full flex items-center justify-center gap-2",children:[f&&e.jsx(De,{className:"w-4 h-4 animate-spin"}),f?"Consultando...":"Obtener sugerencia"]}),x&&e.jsx("div",{className:"p-4 bg-muted rounded-md prose max-w-none",children:e.jsx("div",{dangerouslySetInnerHTML:{__html:qe.sanitize(x)}})})]})]})]})},ds=({habits:t})=>{const[i,o]=m.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs(Re,{children:[e.jsx(_e,{asChild:!0,children:e.jsxs(v,{size:"sm",variant:"outline",className:"flex items-center gap-2 text-blue-600",children:[e.jsx(re,{className:"w-4 h-4"}),"IA"]})}),e.jsx(Be,{align:"end",children:e.jsx(Fe,{onSelect:()=>o(!0),children:"Analizar h√°bitos"})})]}),e.jsx(ls,{habits:t,open:i,onOpenChange:o})]})},Is=()=>{const[t,i]=m.useState("weekly"),[o,r]=m.useState(new Date),[n,a]=m.useState(!1),{user:c}=Z(),{habits:x,status:p,error:h,logHabit:y,removeLog:f}=ss(),u=async(j,d)=>{await y(j,te(o),d),a(!1)};return c?e.jsxs(_,{children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"H√°bitos Negativos"}),e.jsx("p",{className:"text-gray-500",children:"Identifica y reduce comportamientos que quieres cambiar"})]}),e.jsx(Ge,{selectedDate:o,onChange:r}),e.jsx(B,{className:"w-full",children:e.jsxs(F,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"font-medium text-lg",children:"Registro de H√°bitos"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Identifica y registra los h√°bitos que deseas cambiar"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ds,{habits:x}),e.jsx(ts,{view:t,onViewChange:i})]})]}),t==="weekly"?e.jsx(as,{habits:x,onLogHabit:y,onRemoveLog:f,disabled:p==="saving"}):e.jsx(ns,{habits:x,onLogHabit:y,onRemoveLog:f}),h&&e.jsx("p",{className:"mt-4 text-sm text-red-500",children:h})]})}),e.jsx(os,{isOpen:n,onClose:()=>a(!1),onLogHabit:u,selectedDate:o})]}):e.jsx(_,{children:e.jsx(B,{className:"w-full",children:e.jsx(F,{className:"p-4 text-center",children:e.jsx("p",{children:"Inicia sesi√≥n para registrar tus h√°bitos negativos"})})})})};export{Is as default};
