import{j as e}from"./ui-vendor-DGxrBG5B.js";import{r as j}from"./react-vendor-B6CgFIIW.js";import{D as fe}from"./DateSelector-Dbzo5HuL.js";import{S as pe,a as ye,b as Ne,c as be,d as ve}from"./select-B0o55zn9.js";import{s as C,e as W,b as T,d as G,f as H,g as q,h as P}from"./utils-vendor-zid8MmOQ.js";import{C as g,a as w,b as D,c as f,P as X}from"./PageLayout-Db-iUE0_.js";import{D as Se,j as Y,R as F,k as we,l as J,m as K,Y as V,n as I,o as De,P as se,p as ae,q as re,I as ne,r as le,s as oe}from"./chart-vendor-DS0HZnUf.js";import{D as $,a as R}from"./index-Dwg2_Hpq.js";import{u as _,d as ce}from"../assets/index-DHFvqX11.js";import{e as ie,f as de}from"./firebase-B1tATv4n.js";import{g as z,e as O}from"./dates-LQzD1DbF.js";import{l as u,W as ke}from"./index-BxI6ny0m.js";import{C as Me}from"./calendar-9BbB0sQq.js";import{T as Ae,a as Ce,b as Q,c as U}from"./tabs-1U-zLMBH.js";import"./index-4hsSYOGr.js";import"./progress-Bq-V2CIq.js";import"./dialog-D_bWg3ym.js";import"./scroll-area-CFRxsfIi.js";import"./input-DS5ck5rx.js";const me=(s,c)=>{const[n,h]=j.useState(null),[a,d]=j.useState(!0),[t,i]=j.useState(null),{user:v}=_();return j.useEffect(()=>{(async()=>{if(h(null),!!v){d(!0),i(null);try{const x=[],p=new Date(s),k=new Date(c);for(;p<=k;)x.push(z(p)),p.setDate(p.getDate()+1);const M=new Map(x.map(r=>[r,{date:r,drinks:[],totalWater:0}])),b=x.map(r=>{const o=ie(ce,"water",`${v.uid}_${r}`);return de(o)});(await Promise.all(b)).forEach(r=>{if(r.exists()){const o=r.data();M.set(o.date,{date:o.date,drinks:o.drinks||[],totalWater:o.totalWater||0})}});const y=Array.from(M.values()),S=u.sumBy(y,"totalWater"),A=y.filter(r=>r.totalWater>0).length,l=y.filter(r=>r.totalWater>=2e3).length,m=A>0?S/A:0,E=y.flatMap(r=>r.drinks),he=u.groupBy(E,"type"),xe=Object.entries(he).map(([r,o])=>({type:r,count:o.length,totalAmount:u.sumBy(o,"amount"),percentage:u.sumBy(o,"amount")/S*100||0})).sort((r,o)=>o.totalAmount-r.totalAmount),ue=u.groupBy(E,r=>$[r.type].category),je=Object.entries(ue).map(([r,o])=>({category:r,totalAmount:u.sumBy(o,"amount"),percentage:u.sumBy(o,"amount")/S*100||0})).sort((r,o)=>o.totalAmount-r.totalAmount);let L;c.getTime()-s.getTime()>2592e6&&(L=Object.entries(u.groupBy(y,r=>r.date.substring(0,7))).map(([r,o])=>({month:`${r}-01`,average:u.sumBy(o,"totalWater")/o.length})).sort((r,o)=>new Date(r.month).getTime()-new Date(o.month).getTime()));const ge=y.map(r=>({date:r.date,intake:r.totalWater}));h({dailyStats:ge,summary:{totalIntake:S,avgDailyIntake:m,daysTracked:A,daysWithGoal:l},drinkStats:xe,categoryStats:je,...L&&{monthlyAverages:L}})}catch(x){console.error("Error al cargar estadísticas:",x),i(x instanceof Error?x.message:"Error al cargar estadísticas")}finally{d(!1)}}})()},[v,s,c]),{stats:n,loading:a,error:t}},Be=({selectedDate:s,goal:c=2500})=>{const[n,h]=j.useState(C(s));j.useEffect(()=>{h(C(s))},[s]);const a=j.useMemo(()=>C(n),[n]),d=j.useMemo(()=>W(n),[n]),{stats:t,loading:i}=me(a,d),v=j.useMemo(()=>{const x={};return t==null||t.dailyStats.forEach(({date:p,intake:k})=>{x[p]=k}),x},[t]),N=x=>{const p=z(x.date),k=v[p]||0,M=Math.min(k/c,1),b=28,B=3,y=(b-B)/2,S=2*Math.PI*y,A=S-M*S,l=k>=c;return e.jsxs("div",{className:"relative flex items-center justify-center w-7 h-7",children:[e.jsxs("svg",{width:b,height:b,className:"absolute",children:[e.jsx("circle",{cx:b/2,cy:b/2,r:y,stroke:l?"#bfdbfe":"#e5e7eb",strokeWidth:B,fill:"none"}),e.jsx("circle",{cx:b/2,cy:b/2,r:y,stroke:l?"#3b82f6":"#9ca3af",strokeWidth:B,fill:"none",strokeDasharray:S,strokeDashoffset:A,strokeLinecap:"round",style:{transform:"rotate(-90deg)",transformOrigin:"50% 50%"}})]}),e.jsx("span",{className:"text-[10px] font-medium z-10",children:x.date.getDate()})]})};return e.jsxs(g,{className:"w-full",children:[e.jsxs(w,{className:"flex flex-col items-center gap-2",children:[e.jsx(Se,{className:"w-5 h-5 text-blue-600"}),e.jsx(D,{className:"text-center",children:"Historial Mensual"})]}),e.jsxs(f,{className:"relative p-4",children:[i&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/50 z-10",children:e.jsx(Y,{className:"w-6 h-6 animate-spin"})}),e.jsx(Me,{month:n,onMonthChange:h,showOutsideDays:!0,components:{DayContent:N},className:"p-0 w-full"})]})]})},Z={lastMonth:{label:"Último mes",getValue:s=>({start:C(T(s,1)),end:W(T(s,1))})},currentMonth:{label:"Mes actual",getValue:s=>({start:C(s),end:W(s)})},last3Months:{label:"Últimos 3 meses",getValue:s=>({start:C(T(s,2)),end:W(s)})},last6Months:{label:"Últimos 6 meses",getValue:s=>({start:C(T(s,5)),end:W(s)})},lastYear:{label:"Último año",getValue:s=>({start:G(H(s,1)),end:q(H(s,1))})},currentYear:{label:"Año actual",getValue:s=>({start:G(s),end:q(s)})}},Ee=({onPeriodChange:s})=>{const c=n=>{const h=new Date,a=Z[n];if(a){const{start:d,end:t}=a.getValue(h);s(d,t)}};return e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("span",{className:"text-sm font-medium",children:"Mostrar período:"}),e.jsxs(pe,{onValueChange:c,defaultValue:"currentMonth",children:[e.jsx(ye,{className:"w-[180px]",children:e.jsx(Ne,{placeholder:"Seleccionar período"})}),e.jsx(be,{children:Object.entries(Z).map(([n,{label:h}])=>e.jsx(ve,{value:n,children:h},n))})]})]})},ee=["#60A5FA","#34D399","#A78BFA","#F87171","#FBBF24","#A3E635"],We=({startDate:s,endDate:c})=>{const{stats:n,loading:h,error:a}=me(s,c);if(h)return e.jsx(g,{className:"w-full",children:e.jsx(f,{className:"flex items-center justify-center p-6",children:e.jsx(Y,{className:"w-6 h-6 animate-spin"})})});if(a||!n)return e.jsx(g,{className:"w-full",children:e.jsx(f,{className:"p-6",children:e.jsx("p",{className:"text-red-500",children:"Error al cargar estadísticas"})})});const d=t=>P(new Date(t),"dd MMM",{locale:O});return e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(g,{className:"w-full md:col-span-2",children:[e.jsx(w,{className:"pb-2",children:e.jsx(D,{children:"Resumen del Período"})}),e.jsx(f,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-muted",children:[" ",e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[Math.round(n.summary.avgDailyIntake),"ml"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Promedio diario"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted",children:[" ",e.jsx("div",{className:"text-2xl font-bold text-green-600",children:n.summary.daysTracked}),e.jsx("div",{className:"text-sm text-gray-600",children:"Días registrados"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted",children:[" ",e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:n.summary.daysWithGoal}),e.jsx("div",{className:"text-sm text-gray-600",children:"Días meta alcanzada"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted",children:[" ",e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:[Math.round(n.summary.totalIntake/1e3),"L"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total consumido"})]})]})})]}),e.jsxs(g,{className:"w-full md:col-span-2",children:[e.jsx(w,{children:e.jsx(D,{children:"Tendencia de Consumo"})}),e.jsx(f,{children:e.jsx("div",{className:"h-[300px]",children:e.jsx(F,{width:"100%",height:"100%",children:e.jsxs(we,{data:n.dailyStats,children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(K,{dataKey:"date",tickFormatter:d,interval:"preserveStartEnd"}),e.jsx(V,{tickFormatter:t=>`${t}ml`}),e.jsx(I,{formatter:t=>[`${t}ml`,"Consumo"],labelFormatter:t=>P(new Date(t),"dd MMMM yyyy",{locale:O})}),e.jsx(De,{type:"monotone",dataKey:"intake",stroke:"#60A5FA",strokeWidth:2,dot:!1})]})})})})]}),e.jsxs(g,{className:"w-full",children:[e.jsx(w,{children:e.jsx(D,{children:"Distribución por Categoría"})}),e.jsx(f,{children:e.jsx("div",{className:"h-[300px]",children:e.jsx(F,{width:"100%",height:"100%",children:e.jsxs(se,{children:[e.jsx(ae,{data:n.categoryStats,dataKey:"totalAmount",nameKey:"category",cx:"50%",cy:"50%",outerRadius:100,label:({category:t})=>R[t],children:n.categoryStats.map((t,i)=>e.jsx(re,{fill:ee[i%ee.length]},t.category))}),e.jsx(I,{formatter:t=>[`${t}ml`,"Cantidad"],labelFormatter:t=>R[t]})]})})})})]}),e.jsxs(g,{className:"w-full",children:[e.jsx(w,{children:e.jsx(D,{children:"Top Bebidas"})}),"        ",e.jsx(f,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[" ",n.drinkStats.slice(0,6).map(t=>{const i=$[t.type],v=ne[i.icon];return e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-muted hover:bg-accent transition-colors",children:[e.jsx(v,{className:`w-8 h-8 ${i.color} flex-shrink-0`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[" ",e.jsx("div",{className:"font-medium text-base",children:i.name})," ",e.jsxs("div",{className:"text-sm text-muted-foreground",children:[" ",Math.round(t.totalAmount),"ml"]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[" ",t.count," veces (",Math.round(t.percentage),"%)"]})]})]},t.type)})]})})]}),n.monthlyAverages&&e.jsxs(g,{className:"w-full md:col-span-2",children:[e.jsx(w,{children:e.jsx(D,{children:"Promedios Mensuales"})}),e.jsx(f,{children:e.jsx("div",{className:"h-[300px]",children:e.jsx(F,{width:"100%",height:"100%",children:e.jsxs(le,{data:n.monthlyAverages,children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(K,{dataKey:"month",tickFormatter:t=>{const i=new Date(t);return P(i,"MMM yyyy",{locale:O})}}),e.jsx(V,{tickFormatter:t=>`${Math.round(t)}ml`}),e.jsx(I,{formatter:t=>[`${Math.round(t)}ml`,"Promedio"],labelFormatter:t=>{const i=new Date(t);return P(i,"MMMM yyyy",{locale:O})}}),e.jsx(oe,{dataKey:"average",fill:"#60A5FA"})]})})})})]})]})},Fe=s=>{const[c,n]=j.useState(null),[h,a]=j.useState(!0),[d,t]=j.useState(null),{user:i}=_();return j.useEffect(()=>{(async()=>{if(i){a(!0),t(null);try{const N=[];for(let l=6;l>=0;l--){const m=new Date(s);m.setDate(m.getDate()-l),N.push(z(m))}const x=await Promise.all(N.map(async l=>{const m=ie(ce,"water",`${i.uid}_${l}`),E=await de(m);return E.exists()?{date:l,drinks:E.data().drinks||[],totalWater:E.data().totalWater||0}:{date:l,drinks:[],totalWater:0}})),p=u.sumBy(x,"totalWater"),k=p/7,M=x.flatMap(l=>l.drinks),b=u.groupBy(M,"type"),B=Object.entries(b).map(([l,m])=>({type:l,count:m.length,totalAmount:u.sumBy(m,"amount"),percentage:u.sumBy(m,"amount")/p*100||0})).sort((l,m)=>m.count-l.count),y=u.groupBy(M,l=>$[l.type].category),S=Object.entries(y).map(([l,m])=>({category:l,totalAmount:u.sumBy(m,"amount"),percentage:u.sumBy(m,"amount")/p*100||0})).sort((l,m)=>m.totalAmount-l.totalAmount),A=x.map(l=>({date:l.date,intake:l.totalWater}));n({totalIntake:p,avgDailyIntake:k,commonDrinks:B,dailyIntake:A,categoryStats:S})}catch(N){console.error("Error al cargar estadísticas:",N),t(N instanceof Error?N.message:"Error al cargar estadísticas")}finally{a(!1)}}})()},[i,s]),{stats:c,loading:h,error:d}},te=["#60A5FA","#34D399","#A78BFA","#F87171","#FBBF24","#A3E635"],Ie=({selectedDate:s})=>{const{stats:c,loading:n,error:h}=Fe(s);return n?e.jsx(g,{className:"w-full",children:e.jsx(f,{className:"flex items-center justify-center p-6",children:e.jsx(Y,{className:"w-6 h-6 animate-spin"})})}):h||!c?e.jsx(g,{className:"w-full",children:e.jsx(f,{className:"p-6",children:e.jsx("p",{className:"text-red-500",children:"Error al cargar estadísticas"})})}):e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(g,{className:"w-full",children:[e.jsx(w,{children:e.jsx(D,{children:"Consumo Diario"})}),e.jsxs(f,{children:[e.jsx("div",{className:"h-64",children:e.jsx(F,{width:"100%",height:"100%",children:e.jsxs(le,{data:c.dailyIntake,children:[e.jsx(K,{dataKey:"date",tickFormatter:a=>new Date(a).toLocaleDateString("es-ES",{weekday:"short"})}),e.jsx(V,{tickFormatter:a=>`${a}ml`}),e.jsx(I,{formatter:a=>[`${a}ml`,"Consumo"],labelFormatter:a=>new Date(a).toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"short"})}),e.jsx(oe,{dataKey:"intake",fill:"#60A5FA"})]})})}),e.jsxs("div",{className:"mt-4 text-sm text-gray-500 text-center",children:["Promedio diario: ",Math.round(c.avgDailyIntake),"ml"]})]})]}),e.jsxs(g,{className:"w-full",children:[e.jsx(w,{children:e.jsx(D,{children:"Distribución por Categoría"})}),e.jsx(f,{children:e.jsx("div",{className:"h-64",children:e.jsx(F,{width:"100%",height:"100%",children:e.jsxs(se,{children:[e.jsx(ae,{data:c.categoryStats,dataKey:"totalAmount",nameKey:"category",cx:"50%",cy:"50%",outerRadius:80,label:({category:a})=>R[a],children:c.categoryStats.map((a,d)=>e.jsx(re,{fill:te[d%te.length]},a.category))}),e.jsx(I,{formatter:a=>[`${a}ml`,"Cantidad"],labelFormatter:a=>R[a]})]})})})})]}),e.jsxs(g,{className:"w-full md:col-span-2",children:[e.jsx(w,{children:e.jsx(D,{children:"Bebidas Más Consumidas"})}),e.jsxs(f,{children:["          ",e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4",children:[" ",c.commonDrinks.slice(0,6).map(a=>{const d=$[a.type],t=ne[d.icon];return e.jsxs("div",{className:"flex flex-col items-center p-4 rounded-lg bg-muted text-center",children:[e.jsx(t,{className:`w-6 h-6 ${d.color} mb-2 flex-shrink-0`}),e.jsx("span",{className:"font-medium text-sm leading-tight",children:d.name})," ",e.jsxs("span",{className:"text-sm text-muted-foreground mt-1",children:[" ",a.totalAmount,"ml"]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[" ",a.count," veces"]})]},a.type)})]})]})]})]})},et=()=>{const[s,c]=j.useState(new Date),[n,h]=j.useState(new Date),[a,d]=j.useState(new Date),{user:t}=_(),i=(v,N)=>{h(v),d(N)};return t?e.jsxs(X,{children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Control de Hidratación"}),e.jsx("p",{className:"text-gray-500",children:"Registra y monitorea tu consumo diario de agua"})]}),e.jsxs(Ae,{defaultValue:"daily",className:"w-full",children:[e.jsxs(Ce,{className:"mb-6",children:[e.jsx(Q,{value:"daily",children:"Registro Diario"}),e.jsx(Q,{value:"stats",children:"Estadísticas"})]}),e.jsxs(U,{value:"daily",children:[e.jsx(fe,{selectedDate:s,onChange:c}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-[1fr_300px]",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx(ke,{selectedDate:s}),e.jsx(Ie,{selectedDate:s})]}),e.jsx("div",{children:e.jsx(Be,{selectedDate:s})})]})]}),e.jsxs(U,{value:"stats",children:[e.jsx(Ee,{onPeriodChange:i}),e.jsx(We,{startDate:n,endDate:a})]})]})]}):e.jsx(X,{children:e.jsx(g,{children:e.jsx(f,{className:"p-6",children:e.jsx("p",{className:"text-center",children:"Inicia sesión para ver tus estadísticas de hidratación"})})})})};export{et as default};
