import{j as s}from"./ui-vendor-DOd5GWKT.js";import{r as m}from"./react-vendor-B6CgFIIW.js";import{g as D,C as k,a as z,b as C,c as E,B as $}from"../assets/index-DcexMSJ0.js";import{n as R}from"./chart-vendor-BfhQA-b2.js";import"./firebase-DmRfnWpg.js";import"./utils-vendor-BAnGpuWR.js";const O=e=>e&&"daily"in e&&"totals"in e,M=({data:e,date:n})=>{const[o,h]=m.useState(!1),[a,l]=m.useState(""),[i,I]=m.useState(!1),c="AIzaSyAW4Ot-z7OH4ZR3OeaN7vcbkEDlWpo1aMY",t=D("statistics"),p=t!=null&&t.model?`https://generativelanguage.googleapis.com/v1beta/models/${t.model}:generateContent`:"",x=(t==null?void 0:t.prompt)??"Analiza mis registros y dame consejos.",u=t==null?void 0:t.params,g=e?O(e)?`Fecha: ${n}
Datos semanales:
${JSON.stringify(e.totals,null,2)}

Detalle diario:
${JSON.stringify(e.daily,null,2)}`:`Fecha: ${n}
Datos diarios:
${JSON.stringify(e,null,2)}`:`Fecha: ${n}
No hay datos disponibles.`,y=!e,d=`${x}

${g}`,P=async()=>{var A,N,f,v,b;if(!p||!e)return;h(!0);const j={contents:[{parts:[{text:d}]}],...u};console.log("🤖 AI Analysis Request:",{date:n,dataType:O(e)?"weekly":"daily",dataKeys:e?Object.keys(e):[],promptLength:d.length,requestBody:j});try{const r=await(await fetch(`${p}?key=${c}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(j)})).json();console.log("🤖 AI Response:",r);const S=((b=(v=(f=(N=(A=r==null?void 0:r.candidates)==null?void 0:A[0])==null?void 0:N.content)==null?void 0:f.parts)==null?void 0:v[0])==null?void 0:b.text)||"";S?(l(S),console.log("🤖 Analysis generated successfully")):(console.warn("🤖 No text in AI response:",r),l("No se pudo generar análisis"))}catch(w){console.error("🤖 API Error:",w),l("Error al consultar la API")}finally{h(!1)}};return s.jsxs(k,{children:[s.jsx(z,{children:s.jsx(C,{children:"Asistente IA"})}),"      ",s.jsxs(E,{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs($,{onClick:P,disabled:o||!c||y,className:"flex items-center gap-2",children:[o&&s.jsx(R,{className:"w-4 h-4 animate-spin"}),o?"Analizando...":"Analizar"]}),s.jsx($,{variant:"outline",size:"sm",onClick:()=>I(!i),children:i?"Ocultar Debug":"Mostrar Debug"})]}),i&&s.jsxs("div",{className:"bg-gray-100 p-3 rounded text-xs space-y-2",children:[s.jsxs("div",{children:[s.jsx("strong",{children:"Config:"})," ",t?"Encontrado":"No encontrado"]}),s.jsxs("div",{children:[s.jsx("strong",{children:"Model:"})," ",(t==null?void 0:t.model)||"N/A"]}),s.jsxs("div",{children:[s.jsx("strong",{children:"API Key:"})," ",`${c.substring(0,10)}...`]}),s.jsxs("div",{children:[s.jsx("strong",{children:"Params:"})," ",JSON.stringify(u,null,2)]}),s.jsx("div",{children:s.jsx("strong",{children:"Prompt base:"})}),s.jsx("div",{className:"bg-white p-2 rounded max-h-32 overflow-y-auto",children:x}),s.jsx("div",{children:s.jsx("strong",{children:"Summary data:"})}),s.jsx("div",{className:"bg-white p-2 rounded max-h-32 overflow-y-auto",children:g||"Vacío"}),s.jsx("div",{children:s.jsx("strong",{children:"Prompt completo:"})}),s.jsx("div",{className:"bg-white p-2 rounded max-h-32 overflow-y-auto",children:d})]}),a&&s.jsx("div",{className:"text-sm whitespace-pre-wrap",children:a}),!a&&y&&s.jsx("p",{className:"text-sm text-muted-foreground",children:"Registra datos para generar un análisis."})]})]})};export{M as AiInsightCard};
