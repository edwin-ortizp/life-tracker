import{r as i}from"./react-vendor-B6CgFIIW.js";import{u as h,d as c}from"../assets/index-B6EFx1d9.js";import{q as y,w,l as f,h as D,k as u,t as A,e as g,u as S,n as b}from"./firebase-B1tATv4n.js";const P=()=>{const{user:o}=h(),[E,l]=i.useState([]),[M,a]=i.useState("idle"),[v,s]=i.useState(null);return i.useEffect(()=>{if(!o){l([]);return}a("loading");const t=y(f(c,"prepared-meals"),w("userId","==",o.uid)),e=D(t,r=>{const n=r.docs.map(p=>{const d=p.data(),m={id:p.id,name:d.name||""};return d.portions!==void 0&&(m.portions=d.portions),m});l(n),a("idle")},r=>{s(r instanceof Error?r.message:"Error al cargar"),a("error")});return()=>e()},[o]),{meals:E,status:M,error:v,addMeal:async t=>{if(!o){s("Usuario no autenticado");return}a("saving"),s(null);try{const e={name:t.name,userId:o.uid,createdAt:u(),updatedAt:u()};t.portions!==void 0&&(e.portions=t.portions),await A(f(c,"prepared-meals"),e),a("idle")}catch(e){const r=e instanceof Error?e.message:"Error al guardar";s(r),a("error")}},updateMeal:async(t,e)=>{if(!o){s("Usuario no autenticado");return}a("saving"),s(null);try{const r=g(c,"prepared-meals",t),n={updatedAt:u()};e.name!==void 0&&(n.name=e.name),e.portions!==void 0&&(n.portions=e.portions),await S(r,n),a("idle")}catch(r){const n=r instanceof Error?r.message:"Error al actualizar";s(n),a("error")}},deleteMeal:async t=>{if(!o){s("Usuario no autenticado");return}a("saving"),s(null);try{await b(g(c,"prepared-meals",t)),a("idle")}catch(e){const r=e instanceof Error?e.message:"Error al eliminar";s(r),a("error")}}}};export{P as u};
