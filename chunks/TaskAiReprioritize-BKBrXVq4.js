import{j as e}from"./ui-vendor-DGxrBG5B.js";import{r as t}from"./react-vendor-B6CgFIIW.js";import{t as me}from"./dates-LQzD1DbF.js";import{c as g,B as S,T as ee,b as se,e as te,f as ae}from"../assets/index-CZllZBvh.js";import{a as Re,q as ke,h as je,r as ze,j as pe}from"./utils-vendor-zid8MmOQ.js";import{C as xe,c as ue,d as $e}from"./PageLayout-CQ502YZp.js";import{P as fe}from"./progress-CKnY0O-_.js";import{p as re,c as U}from"./tokens-DP8wmanu.js";import{m as be}from"./marked.esm-BiyRy7sW.js";import{A as ye,h as Le,a as Ne,b as ve,c as Ce,d as Se,e as we,f as Te,g as Oe}from"./alert-dialog-Di4Hu8JE.js";import{al as Be,am as _e,aa as He,a9 as We,H as Fe,an as Ye,z as Ue,X as Ge,a8 as Me,Z as G}from"./chart-vendor-DS0HZnUf.js";import{D as M,a as Z,b as J,c as K,f as Ae}from"./dialog-Ch6bvtCJ.js";import{T as B}from"./textarea-DJSkO8fg.js";import{g as q}from"./ai-BhB6E9je.js";import{S as Ze,a as Je,b as Ke,c as qe,d as Xe}from"./select-CQQJsJq0.js";import"./firebase-B1tATv4n.js";import{c as Qe}from"./MoodAiSuggestion-COK6RpdY.js";import"./input-DyWC7sCN.js";import"./accordion-OgLUcSe4.js";import"./alert-BdSdTxzO.js";const Ve=Re("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function H({className:s,variant:a,...o}){return e.jsx("div",{className:g(Ve({variant:a}),s),...o})}const es={PERSONAL:"personal",WORK:"work",HOME:"home",HEALTH:"health",SHOPPING:"shopping",STUDY:"study",SOCIAL:"social",OTHER:"other"},oe={personal:"Personal",work:"Trabajo",home:"Casa",health:"Salud",shopping:"Compras",study:"Estudio",social:"Social",other:"Otro"},he={personal:{bg:"bg-purple-100",text:"text-purple-700"},work:{bg:"bg-blue-100",text:"text-blue-700"},home:{bg:"bg-green-100",text:"text-green-700"},health:{bg:"bg-red-100",text:"text-red-700"},shopping:{bg:"bg-yellow-100",text:"text-yellow-700"},study:{bg:"bg-indigo-100",text:"text-indigo-700"},social:{bg:"bg-pink-100",text:"text-pink-700"},other:{bg:"bg-gray-100",text:"text-gray-700"}},Ps={MORNING:"morning",AFTERNOON:"afternoon",EVENING:"evening"},Rs={morning:"Mañana",afternoon:"Tarde",evening:"Noche"};be.setOptions({breaks:!0,gfm:!0});const ks=s=>{try{const a=be.parse(s);return re.sanitize(a)}catch{return re.sanitize(s.replace(/\n/g,"<br>"))}},Ee=s=>{const a=s.match(/^\s*- \[(?: |x|X)\]/gm);if(!a||a.length===0)return{total:0,checked:0};const o=a.filter(n=>n.toLowerCase().startsWith("- [x]")).length;return{total:a.length,checked:o}},zs=s=>{const{total:a,checked:o}=Ee(s);return a?o/a*100:0},F={small:"w-3 h-3",medium:"w-3.5 h-3.5",large:"w-5 h-5"},Ie={small:"h-5 w-5",medium:"h-6 w-6"},ss={daily:"Diario",weekly:"Semanal",monthly:"Mensual"},ge={do:{label:"HACER",color:"bg-red-500",text:"Urgente e importante"},decide:{label:"DECIDIR",color:"bg-orange-500",text:"Importante, no urgente"},delegate:{label:"DELEGAR",color:"bg-blue-500",text:"Urgente, no importante"},delete:{label:"ELIMINAR",color:"bg-gray-500",text:"Ni urgente ni importante"},none:{label:"",color:"",text:""}},ne={do:{icon:"🔥",num:1,style:"bg-red-600 text-white"},decide:{icon:"🤔",num:2,style:"bg-orange-500 text-white"},delegate:{icon:"📬",num:3,style:"bg-blue-500 text-white"},delete:{icon:"🗑️",num:4,style:"bg-gray-500 text-white"},none:{icon:"🗑️",num:4,style:"bg-gray-500 text-white"}},ts=s=>je(s,"dd/MM"),as=s=>s!=null&&s.type&&ss[s.type]||"",ns=(s="none")=>ge[s]||ge.none,rs=s=>s?ze(pe(s),pe(new Date)):!1,De=t.memo(t.forwardRef(({completed:s,onToggle:a},o)=>e.jsx(S,{ref:o,variant:"ghost",size:"icon",className:g(Ie.medium,"p-0 rounded-full shrink-0 hover:bg-transparent"),onClick:a,children:s?e.jsx(Be,{className:g(F.large,"text-green-600")}):e.jsx(_e,{className:g(F.large,"text-gray-400 hover:text-gray-600 transition-colors")})})));De.displayName="TaskToggleButton";const V=t.forwardRef(({children:s,...a},o)=>e.jsx(H,{...a,ref:o,children:s}));V.displayName="BadgeWithRef";const le=t.memo(({task:s,showCategoryLabel:a,overdue:o,variant:n})=>{var i,p;const c={bg:((i=he[s.category])==null?void 0:i.bg)||"bg-purple-100",text:((p=he[s.category])==null?void 0:p.text)||"text-purple-800"},l=ns(s.priority),m=as(s.recurrence),r=n==="list"?"text-xs px-1 py-0.5 h-auto":"text-xs px-1.5 py-0.5",d=F.small;return e.jsxs("div",{className:"flex flex-wrap gap-1",children:[a&&e.jsxs(H,{className:g(r,c.bg,c.text),children:[e.jsx(He,{className:g(d,"mr-1")}),oe[s.category]]}),n==="list"&&!a&&l.label&&e.jsx(ee,{children:e.jsxs(se,{children:[e.jsx(te,{asChild:!0,children:e.jsx(V,{className:g(r,"text-white",l.color),children:l.label})}),e.jsx(ae,{children:l.text})]})}),!a&&s.size&&e.jsx(H,{variant:"outline",className:r,children:s.size}),s.dueDate&&e.jsxs(H,{variant:o?"destructive":"secondary",className:r,children:[e.jsx(We,{className:g(d,"mr-1")}),ts(s.dueDate),o&&" (vencida)"]}),n==="kanban"&&e.jsx(ee,{children:e.jsxs(se,{children:[e.jsx(te,{asChild:!0,children:e.jsxs(V,{className:g(r,"gap-0.5",ne[s.priority||"none"].style),children:[e.jsx("span",{className:"mr-0.5",children:ne[s.priority||"none"].icon}),ne[s.priority||"none"].num]})}),e.jsx(ae,{children:l.text})]})}),n==="kanban"&&s.estimatedTime!==void 0&&e.jsxs(H,{variant:"outline",className:r,children:[e.jsx(Fe,{className:g(d,"mr-1")}),s.estimatedTime,"m"]}),s.isRecurrent&&m&&e.jsxs(H,{variant:"outline",className:r,children:[e.jsx(Ye,{className:g(d,"mr-1")}),m]}),n==="list"&&!s.isRecurrent&&l.label&&e.jsx(ee,{children:e.jsxs(se,{children:[e.jsx(te,{asChild:!0,children:e.jsx(V,{className:g(r,"text-white cursor-help",l.color),children:l.label})}),e.jsx(ae,{children:l.text})]})})]})});le.displayName="TaskBadges";const W=t.forwardRef(({children:s,...a},o)=>e.jsx(S,{ref:o,...a,children:s}));W.displayName="ActionButton";const ie=t.memo(({task:s,onEdit:a,onDelete:o,onMove:n,variant:c})=>{const l=t.useCallback(x=>{x.stopPropagation(),n==null||n(s.id,me(new Date))},[n,s.id]),m=t.useCallback(x=>{x.stopPropagation(),n==null||n(s.id,me(ke(new Date,1)))},[n,s.id]),r=t.useCallback(x=>{x.stopPropagation(),n==null||n(s.id,null)},[n,s.id]),d=t.useCallback(x=>{x.stopPropagation(),a(s)},[a,s]),i=t.useCallback(()=>{o(s.id)},[o,s.id]),p=g(Ie.medium,"md:h-5 md:w-5 p-0 rounded-full hover:bg-muted"),j=c==="kanban"&&n&&e.jsxs("div",{className:"flex gap-1",children:[e.jsx(W,{variant:"ghost",size:"icon",className:p,title:"Asignar para hoy",onClick:l,children:e.jsx("span",{role:"img","aria-label":"hoy",className:"text-sm md:text-xs",children:"📅"})}),e.jsx(W,{variant:"ghost",size:"icon",className:p,title:"Asignar para mañana",onClick:m,children:e.jsx("span",{role:"img","aria-label":"mañana",className:"text-sm md:text-xs",children:"🌅"})}),e.jsx(W,{variant:"ghost",size:"icon",className:p,title:"Quitar fecha",onClick:r,children:e.jsx("span",{role:"img","aria-label":"sin fecha",className:"text-sm md:text-xs",children:"❌"})})]});return e.jsxs("div",{className:g("flex gap-1",c==="kanban"?"justify-between w-full":"shrink-0 opacity-60 hover:opacity-100 transition-opacity"),children:[j,e.jsxs("div",{className:"flex gap-1",children:[e.jsx(W,{variant:"ghost",size:"icon",className:p,title:"Editar tarea",onClick:d,children:e.jsx(Ue,{className:g(F.medium,"md:w-3 md:h-3 text-muted-foreground")})}),e.jsxs(ye,{children:[e.jsx(Le,{asChild:!0,children:e.jsx(W,{variant:"ghost",size:"icon",className:g(p,"hover:bg-red-50"),title:"Eliminar tarea",onClick:x=>x.stopPropagation(),children:e.jsx(Ge,{className:g(F.medium,"md:w-3 md:h-3 text-red-500")})})}),e.jsxs(Ne,{children:[e.jsxs(ve,{children:[e.jsx(Ce,{children:"¿Eliminar tarea?"}),e.jsxs(Se,{children:['Esta acción no se puede deshacer. La tarea "',s.title,'" será eliminada permanentemente.']})]}),e.jsxs(we,{children:[e.jsx(Te,{children:"Cancelar"}),e.jsx(Oe,{onClick:i,className:"bg-red-600 hover:bg-red-700",children:"Eliminar"})]})]})]})]})]})});ie.displayName="TaskActions";const ce=t.memo(({open:s,onOpenChange:a,onConfirm:o,taskTitle:n})=>e.jsx(ye,{open:s,onOpenChange:a,children:e.jsxs(Ne,{children:[e.jsxs(ve,{children:[e.jsx(Ce,{children:"¿Marcar tarea como completada?"}),e.jsxs(Se,{children:['La tarea "',n,'" se marcará como completada.']})]}),e.jsxs(we,{children:[e.jsx(Te,{children:"Cancelar"}),e.jsx(Oe,{onClick:o,children:"Completar"})]})]})}));ce.displayName="ConfirmCompleteDialog";const os=t.memo(({task:s,onToggle:a,onDelete:o,onEdit:n,onView:c,onMove:l,variant:m="list",showCategoryLabel:r=!0})=>{const[d,i]=t.useState(!1),p=rs(s.dueDate??null),{total:j,checked:x}=Ee(s.description||""),y=j?s.progress??x/j*100:0,E=t.useCallback(w=>{w.stopPropagation(),s.completed?a(s.id,!1):i(!0)},[s.completed,s.id,a]),v=t.useCallback(()=>{a(s.id,!0),i(!1)},[s.id,a]),C=t.useCallback(()=>{c==null||c(s)},[c,s]),T=g("cursor-pointer relative hover:shadow-md transition-all duration-200 border-0 shadow-sm",m==="kanban"&&"text-sm w-full max-w-none lg:max-w-[18rem]",m==="list"&&"mb-2",s.completed?m==="kanban"?"bg-muted/30":"opacity-70 bg-gray-50":"bg-white",!s.completed&&p&&"border-l-4 border-l-red-500 bg-red-50",m==="list"&&"hover:bg-gray-50");return m==="kanban"?e.jsxs(e.Fragment,{children:[e.jsxs(xe,{onClick:C,className:T,children:[e.jsx(ue,{className:"p-2 md:p-2 flex flex-col gap-1.5",children:e.jsx("div",{className:"flex items-start gap-2",children:e.jsxs("div",{className:"flex-1 min-w-0 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.isPrivate&&e.jsx("span",{className:"text-xs",children:"🔒"}),e.jsx("span",{className:g("text-sm break-words line-clamp-2 font-medium",s.completed?"line-through text-muted-foreground":"text-foreground"),children:s.title})]}),s.description&&e.jsx("p",{className:g("text-xs text-muted-foreground line-clamp-2 break-words leading-relaxed",s.completed&&"line-through"),children:s.description}),e.jsx("div",{className:"flex flex-wrap gap-1 pt-0.5",children:e.jsx(le,{task:s,showCategoryLabel:r,overdue:p,variant:"kanban"})}),j>0&&e.jsxs("div",{className:"pt-1 space-y-0.5",children:[e.jsx(fe,{value:y,className:"h-1"}),e.jsxs("p",{className:"text-[10px] text-right text-muted-foreground",children:[x," de ",j]})]})]})})}),e.jsx($e,{className:"px-2 py-1.5 bg-gray-50/50 border-t border-gray-100 p-0 md:p-0",children:e.jsx("div",{className:"px-2 py-1.5 w-full",children:e.jsx(ie,{task:s,onEdit:n,onDelete:o,onMove:l,variant:"kanban"})})})]}),e.jsx(ce,{open:d,onOpenChange:i,onConfirm:v,taskTitle:s.title})]}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{onClick:C,className:T,children:e.jsxs(ue,{className:"flex items-center gap-2.5 py-2 px-3 md:py-2 md:px-3",children:[e.jsx(De,{completed:s.completed,onToggle:()=>E}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-0.5",children:[e.jsxs("div",{className:"space-y-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.isPrivate&&e.jsx("span",{className:"text-xs opacity-70",children:"🔒"}),e.jsx("span",{className:g("text-sm break-words line-clamp-1 leading-tight font-medium",s.completed?"line-through text-muted-foreground":"text-foreground"),children:s.title}),s.description&&e.jsx(Me,{className:"w-3 h-3 text-muted-foreground shrink-0 opacity-50"})]}),s.description&&e.jsx("p",{className:g("text-xs text-muted-foreground line-clamp-1 break-words leading-tight",s.completed&&"line-through"),children:s.description})]}),e.jsx(le,{task:s,showCategoryLabel:r,overdue:p,variant:"list"})]}),e.jsx(ie,{task:s,onEdit:n,onDelete:o,variant:"list"})]})}),e.jsx(ce,{open:d,onOpenChange:i,onConfirm:v,taskTitle:s.title})]})});os.displayName="TaskItem";const X=({className:s})=>{const[a,o]=t.useState(0);return t.useEffect(()=>{const n=setInterval(()=>{o(c=>{const l=c+5;return l>=100?(clearInterval(n),100):l})},500);return()=>clearInterval(n)},[]),e.jsxs("div",{className:`flex items-center gap-2 ${s??""}`,children:[e.jsx(fe,{value:a,className:"flex-1"}),e.jsxs("span",{className:"text-xs text-muted-foreground w-8 text-right",children:[a,"%"]})]})},R=q("task"),ls=R?`https://generativelanguage.googleapis.com/v1beta/models/${R.model}:generateContent`:"",$s=({title:s,description:a,onInsert:o})=>{var w;const[n,c]=t.useState(!1),[l,m]=t.useState(""),[r,d]=t.useState(""),[i,p]=t.useState(!1),[j,x]=t.useState(0),y="AIzaSyAW4Ot-z7OH4ZR3OeaN7vcbkEDlWpo1aMY",E=((w=R==null?void 0:R.prompts)==null?void 0:w.breakdown)??"Desglosa la siguiente tarea en subtareas concretas y accionables:",v=R==null?void 0:R.params;t.useEffect(()=>{n&&m(`${E}
Tarea: ${s}
Descripcion: ${a}`)},[n,s,a]),t.useEffect(()=>{x(U(l))},[l]);const C=async()=>{var b,O,N,f,A;if(s){p(!0);try{const h=await(await fetch(`${ls}?key=${y}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:l}]}],...v})})).json(),I=(A=(f=(N=(O=(b=h==null?void 0:h.candidates)==null?void 0:b[0])==null?void 0:O.content)==null?void 0:N.parts)==null?void 0:f[0])==null?void 0:A.text;d(I||"No se pudo obtener sugerencia")}catch{d("Error al consultar la API")}finally{p(!1)}}},T=()=>{r&&(o(r),c(!1),d(""))};return e.jsxs(e.Fragment,{children:[e.jsxs(S,{type:"button",variant:"outline",size:"sm",onClick:()=>c(!0),className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4"})," Subtareas IA"]}),e.jsx(M,{open:n,onOpenChange:c,children:e.jsxs(Z,{className:"w-full sm:max-w-xl max-h-[90vh] overflow-auto",children:[e.jsx(J,{children:e.jsx(K,{children:"Desglose de tarea"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(B,{value:l,onChange:b=>m(b.target.value),className:"max-h-[500px] overflow-y-auto"}),e.jsxs("p",{className:"text-xs text-right",children:["Tokens: ",j," ",j>3500&&e.jsx("span",{className:"text-red-500",children:"¡Prompt demasiado largo!"})]}),e.jsx(S,{onClick:C,disabled:i||!y,className:"w-full",children:i?"Consultando...":"Obtener subtareas"}),i&&e.jsx(X,{className:"mt-2"}),r&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{readOnly:!0,value:r,className:"max-h-[300px]"}),e.jsx(S,{type:"button",onClick:T,className:"w-full",children:"Insertar en descripción"})]})]})]})})]})},k=q("task"),is=k?`https://generativelanguage.googleapis.com/v1beta/models/${k.model}:generateContent`:"",Ls=({title:s,description:a,onInsert:o})=>{var w;const[n,c]=t.useState(!1),[l,m]=t.useState(""),[r,d]=t.useState(""),[i,p]=t.useState(!1),[j,x]=t.useState(0),y="AIzaSyAW4Ot-z7OH4ZR3OeaN7vcbkEDlWpo1aMY",E=((w=k==null?void 0:k.prompts)==null?void 0:w.improveDescription)??"Mejora la descripción de la tarea sin cambiar su esencia. Si no hay descripción, genera una basada en el título (máx. 150 palabras).",v=k==null?void 0:k.params;t.useEffect(()=>{n&&m(`${E}
Título: ${s}
Descripción actual: ${a||"N/A"}`)},[n,s,a]),t.useEffect(()=>{x(U(l))},[l]);const C=async()=>{var b,O,N,f,A;if(s){p(!0);try{const h=await(await fetch(`${is}?key=${y}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:l}]}],...v})})).json(),I=(A=(f=(N=(O=(b=h==null?void 0:h.candidates)==null?void 0:b[0])==null?void 0:O.content)==null?void 0:N.parts)==null?void 0:f[0])==null?void 0:A.text;d(I||"No se pudo obtener sugerencia")}catch{d("Error al consultar la API")}finally{p(!1)}}},T=()=>{r&&(o(r),c(!1),d(""))};return e.jsxs(e.Fragment,{children:[e.jsxs(S,{type:"button",variant:"outline",size:"sm",onClick:()=>c(!0),className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4"})," Mejorar descripción"]}),e.jsx(M,{open:n,onOpenChange:c,children:e.jsxs(Z,{className:"w-full sm:max-w-xl max-h-[90vh] overflow-auto",children:[e.jsx(J,{children:e.jsx(K,{children:"Descripción mejorada"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(B,{value:l,onChange:b=>m(b.target.value),className:"max-h-[500px] overflow-y-auto"}),e.jsxs("p",{className:"text-xs text-right",children:["Tokens: ",j," ",j>3500&&e.jsx("span",{className:"text-red-500",children:"¡Prompt demasiado largo!"})]}),e.jsx(S,{onClick:C,disabled:i||!y,className:"w-full",children:i?"Consultando...":"Obtener descripción"}),i&&e.jsx(X,{className:"mt-2"}),r&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{readOnly:!0,value:r,className:"max-h-[300px]"}),e.jsx(S,{type:"button",onClick:T,className:"w-full",children:"Insertar en descripción"})]})]})]})})]})},z=q("task"),cs=z?`https://generativelanguage.googleapis.com/v1beta/models/${z.model}:generateContent`:"",Bs=({title:s,description:a,onInsert:o})=>{var w;const[n,c]=t.useState(!1),[l,m]=t.useState(""),[r,d]=t.useState(""),[i,p]=t.useState(!1),[j,x]=t.useState(0),y="AIzaSyAW4Ot-z7OH4ZR3OeaN7vcbkEDlWpo1aMY",E=((w=z==null?void 0:z.prompts)==null?void 0:w.ideas)??"Sugiere ejemplos o estrategias breves para abordar la tarea. Máximo 150 palabras.",v=z==null?void 0:z.params;t.useEffect(()=>{n&&m(`${E}
Título: ${s}
Descripción: ${a}`)},[n,s,a]),t.useEffect(()=>{x(U(l))},[l]);const C=async()=>{var b,O,N,f,A;if(s){p(!0);try{const h=await(await fetch(`${cs}?key=${y}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:l}]}],...v})})).json(),I=(A=(f=(N=(O=(b=h==null?void 0:h.candidates)==null?void 0:b[0])==null?void 0:O.content)==null?void 0:N.parts)==null?void 0:f[0])==null?void 0:A.text;d(I||"No se pudo obtener sugerencia")}catch{d("Error al consultar la API")}finally{p(!1)}}},T=()=>{r&&(o(r),c(!1),d(""))};return e.jsxs(e.Fragment,{children:[e.jsxs(S,{type:"button",variant:"outline",size:"sm",onClick:()=>c(!0),className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4"})," Ideas"]}),e.jsx(M,{open:n,onOpenChange:c,children:e.jsxs(Z,{className:"w-full sm:max-w-xl max-h-[90vh] overflow-auto",children:[e.jsx(J,{children:e.jsx(K,{children:"Ideas para la tarea"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(B,{value:l,onChange:b=>m(b.target.value),className:"max-h-[500px] overflow-y-auto"}),e.jsxs("p",{className:"text-xs text-right",children:["Tokens: ",j," ",j>3500&&e.jsx("span",{className:"text-red-500",children:"¡Prompt demasiado largo!"})]}),e.jsx(S,{onClick:C,disabled:i||!y,className:"w-full",children:i?"Consultando...":"Obtener ideas"}),i&&e.jsx(X,{className:"mt-2"}),r&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{readOnly:!0,value:r,className:"max-h-[300px]"}),e.jsx(S,{type:"button",onClick:T,className:"w-full",children:"Insertar en descripción"})]})]})]})})]})},$=q("task"),ds=$?`https://generativelanguage.googleapis.com/v1beta/models/${$.model}:generateContent`:"",_s=({tasks:s,open:a,onOpenChange:o})=>{const[n,c]=t.useState(!1),l=a!==void 0?a:n,m=o??c,[r,d]=t.useState(""),[i,p]=t.useState(null),[j,x]=t.useState(""),[y,E]=t.useState(!1),[v,C]=t.useState(""),[T,w]=t.useState(0),b="AIzaSyAW4Ot-z7OH4ZR3OeaN7vcbkEDlWpo1aMY",O=($==null?void 0:$.prompt)??"Eres un asistente de productividad. Basándote en el estado de ánimo y las tareas pendientes sugiere cuál debería abordar primero.",N=$==null?void 0:$.params;t.useEffect(()=>{if(r&&i){const u=s.filter(h=>h.category===r).sort((h,I)=>{var D,P;return(((D=h.dueDate)==null?void 0:D.getTime())||1/0)-(((P=I.dueDate)==null?void 0:P.getTime())||1/0)}).slice(0,10).map(h=>`- ${h.title}${h.dueDate?` (vence ${je(h.dueDate,"yyyy-MM-dd")})`:""}`).join(`
`);C(`${O}
Estado de ánimo: ${i.text}
Categoría: ${oe[r]}
Tareas:
${u}`)}else C("")},[r,i,s]),t.useEffect(()=>{w(U(v))},[v]);const f=async()=>{var u,h,I,D,P;if(!(!i||!r)){E(!0);try{const Y=await(await fetch(`${ds}?key=${b}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:v}]}],...N})})).json(),de=(P=(D=(I=(h=(u=Y==null?void 0:Y.candidates)==null?void 0:u[0])==null?void 0:h.content)==null?void 0:I.parts)==null?void 0:D[0])==null?void 0:P.text;x(de||"No se pudo obtener sugerencia")}catch{x("Error al consultar la API")}finally{E(!1)}}},A=()=>{m(!1),x(""),p(null),d("")};return e.jsxs(M,{open:l,onOpenChange:u=>u?m(!0):A(),children:[a===void 0&&e.jsxs(S,{size:"sm",variant:"outline",onClick:()=>m(!0),className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),"Sugerir tarea"]}),e.jsxs(Z,{className:"w-full sm:max-w-5xl max-h-[90vh] overflow-auto",children:[e.jsxs(J,{children:[e.jsx(K,{children:"Sugerencia de tarea"}),e.jsx(Ae,{children:"Selecciona una categoría y cómo te sientes para recibir una recomendación"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(Ze,{value:r,onValueChange:u=>d(u),children:[e.jsx(Je,{className:"w-full",children:e.jsx(Ke,{placeholder:"Categoría"})}),e.jsx(qe,{children:Object.values(es).map(u=>e.jsx(Xe,{value:u,children:oe[u]},u))})]}),r&&!i&&e.jsx(Qe,{onSelect:u=>p(u)}),r&&i&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-center text-sm",children:["Estado de ánimo: ",i.emoji," ",i.text]}),e.jsx(B,{value:v,onChange:u=>C(u.target.value),className:"max-h-[500px] overflow-y-auto"}),e.jsxs("p",{className:"text-xs text-right",children:["Tokens: ",T," ",T>3500&&e.jsx("span",{className:"text-red-500",children:"¡Prompt demasiado largo!"})]}),e.jsx(S,{onClick:f,disabled:y||!b,className:"w-full",children:y?"Consultando...":"Obtener sugerencia"}),y&&e.jsx(X,{className:"mt-2"}),j&&e.jsx("div",{className:"p-4 bg-muted rounded-md prose max-w-none",children:e.jsx("div",{dangerouslySetInnerHTML:{__html:re.sanitize(j)}})})]})]})]})]})},L=q("task"),ms=L?`https://generativelanguage.googleapis.com/v1beta/models/${L.model}:generateContent`:"",Hs=({tasks:s,onUpdate:a,open:o,onOpenChange:n})=>{var O;const[c,l]=t.useState(!1),m=o!==void 0?o:c,r=n??l,[d,i]=t.useState(!1),[p,j]=t.useState(""),[x,y]=t.useState(""),[E,v]=t.useState(0),C="AIzaSyAW4Ot-z7OH4ZR3OeaN7vcbkEDlWpo1aMY",T=((O=L==null?void 0:L.prompts)==null?void 0:O.reprioritize)??"Analiza la lista de tareas y devuelve un JSON con id, urgent, important, size y estimatedTime (minutos).",w=L==null?void 0:L.params;t.useEffect(()=>{if(m){const N=s.map(f=>`- id:${f.id} title:${f.title} desc:${f.description||""} priority:${f.priority||""} size:${f.size||""} time:${f.estimatedTime||""}`).join(`
`);y(`${T}
${N}`)}},[m,s]),t.useEffect(()=>{v(U(x))},[x]);const b=async()=>{var N,f,A,u,h;if(s.length!==0){i(!0);try{const D=await(await fetch(`${ms}?key=${C}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:x}]}],...w})})).json(),P=((h=(u=(A=(f=(N=D==null?void 0:D.candidates)==null?void 0:N[0])==null?void 0:f.content)==null?void 0:A.parts)==null?void 0:u[0])==null?void 0:h.text)||"";j(P);const Q=P.match(/```json([\s\S]*?)```/),Y=Q?Q[1]:P;JSON.parse(Y).forEach(_=>{const Pe=_.urgent&&_.important?"do":_.important?"decide":_.urgent?"delegate":"delete";a(_.id,{priority:Pe,size:_.size,estimatedTime:_.estimatedTime})})}catch{j("Error al consultar la API")}finally{i(!1)}}};return e.jsxs(e.Fragment,{children:[o===void 0&&e.jsxs(S,{size:"sm",variant:"outline",onClick:()=>r(!0),className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),"Repriorizar"]}),e.jsx(M,{open:m,onOpenChange:r,children:e.jsxs(Z,{className:"w-full sm:max-w-lg",children:[e.jsxs(J,{children:[e.jsx(K,{children:"Repriorizar tareas visibles"}),e.jsx(Ae,{children:"La IA ajustará prioridad, tamaño y tiempo estimado."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(B,{value:x,onChange:N=>y(N.target.value),className:"max-h-[300px] overflow-y-auto"}),e.jsxs("p",{className:"text-xs text-right",children:["Tokens: ",E]}),e.jsx(S,{onClick:b,disabled:d||!C,className:"w-full",children:d?"Analizando...":"Repriorizar"}),d&&e.jsx(X,{}),p&&e.jsx("pre",{className:"text-xs bg-muted p-2 rounded max-h-48 overflow-auto whitespace-pre-wrap",children:p})]})]})})]})};export{X as A,H as B,oe as C,os as T,es as a,Rs as b,_s as c,Hs as d,he as e,Ps as f,Ee as g,$s as h,Ls as i,Bs as j,zs as k,ks as r};
