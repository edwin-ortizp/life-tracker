import{j as e}from"./ui-vendor-DGxrBG5B.js";import{r as l}from"./react-vendor-B6CgFIIW.js";import{T as G,a as Y,b,c as D}from"./tabs-C-7Scvnq.js";import{P as C,C as f,c as g}from"./PageLayout-CQ502YZp.js";import{J as q}from"./index-D7xMmDeo.js";import{M as U}from"./index-GGsBOQGH.js";import{J as X,a as z}from"./MoodAiSuggestion-COK6RpdY.js";import{A as H,a as Q}from"./alert-BdSdTxzO.js";import{b as Z,R as w,r as ee,l as se,m as ae,Y as te,n as R,N as A,s as re,P as ne,p as ie,q as oe}from"./chart-vendor-DS0HZnUf.js";import{D as ce}from"./DateSelector-CGjErOQW.js";import{u as L,d as M}from"../assets/index-CZllZBvh.js";import{S as le,a as de,b as me,c as xe,d as he}from"./select-CQQJsJq0.js";import{m as V,n as W,s as ue,e as je}from"./utils-vendor-zid8MmOQ.js";import{e as O,f as T}from"./firebase-B1tATv4n.js";import{g as pe}from"./dates-LQzD1DbF.js";import"./textarea-DJSkO8fg.js";import"./input-DyWC7sCN.js";import"./TaskAiReprioritize-BKBrXVq4.js";import"./progress-CKnY0O-_.js";import"./tokens-DP8wmanu.js";import"./marked.esm-BiyRy7sW.js";import"./alert-dialog-Di4Hu8JE.js";import"./dialog-Ch6bvtCJ.js";import"./ai-BhB6E9je.js";import"./accordion-OgLUcSe4.js";import"./useTaskData-CIezL0zz.js";import"./checkbox-Byik9ELG.js";import"./index-4hsSYOGr.js";import"./index-DuocBWKh.js";const fe=({selectedDate:t})=>e.jsx(X,{children:e.jsx(z,{children:e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx(q,{selectedDate:t})}),e.jsxs("div",{className:"md:col-span-1 space-y-4",children:[e.jsx(U,{selectedDate:t,energyFirst:!0}),e.jsxs(H,{children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsx(Q,{children:"Registrar tu estado de ánimo junto con tus entradas del diario te ayuda a mantener un mejor seguimiento de tus emociones y experiencias."})]})]})]})})})}),J={currentWeek:{label:"Semana actual",getValue:t=>({start:V(t),end:W(t)})},currentMonth:{label:"Mes actual",getValue:t=>({start:ue(t),end:je(t)})}},ge=({onPeriodChange:t})=>{const d=i=>{const c=new Date,m=J[i];if(m){const{start:x,end:u}=m.getValue(c);t(x,u)}};return e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("span",{className:"text-sm font-medium",children:"Mostrar período:"}),e.jsxs(le,{onValueChange:d,defaultValue:"currentWeek",children:[e.jsx(de,{className:"w-[180px]",children:e.jsx(me,{placeholder:"Seleccionar período"})}),e.jsx(xe,{children:Object.entries(J).map(([i,{label:c}])=>e.jsx(he,{value:i,children:c},i))})]})]})},Ne=(t,d)=>{const[i,c]=l.useState(null),[m,x]=l.useState(!0),[u,n]=l.useState(null),{user:h}=L();return l.useEffect(()=>{(async()=>{if(h){x(!0),n(null);try{const r=[],o=new Date(t),j=new Date(d);for(;o<=j;)r.push(pe(o)),o.setDate(o.getDate()+1);const I=r.map(s=>{const a=O(M,"journal",`${h.uid}_${s}`);return T(a)}),K=r.map(s=>{const a=O(M,"moods",`${h.uid}_${s}`);return T(a)}),$=await Promise.all(I),B=await Promise.all(K),P=new Map(r.map(s=>[s,{date:s,words:0,characters:0}]));$.forEach(s=>{var a,p;if(s.exists()){const N=s.data();P.set(N.date,{date:N.date,words:((a=N.text)==null?void 0:a.split(/\s+/).filter(Boolean).length)||0,characters:((p=N.text)==null?void 0:p.length)||0})}});const y=Array.from(P.values()).sort((s,a)=>s.date<a.date?1:-1),v={};B.forEach(s=>{if(s.exists()){const a=s.data();Array.isArray(a.moods)&&a.moods.forEach(p=>{v[p.text]=(v[p.text]||0)+1})}});const _=Object.entries(v).map(([s,a])=>({name:s,value:a})).sort((s,a)=>a.value-s.value).slice(0,5),S=y.filter(s=>s.words>0).length,F=S>0?Math.round(y.reduce((s,a)=>s+a.words,0)/S):0;c({entries:y,moodStats:_,totalEntries:S,averageWords:F})}catch(r){console.error("Error al cargar estadísticas del diario:",r),n(r instanceof Error?r.message:"Error al cargar estadísticas")}finally{x(!1)}}})()},[h,t,d]),{stats:i,loading:m,error:u}},k=["#8884d8","#82ca9d","#ffc658","#ff8042","#a4de6c"],Xe=()=>{const[t,d]=l.useState(new Date),[i,c]=l.useState(V(new Date)),[m,x]=l.useState(W(new Date)),{user:u}=L(),{stats:n,loading:h,error:E}=Ne(i,m),r=(o,j)=>{c(o),x(j)};return u?e.jsxs(C,{children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Diario Personal"}),e.jsx("p",{className:"text-gray-500",children:"Escribe y reflexiona sobre tus experiencias diarias"})]}),e.jsx(ce,{selectedDate:t,onChange:d}),e.jsxs(G,{defaultValue:"entry",className:"space-y-4",children:[e.jsxs(Y,{children:[e.jsx(b,{value:"entry",children:"Entrada Diaria"}),e.jsx(b,{value:"analytics",children:"Análisis"}),e.jsx(b,{value:"settings",children:"Configuración"})]}),e.jsx(D,{value:"entry",className:"space-y-4",children:e.jsx(fe,{selectedDate:t})}),e.jsxs(D,{value:"analytics",className:"space-y-4",children:[e.jsx(ge,{onPeriodChange:r}),h||!n?e.jsx("div",{className:"p-4",children:"Cargando estadísticas..."}):E?e.jsx("div",{className:"p-4 text-red-500",children:"Error al cargar estadísticas"}):e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsx(f,{children:e.jsxs(g,{className:"pt-6",children:[e.jsx("h3",{className:"font-medium mb-4",children:"Actividad de Escritura"}),e.jsx("div",{className:"h-64",children:e.jsx(w,{width:"100%",height:"100%",children:e.jsxs(ee,{data:n.entries,children:[e.jsx(se,{strokeDasharray:"3 3"}),e.jsx(ae,{dataKey:"date"}),e.jsx(te,{}),e.jsx(R,{}),e.jsx(A,{}),e.jsx(re,{dataKey:"words",name:"Palabras",fill:"#8884d8"})]})})})]})}),e.jsx(f,{children:e.jsxs(g,{className:"pt-6",children:[e.jsx("h3",{className:"font-medium mb-4",children:"Estados de Ánimo Frecuentes"}),e.jsx("div",{className:"h-64",children:e.jsx(w,{width:"100%",height:"100%",children:e.jsxs(ne,{children:[e.jsx(ie,{data:n.moodStats,nameKey:"name",dataKey:"value",cx:"50%",cy:"50%",outerRadius:80,label:!0,children:n.moodStats.map((o,j)=>e.jsx(oe,{fill:k[j%k.length]},o.name))}),e.jsx(R,{}),e.jsx(A,{})]})})})]})}),e.jsx(f,{children:e.jsxs(g,{className:"pt-6",children:[e.jsx("h3",{className:"font-medium mb-4",children:"Estadísticas Generales"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total de entradas"}),e.jsx("p",{className:"text-2xl font-bold",children:n.totalEntries})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Promedio de palabras"}),e.jsx("p",{className:"text-2xl font-bold",children:n.averageWords})]})]})]})}),e.jsx(f,{children:e.jsxs(g,{className:"pt-6",children:[e.jsx("h3",{className:"font-medium mb-4",children:"Sugerencias"}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[e.jsx("p",{children:"• Escribe regularmente para mantener un mejor seguimiento de tus emociones"}),e.jsx("p",{children:"• Registra tu estado de ánimo junto con tus entradas del diario"}),e.jsx("p",{children:"• Revisa tus entradas anteriores para identificar patrones"}),e.jsx("p",{children:"• Usa las estadísticas para entender mejor tus hábitos de escritura"})]})]})})]})]}),e.jsx(D,{value:"settings",className:"space-y-4",children:e.jsxs(f,{children:[e.jsx(g,{className:"pt-6",children:e.jsx("h3",{className:"font-medium mb-4",children:"Configuración del Diario"})}),"          "]})})]})]}):e.jsx(C,{children:e.jsx("div",{className:"text-center py-8",children:e.jsx("h2",{className:"text-xl font-semibold",children:"Inicia sesión para acceder a tu diario"})})})};export{Xe as default};
