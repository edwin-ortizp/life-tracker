import{j as s}from"./ui-vendor-DGxrBG5B.js";import{r as n}from"./react-vendor-B6CgFIIW.js";import{P as H}from"./Pomodoro-CB8iAbr_.js";import{u as M,d as I}from"../assets/index-CZllZBvh.js";import"./accordion-OgLUcSe4.js";import"./progress-CKnY0O-_.js";import{C as v,a as D,b,c as w,P as L}from"./PageLayout-CQ502YZp.js";import{e as R,f as _}from"./firebase-B1tATv4n.js";import{g as C}from"./dates-LQzD1DbF.js";import{i as W,j as B,k as F,b as G,l as q,h as J,s as k,e as K}from"./utils-vendor-zid8MmOQ.js";import{f as $}from"./formatTime-BWrFzjSW.js";import{C as Q}from"./calendar-IVo5Etli.js";import{T as U,j as V}from"./chart-vendor-DS0HZnUf.js";import{D as X}from"./DateSelector-CGjErOQW.js";import"./dialog-Ch6bvtCJ.js";import"./input-DyWC7sCN.js";import"./checkbox-Byik9ELG.js";import"./index-4hsSYOGr.js";import"./label-BZ2qu7W8.js";import"./alert-dialog-Di4Hu8JE.js";const Y=(t="week")=>{const[i,e]=n.useState(null),[h,d]=n.useState(!0),[g,f]=n.useState(null),{user:p}=M();return n.useEffect(()=>{(async()=>{if(!p){d(!1);return}try{d(!0),f(null);const m=W(new Date),r=B(t==="week"?F(m,7):G(m,1)),x=q({start:r,end:m}),c=[],S={};for(const o of x){const l=C(o),E=R(I,"pomodoro",`${p.uid}_${l}`),P=await _(E);if(P.exists()){const T=P.data();c.push(...T.sessions);const O=T.sessions.filter(A=>A.completed).length;O>0&&(S[l]=O)}}if(c.length===0){e({totalSessions:0,completedSessions:0,totalTime:0,averageSessionTime:0,completionRate:0}),d(!1);return}const a=Object.entries(S).reduce((o,[l,E])=>E>o[1]?[l,E]:o,["",0]),u=c.filter(o=>o.completed),j=c.reduce((o,l)=>o+l.duration,0),y={totalSessions:c.length,completedSessions:u.length,totalTime:j,averageSessionTime:j/c.length,completionRate:u.length/c.length*100,...a[1]>0&&{bestDay:{date:J(new Date(a[0]),"dd/MM/yyyy"),sessions:a[1]}}};e(y)}catch(m){console.error("Error fetching pomodoro stats:",m),f(m instanceof Error?m.message:"Error al cargar las estadísticas")}finally{d(!1)}})()},[p,t]),{stats:i,loading:h,error:g}},Z=(t,i)=>{const[e,h]=n.useState(null),[d,g]=n.useState(!0),[f,p]=n.useState(null),{user:N}=M();return n.useEffect(()=>{(async()=>{if(h(null),!!N){g(!0),p(null);try{const r=[],x=new Date(t);for(;x<=i;)r.push(C(x)),x.setDate(x.getDate()+1);const S=(await Promise.all(r.map(a=>_(R(I,"pomodoro",`${N.uid}_${a}`))))).map((a,u)=>{const y=(a.exists()?a.data().sessions||[]:[]).filter(o=>o.completed).reduce((o,l)=>o+(l.duration||0),0)/60;return{date:r[u],minutes:y}});h({dailyStats:S})}catch(r){console.error("Error al cargar estadísticas:",r),p(r instanceof Error?r.message:"Error al cargar estadísticas")}finally{g(!1)}}})()},[N,t,i]),{stats:e,loading:d,error:f}},z=({dateRange:t})=>{const{user:i}=M(),{stats:e,loading:h,error:d}=Y(t);return i?h?s.jsxs(v,{children:[s.jsx(D,{children:s.jsxs(b,{children:["Estadísticas (",t==="week"?"Semana":"Mes",")"]})}),s.jsx(w,{children:s.jsx("div",{className:"flex items-center justify-center py-6",children:s.jsx("p",{className:"text-gray-500",children:"Cargando estadísticas..."})})})]}):d?s.jsxs(v,{children:[s.jsx(D,{children:s.jsxs(b,{children:["Estadísticas (",t==="week"?"Semana":"Mes",")"]})}),s.jsx(w,{children:s.jsx("div",{className:"text-red-500",children:"Error al cargar las estadísticas. Por favor, intenta de nuevo."})})]}):e?s.jsxs(v,{children:[s.jsx(D,{children:s.jsxs(b,{children:["Estadísticas ",t==="week"?"de la Semana":"del Mes"]})}),s.jsx(w,{children:s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:"text-sm text-gray-500",children:"Sesiones Totales"}),s.jsx("p",{className:"text-2xl font-bold",children:e.totalSessions})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:"text-sm text-gray-500",children:"Completadas"}),s.jsx("p",{className:"text-2xl font-bold",children:e.completedSessions})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:"text-sm text-gray-500",children:"Tiempo Total"}),s.jsx("p",{className:"text-2xl font-bold",children:$(Math.floor(e.totalTime/60))})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:"text-sm text-gray-500",children:"Promedio/Sesión"}),s.jsx("p",{className:"text-2xl font-bold",children:$(Math.floor(e.averageSessionTime/60))})]}),s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:"text-sm text-gray-500",children:"Completitud"}),s.jsxs("p",{className:"text-2xl font-bold",children:[e.completionRate.toFixed(1),"%"]})]}),e.bestDay&&s.jsxs("div",{className:"space-y-1",children:[s.jsx("p",{className:"text-sm text-gray-500",children:"Mejor Día"}),s.jsx("p",{className:"text-2xl font-bold",children:e.bestDay.sessions}),s.jsx("p",{className:"text-xs text-gray-400",children:e.bestDay.date})]})]})})]}):s.jsxs(v,{children:[s.jsx(D,{children:s.jsxs(b,{children:["Estadísticas (",t==="week"?"Semana":"Mes",")"]})}),s.jsx(w,{children:s.jsx("div",{className:"text-center py-4",children:s.jsx("p",{className:"text-gray-500",children:"No hay datos disponibles"})})})]}):null},ss=({selectedDate:t,goal:i=300})=>{const[e,h]=n.useState(k(t));n.useEffect(()=>{h(k(t))},[t]);const d=n.useMemo(()=>k(e),[e]),g=n.useMemo(()=>K(e),[e]),{stats:f,loading:p}=Z(d,g),N=n.useMemo(()=>{const r={};return f==null||f.dailyStats.forEach(({date:x,minutes:c})=>{r[x]=c}),r},[f]),m=r=>{const x=C(r.date),c=N[x]||0,S=Math.min(c/i,1),a=28,u=3,j=(a-u)/2,y=2*Math.PI*j,o=y-S*y,l=c>=i;return s.jsxs("div",{className:"relative flex items-center justify-center w-7 h-7",children:[s.jsxs("svg",{width:a,height:a,className:"absolute",children:[s.jsx("circle",{cx:a/2,cy:a/2,r:j,stroke:l?"#fecaca":"#e5e7eb",strokeWidth:u,fill:"none"}),s.jsx("circle",{cx:a/2,cy:a/2,r:j,stroke:l?"#f87171":"#9ca3af",strokeWidth:u,fill:"none",strokeDasharray:y,strokeDashoffset:o,strokeLinecap:"round",style:{transform:"rotate(-90deg)",transformOrigin:"50% 50%"}})]}),s.jsx("span",{className:"text-[10px] font-medium z-10",children:r.date.getDate()})]})};return s.jsxs(v,{className:"w-full",children:[s.jsxs(D,{className:"flex flex-col items-center gap-2",children:[s.jsx(U,{className:"w-5 h-5 text-red-600"}),s.jsx(b,{className:"text-center",children:"Historial Mensual"})]}),s.jsxs(w,{className:"relative p-4",children:[p&&s.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/50 z-10",children:s.jsx(V,{className:"w-6 h-6 animate-spin"})}),s.jsx(Q,{month:e,onMonthChange:h,showOutsideDays:!0,components:{DayContent:m},className:"p-0 w-full"})]})]})};function Ss(){const[t,i]=n.useState(new Date),{user:e}=M();return e?s.jsxs(L,{children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Pomodoro Timer"}),s.jsx("p",{className:"text-gray-500",children:"Gestiona tus sesiones de trabajo y productividad"})]}),s.jsx(X,{selectedDate:t,onChange:i}),s.jsxs("div",{className:"grid gap-6 md:grid-cols-[1fr_300px]",children:[s.jsxs("div",{className:"space-y-6",children:[s.jsx(H,{selectedDate:t}),s.jsx(z,{dateRange:"week"}),s.jsx(z,{dateRange:"month"})]}),s.jsx("div",{className:"space-y-6",children:s.jsx(ss,{selectedDate:t})})]})]}):s.jsx(L,{children:s.jsx("div",{className:"text-center py-8",children:s.jsx("h2",{className:"text-xl font-semibold",children:"Inicia sesión para ver tus estadísticas"})})})}export{Ss as default};
