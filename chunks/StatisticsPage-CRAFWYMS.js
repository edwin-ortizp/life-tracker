import{j as e}from"./ui-vendor-DGxrBG5B.js";import{r as R}from"./react-vendor-B6CgFIIW.js";import{C as v,a as k,b as w,c as D,P as Ae}from"./PageLayout-Db-iUE0_.js";import{D as ae}from"./DateSelector-Dbzo5HuL.js";import{T as Re,a as Oe,b as oe,c as ne}from"./tabs-1U-zLMBH.js";import{c as de,u as me,d as $,B as q}from"../assets/index-DHFvqX11.js";import{R as G,k as ue,m as xe,Y as he,n as V,o as W,j as Ce,ay as pe,al as ge,D as je,T as ye,az as fe,P as Ne,p as be,q as ve,b as ke}from"./chart-vendor-DS0HZnUf.js";import{H as B}from"./index-NpWkTw_R.js";import{c as Le,g as le}from"./index-DuocBWKh.js";import{f as Ee,e as E,T as J,q as _,l as z,w as y,m as Y,h as O}from"./firebase-B1tATv4n.js";import{g as Q,e as Ie}from"./dates-LQzD1DbF.js";import{j as U,i as we,h as He}from"./utils-vendor-zid8MmOQ.js";import{D as Fe}from"./index-Dwg2_Hpq.js";import{g as _e}from"./ai-C3vKLOoL.js";import{P as I}from"./progress-Bq-V2CIq.js";const Z=({data:t,className:s})=>e.jsx("div",{className:de("h-24",s),children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(ue,{data:t,margin:{left:-20,right:10},children:[e.jsx(xe,{dataKey:"label",tick:{fontSize:10}}),e.jsx(he,{domain:[0,10],tick:{fontSize:10}}),e.jsx(V,{}),e.jsx(W,{type:"monotone",dataKey:"value",stroke:"#f59e0b"})]})})}),ze=(t,s)=>{const n=B.length,r=t!=null&&t.habits?Object.entries(t.habits).filter(([a,o])=>a.endsWith(`_${s}`)&&o).map(([a])=>{const o=parseInt(a.split("_")[0]);return B.find(i=>i.id===o)}).filter(Boolean):[],m=r.length,d=B.filter(a=>!r.some(o=>(o==null?void 0:o.id)===a.id)),c=["morning","afternoon","night","anytime"].map(a=>{const o=d.filter(i=>i.timeOfDay===a);return{timeOfDay:a,habits:o.map(i=>({id:i.id,name:i.name,icon:i.icon,goal:i.goal}))}}).filter(a=>a.habits.length>0);return{completed:m,total:n,incompletedByTimeOfDay:c}},Ke=t=>{if(!(t!=null&&t.drinks)||!Array.isArray(t.drinks))return[];const s=new Map;return t.drinks.forEach(n=>{const r=n.type,m=n.amount||0;if(s.has(r)){const d=s.get(r);s.set(r,{amount:d.amount+m,count:d.count+1})}else s.set(r,{amount:m,count:1})}),Array.from(s.entries()).map(([n,r])=>({type:n,amount:r.amount,count:r.count})).sort((n,r)=>r.amount-n.amount)},We=t=>{if(!(t!=null&&t.moods)||!Array.isArray(t.moods))return{count:0,average:0,highest:0,lowest:0,details:[]};const s=t.moods,n=s.length;if(n===0)return{count:0,average:0,highest:0,lowest:0,details:[]};const r=Le(s),m=s.map(o=>o.value??le(o.text)),d=Math.max(...m),c=Math.min(...m),a=s.map(o=>({emoji:o.emoji,text:o.text,value:o.value??le(o.text),time:o.time}));return{count:n,average:r,highest:d,lowest:c,details:a}},Be=async(t,s)=>{const n=Q(s),[r,m]=n.split("-");console.log("🔧 Testing Firestore permissions for:",t,n);const d=[{name:"journal",id:`${t}_${n}`},{name:"moods",id:`${t}_${n}`},{name:"water",id:`${t}_${n}`},{name:"exercises",id:`${t}_${n}`},{name:"pomodoro",id:`${t}_${n}`},{name:"habits",id:`${t}_${r}-${m}`},{name:"negative-habits",id:`${t}_${r}-${m}`}];for(const c of d)try{console.log(`🔍 Testing collection: ${c.name} with ID: ${c.id}`);const a=await Ee(E($,c.name,c.id));console.log(`✅ ${c.name}: Success - exists: ${a.exists()}`)}catch(a){console.error(`❌ ${c.name}: Error -`,a)}try{console.log("🔍 Testing tasks collection with query");const c=J.fromDate(U(s)),a=J.fromDate(we(s)),o=_(z($,"tasks"),y("userId","==",t),y("completed","==",!0),y("updatedAt",">=",c),y("updatedAt","<=",a)),i=await Y(o);console.log(`✅ tasks (completed today): Success - found ${i.size} documents`);const j=_(z($,"tasks"),y("userId","==",t),y("dueDate",">=",c),y("dueDate","<=",a)),x=await Y(j);console.log(`✅ tasks (due today): Success - found ${x.size} documents`);const u=_(z($,"tasks"),y("userId","==",t),y("completed","==",!1)),f=await Y(u);console.log(`✅ tasks (incomplete): Success - found ${f.size} documents`)}catch(c){console.error("❌ tasks: Error -",c)}},qe={journal:{words:0},mood:{count:0,average:0,highest:0,lowest:0,details:[]},habits:{completed:0,total:B.length,incompletedByTimeOfDay:[]},negativeHabits:{count:0},exercise:{minutes:0},tasks:{completed:0,todayPlanned:0,pending:0,overdue:0},pomodoro:{count:0,expectedMinutes:0,workMinutes:0,completionRate:0,averageSessionLength:0},water:{intake:0,drinkDetails:[]}},De=(t,s,n)=>{const r=Q(s),[m,d]=r.split("-"),c=J.fromDate(U(s)),a=J.fromDate(we(s));console.log("🔍 createDayListeners - uid:",t),console.log("🔍 createDayListeners - date:",s),console.log("🔍 createDayListeners - dateStr:",r);const o=E($,"journal",`${t}_${r}`),i=E($,"moods",`${t}_${r}`),j=E($,"water",`${t}_${r}`),x=E($,"exercises",`${t}_${r}`),u=E($,"pomodoro",`${t}_${r}`),f=E($,"habits",`${t}_${m}-${d}`),P=E($,"negative-habits",`${t}_${m}-${d}`);console.log("🔍 Pomodoro document ID will be:",`${t}_${r}`);let S=null,p=null,h=null,T=null,g=null,C=null,H=null,F=[],L=[],M=[];const N=()=>{const l=Je(s,r,S,p,h,T,g,C,H,F,L,M);n(l)},b=[];b.push(O(o,l=>{S=l.exists()?l.data():null,N()},l=>console.error("❌ Journal listener error:",l))),b.push(O(i,l=>{p=l.exists()?l.data():null,N()},l=>console.error("❌ Mood listener error:",l))),b.push(O(j,l=>{h=l.exists()?l.data():null,N()},l=>console.error("❌ Water listener error:",l))),b.push(O(x,l=>{T=l.exists()?l.data():null,N()},l=>console.error("❌ Exercise listener error:",l))),b.push(O(u,l=>{var A;if(console.log("🔍 Pomodoro listener - Document ID:",l.id),console.log("🔍 Pomodoro listener - Document exists:",l.exists()),console.log("🔍 Pomodoro listener - Full document data:",l.data()),g=l.exists()?l.data():null,console.log("🍅 Pomodoro listener - processed data:",g),g){if(console.log("🍅 Pomodoro listener - keys:",Object.keys(g)),console.log("🍅 Pomodoro listener - count:",g.count),console.log("🍅 Pomodoro listener - sessions:",((A=g.sessions)==null?void 0:A.length)||0,"sessions"),console.log("🍅 Pomodoro listener - sessions data:",g.sessions),g.sessions){const te=g.sessions.reduce((Te,Me)=>Te+(Me.duration||0),0);console.log("🍅 Pomodoro listener - total duration (seconds):",te,"minutes:",Math.round(te/60))}}else console.log("❌ Pomodoro listener - No data found for document");N()},l=>console.error("❌ Pomodoro listener error:",l))),b.push(O(f,l=>{C=l.exists()?l.data():null,N()},l=>console.error("❌ Habit listener error:",l))),b.push(O(P,l=>{H=l.exists()?l.data():null,N()},l=>console.error("❌ Negative habit listener error:",l)));const K=_(z($,"tasks"),y("userId","==",t),y("completed","==",!0),y("updatedAt",">=",c),y("updatedAt","<=",a));b.push(O(K,l=>{F=l.docs.map(A=>({id:A.id,...A.data()})),N()},l=>console.error("❌ Task listener error (completed today):",l)));const $e=_(z($,"tasks"),y("userId","==",t),y("dueDate",">=",c),y("dueDate","<=",a));b.push(O($e,l=>{L=l.docs.map(A=>({id:A.id,...A.data()})),N()},l=>console.error("❌ Task listener error (due today):",l)));const Pe=_(z($,"tasks"),y("userId","==",t),y("completed","==",!1));return b.push(O(Pe,l=>{M=l.docs.map(A=>({id:A.id,...A.data()})),N()},l=>console.error("❌ Task listener error (incomplete):",l))),b},Je=(t,s,n,r,m,d,c,a,o,i,j,x)=>{var S,p;const u=U(t);let f=0,P=0;return x.forEach(h=>{h.dueDate&&typeof h.dueDate.toDate=="function"&&U(h.dueDate.toDate())<u?P++:f++}),{journal:{words:n!=null&&n.text?n.text.split(/\s+/).filter(Boolean).length:0},mood:We(r),water:{intake:(m==null?void 0:m.totalWater)||0,drinkDetails:Ke(m)},exercise:{minutes:((S=d==null?void 0:d.summary)==null?void 0:S.totalDuration)||0},pomodoro:(()=>{var M;const h=c;console.log("🍅 Pomodoro data for",s,":",h);const T=(h==null?void 0:h.count)||0;let g=0;h!=null&&h.sessions&&Array.isArray(h.sessions)&&(g=h.sessions.reduce((N,b)=>{const K=b.duration?Math.round(b.duration/60):0;return console.log("🍅 Session duration:",b.duration,"seconds =",K,"minutes"),N+K},0)),console.log("🍅 Pomodoro extracted - count:",T,"workMinutes:",g),console.log("🍅 Sessions found:",((M=h==null?void 0:h.sessions)==null?void 0:M.length)||0),console.log("🍅 Available keys in data:",h?Object.keys(h):"no data");const C=300,H=Math.min(100,g/C*100),F=T>0?g/T:0,L={count:T,expectedMinutes:C,workMinutes:g,completionRate:parseFloat(H.toFixed(1)),averageSessionLength:parseFloat(F.toFixed(1))};return console.log("🍅 Final pomodoro result:",L),L})(),habits:ze(a,s),negativeHabits:{count:(p=o==null?void 0:o.habits)!=null&&p[s]?Object.keys(o.habits[s]).length:0},tasks:{completed:i.length,todayPlanned:j.length,pending:f,overdue:P}}},ee=t=>{const{user:s}=me(),[n,r]=R.useState(qe),[m,d]=R.useState(!0);return R.useEffect(()=>{if(!s){console.log("❌ useDailySummary - No user authenticated"),d(!1);return}console.log("🚀 useDailySummary - Setting up listeners for user:",s.uid,"date:",t),d(!0),Be(s.uid,t);const a=i=>{r(i),d(!1)},o=De(s.uid,t,a);return()=>{console.log("🧹 Cleaning up listeners"),o.forEach(i=>i())}},[s,t]),{summary:n,loading:m,refetch:()=>{console.log("🔄 Refetch requested - listeners will automatically update")}}};function Se({className:t,...s}){return e.jsx("div",{className:de("animate-pulse rounded-md bg-muted",t),...s})}const Qe=({date:t})=>{const{summary:s,loading:n,refetch:r}=ee(t),m=a=>{var o;return((o=Fe[a])==null?void 0:o.name)||a},d=s.mood.details?s.mood.details.map(a=>({label:a.time,value:a.value})):[],c=Object.values(s).some(a=>Object.values(a).some(o=>typeof o=="number"&&o>0));return e.jsxs(v,{children:[e.jsxs(k,{className:"flex flex-row items-center justify-between",children:[e.jsx(w,{children:"Resumen Diario"}),e.jsx(q,{size:"sm",variant:"outline",onClick:r,disabled:n,children:"Recalcular"})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Palabras Diario"}),e.jsx("p",{className:"font-bold",children:s.journal.words})]}),"          ",e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Hábitos"}),e.jsxs("p",{className:"font-bold",children:[s.habits.completed,"/",s.habits.total]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[(s.habits.completed/s.habits.total*100).toFixed(0),"% completado"]})]}),"          ",e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ánimos"}),e.jsx("p",{className:"font-bold",children:s.mood.count}),s.mood.count>0&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.jsxs("div",{children:["Promedio: ",s.mood.average,"/10"]}),e.jsxs("div",{children:["Rango: ",s.mood.lowest,"-",s.mood.highest]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Min Ejercicio"}),e.jsx("p",{className:"font-bold",children:s.exercise.minutes})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Hidratación (ml)"}),e.jsx("p",{className:"font-bold",children:s.water.intake}),s.water.drinkDetails&&s.water.drinkDetails.length>0&&e.jsxs("div",{className:"mt-1 text-xs text-muted-foreground",children:["                ",s.water.drinkDetails.slice(0,2).map(a=>e.jsxs("div",{children:[m(a.type),": ",a.amount,"ml (",a.count,"x)"]},a.type)),s.water.drinkDetails.length>2&&e.jsxs("div",{children:["+",s.water.drinkDetails.length-2," más"]})]})]})]}),e.jsx("div",{className:"h-32",children:n?e.jsx(Se,{className:"w-full h-full"}):d.length>0&&e.jsx(Z,{data:d,className:"h-full"})}),!n&&s.water.drinkDetails&&s.water.drinkDetails.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-medium mb-2 text-muted-foreground",children:"Detalle de Bebidas"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:["              ",s.water.drinkDetails.map(a=>e.jsxs("div",{className:"flex justify-between p-2 rounded bg-muted/50",children:[e.jsx("span",{className:"font-medium",children:m(a.type)}),e.jsxs("span",{children:[a.amount,"ml (",a.count,"x)"]})]},a.type))]})]}),!n&&s.habits.incompletedByTimeOfDay&&s.habits.incompletedByTimeOfDay.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-medium mb-2 text-muted-foreground",children:"Hábitos Pendientes por Momento"}),e.jsx("div",{className:"space-y-3",children:s.habits.incompletedByTimeOfDay.map(a=>e.jsxs("div",{className:"border rounded p-2",children:[e.jsx("h5",{className:"text-xs font-medium mb-1 capitalize text-gray-600",children:a.timeOfDay==="morning"?"Mañana":a.timeOfDay==="afternoon"?"Tarde":a.timeOfDay==="night"?"Noche":"Cualquier momento"}),e.jsx("div",{className:"grid grid-cols-1 gap-1",children:a.habits.map(o=>e.jsxs("div",{className:"flex items-center gap-2 text-xs bg-red-50 p-1 rounded",children:[e.jsx("span",{children:o.icon}),e.jsx("span",{className:"flex-1",children:o.name}),e.jsx("span",{className:"text-gray-500 text-[10px]",children:o.goal})]},o.id))})]},a.timeOfDay))})]}),!n&&!c&&e.jsx("p",{className:"text-center text-sm text-muted-foreground",children:"No hay datos registrados para este día."}),s.mood.details&&s.mood.details.length>0&&e.jsxs("div",{className:"border rounded p-3",children:[e.jsx("h4",{className:"text-sm font-medium mb-2 text-muted-foreground",children:"Estados de Ánimo del Día"}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:s.mood.details.map((a,o)=>e.jsxs("div",{className:"flex items-center gap-2 text-xs bg-blue-50 p-2 rounded",children:[e.jsx("span",{className:"text-lg",children:a.emoji}),e.jsx("span",{className:"flex-1",children:a.text}),e.jsxs("span",{className:"text-sm font-medium text-blue-600",children:[a.value,"/10"]}),e.jsx("span",{className:"text-gray-500 text-[10px]",children:a.time})]},o))}),e.jsxs("div",{className:"mt-2 text-xs text-muted-foreground text-center",children:["Promedio del día: ",s.mood.average,"/10"]})]})]})]})},X={journal:{words:0},mood:{count:0,average:0,highest:0,lowest:0},habits:{completed:0,total:18,incompletedByTimeOfDay:[]},negativeHabits:{count:0},exercise:{minutes:0},tasks:{completed:0,todayPlanned:0,pending:0,overdue:0},pomodoro:{count:0,expectedMinutes:0,workMinutes:0,completionRate:0,averageSessionLength:0},water:{intake:0,drinkDetails:[]}},se=t=>{const{user:s}=me(),[n,r]=R.useState({daily:[],totals:{...X}}),[m,d]=R.useState(!0);return R.useEffect(()=>{if(!s){console.log("❌ useWeeklySummary - No user authenticated"),d(!1);return}console.log("🚀 useWeeklySummary - Setting up listeners for user:",s.uid,"start date:",t),d(!0);const a=[];for(let x=0;x<7;x++){const u=new Date(t);u.setDate(t.getDate()+x),a.push(u)}const o={},i=()=>{const x=[],u={...X};a.forEach(P=>{const S=Q(P),p=o[S]||{...X};x.push({date:S,summary:p}),u.journal.words+=p.journal.words,u.mood.count+=p.mood.count,u.habits.completed+=p.habits.completed,u.negativeHabits.count+=p.negativeHabits.count,u.exercise.minutes+=p.exercise.minutes,u.water.intake+=p.water.intake,u.tasks.completed+=p.tasks.completed,u.tasks.todayPlanned+=p.tasks.todayPlanned,u.tasks.pending+=p.tasks.pending,u.tasks.overdue+=p.tasks.overdue,u.pomodoro.count+=p.pomodoro.count,u.pomodoro.workMinutes+=p.pomodoro.workMinutes});const f=300*7;u.pomodoro.expectedMinutes=f,u.pomodoro.completionRate=Math.min(100,u.pomodoro.workMinutes/f*100),u.pomodoro.averageSessionLength=u.pomodoro.count>0?u.pomodoro.workMinutes/u.pomodoro.count:0,u.pomodoro.completionRate=parseFloat(u.pomodoro.completionRate.toFixed(1)),u.pomodoro.averageSessionLength=parseFloat(u.pomodoro.averageSessionLength.toFixed(1)),console.log("📊 Updated weekly summary:",{daily:x.length,totals:u}),r({daily:x,totals:u}),d(!1)},j=[];return a.forEach(x=>{const u=Q(x),f=S=>{o[u]=S,i()},P=De(s.uid,x,f);j.push(...P)}),()=>{console.log("🧹 Cleaning up weekly listeners"),j.forEach(x=>x())}},[s,t]),{summary:n,loading:m,refetch:()=>{console.log("🔄 Weekly refetch requested - listeners will automatically update")}}},Ue=({startDate:t})=>{const{summary:s,loading:n,refetch:r}=se(t),m=s.daily.map(c=>({date:c.date.slice(5),pomodoros:c.summary.pomodoro.count,tasks:c.summary.tasks.completed,habits:c.summary.habits.completed})),d=s.daily.some(c=>Object.values(c.summary).some(a=>Object.values(a).some(o=>typeof o=="number"&&o>0)));return e.jsxs(v,{children:[e.jsxs(k,{className:"flex flex-row items-center justify-between",children:[e.jsx(w,{children:"Resumen Semanal"}),e.jsx(q,{size:"sm",variant:"outline",onClick:r,disabled:n,children:"Recalcular"})]}),e.jsxs(D,{className:"space-y-4",children:[e.jsx("div",{className:"h-64",children:n?e.jsx(Se,{className:"w-full h-full"}):e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(ue,{data:m,children:[e.jsx(xe,{dataKey:"date"}),e.jsx(he,{}),e.jsx(V,{}),e.jsx(W,{dataKey:"pomodoros",stroke:"#3b82f6",name:"Pomodoros"}),e.jsx(W,{dataKey:"tasks",stroke:"#10b981",name:"Tareas"}),e.jsx(W,{dataKey:"habits",stroke:"#a855f7",name:"Hábitos"})]})})}),!n&&!d&&e.jsx("p",{className:"text-center text-sm text-muted-foreground",children:"No hay datos registrados para esta semana."})]})]})},re=t=>t&&"daily"in t&&"totals"in t,ce=({data:t,date:s})=>{const[n,r]=R.useState(!1),[m,d]=R.useState(""),[c,a]=R.useState(!1),o="AIzaSyAW4Ot-z7OH4ZR3OeaN7vcbkEDlWpo1aMY",i=_e("statistics"),j=i!=null&&i.model?`https://generativelanguage.googleapis.com/v1beta/models/${i.model}:generateContent`:"",x=(i==null?void 0:i.prompt)??"Analiza mis registros y dame consejos.",u=i==null?void 0:i.params,f=t?re(t)?`Fecha: ${s}
Datos semanales:
${JSON.stringify(t.totals,null,2)}

Detalle diario:
${JSON.stringify(t.daily,null,2)}`:`Fecha: ${s}
Datos diarios:
${JSON.stringify(t,null,2)}`:`Fecha: ${s}
No hay datos disponibles.`,P=!t,S=`${x}

${f}`,p=async()=>{var T,g,C,H,F;if(!j||!t)return;r(!0);const h={contents:[{parts:[{text:S}]}],...u};console.log("🤖 AI Analysis Request:",{date:s,dataType:re(t)?"weekly":"daily",dataKeys:t?Object.keys(t):[],promptLength:S.length,requestBody:h});try{const M=await(await fetch(`${j}?key=${o}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)})).json();console.log("🤖 AI Response:",M);const N=((F=(H=(C=(g=(T=M==null?void 0:M.candidates)==null?void 0:T[0])==null?void 0:g.content)==null?void 0:C.parts)==null?void 0:H[0])==null?void 0:F.text)||"";N?(d(N),console.log("🤖 Analysis generated successfully")):(console.warn("🤖 No text in AI response:",M),d("No se pudo generar análisis"))}catch(L){console.error("🤖 API Error:",L),d("Error al consultar la API")}finally{r(!1)}};return e.jsxs(v,{children:[e.jsx(k,{children:e.jsx(w,{children:"Asistente IA"})}),"      ",e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(q,{onClick:p,disabled:n||!o||P,className:"flex items-center gap-2",children:[n&&e.jsx(Ce,{className:"w-4 h-4 animate-spin"}),n?"Analizando...":"Analizar"]}),e.jsx(q,{variant:"outline",size:"sm",onClick:()=>a(!c),children:c?"Ocultar Debug":"Mostrar Debug"})]}),c&&e.jsxs("div",{className:"bg-gray-100 p-3 rounded text-xs space-y-2",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Config:"})," ",i?"Encontrado":"No encontrado"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Model:"})," ",(i==null?void 0:i.model)||"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"API Key:"})," ",`${o.substring(0,10)}...`]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Params:"})," ",JSON.stringify(u,null,2)]}),e.jsx("div",{children:e.jsx("strong",{children:"Prompt base:"})}),e.jsx("div",{className:"bg-white p-2 rounded max-h-32 overflow-y-auto",children:x}),e.jsx("div",{children:e.jsx("strong",{children:"Summary data:"})}),e.jsx("div",{className:"bg-white p-2 rounded max-h-32 overflow-y-auto",children:f||"Vacío"}),e.jsx("div",{children:e.jsx("strong",{children:"Prompt completo:"})}),e.jsx("div",{className:"bg-white p-2 rounded max-h-32 overflow-y-auto",children:S})]}),m&&e.jsx("div",{className:"text-sm whitespace-pre-wrap",children:m}),!m&&P&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Registra datos para generar un análisis."})]})]})},Ge=({date:t})=>{const{summary:s}=ee(t),n=s.habits.total?s.habits.completed/s.habits.total*100:0,r=s.water.intake/2e3*100,m=s.pomodoro.completionRate,d=(n+r+m)/3,c=[{name:"Completadas",value:s.tasks.completed},{name:"Pendientes",value:s.tasks.pending+s.tasks.overdue}],a=["#10b981","#f97316"],o=s.mood.details?s.mood.details.map(i=>({label:i.time,value:i.value})):[];return e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-6",children:[e.jsxs(v,{className:"p-2",children:[e.jsxs(k,{className:"flex items-center gap-2 p-2 pb-1",children:[e.jsx("span",{className:"p-1 rounded bg-purple-500 text-white",children:e.jsx(pe,{className:"w-4 h-4"})}),e.jsx(w,{className:"text-sm",children:"Score General"})]}),e.jsxs(D,{className:"p-2 space-y-1",children:[e.jsxs("div",{className:"text-xl font-bold text-center",children:[d.toFixed(0),"%"]}),e.jsx(I,{value:d,className:"h-2"})]})]}),e.jsxs(v,{className:"p-2",children:[e.jsxs(k,{className:"flex items-center gap-2 p-2 pb-1",children:[e.jsx("span",{className:"p-1 rounded bg-green-600 text-white",children:e.jsx(ge,{className:"w-4 h-4"})}),e.jsx(w,{className:"text-sm",children:"Hábitos"})]}),e.jsxs(D,{className:"p-2 space-y-1",children:[e.jsxs("div",{className:"text-xl font-bold text-center",children:[s.habits.completed,"/",s.habits.total]}),e.jsx(I,{value:n,className:"h-2"})]})]}),e.jsxs(v,{className:"p-2",children:[e.jsxs(k,{className:"flex items-center gap-2 p-2 pb-1",children:[e.jsx("span",{className:"p-1 rounded bg-blue-600 text-white",children:e.jsx(je,{className:"w-4 h-4"})}),e.jsx(w,{className:"text-sm",children:"Hidratación"})]}),e.jsxs(D,{className:"p-2 space-y-1",children:[e.jsxs("div",{className:"text-xl font-bold text-center",children:[s.water.intake,"ml"]}),e.jsx(I,{value:Math.min(r,100),className:"h-2"})]})]}),e.jsxs(v,{className:"p-2",children:[e.jsxs(k,{className:"flex items-center gap-2 p-2 pb-1",children:[e.jsx("span",{className:"p-1 rounded bg-red-600 text-white",children:e.jsx(ye,{className:"w-4 h-4"})}),e.jsx(w,{className:"text-sm",children:"Pomodoros"})]}),e.jsxs(D,{className:"p-2 space-y-1",children:[e.jsxs("div",{className:"text-xl font-bold text-center",children:[s.pomodoro.workMinutes," / ",s.pomodoro.expectedMinutes," min"]}),e.jsx(I,{value:m,className:"h-2"})]})]}),e.jsxs(v,{className:"p-2",children:[e.jsxs(k,{className:"flex items-center gap-2 p-2 pb-1",children:[e.jsx("span",{className:"p-1 rounded bg-orange-500 text-white",children:e.jsx(fe,{className:"w-4 h-4"})}),e.jsx(w,{className:"text-sm",children:"Tareas"})]}),e.jsx(D,{className:"p-2",children:e.jsx("div",{className:"h-20",children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(Ne,{children:[e.jsx(be,{data:c,dataKey:"value",nameKey:"name",innerRadius:20,outerRadius:40,children:c.map((i,j)=>e.jsx(ve,{fill:a[j%a.length]},`cell-${j}`))}),e.jsx(V,{})]})})})})]}),o.length>0&&e.jsxs(v,{className:"p-2 col-span-full sm:col-auto",children:[e.jsxs(k,{className:"flex items-center gap-2 p-2 pb-1",children:[e.jsx("span",{className:"p-1 rounded bg-yellow-600 text-white",children:e.jsx(ke,{className:"w-4 h-4"})}),e.jsx(w,{className:"text-sm",children:"Ánimo"})]}),e.jsx(D,{className:"p-2",children:e.jsx(Z,{data:o})})]})]})},Ve=({startDate:t})=>{const{summary:s}=se(t),n=s.daily.length||1,r=s.totals.habits.completed/(n*s.totals.habits.total)*100,m=s.totals.water.intake/(2e3*n)*100,d=s.totals.pomodoro.completionRate,c=(r+m+d)/3,a=[{name:"Completadas",value:s.totals.tasks.completed},{name:"Pendientes",value:s.totals.tasks.pending+s.totals.tasks.overdue}],o=["#10b981","#f97316"],i=s.daily.map(j=>({label:j.date.slice(5),value:j.summary.mood.average}));return e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2 lg:grid-cols-6",children:[e.jsxs(v,{className:"p-2",children:[e.jsxs(k,{className:"flex items-center gap-2 p-2 pb-1",children:[e.jsx("span",{className:"p-1 rounded bg-purple-500 text-white",children:e.jsx(pe,{className:"w-4 h-4"})}),e.jsx(w,{className:"text-sm",children:"Score General"})]}),e.jsxs(D,{className:"p-2 space-y-1",children:[e.jsxs("div",{className:"text-xl font-bold text-center",children:[c.toFixed(0),"%"]}),e.jsx(I,{value:c,className:"h-2"})]})]}),e.jsxs(v,{className:"p-2",children:[e.jsxs(k,{className:"flex items-center gap-2 p-2 pb-1",children:[e.jsx("span",{className:"p-1 rounded bg-green-600 text-white",children:e.jsx(ge,{className:"w-4 h-4"})}),e.jsx(w,{className:"text-sm",children:"Hábitos"})]}),e.jsxs(D,{className:"p-2 space-y-1",children:[e.jsx("div",{className:"text-xl font-bold text-center",children:s.totals.habits.completed}),e.jsx(I,{value:r,className:"h-2"})]})]}),e.jsxs(v,{className:"p-2",children:[e.jsxs(k,{className:"flex items-center gap-2 p-2 pb-1",children:[e.jsx("span",{className:"p-1 rounded bg-blue-600 text-white",children:e.jsx(je,{className:"w-4 h-4"})}),e.jsx(w,{className:"text-sm",children:"Hidratación"})]}),e.jsxs(D,{className:"p-2 space-y-1",children:[e.jsxs("div",{className:"text-xl font-bold text-center",children:[s.totals.water.intake,"ml"]}),e.jsx(I,{value:Math.min(m,100),className:"h-2"})]})]}),e.jsxs(v,{className:"p-2",children:[e.jsxs(k,{className:"flex items-center gap-2 p-2 pb-1",children:[e.jsx("span",{className:"p-1 rounded bg-red-600 text-white",children:e.jsx(ye,{className:"w-4 h-4"})}),e.jsx(w,{className:"text-sm",children:"Pomodoros"})]}),e.jsxs(D,{className:"p-2 space-y-1",children:[e.jsxs("div",{className:"text-xl font-bold text-center",children:[s.totals.pomodoro.workMinutes," / ",s.totals.pomodoro.expectedMinutes," min"]}),e.jsx(I,{value:d,className:"h-2"})]})]}),e.jsxs(v,{className:"p-2",children:[e.jsxs(k,{className:"flex items-center gap-2 p-2 pb-1",children:[e.jsx("span",{className:"p-1 rounded bg-orange-500 text-white",children:e.jsx(fe,{className:"w-4 h-4"})}),e.jsx(w,{className:"text-sm",children:"Tareas"})]}),e.jsx(D,{className:"p-2",children:e.jsx("div",{className:"h-20",children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(Ne,{children:[e.jsx(be,{data:a,dataKey:"value",nameKey:"name",innerRadius:20,outerRadius:40,children:a.map((j,x)=>e.jsx(ve,{fill:o[x%o.length]},`cell-${x}`))}),e.jsx(V,{})]})})})})]}),i.length>0&&e.jsxs(v,{className:"p-2 col-span-full sm:col-auto",children:[e.jsxs(k,{className:"flex items-center gap-2 p-2 pb-1",children:[e.jsx("span",{className:"p-1 rounded bg-yellow-600 text-white",children:e.jsx(ke,{className:"w-4 h-4"})}),e.jsx(w,{className:"text-sm",children:"Ánimo"})]}),e.jsx(D,{className:"p-2",children:e.jsx(Z,{data:i})})]})]})},ie=t=>He(t,"PP",{locale:Ie}),us=()=>{const[t,s]=R.useState(new Date),[n,r]=R.useState(()=>{const c=new Date;return c.setDate(c.getDate()-c.getDay()),c}),{summary:m}=ee(t),{summary:d}=se(n);return e.jsxs(Ae,{children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Estadísticas"})}),e.jsxs(Re,{defaultValue:"daily",className:"space-y-4",children:[e.jsxs(Oe,{children:[e.jsx(oe,{value:"daily",children:"Diario"}),e.jsx(oe,{value:"weekly",children:"Semanal"})]}),e.jsxs(ne,{value:"daily",className:"space-y-4",children:[e.jsx(ae,{selectedDate:t,onChange:s}),e.jsx(Ge,{date:t}),e.jsx(Qe,{date:t}),e.jsx(ce,{data:m,date:ie(t)})]}),e.jsxs(ne,{value:"weekly",className:"space-y-4",children:[e.jsx(ae,{selectedDate:n,onChange:r}),e.jsx(Ve,{startDate:n}),e.jsx(Ue,{startDate:n}),e.jsx(ce,{data:d,date:`Semana del ${ie(n)}`})]})]})]})};export{us as default};
