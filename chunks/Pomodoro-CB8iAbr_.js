import{j as e}from"./ui-vendor-DGxrBG5B.js";import{r as i}from"./react-vendor-B6CgFIIW.js";import{C as G,c as X}from"./PageLayout-CQ502YZp.js";import{u as V,d as O,B as $}from"../assets/index-CZllZBvh.js";import{e as k,h as ee,j as I,k as R}from"./firebase-B1tATv4n.js";import{g as L,c as A}from"./dates-LQzD1DbF.js";import{t as le,x as me,y as de,z as ue,w as fe,j as K,A as pe,E as xe,F as ge,G as he,H as _,J as je,M as Ne}from"./chart-vendor-DS0HZnUf.js";import{A as ve,a as Te,b as be,c as we}from"./accordion-OgLUcSe4.js";import{P as te}from"./progress-CKnY0O-_.js";import{D as ye,a as Se,b as De,c as Pe,d as Ce}from"./dialog-Ch6bvtCJ.js";import{I as J}from"./input-DyWC7sCN.js";import{C as Ee}from"./checkbox-Byik9ELG.js";import{L as z}from"./label-BZ2qu7W8.js";import{a as Y}from"./formatTime-BWrFzjSW.js";import{A as Me,a as Oe,b as ke,c as $e,d as Ae,e as Ie,f as He,g as Re}from"./alert-dialog-Di4Hu8JE.js";const F=crypto.randomUUID(),E=30*60,ze=({onComplete:t,onCancel:r,selectedDate:x})=>{const{user:f}=V(),[n,d]=i.useState(E),[s,u]=i.useState(!1),[h,j]=i.useState(null),[w,y]=i.useState(!1),g=i.useRef(),c=i.useRef(!1),o=x?L(x):L(new Date),a=i.useCallback(()=>{g.current&&(cancelAnimationFrame(g.current),g.current=void 0)},[]),l=i.useCallback(()=>{c.current||(c.current=!0,a(),d(E),u(!1),j(null),y(!1),setTimeout(()=>{c.current=!1},100))},[a]),m=i.useCallback(v=>{const p=(Date.now()-v)/1e3;return Math.max(0,E-p)},[]);i.useEffect(()=>{if(!s||!h||w){a();return}const v=h.startTime.timestamp,p=()=>{const T=(Date.now()-v)/1e3,S=Math.max(0,E-T);if(S<=0){a(),h.deviceId===F&&t(E),l();return}d(S),g.current=requestAnimationFrame(p)};return g.current=requestAnimationFrame(p),a},[s,h,w,a,l,t,m]),i.useEffect(()=>{if(!f)return;const v=k(O,"pomodoro",`${f.uid}_${o}`),p=ee(v,T=>{if(!T.exists()){l();return}const D=T.data().activePomodoro;if(!D||w){l();return}if(D.deviceId!==F&&!s)return;const P=m(D.startTime.timestamp);if(P<=0){I(v,{activePomodoro:null},{merge:!0}),D.deviceId===F&&t(E),l();return}j(D),d(P),u(!0)});return()=>{p(),a()}},[f,o,s,w,m,a,l,t]);const N=i.useCallback(async()=>{if(!f||s)return;const v=new Date,T={startTime:A(x||v,v.getHours(),v.getMinutes()),duration:E,deviceId:F};j(T),d(E),u(!0),y(!1);try{const S=k(O,"pomodoro",`${f.uid}_${o}`);await I(S,{activePomodoro:T,updatedAt:R()},{merge:!0})}catch(S){console.error("Error starting timer:",S),l()}},[f,o,s,x,l]),b=i.useCallback(async()=>{if(!(!f||!h||w))try{y(!0);const v=k(O,"pomodoro",`${f.uid}_${o}`);await I(v,{activePomodoro:null,updatedAt:R()},{merge:!0});const p=E-n;p>0&&r(p),l()}catch(v){console.error("Error stopping timer:",v),y(!1)}},[f,o,h,w,n,r,l]);return{time:n,isActive:s,formattedTime:(v=>{const p=Math.floor(v/60),T=Math.floor(v%60);return`${p<10?"0":""}${p}:${T<10?"0":""}${T}`})(n),startTimer:N,stopTimer:b}},Fe=t=>{const[r,x]=i.useState(null),[f,n]=i.useState("idle"),[d,s]=i.useState(null),{user:u}=V(),h=t?L(t):L(new Date);i.useEffect(()=>{if(!u)return;const c=k(O,"pomodoro",`${u.uid}_${h}`),o=ee(c,a=>{if(a.exists()){const l=a.data(),m=l.sessions.filter(N=>N.completed).length;x({...l,count:m}),n("saved")}else x({userId:u.uid,date:h,count:0,sessions:[],updatedAt:null}),n("idle")},a=>{console.error("Pomodoro - Error en snapshot:",a),s(a.message),n("error")});return()=>o()},[u,h]);const j=async(c={})=>{var o;if(!(!u||!r)){n("saving"),s(null);try{const a=t||new Date,l=new Date,m=A(a,l.getHours(),l.getMinutes()),N=new Date(l.getTime()-30*60*1e3),b=A(a,N.getHours(),N.getMinutes()),C={startTime:{timestamp:b.timestamp,utcOffset:b.utcOffset,formatted:b.formatted},endTime:{timestamp:m.timestamp,utcOffset:m.utcOffset,formatted:m.formatted},duration:30*60,completed:!0};(o=c.description)!=null&&o.trim()&&(C.description=c.description.trim());const v=[...r.sessions,C].sort((P,H)=>H.startTime.timestamp-P.startTime.timestamp),{activePomodoro:p,...T}=r,S={...T,count:v.filter(P=>P.completed).length,sessions:v,updatedAt:R()},D=k(O,"pomodoro",`${u.uid}_${h}`);await I(D,S),n("saved")}catch(a){console.error("Pomodoro - Error al agregar sesi√≥n manual:",a),s(a instanceof Error?a.message:"Error al guardar"),n("error")}}},w=async(c,o,a={})=>{var l;if(!(!u||!r)){n("saving"),s(null);try{const m=t||new Date,N=new Date,b=A(m,N.getHours(),N.getMinutes()),C=new Date(N.getTime()-c*1e3),v=A(m,C.getHours(),C.getMinutes()),p={startTime:{timestamp:v.timestamp,utcOffset:v.utcOffset,formatted:v.formatted},endTime:{timestamp:b.timestamp,utcOffset:b.utcOffset,formatted:b.formatted},duration:c,completed:o};(l=a.description)!=null&&l.trim()&&(p.description=a.description.trim());const T=[...r.sessions,p],S=T.filter(U=>U.completed).length,{activePomodoro:D,...P}=r,H={...P,count:S,sessions:T,updatedAt:R()},B=k(O,"pomodoro",`${u.uid}_${h}`);await I(B,H),n("saved")}catch(m){console.error("Pomodoro - Error al guardar:",m),s(m instanceof Error?m.message:"Error al guardar"),n("error")}}},y=async c=>{if(!(!u||!r)){n("saving"),s(null);try{const o=r.sessions.filter(b=>b.startTime.timestamp!==c.startTime.timestamp),{activePomodoro:a,...l}=r,m={...l,count:o.filter(b=>b.completed).length,sessions:o,updatedAt:R()},N=k(O,"pomodoro",`${u.uid}_${h}`);await I(N,m),n("saved")}catch(o){console.error("Pomodoro - Error al eliminar sesi√≥n:",o),s(o instanceof Error?o.message:"Error al eliminar"),n("error")}}},g=async(c,o)=>{if(!(!u||!r)){n("saving"),s(null);try{const a=new Date(c.startTime.timestamp);let l=c.startTime,m=c.endTime;if(o.startTime){const p=new Date(o.startTime.timestamp),T=A(a,p.getHours(),p.getMinutes());l={timestamp:T.timestamp,utcOffset:T.utcOffset,formatted:T.formatted}}if(o.endTime){const p=new Date(o.endTime.timestamp),T=A(a,p.getHours(),p.getMinutes());m={timestamp:T.timestamp,utcOffset:T.utcOffset,formatted:T.formatted}}const N=(m.timestamp-l.timestamp)/1e3,b=r.sessions.map(p=>{var T;return p.startTime.timestamp===c.startTime.timestamp?{...p,startTime:l,endTime:m,duration:N,completed:o.completed??p.completed,...(T=o.description)!=null&&T.trim()?{description:o.description.trim()}:{}}:p}),C={...r,count:b.filter(p=>p.completed).length,sessions:b,updatedAt:R()},v=k(O,"pomodoro",`${u.uid}_${h}`);await I(v,C),n("saved")}catch(a){console.error("Pomodoro - Error al editar sesi√≥n:",a),s(a instanceof Error?a.message:"Error al editar"),n("error")}}};return{count:(r==null?void 0:r.count)??0,sessions:(r==null?void 0:r.sessions)??[],status:f,error:d,saveSession:w,deleteSession:y,editSession:g,addManualSession:j}},qe=()=>{const[t,r]=i.useState("default"),[x,f]=i.useState({enabled:!1,sound:!0,vibration:!0}),n=i.useRef(null),d=i.useRef(),s=i.useCallback(()=>"Notification"in window,[]),u=i.useCallback(async()=>{if(!s())return!1;try{const c=await Notification.requestPermission();return r(c),c==="granted"}catch(c){return console.error("Error requesting notification permission:",c),!1}},[]),h=i.useCallback((c,o)=>{if(!(!s()||t!=="granted"))try{const a=new Notification(c,{icon:"/icon-192x192.png",silent:!x.sound,...o});a.onclick=()=>{window.focus(),a.close()}}catch(a){console.error("Error sending notification:",a)}},[t,x]),j=i.useCallback((c,o)=>{var a;if(!(!s()||t!=="granted"))try{(a=n.current)==null||a.close();const l=new Notification(c,{body:o,icon:"/icon-192x192.png",silent:!x.sound,requireInteraction:!0});l.onclick=()=>{window.focus(),l.close()},n.current=l}catch(l){console.error("Error sending persistent notification:",l)}},[t,x,s]),w=i.useCallback((c,o,a=6e4)=>{j(c,o()),d.current&&clearInterval(d.current),d.current=window.setInterval(()=>{j(c,o())},a)},[j]),y=i.useCallback(()=>{d.current&&(clearInterval(d.current),d.current=void 0),n.current&&(n.current.close(),n.current=null)},[]);i.useEffect(()=>{const c=localStorage.getItem("pomodoroNotificationPrefs");if(c)try{f(JSON.parse(c))}catch{console.warn("Invalid pomodoro prefs in storage")}s()&&r(Notification.permission)},[]);const g=i.useCallback(c=>{f(o=>{const a={...o,...c};return localStorage.setItem("pomodoroNotificationPrefs",JSON.stringify(a)),a})},[]);return{supported:s(),permission:t,preferences:x,requestPermission:u,sendNotification:h,updatePreferences:g,startPersistentNotification:w,stopPersistentNotification:y}},_e=({count:t,onIncrement:r,disabled:x,status:f})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex flex-col items-center min-w-[3rem]",children:[e.jsx("span",{className:"font-medium text-lg",children:t}),e.jsx("span",{className:"text-xs text-gray-500",children:"completados"})]}),e.jsx($,{variant:"outline",size:"icon",onClick:r,disabled:x,className:"h-8 w-8",children:e.jsx(le,{className:"w-4 h-4"})}),f==="saving"&&e.jsx("span",{className:"text-xs text-blue-500 animate-pulse",children:"Guardando..."}),f==="error"&&e.jsx("span",{className:"text-xs text-red-500",children:"Error al guardar"})]}),Z=t=>new Date(t).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit",hour12:!1}),Le=({sessions:t,onDeleteSession:r,onEditSession:x})=>{const[f,n]=i.useState(!1),d=[...t].sort((s,u)=>u.startTime.timestamp-s.startTime.timestamp);return e.jsx(ve,{type:"single",collapsible:!0,onValueChange:s=>n(!!s),value:f?"history":"",children:e.jsxs(Te,{value:"history",className:"border-none",children:[e.jsx(be,{className:"w-full h-11 flex items-center justify-center gap-2 border rounded-lg bg-background hover:bg-accent data-[state=open]:rounded-b-none",children:e.jsx("span",{className:"text-sm font-semibold",children:"Historial de hoy"})}),e.jsx(we,{className:"mt-2 space-y-2",children:d.length===0?e.jsx("div",{className:"text-center text-gray-500 text-sm py-2",children:"No hay sesiones registradas hoy"}):d.map((s,u)=>e.jsxs("div",{className:"flex flex-col p-2.5 bg-muted rounded-lg text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.completed?e.jsx(me,{className:"w-4 h-4 text-green-500 flex-shrink-0"}):e.jsx(de,{className:"w-4 h-4 text-red-500 flex-shrink-0"}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-xs text-gray-400 w-4",children:u+1}),e.jsx("span",{children:Z(s.startTime.timestamp)}),e.jsx("span",{className:"text-gray-400",children:"‚Üí"}),e.jsx("span",{children:Z(s.endTime.timestamp)})]})}),e.jsxs("span",{className:"text-gray-500 whitespace-nowrap",children:[Math.floor(s.duration/60),"min"]}),e.jsxs("div",{className:"flex gap-1 ml-2",children:[x&&e.jsx($,{variant:"ghost",size:"icon",className:"h-auto w-auto p-1",onClick:()=>x(s),children:e.jsx(ue,{className:"w-4 h-4 text-muted-foreground"})}),r&&e.jsx($,{variant:"ghost",size:"icon",className:"h-auto w-auto p-1",onClick:()=>r(s),children:e.jsx(fe,{className:"w-4 h-4 text-destructive"})})]})]}),s.description&&e.jsx("div",{className:"ml-6 mt-1 text-xs text-gray-500",children:s.description})]},s.startTime.timestamp))})]})})},Be=({time:t,isActive:r,onStart:x,onStop:f,disabled:n})=>{const[d,s]=i.useState(!1),u=async j=>{if(j.preventDefault(),!d)try{s(!0),await f()}finally{s(!1)}},h=async j=>{if(j.preventDefault(),!d)try{s(!0),await x()}finally{s(!1)}};return e.jsxs("div",{className:"flex flex-col items-center gap-6",children:[e.jsx("div",{className:"text-6xl font-mono tracking-wider",children:t}),e.jsx("div",{className:"flex gap-4",children:r?e.jsxs($,{size:"lg",onClick:u,disabled:n||d,variant:"destructive",className:"w-40 text-lg",children:[d?e.jsx(K,{className:"w-5 h-5 mr-2 animate-spin"}):e.jsx(xe,{className:"w-5 h-5 mr-2"}),d?"Deteniendo...":"Detener"]}):e.jsxs($,{size:"lg",onClick:h,disabled:n||d,className:"w-40 text-lg",children:[d?e.jsx(K,{className:"w-5 h-5 mr-2 animate-spin"}):e.jsx(pe,{className:"w-5 h-5 mr-2"}),d?"Iniciando...":"Iniciar"]})}),e.jsx("div",{className:"text-sm text-gray-500",children:r?e.jsx(e.Fragment,{children:d?e.jsx("span",{children:"Procesando cambio de estado..."}):e.jsx("span",{children:"Concentraci√≥n en progreso..."})}):e.jsx("span",{children:"30 minutos de concentraci√≥n"})})]})},Ue=({progress:t,currentTime:r,totalTime:x,isActive:f})=>{const n=Math.min(Math.max(t,0),100);return e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{value:n,className:`h-2 transition-all duration-300 ${f?"bg-gray-100":"bg-gray-50"}`}),e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:r}),e.jsx("span",{className:"text-gray-500",children:" restantes"})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("span",{children:"Total: "}),e.jsx("span",{className:"font-medium",children:x})]})]}),e.jsx("div",{className:"text-center text-sm text-gray-500",children:n>0&&e.jsxs("span",{children:[Math.round(n),"% completado"]})})]})},Je=({session:t,onClose:r,onSave:x})=>{const[f,n]=i.useState(""),[d,s]=i.useState(""),[u,h]=i.useState(!1),[j,w]=i.useState("");if(i.useEffect(()=>{if(t){const g=new Date(t.startTime.timestamp),c=new Date(t.endTime.timestamp);n(`${String(g.getHours()).padStart(2,"0")}:${String(g.getMinutes()).padStart(2,"0")}`),s(`${String(c.getHours()).padStart(2,"0")}:${String(c.getMinutes()).padStart(2,"0")}`),h(t.completed),w(t.description||"")}},[t]),!t)return null;const y=()=>{const g=new Date(t.startTime.timestamp),[c,o]=f.split(":").map(Number),[a,l]=d.split(":").map(Number),m=new Date(g);m.setHours(c,o,0,0);const N=new Date(g);N.setHours(a,l,0,0),N<m&&N.setDate(N.getDate()+1);const b={startTime:{timestamp:m.getTime(),utcOffset:-m.getTimezoneOffset(),formatted:new Date(m).toLocaleString("es-ES",{day:"numeric",month:"long",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!0})+` UTC${-m.getTimezoneOffset()>=0?"+":"-"}${Math.abs(Math.floor(-m.getTimezoneOffset()/60))}`},endTime:{timestamp:N.getTime(),utcOffset:-N.getTimezoneOffset(),formatted:new Date(N).toLocaleString("es-ES",{day:"numeric",month:"long",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!0})+` UTC${-N.getTimezoneOffset()>=0?"+":"-"}${Math.abs(Math.floor(-N.getTimezoneOffset()/60))}`},duration:(N.getTime()-m.getTime())/1e3,completed:u,description:j.trim()||void 0};x(t,b),r()};return e.jsx(ye,{open:!!t,onOpenChange:g=>{g||r()},children:e.jsxs(Se,{className:"sm:max-w-md",children:[e.jsx(De,{children:e.jsx(Pe,{children:"Editar Sesi√≥n Pomodoro"})}),e.jsxs("div",{className:"py-4 space-y-4",children:[" ",e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[" ",e.jsx(z,{htmlFor:"startTime",children:"Hora inicio"}),e.jsx(J,{id:"startTime",type:"time",value:f,onChange:g=>n(g.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(z,{htmlFor:"endTime",children:"Hora fin"}),e.jsx(J,{id:"endTime",type:"time",value:d,onChange:g=>s(g.target.value)})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(z,{htmlFor:"description",children:"Descripci√≥n (opcional)"}),e.jsx(J,{id:"description",type:"text",value:j,onChange:g=>w(g.target.value),placeholder:"¬øQu√© hiciste en esta sesi√≥n?"})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-2",children:[" ",e.jsx(Ee,{id:"completed",checked:u,onCheckedChange:g=>h(!!g)}),e.jsx(z,{htmlFor:"completed",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Sesi√≥n completada"})]})]}),e.jsxs(Ce,{children:[e.jsx($,{variant:"outline",onClick:r,children:"Cancelar"}),e.jsx($,{onClick:y,children:"Guardar cambios"})]})]})})},q=t=>{const r=Math.floor(t/60),x=t%60;return r>0?`${r}h ${x}min`:`${x}min`},We=t=>t===100?{icon:ge,message:"¬°Meta diaria alcanzada! üéâ",description:"Has completado tu objetivo del d√≠a ¬°Excelente trabajo!",color:"text-green-600"}:t>=75?{icon:he,message:"¬°Casi ah√≠! üí™",description:"Est√°s muy cerca de alcanzar tu meta diaria",color:"text-blue-600"}:t>=50?{icon:_,message:"¬°Buen progreso! üëç",description:"Mant√©n el ritmo, vas por buen camino",color:"text-indigo-600"}:t>=25?{icon:_,message:"¬°Sigue adelante! üéØ",description:"Has comenzado bien, mant√©n el enfoque",color:"text-blue-600"}:{icon:_,message:"¬°Comencemos! üöÄ",description:"Es un buen momento para enfocarse en tus objetivos",color:"text-gray-600"},Ge=t=>t>=100?{background:"bg-green-500",text:"text-green-700",icon:"bg-green-100"}:t>=75?{background:"bg-blue-500",text:"text-blue-700",icon:"bg-blue-100"}:t>=50?{background:"bg-indigo-500",text:"text-indigo-700",icon:"bg-indigo-100"}:t>=25?{background:"bg-blue-500",text:"text-blue-700",icon:"bg-blue-100"}:{background:"bg-gray-500",text:"text-gray-700",icon:"bg-gray-100"},Ve=({sessions:t,dailyGoal:r=300})=>{const x=t.filter(y=>y.completed).reduce((y,g)=>y+g.duration,0),f=Math.floor(x/60),n=Math.min(Math.round(f/r*100),100),d=Math.max(r-f,0),{icon:s,message:u,description:h,color:j}=We(n),w=Ge(n);return e.jsx(G,{className:"p-6 bg-gradient-to-br from-white to-gray-50",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-full ${w.icon} mt-1`,children:e.jsx(s,{className:`w-5 h-5 ${j}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:`font-semibold text-lg ${j}`,children:u}),e.jsx("p",{className:"text-sm text-gray-600",children:h})]})]}),e.jsxs("div",{className:"text-sm text-gray-600 flex justify-between items-center",children:[e.jsxs("span",{children:["Meta diaria: ",q(r)]}),e.jsxs("span",{className:`font-medium ${j}`,children:[n,"% completado"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(te,{value:n,className:"h-3"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Tiempo efectivo"}),e.jsx("p",{className:`text-lg font-semibold ${w.text}`,children:q(f)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Tiempo restante"}),e.jsx("p",{className:"text-lg font-semibold text-gray-700",children:q(d)})]})]})]}),e.jsx("div",{className:"text-center",children:n<100?e.jsxs("p",{className:"text-sm text-gray-600",children:["Te faltan ",e.jsx("span",{className:"font-medium",children:q(d)})," para alcanzar tu meta diaria"]}):e.jsx("p",{className:"text-sm font-medium text-green-600",children:"¬°Felicitaciones! Has superado tu meta diaria de productividad üéâ"})})]})})},W=30*60,mt=({selectedDate:t})=>{const{user:r}=V(),x=300,[f,n]=i.useState(!1),[d,s]=i.useState(null),{supported:u,permission:h,preferences:j,requestPermission:w,sendNotification:y,updatePreferences:g,startPersistentNotification:c,stopPersistentNotification:o}=qe(),{count:a,sessions:l,status:m,error:N,saveSession:b,deleteSession:C,editSession:v,addManualSession:p}=Fe(t),T=i.useCallback(async M=>{await b(M,!0),j.enabled&&h==="granted"&&y("¬°Pomodoro completado! üéâ",{body:"Has completado exitosamente tu sesi√≥n de concentraci√≥n",requireInteraction:!0})},[b,j,h,y]),S=i.useCallback(async M=>{await b(M,!1,{description:"Sesi√≥n interrumpida manualmente"})},[b]),{time:D,isActive:P,formattedTime:H,startTimer:B,stopTimer:U}=ze({onComplete:T,onCancel:S,selectedDate:t}),se=(W-D)/W*100,ae=async()=>{u&&(j.enabled?g({enabled:!1}):h==="default"?n(!0):h==="granted"&&g({enabled:!0}))},re=async()=>{await w()&&g({enabled:!0}),n(!1)},ne=async()=>{m!=="saving"&&await p()},oe=M=>{s(M)},ie=async(M,ce)=>{await v(M,ce),s(null)},Q=i.useRef(D);return i.useEffect(()=>{Q.current=D},[D]),i.useEffect(()=>{!u||!j.enabled||h!=="granted"||(P?c("Pomodoro en progreso",()=>`Tiempo restante: ${Y(Math.ceil(Q.current))}`):o())},[P,u,j.enabled,h,c,o]),i.useEffect(()=>()=>{o()},[o]),r?e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ve,{sessions:l,dailyGoal:x}),e.jsx(G,{className:"w-full",children:e.jsxs(X,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5"}),e.jsx("h2",{className:"text-lg font-medium",children:"Pomodoro Timer"})]}),u&&e.jsx($,{variant:"outline",size:"sm",onClick:ae,className:"flex items-center gap-2","aria-label":j.enabled?"Desactivar notificaciones":"Activar notificaciones",children:j.enabled?e.jsxs(e.Fragment,{children:[e.jsx(je,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ne,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline"})]})})]}),e.jsx(_e,{count:a,onIncrement:ne,disabled:m==="saving",status:m})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(Be,{time:H,isActive:P,onStart:B,onStop:U,disabled:m==="saving"}),e.jsx(Ue,{progress:se,currentTime:H,totalTime:Y(W),isActive:P})]}),e.jsx("div",{className:"mt-6",children:e.jsx(Le,{sessions:l,onEditSession:oe,onDeleteSession:C})})]})}),d&&e.jsx(Je,{session:d,onClose:()=>s(null),onSave:ie}),e.jsx(Me,{open:f,onOpenChange:n,children:e.jsxs(Oe,{children:[e.jsxs(ke,{children:[e.jsx($e,{children:"Activar notificaciones"}),e.jsx(Ae,{children:"¬øTe gustar√≠a recibir notificaciones cuando se complete un Pomodoro? Esto te ayudar√° a mantenerte informado incluso cuando el navegador est√© en segundo plano."})]}),e.jsxs(Ie,{children:[e.jsx(He,{children:"No, gracias"}),e.jsx(Re,{onClick:re,children:"Activar notificaciones"})]})]})}),N&&e.jsx("p",{className:"mt-2 text-sm text-red-500",children:N})]}):e.jsx(G,{className:"w-full",children:e.jsx(X,{className:"p-4 text-center",children:e.jsx("p",{children:"Inicia sesi√≥n para usar el temporizador Pomodoro"})})})};export{mt as P};
