import{j as s}from"./ui-vendor-DsUuK6wp.js";import{r as h}from"./react-vendor-Cob1R1W1.js";import{u as C,g as E,C as R,a as J,b as L,c as T,B as I}from"../assets/index-_jc0GUu5.js";import{s as B}from"./chart-vendor-C442uE2K.js";import"./firebase-DYY3nxBM.js";import"./utils-vendor-BIvfKBFf.js";const P=a=>a&&"daily"in a&&"totals"in a,U=({data:a,date:n,dayDate:u})=>{const{summary:D}=u&&!a?C(u):{summary:null},t=a||D,[o,p]=h.useState(!1),[l,i]=h.useState(""),[c,k]=h.useState(!1),d="AIzaSyAW4Ot-z7OH4ZR3OeaN7vcbkEDlWpo1aMY",e=E("statistics"),x=e!=null&&e.model?`https://generativelanguage.googleapis.com/v1beta/models/${e.model}:generateContent`:"",y=(e==null?void 0:e.prompt)??"Analiza mis registros y dame consejos.",g=e==null?void 0:e.params,j=t?P(t)?`Fecha: ${n}
Datos semanales:
${JSON.stringify(t.totals,null,2)}

Detalle diario:
${JSON.stringify(t.daily,null,2)}`:`Fecha: ${n}
Datos diarios:
${JSON.stringify(t,null,2)}`:`Fecha: ${n}
No hay datos disponibles.`,f=!t,m=`${y}

${j}`,z=async()=>{var N,v,b,w,S;if(!x||!t)return;p(!0);const A={contents:[{parts:[{text:m}]}],...g};console.log("🤖 AI Analysis Request:",{date:n,dataType:P(t)?"weekly":"daily",dataKeys:t?Object.keys(t):[],promptLength:m.length,requestBody:A});try{const r=await(await fetch(`${x}?key=${d}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(A)})).json();console.log("🤖 AI Response:",r);const O=((S=(w=(b=(v=(N=r==null?void 0:r.candidates)==null?void 0:N[0])==null?void 0:v.content)==null?void 0:b.parts)==null?void 0:w[0])==null?void 0:S.text)||"";O?(i(O),console.log("🤖 Analysis generated successfully")):(console.warn("🤖 No text in AI response:",r),i("No se pudo generar análisis"))}catch($){console.error("🤖 API Error:",$),i("Error al consultar la API")}finally{p(!1)}};return s.jsxs(R,{children:[s.jsx(J,{children:s.jsx(L,{children:"Asistente IA"})}),"      ",s.jsxs(T,{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsxs(I,{onClick:z,disabled:o||!d||f,className:"flex items-center gap-2",children:[o&&s.jsx(B,{className:"w-4 h-4 animate-spin"}),o?"Analizando...":"Analizar"]}),s.jsx(I,{variant:"outline",size:"sm",onClick:()=>k(!c),children:c?"Ocultar Debug":"Mostrar Debug"})]}),c&&s.jsxs("div",{className:"bg-gray-100 p-3 rounded text-xs space-y-2",children:[s.jsxs("div",{children:[s.jsx("strong",{children:"Config:"})," ",e?"Encontrado":"No encontrado"]}),s.jsxs("div",{children:[s.jsx("strong",{children:"Model:"})," ",(e==null?void 0:e.model)||"N/A"]}),s.jsxs("div",{children:[s.jsx("strong",{children:"API Key:"})," ",`${d.substring(0,10)}...`]}),s.jsxs("div",{children:[s.jsx("strong",{children:"Params:"})," ",JSON.stringify(g,null,2)]}),s.jsx("div",{children:s.jsx("strong",{children:"Prompt base:"})}),s.jsx("div",{className:"bg-white p-2 rounded max-h-32 overflow-y-auto",children:y}),s.jsx("div",{children:s.jsx("strong",{children:"Summary data:"})}),s.jsx("div",{className:"bg-white p-2 rounded max-h-32 overflow-y-auto",children:j||"Vacío"}),s.jsx("div",{children:s.jsx("strong",{children:"Prompt completo:"})}),s.jsx("div",{className:"bg-white p-2 rounded max-h-32 overflow-y-auto",children:m})]}),l&&s.jsx("div",{className:"text-sm whitespace-pre-wrap",children:l}),!l&&f&&s.jsx("p",{className:"text-sm text-muted-foreground",children:"Registra datos para generar un análisis."})]})]})};export{U as AiInsightCard};
