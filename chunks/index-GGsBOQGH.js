import{j as e}from"./ui-vendor-DGxrBG5B.js";import{C as L,c as z}from"./PageLayout-CQ502YZp.js";import{B as v,u as _,d as E,a as P}from"../assets/index-CZllZBvh.js";import{M as ee,u as se,c as te}from"./MoodAiSuggestion-COK6RpdY.js";import{r as x}from"./react-vendor-B6CgFIIW.js";import{D as J,a as F,b as V,c as U,d as q,e as ae}from"./dialog-Ch6bvtCJ.js";import{I as B}from"./input-DyWC7sCN.js";import{c as O,g as $}from"./dates-LQzD1DbF.js";import{v as W,u as re,g as ne,a0 as oe,a1 as ie,a2 as le,a3 as ce,a4 as de,V as me,i as ue,Z as xe}from"./chart-vendor-DS0HZnUf.js";import{A as pe,a as ge,b as he,c as fe}from"./accordion-OgLUcSe4.js";import{T as je}from"./textarea-DJSkO8fg.js";import{A as ve,a as Ne}from"./alert-BdSdTxzO.js";import{e as M,l as C,f as G,j as I,h as X,n as Y}from"./firebase-B1tATv4n.js";import{D as we,a as ye,b as Se,d as be}from"./tokens-DP8wmanu.js";import{g as Ee}from"./index-DuocBWKh.js";const Me=({isOpen:u,onClose:n,moodEntry:r,onSave:p,onDelete:i})=>{const[l,m]=x.useState(""),[c,g]=x.useState(!1);x.useEffect(()=>{r!=null&&r.time&&m(r.time)},[r]);const f=async()=>{if(r){g(!0);try{const[s,o]=l.split(":").map(Number),a=new Date(r.timestamp),t=O(a,s,o);await p({...r,time:l,timestamp:t.timestamp}),n()}catch(s){console.error("Error al guardar:",s)}finally{g(!1)}}},j=async()=>{if(i){g(!0);try{await i(),n()}catch(s){console.error("Error al eliminar:",s)}finally{g(!1)}}};return e.jsx(J,{open:u,onOpenChange:n,children:e.jsxs(F,{className:"sm:max-w-md",children:[e.jsx(V,{children:e.jsx(U,{children:"Editar registro"})}),e.jsxs("div",{className:"flex items-center gap-4 py-4",children:[e.jsx("span",{className:"text-2xl",children:r==null?void 0:r.emoji}),e.jsx("span",{children:r==null?void 0:r.text})]}),e.jsx("div",{className:"grid gap-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{htmlFor:"time",className:"text-sm",children:"Hora:"}),e.jsx(B,{id:"time",type:"time",value:l,onChange:s=>m(s.target.value)})]})}),e.jsxs(q,{className:"gap-2 sm:gap-0",children:[i&&e.jsx(v,{variant:"destructive",onClick:j,disabled:c,className:"w-full sm:w-auto",children:"Eliminar"}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsx(v,{variant:"outline",onClick:n,disabled:c,className:"flex-1 sm:flex-none",children:"Cancelar"}),e.jsx(v,{onClick:f,disabled:c,className:"flex-1 sm:flex-none",children:"Guardar"})]})]})]})})},Ce=({moods:u,onUpdateMood:n,onDeleteMood:r})=>{const[p,i]=x.useState(!1),[l,m]=x.useState(null),c=[...u].sort((a,t)=>a.timestamp-t.timestamp),g=p?c:c.slice(0,3),f=u.length>3,j=a=>{m(a)},s=async a=>{l&&await n(l.timestamp,a)},o=async()=>{l&&await r(l.timestamp)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-4 space-y-2",children:[g.map((a,t)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-muted rounded hover:bg-accent transition-colors",children:[e.jsx("span",{className:"text-xl",children:a.emoji}),e.jsx("span",{children:a.text}),e.jsx("span",{className:"text-gray-500 ml-auto",children:a.time}),e.jsx(v,{variant:"ghost",size:"sm",className:"ml-2 h-8 w-8 p-0",onClick:()=>j(a),children:e.jsx(W,{className:"h-4 w-4"})})]},`${a.timestamp}_${t}`)),f&&e.jsx(v,{variant:"ghost",className:"w-full h-8 text-sm text-gray-500 hover:text-gray-900",onClick:()=>i(!p),children:p?e.jsxs("span",{className:"flex items-center gap-1",children:["Ver menos ",e.jsx(re,{className:"h-4 w-4"})]}):e.jsxs("span",{className:"flex items-center gap-1",children:["Ver m치s (",u.length-3,") ",e.jsx(ne,{className:"h-4 w-4"})]})}),u.length===0&&e.jsx("div",{className:"text-center text-gray-500 py-4",children:"No hay registros para este d칤a"})]}),e.jsx(Me,{isOpen:l!==null,onClose:()=>m(null),moodEntry:l,onSave:s,onDelete:o})]})},Ie=["bg-red-500 text-white","bg-orange-500 text-white","bg-yellow-400 text-black","bg-lime-500 text-black","bg-green-600 text-white"],De=[oe,ie,le,ce,de],Z=({onSelect:u,disabled:n})=>{const[r,p]=x.useState(""),i=l=>{u(l,r||void 0),p("")};return e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"text",placeholder:"Comentario opcional",value:r,onChange:l=>p(l.target.value),className:"w-full border rounded p-2 text-sm"}),e.jsx("div",{className:"grid grid-cols-5 gap-2 mb-2",children:[1,2,3,4,5].map(l=>{const m=De[l-1];return e.jsx(v,{variant:"default",className:`h-12 w-full ${Ie[l-1]} flex items-center justify-center`,onClick:()=>i(l),disabled:n,children:e.jsx(m,{className:"h-5 w-5"})},l)})})]})},$e=({isOpen:u,onClose:n,energyEntry:r,onSave:p,onDelete:i})=>{const[l,m]=x.useState(""),[c,g]=x.useState(3),[f,j]=x.useState(""),[s,o]=x.useState(!1);x.useEffect(()=>{r&&(m(r.time),g(r.level),j(r.comment||""))},[r]);const a=async()=>{if(r){o(!0);try{const[d,h]=l.split(":").map(Number),S=new Date(r.timestamp),y=O(S,d,h);await p({level:c,comment:f||void 0,time:l,timestamp:y.timestamp}),n()}finally{o(!1)}}},t=async()=>{if(!(!i||!r)){o(!0);try{await i(),n()}finally{o(!1)}}};return e.jsx(J,{open:u,onOpenChange:n,children:e.jsxs(F,{className:"sm:max-w-md",children:[e.jsx(V,{children:e.jsx(U,{children:"Editar registro"})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{htmlFor:"time",className:"text-sm",children:"Hora:"}),e.jsx(B,{id:"time",type:"time",value:l,onChange:d=>m(d.target.value)})]}),e.jsx(B,{type:"text",placeholder:"Comentario opcional",value:f,onChange:d=>j(d.target.value)}),e.jsx(Z,{onSelect:d=>g(d),disabled:!1})]}),e.jsxs(q,{className:"gap-2 sm:gap-0",children:[i&&e.jsx(v,{variant:"destructive",onClick:t,disabled:s,className:"w-full sm:w-auto",children:"Eliminar"}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsx(v,{variant:"outline",onClick:n,disabled:s,className:"flex-1 sm:flex-none",children:"Cancelar"}),e.jsx(v,{onClick:a,disabled:s,className:"flex-1 sm:flex-none",children:"Guardar"})]})]})]})})},Ae=["bg-red-500","bg-orange-500","bg-yellow-400","bg-lime-500","bg-green-600"],Te=({entries:u,onUpdate:n,onDelete:r})=>{const[p,i]=x.useState(!1),[l,m]=x.useState(null),c=[...u].sort((s,o)=>s.timestamp-o.timestamp),g=u.length>0?Math.round(u.reduce((s,o)=>s+o.level,0)/u.length*10)/10:0,f=async s=>{l&&(await n(l.timestamp,s),m(null))},j=async()=>{l&&(await r(l.timestamp),m(null))};return e.jsxs(e.Fragment,{children:[e.jsx(pe,{type:"single",collapsible:!0,value:p?"history":"",onValueChange:s=>i(!!s),children:e.jsxs(ge,{value:"history",className:"border-none",children:[e.jsx(he,{className:"w-full h-11 flex items-center justify-between gap-2 border rounded-lg bg-background hover:bg-accent data-[state=open]:rounded-b-none",children:e.jsx("span",{className:"text-sm font-semibold",children:"Historial de hoy"})}),e.jsxs(fe,{className:"mt-2 space-y-2",children:[c.length===0?e.jsx("div",{className:"text-center text-gray-500 text-sm py-2",children:"No hay registros para este d칤a"}):c.map((s,o)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-muted rounded",children:[e.jsx("span",{className:`w-3 h-3 rounded-full ${Ae[s.level-1]}`}),e.jsxs("span",{className:"text-sm",children:["Nivel ",s.level]}),s.comment&&e.jsx("span",{className:"text-sm flex-1",children:s.comment}),e.jsx("span",{className:"text-gray-500 ml-auto text-sm",children:s.time}),e.jsx(v,{variant:"ghost",size:"sm",className:"ml-2 h-8 w-8 p-0",onClick:()=>m(s),children:e.jsx(W,{className:"h-4 w-4"})})]},`${s.timestamp}_${o}`)),c.length>0&&e.jsxs("div",{className:"text-center text-xs text-muted-foreground",children:["Promedio del d칤a: ",g]})]})]})}),e.jsx($e,{isOpen:l!==null,onClose:()=>m(null),energyEntry:l,onSave:f,onDelete:j})]})},Oe=()=>{const[u,n]=x.useState(!1),[r,p]=x.useState(""),[i,l]=x.useState(null),[m,c]=x.useState(!1),{user:g}=_(),f=async()=>{var s;if(!(!g||!r.trim())){c(!0),l(null);try{const o=JSON.parse(r);if(!Array.isArray(o))throw new Error("El JSON debe ser un array de objetos");let a=0;for(const t of o){if(!t.date||!Array.isArray(t.moods)){console.warn("Datos inv치lidos para un d칤a:",t);continue}const d=`${g.uid}_${t.date}`,h=M(C(E,"moods"),d),S=await G(h),y=S.exists()?((s=S.data())==null?void 0:s.moods)||[]:[],N=t.moods.map((w,K)=>{let k,H;if(w.time){k=w.time;const[D,R]=w.time.split(":").map(Number),T=new Date(t.date);T.setHours(D,R,0,0),H=T.getTime()}else if(w.hour!==void 0&&w.minute!==void 0){k=`${w.hour.toString().padStart(2,"0")}:${w.minute.toString().padStart(2,"0")}`;const D=new Date(t.date);D.setHours(w.hour,w.minute,0,0),H=D.getTime()}else{const D=new Date,R=D.getHours(),T=D.getMinutes()+K;k=`${R.toString().padStart(2,"0")}:${(T%60).toString().padStart(2,"0")}`;const Q=new Date(t.date);H=O(Q,R,T%60).timestamp}return{emoji:w.emoji,text:w.text,time:k,timestamp:H}}),b=[...y,...N],A={id:d,userId:g.uid,date:t.date,moods:b};await I(h,A),a+=N.length}P.success(`Se importaron ${a} estados de 치nimo correctamente`),p(""),n(!1)}catch(o){const a=o instanceof Error?o.message:"Error al importar estados de 치nimo";l(a),P.error(a)}finally{c(!1)}}};return e.jsxs(J,{open:u,onOpenChange:n,children:[e.jsx(ae,{asChild:!0,children:e.jsxs(v,{variant:"outline",size:"sm",children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Importar Estados"]})}),e.jsxs(F,{className:"max-w-2xl",children:[e.jsx(V,{children:e.jsx(U,{children:"Importar Estados de 츼nimo desde JSON"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:'Pegue el JSON con los estados de 치nimo a importar. El campo "time" es opcional.'}),e.jsxs("details",{className:"text-xs text-gray-500",children:[e.jsx("summary",{className:"cursor-pointer hover:text-gray-700",children:"Ver ejemplo de formato"}),e.jsx("pre",{className:"mt-2 p-2 bg-gray-50 rounded text-xs overflow-x-auto",children:`[
  {
    "date": "2024-01-15",
    "moods": [
      {
        "emoji": "游땕",
        "text": "Feliz",
        "time": "09:30"
      },
      {
        "emoji": "游땗",
        "text": "Tranquilo",
        "hour": 14,
        "minute": 15
      },
      {
        "emoji": "游뱂",
        "text": "Pensativo"
      }
    ]
  }
]`})]})]}),e.jsx(je,{value:r,onChange:s=>p(s.target.value),placeholder:"Pegue aqu칤 el JSON con los estados de 치nimo...",className:"min-h-[200px] font-mono text-sm"}),i&&e.jsxs(ve,{variant:"destructive",children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsx(Ne,{children:i})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(v,{variant:"outline",onClick:()=>n(!1),children:"Cancelar"}),e.jsx(v,{onClick:f,disabled:!r.trim()||m,children:m?"Importando...":"Importar"})]})]})]})]})},ke=({selectedDate:u})=>{const[n,r]=x.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs(we,{children:[e.jsx(ye,{asChild:!0,children:e.jsxs(v,{size:"sm",variant:"outline",className:"flex items-center gap-2 text-blue-600",children:[e.jsx(xe,{className:"w-4 h-4"}),"IA"]})}),e.jsx(Se,{align:"end",children:e.jsx(be,{onSelect:()=>r(!0),children:"Sugerir moods"})})]}),e.jsx(ee,{selectedDate:u,open:n,onOpenChange:r})]})},He=u=>{const[n,r]=x.useState(null),[p,i]=x.useState("idle"),[l,m]=x.useState(null),{user:c}=_();x.useEffect(()=>{if(!c)return;const s=$(u),o=M(C(E,"moods"),`${c.uid}_${s}`),a=X(o,t=>{if(t.exists()){const d=t.data();d&&Array.isArray(d.moods)?r(d):r({id:`${c.uid}_${s}`,userId:c.uid,date:s,moods:[]})}else r(null);i("saved")},t=>{console.error("Mood - Error en snapshot:",t),m(t.message),i("error")});return()=>a()},[c,u]);const g=async s=>{if(!c)return;i("saving"),m(null);const o=$(u),a=`${c.uid}_${o}`,t=M(C(E,"moods"),a);try{const d=new Date,h=O(u,d.getHours(),d.getMinutes()),S={emoji:s.emoji,text:s.text,timestamp:h.timestamp,time:d.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}),value:Ee(s.text)},y=await G(t);if(y.exists()){const N=y.data(),b=Array.isArray(N==null?void 0:N.moods)?N.moods:[];await I(t,{id:a,userId:c.uid,date:o,moods:[...b,S]})}else await I(t,{id:a,userId:c.uid,date:o,moods:[S]});i("saved")}catch(d){console.error("Mood - Error al guardar:",d),m(d instanceof Error?d.message:"Error al guardar"),i("error")}},f=async(s,o)=>{if(!c||!n)return;i("saving"),m(null);const a=M(C(E,"moods"),n.id);try{const t=n.moods.map(d=>d.timestamp===s?o:d);await I(a,{...n,moods:t}),i("saved")}catch(t){console.error("Mood - Error al actualizar:",t),m(t instanceof Error?t.message:"Error al actualizar"),i("error")}},j=async s=>{if(!c||!n)return;i("saving"),m(null);const o=M(C(E,"moods"),n.id);try{const a=n.moods.filter(t=>t.timestamp!==s);a.length===0?(await Y(o),r(null)):await I(o,{...n,moods:a}),i("saved")}catch(a){console.error("Mood - Error al eliminar:",a),m(a instanceof Error?a.message:"Error al eliminar"),i("error")}};return{moodHistory:(n==null?void 0:n.moods)||[],status:p,error:l,addMood:g,updateMood:f,deleteMood:j}},Re=u=>{const[n,r]=x.useState(null),[p,i]=x.useState("idle"),[l,m]=x.useState(null),{user:c}=_();x.useEffect(()=>{if(!c)return;const s=$(u),o=M(C(E,"energy"),`${c.uid}_${s}`),a=X(o,t=>{if(t.exists()){const d=t.data();d&&Array.isArray(d.entries)?r(d):r({id:`${c.uid}_${s}`,userId:c.uid,date:s,entries:[]})}else r(null);i("saved")},t=>{console.error("Energy - Error en snapshot:",t),m(t.message),i("error")});return()=>a()},[c,u]);const g=async(s,o)=>{if(!c)return;i("saving"),m(null);const a=$(u),t=`${c.uid}_${a}`,d=M(C(E,"energy"),t);try{const h=new Date,S=O(u,h.getHours(),h.getMinutes()),y={level:s,comment:o,timestamp:S.timestamp,time:h.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})},N=await G(d);if(N.exists()){const b=N.data(),A=Array.isArray(b==null?void 0:b.entries)?b.entries:[];await I(d,{id:t,userId:c.uid,date:a,entries:[...A,y]})}else await I(d,{id:t,userId:c.uid,date:a,entries:[y]});i("saved")}catch(h){console.error("Energy - Error al guardar:",h),m(h instanceof Error?h.message:"Error al guardar"),i("error")}},f=async(s,o)=>{if(!c||!n)return;i("saving"),m(null);const a=M(C(E,"energy"),n.id);try{const t=n.entries.map(d=>d.timestamp===s?o:d);await I(a,{...n,entries:t}),i("saved")}catch(t){console.error("Energy - Error al actualizar:",t),m(t instanceof Error?t.message:"Error al actualizar"),i("error")}},j=async s=>{if(!c||!n)return;i("saving"),m(null);const o=M(C(E,"energy"),n.id);try{const a=n.entries.filter(t=>t.timestamp!==s);a.length===0?(await Y(o),r(null)):await I(o,{...n,entries:a}),i("saved")}catch(a){console.error("Energy - Error al eliminar:",a),m(a instanceof Error?a.message:"Error al eliminar"),i("error")}};return{energyHistory:(n==null?void 0:n.entries)||[],status:p,error:l,addEntry:g,updateEntry:f,deleteEntry:j}},Qe=({selectedDate:u,energyFirst:n=!1})=>{const{user:r}=_(),{isUnlocked:p}=se(),{moodHistory:i,status:l,error:m,addMood:c,updateMood:g,deleteMood:f}=He(u),{energyHistory:j,status:s,error:o,addEntry:a,updateEntry:t,deleteEntry:d}=Re(u),h=j.slice().sort((A,w)=>w.timestamp-A.timestamp)[0],S=["text-red-500","text-orange-500","text-yellow-500","text-lime-600","text-green-600"];if(!r)return e.jsx(L,{className:"w-full",children:e.jsx(z,{className:"p-4 text-center",children:e.jsx("p",{children:"Inicia sesi칩n para registrar tu estado de 치nimo"})})});const y=$(u)===$(new Date),N=e.jsx(L,{className:"w-full",children:e.jsxs(z,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"font-medium",children:"Estado de 치nimo"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oe,{}),p&&e.jsx(ke,{selectedDate:u}),l==="saving"&&e.jsx("span",{className:"text-xs text-blue-500",children:"Guardando..."}),l==="error"&&e.jsx("span",{className:"text-xs text-red-500",children:"Error al guardar"})]})]}),y&&e.jsx(te,{onSelect:c,disabled:l==="saving"}),e.jsx(Ce,{moods:i,onUpdateMood:g,onDeleteMood:f}),m&&e.jsx("p",{className:"mt-2 text-sm text-red-500",children:m})]})}),b=e.jsx(L,{className:"w-full",children:e.jsxs(z,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("h3",{className:"font-medium",children:["Nivel de energ칤a",h&&e.jsxs("span",{className:`ml-2 ${S[h.level-1]}`,children:["(",h.level,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s==="saving"&&e.jsx("span",{className:"text-xs text-blue-500",children:"Guardando..."}),s==="error"&&e.jsx("span",{className:"text-xs text-red-500",children:"Error al guardar"})]})]}),y&&e.jsx("div",{className:"mb-4",children:e.jsx(Z,{onSelect:a,disabled:s==="saving"})}),e.jsx(Te,{entries:j,onUpdate:t,onDelete:d}),o&&e.jsx("p",{className:"mt-2 text-sm text-red-500",children:o})]})});return e.jsxs("div",{className:"space-y-4",children:[n?b:N,n?N:b]})};export{Qe as M};
