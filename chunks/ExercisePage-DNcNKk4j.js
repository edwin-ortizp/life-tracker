import{j as e}from"./ui-vendor-DGxrBG5B.js";import{r as N,c as _}from"./react-vendor-B6CgFIIW.js";import{C as b,c as S,a as J,b as Q,P as ne}from"./PageLayout-FLWEEaav.js";import{u as W,d as O,B as F}from"../assets/index-B6EFx1d9.js";import{g as E}from"./dates-LQzD1DbF.js";import{e as B,f as re,k as X,j as U,n as oe}from"./firebase-B1tATv4n.js";import{P as le}from"./progress-BiVUpgIE.js";import{at as de,w as ue,af as Y,au as ce,av as me,T as xe,aw as he,R as H,k as G,l as L,m as $,Y as T,n as K,N as z,o as V,r as pe,s as te,j as je,d as ge,t as fe}from"./chart-vendor-DS0HZnUf.js";import{D as ye,a as Ne,b as ve,c as be,d as Se}from"./dialog-k0qgUnZO.js";import{I as P}from"./input-CcWp4fVQ.js";import{L as w}from"./label-BiIsydI6.js";import{T as we}from"./textarea-D04ZjWHU.js";import{T as ee,a as se,b as I,c as R}from"./tabs-ByakvzMK.js";import{C as Ee}from"./calendar-UcHJ8S5A.js";import{D as Ce}from"./DateSelector-CnbldR00.js";import{s as q,e as ke}from"./utils-vendor-zid8MmOQ.js";const Z={cardio:{name:"Cardio",description:"Ejercicios cardiovasculares",icon:"‚ù§Ô∏è"},strength:{name:"Fuerza",description:"Ejercicios de fuerza y resistencia",icon:"üí™"},flexibility:{name:"Flexibilidad",description:"Ejercicios de estiramiento",icon:"ü§∏"}},M=[{id:1,name:"Pasos",icon:"üë£",category:"cardio",targetMuscles:["piernas"],caloriesPerHour:200,description:"Registro de pasos diarios",stepsPerKm:1312},{id:2,name:"Trotar",icon:"üèÉ",category:"cardio",targetMuscles:["piernas","core"],defaultDuration:30,caloriesPerHour:500,description:"Trote suave a ritmo constante",stepsPerKm:1200},{id:3,name:"Bicicleta",icon:"üö≤",category:"cardio",targetMuscles:["piernas","core"],defaultDuration:45,defaultDistance:1e4,caloriesPerHour:450,description:"Ciclismo recreativo"},{id:4,name:"Caminata",icon:"üö∂",category:"cardio",targetMuscles:["piernas"],defaultDuration:30,caloriesPerHour:250,description:"Caminata a paso moderado",stepsPerKm:1400},{id:5,name:"Nataci√≥n",icon:"üèä",category:"cardio",targetMuscles:["todo el cuerpo"],defaultDuration:30,caloriesPerHour:550,description:"Nataci√≥n estilo libre"},{id:6,name:"Tenis",icon:"üéæ",category:"cardio",targetMuscles:["todo el cuerpo"],defaultDuration:60,caloriesPerHour:500,description:"Partido recreativo de tenis"},{id:7,name:"Abdominales",icon:"üí™",category:"strength",targetMuscles:["abdominales","core"],defaultSets:3,defaultReps:15,caloriesPerHour:300,description:"Series de abdominales b√°sicos"},{id:8,name:"Pesas de mano",icon:"üèãÔ∏è",category:"strength",targetMuscles:["brazos","hombros"],defaultSets:3,defaultReps:12,caloriesPerHour:250,description:"Ejercicios con mancuernas ligeras"},{id:9,name:"Flexiones",icon:"üí™",category:"strength",targetMuscles:["pecho","tr√≠ceps","hombros"],defaultSets:3,defaultReps:10,caloriesPerHour:350,description:"Flexiones de pecho (pushups)"},{id:10,name:"Sentadillas",icon:"üèãÔ∏è",category:"strength",targetMuscles:["cu√°driceps","gl√∫teos","core"],defaultSets:3,defaultReps:12,caloriesPerHour:400,description:"Sentadillas sin peso adicional"},{id:11,name:"Burpees",icon:"üí•",category:"strength",targetMuscles:["todo el cuerpo"],defaultSets:3,defaultReps:15,caloriesPerHour:700,description:"Ejercicio completo de cardio y fuerza"},{id:12,name:"Yoga",icon:"üßò",category:"flexibility",targetMuscles:["todo el cuerpo"],defaultDuration:20,caloriesPerHour:250,description:"Rutina b√°sica de yoga"},{id:13,name:"Estiramientos",icon:"ü§∏",category:"flexibility",targetMuscles:["todo el cuerpo"],defaultDuration:15,caloriesPerHour:150,description:"Rutina de estiramientos generales"}],Pe={cardio:"bg-red-500",strength:"bg-blue-500",flexibility:"bg-green-500"},Fe=l=>{const[n,p]=N.useState(null),[a,c]=N.useState("idle"),[f,t]=N.useState(null),{user:s}=W(),r=y=>y.reduce((x,d)=>{const h=M.find(v=>v.id===d.exerciseId);if(!h)return x;x.totalCalories+=d.calories||0,x.totalSteps+=d.steps||0,x.totalDuration+=d.duration||0,x.totalDistance+=d.distance||0;const j=x.categoryStats[h.category];return j.count+=1,j.duration+=d.duration||0,j.calories+=d.calories||0,x},{totalCalories:0,totalSteps:0,totalDuration:0,totalDistance:0,categoryStats:{cardio:{count:0,duration:0,calories:0},strength:{count:0,duration:0,calories:0},flexibility:{count:0,duration:0,calories:0}}});N.useEffect(()=>{if(!s)return;(async()=>{c("loading");const x=E(l),d=B(O,"exercises",`${s.uid}_${x}`);try{const h=await re(d);h.exists()?p(h.data()):p(null),c("idle")}catch(h){t(h instanceof Error?h.message:"Error al cargar ejercicios"),c("error")}})()},[s,l]);const o=async y=>{if(!s)return;c("saving"),t(null);const x=E(l),d=B(O,"exercises",`${s.uid}_${x}`);try{const h=(n==null?void 0:n.exercises)||[];h.push(y);const j=r(h),v={userId:s.uid,date:x,exercises:h,summary:j,createdAt:(n==null?void 0:n.createdAt)||X(),updatedAt:X()};await U(d,v),p(v),c("idle")}catch(h){t(h instanceof Error?h.message:"Error al guardar ejercicio"),c("error")}},m=async(y,x)=>{if(!(!s||!n)){c("saving"),t(null);try{const d=E(l),h=B(O,"exercises",`${s.uid}_${d}`),j=[...n.exercises];j[y]={...j[y],...x};const v=r(j),C={...n,exercises:j,summary:v,updatedAt:X()};await U(h,C),p(C),c("idle")}catch(d){t(d instanceof Error?d.message:"Error al actualizar ejercicio"),c("error")}}},g=async y=>{if(!(!s||!n)){c("saving"),t(null);try{const x=E(l),d=B(O,"exercises",`${s.uid}_${x}`),h=n.exercises.filter((j,v)=>v!==y);if(h.length===0)await oe(d),p(null);else{const j=r(h),v={...n,exercises:h,summary:j,updatedAt:X()};await U(d,v),p(v)}c("idle")}catch(x){t(x instanceof Error?x.message:"Error al eliminar ejercicio"),c("error")}}};return{exerciseLogs:(n==null?void 0:n.exercises)||[],summary:n==null?void 0:n.summary,status:a,error:f,logExercise:o,updateExerciseLog:m,deleteExerciseLog:g}},Ie=({exerciseLogs:l,onUpdate:n,onDelete:p,isLoading:a})=>{if(a)return e.jsx("div",{className:"text-center py-8",children:"Cargando ejercicios..."});if(l.length===0)return e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No hay ejercicios registrados para este d√≠a"});const c=s=>{if(!M.find(m=>m.id===s.exerciseId))return"";const o=[];return s.sets&&s.reps&&o.push(`${s.sets} series x ${s.reps} repeticiones`),s.duration&&o.push(`${s.duration} minutos`),s.distance&&o.push(`${(s.distance/1e3).toFixed(2)} km`),s.steps&&o.push(`${s.steps.toLocaleString()} pasos`),s.weight&&o.push(`${s.weight}kg`),o.join(" ‚Ä¢ ")},f=s=>{const r=M.find(o=>o.id===s.exerciseId);return r?r.defaultDuration&&s.duration?s.duration/r.defaultDuration*100:r.defaultDistance&&s.distance?s.distance/r.defaultDistance*100:r.defaultSets&&r.defaultReps&&s.sets&&s.reps?s.sets*s.reps/(r.defaultSets*r.defaultReps)*100:100:0},t=()=>{const s=l.reduce((m,g)=>m+(g.calories||0),0),r=l.reduce((m,g)=>m+(g.steps||0),0),o=l.reduce((m,g)=>m+(g.duration||0),0);return s===0&&r===0?null:e.jsx(b,{className:"mb-6",children:e.jsxs(S,{className:"p-4",children:[e.jsx("h3",{className:"text-sm font-medium mb-3",children:"Resumen del d√≠a"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[s>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4 text-orange-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:s}),e.jsx("p",{className:"text-xs text-gray-500",children:"calor√≠as"})]})]}),r>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:r.toLocaleString()}),e.jsx("p",{className:"text-xs text-gray-500",children:"pasos"})]})]}),o>0&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:o}),e.jsx("p",{className:"text-xs text-gray-500",children:"minutos"})]})})]})]})})};return e.jsxs("div",{className:"space-y-4",children:[t(),l.map((s,r)=>{const o=M.find(m=>m.id===s.exerciseId);return o?e.jsx(b,{children:e.jsxs(S,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:o.icon}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:o.name}),e.jsx("p",{className:"text-sm text-gray-500",children:c(s)})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(F,{variant:"ghost",size:"icon",onClick:()=>n(r),children:e.jsx(de,{className:"w-4 h-4"})}),e.jsx(F,{variant:"ghost",size:"icon",onClick:()=>p(r),children:e.jsx(ue,{className:"w-4 h-4 text-red-500"})})]})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("div",{className:"flex justify-between text-sm",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("span",{className:`px-2 py-1 rounded-full ${Pe[o.category]} text-white`,children:o.category}),s.calories&&e.jsxs("span",{className:"flex items-center gap-1 text-orange-500",children:[e.jsx(Y,{className:"w-4 h-4"}),s.calories," kcal"]})]})}),e.jsx(le,{value:f(s),className:"h-2"}),s.notes&&e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:s.notes})]})]})},r):null})]})},ae=({isOpen:l,onClose:n,onSubmit:p,initialData:a})=>{var x,d,h,j,v,C,D;const[c,f]=_.useState(a?M.find(i=>i.id===a.exerciseId):null),[t,s]=_.useState({sets:((x=a==null?void 0:a.sets)==null?void 0:x.toString())||"",reps:((d=a==null?void 0:a.reps)==null?void 0:d.toString())||"",weight:((h=a==null?void 0:a.weight)==null?void 0:h.toString())||"",duration:((j=a==null?void 0:a.duration)==null?void 0:j.toString())||"",distance:((v=a==null?void 0:a.distance)==null?void 0:v.toString())||"",steps:((C=a==null?void 0:a.steps)==null?void 0:C.toString())||"",calories:((D=a==null?void 0:a.calories)==null?void 0:D.toString())||"",notes:(a==null?void 0:a.notes)||""}),[r,o]=_.useState(0);N.useEffect(()=>{if(m(),c!=null&&c.stepsPerKm&&t.distance){const i=parseFloat(t.distance),u=Math.round(i*c.stepsPerKm);s(k=>({...k,steps:u.toString()}))}},[t.distance,t.duration,t.weight,c]);const m=()=>{if(!(c!=null&&c.caloriesPerHour))return;let i=parseInt(t.duration)||0;!i&&t.sets&&t.reps&&(i=parseInt(t.sets)*parseInt(t.reps)*3/60);let u=c.caloriesPerHour*i/60;if(t.weight&&c.category==="strength"){const A=parseInt(t.weight)/5;u*=1+A*.1}const k=Math.round(u);o(k),s(A=>({...A,calories:k.toString()}))},g=i=>{var u,k,A;f(i),s({sets:((u=i.defaultSets)==null?void 0:u.toString())||"",reps:((k=i.defaultReps)==null?void 0:k.toString())||"",weight:"",duration:((A=i.defaultDuration)==null?void 0:A.toString())||"",distance:i.defaultDistance?(i.defaultDistance/1e3).toString():"",steps:"",calories:"",notes:""})},y=i=>{if(i.preventDefault(),!c)return;const u={exerciseId:c.id,calories:t.calories?parseInt(t.calories):r,...t.sets&&{sets:parseInt(t.sets)},...t.reps&&{reps:parseInt(t.reps)},...t.weight&&{weight:parseFloat(t.weight)},...t.duration&&{duration:parseInt(t.duration)},...t.distance&&{distance:parseFloat(t.distance)*1e3},...t.steps&&{steps:parseInt(t.steps)},...t.notes&&{notes:t.notes}};p(u),n()};return e.jsx(ye,{open:l,onOpenChange:n,children:e.jsxs(Ne,{className:"sm:max-w-[700px] max-h-[90vh] sm:h-auto overflow-y-auto",children:[e.jsx(ve,{className:"sticky top-0 bg-background z-10 pb-4 mb-4 border-b",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs(be,{className:"flex items-center gap-2 text-xl",children:[c&&!a&&e.jsx(F,{type:"button",variant:"ghost",size:"icon",onClick:()=>f(null),className:"h-8 w-8",children:e.jsx(me,{className:"h-5 w-5"})}),a?"Editar ejercicio":"Agregar ejercicio"]})})}),e.jsx("form",{onSubmit:y,className:"space-y-6 pt-2",children:c?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("span",{className:"text-3xl",children:c.icon}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-lg",children:c.name}),e.jsx("p",{className:"text-sm text-gray-500",children:c.description})]})]}),c.category==="strength"&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"sets",children:"Series"}),e.jsx(P,{id:"sets",type:"number",min:"1",value:t.sets,onChange:i=>s(u=>({...u,sets:i.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"reps",children:"Repeticiones"}),e.jsx(P,{id:"reps",type:"number",min:"1",value:t.reps,onChange:i=>s(u=>({...u,reps:i.target.value}))})]}),c.name==="Pesas de mano"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"weight",children:"Peso (kg)"}),e.jsx(P,{id:"weight",type:"number",min:"0",step:"0.5",value:t.weight,onChange:i=>s(u=>({...u,weight:i.target.value}))})]})]}),(c.category==="cardio"||c.category==="flexibility")&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"duration",children:"Duraci√≥n (min)"}),e.jsx(P,{id:"duration",type:"number",min:"1",value:t.duration,onChange:i=>s(u=>({...u,duration:i.target.value}))})]}),c.category==="cardio"&&c.name!=="Nataci√≥n"&&c.name!=="Tenis"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"distance",children:"Distancia (km)"}),e.jsx(P,{id:"distance",type:"number",min:"0",step:"0.1",value:t.distance,onChange:i=>s(u=>({...u,distance:i.target.value}))})]})]}),c.stepsPerKm&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(w,{htmlFor:"steps",children:["Pasos ",t.steps&&`(calculado: ${t.steps})`]}),e.jsx(P,{id:"steps",type:"number",min:"0",value:t.steps,onChange:i=>s(u=>({...u,steps:i.target.value})),placeholder:"N√∫mero de pasos"})]}),r>0&&e.jsx("div",{className:"p-4 bg-muted rounded-md",children:e.jsxs("p",{className:"text-sm font-medium text-muted-foreground",children:["Calor√≠as estimadas: ",r," kcal"]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"calories",children:"Calor√≠as"}),e.jsx(P,{id:"calories",type:"number",min:"0",value:t.calories,onChange:i=>s(u=>({...u,calories:i.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(w,{htmlFor:"notes",children:"Notas"}),e.jsx(we,{id:"notes",value:t.notes,onChange:i=>s(u=>({...u,notes:i.target.value})),placeholder:"A√±ade notas sobre el ejercicio..."})]}),e.jsxs(Se,{className:"gap-3 sm:gap-0",children:[e.jsx(F,{type:"button",variant:"outline",className:"flex-1 sm:flex-none",onClick:n,children:"Cancelar"}),e.jsx(F,{type:"submit",className:"flex-1 sm:flex-none",children:a?"Actualizar":"Guardar"})]})]}):e.jsxs(ee,{defaultValue:"cardio",className:"w-full",children:[e.jsx(se,{className:"w-full h-12 grid grid-cols-3 mb-4",children:Object.entries(Z).map(([i,u])=>e.jsxs(I,{value:i,className:"flex items-center gap-2 text-base p-3",children:[e.jsx("span",{className:"text-xl",children:u.icon}),e.jsx("span",{children:u.name})]},i))}),Object.entries(Z).map(([i])=>e.jsx(R,{value:i,className:"mt-4",children:e.jsx("div",{className:"grid grid-cols-2 gap-3",children:M.filter(u=>u.category===i).map(u=>e.jsxs(F,{type:"button",variant:"outline",className:"flex flex-col items-center p-6 h-auto gap-3",onClick:()=>g(u),children:[e.jsx("span",{className:"text-3xl",children:u.icon}),e.jsx("span",{className:"text-sm font-normal text-center",children:u.name})]},u.id))})},i))]})})]})})},Re=({exerciseLogs:l,summary:n})=>{const p=_.useMemo(()=>n||{totalCalories:l.reduce((t,s)=>t+(s.calories||0),0),totalSteps:l.reduce((t,s)=>t+(s.steps||0),0),totalDuration:l.reduce((t,s)=>t+(s.duration||0),0),totalDistance:l.reduce((t,s)=>t+(s.distance||0),0),categoryStats:l.reduce((t,s)=>{const r=M.find(o=>o.id===s.exerciseId);return r&&(t[r.category]||(t[r.category]={count:0,duration:0,calories:0}),t[r.category].count+=1,t[r.category].duration+=s.duration||0,t[r.category].calories+=s.calories||0),t},{})},[l,n]),a=t=>new Date(t).toLocaleDateString("es-ES",{month:"short",day:"numeric"}),c=(t,s)=>typeof t=="string"?new Date(t).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):[t.toLocaleString(),s],f=_.useMemo(()=>{const t=new Date,s=[];for(let r=6;r>=0;r--){const o=new Date(t);o.setDate(o.getDate()-r);const m=E(o);s.push({date:m,calories:0,steps:0,duration:0,distance:0})}return l.forEach(r=>{const o=s.find(m=>m.date===E(new Date));o&&(o.calories+=r.calories||0,o.steps+=r.steps||0,o.duration+=r.duration||0,o.distance+=(r.distance||0)/1e3)}),s},[l]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(b,{children:e.jsxs(S,{className:"p-6 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-muted rounded-lg",children:e.jsx(Y,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Calor√≠as"}),e.jsx("h4",{className:"text-2xl font-bold",children:p.totalCalories})]})]})}),e.jsx(b,{children:e.jsxs(S,{className:"p-6 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-muted rounded-lg",children:e.jsx(ce,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Pasos"}),e.jsx("h4",{className:"text-2xl font-bold",children:p.totalSteps.toLocaleString()})]})]})}),e.jsx(b,{children:e.jsxs(S,{className:"p-6 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-muted rounded-lg",children:e.jsx(xe,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Tiempo"}),e.jsxs("h4",{className:"text-2xl font-bold",children:[p.totalDuration," min"]})]})]})}),e.jsx(b,{children:e.jsxs(S,{className:"p-6 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-muted rounded-lg",children:e.jsx(he,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Distancia"}),e.jsxs("h4",{className:"text-2xl font-bold",children:[(p.totalDistance/1e3).toFixed(1)," km"]})]})]})})]}),e.jsxs(b,{children:[e.jsx(J,{children:e.jsx(Q,{children:"Progreso"})}),e.jsx(S,{children:e.jsxs(ee,{defaultValue:"calories",children:[e.jsxs(se,{className:"grid grid-cols-4 h-12",children:[e.jsx(I,{value:"calories",className:"text-base",children:"Calor√≠as"}),e.jsx(I,{value:"steps",className:"text-base",children:"Pasos"}),e.jsx(I,{value:"duration",className:"text-base",children:"Tiempo"}),e.jsx(I,{value:"distance",className:"text-base",children:"Distancia"})]}),e.jsx(R,{value:"calories",className:"h-[300px] pt-4",children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(G,{data:f,children:[e.jsx(L,{strokeDasharray:"3 3"}),e.jsx($,{dataKey:"date",tickFormatter:a}),e.jsx(T,{}),e.jsx(K,{formatter:c,labelFormatter:a}),e.jsx(z,{}),e.jsx(V,{type:"monotone",dataKey:"calories",stroke:"#f97316",name:"Calor√≠as",dot:!0})]})})}),e.jsx(R,{value:"steps",className:"h-[300px] pt-4",children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(G,{data:f,children:[e.jsx(L,{strokeDasharray:"3 3"}),e.jsx($,{dataKey:"date",tickFormatter:a}),e.jsx(T,{}),e.jsx(K,{formatter:c,labelFormatter:a}),e.jsx(z,{}),e.jsx(V,{type:"monotone",dataKey:"steps",stroke:"#3b82f6",name:"Pasos",dot:!0})]})})}),e.jsx(R,{value:"duration",className:"h-[300px] pt-4",children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(G,{data:f,children:[e.jsx(L,{strokeDasharray:"3 3"}),e.jsx($,{dataKey:"date",tickFormatter:a}),e.jsx(T,{}),e.jsx(K,{formatter:c,labelFormatter:a}),e.jsx(z,{}),e.jsx(V,{type:"monotone",dataKey:"duration",stroke:"#22c55e",name:"Minutos",dot:!0})]})})}),e.jsx(R,{value:"distance",className:"h-[300px] pt-4",children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(G,{data:f,children:[e.jsx(L,{strokeDasharray:"3 3"}),e.jsx($,{dataKey:"date",tickFormatter:a}),e.jsx(T,{}),e.jsx(K,{formatter:c,labelFormatter:a}),e.jsx(z,{}),e.jsx(V,{type:"monotone",dataKey:"distance",stroke:"#a855f7",name:"Kil√≥metros",dot:!0})]})})})]})})]}),e.jsxs(b,{children:[e.jsx(J,{children:e.jsx(Q,{children:"Resumen por categor√≠a"})}),e.jsx(S,{children:e.jsx("div",{className:"h-[300px]",children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(pe,{data:Object.entries(Z).map(([t,s])=>{const r=p.categoryStats[t]||{count:0,duration:0,calories:0};return{category:s.name,minutos:r.duration,calorias:r.calories}}),children:[e.jsx(L,{strokeDasharray:"3 3"}),e.jsx($,{dataKey:"category"}),e.jsx(T,{yAxisId:"left",orientation:"left",stroke:"#f97316"}),e.jsx(T,{yAxisId:"right",orientation:"right",stroke:"#22c55e"}),e.jsx(K,{}),e.jsx(z,{}),e.jsx(te,{yAxisId:"left",dataKey:"calorias",fill:"#f97316",name:"Calor√≠as"}),e.jsx(te,{yAxisId:"right",dataKey:"minutos",fill:"#22c55e",name:"Minutos"})]})})})})]})]})},Me=(l,n)=>{const[p,a]=N.useState(null),[c,f]=N.useState(!0),[t,s]=N.useState(null),{user:r}=W();return N.useEffect(()=>{(async()=>{if(a(null),!!r){f(!0),s(null);try{const m=[],g=new Date(l);for(;g<=n;)m.push(E(g)),g.setDate(g.getDate()+1);const x=(await Promise.all(m.map(d=>re(B(O,"exercises",`${r.uid}_${d}`))))).map((d,h)=>{var j;return{date:m[h],calories:d.exists()&&((j=d.data().summary)==null?void 0:j.totalCalories)||0}});a({dailyStats:x})}catch(m){console.error("Error al cargar estad√≠sticas:",m),s(m instanceof Error?m.message:"Error al cargar estad√≠sticas")}finally{f(!1)}}})()},[r,l,n]),{stats:p,loading:c,error:t}},Ae=({selectedDate:l,goal:n=500})=>{const[p,a]=N.useState(q(l));N.useEffect(()=>{a(q(l))},[l]);const c=N.useMemo(()=>q(p),[p]),f=N.useMemo(()=>ke(p),[p]),{stats:t,loading:s}=Me(c,f),r=N.useMemo(()=>{const m={};return t==null||t.dailyStats.forEach(({date:g,calories:y})=>{m[g]=y}),m},[t]),o=m=>{const g=E(m.date),y=r[g]||0,x=Math.min(y/n,1),d=28,h=3,j=(d-h)/2,v=2*Math.PI*j,C=v-x*v,D=y>=n;return e.jsxs("div",{className:"relative flex items-center justify-center w-7 h-7",children:[e.jsxs("svg",{width:d,height:d,className:"absolute",children:[e.jsx("circle",{cx:d/2,cy:d/2,r:j,stroke:D?"#fed7aa":"#e5e7eb",strokeWidth:h,fill:"none"}),e.jsx("circle",{cx:d/2,cy:d/2,r:j,stroke:D?"#f97316":"#9ca3af",strokeWidth:h,fill:"none",strokeDasharray:v,strokeDashoffset:C,strokeLinecap:"round",style:{transform:"rotate(-90deg)",transformOrigin:"50% 50%"}})]}),e.jsx("span",{className:"text-[10px] font-medium z-10",children:m.date.getDate()})]})};return e.jsxs(b,{className:"w-full",children:[e.jsxs(J,{className:"flex flex-col items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5 text-orange-600"}),e.jsx(Q,{className:"text-center",children:"Historial Mensual"})]}),e.jsxs(S,{className:"relative p-4",children:[s&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/50 z-10",children:e.jsx(je,{className:"w-6 h-6 animate-spin"})}),e.jsx(Ee,{month:p,onMonthChange:a,showOutsideDays:!0,components:{DayContent:o},className:"p-0 w-full"})]})]})},ie=N.forwardRef(({selectedDate:l},n)=>{const{user:p}=W(),{exerciseLogs:a,summary:c,status:f,error:t,logExercise:s,updateExerciseLog:r,deleteExerciseLog:o}=Fe(l),[m,g]=N.useState(!1),[y,x]=N.useState(null);return N.useImperativeHandle(n,()=>({openAddExercise:()=>g(!0)})),p?e.jsx(b,{className:"w-full",children:e.jsxs(S,{className:"p-6",children:[e.jsxs(ee,{defaultValue:"list",className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(se,{children:[e.jsx(I,{value:"list",children:"Lista"}),e.jsxs(I,{value:"stats",className:"gap-2",children:[e.jsx(ge,{className:"w-4 h-4"}),"Estad√≠sticas"]})]}),e.jsxs(F,{onClick:()=>g(!0),className:"gap-2 hidden sm:flex",children:[e.jsx(fe,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Agregar"})]})]}),e.jsx(R,{value:"list",className:"m-0",children:e.jsx(Ie,{exerciseLogs:a,onUpdate:x,onDelete:o,isLoading:f==="loading"})}),e.jsx(R,{value:"stats",className:"m-0",children:e.jsx(Re,{exerciseLogs:a,summary:c})})]}),t&&e.jsx("p",{className:"mt-4 text-sm text-red-500",children:t}),e.jsx(ae,{isOpen:m,onClose:()=>g(!1),onSubmit:s,selectedDate:l}),y!==null&&e.jsx(ae,{isOpen:!0,onClose:()=>x(null),onSubmit:d=>{r(y,d),x(null)},initialData:a[y],selectedDate:l})]})}):e.jsx(b,{className:"w-full",children:e.jsx(S,{className:"p-4 text-center",children:e.jsx("p",{children:"Inicia sesi√≥n para registrar tus ejercicios"})})})});ie.displayName="Exercise";const qe=()=>{const[l,n]=N.useState(new Date),{user:p}=W(),a=N.useRef(null),c=()=>{var f;(f=a.current)==null||f.openAddExercise()};return p?e.jsxs(ne,{showFloatingButton:!0,onFloatingButtonClick:c,floatingButtonLabel:"Agregar ejercicio",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Registro de Ejercicio"}),e.jsx("p",{className:"text-gray-500",children:"Registra y monitorea tus actividades f√≠sicas diarias"})]}),e.jsx(Ce,{selectedDate:l,onChange:n}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-[1fr_300px]",children:[e.jsx(ie,{ref:a,selectedDate:l}),e.jsx(Ae,{selectedDate:l})]})]}):e.jsx("div",{className:"container max-w-4xl mx-auto py-6",children:e.jsx(b,{children:e.jsxs(S,{className:"p-8 text-center",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Inicia sesi√≥n"}),e.jsx("p",{className:"text-gray-500",children:"Necesitas iniciar sesi√≥n para registrar y ver tus ejercicios"})]})})})};export{qe as default};
