const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["chunks/DailySummary-BMy34lEc.js","chunks/ui-vendor-DsUuK6wp.js","chunks/react-vendor-Cob1R1W1.js","chunks/firebase-DYY3nxBM.js","chunks/MoodChart-Df1fa5im.js","chunks/chart-vendor-B1_5lEUC.js","chunks/utils-vendor-B5tVLpsu.js","chunks/skeleton-B-LSwoX-.js","chunks/WeeklySummary-BxvxpQ8z.js","chunks/AiInsightCard-BNWGylJB.js","chunks/DailyDashboard-DFGd6eFI.js","chunks/WeeklyDashboard-BYzlkyRr.js"])))=>i.map(i=>d[i]);
var TR=Object.defineProperty;var Qv=t=>{throw TypeError(t)};var DR=(t,s,n)=>s in t?TR(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n;var he=(t,s,n)=>DR(t,typeof s!="symbol"?s+"":s,n),ey=(t,s,n)=>s.has(t)||Qv("Cannot "+n);var To=(t,s,n)=>(ey(t,s,"read from private field"),n?n.call(t):s.get(t)),Cu=(t,s,n)=>s.has(t)?Qv("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(t):s.set(t,n),Eu=(t,s,n,r)=>(ey(t,s,"write to private field"),r?r.call(t,n):s.set(t,n),n);import{j as e,S as kR,P as jt,c as za,a as gi,b as Al,D as Xp,C as Zp,d as Cj,u as bs,e as _l,f as Oa,R as Qp,A as Tm,g as it,h as ex,O as Rl,i as Dm,k as Ol,l as ud,T as Pl,m as Ml,n as km,o as Am,p as AR,q as pi,r as Ej,s as Vi,t as Tj,v as Dj,w as kj,x as Aj,F as _j,y as _m,z as Rm,B as Rj,I as Oj,E as _R,H as RR,G as Pj,J as Mj,K as OR,L as Ij,M as Lj,W as PR,N as $j,Q as zj,U as MR,V as Fj,X as Bj,Y as Hj,Z as Uj,_ as Wj,$ as Yj,a0 as Vj,a1 as IR,a2 as LR,a3 as $R,a4 as zR,a5 as FR,a6 as BR}from"../chunks/ui-vendor-DsUuK6wp.js";import{a as Ki,r as f,R as HR,c as ee,b as UR,d as fc}from"../chunks/react-vendor-Cob1R1W1.js";import{c as WR,a as Il,b as Nf,d as pc,e as xc,f as YR,g as nt,s as ps,h as os,i as ra,j as Kc,k as ci,l as ty,m as rp,n as vr,o as ls,p as sy,q as Mc,r as VR,t as Jc,u as tx,v as Is,w as pn,x as $c,y as di,z as GR,A as qR,B as Qu,C as KR,D as JR,E as XR,F as ZR,G as Sf,H as ny,I as Gj,J as Rr,K as sx,L as Pa,M as QR,N as eO,O as qj,P as tO,Q as sO,R as Ro,S as Kj}from"../chunks/utils-vendor-B5tVLpsu.js";import{i as nO,g as rO,c as aO,e as iO,d as oO,f as lO,h as Jj,o as cO,s as dO,G as uO,j as mO,w as hO,k as ke,l as ot,m as ht,n as Zt,p as Bt,q as Vo,r as xn,t as Et,u as gn,T as ka,v as wl,x as ar,y as fO,z as Xj,A as pO}from"../chunks/firebase-DYY3nxBM.js";import{L as xO,D as nx,a as Zj,S as rx,b as Om,B as md,T as zo,U as Qj,C as gO,K as ew,F as tw,c as ax,d as em,e as Ma,X as Ws,f as Gn,g as sw,h as aa,i as tm,j as Nl,k as br,W as ap,l as ro,m as vO,V as yO,n as bO,o as Wu,p as ip,q as ix,r as ns,P as cs,s as fs,t as ox,u as Sn,v as jr,w as op,x as lp,y as nw,z as rw,A as aw,E as jO,G as en,H as Tu,I as Sl,R as ao,J as Fo,M as Fa,N as On,O as Oo,Q as Aa,Y as Qr,Z as _r,_ as Pn,$ as Ji,a0 as hd,a1 as fd,a2 as pd,a3 as io,a4 as Pm,a5 as Xc,a6 as Mm,a7 as oo,a8 as wO,a9 as lx,aa as iw,ab as Ll,ac as Bo,ad as Gs,ae as NO,af as ow,ag as SO,ah as Cl,ai as cx,aj as CO,ak as EO,al as da,am as TO,an as DO,ao as $l,ap as xd,aq as lw,ar as cw,as as kO,at as cp,au as AO,av as ry,aw as ai,ax as gd,ay as _O,az as RO,aA as dw,aB as El,aC as uw,aD as dp,aE as mw,aF as hw,aG as Zc,aH as OO,aI as ii,aJ as PO,aK as MO,aL as Ia,aM as zl,aN as lo,aO as fw,aP as IO,aQ as LO,aR as pw,aS as $O,aT as zO,aU as FO,aV as dx,aW as up,aX as ay,aY as iy}from"../chunks/chart-vendor-B1_5lEUC.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=n(a);fetch(a.href,i)}})();var mp={},oy=Ki;mp.createRoot=oy.createRoot,mp.hydrateRoot=oy.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Qc(){return Qc=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var n=arguments[s];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Qc.apply(this,arguments)}var Xi;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(Xi||(Xi={}));const ly="popstate";function BO(t){t===void 0&&(t={});function s(r,a){let{pathname:i,search:o,hash:c}=r.location;return hp("",{pathname:i,search:o,hash:c},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function n(r,a){return typeof a=="string"?a:sm(a)}return UO(s,n,null,t)}function Ys(t,s){if(t===!1||t===null||typeof t>"u")throw new Error(s)}function xw(t,s){if(!t){typeof console<"u"&&console.warn(s);try{throw new Error(s)}catch{}}}function HO(){return Math.random().toString(36).substr(2,8)}function cy(t,s){return{usr:t.state,key:t.key,idx:s}}function hp(t,s,n,r){return n===void 0&&(n=null),Qc({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof s=="string"?Fl(s):s,{state:n,key:s&&s.key||r||HO()})}function sm(t){let{pathname:s="/",search:n="",hash:r=""}=t;return n&&n!=="?"&&(s+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(s+=r.charAt(0)==="#"?r:"#"+r),s}function Fl(t){let s={};if(t){let n=t.indexOf("#");n>=0&&(s.hash=t.substr(n),t=t.substr(0,n));let r=t.indexOf("?");r>=0&&(s.search=t.substr(r),t=t.substr(0,r)),t&&(s.pathname=t)}return s}function UO(t,s,n,r){r===void 0&&(r={});let{window:a=document.defaultView,v5Compat:i=!1}=r,o=a.history,c=Xi.Pop,u=null,d=h();d==null&&(d=0,o.replaceState(Qc({},o.state,{idx:d}),""));function h(){return(o.state||{idx:null}).idx}function p(){c=Xi.Pop;let v=h(),w=v==null?null:v-d;d=v,u&&u({action:c,location:b.location,delta:w})}function g(v,w){c=Xi.Push;let N=hp(b.location,v,w);d=h()+1;let S=cy(N,d),E=b.createHref(N);try{o.pushState(S,"",E)}catch(k){if(k instanceof DOMException&&k.name==="DataCloneError")throw k;a.location.assign(E)}i&&u&&u({action:c,location:b.location,delta:1})}function x(v,w){c=Xi.Replace;let N=hp(b.location,v,w);d=h();let S=cy(N,d),E=b.createHref(N);o.replaceState(S,"",E),i&&u&&u({action:c,location:b.location,delta:0})}function y(v){let w=a.location.origin!=="null"?a.location.origin:a.location.href,N=typeof v=="string"?v:sm(v);return N=N.replace(/ $/,"%20"),Ys(w,"No window.location.(origin|href) available to create URL for href: "+N),new URL(N,w)}let b={get action(){return c},get location(){return t(a,o)},listen(v){if(u)throw new Error("A history only accepts one active listener");return a.addEventListener(ly,p),u=v,()=>{a.removeEventListener(ly,p),u=null}},createHref(v){return s(a,v)},createURL:y,encodeLocation(v){let w=y(v);return{pathname:w.pathname,search:w.search,hash:w.hash}},push:g,replace:x,go(v){return o.go(v)}};return b}var dy;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(dy||(dy={}));function WO(t,s,n){return n===void 0&&(n="/"),YO(t,s,n)}function YO(t,s,n,r){let a=typeof s=="string"?Fl(s):s,i=ux(a.pathname||"/",n);if(i==null)return null;let o=gw(t);VO(o);let c=null;for(let u=0;c==null&&u<o.length;++u){let d=rP(i);c=tP(o[u],d)}return c}function gw(t,s,n,r){s===void 0&&(s=[]),n===void 0&&(n=[]),r===void 0&&(r="");let a=(i,o,c)=>{let u={relativePath:c===void 0?i.path||"":c,caseSensitive:i.caseSensitive===!0,childrenIndex:o,route:i};u.relativePath.startsWith("/")&&(Ys(u.relativePath.startsWith(r),'Absolute route path "'+u.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),u.relativePath=u.relativePath.slice(r.length));let d=to([r,u.relativePath]),h=n.concat(u);i.children&&i.children.length>0&&(Ys(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+d+'".')),gw(i.children,s,h,d)),!(i.path==null&&!i.index)&&s.push({path:d,score:QO(d,i.index),routesMeta:h})};return t.forEach((i,o)=>{var c;if(i.path===""||!((c=i.path)!=null&&c.includes("?")))a(i,o);else for(let u of vw(i.path))a(i,o,u)}),s}function vw(t){let s=t.split("/");if(s.length===0)return[];let[n,...r]=s,a=n.endsWith("?"),i=n.replace(/\?$/,"");if(r.length===0)return a?[i,""]:[i];let o=vw(r.join("/")),c=[];return c.push(...o.map(u=>u===""?i:[i,u].join("/"))),a&&c.push(...o),c.map(u=>t.startsWith("/")&&u===""?"/":u)}function VO(t){t.sort((s,n)=>s.score!==n.score?n.score-s.score:eP(s.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const GO=/^:[\w-]+$/,qO=3,KO=2,JO=1,XO=10,ZO=-2,uy=t=>t==="*";function QO(t,s){let n=t.split("/"),r=n.length;return n.some(uy)&&(r+=ZO),s&&(r+=KO),n.filter(a=>!uy(a)).reduce((a,i)=>a+(GO.test(i)?qO:i===""?JO:XO),r)}function eP(t,s){return t.length===s.length&&t.slice(0,-1).every((r,a)=>r===s[a])?t[t.length-1]-s[s.length-1]:0}function tP(t,s,n){let{routesMeta:r}=t,a={},i="/",o=[];for(let c=0;c<r.length;++c){let u=r[c],d=c===r.length-1,h=i==="/"?s:s.slice(i.length)||"/",p=sP({path:u.relativePath,caseSensitive:u.caseSensitive,end:d},h),g=u.route;if(!p)return null;Object.assign(a,p.params),o.push({params:a,pathname:to([i,p.pathname]),pathnameBase:lP(to([i,p.pathnameBase])),route:g}),p.pathnameBase!=="/"&&(i=to([i,p.pathnameBase]))}return o}function sP(t,s){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=nP(t.path,t.caseSensitive,t.end),a=s.match(n);if(!a)return null;let i=a[0],o=i.replace(/(.)\/+$/,"$1"),c=a.slice(1);return{params:r.reduce((d,h,p)=>{let{paramName:g,isOptional:x}=h;if(g==="*"){let b=c[p]||"";o=i.slice(0,i.length-b.length).replace(/(.)\/+$/,"$1")}const y=c[p];return x&&!y?d[g]=void 0:d[g]=(y||"").replace(/%2F/g,"/"),d},{}),pathname:i,pathnameBase:o,pattern:t}}function nP(t,s,n){s===void 0&&(s=!1),n===void 0&&(n=!0),xw(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let r=[],a="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,c,u)=>(r.push({paramName:c,isOptional:u!=null}),u?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(r.push({paramName:"*"}),a+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?a+="\\/*$":t!==""&&t!=="/"&&(a+="(?:(?=\\/|$))"),[new RegExp(a,s?void 0:"i"),r]}function rP(t){try{return t.split("/").map(s=>decodeURIComponent(s).replace(/\//g,"%2F")).join("/")}catch(s){return xw(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+s+").")),t}}function ux(t,s){if(s==="/")return t;if(!t.toLowerCase().startsWith(s.toLowerCase()))return null;let n=s.endsWith("/")?s.length-1:s.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}function aP(t,s){s===void 0&&(s="/");let{pathname:n,search:r="",hash:a=""}=typeof t=="string"?Fl(t):t;return{pathname:n?n.startsWith("/")?n:iP(n,s):s,search:cP(r),hash:dP(a)}}function iP(t,s){let n=s.replace(/\/+$/,"").split("/");return t.split("/").forEach(a=>{a===".."?n.length>1&&n.pop():a!=="."&&n.push(a)}),n.length>1?n.join("/"):"/"}function Cf(t,s,n,r){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+s+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function oP(t){return t.filter((s,n)=>n===0||s.route.path&&s.route.path.length>0)}function mx(t,s){let n=oP(t);return s?n.map((r,a)=>a===n.length-1?r.pathname:r.pathnameBase):n.map(r=>r.pathnameBase)}function hx(t,s,n,r){r===void 0&&(r=!1);let a;typeof t=="string"?a=Fl(t):(a=Qc({},t),Ys(!a.pathname||!a.pathname.includes("?"),Cf("?","pathname","search",a)),Ys(!a.pathname||!a.pathname.includes("#"),Cf("#","pathname","hash",a)),Ys(!a.search||!a.search.includes("#"),Cf("#","search","hash",a)));let i=t===""||a.pathname==="",o=i?"/":a.pathname,c;if(o==null)c=n;else{let p=s.length-1;if(!r&&o.startsWith("..")){let g=o.split("/");for(;g[0]==="..";)g.shift(),p-=1;a.pathname=g.join("/")}c=p>=0?s[p]:"/"}let u=aP(a,c),d=o&&o!=="/"&&o.endsWith("/"),h=(i||o===".")&&n.endsWith("/");return!u.pathname.endsWith("/")&&(d||h)&&(u.pathname+="/"),u}const to=t=>t.join("/").replace(/\/\/+/g,"/"),lP=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),cP=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,dP=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function uP(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const yw=["post","put","patch","delete"];new Set(yw);const mP=["get",...yw];new Set(mP);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ed(){return ed=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var n=arguments[s];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},ed.apply(this,arguments)}const fx=f.createContext(null),hP=f.createContext(null),uo=f.createContext(null),Im=f.createContext(null),Ba=f.createContext({outlet:null,matches:[],isDataRoute:!1}),bw=f.createContext(null);function fP(t,s){let{relative:n}=s===void 0?{}:s;Bl()||Ys(!1);let{basename:r,navigator:a}=f.useContext(uo),{hash:i,pathname:o,search:c}=ww(t,{relative:n}),u=o;return r!=="/"&&(u=o==="/"?r:to([r,o])),a.createHref({pathname:u,search:c,hash:i})}function Bl(){return f.useContext(Im)!=null}function Ln(){return Bl()||Ys(!1),f.useContext(Im).location}function jw(t){f.useContext(uo).static||f.useLayoutEffect(t)}function Qt(){let{isDataRoute:t}=f.useContext(Ba);return t?kP():pP()}function pP(){Bl()||Ys(!1);let t=f.useContext(fx),{basename:s,future:n,navigator:r}=f.useContext(uo),{matches:a}=f.useContext(Ba),{pathname:i}=Ln(),o=JSON.stringify(mx(a,n.v7_relativeSplatPath)),c=f.useRef(!1);return jw(()=>{c.current=!0}),f.useCallback(function(d,h){if(h===void 0&&(h={}),!c.current)return;if(typeof d=="number"){r.go(d);return}let p=hx(d,JSON.parse(o),i,h.relative==="path");t==null&&s!=="/"&&(p.pathname=p.pathname==="/"?s:to([s,p.pathname])),(h.replace?r.replace:r.push)(p,h.state,h)},[s,r,o,i,t])}const xP=f.createContext(null);function gP(t){let s=f.useContext(Ba).outlet;return s&&f.createElement(xP.Provider,{value:t},s)}function px(){let{matches:t}=f.useContext(Ba),s=t[t.length-1];return s?s.params:{}}function ww(t,s){let{relative:n}=s===void 0?{}:s,{future:r}=f.useContext(uo),{matches:a}=f.useContext(Ba),{pathname:i}=Ln(),o=JSON.stringify(mx(a,r.v7_relativeSplatPath));return f.useMemo(()=>hx(t,JSON.parse(o),i,n==="path"),[t,o,i,n])}function vP(t,s){return yP(t,s)}function yP(t,s,n,r){Bl()||Ys(!1);let{navigator:a}=f.useContext(uo),{matches:i}=f.useContext(Ba),o=i[i.length-1],c=o?o.params:{};o&&o.pathname;let u=o?o.pathnameBase:"/";o&&o.route;let d=Ln(),h;if(s){var p;let v=typeof s=="string"?Fl(s):s;u==="/"||(p=v.pathname)!=null&&p.startsWith(u)||Ys(!1),h=v}else h=d;let g=h.pathname||"/",x=g;if(u!=="/"){let v=u.replace(/^\//,"").split("/");x="/"+g.replace(/^\//,"").split("/").slice(v.length).join("/")}let y=WO(t,{pathname:x}),b=SP(y&&y.map(v=>Object.assign({},v,{params:Object.assign({},c,v.params),pathname:to([u,a.encodeLocation?a.encodeLocation(v.pathname).pathname:v.pathname]),pathnameBase:v.pathnameBase==="/"?u:to([u,a.encodeLocation?a.encodeLocation(v.pathnameBase).pathname:v.pathnameBase])})),i,n,r);return s&&b?f.createElement(Im.Provider,{value:{location:ed({pathname:"/",search:"",hash:"",state:null,key:"default"},h),navigationType:Xi.Pop}},b):b}function bP(){let t=DP(),s=uP(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,a={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return f.createElement(f.Fragment,null,f.createElement("h2",null,"Unexpected Application Error!"),f.createElement("h3",{style:{fontStyle:"italic"}},s),n?f.createElement("pre",{style:a},n):null,null)}const jP=f.createElement(bP,null);class wP extends f.Component{constructor(s){super(s),this.state={location:s.location,revalidation:s.revalidation,error:s.error}}static getDerivedStateFromError(s){return{error:s}}static getDerivedStateFromProps(s,n){return n.location!==s.location||n.revalidation!=="idle"&&s.revalidation==="idle"?{error:s.error,location:s.location,revalidation:s.revalidation}:{error:s.error!==void 0?s.error:n.error,location:n.location,revalidation:s.revalidation||n.revalidation}}componentDidCatch(s,n){console.error("React Router caught the following error during render",s,n)}render(){return this.state.error!==void 0?f.createElement(Ba.Provider,{value:this.props.routeContext},f.createElement(bw.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function NP(t){let{routeContext:s,match:n,children:r}=t,a=f.useContext(fx);return a&&a.static&&a.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(a.staticContext._deepestRenderedBoundaryId=n.route.id),f.createElement(Ba.Provider,{value:s},r)}function SP(t,s,n,r){var a;if(s===void 0&&(s=[]),n===void 0&&(n=null),r===void 0&&(r=null),t==null){var i;if(!n)return null;if(n.errors)t=n.matches;else if((i=r)!=null&&i.v7_partialHydration&&s.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let o=t,c=(a=n)==null?void 0:a.errors;if(c!=null){let h=o.findIndex(p=>p.route.id&&(c==null?void 0:c[p.route.id])!==void 0);h>=0||Ys(!1),o=o.slice(0,Math.min(o.length,h+1))}let u=!1,d=-1;if(n&&r&&r.v7_partialHydration)for(let h=0;h<o.length;h++){let p=o[h];if((p.route.HydrateFallback||p.route.hydrateFallbackElement)&&(d=h),p.route.id){let{loaderData:g,errors:x}=n,y=p.route.loader&&g[p.route.id]===void 0&&(!x||x[p.route.id]===void 0);if(p.route.lazy||y){u=!0,d>=0?o=o.slice(0,d+1):o=[o[0]];break}}}return o.reduceRight((h,p,g)=>{let x,y=!1,b=null,v=null;n&&(x=c&&p.route.id?c[p.route.id]:void 0,b=p.route.errorElement||jP,u&&(d<0&&g===0?(AP("route-fallback"),y=!0,v=null):d===g&&(y=!0,v=p.route.hydrateFallbackElement||null)));let w=s.concat(o.slice(0,g+1)),N=()=>{let S;return x?S=b:y?S=v:p.route.Component?S=f.createElement(p.route.Component,null):p.route.element?S=p.route.element:S=h,f.createElement(NP,{match:p,routeContext:{outlet:h,matches:w,isDataRoute:n!=null},children:S})};return n&&(p.route.ErrorBoundary||p.route.errorElement||g===0)?f.createElement(wP,{location:n.location,revalidation:n.revalidation,component:b,error:x,children:N(),routeContext:{outlet:null,matches:w,isDataRoute:!0}}):N()},null)}var Nw=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(Nw||{}),Sw=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(Sw||{});function CP(t){let s=f.useContext(fx);return s||Ys(!1),s}function EP(t){let s=f.useContext(hP);return s||Ys(!1),s}function TP(t){let s=f.useContext(Ba);return s||Ys(!1),s}function Cw(t){let s=TP(),n=s.matches[s.matches.length-1];return n.route.id||Ys(!1),n.route.id}function DP(){var t;let s=f.useContext(bw),n=EP(),r=Cw();return s!==void 0?s:(t=n.errors)==null?void 0:t[r]}function kP(){let{router:t}=CP(Nw.UseNavigateStable),s=Cw(Sw.UseNavigateStable),n=f.useRef(!1);return jw(()=>{n.current=!0}),f.useCallback(function(a,i){i===void 0&&(i={}),n.current&&(typeof a=="number"?t.navigate(a):t.navigate(a,ed({fromRouteId:s},i)))},[t,s])}const my={};function AP(t,s,n){my[t]||(my[t]=!0)}function _P(t,s){t==null||t.v7_startTransition,t==null||t.v7_relativeSplatPath}function Ef(t){let{to:s,replace:n,state:r,relative:a}=t;Bl()||Ys(!1);let{future:i,static:o}=f.useContext(uo),{matches:c}=f.useContext(Ba),{pathname:u}=Ln(),d=Qt(),h=hx(s,mx(c,i.v7_relativeSplatPath),u,a==="path"),p=JSON.stringify(h);return f.useEffect(()=>d(JSON.parse(p),{replace:n,state:r,relative:a}),[d,p,a,n,r]),null}function RP(t){return gP(t.context)}function ms(t){Ys(!1)}function OP(t){let{basename:s="/",children:n=null,location:r,navigationType:a=Xi.Pop,navigator:i,static:o=!1,future:c}=t;Bl()&&Ys(!1);let u=s.replace(/^\/*/,"/"),d=f.useMemo(()=>({basename:u,navigator:i,static:o,future:ed({v7_relativeSplatPath:!1},c)}),[u,c,i,o]);typeof r=="string"&&(r=Fl(r));let{pathname:h="/",search:p="",hash:g="",state:x=null,key:y="default"}=r,b=f.useMemo(()=>{let v=ux(h,u);return v==null?null:{location:{pathname:v,search:p,hash:g,state:x,key:y},navigationType:a}},[u,h,p,g,x,y,a]);return b==null?null:f.createElement(uo.Provider,{value:d},f.createElement(Im.Provider,{children:n,value:b}))}function PP(t){let{children:s,location:n}=t;return vP(fp(s),n)}new Promise(()=>{});function fp(t,s){s===void 0&&(s=[]);let n=[];return f.Children.forEach(t,(r,a)=>{if(!f.isValidElement(r))return;let i=[...s,a];if(r.type===f.Fragment){n.push.apply(n,fp(r.props.children,i));return}r.type!==ms&&Ys(!1),!r.props.index||!r.props.children||Ys(!1);let o={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=fp(r.props.children,i)),n.push(o)}),n}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function pp(){return pp=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var n=arguments[s];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},pp.apply(this,arguments)}function MP(t,s){if(t==null)return{};var n={},r=Object.keys(t),a,i;for(i=0;i<r.length;i++)a=r[i],!(s.indexOf(a)>=0)&&(n[a]=t[a]);return n}function IP(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function LP(t,s){return t.button===0&&(!s||s==="_self")&&!IP(t)}function xp(t){return t===void 0&&(t=""),new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((s,n)=>{let r=t[n];return s.concat(Array.isArray(r)?r.map(a=>[n,a]):[[n,r]])},[]))}function $P(t,s){let n=xp(t);return s&&s.forEach((r,a)=>{n.has(a)||s.getAll(a).forEach(i=>{n.append(a,i)})}),n}const zP=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],FP="6";try{window.__reactRouterVersion=FP}catch{}const BP="startTransition",hy=HR[BP];function HP(t){let{basename:s,children:n,future:r,window:a}=t,i=f.useRef();i.current==null&&(i.current=BO({window:a,v5Compat:!0}));let o=i.current,[c,u]=f.useState({action:o.action,location:o.location}),{v7_startTransition:d}=r||{},h=f.useCallback(p=>{d&&hy?hy(()=>u(p)):u(p)},[u,d]);return f.useLayoutEffect(()=>o.listen(h),[o,h]),f.useEffect(()=>_P(r),[r]),f.createElement(OP,{basename:s,children:n,location:c.location,navigationType:c.action,navigator:o,future:r})}const UP=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",WP=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Nn=f.forwardRef(function(s,n){let{onClick:r,relative:a,reloadDocument:i,replace:o,state:c,target:u,to:d,preventScrollReset:h,viewTransition:p}=s,g=MP(s,zP),{basename:x}=f.useContext(uo),y,b=!1;if(typeof d=="string"&&WP.test(d)&&(y=d,UP))try{let S=new URL(window.location.href),E=d.startsWith("//")?new URL(S.protocol+d):new URL(d),k=ux(E.pathname,x);E.origin===S.origin&&k!=null?d=k+E.search+E.hash:b=!0}catch{}let v=fP(d,{relative:a}),w=YP(d,{replace:o,state:c,target:u,preventScrollReset:h,relative:a,viewTransition:p});function N(S){r&&r(S),S.defaultPrevented||w(S)}return f.createElement("a",pp({},g,{href:y||v,onClick:b||i?r:N,ref:n,target:u}))});var fy;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(fy||(fy={}));var py;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(py||(py={}));function YP(t,s){let{target:n,replace:r,state:a,preventScrollReset:i,relative:o,viewTransition:c}=s===void 0?{}:s,u=Qt(),d=Ln(),h=ww(t,{relative:o});return f.useCallback(p=>{if(LP(p,n)){p.preventDefault();let g=r!==void 0?r:sm(d)===sm(h);u(t,{replace:g,state:a,preventScrollReset:i,relative:o,viewTransition:c})}},[d,u,h,r,a,n,t,i,o,c])}function VP(t){let s=f.useRef(xp(t)),n=f.useRef(!1),r=Ln(),a=f.useMemo(()=>$P(r.search,n.current?null:s.current),[r.search]),i=Qt(),o=f.useCallback((c,u)=>{const d=xp(typeof c=="function"?c(a):c);n.current=!0,i("?"+d,u)},[i,a]);return[a,o]}const GP="modulepreload",qP=function(t){return"/life-tracker/"+t},xy={},Hl=function(s,n,r){let a=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),c=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));a=Promise.allSettled(n.map(u=>{if(u=qP(u),u in xy)return;xy[u]=!0;const d=u.endsWith(".css"),h=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${h}`))return;const p=document.createElement("link");if(p.rel=d?"stylesheet":GP,d||(p.as="script"),p.crossOrigin="",p.href=u,c&&p.setAttribute("nonce",c),document.head.appendChild(p),d)return new Promise((g,x)=>{p.addEventListener("load",g),p.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${u}`)))})}))}function i(o){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=o,window.dispatchEvent(c),!c.defaultPrevented)throw o}return a.then(o=>{for(const c of o||[])c.status==="rejected"&&i(c.reason);return s().catch(i)})};function KP(t={}){const{immediate:s=!1,onNeedRefresh:n,onOfflineReady:r,onRegistered:a,onRegisteredSW:i,onRegisterError:o}=t;let c,u;const d=async(p=!0)=>{await u};async function h(){if("serviceWorker"in navigator){if(c=await Hl(async()=>{const{Workbox:p}=await import("../chunks/workbox-window.prod.es5-B9K5rw8f.js");return{Workbox:p}},[]).then(({Workbox:p})=>new p("/life-tracker/service-worker.js",{scope:"/life-tracker/",type:"classic"})).catch(p=>{o==null||o(p)}),!c)return;c.addEventListener("activated",p=>{(p.isUpdate||p.isExternal)&&window.location.reload()}),c.addEventListener("installed",p=>{p.isUpdate||r==null||r()}),c.register({immediate:s}).then(p=>{i?i("/life-tracker/service-worker.js",p):a==null||a(p)}).catch(p=>{o==null||o(p)})}}return u=h(),d}const vd=()=>{const[t,s]=f.useState(()=>{if(typeof window>"u")return{deviceType:"desktop",orientation:"landscape",isMobile:!1,isTablet:!1,isDesktop:!0,screenWidth:1920,screenHeight:1080,shouldShowDesktopNav:!0};const n=window.innerWidth,r=window.innerHeight,a=n<768,i=n>=768&&n<1024,o=n>=1024,c=n>=768;return{deviceType:n<768?"mobile":n<1024?"tablet":"desktop",orientation:n<r?"portrait":"landscape",isMobile:a,isTablet:i,isDesktop:o,screenWidth:n,screenHeight:r,shouldShowDesktopNav:c}});return f.useEffect(()=>{const n=()=>{const a=window.innerWidth,i=window.innerHeight,o=a<768,c=a>=768&&a<1024,u=a>=1024,d=a>=768;s({deviceType:a<768?"mobile":a<1024?"tablet":"desktop",orientation:a<i?"portrait":"landscape",isMobile:o,isTablet:c,isDesktop:u,screenWidth:a,screenHeight:i,shouldShowDesktopNav:d})},r=()=>{setTimeout(n,100)};return window.addEventListener("resize",n),window.addEventListener("orientationchange",r),()=>{window.removeEventListener("resize",n),window.removeEventListener("orientationchange",r)}},[]),t},JP=()=>{const[t,s]=f.useState(!1),[n,r]=f.useState(!1),[a,i]=f.useState(null);return f.useEffect(()=>{const c=window.matchMedia("(display-mode: standalone)").matches,u=window.navigator.standalone===!0;s(c||u);const d=h=>{h.preventDefault(),i(h),r(!0)};return window.addEventListener("beforeinstallprompt",d),()=>{window.removeEventListener("beforeinstallprompt",d)}},[]),{isInstalled:t,canInstall:n,promptInstall:async()=>{if(!a)return!1;a.prompt();const{outcome:c}=await a.userChoice;return c==="accepted"?(r(!1),i(null),!0):!1}}},xx="-",XP=t=>{const s=QP(t),{conflictingClassGroups:n,conflictingClassGroupModifiers:r}=t;return{getClassGroupId:o=>{const c=o.split(xx);return c[0]===""&&c.length!==1&&c.shift(),Ew(c,s)||ZP(o)},getConflictingClassGroupIds:(o,c)=>{const u=n[o]||[];return c&&r[o]?[...u,...r[o]]:u}}},Ew=(t,s)=>{var o;if(t.length===0)return s.classGroupId;const n=t[0],r=s.nextPart.get(n),a=r?Ew(t.slice(1),r):void 0;if(a)return a;if(s.validators.length===0)return;const i=t.join(xx);return(o=s.validators.find(({validator:c})=>c(i)))==null?void 0:o.classGroupId},gy=/^\[(.+)\]$/,ZP=t=>{if(gy.test(t)){const s=gy.exec(t)[1],n=s==null?void 0:s.substring(0,s.indexOf(":"));if(n)return"arbitrary.."+n}},QP=t=>{const{theme:s,prefix:n}=t,r={nextPart:new Map,validators:[]};return tM(Object.entries(t.classGroups),n).forEach(([i,o])=>{gp(o,r,i,s)}),r},gp=(t,s,n,r)=>{t.forEach(a=>{if(typeof a=="string"){const i=a===""?s:vy(s,a);i.classGroupId=n;return}if(typeof a=="function"){if(eM(a)){gp(a(r),s,n,r);return}s.validators.push({validator:a,classGroupId:n});return}Object.entries(a).forEach(([i,o])=>{gp(o,vy(s,i),n,r)})})},vy=(t,s)=>{let n=t;return s.split(xx).forEach(r=>{n.nextPart.has(r)||n.nextPart.set(r,{nextPart:new Map,validators:[]}),n=n.nextPart.get(r)}),n},eM=t=>t.isThemeGetter,tM=(t,s)=>s?t.map(([n,r])=>{const a=r.map(i=>typeof i=="string"?s+i:typeof i=="object"?Object.fromEntries(Object.entries(i).map(([o,c])=>[s+o,c])):i);return[n,a]}):t,sM=t=>{if(t<1)return{get:()=>{},set:()=>{}};let s=0,n=new Map,r=new Map;const a=(i,o)=>{n.set(i,o),s++,s>t&&(s=0,r=n,n=new Map)};return{get(i){let o=n.get(i);if(o!==void 0)return o;if((o=r.get(i))!==void 0)return a(i,o),o},set(i,o){n.has(i)?n.set(i,o):a(i,o)}}},Tw="!",nM=t=>{const{separator:s,experimentalParseClassName:n}=t,r=s.length===1,a=s[0],i=s.length,o=c=>{const u=[];let d=0,h=0,p;for(let v=0;v<c.length;v++){let w=c[v];if(d===0){if(w===a&&(r||c.slice(v,v+i)===s)){u.push(c.slice(h,v)),h=v+i;continue}if(w==="/"){p=v;continue}}w==="["?d++:w==="]"&&d--}const g=u.length===0?c:c.substring(h),x=g.startsWith(Tw),y=x?g.substring(1):g,b=p&&p>h?p-h:void 0;return{modifiers:u,hasImportantModifier:x,baseClassName:y,maybePostfixModifierPosition:b}};return n?c=>n({className:c,parseClassName:o}):o},rM=t=>{if(t.length<=1)return t;const s=[];let n=[];return t.forEach(r=>{r[0]==="["?(s.push(...n.sort(),r),n=[]):n.push(r)}),s.push(...n.sort()),s},aM=t=>({cache:sM(t.cacheSize),parseClassName:nM(t),...XP(t)}),iM=/\s+/,oM=(t,s)=>{const{parseClassName:n,getClassGroupId:r,getConflictingClassGroupIds:a}=s,i=[],o=t.trim().split(iM);let c="";for(let u=o.length-1;u>=0;u-=1){const d=o[u],{modifiers:h,hasImportantModifier:p,baseClassName:g,maybePostfixModifierPosition:x}=n(d);let y=!!x,b=r(y?g.substring(0,x):g);if(!b){if(!y){c=d+(c.length>0?" "+c:c);continue}if(b=r(g),!b){c=d+(c.length>0?" "+c:c);continue}y=!1}const v=rM(h).join(":"),w=p?v+Tw:v,N=w+b;if(i.includes(N))continue;i.push(N);const S=a(b,y);for(let E=0;E<S.length;++E){const k=S[E];i.push(w+k)}c=d+(c.length>0?" "+c:c)}return c};function lM(){let t=0,s,n,r="";for(;t<arguments.length;)(s=arguments[t++])&&(n=Dw(s))&&(r&&(r+=" "),r+=n);return r}const Dw=t=>{if(typeof t=="string")return t;let s,n="";for(let r=0;r<t.length;r++)t[r]&&(s=Dw(t[r]))&&(n&&(n+=" "),n+=s);return n};function cM(t,...s){let n,r,a,i=o;function o(u){const d=s.reduce((h,p)=>p(h),t());return n=aM(d),r=n.cache.get,a=n.cache.set,i=c,c(u)}function c(u){const d=r(u);if(d)return d;const h=oM(u,n);return a(u,h),h}return function(){return i(lM.apply(null,arguments))}}const Ns=t=>{const s=n=>n[t]||[];return s.isThemeGetter=!0,s},kw=/^\[(?:([a-z-]+):)?(.+)\]$/i,dM=/^\d+\/\d+$/,uM=new Set(["px","full","screen"]),mM=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,hM=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,fM=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,pM=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,xM=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,ei=t=>fl(t)||uM.has(t)||dM.test(t),Ai=t=>Ul(t,"length",SM),fl=t=>!!t&&!Number.isNaN(Number(t)),Tf=t=>Ul(t,"number",fl),gc=t=>!!t&&Number.isInteger(Number(t)),gM=t=>t.endsWith("%")&&fl(t.slice(0,-1)),ct=t=>kw.test(t),_i=t=>mM.test(t),vM=new Set(["length","size","percentage"]),yM=t=>Ul(t,vM,Aw),bM=t=>Ul(t,"position",Aw),jM=new Set(["image","url"]),wM=t=>Ul(t,jM,EM),NM=t=>Ul(t,"",CM),vc=()=>!0,Ul=(t,s,n)=>{const r=kw.exec(t);return r?r[1]?typeof s=="string"?r[1]===s:s.has(r[1]):n(r[2]):!1},SM=t=>hM.test(t)&&!fM.test(t),Aw=()=>!1,CM=t=>pM.test(t),EM=t=>xM.test(t),TM=()=>{const t=Ns("colors"),s=Ns("spacing"),n=Ns("blur"),r=Ns("brightness"),a=Ns("borderColor"),i=Ns("borderRadius"),o=Ns("borderSpacing"),c=Ns("borderWidth"),u=Ns("contrast"),d=Ns("grayscale"),h=Ns("hueRotate"),p=Ns("invert"),g=Ns("gap"),x=Ns("gradientColorStops"),y=Ns("gradientColorStopPositions"),b=Ns("inset"),v=Ns("margin"),w=Ns("opacity"),N=Ns("padding"),S=Ns("saturate"),E=Ns("scale"),k=Ns("sepia"),D=Ns("skew"),T=Ns("space"),R=Ns("translate"),O=()=>["auto","contain","none"],U=()=>["auto","hidden","clip","visible","scroll"],I=()=>["auto",ct,s],_=()=>[ct,s],M=()=>["",ei,Ai],W=()=>["auto",fl,ct],B=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],P=()=>["solid","dashed","dotted","double","none"],z=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],G=()=>["start","end","center","between","around","evenly","stretch"],ae=()=>["","0",ct],Y=()=>["auto","avoid","all","avoid-page","page","left","right","column"],X=()=>[fl,ct];return{cacheSize:500,separator:":",theme:{colors:[vc],spacing:[ei,Ai],blur:["none","",_i,ct],brightness:X(),borderColor:[t],borderRadius:["none","","full",_i,ct],borderSpacing:_(),borderWidth:M(),contrast:X(),grayscale:ae(),hueRotate:X(),invert:ae(),gap:_(),gradientColorStops:[t],gradientColorStopPositions:[gM,Ai],inset:I(),margin:I(),opacity:X(),padding:_(),saturate:X(),scale:X(),sepia:ae(),skew:X(),space:_(),translate:_()},classGroups:{aspect:[{aspect:["auto","square","video",ct]}],container:["container"],columns:[{columns:[_i]}],"break-after":[{"break-after":Y()}],"break-before":[{"break-before":Y()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...B(),ct]}],overflow:[{overflow:U()}],"overflow-x":[{"overflow-x":U()}],"overflow-y":[{"overflow-y":U()}],overscroll:[{overscroll:O()}],"overscroll-x":[{"overscroll-x":O()}],"overscroll-y":[{"overscroll-y":O()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[b]}],"inset-x":[{"inset-x":[b]}],"inset-y":[{"inset-y":[b]}],start:[{start:[b]}],end:[{end:[b]}],top:[{top:[b]}],right:[{right:[b]}],bottom:[{bottom:[b]}],left:[{left:[b]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",gc,ct]}],basis:[{basis:I()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",ct]}],grow:[{grow:ae()}],shrink:[{shrink:ae()}],order:[{order:["first","last","none",gc,ct]}],"grid-cols":[{"grid-cols":[vc]}],"col-start-end":[{col:["auto",{span:["full",gc,ct]},ct]}],"col-start":[{"col-start":W()}],"col-end":[{"col-end":W()}],"grid-rows":[{"grid-rows":[vc]}],"row-start-end":[{row:["auto",{span:[gc,ct]},ct]}],"row-start":[{"row-start":W()}],"row-end":[{"row-end":W()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",ct]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",ct]}],gap:[{gap:[g]}],"gap-x":[{"gap-x":[g]}],"gap-y":[{"gap-y":[g]}],"justify-content":[{justify:["normal",...G()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...G(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...G(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[N]}],px:[{px:[N]}],py:[{py:[N]}],ps:[{ps:[N]}],pe:[{pe:[N]}],pt:[{pt:[N]}],pr:[{pr:[N]}],pb:[{pb:[N]}],pl:[{pl:[N]}],m:[{m:[v]}],mx:[{mx:[v]}],my:[{my:[v]}],ms:[{ms:[v]}],me:[{me:[v]}],mt:[{mt:[v]}],mr:[{mr:[v]}],mb:[{mb:[v]}],ml:[{ml:[v]}],"space-x":[{"space-x":[T]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[T]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",ct,s]}],"min-w":[{"min-w":[ct,s,"min","max","fit"]}],"max-w":[{"max-w":[ct,s,"none","full","min","max","fit","prose",{screen:[_i]},_i]}],h:[{h:[ct,s,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[ct,s,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[ct,s,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[ct,s,"auto","min","max","fit"]}],"font-size":[{text:["base",_i,Ai]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Tf]}],"font-family":[{font:[vc]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",ct]}],"line-clamp":[{"line-clamp":["none",fl,Tf]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",ei,ct]}],"list-image":[{"list-image":["none",ct]}],"list-style-type":[{list:["none","disc","decimal",ct]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[w]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[w]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...P(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",ei,Ai]}],"underline-offset":[{"underline-offset":["auto",ei,ct]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:_()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",ct]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",ct]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[w]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...B(),bM]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",yM]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},wM]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[y]}],"gradient-via-pos":[{via:[y]}],"gradient-to-pos":[{to:[y]}],"gradient-from":[{from:[x]}],"gradient-via":[{via:[x]}],"gradient-to":[{to:[x]}],rounded:[{rounded:[i]}],"rounded-s":[{"rounded-s":[i]}],"rounded-e":[{"rounded-e":[i]}],"rounded-t":[{"rounded-t":[i]}],"rounded-r":[{"rounded-r":[i]}],"rounded-b":[{"rounded-b":[i]}],"rounded-l":[{"rounded-l":[i]}],"rounded-ss":[{"rounded-ss":[i]}],"rounded-se":[{"rounded-se":[i]}],"rounded-ee":[{"rounded-ee":[i]}],"rounded-es":[{"rounded-es":[i]}],"rounded-tl":[{"rounded-tl":[i]}],"rounded-tr":[{"rounded-tr":[i]}],"rounded-br":[{"rounded-br":[i]}],"rounded-bl":[{"rounded-bl":[i]}],"border-w":[{border:[c]}],"border-w-x":[{"border-x":[c]}],"border-w-y":[{"border-y":[c]}],"border-w-s":[{"border-s":[c]}],"border-w-e":[{"border-e":[c]}],"border-w-t":[{"border-t":[c]}],"border-w-r":[{"border-r":[c]}],"border-w-b":[{"border-b":[c]}],"border-w-l":[{"border-l":[c]}],"border-opacity":[{"border-opacity":[w]}],"border-style":[{border:[...P(),"hidden"]}],"divide-x":[{"divide-x":[c]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[c]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[w]}],"divide-style":[{divide:P()}],"border-color":[{border:[a]}],"border-color-x":[{"border-x":[a]}],"border-color-y":[{"border-y":[a]}],"border-color-s":[{"border-s":[a]}],"border-color-e":[{"border-e":[a]}],"border-color-t":[{"border-t":[a]}],"border-color-r":[{"border-r":[a]}],"border-color-b":[{"border-b":[a]}],"border-color-l":[{"border-l":[a]}],"divide-color":[{divide:[a]}],"outline-style":[{outline:["",...P()]}],"outline-offset":[{"outline-offset":[ei,ct]}],"outline-w":[{outline:[ei,Ai]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:M()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[w]}],"ring-offset-w":[{"ring-offset":[ei,Ai]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",_i,NM]}],"shadow-color":[{shadow:[vc]}],opacity:[{opacity:[w]}],"mix-blend":[{"mix-blend":[...z(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":z()}],filter:[{filter:["","none"]}],blur:[{blur:[n]}],brightness:[{brightness:[r]}],contrast:[{contrast:[u]}],"drop-shadow":[{"drop-shadow":["","none",_i,ct]}],grayscale:[{grayscale:[d]}],"hue-rotate":[{"hue-rotate":[h]}],invert:[{invert:[p]}],saturate:[{saturate:[S]}],sepia:[{sepia:[k]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[n]}],"backdrop-brightness":[{"backdrop-brightness":[r]}],"backdrop-contrast":[{"backdrop-contrast":[u]}],"backdrop-grayscale":[{"backdrop-grayscale":[d]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[h]}],"backdrop-invert":[{"backdrop-invert":[p]}],"backdrop-opacity":[{"backdrop-opacity":[w]}],"backdrop-saturate":[{"backdrop-saturate":[S]}],"backdrop-sepia":[{"backdrop-sepia":[k]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[o]}],"border-spacing-x":[{"border-spacing-x":[o]}],"border-spacing-y":[{"border-spacing-y":[o]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",ct]}],duration:[{duration:X()}],ease:[{ease:["linear","in","out","in-out",ct]}],delay:[{delay:X()}],animate:[{animate:["none","spin","ping","pulse","bounce",ct]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[E]}],"scale-x":[{"scale-x":[E]}],"scale-y":[{"scale-y":[E]}],rotate:[{rotate:[gc,ct]}],"translate-x":[{"translate-x":[R]}],"translate-y":[{"translate-y":[R]}],"skew-x":[{"skew-x":[D]}],"skew-y":[{"skew-y":[D]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",ct]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",ct]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":_()}],"scroll-mx":[{"scroll-mx":_()}],"scroll-my":[{"scroll-my":_()}],"scroll-ms":[{"scroll-ms":_()}],"scroll-me":[{"scroll-me":_()}],"scroll-mt":[{"scroll-mt":_()}],"scroll-mr":[{"scroll-mr":_()}],"scroll-mb":[{"scroll-mb":_()}],"scroll-ml":[{"scroll-ml":_()}],"scroll-p":[{"scroll-p":_()}],"scroll-px":[{"scroll-px":_()}],"scroll-py":[{"scroll-py":_()}],"scroll-ps":[{"scroll-ps":_()}],"scroll-pe":[{"scroll-pe":_()}],"scroll-pt":[{"scroll-pt":_()}],"scroll-pr":[{"scroll-pr":_()}],"scroll-pb":[{"scroll-pb":_()}],"scroll-pl":[{"scroll-pl":_()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",ct]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[ei,Ai,Tf]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},DM=cM(TM);function ce(...t){return DM(WR(t))}const td=Il("inline-flex items-center justify-center whitespace-nowrap rounded-lg text-sm font-medium ring-offset-background transition-all duration-150 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 touch-manipulation active:scale-95",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-md",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90 shadow-md",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 shadow-sm",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",gradient:"gradient-bg-primary text-white shadow-lg border-0 hover:opacity-90",glass:"glass-card text-gray-700 hover:bg-white/30 backdrop-blur-sm border border-white/20"},size:{default:"h-10 md:h-11 px-4 py-2",sm:"h-8 md:h-9 rounded-md px-3 text-xs md:text-sm",lg:"h-12 md:h-13 rounded-md px-8 text-sm md:text-base",icon:"h-10 w-10 md:h-11 md:w-11",touch:"h-11 md:h-12 px-6 py-3 text-base md:text-lg min-w-[44px]"}},defaultVariants:{variant:"default",size:"default"}}),$=f.forwardRef(({className:t,variant:s,size:n,asChild:r=!1,...a},i)=>{const o=r?kR:"button";return e.jsx(o,{className:ce(td({variant:s,size:n,className:t})),ref:i,...a})});$.displayName="Button";var _w=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),kM="VisuallyHidden",Rw=f.forwardRef((t,s)=>e.jsx(jt.span,{...t,ref:s,style:{..._w,...t.style}}));Rw.displayName=kM;var AM=Rw,[Lm,cY]=za("Tooltip",[Al]),$m=Al(),Ow="TooltipProvider",_M=700,vp="tooltip.open",[RM,gx]=Lm(Ow),Pw=t=>{const{__scopeTooltip:s,delayDuration:n=_M,skipDelayDuration:r=300,disableHoverableContent:a=!1,children:i}=t,o=f.useRef(!0),c=f.useRef(!1),u=f.useRef(0);return f.useEffect(()=>{const d=u.current;return()=>window.clearTimeout(d)},[]),e.jsx(RM,{scope:s,isOpenDelayedRef:o,delayDuration:n,onOpen:f.useCallback(()=>{window.clearTimeout(u.current),o.current=!1},[]),onClose:f.useCallback(()=>{window.clearTimeout(u.current),u.current=window.setTimeout(()=>o.current=!0,r)},[r]),isPointerInTransitRef:c,onPointerInTransitChange:f.useCallback(d=>{c.current=d},[]),disableHoverableContent:a,children:i})};Pw.displayName=Ow;var sd="Tooltip",[OM,zm]=Lm(sd),Mw=t=>{const{__scopeTooltip:s,children:n,open:r,defaultOpen:a,onOpenChange:i,disableHoverableContent:o,delayDuration:c}=t,u=gx(sd,t.__scopeTooltip),d=$m(s),[h,p]=f.useState(null),g=_l(),x=f.useRef(0),y=o??u.disableHoverableContent,b=c??u.delayDuration,v=f.useRef(!1),[w,N]=Oa({prop:r,defaultProp:a??!1,onChange:T=>{T?(u.onOpen(),document.dispatchEvent(new CustomEvent(vp))):u.onClose(),i==null||i(T)},caller:sd}),S=f.useMemo(()=>w?v.current?"delayed-open":"instant-open":"closed",[w]),E=f.useCallback(()=>{window.clearTimeout(x.current),x.current=0,v.current=!1,N(!0)},[N]),k=f.useCallback(()=>{window.clearTimeout(x.current),x.current=0,N(!1)},[N]),D=f.useCallback(()=>{window.clearTimeout(x.current),x.current=window.setTimeout(()=>{v.current=!0,N(!0),x.current=0},b)},[b,N]);return f.useEffect(()=>()=>{x.current&&(window.clearTimeout(x.current),x.current=0)},[]),e.jsx(Qp,{...d,children:e.jsx(OM,{scope:s,contentId:g,open:w,stateAttribute:S,trigger:h,onTriggerChange:p,onTriggerEnter:f.useCallback(()=>{u.isOpenDelayedRef.current?D():E()},[u.isOpenDelayedRef,D,E]),onTriggerLeave:f.useCallback(()=>{y?k():(window.clearTimeout(x.current),x.current=0)},[k,y]),onOpen:E,onClose:k,disableHoverableContent:y,children:n})})};Mw.displayName=sd;var yp="TooltipTrigger",Iw=f.forwardRef((t,s)=>{const{__scopeTooltip:n,...r}=t,a=zm(yp,n),i=gx(yp,n),o=$m(n),c=f.useRef(null),u=bs(s,c,a.onTriggerChange),d=f.useRef(!1),h=f.useRef(!1),p=f.useCallback(()=>d.current=!1,[]);return f.useEffect(()=>()=>document.removeEventListener("pointerup",p),[p]),e.jsx(Tm,{asChild:!0,...o,children:e.jsx(jt.button,{"aria-describedby":a.open?a.contentId:void 0,"data-state":a.stateAttribute,...r,ref:u,onPointerMove:it(t.onPointerMove,g=>{g.pointerType!=="touch"&&!h.current&&!i.isPointerInTransitRef.current&&(a.onTriggerEnter(),h.current=!0)}),onPointerLeave:it(t.onPointerLeave,()=>{a.onTriggerLeave(),h.current=!1}),onPointerDown:it(t.onPointerDown,()=>{a.open&&a.onClose(),d.current=!0,document.addEventListener("pointerup",p,{once:!0})}),onFocus:it(t.onFocus,()=>{d.current||a.onOpen()}),onBlur:it(t.onBlur,a.onClose),onClick:it(t.onClick,a.onClose)})})});Iw.displayName=yp;var PM="TooltipPortal",[dY,MM]=Lm(PM,{forceMount:void 0}),Tl="TooltipContent",Lw=f.forwardRef((t,s)=>{const n=MM(Tl,t.__scopeTooltip),{forceMount:r=n.forceMount,side:a="top",...i}=t,o=zm(Tl,t.__scopeTooltip);return e.jsx(gi,{present:r||o.open,children:o.disableHoverableContent?e.jsx($w,{side:a,...i,ref:s}):e.jsx(IM,{side:a,...i,ref:s})})}),IM=f.forwardRef((t,s)=>{const n=zm(Tl,t.__scopeTooltip),r=gx(Tl,t.__scopeTooltip),a=f.useRef(null),i=bs(s,a),[o,c]=f.useState(null),{trigger:u,onClose:d}=n,h=a.current,{onPointerInTransitChange:p}=r,g=f.useCallback(()=>{c(null),p(!1)},[p]),x=f.useCallback((y,b)=>{const v=y.currentTarget,w={x:y.clientX,y:y.clientY},N=BM(w,v.getBoundingClientRect()),S=HM(w,N),E=UM(b.getBoundingClientRect()),k=YM([...S,...E]);c(k),p(!0)},[p]);return f.useEffect(()=>()=>g(),[g]),f.useEffect(()=>{if(u&&h){const y=v=>x(v,h),b=v=>x(v,u);return u.addEventListener("pointerleave",y),h.addEventListener("pointerleave",b),()=>{u.removeEventListener("pointerleave",y),h.removeEventListener("pointerleave",b)}}},[u,h,x,g]),f.useEffect(()=>{if(o){const y=b=>{const v=b.target,w={x:b.clientX,y:b.clientY},N=(u==null?void 0:u.contains(v))||(h==null?void 0:h.contains(v)),S=!WM(w,o);N?g():S&&(g(),d())};return document.addEventListener("pointermove",y),()=>document.removeEventListener("pointermove",y)}},[u,h,o,d,g]),e.jsx($w,{...t,ref:i})}),[LM,$M]=Lm(sd,{isInside:!1}),zM=Cj("TooltipContent"),$w=f.forwardRef((t,s)=>{const{__scopeTooltip:n,children:r,"aria-label":a,onEscapeKeyDown:i,onPointerDownOutside:o,...c}=t,u=zm(Tl,n),d=$m(n),{onClose:h}=u;return f.useEffect(()=>(document.addEventListener(vp,h),()=>document.removeEventListener(vp,h)),[h]),f.useEffect(()=>{if(u.trigger){const p=g=>{const x=g.target;x!=null&&x.contains(u.trigger)&&h()};return window.addEventListener("scroll",p,{capture:!0}),()=>window.removeEventListener("scroll",p,{capture:!0})}},[u.trigger,h]),e.jsx(Xp,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:p=>p.preventDefault(),onDismiss:h,children:e.jsxs(Zp,{"data-state":u.stateAttribute,...d,...c,ref:s,style:{...c.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[e.jsx(zM,{children:r}),e.jsx(LM,{scope:n,isInside:!0,children:e.jsx(AM,{id:u.contentId,role:"tooltip",children:a||r})})]})})});Lw.displayName=Tl;var zw="TooltipArrow",FM=f.forwardRef((t,s)=>{const{__scopeTooltip:n,...r}=t,a=$m(n);return $M(zw,n).isInside?null:e.jsx(ex,{...a,...r,ref:s})});FM.displayName=zw;function BM(t,s){const n=Math.abs(s.top-t.y),r=Math.abs(s.bottom-t.y),a=Math.abs(s.right-t.x),i=Math.abs(s.left-t.x);switch(Math.min(n,r,a,i)){case i:return"left";case a:return"right";case n:return"top";case r:return"bottom";default:throw new Error("unreachable")}}function HM(t,s,n=5){const r=[];switch(s){case"top":r.push({x:t.x-n,y:t.y+n},{x:t.x+n,y:t.y+n});break;case"bottom":r.push({x:t.x-n,y:t.y-n},{x:t.x+n,y:t.y-n});break;case"left":r.push({x:t.x+n,y:t.y-n},{x:t.x+n,y:t.y+n});break;case"right":r.push({x:t.x-n,y:t.y-n},{x:t.x-n,y:t.y+n});break}return r}function UM(t){const{top:s,right:n,bottom:r,left:a}=t;return[{x:a,y:s},{x:n,y:s},{x:n,y:r},{x:a,y:r}]}function WM(t,s){const{x:n,y:r}=t;let a=!1;for(let i=0,o=s.length-1;i<s.length;o=i++){const c=s[i],u=s[o],d=c.x,h=c.y,p=u.x,g=u.y;h>r!=g>r&&n<(p-d)*(r-h)/(g-h)+d&&(a=!a)}return a}function YM(t){const s=t.slice();return s.sort((n,r)=>n.x<r.x?-1:n.x>r.x?1:n.y<r.y?-1:n.y>r.y?1:0),VM(s)}function VM(t){if(t.length<=1)return t.slice();const s=[];for(let r=0;r<t.length;r++){const a=t[r];for(;s.length>=2;){const i=s[s.length-1],o=s[s.length-2];if((i.x-o.x)*(a.y-o.y)>=(i.y-o.y)*(a.x-o.x))s.pop();else break}s.push(a)}s.pop();const n=[];for(let r=t.length-1;r>=0;r--){const a=t[r];for(;n.length>=2;){const i=n[n.length-1],o=n[n.length-2];if((i.x-o.x)*(a.y-o.y)>=(i.y-o.y)*(a.x-o.x))n.pop();else break}n.push(a)}return n.pop(),s.length===1&&n.length===1&&s[0].x===n[0].x&&s[0].y===n[0].y?s:s.concat(n)}var GM=Pw,qM=Mw,KM=Iw,Fw=Lw;const Mr=GM,Hs=qM,Us=KM,Ls=f.forwardRef(({className:t,sideOffset:s=4,...n},r)=>e.jsx(Fw,{ref:r,sideOffset:s,className:ce("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...n}));Ls.displayName=Fw.displayName;const JM={apiKey:"AIzaSyA1UeSwJ_gjygFI5SL4ZANSDHWTnuOxD_o",authDomain:"lifetracker-9e171.firebaseapp.com",projectId:"lifetracker-9e171",storageBucket:"lifetracker-9e171.firebasestorage.app",messagingSenderId:"160072327627",appId:"1:160072327627:web:664a48e910b6eedd59964e"},Bw=nO(JM),Df=rO(Bw),xe=aO(Bw);let yy=!1;const nm=async()=>{try{console.log("Clearing Firestore offline cache..."),await oO(xe),await lO(xe),await Jj(xe),console.log("Firestore offline cache cleared successfully"),typeof window<"u"&&window.location.reload()}catch(t){throw console.error("Error clearing Firestore offline cache:",t),t}},rm=t=>{var s,n;return((s=t==null?void 0:t.message)==null?void 0:s.includes("INTERNAL ASSERTION FAILED"))||((n=t==null?void 0:t.message)==null?void 0:n.includes("Unexpected state"))||(t==null?void 0:t.code)==="internal"};typeof window<"u"&&!yy&&(yy=!0,iO(xe,{forceOwnership:!0}).catch(t=>{t.code==="failed-precondition"?console.warn("Firestore persistence failed: Multiple tabs open"):t.code==="unimplemented"?console.warn("Firestore persistence not available in this browser"):console.error("Firestore persistence error",t)}));function Je(){const[t,s]=f.useState(null),[n,r]=f.useState(!0);return f.useEffect(()=>cO(Df,c=>{s(c),r(!1)}),[]),{user:t,loading:n,signIn:async()=>{const o=new uO;try{await mO(Df,o)}catch(c){console.error("Error al iniciar sesin:",c)}},signOut:async()=>{try{await dO(Df)}catch(o){console.error("Error al cerrar sesin:",o)}}}}const bp=[{icon:xO,label:"Inicio",path:"/"},{icon:nx,label:"Hidratacin",path:"/water"},{icon:Zj,label:"Ejercicio",path:"/exercise"},{icon:rx,label:"Hbitos",path:"/habit"},{icon:Om,label:"Estado",path:"/mood"},{icon:md,label:"Diario",path:"/journal"},{icon:zo,label:"Pomodoro",path:"/pomodoro"},{icon:Qj,label:"Comidas",path:"/meal"},{icon:gO,label:"Tareas",path:"/task"},{icon:ew,label:"Kanban",path:"/kanban"},{icon:tw,label:"Objetivos",path:"/goals"},{icon:ax,label:"Estadsticas",path:"/stats"},{icon:em,label:"Hbitos Negativos",path:"/negative"}],XM=({isExpanded:t,navigate:s})=>{const{user:n}=Je(),r=c=>c?c.split(" ").map(u=>u.charAt(0)).join("").toUpperCase().slice(0,2):"U",a=t?"w-10 h-10":"w-8 h-8",i=t?"text-sm":"text-xs",o=e.jsxs("div",{className:"flex items-center space-x-3 w-full",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[n!=null&&n.photoURL?e.jsx("img",{src:n.photoURL,alt:"Profile",className:`${a} rounded-full border-2 border-white/20 object-cover`,onError:c=>{var u;c.currentTarget.style.display="none",(u=c.currentTarget.nextElementSibling)==null||u.classList.remove("hidden")}}):null,e.jsx("div",{className:`${a} rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-semibold ${i} border-2 border-white/20 ${n!=null&&n.photoURL?"hidden":""}`,children:r((n==null?void 0:n.displayName)||(n==null?void 0:n.email))})]}),t&&e.jsxs("div",{className:"flex flex-col min-w-0 flex-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 truncate",children:(n==null?void 0:n.displayName)||"Usuario"}),e.jsx("span",{className:"text-xs text-gray-500 truncate",children:n==null?void 0:n.email})]})]});return t?e.jsx($,{variant:"ghost",className:"w-full h-auto p-4 hover:bg-white/20 rounded-xl transition-colors duration-150 flex items-center justify-start",onClick:()=>s("/settings"),children:o}):e.jsx(Mr,{children:e.jsxs(Hs,{delayDuration:0,children:[e.jsx(Us,{asChild:!0,children:e.jsx($,{variant:"ghost",className:"w-full h-auto p-1.5 hover:bg-white/20 rounded-xl transition-colors duration-150 flex items-center justify-center",onClick:()=>s("/settings"),children:o})}),e.jsx(Ls,{side:"right",className:"bg-black text-white border-gray-700",children:e.jsx("p",{children:"Perfil y configuracin"})})]})})},ZM=()=>{const t=Ln(),s=Qt(),[n,r]=f.useState(()=>localStorage.getItem("desktop-nav-expanded")==="true");f.useEffect(()=>{localStorage.setItem("desktop-nav-expanded",JSON.stringify(n)),document.documentElement.style.setProperty("--desktop-nav-width",n?"256px":"64px")},[n]);const a=({icon:i,label:o,path:c,onClick:u})=>{const d=t.pathname===c,h=e.jsxs(e.Fragment,{children:[e.jsx(i,{className:`w-5 h-5 flex-shrink-0 ${d?"text-white":"text-gray-600"}`}),n&&e.jsx("span",{className:`ml-3 font-medium truncate ${d?"text-white":"text-gray-700"}`,children:o})]}),p=`
      w-full flex items-center justify-start rounded-xl transition-colors duration-150
      ${n?"px-4 py-3":"p-3"} 
      ${d?"gradient-bg-primary text-white shadow-lg":"hover:bg-white/20"}
    `;return n?e.jsx($,{variant:"ghost",className:p,onClick:()=>u?u():s(c),children:h}):e.jsx(Mr,{children:e.jsxs(Hs,{delayDuration:0,children:[e.jsx(Us,{asChild:!0,children:e.jsx($,{variant:"ghost",className:p,onClick:()=>u?u():s(c),children:h})}),e.jsx(Ls,{side:"right",className:"bg-black text-white border-gray-700",children:e.jsx("p",{children:o})})]})})};return e.jsxs("aside",{className:`hidden md:flex flex-col h-screen fixed top-0 left-0 transition-all duration-300 glass-card z-50 border-r-0
      ${n?"w-64":"w-16"}`,children:[e.jsx("div",{className:`border-b border-white/20 ${n?"p-4":"p-1.5"}`,children:e.jsx(XM,{isExpanded:n,navigate:s})}),e.jsx("nav",{className:"flex-1 p-3 overflow-y-auto",children:e.jsx("div",{className:"space-y-1",children:bp.map(i=>e.jsx(a,{icon:i.icon,label:i.label,path:i.path},i.path))})}),e.jsx("div",{className:"p-3 border-t border-white/20",children:e.jsx($,{variant:"ghost",size:"icon",title:"Expand/Collapse Menu",onClick:()=>r(!n),className:"w-full p-2 hover:bg-white/20 rounded-lg",children:e.jsx(Ma,{className:`w-4 h-4 transform transition-transform duration-200 
            ${n?"rotate-180":""}`})})})]})},QM=km,eI=Am,tI=Dm,Hw=f.forwardRef(({className:t,...s},n)=>e.jsx(Rl,{className:ce("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s,ref:n}));Hw.displayName=Rl.displayName;const sI=Il("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),Uw=f.forwardRef(({side:t="right",className:s,children:n,...r},a)=>e.jsxs(tI,{children:[e.jsx(Hw,{}),e.jsxs(Ol,{ref:a,className:ce(sI({side:t}),s),...r,children:[n,e.jsxs(ud,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[e.jsx(Ws,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Uw.displayName=Ol.displayName;const Ww=({className:t,...s})=>e.jsx("div",{className:ce("flex flex-col space-y-2 text-center sm:text-left",t),...s});Ww.displayName="SheetHeader";const Yw=f.forwardRef(({className:t,...s},n)=>e.jsx(Pl,{ref:n,className:ce("text-lg font-semibold text-foreground",t),...s}));Yw.displayName=Pl.displayName;const nI=f.forwardRef(({className:t,...s},n)=>e.jsx(Ml,{ref:n,className:ce("text-sm text-muted-foreground",t),...s}));nI.displayName=Ml.displayName;const rI=()=>{const t=Ln(),s=Qt(),{signOut:n}=Je(),[r,a]=f.useState(!1),i=async()=>{try{a(!1),await n(),s("/login")}catch(h){console.error("Error al cerrar sesin:",h)}},o=bp.slice(0,4),c=bp.slice(4),u=[{icon:sw,label:"Agua +250ml",path:"/water",action:"quick-water"},{icon:Om,label:"Registrar nimo",path:"/mood",action:"quick-mood"},{icon:aa,label:"Marcar Hbito",path:"/habit",action:"quick-habit"},{icon:tm,label:"Nueva Tarea",path:"/task",action:"quick-task"},{icon:Nl,label:"Resumen Hoy",path:"/stats",action:"quick-stats"}],d=({icon:h,label:p,path:g,onClick:x})=>{const y=t.pathname===g;return e.jsxs($,{variant:"ghost",className:`flex flex-col items-center justify-center h-auto px-2 py-2 text-xs rounded-xl transition-all duration-300 active:scale-95 touch-manipulation
          ${y?"text-blue-600 bg-blue-50 shadow-sm scale-105":"text-gray-600 hover:text-blue-600 hover:bg-blue-50/50 hover:scale-105"}`,onClick:()=>{x?x():s(g),a(!1)},children:[e.jsx(h,{className:`w-5 h-5 sm:w-6 sm:h-6 ${y?"animate-pulse":""}`}),e.jsx("span",{className:"mt-1 font-medium leading-tight",children:p})]})};return e.jsx("div",{className:"md:hidden",children:e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-md border-t border-gray-200 z-30 shadow-lg",children:e.jsxs("nav",{className:"flex justify-around items-center px-1 py-1 max-w-screen-sm mx-auto",children:[o.map(h=>e.jsx(d,{icon:h.icon,label:h.label,path:h.path},h.path)),e.jsxs(QM,{open:r,onOpenChange:a,children:[e.jsx(eI,{asChild:!0,children:e.jsxs($,{variant:"ghost",className:`flex flex-col items-center justify-center h-auto px-2 py-2 text-xs rounded-xl transition-all duration-300 active:scale-95 touch-manipulation
                  ${r?"text-blue-600 bg-blue-50 scale-105":"text-gray-600 hover:bg-blue-50/50 hover:scale-105"}`,children:[e.jsx(Gn,{className:`w-5 h-5 sm:w-6 sm:h-6 transform transition-transform duration-300
                  ${r?"rotate-180":""}`}),e.jsx("span",{className:"mt-1 font-medium leading-tight",children:"Ms"})]})}),e.jsxs(Uw,{side:"bottom",className:"rounded-t-2xl bg-white/95 backdrop-blur-md border-t border-gray-200 max-w-screen-sm mx-auto",children:[e.jsx(Ww,{className:"mb-4",children:e.jsx(Yw,{className:"text-center text-lg font-semibold text-gray-800",children:"Ms opciones"})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-3 px-2",children:"Acceso Rpido"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 px-2",children:u.map(h=>e.jsxs($,{variant:"outline",className:"flex items-center gap-2 h-auto p-3 text-left justify-start bg-gradient-to-r from-blue-50 to-purple-50 hover:from-blue-100 hover:to-purple-100 border-blue-200",onClick:()=>{s(h.path),a(!1)},children:[e.jsx(h.icon,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:h.label})]},h.action))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-3 px-2",children:"Todas las Opciones"}),e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-3 p-2",children:c.map(h=>e.jsx(d,{icon:h.icon,label:h.label,path:h.path,onClick:h.path==="/logout"?i:void 0},h.path))})]})]})]})]})})})},aI=()=>{const{shouldShowDesktopNav:t}=vd(),s=!t;return e.jsx(e.Fragment,{children:s?e.jsx(rI,{}):e.jsx(ZM,{})})},iI=()=>{const{canInstall:t,promptInstall:s,isInstalled:n}=JP(),[r,a]=f.useState(!1),[i,o]=f.useState(!1);f.useEffect(()=>{if(t&&!n&&!i){const d=setTimeout(()=>{a(!0)},1e4);return()=>clearTimeout(d)}},[t,n,i]);const c=async()=>{await s()&&a(!1)},u=()=>{a(!1),o(!0),sessionStorage.setItem("pwa-install-dismissed","true")};return n||!t||!r||sessionStorage.getItem("pwa-install-dismissed")?null:e.jsx("div",{className:"fixed bottom-20 left-4 right-4 md:left-auto md:right-4 md:w-80 bg-white rounded-lg shadow-lg border border-gray-200 p-4 z-50 animate-in slide-in-from-bottom-5",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(br,{className:"w-5 h-5 text-blue-600"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-sm",children:"Instalar Life Tracker"}),e.jsx("p",{className:"text-gray-600 text-xs mt-1",children:"Instala la app para un acceso ms rpido y funciones offline."}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx($,{size:"sm",onClick:c,className:"text-xs px-3 py-1 h-auto",children:"Instalar"}),e.jsx($,{variant:"ghost",size:"sm",onClick:u,className:"text-xs px-3 py-1 h-auto",children:"Ahora no"})]})]}),e.jsx($,{variant:"ghost",size:"sm",onClick:u,className:"flex-shrink-0 p-1 h-auto w-auto",children:e.jsx(Ws,{className:"w-4 h-4"})})]})})},oI=()=>{const[t,s]=f.useState(navigator.onLine),[n,r]=f.useState(!1),[a,i]=f.useState(!1);f.useEffect(()=>{const c=()=>{s(!0),r(!1)},u=()=>{s(!1),r(!0),setTimeout(()=>r(!1),5e3)},d=()=>{i(!0)};return window.addEventListener("online",c),window.addEventListener("offline",u),"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",h=>{h.data&&h.data.type==="SKIP_WAITING"&&d()}),()=>{window.removeEventListener("online",c),window.removeEventListener("offline",u)}},[]);const o=()=>{"serviceWorker"in navigator&&navigator.serviceWorker.getRegistration().then(c=>{c&&c.waiting&&(c.waiting.postMessage({type:"SKIP_WAITING"}),window.location.reload())})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed top-4 right-4 z-50",children:!t&&e.jsxs("div",{className:"flex items-center gap-1 bg-orange-100 text-orange-800 px-2 py-1 rounded-full text-xs",children:[e.jsx(ap,{className:"w-3 h-3"}),e.jsx("span",{children:"Offline"})]})}),n&&e.jsxs("div",{className:"fixed top-16 left-4 right-4 md:left-auto md:right-4 md:w-80 bg-orange-50 border border-orange-200 rounded-lg p-3 z-50 animate-in slide-in-from-top-5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ap,{className:"w-4 h-4 text-orange-600"}),e.jsx("span",{className:"text-orange-800 text-sm font-medium",children:"Sin conexin"})]}),e.jsx("p",{className:"text-orange-700 text-xs mt-1",children:"Trabajando en modo offline. Los datos se sincronizarn cuando vuelvas a conectarte."})]}),a&&e.jsxs("div",{className:"fixed top-16 left-4 right-4 md:left-auto md:right-4 md:w-80 bg-blue-50 border border-blue-200 rounded-lg p-3 z-50 animate-in slide-in-from-top-5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ro,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-blue-800 text-sm font-medium",children:"Actualizacin disponible"})]}),e.jsx("p",{className:"text-blue-700 text-xs mt-1",children:"Hay una nueva versin disponible."}),e.jsx($,{size:"sm",onClick:o,className:"mt-2 text-xs px-3 py-1 h-auto",children:"Actualizar"})]})]})},lI=({children:t})=>{const{isMobile:s}=vd(),[n,r]=f.useState(0),[a,i]=f.useState(!1);return f.useEffect(()=>{if(!s)return;let o=0,c=0,u=!0;const d=g=>{o=g.touches[0].clientY,u=window.scrollY===0},h=g=>{if(!u)return;c=g.touches[0].clientY;const x=c-o;x>0&&x<150&&(i(!0),r(x),g.preventDefault())},p=()=>{a&&n>100&&window.location.reload(),i(!1),r(0)};return document.addEventListener("touchstart",d,{passive:!1}),document.addEventListener("touchmove",h,{passive:!1}),document.addEventListener("touchend",p),()=>{document.removeEventListener("touchstart",d),document.removeEventListener("touchmove",h),document.removeEventListener("touchend",p)}},[s,a,n]),s?e.jsxs("div",{className:"relative",children:[a&&e.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 bg-blue-500 text-white text-center py-2 text-sm transition-transform duration-200",style:{transform:`translateY(${Math.min(n-50,0)}px)`,opacity:n/100},children:n>100?"Suelta para actualizar!":"Tira hacia abajo para actualizar"}),t]}):e.jsx(e.Fragment,{children:t})},ua=()=>{const[t,s]=f.useState(typeof navigator<"u"?navigator.onLine:!0);return f.useEffect(()=>{const n=()=>s(!0),r=()=>s(!1);return window.addEventListener("online",n),window.addEventListener("offline",r),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",r)}},[]),{isOnline:t}},Ha=t=>f.useCallback(async()=>{await Jj(xe),await hO(xe)},[t]),Ao=class Ao{constructor(){he(this,"writes",[]);he(this,"alertThreshold",50);he(this,"monitoringWindow",5*60*1e3);this.startMonitoring()}static getInstance(){return Ao.instance||(Ao.instance=new Ao),Ao.instance}logWrite(s,n,r,a){}checkForExcessiveWrites(){const s=this.writes.filter(n=>n.timestamp>new Date(Date.now()-this.monitoringWindow));if(s.length>this.alertThreshold){console.warn(` ALERTA: ${s.length} escrituras en los ltimos 5 minutos`);const n=this.groupBy(s,"source");console.warn(" Escrituras por fuente:",Object.entries(n).map(([a,i])=>({source:a,count:i.length})).sort((a,i)=>i.count-a.count));const r=this.groupBy(s,"collection");console.warn(" Escrituras por coleccin:",Object.entries(r).map(([a,i])=>({collection:a,count:i.length})).sort((a,i)=>i.count-a.count)),this.detectPatterns(s)}}detectPatterns(s){const n=new Map;s.forEach(r=>{const a=`${r.collection}/${r.documentId||"unknown"}`;n.has(a)||n.set(a,[]),n.get(a).push(r)}),n.forEach((r,a)=>{if(r.length>10){console.warn(` PATRN SOSPECHOSO: ${r.length} escrituras a ${a}:`);const i=this.groupBy(r,"source");Object.entries(i).forEach(([o,c])=>{if(c.length>5){console.warn(`  - ${o}: ${c.length} escrituras`);const u=c.map(h=>h.timestamp.getTime()).sort(),d=[];for(let h=1;h<u.length;h++)d.push(u[h]-u[h-1]);if(d.length>0){const h=d.reduce((p,g)=>p+g,0)/d.length;console.warn(`    Intervalo promedio: ${Math.round(h/1e3)}s`),h<6e4&&console.error(`     ESCRITURAS MUY FRECUENTES: cada ${Math.round(h/1e3)}s`)}}})}})}groupBy(s,n){return s.reduce((r,a)=>{const i=String(a[n]);return r[i]=r[i]||[],r[i].push(a),r},{})}startMonitoring(){}generateReport(){if(this.writes.length===0)return;console.group(" Reporte de Escrituras Firestore (ltimos 5 min)");const s=this.writes.filter(n=>n.timestamp>new Date(Date.now()-this.monitoringWindow));if(console.log(`Total de escrituras: ${s.length}`),s.length>0){const n=s.length/5;console.log(`Tasa: ${n.toFixed(1)} escrituras/minuto`),n>10&&console.warn(" Tasa de escrituras muy alta")}console.groupEnd()}getStats(){const s=this.writes.filter(n=>n.timestamp>new Date(Date.now()-this.monitoringWindow));return{totalWrites:s.length,ratePerMinute:s.length/5,bySource:this.groupBy(s,"source"),byCollection:this.groupBy(s,"collection")}}clear(){this.writes=[]}};he(Ao,"instance");let jp=Ao;jp.getInstance();const _o=class _o{constructor(){he(this,"operations",[]);he(this,"isEnabled");this.isEnabled=!1}static getInstance(){return _o.instance||(_o.instance=new _o),_o.instance}logRead(s,n,r){if(!this.isEnabled)return;const a={type:"read",collection:s,documentId:r,timestamp:new Date,source:n};this.operations.push(a),console.log(` [Firestore Read] ${s}${r?`/${r}`:""} from ${n}`,a)}logWrite(s,n,r){if(!this.isEnabled)return;const a={type:"write",collection:s,documentId:r,timestamp:new Date,source:n};this.operations.push(a),console.log(` [Firestore Write] ${s}${r?`/${r}`:""} from ${n}`,a)}logDelete(s,n,r){if(!this.isEnabled)return;const a={type:"delete",collection:s,documentId:r,timestamp:new Date,source:n};this.operations.push(a),console.log(` [Firestore Delete] ${s}${r?`/${r}`:""} from ${n}`,a)}getOperations(){return[...this.operations]}getOperationsBySource(s){return this.operations.filter(n=>n.source===s)}getOperationsByCollection(s){return this.operations.filter(n=>n.collection===s)}getOperationsSummary(){const s={};return this.operations.forEach(n=>{const r=`${n.type}-${n.collection}`;s[r]=(s[r]||0)+1}),s}logSummary(){if(!this.isEnabled)return;const s=this.getOperationsSummary();console.group(" Firestore Operations Summary"),Object.entries(s).forEach(([n,r])=>{console.log(`${n}: ${r} operations`)}),console.groupEnd()}clear(){this.operations=[]}};he(_o,"instance");let wp=_o;const Me=wp.getInstance(),cI={lessThanXSeconds:{one:"menos de un segundo",other:"menos de {{count}} segundos"},xSeconds:{one:"1 segundo",other:"{{count}} segundos"},halfAMinute:"medio minuto",lessThanXMinutes:{one:"menos de un minuto",other:"menos de {{count}} minutos"},xMinutes:{one:"1 minuto",other:"{{count}} minutos"},aboutXHours:{one:"alrededor de 1 hora",other:"alrededor de {{count}} horas"},xHours:{one:"1 hora",other:"{{count}} horas"},xDays:{one:"1 da",other:"{{count}} das"},aboutXWeeks:{one:"alrededor de 1 semana",other:"alrededor de {{count}} semanas"},xWeeks:{one:"1 semana",other:"{{count}} semanas"},aboutXMonths:{one:"alrededor de 1 mes",other:"alrededor de {{count}} meses"},xMonths:{one:"1 mes",other:"{{count}} meses"},aboutXYears:{one:"alrededor de 1 ao",other:"alrededor de {{count}} aos"},xYears:{one:"1 ao",other:"{{count}} aos"},overXYears:{one:"ms de 1 ao",other:"ms de {{count}} aos"},almostXYears:{one:"casi 1 ao",other:"casi {{count}} aos"}},dI=(t,s,n)=>{let r;const a=cI[t];return typeof a=="string"?r=a:s===1?r=a.one:r=a.other.replace("{{count}}",s.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"en "+r:"hace "+r:r},uI={full:"EEEE, d 'de' MMMM 'de' y",long:"d 'de' MMMM 'de' y",medium:"d MMM y",short:"dd/MM/y"},mI={full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},hI={full:"{{date}} 'a las' {{time}}",long:"{{date}} 'a las' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},fI={date:Nf({formats:uI,defaultWidth:"full"}),time:Nf({formats:mI,defaultWidth:"full"}),dateTime:Nf({formats:hI,defaultWidth:"full"})},pI={lastWeek:"'el' eeee 'pasado a la' p",yesterday:"'ayer a la' p",today:"'hoy a la' p",tomorrow:"'maana a la' p",nextWeek:"eeee 'a la' p",other:"P"},xI={lastWeek:"'el' eeee 'pasado a las' p",yesterday:"'ayer a las' p",today:"'hoy a las' p",tomorrow:"'maana a las' p",nextWeek:"eeee 'a las' p",other:"P"},gI=(t,s,n,r)=>s.getHours()!==1?xI[t]:pI[t],vI={narrow:["AC","DC"],abbreviated:["AC","DC"],wide:["antes de cristo","despus de cristo"]},yI={narrow:["1","2","3","4"],abbreviated:["T1","T2","T3","T4"],wide:["1 trimestre","2 trimestre","3 trimestre","4 trimestre"]},bI={narrow:["e","f","m","a","m","j","j","a","s","o","n","d"],abbreviated:["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"],wide:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"]},jI={narrow:["d","l","m","m","j","v","s"],short:["do","lu","ma","mi","ju","vi","s"],abbreviated:["dom","lun","mar","mi","jue","vie","sb"],wide:["domingo","lunes","martes","mircoles","jueves","viernes","sbado"]},wI={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"maana",afternoon:"tarde",evening:"tarde",night:"noche"},abbreviated:{am:"AM",pm:"PM",midnight:"medianoche",noon:"mediodia",morning:"maana",afternoon:"tarde",evening:"tarde",night:"noche"},wide:{am:"a.m.",pm:"p.m.",midnight:"medianoche",noon:"mediodia",morning:"maana",afternoon:"tarde",evening:"tarde",night:"noche"}},NI={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"de la maana",afternoon:"de la tarde",evening:"de la tarde",night:"de la noche"},abbreviated:{am:"AM",pm:"PM",midnight:"medianoche",noon:"mediodia",morning:"de la maana",afternoon:"de la tarde",evening:"de la tarde",night:"de la noche"},wide:{am:"a.m.",pm:"p.m.",midnight:"medianoche",noon:"mediodia",morning:"de la maana",afternoon:"de la tarde",evening:"de la tarde",night:"de la noche"}},SI=(t,s)=>Number(t)+"",CI={ordinalNumber:SI,era:pc({values:vI,defaultWidth:"wide"}),quarter:pc({values:yI,defaultWidth:"wide",argumentCallback:t=>Number(t)-1}),month:pc({values:bI,defaultWidth:"wide"}),day:pc({values:jI,defaultWidth:"wide"}),dayPeriod:pc({values:wI,defaultWidth:"wide",formattingValues:NI,defaultFormattingWidth:"wide"})},EI=/^(\d+)()?/i,TI=/\d+/i,DI={narrow:/^(ac|dc|a|d)/i,abbreviated:/^(a\.?\s?c\.?|a\.?\s?e\.?\s?c\.?|d\.?\s?c\.?|e\.?\s?c\.?)/i,wide:/^(antes de cristo|antes de la era com[u]n|despu[e]s de cristo|era com[u]n)/i},kI={any:[/^ac/i,/^dc/i],wide:[/^(antes de cristo|antes de la era com[u]n)/i,/^(despu[e]s de cristo|era com[u]n)/i]},AI={narrow:/^[1234]/i,abbreviated:/^T[1234]/i,wide:/^[1234]()? trimestre/i},_I={any:[/1/i,/2/i,/3/i,/4/i]},RI={narrow:/^[efmajsond]/i,abbreviated:/^(ene|feb|mar|abr|may|jun|jul|ago|sep|oct|nov|dic)/i,wide:/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre)/i},OI={narrow:[/^e/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^en/i,/^feb/i,/^mar/i,/^abr/i,/^may/i,/^jun/i,/^jul/i,/^ago/i,/^sep/i,/^oct/i,/^nov/i,/^dic/i]},PI={narrow:/^[dlmjvs]/i,short:/^(do|lu|ma|mi|ju|vi|s[a])/i,abbreviated:/^(dom|lun|mar|mi[e]|jue|vie|s[a]b)/i,wide:/^(domingo|lunes|martes|mi[e]rcoles|jueves|viernes|s[a]bado)/i},MI={narrow:[/^d/i,/^l/i,/^m/i,/^m/i,/^j/i,/^v/i,/^s/i],any:[/^do/i,/^lu/i,/^ma/i,/^mi/i,/^ju/i,/^vi/i,/^sa/i]},II={narrow:/^(a|p|mn|md|(de la|a las) (maana|tarde|noche))/i,any:/^([ap]\.?\s?m\.?|medianoche|mediodia|(de la|a las) (maana|tarde|noche))/i},LI={any:{am:/^a/i,pm:/^p/i,midnight:/^mn/i,noon:/^md/i,morning:/maana/i,afternoon:/tarde/i,evening:/tarde/i,night:/noche/i}},$I={ordinalNumber:YR({matchPattern:EI,parsePattern:TI,valueCallback:function(t){return parseInt(t,10)}}),era:xc({matchPatterns:DI,defaultMatchWidth:"wide",parsePatterns:kI,defaultParseWidth:"any"}),quarter:xc({matchPatterns:AI,defaultMatchWidth:"wide",parsePatterns:_I,defaultParseWidth:"any",valueCallback:t=>t+1}),month:xc({matchPatterns:RI,defaultMatchWidth:"wide",parsePatterns:OI,defaultParseWidth:"any"}),day:xc({matchPatterns:PI,defaultMatchWidth:"wide",parsePatterns:MI,defaultParseWidth:"any"}),dayPeriod:xc({matchPatterns:II,defaultMatchWidth:"any",parsePatterns:LI,defaultParseWidth:"any"})},Zs={code:"es",formatDistance:dI,formatLong:fI,formatRelative:gI,localize:CI,match:$I,options:{weekStartsOn:1,firstWeekContainsDate:1}},Ie=(t=new Date)=>{const s=new Date(t.getTime());return s.setHours(0,0,0,0),s.toISOString().split("T")[0]},ea=t=>{const s=new Date(t);return s.setHours(12,0,0,0),s},am=t=>{const s=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],n=t.getDate(),r=s[t.getMonth()],a=t.getFullYear();let i=t.getHours();const o=t.getMinutes().toString().padStart(2,"0"),c=t.getSeconds().toString().padStart(2,"0"),u=i>=12?"p.m.":"a.m.";i=i%12,i=i||12;const d=-t.getTimezoneOffset(),h=Math.abs(Math.floor(d/60)),p=d>=0?"+":"-";return`${n} de ${r} de ${a}, ${i}:${o}:${c} ${u} UTC${p}${h}`},jn=(t,s,n)=>{const r=new Date(t);return r.setHours(s,n,0,0),{timestamp:r.getTime(),utcOffset:-r.getTimezoneOffset(),formatted:am(r)}},zI=(t=new Date,s="daily",n=1)=>{const r=ps(t);switch(s){case"daily":return os(r,1);case"weekly":return Kc(r,1);case"monthly":return ra(r,1);case"custom":return os(r,n);default:return r}},Vw=(t,s,n)=>{const r=nt(t,"'prximo' EEEE",{locale:Zs});switch(s){case"daily":return`Diariamente (${r})`;case"weekly":return`Semanalmente (${r})`;case"monthly":return`Mensualmente (${nt(t,"'prximo' d 'de' MMMM",{locale:Zs})})`;case"custom":return`Cada ${n} da${n!==1?"s":""} (${r})`;default:return""}},Np=t=>{const s=t.getTimezoneOffset();return new Date(t.getTime()-s*60*1e3).toISOString().split("T")[0]},FI=t=>nt(t,"EEEE, d 'de' MMMM 'de' yyyy",{locale:Zs}),BI=t=>Array.from({length:12},(s,n)=>({name:new Date(t,n).toLocaleString("es",{month:"short"}),days:new Date(t,n+1,0).getDate(),number:n+1})),HI=(t,s)=>{const n=new Date(t);return n.setDate(n.getDate()-s),n},nd=(t,s,n)=>{if(!s)return;if(!t){const i=new Date(n);return i.setHours(i.getHours()+1),i}const r=s.getTime()-t.getTime();if(r<=0){const i=new Date(n);return i.setHours(i.getHours()+1),i}const a=new Date(n.getTime()+r);return a.getTime()<=n.getTime()&&a.setMinutes(a.getMinutes()+30),a},UI=(t,s=50,n=30)=>t/s*n,WI=(t,s=50,n=30)=>t/n*s,by=(t,s=new Date,n=6)=>{const r=UI(t),a=new Date(s);return a.setHours(n,0,0,0),a.setMinutes(r),a},jy=(t,s=15)=>{const n=t.getMinutes(),r=Math.round(n/s)*s,a=new Date(t);return a.setMinutes(r,0,0),a},Gw=(t,s=6)=>{const n=t.getHours(),r=t.getMinutes(),a=(n-s)*60+r;return WI(a)},qw=t=>{const[s,n]=f.useState(null),[r,a]=f.useState("idle"),[i,o]=f.useState(null),{user:c}=Je(),u=Ie(t||new Date),d=async()=>{if(c)try{Me.logRead("pomodoro","usePomodoroData.loadData",`${c.uid}_${u}`);const b=ke(xe,"pomodoro",`${c.uid}_${u}`),v=await ot(b);if(v.exists()){const w=v.data(),N=Array.isArray(w.sessions)?w.sessions:[],S=N.filter(E=>E.completed).length;n({...w,sessions:N,count:S}),a("saved")}else n({userId:c.uid,date:u,count:0,sessions:[],updatedAt:null}),a("idle")}catch(b){console.error("Pomodoro - Error loading data:",b),o(b instanceof Error?b.message:"Error loading pomodoro data"),a("error")}};f.useEffect(()=>{d()},[c,u]);const h=async(b={})=>{var v;if(!(!c||!s)){a("saving"),o(null);try{const w=t||new Date,N=new Date,S=jn(w,N.getHours(),N.getMinutes()),E=new Date(N.getTime()-30*60*1e3),k=jn(w,E.getHours(),E.getMinutes()),D={startTime:{timestamp:k.timestamp,utcOffset:k.utcOffset,formatted:k.formatted},endTime:{timestamp:S.timestamp,utcOffset:S.utcOffset,formatted:S.formatted},duration:30*60,completed:!0};(v=b.description)!=null&&v.trim()&&(D.description=b.description.trim());const T=[...s.sessions,D].sort((_,M)=>M.startTime.timestamp-_.startTime.timestamp),{activePomodoro:R,...O}=s,U={...O,count:T.filter(_=>_.completed).length,sessions:T,updatedAt:ht()},I=ke(xe,"pomodoro",`${c.uid}_${u}`);Me.logWrite("pomodoro","usePomodoroData.addManualSession",`${c.uid}_${u}`),await Zt(I,U),await d()}catch(w){console.error("Pomodoro - Error al agregar sesin manual:",w),o(w instanceof Error?w.message:"Error al guardar"),a("error")}}},p=async(b,v,w={})=>{var N;if(!(!c||!s)){a("saving"),o(null);try{const S=t||new Date,E=new Date,k=jn(S,E.getHours(),E.getMinutes()),D=new Date(E.getTime()-b*1e3),T=jn(S,D.getHours(),D.getMinutes()),R={startTime:{timestamp:T.timestamp,utcOffset:T.utcOffset,formatted:T.formatted},endTime:{timestamp:k.timestamp,utcOffset:k.utcOffset,formatted:k.formatted},duration:b,completed:v};(N=w.description)!=null&&N.trim()&&(R.description=w.description.trim());const O=[...s.sessions,R],U=O.filter(B=>B.completed).length,{activePomodoro:I,..._}=s,M={..._,count:U,sessions:O,updatedAt:ht()},W=ke(xe,"pomodoro",`${c.uid}_${u}`);Me.logWrite("pomodoro","usePomodoroData.saveSession",`${c.uid}_${u}`),await Zt(W,M),await d()}catch(S){console.error("Pomodoro - Error al guardar:",S),o(S instanceof Error?S.message:"Error al guardar"),a("error")}}},g=async b=>{if(!(!c||!s)){a("saving"),o(null);try{const v=s.sessions.filter(k=>k.startTime.timestamp!==b.startTime.timestamp),{activePomodoro:w,...N}=s,S={...N,count:v.filter(k=>k.completed).length,sessions:v,updatedAt:ht()},E=ke(xe,"pomodoro",`${c.uid}_${u}`);await Zt(E,S)}catch(v){console.error("Pomodoro - Error al eliminar sesin:",v),o(v instanceof Error?v.message:"Error al eliminar"),a("error")}}},x=async(b,v)=>{if(!(!c||!s)){a("saving"),o(null);try{const w=new Date(b.startTime.timestamp);let N=b.startTime,S=b.endTime;if(v.startTime){const R=new Date(v.startTime.timestamp),O=jn(w,R.getHours(),R.getMinutes());N={timestamp:O.timestamp,utcOffset:O.utcOffset,formatted:O.formatted}}if(v.endTime){const R=new Date(v.endTime.timestamp),O=jn(w,R.getHours(),R.getMinutes());S={timestamp:O.timestamp,utcOffset:O.utcOffset,formatted:O.formatted}}const E=(S.timestamp-N.timestamp)/1e3,k=s.sessions.map(R=>{var O;return R.startTime.timestamp===b.startTime.timestamp?{...R,startTime:N,endTime:S,duration:E,completed:v.completed??R.completed,...(O=v.description)!=null&&O.trim()?{description:v.description.trim()}:{}}:R}),D={...s,count:k.filter(R=>R.completed).length,sessions:k,updatedAt:ht()},T=ke(xe,"pomodoro",`${c.uid}_${u}`);await Zt(T,D),await d()}catch(w){console.error("Pomodoro - Error al editar sesin:",w),o(w instanceof Error?w.message:"Error al editar"),a("error")}}},y=Ha("Pomodoro data");return{count:(s==null?void 0:s.count)??0,sessions:(s==null?void 0:s.sessions)??[],status:r,error:i,saveSession:p,deleteSession:g,editSession:x,addManualSession:h,loadPomodoroData:d,resync:y}},vx=()=>{const[t,s]=f.useState("default"),[n,r]=f.useState({enabled:!1,sound:!0,vibration:!0}),a=f.useRef(null),i=f.useRef(),o=f.useCallback(()=>"Notification"in window,[]),c=f.useCallback(async()=>{if(!o())return!1;try{const x=await Notification.requestPermission();return s(x),x==="granted"}catch(x){return console.error("Error requesting notification permission:",x),!1}},[]),u=f.useCallback(async(x,y)=>{if(!(!o()||t!=="granted"))try{if("serviceWorker"in navigator){const v=await navigator.serviceWorker.getRegistration();if(v){await v.showNotification(x,{icon:"/icon-192x192.png",silent:!n.sound,...y});return}}const b=new Notification(x,{icon:"/icon-192x192.png",silent:!n.sound,...y});b.onclick=()=>{window.focus(),b.close()}}catch(b){console.error("Error sending notification:",b)}},[t,n,o]),d=f.useCallback(async(x,y)=>{var b;if(!(!o()||t!=="granted"))try{if("serviceWorker"in navigator){const w=await navigator.serviceWorker.getRegistration();if(w){await w.showNotification(x,{body:y,icon:"/icon-192x192.png",silent:!n.sound,requireInteraction:!0,tag:"pomodoro-active"});return}}(b=a.current)==null||b.close();const v=new Notification(x,{body:y,icon:"/icon-192x192.png",silent:!n.sound,requireInteraction:!0,tag:"pomodoro-active"});v.onclick=()=>{window.focus(),v.close()},a.current=v}catch(v){console.error("Error sending persistent notification:",v)}},[t,n,o]),h=f.useCallback((x,y,b=6e4)=>{d(x,y()),i.current&&clearInterval(i.current),i.current=window.setInterval(()=>{d(x,y())},b)},[d]),p=f.useCallback(async()=>{if(i.current&&(clearInterval(i.current),i.current=void 0),a.current&&(a.current.close(),a.current=null),"serviceWorker"in navigator)try{const x=await navigator.serviceWorker.getRegistration();x&&(await x.getNotifications({tag:"pomodoro-active"})).forEach(b=>b.close())}catch(x){console.error("Error closing persistent notification:",x)}},[]);f.useEffect(()=>{const x=localStorage.getItem("pomodoroNotificationPrefs");if(x)try{r(JSON.parse(x))}catch{console.warn("Invalid pomodoro prefs in storage")}o()&&s(Notification.permission)},[]);const g=f.useCallback(x=>{r(y=>{const b={...y,...x};return localStorage.setItem("pomodoroNotificationPrefs",JSON.stringify(b)),b})},[]);return{supported:o(),permission:t,preferences:n,requestPermission:c,sendNotification:u,updatePreferences:g,startPersistentNotification:h,stopPersistentNotification:p}},wy=30*60,Do="active-pomodoro-timer",Kw=()=>{const[t,s]=f.useState(0),[n,r]=f.useState(!1),a=f.useRef(),i=f.useRef(!1),o=f.useRef(null),{preferences:c,permission:u,sendNotification:d}=vx(),h=()=>{try{const N=localStorage.getItem(Do);if(!N)return null;const S=JSON.parse(N);return(Date.now()-S.startTime)/1e3>=S.duration?(localStorage.removeItem(Do),null):S}catch(N){return console.error("Error reading pomodoro timer from localStorage:",N),localStorage.removeItem(Do),null}},p=N=>Math.floor((Date.now()-N)/1e3),g=N=>{const S=Math.floor(N/60),E=Math.floor(N%60);return`${S<10?"0":""}${S}:${E<10?"0":""}${E}`},x=()=>{if(c.sound)try{const N=new(window.AudioContext||window.webkitAudioContext),S=N.createOscillator(),E=N.createGain();S.connect(E),E.connect(N.destination),S.frequency.setValueAtTime(880,N.currentTime),S.frequency.setValueAtTime(660,N.currentTime+.1),S.frequency.setValueAtTime(523,N.currentTime+.2),E.gain.setValueAtTime(.3,N.currentTime),E.gain.exponentialRampToValueAtTime(.01,N.currentTime+.8),S.start(N.currentTime),S.stop(N.currentTime+.8),setTimeout(()=>{N.close()},1e3)}catch(N){console.warn("No se pudo reproducir el sonido de finalizacin:",N)}},y=()=>{i.current||(i.current=!0,o.current&&(console.log("Notificando completacin a usePomodoroTimer..."),o.current(wy)),x(),c.enabled&&u==="granted"&&d("Pomodoro completado! ",{body:"Has completado exitosamente tu sesin de concentracin",requireInteraction:!0}),setTimeout(()=>{localStorage.removeItem(Do),r(!1),s(0),i.current=!1},500))};f.useEffect(()=>{const N=h();N&&(r(!0),s(p(N.startTime)))},[]),f.useEffect(()=>(n?a.current=setInterval(()=>{const N=h();if(N){const S=p(N.startTime);s(S),S>=N.duration&&y()}else r(!1),s(0)},1e3):a.current&&clearInterval(a.current),()=>{a.current&&clearInterval(a.current)}),[n]);const b=N=>{o.current=N},v=()=>{const N={startTime:Date.now(),duration:wy,isActive:!0};localStorage.setItem(Do,JSON.stringify(N)),r(!0),s(0),i.current=!1},w=()=>{localStorage.removeItem(Do),r(!1),s(0),i.current=!1};return f.useEffect(()=>{const N=S=>{if(S.key===Do){const E=h();E?(r(!0),s(p(E.startTime))):(r(!1),s(0))}};return window.addEventListener("storage",N),()=>window.removeEventListener("storage",N)},[]),{time:t,isActive:n,formattedTime:g(t),startTimer:v,stopTimer:w,setOnCompletion:b}},YI=()=>{const t=Ln(),s=Qt(),{isOnline:n}=ua(),a=qw().status,{isActive:i,formattedTime:o}=Kw(),{supported:c,permission:u,preferences:d,requestPermission:h,sendNotification:p,updatePreferences:g}=vx(),x=k=>({"/":"Inicio","/water":"Hidratacin","/exercise":"Ejercicio","/habit":"Hbitos","/mood":"Estado de nimo","/journal":"Diario","/pomodoro":"Pomodoro","/meal":"Comidas","/task":"Tareas","/kanban":"Kanban","/stats":"Estadsticas","/negative":"Hbitos Negativos","/settings":"Configuracin"})[k]||"Life Tracker",y=i,b=()=>({idle:"Inactivo",saving:"Guardando...",pending:"Pendiente",saved:"Sincronizado",error:"Error"})[a]||"Sincronizado",v=()=>{switch(a){case"saving":case"pending":return e.jsx("div",{className:"w-3 h-3 border border-white border-t-transparent rounded-full animate-spin"});case"error":return e.jsx(ro,{className:"w-3 h-3"});default:return e.jsx(aa,{className:"w-3 h-3"})}},w=async()=>{c&&(u==="default"?await h()&&(g({enabled:!0}),p(" Notificaciones activadas",{body:"Recibirs notificaciones cuando terminen los Pomodoros",requireInteraction:!1})):u==="granted"&&p(" Prueba de notificacin",{body:"Las notificaciones estn funcionando correctamente",requireInteraction:!1}))},N=()=>{g({sound:!d.sound})},E=c?u==="denied"?{icon:Wu,tooltip:"Notificaciones bloqueadas",color:"text-red-400"}:u==="default"?{icon:ip,tooltip:"Click para activar notificaciones",color:"text-yellow-400"}:d.enabled?{icon:ip,tooltip:"Notificaciones activadas",color:"text-green-400"}:{icon:Wu,tooltip:"Notificaciones desactivadas",color:"text-gray-400"}:{icon:Wu,tooltip:"Notificaciones no soportadas",color:"text-gray-500"};return e.jsxs("footer",{className:"hidden md:flex w-full h-6 bg-[#007ACC] text-white text-xs items-center justify-between px-4 border-t border-[#005a9e] select-none",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex items-center space-x-1",children:n?e.jsxs(e.Fragment,{children:[e.jsx(vO,{className:"w-3 h-3"}),e.jsx("span",{children:"En lnea"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ap,{className:"w-3 h-3"}),e.jsx("span",{children:"Sin conexin"})]})}),e.jsxs("div",{className:"flex items-center space-x-1",children:[v(),e.jsx("span",{children:b()})]})]}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsx("div",{className:"flex items-center space-x-1",children:e.jsx("span",{className:"font-medium",children:x(t.pathname)})})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[y&&e.jsxs("button",{type:"button",onClick:()=>s("/pomodoro"),className:"flex items-center space-x-2 bg-[#005a9e] px-2 py-1 rounded hover:bg-[#007ACC] transition-colors",children:[e.jsx(zo,{className:"w-3 h-3"}),e.jsx("span",{className:"font-mono",children:o}),e.jsx("span",{className:"text-xs",children:"Transcurrido"})]}),!y&&e.jsxs("button",{type:"button",onClick:()=>s("/pomodoro"),className:"flex items-center space-x-1 hover:bg-[#005a9e] px-2 py-1 rounded transition-colors",children:[e.jsx(zo,{className:"w-3 h-3"}),e.jsx("span",{children:"Pomodoro"})]}),c&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("button",{type:"button",onClick:w,className:"flex items-center space-x-1 hover:bg-[#005a9e] px-1 py-0.5 rounded transition-colors group",title:E.tooltip,children:e.jsx(E.icon,{className:`w-3 h-3 ${E.color}`})}),u==="granted"&&e.jsx("button",{type:"button",onClick:N,className:"flex items-center hover:bg-[#005a9e] px-1 py-0.5 rounded transition-colors",title:d.sound?"Sonido activado":"Sonido desactivado",children:d.sound?e.jsx(yO,{className:"w-3 h-3 text-green-400"}):e.jsx(bO,{className:"w-3 h-3 text-gray-400"})})]}),e.jsx("div",{className:"flex items-center space-x-1",children:e.jsx("span",{className:"text-[#87CEEB]",children:"Life Tracker v1.0"})})]})]})};var Ny=["light","dark"],VI="(prefers-color-scheme: dark)",GI=f.createContext(void 0),qI={setTheme:t=>{},themes:[]},KI=()=>{var t;return(t=f.useContext(GI))!=null?t:qI};f.memo(({forcedTheme:t,storageKey:s,attribute:n,enableSystem:r,enableColorScheme:a,defaultTheme:i,value:o,attrs:c,nonce:u})=>{let d=i==="system",h=n==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${c.map(y=>`'${y}'`).join(",")})`};`:`var d=document.documentElement,n='${n}',s='setAttribute';`,p=a?Ny.includes(i)&&i?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${i}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",g=(y,b=!1,v=!0)=>{let w=o?o[y]:y,N=b?y+"|| ''":`'${w}'`,S="";return a&&v&&!b&&Ny.includes(y)&&(S+=`d.style.colorScheme = '${y}';`),n==="class"?b||w?S+=`c.add(${N})`:S+="null":w&&(S+=`d[s](n,${N})`),S},x=t?`!function(){${h}${g(t)}}()`:r?`!function(){try{${h}var e=localStorage.getItem('${s}');if('system'===e||(!e&&${d})){var t='${VI}',m=window.matchMedia(t);if(m.media!==t||m.matches){${g("dark")}}else{${g("light")}}}else if(e){${o?`var x=${JSON.stringify(o)};`:""}${g(o?"x[e]":"e",!0)}}${d?"":"else{"+g(i,!1,!1)+"}"}${p}}catch(e){}}()`:`!function(){try{${h}var e=localStorage.getItem('${s}');if(e){${o?`var x=${JSON.stringify(o)};`:""}${g(o?"x[e]":"e",!0)}}else{${g(i,!1,!1)};}${p}}catch(t){}}();`;return f.createElement("script",{nonce:u,dangerouslySetInnerHTML:{__html:x}})});var JI=t=>{switch(t){case"success":return QI;case"info":return t4;case"warning":return e4;case"error":return s4;default:return null}},XI=Array(12).fill(0),ZI=({visible:t,className:s})=>ee.createElement("div",{className:["sonner-loading-wrapper",s].filter(Boolean).join(" "),"data-visible":t},ee.createElement("div",{className:"sonner-spinner"},XI.map((n,r)=>ee.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${r}`})))),QI=ee.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},ee.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),e4=ee.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},ee.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),t4=ee.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},ee.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),s4=ee.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},ee.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),n4=ee.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},ee.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),ee.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),r4=()=>{let[t,s]=ee.useState(document.hidden);return ee.useEffect(()=>{let n=()=>{s(document.hidden)};return document.addEventListener("visibilitychange",n),()=>window.removeEventListener("visibilitychange",n)},[]),t},Sp=1,a4=class{constructor(){this.subscribe=t=>(this.subscribers.push(t),()=>{let s=this.subscribers.indexOf(t);this.subscribers.splice(s,1)}),this.publish=t=>{this.subscribers.forEach(s=>s(t))},this.addToast=t=>{this.publish(t),this.toasts=[...this.toasts,t]},this.create=t=>{var s;let{message:n,...r}=t,a=typeof(t==null?void 0:t.id)=="number"||((s=t.id)==null?void 0:s.length)>0?t.id:Sp++,i=this.toasts.find(c=>c.id===a),o=t.dismissible===void 0?!0:t.dismissible;return this.dismissedToasts.has(a)&&this.dismissedToasts.delete(a),i?this.toasts=this.toasts.map(c=>c.id===a?(this.publish({...c,...t,id:a,title:n}),{...c,...t,id:a,dismissible:o,title:n}):c):this.addToast({title:n,...r,dismissible:o,id:a}),a},this.dismiss=t=>(this.dismissedToasts.add(t),t||this.toasts.forEach(s=>{this.subscribers.forEach(n=>n({id:s.id,dismiss:!0}))}),this.subscribers.forEach(s=>s({id:t,dismiss:!0})),t),this.message=(t,s)=>this.create({...s,message:t}),this.error=(t,s)=>this.create({...s,message:t,type:"error"}),this.success=(t,s)=>this.create({...s,type:"success",message:t}),this.info=(t,s)=>this.create({...s,type:"info",message:t}),this.warning=(t,s)=>this.create({...s,type:"warning",message:t}),this.loading=(t,s)=>this.create({...s,type:"loading",message:t}),this.promise=(t,s)=>{if(!s)return;let n;s.loading!==void 0&&(n=this.create({...s,promise:t,type:"loading",message:s.loading,description:typeof s.description!="function"?s.description:void 0}));let r=t instanceof Promise?t:t(),a=n!==void 0,i,o=r.then(async u=>{if(i=["resolve",u],ee.isValidElement(u))a=!1,this.create({id:n,type:"default",message:u});else if(o4(u)&&!u.ok){a=!1;let d=typeof s.error=="function"?await s.error(`HTTP error! status: ${u.status}`):s.error,h=typeof s.description=="function"?await s.description(`HTTP error! status: ${u.status}`):s.description;this.create({id:n,type:"error",message:d,description:h})}else if(s.success!==void 0){a=!1;let d=typeof s.success=="function"?await s.success(u):s.success,h=typeof s.description=="function"?await s.description(u):s.description;this.create({id:n,type:"success",message:d,description:h})}}).catch(async u=>{if(i=["reject",u],s.error!==void 0){a=!1;let d=typeof s.error=="function"?await s.error(u):s.error,h=typeof s.description=="function"?await s.description(u):s.description;this.create({id:n,type:"error",message:d,description:h})}}).finally(()=>{var u;a&&(this.dismiss(n),n=void 0),(u=s.finally)==null||u.call(s)}),c=()=>new Promise((u,d)=>o.then(()=>i[0]==="reject"?d(i[1]):u(i[1])).catch(d));return typeof n!="string"&&typeof n!="number"?{unwrap:c}:Object.assign(n,{unwrap:c})},this.custom=(t,s)=>{let n=(s==null?void 0:s.id)||Sp++;return this.create({jsx:t(n),id:n,...s}),n},this.getActiveToasts=()=>this.toasts.filter(t=>!this.dismissedToasts.has(t.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},rr=new a4,i4=(t,s)=>{let n=(s==null?void 0:s.id)||Sp++;return rr.addToast({title:t,...s,id:n}),n},o4=t=>t&&typeof t=="object"&&"ok"in t&&typeof t.ok=="boolean"&&"status"in t&&typeof t.status=="number",l4=i4,c4=()=>rr.toasts,d4=()=>rr.getActiveToasts(),bt=Object.assign(l4,{success:rr.success,info:rr.info,warning:rr.warning,error:rr.error,custom:rr.custom,message:rr.message,promise:rr.promise,dismiss:rr.dismiss,loading:rr.loading},{getHistory:c4,getToasts:d4});function u4(t,{insertAt:s}={}){if(typeof document>"u")return;let n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",s==="top"&&n.firstChild?n.insertBefore(r,n.firstChild):n.appendChild(r),r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}u4(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function Du(t){return t.label!==void 0}var m4=3,h4="32px",f4="16px",Sy=4e3,p4=356,x4=14,g4=20,v4=200;function Gr(...t){return t.filter(Boolean).join(" ")}function y4(t){let[s,n]=t.split("-"),r=[];return s&&r.push(s),n&&r.push(n),r}var b4=t=>{var s,n,r,a,i,o,c,u,d,h,p;let{invert:g,toast:x,unstyled:y,interacting:b,setHeights:v,visibleToasts:w,heights:N,index:S,toasts:E,expanded:k,removeToast:D,defaultRichColors:T,closeButton:R,style:O,cancelButtonStyle:U,actionButtonStyle:I,className:_="",descriptionClassName:M="",duration:W,position:B,gap:P,loadingIcon:z,expandByDefault:G,classNames:ae,icons:Y,closeButtonAriaLabel:X="Close toast",pauseWhenPageIsHidden:se}=t,[H,ie]=ee.useState(null),[fe,le]=ee.useState(null),[K,de]=ee.useState(!1),[je,ge]=ee.useState(!1),[Se,oe]=ee.useState(!1),[J,ye]=ee.useState(!1),[xt,gt]=ee.useState(!1),[dt,qs]=ee.useState(0),[Ss,q]=ee.useState(0),ne=ee.useRef(x.duration||W||Sy),me=ee.useRef(null),Te=ee.useRef(null),Ee=S===0,Ne=S+1<=w,Re=x.type,qe=x.dismissible!==!1,st=x.className||"",es=x.descriptionClassName||"",Os=ee.useMemo(()=>N.findIndex(_e=>_e.toastId===x.id)||0,[N,x.id]),qt=ee.useMemo(()=>{var _e;return(_e=x.closeButton)!=null?_e:R},[x.closeButton,R]),tn=ee.useMemo(()=>x.duration||W||Sy,[x.duration,W]),Ks=ee.useRef(0),ds=ee.useRef(0),zs=ee.useRef(0),Ps=ee.useRef(null),[$n,Ve]=B.split("-"),ut=ee.useMemo(()=>N.reduce((_e,Be,Xe)=>Xe>=Os?_e:_e+Be.height,0),[N,Os]),Nt=r4(),Ut=x.invert||g,Ge=Re==="loading";ds.current=ee.useMemo(()=>Os*P+ut,[Os,ut]),ee.useEffect(()=>{ne.current=tn},[tn]),ee.useEffect(()=>{de(!0)},[]),ee.useEffect(()=>{let _e=Te.current;if(_e){let Be=_e.getBoundingClientRect().height;return q(Be),v(Xe=>[{toastId:x.id,height:Be,position:x.position},...Xe]),()=>v(Xe=>Xe.filter(Rt=>Rt.toastId!==x.id))}},[v,x.id]),ee.useLayoutEffect(()=>{if(!K)return;let _e=Te.current,Be=_e.style.height;_e.style.height="auto";let Xe=_e.getBoundingClientRect().height;_e.style.height=Be,q(Xe),v(Rt=>Rt.find($t=>$t.toastId===x.id)?Rt.map($t=>$t.toastId===x.id?{...$t,height:Xe}:$t):[{toastId:x.id,height:Xe,position:x.position},...Rt])},[K,x.title,x.description,v,x.id]);let ft=ee.useCallback(()=>{ge(!0),qs(ds.current),v(_e=>_e.filter(Be=>Be.toastId!==x.id)),setTimeout(()=>{D(x)},v4)},[x,D,v,ds]);ee.useEffect(()=>{if(x.promise&&Re==="loading"||x.duration===1/0||x.type==="loading")return;let _e;return k||b||se&&Nt?(()=>{if(zs.current<Ks.current){let Be=new Date().getTime()-Ks.current;ne.current=ne.current-Be}zs.current=new Date().getTime()})():ne.current!==1/0&&(Ks.current=new Date().getTime(),_e=setTimeout(()=>{var Be;(Be=x.onAutoClose)==null||Be.call(x,x),ft()},ne.current)),()=>clearTimeout(_e)},[k,b,x,Re,se,Nt,ft]),ee.useEffect(()=>{x.delete&&ft()},[ft,x.delete]);function Lt(){var _e,Be,Xe;return Y!=null&&Y.loading?ee.createElement("div",{className:Gr(ae==null?void 0:ae.loader,(_e=x==null?void 0:x.classNames)==null?void 0:_e.loader,"sonner-loader"),"data-visible":Re==="loading"},Y.loading):z?ee.createElement("div",{className:Gr(ae==null?void 0:ae.loader,(Be=x==null?void 0:x.classNames)==null?void 0:Be.loader,"sonner-loader"),"data-visible":Re==="loading"},z):ee.createElement(ZI,{className:Gr(ae==null?void 0:ae.loader,(Xe=x==null?void 0:x.classNames)==null?void 0:Xe.loader),visible:Re==="loading"})}return ee.createElement("li",{tabIndex:0,ref:Te,className:Gr(_,st,ae==null?void 0:ae.toast,(s=x==null?void 0:x.classNames)==null?void 0:s.toast,ae==null?void 0:ae.default,ae==null?void 0:ae[Re],(n=x==null?void 0:x.classNames)==null?void 0:n[Re]),"data-sonner-toast":"","data-rich-colors":(r=x.richColors)!=null?r:T,"data-styled":!(x.jsx||x.unstyled||y),"data-mounted":K,"data-promise":!!x.promise,"data-swiped":xt,"data-removed":je,"data-visible":Ne,"data-y-position":$n,"data-x-position":Ve,"data-index":S,"data-front":Ee,"data-swiping":Se,"data-dismissible":qe,"data-type":Re,"data-invert":Ut,"data-swipe-out":J,"data-swipe-direction":fe,"data-expanded":!!(k||G&&K),style:{"--index":S,"--toasts-before":S,"--z-index":E.length-S,"--offset":`${je?dt:ds.current}px`,"--initial-height":G?"auto":`${Ss}px`,...O,...x.style},onDragEnd:()=>{oe(!1),ie(null),Ps.current=null},onPointerDown:_e=>{Ge||!qe||(me.current=new Date,qs(ds.current),_e.target.setPointerCapture(_e.pointerId),_e.target.tagName!=="BUTTON"&&(oe(!0),Ps.current={x:_e.clientX,y:_e.clientY}))},onPointerUp:()=>{var _e,Be,Xe,Rt;if(J||!qe)return;Ps.current=null;let $t=Number(((_e=Te.current)==null?void 0:_e.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),Ot=Number(((Be=Te.current)==null?void 0:Be.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),xs=new Date().getTime()-((Xe=me.current)==null?void 0:Xe.getTime()),gs=H==="x"?$t:Ot,Wt=Math.abs(gs)/xs;if(Math.abs(gs)>=g4||Wt>.11){qs(ds.current),(Rt=x.onDismiss)==null||Rt.call(x,x),le(H==="x"?$t>0?"right":"left":Ot>0?"down":"up"),ft(),ye(!0),gt(!1);return}oe(!1),ie(null)},onPointerMove:_e=>{var Be,Xe,Rt,$t;if(!Ps.current||!qe||((Be=window.getSelection())==null?void 0:Be.toString().length)>0)return;let Ot=_e.clientY-Ps.current.y,xs=_e.clientX-Ps.current.x,gs=(Xe=t.swipeDirections)!=null?Xe:y4(B);!H&&(Math.abs(xs)>1||Math.abs(Ot)>1)&&ie(Math.abs(xs)>Math.abs(Ot)?"x":"y");let Wt={x:0,y:0};H==="y"?(gs.includes("top")||gs.includes("bottom"))&&(gs.includes("top")&&Ot<0||gs.includes("bottom")&&Ot>0)&&(Wt.y=Ot):H==="x"&&(gs.includes("left")||gs.includes("right"))&&(gs.includes("left")&&xs<0||gs.includes("right")&&xs>0)&&(Wt.x=xs),(Math.abs(Wt.x)>0||Math.abs(Wt.y)>0)&&gt(!0),(Rt=Te.current)==null||Rt.style.setProperty("--swipe-amount-x",`${Wt.x}px`),($t=Te.current)==null||$t.style.setProperty("--swipe-amount-y",`${Wt.y}px`)}},qt&&!x.jsx?ee.createElement("button",{"aria-label":X,"data-disabled":Ge,"data-close-button":!0,onClick:Ge||!qe?()=>{}:()=>{var _e;ft(),(_e=x.onDismiss)==null||_e.call(x,x)},className:Gr(ae==null?void 0:ae.closeButton,(a=x==null?void 0:x.classNames)==null?void 0:a.closeButton)},(i=Y==null?void 0:Y.close)!=null?i:n4):null,x.jsx||f.isValidElement(x.title)?x.jsx?x.jsx:typeof x.title=="function"?x.title():x.title:ee.createElement(ee.Fragment,null,Re||x.icon||x.promise?ee.createElement("div",{"data-icon":"",className:Gr(ae==null?void 0:ae.icon,(o=x==null?void 0:x.classNames)==null?void 0:o.icon)},x.promise||x.type==="loading"&&!x.icon?x.icon||Lt():null,x.type!=="loading"?x.icon||(Y==null?void 0:Y[Re])||JI(Re):null):null,ee.createElement("div",{"data-content":"",className:Gr(ae==null?void 0:ae.content,(c=x==null?void 0:x.classNames)==null?void 0:c.content)},ee.createElement("div",{"data-title":"",className:Gr(ae==null?void 0:ae.title,(u=x==null?void 0:x.classNames)==null?void 0:u.title)},typeof x.title=="function"?x.title():x.title),x.description?ee.createElement("div",{"data-description":"",className:Gr(M,es,ae==null?void 0:ae.description,(d=x==null?void 0:x.classNames)==null?void 0:d.description)},typeof x.description=="function"?x.description():x.description):null),f.isValidElement(x.cancel)?x.cancel:x.cancel&&Du(x.cancel)?ee.createElement("button",{"data-button":!0,"data-cancel":!0,style:x.cancelButtonStyle||U,onClick:_e=>{var Be,Xe;Du(x.cancel)&&qe&&((Xe=(Be=x.cancel).onClick)==null||Xe.call(Be,_e),ft())},className:Gr(ae==null?void 0:ae.cancelButton,(h=x==null?void 0:x.classNames)==null?void 0:h.cancelButton)},x.cancel.label):null,f.isValidElement(x.action)?x.action:x.action&&Du(x.action)?ee.createElement("button",{"data-button":!0,"data-action":!0,style:x.actionButtonStyle||I,onClick:_e=>{var Be,Xe;Du(x.action)&&((Xe=(Be=x.action).onClick)==null||Xe.call(Be,_e),!_e.defaultPrevented&&ft())},className:Gr(ae==null?void 0:ae.actionButton,(p=x==null?void 0:x.classNames)==null?void 0:p.actionButton)},x.action.label):null))};function Cy(){if(typeof window>"u"||typeof document>"u")return"ltr";let t=document.documentElement.getAttribute("dir");return t==="auto"||!t?window.getComputedStyle(document.documentElement).direction:t}function j4(t,s){let n={};return[t,s].forEach((r,a)=>{let i=a===1,o=i?"--mobile-offset":"--offset",c=i?f4:h4;function u(d){["top","right","bottom","left"].forEach(h=>{n[`${o}-${h}`]=typeof d=="number"?`${d}px`:d})}typeof r=="number"||typeof r=="string"?u(r):typeof r=="object"?["top","right","bottom","left"].forEach(d=>{r[d]===void 0?n[`${o}-${d}`]=c:n[`${o}-${d}`]=typeof r[d]=="number"?`${r[d]}px`:r[d]}):u(c)}),n}var w4=f.forwardRef(function(t,s){let{invert:n,position:r="bottom-right",hotkey:a=["altKey","KeyT"],expand:i,closeButton:o,className:c,offset:u,mobileOffset:d,theme:h="light",richColors:p,duration:g,style:x,visibleToasts:y=m4,toastOptions:b,dir:v=Cy(),gap:w=x4,loadingIcon:N,icons:S,containerAriaLabel:E="Notifications",pauseWhenPageIsHidden:k}=t,[D,T]=ee.useState([]),R=ee.useMemo(()=>Array.from(new Set([r].concat(D.filter(se=>se.position).map(se=>se.position)))),[D,r]),[O,U]=ee.useState([]),[I,_]=ee.useState(!1),[M,W]=ee.useState(!1),[B,P]=ee.useState(h!=="system"?h:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),z=ee.useRef(null),G=a.join("+").replace(/Key/g,"").replace(/Digit/g,""),ae=ee.useRef(null),Y=ee.useRef(!1),X=ee.useCallback(se=>{T(H=>{var ie;return(ie=H.find(fe=>fe.id===se.id))!=null&&ie.delete||rr.dismiss(se.id),H.filter(({id:fe})=>fe!==se.id)})},[]);return ee.useEffect(()=>rr.subscribe(se=>{if(se.dismiss){T(H=>H.map(ie=>ie.id===se.id?{...ie,delete:!0}:ie));return}setTimeout(()=>{UR.flushSync(()=>{T(H=>{let ie=H.findIndex(fe=>fe.id===se.id);return ie!==-1?[...H.slice(0,ie),{...H[ie],...se},...H.slice(ie+1)]:[se,...H]})})})}),[]),ee.useEffect(()=>{if(h!=="system"){P(h);return}if(h==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?P("dark"):P("light")),typeof window>"u")return;let se=window.matchMedia("(prefers-color-scheme: dark)");try{se.addEventListener("change",({matches:H})=>{P(H?"dark":"light")})}catch{se.addListener(({matches:ie})=>{try{P(ie?"dark":"light")}catch(fe){console.error(fe)}})}},[h]),ee.useEffect(()=>{D.length<=1&&_(!1)},[D]),ee.useEffect(()=>{let se=H=>{var ie,fe;a.every(le=>H[le]||H.code===le)&&(_(!0),(ie=z.current)==null||ie.focus()),H.code==="Escape"&&(document.activeElement===z.current||(fe=z.current)!=null&&fe.contains(document.activeElement))&&_(!1)};return document.addEventListener("keydown",se),()=>document.removeEventListener("keydown",se)},[a]),ee.useEffect(()=>{if(z.current)return()=>{ae.current&&(ae.current.focus({preventScroll:!0}),ae.current=null,Y.current=!1)}},[z.current]),ee.createElement("section",{ref:s,"aria-label":`${E} ${G}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},R.map((se,H)=>{var ie;let[fe,le]=se.split("-");return D.length?ee.createElement("ol",{key:se,dir:v==="auto"?Cy():v,tabIndex:-1,ref:z,className:c,"data-sonner-toaster":!0,"data-theme":B,"data-y-position":fe,"data-lifted":I&&D.length>1&&!i,"data-x-position":le,style:{"--front-toast-height":`${((ie=O[0])==null?void 0:ie.height)||0}px`,"--width":`${p4}px`,"--gap":`${w}px`,...x,...j4(u,d)},onBlur:K=>{Y.current&&!K.currentTarget.contains(K.relatedTarget)&&(Y.current=!1,ae.current&&(ae.current.focus({preventScroll:!0}),ae.current=null))},onFocus:K=>{K.target instanceof HTMLElement&&K.target.dataset.dismissible==="false"||Y.current||(Y.current=!0,ae.current=K.relatedTarget)},onMouseEnter:()=>_(!0),onMouseMove:()=>_(!0),onMouseLeave:()=>{M||_(!1)},onDragEnd:()=>_(!1),onPointerDown:K=>{K.target instanceof HTMLElement&&K.target.dataset.dismissible==="false"||W(!0)},onPointerUp:()=>W(!1)},D.filter(K=>!K.position&&H===0||K.position===se).map((K,de)=>{var je,ge;return ee.createElement(b4,{key:K.id,icons:S,index:de,toast:K,defaultRichColors:p,duration:(je=b==null?void 0:b.duration)!=null?je:g,className:b==null?void 0:b.className,descriptionClassName:b==null?void 0:b.descriptionClassName,invert:n,visibleToasts:y,closeButton:(ge=b==null?void 0:b.closeButton)!=null?ge:o,interacting:M,position:se,style:b==null?void 0:b.style,unstyled:b==null?void 0:b.unstyled,classNames:b==null?void 0:b.classNames,cancelButtonStyle:b==null?void 0:b.cancelButtonStyle,actionButtonStyle:b==null?void 0:b.actionButtonStyle,removeToast:X,toasts:D.filter(Se=>Se.position==K.position),heights:O.filter(Se=>Se.position==K.position),setHeights:U,expandByDefault:i,gap:w,loadingIcon:N,expanded:I,pauseWhenPageIsHidden:k,swipeDirections:t.swipeDirections})})):null}))});const N4=({...t})=>{const{theme:s="system"}=KI();return e.jsx(w4,{theme:s,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...t})},S4=()=>e.jsx(lI,{children:e.jsxs("div",{className:"flex h-screen bg-gray-50 overflow-hidden",children:[e.jsx(aI,{}),e.jsxs("div",{className:"flex-1 flex flex-col main-content-adaptive overflow-hidden",children:[e.jsx("div",{className:"pt-0 flex-1 flex flex-col overflow-hidden",children:e.jsx("main",{className:"flex-1 overflow-auto scroll-container",children:e.jsx(RP,{})})}),e.jsx(YI,{}),e.jsx("div",{className:"pb-16 md:pb-0"})]}),e.jsx(oI,{}),e.jsx(iI,{}),e.jsx(N4,{})]})}),C4=()=>{const{user:t,signIn:s,signOut:n}=Je();return e.jsx("div",{className:"flex items-center gap-4",children:t?e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-sm",children:t.email}),e.jsx($,{variant:"outline",onClick:n,children:"Cerrar sesin"})]}):e.jsx($,{onClick:s,children:"Iniciar sesin con Google"})})},La=({selectedDate:t,onChange:s})=>{const[n,r]=f.useState(!1);f.useEffect(()=>{const d=()=>{r(window.innerWidth<768)};return d(),window.addEventListener("resize",d),()=>window.removeEventListener("resize",d)},[]);const a=()=>{const d=new Date(t);d.setDate(d.getDate()-1),s(d)},i=()=>{const d=new Date(t);d.setDate(d.getDate()+1),s(d)},o=()=>{s(new Date)},c=d=>n?d.toLocaleDateString("es-ES",{weekday:"short",month:"short",day:"numeric"}):d.toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),u=d=>{const h=new Date;return d.toDateString()===h.toDateString()};return e.jsx("div",{className:"bg-white/95 backdrop-blur-sm border border-gray-200 rounded-2xl p-4 mb-6 shadow-sm md:p-6 md:mb-8",children:e.jsxs("div",{className:"flex items-center justify-between gap-2 md:gap-4",children:[e.jsx($,{variant:"outline",size:"icon",onClick:a,className:"rounded-full border-2 bg-white/80 w-8 h-8 md:w-10 md:h-10 touch-manipulation active:scale-95 transition-transform",children:e.jsx(ix,{className:"w-3 h-3 md:w-4 md:h-4"})}),e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("h2",{className:"text-sm md:text-xl font-semibold bg-gradient-to-r from-gray-700 to-gray-900 bg-clip-text text-transparent capitalize",children:c(t)}),!u(t)&&e.jsxs($,{variant:"ghost",className:"text-xs md:text-sm mt-1 md:mt-2 rounded-full h-6 md:h-auto px-2 md:px-4 touch-manipulation active:scale-95 transition-transform",onClick:o,children:[e.jsx(ns,{className:"w-3 h-3 md:w-4 md:h-4 mr-1 md:mr-2"}),e.jsx("span",{className:"hidden md:inline",children:"Ir a hoy"}),e.jsx("span",{className:"md:hidden",children:"Hoy"})]}),u(t)&&e.jsx("div",{className:"inline-flex items-center px-2 md:px-3 py-1 mt-1 md:mt-2 rounded-full bg-green-100 text-green-800 text-xs font-medium",children:"Hoy"})]}),e.jsx($,{variant:"outline",size:"icon",onClick:i,className:"rounded-full border-2 bg-white/80 w-8 h-8 md:w-10 md:h-10 touch-manipulation active:scale-95 transition-transform",children:e.jsx(Ma,{className:"w-3 h-3 md:w-4 md:h-4"})})]})})},ln=({children:t,className:s,fullHeight:n=!1,noPadding:r=!1,showFloatingButton:a=!1,onFloatingButtonClick:i,floatingButtonLabel:o="Agregar"})=>r?e.jsxs("div",{className:ce("h-full",s),children:[t,a&&e.jsx($,{onClick:i,className:"fixed bottom-20 right-6 h-14 w-14 rounded-full shadow-lg hover:shadow-xl transition-shadow z-50 md:hidden",size:"icon",title:o,children:e.jsx(cs,{className:"h-6 w-6"})})]}):e.jsxs("div",{className:ce(n?"h-full flex flex-col":"min-h-full","px-3 sm:px-4 md:px-6 lg:px-8 xl:px-12 2xl:px-16","pt-4 md:pt-6 lg:pt-8","pb-4 md:pb-6 lg:pb-8",s),children:[e.jsx("div",{className:ce(n?"flex-1 flex flex-col":"","space-y-4 sm:space-y-6 md:space-y-8 lg:space-y-10","max-w-screen-2xl mx-auto w-full","container-wide"),children:t}),a&&e.jsx($,{onClick:i,className:"fixed bottom-20 right-6 h-14 w-14 rounded-full shadow-lg hover:shadow-xl transition-shadow z-50 md:hidden",size:"icon",title:o,children:e.jsx(cs,{className:"h-6 w-6"})})]}),E4=()=>(f.useEffect(()=>{const s=n=>{rm(n.reason)&&(console.error("Unhandled Firestore internal error:",n.reason),bt.error("Error de sincronizacin detectado",{description:"Hay un problema con la sincronizacin offline. Puedes intentar limpiar el cache.",action:{label:"Limpiar Cache",onClick:async()=>{try{await nm(),bt.success("Cache limpiado correctamente")}catch(r){console.error("Error clearing cache:",r),bt.error("Error al limpiar el cache. Recarga la pgina manualmente.")}}},duration:1e4}),n.preventDefault())};return window.addEventListener("unhandledrejection",s),()=>{window.removeEventListener("unhandledrejection",s)}},[]),{handleFirestoreError:(s,n="Error de sincronizacin")=>rm(s)?{isInternalError:!0,message:"Error de sincronizacin detectado. La operacin puede haberse completado pero hay problemas con el cache local.",shouldShowClearCache:!0}:{isInternalError:!1,message:s instanceof Error?s.message:n,shouldShowClearCache:!1},clearOfflineCache:nm}),Jw=f.forwardRef(({className:t,variant:s="default",...n},r)=>{const a={default:"bg-card text-card-foreground border shadow-sm",glass:"glass-card text-card-foreground",gradient:"gradient-bg-primary text-white border-0 shadow-lg",elevated:"bg-card text-card-foreground border-0 shadow-lg hover:shadow-xl transition-shadow duration-300"};return e.jsx("div",{ref:r,className:ce("rounded-xl transition-all duration-300",a[s],t),...n})});Jw.displayName="ModernCard";const T4=f.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:ce("flex flex-col space-y-1.5 p-6",t),...s}));T4.displayName="ModernCardHeader";const D4=f.forwardRef(({className:t,gradient:s,...n},r)=>e.jsx("h3",{ref:r,className:ce("text-2xl font-semibold leading-none tracking-tight",s&&"bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent",t),...n}));D4.displayName="ModernCardTitle";const k4=f.forwardRef(({className:t,...s},n)=>e.jsx("p",{ref:n,className:ce("text-sm text-muted-foreground",t),...s}));k4.displayName="ModernCardDescription";const A4=f.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:ce("p-6 pt-0",t),...s}));A4.displayName="ModernCardContent";const _4=f.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:ce("flex items-center p-6 pt-0",t),...s}));_4.displayName="ModernCardFooter";const Ir=({title:t,icon:s,variant:n="compact",children:r,className:a,onClick:i,loading:o=!1,error:c})=>{const u=ce("transition-all duration-200",i&&"cursor-pointer hover:shadow-md hover:scale-[1.02]",a),d=ce("flex items-center gap-2 mb-2",n==="compact"&&"mb-1"),h=ce("space-y-2",n==="compact"&&"space-y-1",n==="chart"&&"space-y-3"),p={compact:"p-3",detailed:"p-4",chart:"p-4"};return e.jsx(Jw,{className:u,variant:"default",onClick:i,children:e.jsxs("div",{className:p[n],children:[e.jsxs("div",{className:d,children:[e.jsx(s,{className:ce("text-blue-600",n==="compact"?"w-4 h-4":"w-5 h-5")}),e.jsx("h3",{className:ce("font-medium text-gray-800",n==="compact"?"text-sm":"text-base"),children:t})]}),o&&e.jsxs("div",{className:"animate-pulse space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]}),c&&e.jsxs("div",{className:"text-red-500 text-sm",children:["Error: ",c]}),!o&&!c&&e.jsx("div",{className:h,children:r})]})})},rd={water:"Agua",dairy:"Lcteos",caffeine:"Cafena",hydration:"Hidratacin",soda:"Gaseosas",alcohol:"Alcohol",other:"Otros"},or={water:{name:"Agua",icon:"Droplet",hydrationFactor:1,color:"text-blue-500",amounts:[100,200,300],category:"water"},sparklingWater:{name:"Agua con gas",icon:"Waves",hydrationFactor:1,color:"text-blue-400",amounts:[100,200,300],category:"water"},flavoredWater:{name:"Agua saborizada",icon:"Droplets",hydrationFactor:.95,color:"text-blue-300",amounts:[100,200,300],category:"water"},milk:{name:"Leche",icon:"Milk",hydrationFactor:.9,color:"text-blue-500",amounts:[100,200,300],category:"dairy"},chocolate:{name:"Chocolate",icon:"Milk",hydrationFactor:.8,color:"text-brown-500",amounts:[100,200,300],category:"dairy"},colagranulada:{name:"Cola Granulada",icon:"Milk",hydrationFactor:.9,color:"text-red-500",amounts:[100,200,300],category:"dairy"},ensure:{name:"Ensure / Pediasure",icon:"Milk",hydrationFactor:.9,color:"text-red-500",amounts:[100,200,300],category:"dairy"},yogurt:{name:"Yogurt",icon:"Milk",hydrationFactor:.6,color:"text-amber-600",amounts:[100,200,300],category:"dairy"},coffee:{name:"Caf",icon:"Coffee",hydrationFactor:.8,color:"text-amber-800",amounts:[100,200,300],category:"caffeine"},energyDrink:{name:"Energizante",icon:"Zap",hydrationFactor:.6,color:"text-yellow-500",amounts:[100,250,500],category:"caffeine"},juice:{name:"Jugo",icon:"Cherry",hydrationFactor:.85,color:"text-orange-500",amounts:[100,200,300],category:"hydration"},sportsdrink:{name:"Bebida deportiva",icon:"Dumbbell",hydrationFactor:.9,color:"text-green-500",amounts:[250,500,750],category:"hydration"},soup:{name:"Sopa",icon:"Soup",hydrationFactor:.6,color:"text-orange-500",amounts:[200,400,600],category:"other"},soda:{name:"Gaseosa",icon:"CircleDot",hydrationFactor:.6,color:"text-purple-500",amounts:[200,350,500],category:"soda"},beer:{name:"Cerveza",icon:"Beer",hydrationFactor:.8,color:"text-yellow-600",amounts:[330,500,750],category:"alcohol"},aguardiente:{name:"Aguardiente",icon:"Beer",hydrationFactor:.2,color:"text-yellow-600",amounts:[50,100,200],category:"alcohol"},wine:{name:"Vino",icon:"Wine",hydrationFactor:.1,color:"text-red-600",amounts:[150,250,750],category:"alcohol"},aromatica:{name:"Aromtica",icon:"Coffee",hydrationFactor:.95,color:"text-green-600",amounts:[100,200,300],category:"other"},iceCream:{name:"Helado",icon:"Cookie",hydrationFactor:.4,color:"text-cyan-400",amounts:[50,100,150],category:"other"},granizado:{name:"Granizado",icon:"Cookie",hydrationFactor:.8,color:"text-blue-300",amounts:[150,250,350],category:"hydration"},tea:{name:"T",icon:"Coffee",hydrationFactor:.9,color:"text-green-500",amounts:[100,200,300],category:"caffeine"}},Xw=t=>{const[s,n]=f.useState(0),[r,a]=f.useState([]),[i,o]=f.useState("idle"),[c,u]=f.useState(null),{user:d}=Je(),h=v=>v.reduce((w,N)=>w+N.hydration,0),p=async()=>{if(d){u(null);try{const v=Ie(t);Me.logRead("water","useWaterData.loadData",`${d.uid}_${v}`);const w=ke(xe,"water",`${d.uid}_${v}`),N=await ot(w);if(N.exists()){const E=N.data().drinks||[],k=h(E);n(k),a(E),o("saved")}else n(0),a([]),o("idle")}catch(v){console.error("Error loading water data:",v),u(v instanceof Error?v.message:"Error al cargar datos de hidratacin"),o("error")}}};f.useEffect(()=>{p()},[d,t]);const g=async(v,w)=>{if(!d)return;o("saving"),u(null);const N=new Date,S=jn(t,N.getHours(),N.getMinutes()),E=w*or[v].hydrationFactor,k={type:v,amount:w,hydration:E,timestamp:S.timestamp.toString(),time:N.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit",hour12:!1})},D=[...r,k],T=h(D);a(D),n(T);try{const R=Ie(t),O=ke(xe,"water",`${d.uid}_${R}`);Me.logWrite("water","useWaterData.addDrink",`${d.uid}_${R}`),await Zt(O,{userId:d.uid,date:R,drinks:D,totalWater:T,updatedAt:ht()},{merge:!0}),o("saved")}catch(R){console.error("Error adding drink:",R),a(r),n(s),u(R instanceof Error?R.message:"Error al guardar"),o("error")}},x=async(v,w)=>{if(d){o("saving"),u(null);try{const N=Ie(t),S=ke(xe,"water",`${d.uid}_${N}`),[E,k]=w.time.split(":").map(Number),D=jn(t,E,k),T={...w,timestamp:D.timestamp.toString(),hydration:w.amount*or[w.type].hydrationFactor},R=[...r];R[v]=T;const O=h(R);a(R),n(O),Me.logWrite("water","useWaterData.editDrink",`${d.uid}_${N}`),await Zt(S,{userId:d.uid,date:N,drinks:R,totalWater:O,updatedAt:ht()},{merge:!0}),o("saved")}catch(N){console.error("Error editing drink:",N),a(r),n(s),u(N instanceof Error?N.message:"Error al editar"),o("error")}}},y=async v=>{if(!d)return;o("saving"),u(null);const w=r[v];try{const N=Ie(t),S=ke(xe,"water",`${d.uid}_${N}`),E=r.filter((D,T)=>T!==v),k=h(E);a(E),n(k),Me.logWrite("water","useWaterData.deleteDrink",`${d.uid}_${N}`),await Zt(S,{userId:d.uid,date:N,drinks:E,totalWater:k,updatedAt:ht()},{merge:!0}),o("saved")}catch(N){console.error("Error deleting drink:",N);const S=[...r];S.splice(v,0,w),a(S),n(h(S)),u(N instanceof Error?N.message:"Error al eliminar"),o("error")}},b=Ha("Water data");return{intake:s,drinks:r,status:i,error:c,addDrink:g,editDrink:x,deleteDrink:y,loadWaterData:p,resync:b}},R4=({date:t,variant:s="compact"})=>{const n=Qt(),{intake:r,status:a,addDrink:i}=Xw(t),o=a==="saving"||a==="pending",c=async x=>{x.stopPropagation(),await i("water",100)},u=async x=>{x.stopPropagation(),await i("water",300)},d=async x=>{x.stopPropagation(),await i("water",600)},h=r||0,p=2e3,g=Math.min(h/p*100,100);return e.jsx(Ir,{title:"Hidratacin",icon:sw,variant:s,loading:o,onClick:()=>n("/water"),children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-lg font-bold text-blue-600",children:[h,"ml"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["de ",p,"ml (",g.toFixed(0),"%)"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-1 min-w-0",children:[e.jsx($,{size:"sm",variant:"outline",onClick:c,className:"px-1 py-1 text-xs bg-blue-50 hover:bg-blue-100 border-blue-200 min-w-0 flex-shrink-0",disabled:o,children:s==="detailed"?"100ml":"100"}),e.jsx($,{size:"sm",variant:"outline",onClick:u,className:"px-1 py-1 text-xs bg-blue-50 hover:bg-blue-100 border-blue-200 min-w-0 flex-shrink-0",disabled:o,children:s==="detailed"?"300ml":"300"}),e.jsx($,{size:"sm",variant:"outline",onClick:d,className:"px-1 py-1 text-xs bg-blue-50 hover:bg-blue-100 border-blue-200 min-w-0 flex-shrink-0",disabled:o,children:s==="detailed"?"600ml":"600"})]})]}),s==="detailed"&&e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${g}%`}})})]})})},im=t=>{const s=Po.find(n=>n.text===t);return(s==null?void 0:s.value)??5},Zw=t=>{if(t.length===0)return 0;const s=t.reduce((n,r)=>n+(r.value??im(r.text)),0);return Math.round(s/t.length*10)/10},Po=[{emoji:"",text:"Enamorado",value:10},{emoji:"",text:"Feliz",value:10},{emoji:"",text:"Energtico",value:10},{emoji:"",text:"Productivo",value:10},{emoji:"",text:"Confiado",value:9},{emoji:"",text:"Tranquilo",value:8},{emoji:"",text:"Pensativo",value:6},{emoji:"",text:"Aburrido",value:5},{emoji:"",text:"Pereza",value:4},{emoji:"",text:"Confundido",value:5},{emoji:"",text:"Nervioso",value:3},{emoji:"",text:"Abrumado",value:3},{emoji:"",text:"Frustracin",value:3},{emoji:"",text:"Ansioso",value:2},{emoji:"",text:"Cansado",value:2},{emoji:"",text:"Triste",value:1},{emoji:"",text:"Enojado",value:1},{emoji:"",text:"Enfermo",value:1}],Qw=t=>{const[s,n]=f.useState(null),[r,a]=f.useState("idle"),[i,o]=f.useState(null),{user:c}=Je(),u=async()=>{if(c)try{const x=Ie(t);Me.logRead("moods","useMoodData.loadData",`${c.uid}_${x}`);const y=ke(Bt(xe,"moods"),`${c.uid}_${x}`),b=await ot(y);if(b.exists()){const v=b.data();v&&Array.isArray(v.moods)?n(v):n({id:`${c.uid}_${x}`,userId:c.uid,date:x,moods:[]})}else n(null);a("saved")}catch(x){console.error("Error loading mood data:",x),o(x instanceof Error?x.message:"Error al cargar estado de nimo"),a("error")}};f.useEffect(()=>{u()},[c,t]);const d=async x=>{if(!c)return;a("saving"),o(null);const y=Ie(t),b=`${c.uid}_${y}`,v=ke(Bt(xe,"moods"),b),w=s;try{const N=new Date,S=jn(t,N.getHours(),N.getMinutes()),E={emoji:x.emoji,text:x.text,timestamp:S.timestamp,time:N.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}),value:im(x.text)},D=[...(s==null?void 0:s.moods)||[],E],T={id:b,userId:c.uid,date:y,moods:D};n(T),a("saved"),s?(Me.logWrite("moods","useMoodData.addMood.update",b),await Zt(v,T)):(Me.logWrite("moods","useMoodData.addMood.create",b),await Zt(v,T))}catch(N){n(w),console.error("Mood - Error al guardar:",N),o(N instanceof Error?N.message:"Error al guardar"),a("error")}},h=async(x,y)=>{if(!c||!s)return;a("saving"),o(null);const b=ke(Bt(xe,"moods"),s.id),v=s;try{const w=s.moods.map(S=>S.timestamp===x?y:S),N={...s,moods:w};n(N),a("saved"),Me.logWrite("moods","useMoodData.updateMood",s.id),await Zt(b,N)}catch(w){n(v),console.error("Mood - Error al actualizar:",w),o(w instanceof Error?w.message:"Error al actualizar"),a("error")}},p=async x=>{if(!c||!s)return;a("saving"),o(null);const y=ke(Bt(xe,"moods"),s.id),b=s;try{const v=s.moods.filter(w=>w.timestamp!==x);if(v.length===0)n(null),a("saved"),Me.logDelete("moods","useMoodData.deleteMood.deleteDoc",s.id),await Vo(y);else{const w={...s,moods:v};n(w),a("saved"),Me.logWrite("moods","useMoodData.deleteMood.update",s.id),await Zt(y,w)}}catch(v){n(b),console.error("Mood - Error al eliminar:",v),o(v instanceof Error?v.message:"Error al eliminar"),a("error")}},g=Ha("Mood data");return{moodHistory:(s==null?void 0:s.moods)||[],status:r,error:i,addMood:d,updateMood:h,deleteMood:p,loadMoodData:u,resync:g}},O4=({date:t,variant:s="compact"})=>{const n=Qt(),{moodHistory:r,status:a}=Qw(t),i=a==="saving"||a==="pending",o=r||[],c=o.length,u=o.length>0?Zw(o):0,d=o[o.length-1],h=p=>p>=8?"":p>=6?"":p>=4?"":p>=2?"":"";return e.jsx(Ir,{title:"Estado de nimo",icon:Om,variant:s,loading:i,onClick:()=>n("/mood"),children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:c>0?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:(d==null?void 0:d.emoji)||h(u)}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium",children:[u.toFixed(1),"/10"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[c," registro",c>1?"s":""]})]})]})}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:""}),e.jsx("p",{className:"text-sm text-gray-500",children:"Sin registros"})]})}),e.jsxs($,{size:"sm",variant:"outline",onClick:p=>{p.stopPropagation(),n("/mood")},className:"flex items-center gap-1",children:[e.jsx(cs,{className:"w-3 h-3"}),s==="detailed"&&"Registrar"]})]}),s==="detailed"&&d&&e.jsxs("div",{className:"text-xs text-gray-600 p-2 bg-gray-50 rounded",children:[e.jsx("p",{className:"font-medium",children:"ltimo registro:"}),e.jsxs("p",{children:['"',d.text,'" - ',d.time]})]})]})})},Fm=t=>{const{user:s}=Je(),[n,r]=f.useState({}),[a,i]=f.useState("idle"),[o,c]=f.useState(null),u=Ie(t),[d,h]=u.split("-"),p=`${d}-${h}`;return f.useEffect(()=>{if(!s)return;(async()=>{try{i("pending"),c(null);const y=ke(xe,"habits",`${s.uid}_${p}`);Me.logRead("habits","useHabitDataDaily.loadDayData",`${s.uid}_${p}`);const b=await ot(y);if(b.exists()){const v=b.data();r(v.habits||{}),i("saved")}else r({}),i("idle")}catch(y){console.error("Error loading daily habit data:",y),c(y instanceof Error?y.message:"Error loading habits"),i("error")}})()},[s,p]),{completedHabits:n,status:a,error:o,toggleHabit:async(x,y)=>{if(s){i("saving"),c(null);try{const[b,v]=y.split("-"),w=`${b}-${v}`,N=`${x}_${y}`,S=!n[N];r(k=>({...k,[N]:S}));const E=ke(xe,"habits",`${s.uid}_${w}`);await Zt(E,{habits:{...n,[N]:S},updatedAt:ht()},{merge:!0}),Me.logWrite("habits","useHabitDataDaily.toggleHabit",`${s.uid}_${w}`),i("saved")}catch(b){console.error("Error toggling habit:",b),c(b instanceof Error?b.message:"Error updating habit"),i("error");const v=`${x}_${y}`;r(w=>({...w,[v]:!w[v]}))}}}}},vn=[{id:1,name:"Tomar Agua (maana)",icon:"",timeOfDay:"morning",goal:"5 min",baseTime:"05:50",steps:["Llenar un vaso con agua","Beber lentamente"]},{id:2,name:"Ejercicio",icon:"",timeOfDay:"morning",goal:"40 min",baseTime:"07:00",steps:["Preparar el equipo","Hacer calentamiento","Realizar ejercicio principal","Hacer enfriamiento","Estirar msculos"]},{id:3,name:"Ducha fria",icon:"",timeOfDay:"morning",goal:"10 min",baseTime:"08:15",steps:["Preparar toalla","Graduar temperatura del agua","Entrar lentamente","Respirar profundamente","Secar completamente"]},{id:4,name:"Desayuno",icon:"",timeOfDay:"morning",goal:"30 min",baseTime:"08:30",steps:["Preparar ingredientes","Cocinar alimentos","Servir en plato","Comer sin distracciones","Lavar los platos"]},{id:5,name:"Lavarme los dientes",icon:"",timeOfDay:"morning",goal:"2 min",baseTime:"09:00",steps:["Preparar cepillo y pasta","Cepillar durante 2 minutos","Enjuagar boca","Limpiar cepillo"]},{id:6,name:"Seda Dental",icon:"",timeOfDay:"morning",goal:"2 min",baseTime:"09:05",steps:["Tomar hilo dental","Limpiar entre cada diente","Enjuagar boca","Guardar hilo dental"]},{id:7,name:"Tender la cama",icon:"",timeOfDay:"morning",goal:"3 min",baseTime:"09:10",steps:["Estirar sbanas","Acomodar almohadas","Doblar cobijas","Verificar que est ordenada"]},{id:20,name:"Lavar loza del desayuno",icon:"",timeOfDay:"morning",goal:"10 min",baseTime:"09:15",steps:["Fregar los platos","Enjuagar y secar"]},{id:22,name:"Aplicarme bloqueador solar",icon:"",timeOfDay:"morning",goal:"5 min",baseTime:"09:30",steps:["Aplicar bloqueador en cara","Aplicar bloqueador en cuello"]},{id:8,name:"Almuerzo",icon:"",timeOfDay:"afternoon",goal:"60 min",baseTime:"12:30",steps:["Planificar el men","Preparar ingredientes","Cocinar platos","Servir comida","Comer tranquilamente","Lavar platos"]},{id:9,name:"Siesta",icon:"",timeOfDay:"afternoon",goal:"15 min",baseTime:"13:00",steps:["Encontrar lugar cmodo","Cerrar ojos","Respirar profundamente","Relajarse completamente"]},{id:10,name:"Lavarme los dientes",icon:"",timeOfDay:"afternoon",goal:"2 min",baseTime:"13:15",steps:["Preparar cepillo y pasta","Cepillar durante 2 minutos","Enjuagar boca","Limpiar cepillo"]},{id:11,name:"Seda Dental",icon:"",timeOfDay:"afternoon",goal:"2 min",baseTime:"13:30",steps:["Tomar hilo dental","Limpiar entre cada diente","Enjuagar boca","Guardar hilo dental"]},{id:19,name:"Tomar agua (tarde)",icon:"",timeOfDay:"afternoon",goal:"5 min",baseTime:"15:00",steps:["Llenar un vaso con agua","Beber lentamente"]},{id:12,name:"Cena",icon:"",timeOfDay:"night",goal:"30 min",baseTime:"19:45",steps:["Elegir alimentos ligeros","Cocinar sin prisa","Cenar temprano","Lavar platos"]},{id:13,name:"Lavarme los dientes",icon:"",timeOfDay:"night",goal:"2 min",baseTime:"20:00",steps:["Preparar cepillo y pasta","Cepillar durante 2 minutos","Enjuagar boca","Limpiar cepillo"]},{id:14,name:"Seda Dental",icon:"",timeOfDay:"night",goal:"2 min",baseTime:"20:15",steps:["Tomar hilo dental","Limpiar entre cada diente","Enjuagar boca","Guardar hilo dental"]},{id:15,name:"Llevar el diario",icon:"",timeOfDay:"night",goal:"10 min",baseTime:"20:30",steps:["Abrir el diario","Reflexionar sobre el da","Escribir pensamientos","Cerrar y guardar"]},{id:16,name:"Botar algo que no sirva",icon:"",timeOfDay:"night",goal:"10 min",baseTime:"20:45",steps:["Buscar objetos innecesarios","Evaluar si sirven","Desechar responsablemente","Limpiar el rea"]},{id:17,name:"Organizar la cocina",icon:"",timeOfDay:"night",goal:"15 min",baseTime:"21:00",steps:["Lavar platos pendientes","Guardar utensilios","Limpiar superficies","Organizar despensa"]},{id:18,name:"Lectura",icon:"",timeOfDay:"night",goal:"5 min",baseTime:"21:15",steps:["Elegir libro","Encontrar lugar cmodo","Leer sin distracciones","Marcar pgina"]},{id:21,name:"Lista de pendientes",icon:"",timeOfDay:"night",goal:"15 min",baseTime:"21:30",steps:["Revisar tareas pendientes","Priorizar actividades","Anotar nuevas tareas"]},{id:23,name:"Alistar la ropa para maana",icon:"",timeOfDay:"night",goal:"5 min",baseTime:"21:45",steps:["Seleccionar ropa adecuada","Preparar accesorios"]}],eN={1:"bg-blue-500",2:"bg-green-500",3:"bg-yellow-500",4:"bg-orange-500",5:"bg-purple-500",6:"bg-pink-500",7:"bg-red-500",8:"bg-teal-500",9:"bg-indigo-500",10:"bg-gray-500",11:"bg-lime-500",12:"bg-amber-500",13:"bg-cyan-500",14:"bg-fuchsia-500",15:"bg-rose-500",16:"bg-violet-500",17:"bg-sky-500",18:"bg-emerald-500",19:"bg-indigo-500",20:"bg-yellow-600",21:"bg-pink-600",22:"bg-blue-600",23:"bg-green-600"},P4=({date:t,variant:s="compact"})=>{const n=Qt(),{completedHabits:r,status:a,toggleHabit:i}=Fm(t),o=a==="saving"||a==="pending",[c,u]=f.useState(!1),d=Ie(t),h=vn.length,p=Object.entries(r).filter(([v,w])=>v.endsWith(`_${d}`)&&w).length,g=h>0?p/h*100:0,y=vn.find(v=>{const w=`${v.id}_${d}`;return!r[w]}),b=async()=>{if(y&&!c){u(!0);try{await i(y.id,d)}catch(v){console.error("Error toggling habit:",v)}finally{u(!1)}}};return e.jsx(Ir,{title:"Hbitos",icon:aa,variant:s,loading:o,onClick:()=>n("/habit"),children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-lg font-bold text-green-600",children:[p,"/",h]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[g.toFixed(0),"% completado"]})]}),y&&e.jsxs("button",{onClick:v=>{v.stopPropagation(),b()},disabled:c,className:"flex items-center gap-1 text-xs px-2 py-1 bg-green-50 hover:bg-green-100 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[c?e.jsx(fs,{className:"w-3 h-3 animate-spin"}):e.jsx(ox,{className:"w-3 h-3"}),s==="detailed"?y.name:y.icon]})]}),s==="detailed"&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-300",style:{width:`${g}%`}})}),y&&e.jsxs("p",{className:"text-xs text-gray-600",children:["Siguiente: ",y.name]})]})]})})};/*! @license DOMPurify 3.2.6 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.6/LICENSE */const{entries:tN,setPrototypeOf:Ey,isFrozen:M4,getPrototypeOf:I4,getOwnPropertyDescriptor:L4}=Object;let{freeze:qn,seal:Or,create:sN}=Object,{apply:Cp,construct:Ep}=typeof Reflect<"u"&&Reflect;qn||(qn=function(s){return s});Or||(Or=function(s){return s});Cp||(Cp=function(s,n,r){return s.apply(n,r)});Ep||(Ep=function(s,n){return new s(...n)});const ku=Kn(Array.prototype.forEach),$4=Kn(Array.prototype.lastIndexOf),Ty=Kn(Array.prototype.pop),yc=Kn(Array.prototype.push),z4=Kn(Array.prototype.splice),Yu=Kn(String.prototype.toLowerCase),kf=Kn(String.prototype.toString),Dy=Kn(String.prototype.match),bc=Kn(String.prototype.replace),F4=Kn(String.prototype.indexOf),B4=Kn(String.prototype.trim),qr=Kn(Object.prototype.hasOwnProperty),Hn=Kn(RegExp.prototype.test),jc=H4(TypeError);function Kn(t){return function(s){s instanceof RegExp&&(s.lastIndex=0);for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return Cp(t,s,r)}}function H4(t){return function(){for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];return Ep(t,n)}}function Ct(t,s){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Yu;Ey&&Ey(t,null);let r=s.length;for(;r--;){let a=s[r];if(typeof a=="string"){const i=n(a);i!==a&&(M4(s)||(s[r]=i),a=i)}t[a]=!0}return t}function U4(t){for(let s=0;s<t.length;s++)qr(t,s)||(t[s]=null);return t}function ri(t){const s=sN(null);for(const[n,r]of tN(t))qr(t,n)&&(Array.isArray(r)?s[n]=U4(r):r&&typeof r=="object"&&r.constructor===Object?s[n]=ri(r):s[n]=r);return s}function wc(t,s){for(;t!==null;){const r=L4(t,s);if(r){if(r.get)return Kn(r.get);if(typeof r.value=="function")return Kn(r.value)}t=I4(t)}function n(){return null}return n}const ky=qn(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Af=qn(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),_f=qn(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),W4=qn(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Rf=qn(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Y4=qn(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Ay=qn(["#text"]),_y=qn(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Of=qn(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Ry=qn(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Au=qn(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),V4=Or(/\{\{[\w\W]*|[\w\W]*\}\}/gm),G4=Or(/<%[\w\W]*|[\w\W]*%>/gm),q4=Or(/\$\{[\w\W]*/gm),K4=Or(/^data-[\-\w.\u00B7-\uFFFF]+$/),J4=Or(/^aria-[\-\w]+$/),nN=Or(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),X4=Or(/^(?:\w+script|data):/i),Z4=Or(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),rN=Or(/^html$/i),Q4=Or(/^[a-z][.\w]*(-[.\w]+)+$/i);var Oy=Object.freeze({__proto__:null,ARIA_ATTR:J4,ATTR_WHITESPACE:Z4,CUSTOM_ELEMENT:Q4,DATA_ATTR:K4,DOCTYPE_NAME:rN,ERB_EXPR:G4,IS_ALLOWED_URI:nN,IS_SCRIPT_OR_DATA:X4,MUSTACHE_EXPR:V4,TMPLIT_EXPR:q4});const Nc={element:1,text:3,progressingInstruction:7,comment:8,document:9},e5=function(){return typeof window>"u"?null:window},t5=function(s,n){if(typeof s!="object"||typeof s.createPolicy!="function")return null;let r=null;const a="data-tt-policy-suffix";n&&n.hasAttribute(a)&&(r=n.getAttribute(a));const i="dompurify"+(r?"#"+r:"");try{return s.createPolicy(i,{createHTML(o){return o},createScriptURL(o){return o}})}catch{return console.warn("TrustedTypes policy "+i+" could not be created."),null}},Py=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function aN(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e5();const s=Ke=>aN(Ke);if(s.version="3.2.6",s.removed=[],!t||!t.document||t.document.nodeType!==Nc.document||!t.Element)return s.isSupported=!1,s;let{document:n}=t;const r=n,a=r.currentScript,{DocumentFragment:i,HTMLTemplateElement:o,Node:c,Element:u,NodeFilter:d,NamedNodeMap:h=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:p,DOMParser:g,trustedTypes:x}=t,y=u.prototype,b=wc(y,"cloneNode"),v=wc(y,"remove"),w=wc(y,"nextSibling"),N=wc(y,"childNodes"),S=wc(y,"parentNode");if(typeof o=="function"){const Ke=n.createElement("template");Ke.content&&Ke.content.ownerDocument&&(n=Ke.content.ownerDocument)}let E,k="";const{implementation:D,createNodeIterator:T,createDocumentFragment:R,getElementsByTagName:O}=n,{importNode:U}=r;let I=Py();s.isSupported=typeof tN=="function"&&typeof S=="function"&&D&&D.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:_,ERB_EXPR:M,TMPLIT_EXPR:W,DATA_ATTR:B,ARIA_ATTR:P,IS_SCRIPT_OR_DATA:z,ATTR_WHITESPACE:G,CUSTOM_ELEMENT:ae}=Oy;let{IS_ALLOWED_URI:Y}=Oy,X=null;const se=Ct({},[...ky,...Af,..._f,...Rf,...Ay]);let H=null;const ie=Ct({},[..._y,...Of,...Ry,...Au]);let fe=Object.seal(sN(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),le=null,K=null,de=!0,je=!0,ge=!1,Se=!0,oe=!1,J=!0,ye=!1,xt=!1,gt=!1,dt=!1,qs=!1,Ss=!1,q=!0,ne=!1;const me="user-content-";let Te=!0,Ee=!1,Ne={},Re=null;const qe=Ct({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let st=null;const es=Ct({},["audio","video","img","source","image","track"]);let Os=null;const qt=Ct({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),tn="http://www.w3.org/1998/Math/MathML",Ks="http://www.w3.org/2000/svg",ds="http://www.w3.org/1999/xhtml";let zs=ds,Ps=!1,$n=null;const Ve=Ct({},[tn,Ks,ds],kf);let ut=Ct({},["mi","mo","mn","ms","mtext"]),Nt=Ct({},["annotation-xml"]);const Ut=Ct({},["title","style","font","a","script"]);let Ge=null;const ft=["application/xhtml+xml","text/html"],Lt="text/html";let _e=null,Be=null;const Xe=n.createElement("form"),Rt=function(Q){return Q instanceof RegExp||Q instanceof Function},$t=function(){let Q=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Be&&Be===Q)){if((!Q||typeof Q!="object")&&(Q={}),Q=ri(Q),Ge=ft.indexOf(Q.PARSER_MEDIA_TYPE)===-1?Lt:Q.PARSER_MEDIA_TYPE,_e=Ge==="application/xhtml+xml"?kf:Yu,X=qr(Q,"ALLOWED_TAGS")?Ct({},Q.ALLOWED_TAGS,_e):se,H=qr(Q,"ALLOWED_ATTR")?Ct({},Q.ALLOWED_ATTR,_e):ie,$n=qr(Q,"ALLOWED_NAMESPACES")?Ct({},Q.ALLOWED_NAMESPACES,kf):Ve,Os=qr(Q,"ADD_URI_SAFE_ATTR")?Ct(ri(qt),Q.ADD_URI_SAFE_ATTR,_e):qt,st=qr(Q,"ADD_DATA_URI_TAGS")?Ct(ri(es),Q.ADD_DATA_URI_TAGS,_e):es,Re=qr(Q,"FORBID_CONTENTS")?Ct({},Q.FORBID_CONTENTS,_e):qe,le=qr(Q,"FORBID_TAGS")?Ct({},Q.FORBID_TAGS,_e):ri({}),K=qr(Q,"FORBID_ATTR")?Ct({},Q.FORBID_ATTR,_e):ri({}),Ne=qr(Q,"USE_PROFILES")?Q.USE_PROFILES:!1,de=Q.ALLOW_ARIA_ATTR!==!1,je=Q.ALLOW_DATA_ATTR!==!1,ge=Q.ALLOW_UNKNOWN_PROTOCOLS||!1,Se=Q.ALLOW_SELF_CLOSE_IN_ATTR!==!1,oe=Q.SAFE_FOR_TEMPLATES||!1,J=Q.SAFE_FOR_XML!==!1,ye=Q.WHOLE_DOCUMENT||!1,dt=Q.RETURN_DOM||!1,qs=Q.RETURN_DOM_FRAGMENT||!1,Ss=Q.RETURN_TRUSTED_TYPE||!1,gt=Q.FORCE_BODY||!1,q=Q.SANITIZE_DOM!==!1,ne=Q.SANITIZE_NAMED_PROPS||!1,Te=Q.KEEP_CONTENT!==!1,Ee=Q.IN_PLACE||!1,Y=Q.ALLOWED_URI_REGEXP||nN,zs=Q.NAMESPACE||ds,ut=Q.MATHML_TEXT_INTEGRATION_POINTS||ut,Nt=Q.HTML_INTEGRATION_POINTS||Nt,fe=Q.CUSTOM_ELEMENT_HANDLING||{},Q.CUSTOM_ELEMENT_HANDLING&&Rt(Q.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(fe.tagNameCheck=Q.CUSTOM_ELEMENT_HANDLING.tagNameCheck),Q.CUSTOM_ELEMENT_HANDLING&&Rt(Q.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(fe.attributeNameCheck=Q.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),Q.CUSTOM_ELEMENT_HANDLING&&typeof Q.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(fe.allowCustomizedBuiltInElements=Q.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),oe&&(je=!1),qs&&(dt=!0),Ne&&(X=Ct({},Ay),H=[],Ne.html===!0&&(Ct(X,ky),Ct(H,_y)),Ne.svg===!0&&(Ct(X,Af),Ct(H,Of),Ct(H,Au)),Ne.svgFilters===!0&&(Ct(X,_f),Ct(H,Of),Ct(H,Au)),Ne.mathMl===!0&&(Ct(X,Rf),Ct(H,Ry),Ct(H,Au))),Q.ADD_TAGS&&(X===se&&(X=ri(X)),Ct(X,Q.ADD_TAGS,_e)),Q.ADD_ATTR&&(H===ie&&(H=ri(H)),Ct(H,Q.ADD_ATTR,_e)),Q.ADD_URI_SAFE_ATTR&&Ct(Os,Q.ADD_URI_SAFE_ATTR,_e),Q.FORBID_CONTENTS&&(Re===qe&&(Re=ri(Re)),Ct(Re,Q.FORBID_CONTENTS,_e)),Te&&(X["#text"]=!0),ye&&Ct(X,["html","head","body"]),X.table&&(Ct(X,["tbody"]),delete le.tbody),Q.TRUSTED_TYPES_POLICY){if(typeof Q.TRUSTED_TYPES_POLICY.createHTML!="function")throw jc('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof Q.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw jc('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');E=Q.TRUSTED_TYPES_POLICY,k=E.createHTML("")}else E===void 0&&(E=t5(x,a)),E!==null&&typeof k=="string"&&(k=E.createHTML(""));qn&&qn(Q),Be=Q}},Ot=Ct({},[...Af,..._f,...W4]),xs=Ct({},[...Rf,...Y4]),gs=function(Q){let De=S(Q);(!De||!De.tagName)&&(De={namespaceURI:zs,tagName:"template"});const He=Yu(Q.tagName),as=Yu(De.tagName);return $n[Q.namespaceURI]?Q.namespaceURI===Ks?De.namespaceURI===ds?He==="svg":De.namespaceURI===tn?He==="svg"&&(as==="annotation-xml"||ut[as]):!!Ot[He]:Q.namespaceURI===tn?De.namespaceURI===ds?He==="math":De.namespaceURI===Ks?He==="math"&&Nt[as]:!!xs[He]:Q.namespaceURI===ds?De.namespaceURI===Ks&&!Nt[as]||De.namespaceURI===tn&&!ut[as]?!1:!xs[He]&&(Ut[He]||!Ot[He]):!!(Ge==="application/xhtml+xml"&&$n[Q.namespaceURI]):!1},Wt=function(Q){yc(s.removed,{element:Q});try{S(Q).removeChild(Q)}catch{v(Q)}},Jn=function(Q,De){try{yc(s.removed,{attribute:De.getAttributeNode(Q),from:De})}catch{yc(s.removed,{attribute:null,from:De})}if(De.removeAttribute(Q),Q==="is")if(dt||qs)try{Wt(De)}catch{}else try{De.setAttribute(Q,"")}catch{}},wa=function(Q){let De=null,He=null;if(gt)Q="<remove></remove>"+Q;else{const Cs=Dy(Q,/^[\r\n\t ]+/);He=Cs&&Cs[0]}Ge==="application/xhtml+xml"&&zs===ds&&(Q='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+Q+"</body></html>");const as=E?E.createHTML(Q):Q;if(zs===ds)try{De=new g().parseFromString(as,Ge)}catch{}if(!De||!De.documentElement){De=D.createDocument(zs,"template",null);try{De.documentElement.innerHTML=Ps?k:as}catch{}}const dn=De.body||De.documentElement;return Q&&He&&dn.insertBefore(n.createTextNode(He),dn.childNodes[0]||null),zs===ds?O.call(De,ye?"html":"body")[0]:ye?De.documentElement:dn},dr=function(Q){return T.call(Q.ownerDocument||Q,Q,d.SHOW_ELEMENT|d.SHOW_COMMENT|d.SHOW_TEXT|d.SHOW_PROCESSING_INSTRUCTION|d.SHOW_CDATA_SECTION,null)},Fr=function(Q){return Q instanceof p&&(typeof Q.nodeName!="string"||typeof Q.textContent!="string"||typeof Q.removeChild!="function"||!(Q.attributes instanceof h)||typeof Q.removeAttribute!="function"||typeof Q.setAttribute!="function"||typeof Q.namespaceURI!="string"||typeof Q.insertBefore!="function"||typeof Q.hasChildNodes!="function")},bi=function(Q){return typeof c=="function"&&Q instanceof c};function Br(Ke,Q,De){ku(Ke,He=>{He.call(s,Q,De,Be)})}const Md=function(Q){let De=null;if(Br(I.beforeSanitizeElements,Q,null),Fr(Q))return Wt(Q),!0;const He=_e(Q.nodeName);if(Br(I.uponSanitizeElement,Q,{tagName:He,allowedTags:X}),J&&Q.hasChildNodes()&&!bi(Q.firstElementChild)&&Hn(/<[/\w!]/g,Q.innerHTML)&&Hn(/<[/\w!]/g,Q.textContent)||Q.nodeType===Nc.progressingInstruction||J&&Q.nodeType===Nc.comment&&Hn(/<[/\w]/g,Q.data))return Wt(Q),!0;if(!X[He]||le[He]){if(!le[He]&&Xl(He)&&(fe.tagNameCheck instanceof RegExp&&Hn(fe.tagNameCheck,He)||fe.tagNameCheck instanceof Function&&fe.tagNameCheck(He)))return!1;if(Te&&!Re[He]){const as=S(Q)||Q.parentNode,dn=N(Q)||Q.childNodes;if(dn&&as){const Cs=dn.length;for(let En=Cs-1;En>=0;--En){const Hr=b(dn[En],!0);Hr.__removalCount=(Q.__removalCount||0)+1,as.insertBefore(Hr,w(Q))}}}return Wt(Q),!0}return Q instanceof u&&!gs(Q)||(He==="noscript"||He==="noembed"||He==="noframes")&&Hn(/<\/no(script|embed|frames)/i,Q.innerHTML)?(Wt(Q),!0):(oe&&Q.nodeType===Nc.text&&(De=Q.textContent,ku([_,M,W],as=>{De=bc(De,as," ")}),Q.textContent!==De&&(yc(s.removed,{element:Q.cloneNode()}),Q.textContent=De)),Br(I.afterSanitizeElements,Q,null),!1)},Id=function(Q,De,He){if(q&&(De==="id"||De==="name")&&(He in n||He in Xe))return!1;if(!(je&&!K[De]&&Hn(B,De))){if(!(de&&Hn(P,De))){if(!H[De]||K[De]){if(!(Xl(Q)&&(fe.tagNameCheck instanceof RegExp&&Hn(fe.tagNameCheck,Q)||fe.tagNameCheck instanceof Function&&fe.tagNameCheck(Q))&&(fe.attributeNameCheck instanceof RegExp&&Hn(fe.attributeNameCheck,De)||fe.attributeNameCheck instanceof Function&&fe.attributeNameCheck(De))||De==="is"&&fe.allowCustomizedBuiltInElements&&(fe.tagNameCheck instanceof RegExp&&Hn(fe.tagNameCheck,He)||fe.tagNameCheck instanceof Function&&fe.tagNameCheck(He))))return!1}else if(!Os[De]){if(!Hn(Y,bc(He,G,""))){if(!((De==="src"||De==="xlink:href"||De==="href")&&Q!=="script"&&F4(He,"data:")===0&&st[Q])){if(!(ge&&!Hn(z,bc(He,G,"")))){if(He)return!1}}}}}}return!0},Xl=function(Q){return Q!=="annotation-xml"&&Dy(Q,ae)},Ld=function(Q){Br(I.beforeSanitizeAttributes,Q,null);const{attributes:De}=Q;if(!De||Fr(Q))return;const He={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:H,forceKeepAttr:void 0};let as=De.length;for(;as--;){const dn=De[as],{name:Cs,namespaceURI:En,value:Hr}=dn,go=_e(Cs),Xo=Hr;let sn=Cs==="value"?Xo:B4(Xo);if(He.attrName=go,He.attrValue=sn,He.keepAttr=!0,He.forceKeepAttr=void 0,Br(I.uponSanitizeAttribute,Q,He),sn=He.attrValue,ne&&(go==="id"||go==="name")&&(Jn(Cs,Q),sn=me+sn),J&&Hn(/((--!?|])>)|<\/(style|title)/i,sn)){Jn(Cs,Q);continue}if(He.forceKeepAttr)continue;if(!He.keepAttr){Jn(Cs,Q);continue}if(!Se&&Hn(/\/>/i,sn)){Jn(Cs,Q);continue}oe&&ku([_,M,W],$d=>{sn=bc(sn,$d," ")});const Zl=_e(Q.nodeName);if(!Id(Zl,go,sn)){Jn(Cs,Q);continue}if(E&&typeof x=="object"&&typeof x.getAttributeType=="function"&&!En)switch(x.getAttributeType(Zl,go)){case"TrustedHTML":{sn=E.createHTML(sn);break}case"TrustedScriptURL":{sn=E.createScriptURL(sn);break}}if(sn!==Xo)try{En?Q.setAttributeNS(En,Cs,sn):Q.setAttribute(Cs,sn),Fr(Q)?Wt(Q):Ty(s.removed)}catch{Jn(Cs,Q)}}Br(I.afterSanitizeAttributes,Q,null)},uh=function Ke(Q){let De=null;const He=dr(Q);for(Br(I.beforeSanitizeShadowDOM,Q,null);De=He.nextNode();)Br(I.uponSanitizeShadowNode,De,null),Md(De),Ld(De),De.content instanceof i&&Ke(De.content);Br(I.afterSanitizeShadowDOM,Q,null)};return s.sanitize=function(Ke){let Q=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},De=null,He=null,as=null,dn=null;if(Ps=!Ke,Ps&&(Ke="<!-->"),typeof Ke!="string"&&!bi(Ke))if(typeof Ke.toString=="function"){if(Ke=Ke.toString(),typeof Ke!="string")throw jc("dirty is not a string, aborting")}else throw jc("toString is not a function");if(!s.isSupported)return Ke;if(xt||$t(Q),s.removed=[],typeof Ke=="string"&&(Ee=!1),Ee){if(Ke.nodeName){const Hr=_e(Ke.nodeName);if(!X[Hr]||le[Hr])throw jc("root node is forbidden and cannot be sanitized in-place")}}else if(Ke instanceof c)De=wa("<!---->"),He=De.ownerDocument.importNode(Ke,!0),He.nodeType===Nc.element&&He.nodeName==="BODY"||He.nodeName==="HTML"?De=He:De.appendChild(He);else{if(!dt&&!oe&&!ye&&Ke.indexOf("<")===-1)return E&&Ss?E.createHTML(Ke):Ke;if(De=wa(Ke),!De)return dt?null:Ss?k:""}De&&gt&&Wt(De.firstChild);const Cs=dr(Ee?Ke:De);for(;as=Cs.nextNode();)Md(as),Ld(as),as.content instanceof i&&uh(as.content);if(Ee)return Ke;if(dt){if(qs)for(dn=R.call(De.ownerDocument);De.firstChild;)dn.appendChild(De.firstChild);else dn=De;return(H.shadowroot||H.shadowrootmode)&&(dn=U.call(r,dn,!0)),dn}let En=ye?De.outerHTML:De.innerHTML;return ye&&X["!doctype"]&&De.ownerDocument&&De.ownerDocument.doctype&&De.ownerDocument.doctype.name&&Hn(rN,De.ownerDocument.doctype.name)&&(En="<!DOCTYPE "+De.ownerDocument.doctype.name+`>
`+En),oe&&ku([_,M,W],Hr=>{En=bc(En,Hr," ")}),E&&Ss?E.createHTML(En):En},s.setConfig=function(){let Ke=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};$t(Ke),xt=!0},s.clearConfig=function(){Be=null,xt=!1},s.isValidAttribute=function(Ke,Q,De){Be||$t({});const He=_e(Ke),as=_e(Q);return Id(He,as,De)},s.addHook=function(Ke,Q){typeof Q=="function"&&yc(I[Ke],Q)},s.removeHook=function(Ke,Q){if(Q!==void 0){const De=$4(I[Ke],Q);return De===-1?void 0:z4(I[Ke],De,1)[0]}return Ty(I[Ke])},s.removeHooks=function(Ke){I[Ke]=[]},s.removeAllHooks=function(){I=Py()},s}var xi=aN();function yx(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var Go=yx();function iN(t){Go=t}var zc={exec:()=>null};function rs(t,s=""){let n=typeof t=="string"?t:t.source;const r={replace:(a,i)=>{let o=typeof i=="string"?i:i.source;return o=o.replace(Vn.caret,"$1"),n=n.replace(a,o),r},getRegex:()=>new RegExp(n,s)};return r}var Vn={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:t=>new RegExp(`^( {0,3}${t})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}#`),htmlBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}<(?:[a-z].*>|!--)`,"i")},s5=/^(?:[ \t]*(?:\n|$))+/,n5=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,r5=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,yd=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,a5=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,bx=/(?:[*+-]|\d{1,9}[.)])/,oN=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,lN=rs(oN).replace(/bull/g,bx).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),i5=rs(oN).replace(/bull/g,bx).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),jx=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,o5=/^[^\n]+/,wx=/(?!\s*\])(?:\\.|[^\[\]\\])+/,l5=rs(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",wx).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),c5=rs(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,bx).getRegex(),Bm="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Nx=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,d5=rs("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",Nx).replace("tag",Bm).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),cN=rs(jx).replace("hr",yd).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Bm).getRegex(),u5=rs(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",cN).getRegex(),Sx={blockquote:u5,code:n5,def:l5,fences:r5,heading:a5,hr:yd,html:d5,lheading:lN,list:c5,newline:s5,paragraph:cN,table:zc,text:o5},My=rs("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",yd).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Bm).getRegex(),m5={...Sx,lheading:i5,table:My,paragraph:rs(jx).replace("hr",yd).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",My).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Bm).getRegex()},h5={...Sx,html:rs(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Nx).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:zc,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:rs(jx).replace("hr",yd).replace("heading",` *#{1,6} *[^
]`).replace("lheading",lN).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},f5=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,p5=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,dN=/^( {2,}|\\)\n(?!\s*$)/,x5=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Hm=/[\p{P}\p{S}]/u,Cx=/[\s\p{P}\p{S}]/u,uN=/[^\s\p{P}\p{S}]/u,g5=rs(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,Cx).getRegex(),mN=/(?!~)[\p{P}\p{S}]/u,v5=/(?!~)[\s\p{P}\p{S}]/u,y5=/(?:[^\s\p{P}\p{S}]|~)/u,b5=/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,hN=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,j5=rs(hN,"u").replace(/punct/g,Hm).getRegex(),w5=rs(hN,"u").replace(/punct/g,mN).getRegex(),fN="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",N5=rs(fN,"gu").replace(/notPunctSpace/g,uN).replace(/punctSpace/g,Cx).replace(/punct/g,Hm).getRegex(),S5=rs(fN,"gu").replace(/notPunctSpace/g,y5).replace(/punctSpace/g,v5).replace(/punct/g,mN).getRegex(),C5=rs("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,uN).replace(/punctSpace/g,Cx).replace(/punct/g,Hm).getRegex(),E5=rs(/\\(punct)/,"gu").replace(/punct/g,Hm).getRegex(),T5=rs(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),D5=rs(Nx).replace("(?:-->|$)","-->").getRegex(),k5=rs("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",D5).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),om=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,A5=rs(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",om).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),pN=rs(/^!?\[(label)\]\[(ref)\]/).replace("label",om).replace("ref",wx).getRegex(),xN=rs(/^!?\[(ref)\](?:\[\])?/).replace("ref",wx).getRegex(),_5=rs("reflink|nolink(?!\\()","g").replace("reflink",pN).replace("nolink",xN).getRegex(),Ex={_backpedal:zc,anyPunctuation:E5,autolink:T5,blockSkip:b5,br:dN,code:p5,del:zc,emStrongLDelim:j5,emStrongRDelimAst:N5,emStrongRDelimUnd:C5,escape:f5,link:A5,nolink:xN,punctuation:g5,reflink:pN,reflinkSearch:_5,tag:k5,text:x5,url:zc},R5={...Ex,link:rs(/^!?\[(label)\]\((.*?)\)/).replace("label",om).getRegex(),reflink:rs(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",om).getRegex()},Tp={...Ex,emStrongRDelimAst:S5,emStrongLDelim:w5,url:rs(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},O5={...Tp,br:rs(dN).replace("{2,}","*").getRegex(),text:rs(Tp.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},_u={normal:Sx,gfm:m5,pedantic:h5},Sc={normal:Ex,gfm:Tp,breaks:O5,pedantic:R5},P5={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Iy=t=>P5[t];function Ta(t,s){if(s){if(Vn.escapeTest.test(t))return t.replace(Vn.escapeReplace,Iy)}else if(Vn.escapeTestNoEncode.test(t))return t.replace(Vn.escapeReplaceNoEncode,Iy);return t}function Ly(t){try{t=encodeURI(t).replace(Vn.percentDecode,"%")}catch{return null}return t}function $y(t,s){var i;const n=t.replace(Vn.findPipe,(o,c,u)=>{let d=!1,h=c;for(;--h>=0&&u[h]==="\\";)d=!d;return d?"|":" |"}),r=n.split(Vn.splitPipe);let a=0;if(r[0].trim()||r.shift(),r.length>0&&!((i=r.at(-1))!=null&&i.trim())&&r.pop(),s)if(r.length>s)r.splice(s);else for(;r.length<s;)r.push("");for(;a<r.length;a++)r[a]=r[a].trim().replace(Vn.slashPipe,"|");return r}function Cc(t,s,n){const r=t.length;if(r===0)return"";let a=0;for(;a<r&&t.charAt(r-a-1)===s;)a++;return t.slice(0,r-a)}function M5(t,s){if(t.indexOf(s[1])===-1)return-1;let n=0;for(let r=0;r<t.length;r++)if(t[r]==="\\")r++;else if(t[r]===s[0])n++;else if(t[r]===s[1]&&(n--,n<0))return r;return n>0?-2:-1}function zy(t,s,n,r,a){const i=s.href,o=s.title||null,c=t[1].replace(a.other.outputLinkReplace,"$1");r.state.inLink=!0;const u={type:t[0].charAt(0)==="!"?"image":"link",raw:n,href:i,title:o,text:c,tokens:r.inlineTokens(c)};return r.state.inLink=!1,u}function I5(t,s,n){const r=t.match(n.other.indentCodeCompensation);if(r===null)return s;const a=r[1];return s.split(`
`).map(i=>{const o=i.match(n.other.beginningSpace);if(o===null)return i;const[c]=o;return c.length>=a.length?i.slice(a.length):i}).join(`
`)}var lm=class{constructor(t){he(this,"options");he(this,"rules");he(this,"lexer");this.options=t||Go}space(t){const s=this.rules.block.newline.exec(t);if(s&&s[0].length>0)return{type:"space",raw:s[0]}}code(t){const s=this.rules.block.code.exec(t);if(s){const n=s[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:s[0],codeBlockStyle:"indented",text:this.options.pedantic?n:Cc(n,`
`)}}}fences(t){const s=this.rules.block.fences.exec(t);if(s){const n=s[0],r=I5(n,s[3]||"",this.rules);return{type:"code",raw:n,lang:s[2]?s[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):s[2],text:r}}}heading(t){const s=this.rules.block.heading.exec(t);if(s){let n=s[2].trim();if(this.rules.other.endingHash.test(n)){const r=Cc(n,"#");(this.options.pedantic||!r||this.rules.other.endingSpaceChar.test(r))&&(n=r.trim())}return{type:"heading",raw:s[0],depth:s[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(t){const s=this.rules.block.hr.exec(t);if(s)return{type:"hr",raw:Cc(s[0],`
`)}}blockquote(t){const s=this.rules.block.blockquote.exec(t);if(s){let n=Cc(s[0],`
`).split(`
`),r="",a="";const i=[];for(;n.length>0;){let o=!1;const c=[];let u;for(u=0;u<n.length;u++)if(this.rules.other.blockquoteStart.test(n[u]))c.push(n[u]),o=!0;else if(!o)c.push(n[u]);else break;n=n.slice(u);const d=c.join(`
`),h=d.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");r=r?`${r}
${d}`:d,a=a?`${a}
${h}`:h;const p=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(h,i,!0),this.lexer.state.top=p,n.length===0)break;const g=i.at(-1);if((g==null?void 0:g.type)==="code")break;if((g==null?void 0:g.type)==="blockquote"){const x=g,y=x.raw+`
`+n.join(`
`),b=this.blockquote(y);i[i.length-1]=b,r=r.substring(0,r.length-x.raw.length)+b.raw,a=a.substring(0,a.length-x.text.length)+b.text;break}else if((g==null?void 0:g.type)==="list"){const x=g,y=x.raw+`
`+n.join(`
`),b=this.list(y);i[i.length-1]=b,r=r.substring(0,r.length-g.raw.length)+b.raw,a=a.substring(0,a.length-x.raw.length)+b.raw,n=y.substring(i.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:r,tokens:i,text:a}}}list(t){let s=this.rules.block.list.exec(t);if(s){let n=s[1].trim();const r=n.length>1,a={type:"list",raw:"",ordered:r,start:r?+n.slice(0,-1):"",loose:!1,items:[]};n=r?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=r?n:"[*+-]");const i=this.rules.other.listItemRegex(n);let o=!1;for(;t;){let u=!1,d="",h="";if(!(s=i.exec(t))||this.rules.block.hr.test(t))break;d=s[0],t=t.substring(d.length);let p=s[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,w=>" ".repeat(3*w.length)),g=t.split(`
`,1)[0],x=!p.trim(),y=0;if(this.options.pedantic?(y=2,h=p.trimStart()):x?y=s[1].length+1:(y=s[2].search(this.rules.other.nonSpaceChar),y=y>4?1:y,h=p.slice(y),y+=s[1].length),x&&this.rules.other.blankLine.test(g)&&(d+=g+`
`,t=t.substring(g.length+1),u=!0),!u){const w=this.rules.other.nextBulletRegex(y),N=this.rules.other.hrRegex(y),S=this.rules.other.fencesBeginRegex(y),E=this.rules.other.headingBeginRegex(y),k=this.rules.other.htmlBeginRegex(y);for(;t;){const D=t.split(`
`,1)[0];let T;if(g=D,this.options.pedantic?(g=g.replace(this.rules.other.listReplaceNesting,"  "),T=g):T=g.replace(this.rules.other.tabCharGlobal,"    "),S.test(g)||E.test(g)||k.test(g)||w.test(g)||N.test(g))break;if(T.search(this.rules.other.nonSpaceChar)>=y||!g.trim())h+=`
`+T.slice(y);else{if(x||p.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||S.test(p)||E.test(p)||N.test(p))break;h+=`
`+g}!x&&!g.trim()&&(x=!0),d+=D+`
`,t=t.substring(D.length+1),p=T.slice(y)}}a.loose||(o?a.loose=!0:this.rules.other.doubleBlankLine.test(d)&&(o=!0));let b=null,v;this.options.gfm&&(b=this.rules.other.listIsTask.exec(h),b&&(v=b[0]!=="[ ] ",h=h.replace(this.rules.other.listReplaceTask,""))),a.items.push({type:"list_item",raw:d,task:!!b,checked:v,loose:!1,text:h,tokens:[]}),a.raw+=d}const c=a.items.at(-1);if(c)c.raw=c.raw.trimEnd(),c.text=c.text.trimEnd();else return;a.raw=a.raw.trimEnd();for(let u=0;u<a.items.length;u++)if(this.lexer.state.top=!1,a.items[u].tokens=this.lexer.blockTokens(a.items[u].text,[]),!a.loose){const d=a.items[u].tokens.filter(p=>p.type==="space"),h=d.length>0&&d.some(p=>this.rules.other.anyLine.test(p.raw));a.loose=h}if(a.loose)for(let u=0;u<a.items.length;u++)a.items[u].loose=!0;return a}}html(t){const s=this.rules.block.html.exec(t);if(s)return{type:"html",block:!0,raw:s[0],pre:s[1]==="pre"||s[1]==="script"||s[1]==="style",text:s[0]}}def(t){const s=this.rules.block.def.exec(t);if(s){const n=s[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),r=s[2]?s[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",a=s[3]?s[3].substring(1,s[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):s[3];return{type:"def",tag:n,raw:s[0],href:r,title:a}}}table(t){var o;const s=this.rules.block.table.exec(t);if(!s||!this.rules.other.tableDelimiter.test(s[2]))return;const n=$y(s[1]),r=s[2].replace(this.rules.other.tableAlignChars,"").split("|"),a=(o=s[3])!=null&&o.trim()?s[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],i={type:"table",raw:s[0],header:[],align:[],rows:[]};if(n.length===r.length){for(const c of r)this.rules.other.tableAlignRight.test(c)?i.align.push("right"):this.rules.other.tableAlignCenter.test(c)?i.align.push("center"):this.rules.other.tableAlignLeft.test(c)?i.align.push("left"):i.align.push(null);for(let c=0;c<n.length;c++)i.header.push({text:n[c],tokens:this.lexer.inline(n[c]),header:!0,align:i.align[c]});for(const c of a)i.rows.push($y(c,i.header.length).map((u,d)=>({text:u,tokens:this.lexer.inline(u),header:!1,align:i.align[d]})));return i}}lheading(t){const s=this.rules.block.lheading.exec(t);if(s)return{type:"heading",raw:s[0],depth:s[2].charAt(0)==="="?1:2,text:s[1],tokens:this.lexer.inline(s[1])}}paragraph(t){const s=this.rules.block.paragraph.exec(t);if(s){const n=s[1].charAt(s[1].length-1)===`
`?s[1].slice(0,-1):s[1];return{type:"paragraph",raw:s[0],text:n,tokens:this.lexer.inline(n)}}}text(t){const s=this.rules.block.text.exec(t);if(s)return{type:"text",raw:s[0],text:s[0],tokens:this.lexer.inline(s[0])}}escape(t){const s=this.rules.inline.escape.exec(t);if(s)return{type:"escape",raw:s[0],text:s[1]}}tag(t){const s=this.rules.inline.tag.exec(t);if(s)return!this.lexer.state.inLink&&this.rules.other.startATag.test(s[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(s[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(s[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(s[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:s[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:s[0]}}link(t){const s=this.rules.inline.link.exec(t);if(s){const n=s[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;const i=Cc(n.slice(0,-1),"\\");if((n.length-i.length)%2===0)return}else{const i=M5(s[2],"()");if(i===-2)return;if(i>-1){const c=(s[0].indexOf("!")===0?5:4)+s[1].length+i;s[2]=s[2].substring(0,i),s[0]=s[0].substring(0,c).trim(),s[3]=""}}let r=s[2],a="";if(this.options.pedantic){const i=this.rules.other.pedanticHrefTitle.exec(r);i&&(r=i[1],a=i[3])}else a=s[3]?s[3].slice(1,-1):"";return r=r.trim(),this.rules.other.startAngleBracket.test(r)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?r=r.slice(1):r=r.slice(1,-1)),zy(s,{href:r&&r.replace(this.rules.inline.anyPunctuation,"$1"),title:a&&a.replace(this.rules.inline.anyPunctuation,"$1")},s[0],this.lexer,this.rules)}}reflink(t,s){let n;if((n=this.rules.inline.reflink.exec(t))||(n=this.rules.inline.nolink.exec(t))){const r=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),a=s[r.toLowerCase()];if(!a){const i=n[0].charAt(0);return{type:"text",raw:i,text:i}}return zy(n,a,n[0],this.lexer,this.rules)}}emStrong(t,s,n=""){let r=this.rules.inline.emStrongLDelim.exec(t);if(!r||r[3]&&n.match(this.rules.other.unicodeAlphaNumeric))return;if(!(r[1]||r[2]||"")||!n||this.rules.inline.punctuation.exec(n)){const i=[...r[0]].length-1;let o,c,u=i,d=0;const h=r[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(h.lastIndex=0,s=s.slice(-1*t.length+i);(r=h.exec(s))!=null;){if(o=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!o)continue;if(c=[...o].length,r[3]||r[4]){u+=c;continue}else if((r[5]||r[6])&&i%3&&!((i+c)%3)){d+=c;continue}if(u-=c,u>0)continue;c=Math.min(c,c+u+d);const p=[...r[0]][0].length,g=t.slice(0,i+r.index+p+c);if(Math.min(i,c)%2){const y=g.slice(1,-1);return{type:"em",raw:g,text:y,tokens:this.lexer.inlineTokens(y)}}const x=g.slice(2,-2);return{type:"strong",raw:g,text:x,tokens:this.lexer.inlineTokens(x)}}}}codespan(t){const s=this.rules.inline.code.exec(t);if(s){let n=s[2].replace(this.rules.other.newLineCharGlobal," ");const r=this.rules.other.nonSpaceChar.test(n),a=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return r&&a&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:s[0],text:n}}}br(t){const s=this.rules.inline.br.exec(t);if(s)return{type:"br",raw:s[0]}}del(t){const s=this.rules.inline.del.exec(t);if(s)return{type:"del",raw:s[0],text:s[2],tokens:this.lexer.inlineTokens(s[2])}}autolink(t){const s=this.rules.inline.autolink.exec(t);if(s){let n,r;return s[2]==="@"?(n=s[1],r="mailto:"+n):(n=s[1],r=n),{type:"link",raw:s[0],text:n,href:r,tokens:[{type:"text",raw:n,text:n}]}}}url(t){var n;let s;if(s=this.rules.inline.url.exec(t)){let r,a;if(s[2]==="@")r=s[0],a="mailto:"+r;else{let i;do i=s[0],s[0]=((n=this.rules.inline._backpedal.exec(s[0]))==null?void 0:n[0])??"";while(i!==s[0]);r=s[0],s[1]==="www."?a="http://"+s[0]:a=s[0]}return{type:"link",raw:s[0],text:r,href:a,tokens:[{type:"text",raw:r,text:r}]}}}inlineText(t){const s=this.rules.inline.text.exec(t);if(s){const n=this.lexer.state.inRawBlock;return{type:"text",raw:s[0],text:s[0],escaped:n}}}},ui=class Dp{constructor(s){he(this,"tokens");he(this,"options");he(this,"state");he(this,"tokenizer");he(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=s||Go,this.options.tokenizer=this.options.tokenizer||new lm,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const n={other:Vn,block:_u.normal,inline:Sc.normal};this.options.pedantic?(n.block=_u.pedantic,n.inline=Sc.pedantic):this.options.gfm&&(n.block=_u.gfm,this.options.breaks?n.inline=Sc.breaks:n.inline=Sc.gfm),this.tokenizer.rules=n}static get rules(){return{block:_u,inline:Sc}}static lex(s,n){return new Dp(n).lex(s)}static lexInline(s,n){return new Dp(n).inlineTokens(s)}lex(s){s=s.replace(Vn.carriageReturn,`
`),this.blockTokens(s,this.tokens);for(let n=0;n<this.inlineQueue.length;n++){const r=this.inlineQueue[n];this.inlineTokens(r.src,r.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(s,n=[],r=!1){var a,i,o;for(this.options.pedantic&&(s=s.replace(Vn.tabCharGlobal,"    ").replace(Vn.spaceLine,""));s;){let c;if((i=(a=this.options.extensions)==null?void 0:a.block)!=null&&i.some(d=>(c=d.call({lexer:this},s,n))?(s=s.substring(c.raw.length),n.push(c),!0):!1))continue;if(c=this.tokenizer.space(s)){s=s.substring(c.raw.length);const d=n.at(-1);c.raw.length===1&&d!==void 0?d.raw+=`
`:n.push(c);continue}if(c=this.tokenizer.code(s)){s=s.substring(c.raw.length);const d=n.at(-1);(d==null?void 0:d.type)==="paragraph"||(d==null?void 0:d.type)==="text"?(d.raw+=`
`+c.raw,d.text+=`
`+c.text,this.inlineQueue.at(-1).src=d.text):n.push(c);continue}if(c=this.tokenizer.fences(s)){s=s.substring(c.raw.length),n.push(c);continue}if(c=this.tokenizer.heading(s)){s=s.substring(c.raw.length),n.push(c);continue}if(c=this.tokenizer.hr(s)){s=s.substring(c.raw.length),n.push(c);continue}if(c=this.tokenizer.blockquote(s)){s=s.substring(c.raw.length),n.push(c);continue}if(c=this.tokenizer.list(s)){s=s.substring(c.raw.length),n.push(c);continue}if(c=this.tokenizer.html(s)){s=s.substring(c.raw.length),n.push(c);continue}if(c=this.tokenizer.def(s)){s=s.substring(c.raw.length);const d=n.at(-1);(d==null?void 0:d.type)==="paragraph"||(d==null?void 0:d.type)==="text"?(d.raw+=`
`+c.raw,d.text+=`
`+c.raw,this.inlineQueue.at(-1).src=d.text):this.tokens.links[c.tag]||(this.tokens.links[c.tag]={href:c.href,title:c.title});continue}if(c=this.tokenizer.table(s)){s=s.substring(c.raw.length),n.push(c);continue}if(c=this.tokenizer.lheading(s)){s=s.substring(c.raw.length),n.push(c);continue}let u=s;if((o=this.options.extensions)!=null&&o.startBlock){let d=1/0;const h=s.slice(1);let p;this.options.extensions.startBlock.forEach(g=>{p=g.call({lexer:this},h),typeof p=="number"&&p>=0&&(d=Math.min(d,p))}),d<1/0&&d>=0&&(u=s.substring(0,d+1))}if(this.state.top&&(c=this.tokenizer.paragraph(u))){const d=n.at(-1);r&&(d==null?void 0:d.type)==="paragraph"?(d.raw+=`
`+c.raw,d.text+=`
`+c.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=d.text):n.push(c),r=u.length!==s.length,s=s.substring(c.raw.length);continue}if(c=this.tokenizer.text(s)){s=s.substring(c.raw.length);const d=n.at(-1);(d==null?void 0:d.type)==="text"?(d.raw+=`
`+c.raw,d.text+=`
`+c.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=d.text):n.push(c);continue}if(s){const d="Infinite loop on byte: "+s.charCodeAt(0);if(this.options.silent){console.error(d);break}else throw new Error(d)}}return this.state.top=!0,n}inline(s,n=[]){return this.inlineQueue.push({src:s,tokens:n}),n}inlineTokens(s,n=[]){var c,u,d;let r=s,a=null;if(this.tokens.links){const h=Object.keys(this.tokens.links);if(h.length>0)for(;(a=this.tokenizer.rules.inline.reflinkSearch.exec(r))!=null;)h.includes(a[0].slice(a[0].lastIndexOf("[")+1,-1))&&(r=r.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(a=this.tokenizer.rules.inline.anyPunctuation.exec(r))!=null;)r=r.slice(0,a.index)+"++"+r.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(a=this.tokenizer.rules.inline.blockSkip.exec(r))!=null;)r=r.slice(0,a.index)+"["+"a".repeat(a[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);let i=!1,o="";for(;s;){i||(o=""),i=!1;let h;if((u=(c=this.options.extensions)==null?void 0:c.inline)!=null&&u.some(g=>(h=g.call({lexer:this},s,n))?(s=s.substring(h.raw.length),n.push(h),!0):!1))continue;if(h=this.tokenizer.escape(s)){s=s.substring(h.raw.length),n.push(h);continue}if(h=this.tokenizer.tag(s)){s=s.substring(h.raw.length),n.push(h);continue}if(h=this.tokenizer.link(s)){s=s.substring(h.raw.length),n.push(h);continue}if(h=this.tokenizer.reflink(s,this.tokens.links)){s=s.substring(h.raw.length);const g=n.at(-1);h.type==="text"&&(g==null?void 0:g.type)==="text"?(g.raw+=h.raw,g.text+=h.text):n.push(h);continue}if(h=this.tokenizer.emStrong(s,r,o)){s=s.substring(h.raw.length),n.push(h);continue}if(h=this.tokenizer.codespan(s)){s=s.substring(h.raw.length),n.push(h);continue}if(h=this.tokenizer.br(s)){s=s.substring(h.raw.length),n.push(h);continue}if(h=this.tokenizer.del(s)){s=s.substring(h.raw.length),n.push(h);continue}if(h=this.tokenizer.autolink(s)){s=s.substring(h.raw.length),n.push(h);continue}if(!this.state.inLink&&(h=this.tokenizer.url(s))){s=s.substring(h.raw.length),n.push(h);continue}let p=s;if((d=this.options.extensions)!=null&&d.startInline){let g=1/0;const x=s.slice(1);let y;this.options.extensions.startInline.forEach(b=>{y=b.call({lexer:this},x),typeof y=="number"&&y>=0&&(g=Math.min(g,y))}),g<1/0&&g>=0&&(p=s.substring(0,g+1))}if(h=this.tokenizer.inlineText(p)){s=s.substring(h.raw.length),h.raw.slice(-1)!=="_"&&(o=h.raw.slice(-1)),i=!0;const g=n.at(-1);(g==null?void 0:g.type)==="text"?(g.raw+=h.raw,g.text+=h.text):n.push(h);continue}if(s){const g="Infinite loop on byte: "+s.charCodeAt(0);if(this.options.silent){console.error(g);break}else throw new Error(g)}}return n}},cm=class{constructor(t){he(this,"options");he(this,"parser");this.options=t||Go}space(t){return""}code({text:t,lang:s,escaped:n}){var i;const r=(i=(s||"").match(Vn.notSpaceStart))==null?void 0:i[0],a=t.replace(Vn.endingNewline,"")+`
`;return r?'<pre><code class="language-'+Ta(r)+'">'+(n?a:Ta(a,!0))+`</code></pre>
`:"<pre><code>"+(n?a:Ta(a,!0))+`</code></pre>
`}blockquote({tokens:t}){return`<blockquote>
${this.parser.parse(t)}</blockquote>
`}html({text:t}){return t}heading({tokens:t,depth:s}){return`<h${s}>${this.parser.parseInline(t)}</h${s}>
`}hr(t){return`<hr>
`}list(t){const s=t.ordered,n=t.start;let r="";for(let o=0;o<t.items.length;o++){const c=t.items[o];r+=this.listitem(c)}const a=s?"ol":"ul",i=s&&n!==1?' start="'+n+'"':"";return"<"+a+i+`>
`+r+"</"+a+`>
`}listitem(t){var n;let s="";if(t.task){const r=this.checkbox({checked:!!t.checked});t.loose?((n=t.tokens[0])==null?void 0:n.type)==="paragraph"?(t.tokens[0].text=r+" "+t.tokens[0].text,t.tokens[0].tokens&&t.tokens[0].tokens.length>0&&t.tokens[0].tokens[0].type==="text"&&(t.tokens[0].tokens[0].text=r+" "+Ta(t.tokens[0].tokens[0].text),t.tokens[0].tokens[0].escaped=!0)):t.tokens.unshift({type:"text",raw:r+" ",text:r+" ",escaped:!0}):s+=r+" "}return s+=this.parser.parse(t.tokens,!!t.loose),`<li>${s}</li>
`}checkbox({checked:t}){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:t}){return`<p>${this.parser.parseInline(t)}</p>
`}table(t){let s="",n="";for(let a=0;a<t.header.length;a++)n+=this.tablecell(t.header[a]);s+=this.tablerow({text:n});let r="";for(let a=0;a<t.rows.length;a++){const i=t.rows[a];n="";for(let o=0;o<i.length;o++)n+=this.tablecell(i[o]);r+=this.tablerow({text:n})}return r&&(r=`<tbody>${r}</tbody>`),`<table>
<thead>
`+s+`</thead>
`+r+`</table>
`}tablerow({text:t}){return`<tr>
${t}</tr>
`}tablecell(t){const s=this.parser.parseInline(t.tokens),n=t.header?"th":"td";return(t.align?`<${n} align="${t.align}">`:`<${n}>`)+s+`</${n}>
`}strong({tokens:t}){return`<strong>${this.parser.parseInline(t)}</strong>`}em({tokens:t}){return`<em>${this.parser.parseInline(t)}</em>`}codespan({text:t}){return`<code>${Ta(t,!0)}</code>`}br(t){return"<br>"}del({tokens:t}){return`<del>${this.parser.parseInline(t)}</del>`}link({href:t,title:s,tokens:n}){const r=this.parser.parseInline(n),a=Ly(t);if(a===null)return r;t=a;let i='<a href="'+t+'"';return s&&(i+=' title="'+Ta(s)+'"'),i+=">"+r+"</a>",i}image({href:t,title:s,text:n,tokens:r}){r&&(n=this.parser.parseInline(r,this.parser.textRenderer));const a=Ly(t);if(a===null)return Ta(n);t=a;let i=`<img src="${t}" alt="${n}"`;return s&&(i+=` title="${Ta(s)}"`),i+=">",i}text(t){return"tokens"in t&&t.tokens?this.parser.parseInline(t.tokens):"escaped"in t&&t.escaped?t.text:Ta(t.text)}},Tx=class{strong({text:t}){return t}em({text:t}){return t}codespan({text:t}){return t}del({text:t}){return t}html({text:t}){return t}text({text:t}){return t}link({text:t}){return""+t}image({text:t}){return""+t}br(){return""}},mi=class kp{constructor(s){he(this,"options");he(this,"renderer");he(this,"textRenderer");this.options=s||Go,this.options.renderer=this.options.renderer||new cm,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new Tx}static parse(s,n){return new kp(n).parse(s)}static parseInline(s,n){return new kp(n).parseInline(s)}parse(s,n=!0){var a,i;let r="";for(let o=0;o<s.length;o++){const c=s[o];if((i=(a=this.options.extensions)==null?void 0:a.renderers)!=null&&i[c.type]){const d=c,h=this.options.extensions.renderers[d.type].call({parser:this},d);if(h!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(d.type)){r+=h||"";continue}}const u=c;switch(u.type){case"space":{r+=this.renderer.space(u);continue}case"hr":{r+=this.renderer.hr(u);continue}case"heading":{r+=this.renderer.heading(u);continue}case"code":{r+=this.renderer.code(u);continue}case"table":{r+=this.renderer.table(u);continue}case"blockquote":{r+=this.renderer.blockquote(u);continue}case"list":{r+=this.renderer.list(u);continue}case"html":{r+=this.renderer.html(u);continue}case"paragraph":{r+=this.renderer.paragraph(u);continue}case"text":{let d=u,h=this.renderer.text(d);for(;o+1<s.length&&s[o+1].type==="text";)d=s[++o],h+=`
`+this.renderer.text(d);n?r+=this.renderer.paragraph({type:"paragraph",raw:h,text:h,tokens:[{type:"text",raw:h,text:h,escaped:!0}]}):r+=h;continue}default:{const d='Token with "'+u.type+'" type was not found.';if(this.options.silent)return console.error(d),"";throw new Error(d)}}}return r}parseInline(s,n=this.renderer){var a,i;let r="";for(let o=0;o<s.length;o++){const c=s[o];if((i=(a=this.options.extensions)==null?void 0:a.renderers)!=null&&i[c.type]){const d=this.options.extensions.renderers[c.type].call({parser:this},c);if(d!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(c.type)){r+=d||"";continue}}const u=c;switch(u.type){case"escape":{r+=n.text(u);break}case"html":{r+=n.html(u);break}case"link":{r+=n.link(u);break}case"image":{r+=n.image(u);break}case"strong":{r+=n.strong(u);break}case"em":{r+=n.em(u);break}case"codespan":{r+=n.codespan(u);break}case"br":{r+=n.br(u);break}case"del":{r+=n.del(u);break}case"text":{r+=n.text(u);break}default:{const d='Token with "'+u.type+'" type was not found.';if(this.options.silent)return console.error(d),"";throw new Error(d)}}}return r}},np,Vu=(np=class{constructor(t){he(this,"options");he(this,"block");this.options=t||Go}preprocess(t){return t}postprocess(t){return t}processAllTokens(t){return t}provideLexer(){return this.block?ui.lex:ui.lexInline}provideParser(){return this.block?mi.parse:mi.parseInline}},he(np,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"])),np),L5=class{constructor(...t){he(this,"defaults",yx());he(this,"options",this.setOptions);he(this,"parse",this.parseMarkdown(!0));he(this,"parseInline",this.parseMarkdown(!1));he(this,"Parser",mi);he(this,"Renderer",cm);he(this,"TextRenderer",Tx);he(this,"Lexer",ui);he(this,"Tokenizer",lm);he(this,"Hooks",Vu);this.use(...t)}walkTokens(t,s){var r,a;let n=[];for(const i of t)switch(n=n.concat(s.call(this,i)),i.type){case"table":{const o=i;for(const c of o.header)n=n.concat(this.walkTokens(c.tokens,s));for(const c of o.rows)for(const u of c)n=n.concat(this.walkTokens(u.tokens,s));break}case"list":{const o=i;n=n.concat(this.walkTokens(o.items,s));break}default:{const o=i;(a=(r=this.defaults.extensions)==null?void 0:r.childTokens)!=null&&a[o.type]?this.defaults.extensions.childTokens[o.type].forEach(c=>{const u=o[c].flat(1/0);n=n.concat(this.walkTokens(u,s))}):o.tokens&&(n=n.concat(this.walkTokens(o.tokens,s)))}}return n}use(...t){const s=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach(n=>{const r={...n};if(r.async=this.defaults.async||r.async||!1,n.extensions&&(n.extensions.forEach(a=>{if(!a.name)throw new Error("extension name required");if("renderer"in a){const i=s.renderers[a.name];i?s.renderers[a.name]=function(...o){let c=a.renderer.apply(this,o);return c===!1&&(c=i.apply(this,o)),c}:s.renderers[a.name]=a.renderer}if("tokenizer"in a){if(!a.level||a.level!=="block"&&a.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");const i=s[a.level];i?i.unshift(a.tokenizer):s[a.level]=[a.tokenizer],a.start&&(a.level==="block"?s.startBlock?s.startBlock.push(a.start):s.startBlock=[a.start]:a.level==="inline"&&(s.startInline?s.startInline.push(a.start):s.startInline=[a.start]))}"childTokens"in a&&a.childTokens&&(s.childTokens[a.name]=a.childTokens)}),r.extensions=s),n.renderer){const a=this.defaults.renderer||new cm(this.defaults);for(const i in n.renderer){if(!(i in a))throw new Error(`renderer '${i}' does not exist`);if(["options","parser"].includes(i))continue;const o=i,c=n.renderer[o],u=a[o];a[o]=(...d)=>{let h=c.apply(a,d);return h===!1&&(h=u.apply(a,d)),h||""}}r.renderer=a}if(n.tokenizer){const a=this.defaults.tokenizer||new lm(this.defaults);for(const i in n.tokenizer){if(!(i in a))throw new Error(`tokenizer '${i}' does not exist`);if(["options","rules","lexer"].includes(i))continue;const o=i,c=n.tokenizer[o],u=a[o];a[o]=(...d)=>{let h=c.apply(a,d);return h===!1&&(h=u.apply(a,d)),h}}r.tokenizer=a}if(n.hooks){const a=this.defaults.hooks||new Vu;for(const i in n.hooks){if(!(i in a))throw new Error(`hook '${i}' does not exist`);if(["options","block"].includes(i))continue;const o=i,c=n.hooks[o],u=a[o];Vu.passThroughHooks.has(i)?a[o]=d=>{if(this.defaults.async)return Promise.resolve(c.call(a,d)).then(p=>u.call(a,p));const h=c.call(a,d);return u.call(a,h)}:a[o]=(...d)=>{let h=c.apply(a,d);return h===!1&&(h=u.apply(a,d)),h}}r.hooks=a}if(n.walkTokens){const a=this.defaults.walkTokens,i=n.walkTokens;r.walkTokens=function(o){let c=[];return c.push(i.call(this,o)),a&&(c=c.concat(a.call(this,o))),c}}this.defaults={...this.defaults,...r}}),this}setOptions(t){return this.defaults={...this.defaults,...t},this}lexer(t,s){return ui.lex(t,s??this.defaults)}parser(t,s){return mi.parse(t,s??this.defaults)}parseMarkdown(t){return(n,r)=>{const a={...r},i={...this.defaults,...a},o=this.onError(!!i.silent,!!i.async);if(this.defaults.async===!0&&a.async===!1)return o(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof n>"u"||n===null)return o(new Error("marked(): input parameter is undefined or null"));if(typeof n!="string")return o(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(n)+", string expected"));i.hooks&&(i.hooks.options=i,i.hooks.block=t);const c=i.hooks?i.hooks.provideLexer():t?ui.lex:ui.lexInline,u=i.hooks?i.hooks.provideParser():t?mi.parse:mi.parseInline;if(i.async)return Promise.resolve(i.hooks?i.hooks.preprocess(n):n).then(d=>c(d,i)).then(d=>i.hooks?i.hooks.processAllTokens(d):d).then(d=>i.walkTokens?Promise.all(this.walkTokens(d,i.walkTokens)).then(()=>d):d).then(d=>u(d,i)).then(d=>i.hooks?i.hooks.postprocess(d):d).catch(o);try{i.hooks&&(n=i.hooks.preprocess(n));let d=c(n,i);i.hooks&&(d=i.hooks.processAllTokens(d)),i.walkTokens&&this.walkTokens(d,i.walkTokens);let h=u(d,i);return i.hooks&&(h=i.hooks.postprocess(h)),h}catch(d){return o(d)}}}onError(t,s){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,t){const r="<p>An error occurred:</p><pre>"+Ta(n.message+"",!0)+"</pre>";return s?Promise.resolve(r):r}if(s)return Promise.reject(n);throw n}}},Ho=new L5;function Ht(t,s){return Ho.parse(t,s)}Ht.options=Ht.setOptions=function(t){return Ho.setOptions(t),Ht.defaults=Ho.defaults,iN(Ht.defaults),Ht};Ht.getDefaults=yx;Ht.defaults=Go;Ht.use=function(...t){return Ho.use(...t),Ht.defaults=Ho.defaults,iN(Ht.defaults),Ht};Ht.walkTokens=function(t,s){return Ho.walkTokens(t,s)};Ht.parseInline=Ho.parseInline;Ht.Parser=mi;Ht.parser=mi.parse;Ht.Renderer=cm;Ht.TextRenderer=Tx;Ht.Lexer=ui;Ht.lexer=ui.lex;Ht.Tokenizer=lm;Ht.Hooks=Vu;Ht.parse=Ht;Ht.options;Ht.setOptions;Ht.use;Ht.walkTokens;Ht.parseInline;mi.parse;ui.lex;Ht.setOptions({breaks:!0,gfm:!0});const gN=t=>{try{const s=Ht.parse(t);return xi.sanitize(s)}catch{return xi.sanitize(t.replace(/\n/g,"<br>"))}},Um=t=>{const s=t.match(/^\s*- \[(?: |x|X)\]/gm);if(!s||s.length===0)return{total:0,checked:0};const n=s.filter(r=>r.toLowerCase().startsWith("- [x]")).length;return{total:s.length,checked:n}},Li=t=>{const{total:s,checked:n}=Um(t);return s?n/s*100:0};async function Fy(t){const r=Bt(xe,"tasks"),a=xn(r,Et("userId","==",t));try{const i=await gn(a),o=new Set;if(i.forEach(d=>{const h=d.data();h.taskCode&&typeof h.taskCode=="number"&&o.add(h.taskCode)}),o.size===0)return 1e4;const c=Array.from(o).sort((d,h)=>d-h);for(let d=0;d<c.length-1;d++)if(c[d+1]-c[d]>1)return c[d]+1;const u=Math.max(...c);return u<99999?u+1:await By(t,o)}catch(i){return console.error("Error generating task code:",i),await By(t,new Set)}}async function By(t,s){for(let i=0;i<10;i++){const o=Math.floor(Math.random()*9e4)+1e4;if(!s.has(o)&&await $5(t,o))return o}throw new Error("Unable to generate unique task code after multiple attempts")}async function $5(t,s){try{const n=Bt(xe,"tasks"),r=xn(n,Et("userId","==",t),Et("taskCode","==",s));return(await gn(r)).empty}catch(n){return console.error("Error checking task code uniqueness:",n),!1}}const qo=()=>{const[t,s]=f.useState([]),[n,r]=f.useState([]),[a,i]=f.useState("idle"),[o,c]=f.useState(null),[u,d]=f.useState(!1),[h,p]=f.useState(null),[g,x]=f.useState("create"),{user:y}=Je(),b=f.useCallback(()=>t.filter(_=>!_.isPrivate),[t]),v=f.useCallback(()=>{d(!1),p(null),i("idle"),c(null),x("create")},[]),w=f.useCallback(async()=>{if(y){i("loading"),c(null);try{Me.logRead("tasks","useTaskData.loadTasks");const _=xn(Bt(xe,"tasks"),Et("userId","==",y.uid)),W=(await gn(_)).docs.map(P=>{var G,ae,Y,X,se;const z=P.data();return{id:P.id,taskCode:z.taskCode||0,title:z.title,description:z.description||"",completed:z.completed,createdAt:z.createdAt,updatedAt:(G=z.updatedAt)==null?void 0:G.toDate(),startDate:((ae=z.startDate)==null?void 0:ae.toDate())||((Y=z.startDate)==null?void 0:Y.toDate()),endDate:(X=z.endDate)==null?void 0:X.toDate(),isRecurrent:z.isRecurrent||!1,isPrivate:z.isPrivate||!1,category:z.category||"other",priority:z.priority||"delete",size:z.size||"pequea",estimatedTime:z.estimatedTime,timeOfDay:z.timeOfDay,elapsedSeconds:z.elapsedSeconds||0,progress:typeof z.progress=="number"?z.progress:Li(z.description||""),recurrence:z.recurrence?{frequency:z.recurrence.frequency,pattern:z.recurrence.pattern,customDays:z.recurrence.customDays,nextDate:(se=z.recurrence.nextDate)==null?void 0:se.toDate()}:void 0}});r(W);const B=W.filter(P=>!P.completed).sort((P,z)=>{var G,ae;return P.startDate&&z.startDate?P.startDate.getTime()-z.startDate.getTime():P.startDate?-1:z.startDate?1:(((G=z.createdAt)==null?void 0:G.seconds)||0)-(((ae=P.createdAt)==null?void 0:ae.seconds)||0)});s(B),i("saved")}catch(_){console.error("Error loading tasks:",_),rm(_)?(console.warn("Firestore internal error detected. This may require cache clearing."),c("Error de sincronizacin detectado. Puedes intentar limpiar el cache offline si el problema persiste.")):c(_ instanceof Error?_.message:"Error loading tasks"),i("error")}}},[y]);f.useEffect(()=>{w()},[w]);const N=f.useCallback(async _=>{var M,W;if(!(!_.title.trim()||!y)){i("saving"),c(null);try{if(_.startDate&&_.endDate&&_.endDate<_.startDate){c("La fecha de fin debe ser posterior a la fecha de inicio"),i("error");return}const B=await Fy(y.uid),P={id:`temp-${Date.now()}`,taskCode:B,title:_.title.trim(),description:((M=_.description)==null?void 0:M.trim())||"",completed:!1,createdAt:{seconds:Date.now()/1e3},startDate:_.startDate||void 0,endDate:_.endDate||void 0,category:_.category||"other",priority:_.priority||"delete",size:_.size||"pequea",elapsedSeconds:0,progress:Li(_.description||""),isRecurrent:_.isRecurrent||!1,isPrivate:_.isPrivate||!1,..._.timeOfDay&&{timeOfDay:_.timeOfDay},..._.estimatedTime!==void 0&&{estimatedTime:_.estimatedTime},..._.recurrence&&{recurrence:_.recurrence}};s(ae=>[...ae,P].sort((Y,X)=>{var se,H;return Y.startDate&&X.startDate?Y.startDate.getTime()-X.startDate.getTime():Y.startDate?-1:X.startDate?1:(((se=X.createdAt)==null?void 0:se.seconds)||0)-(((H=Y.createdAt)==null?void 0:H.seconds)||0)}));const z={userId:y.uid,taskCode:B,title:_.title.trim(),completed:!1,createdAt:ht(),category:_.category||"other",priority:_.priority||"delete",size:_.size||"pequea",elapsedSeconds:0,..._.timeOfDay&&{timeOfDay:_.timeOfDay},..._.estimatedTime!==void 0&&{estimatedTime:_.estimatedTime}};z.progress=Li(_.description||""),(W=_.description)!=null&&W.trim()&&(z.description=_.description.trim()),_.startDate&&(z.startDate=ka.fromDate(_.startDate)),_.endDate&&(z.endDate=ka.fromDate(_.endDate)),_.isPrivate&&(z.isPrivate=!0),_.isRecurrent&&_.recurrence&&(z.isRecurrent=!0,z.recurrence={frequency:_.recurrence.frequency,pattern:_.recurrence.pattern},_.recurrence.pattern==="custom"&&_.recurrence.customDays&&(z.recurrence.customDays=_.recurrence.customDays)),Me.logWrite("tasks","useTaskData.addTask");const G=await wl(Bt(xe,"tasks"),z);s(ae=>ae.map(Y=>Y.id===P.id?{...Y,id:G.id}:Y)),i("saved")}catch(B){console.error("Error al guardar tarea:",B),rm(B)?(console.warn("Firestore internal error detected during task creation."),c("Error de sincronizacin. La tarea puede haberse guardado pero hay un problema con el cache local."),setTimeout(()=>{w()},2e3)):B instanceof Error&&B.message.includes("taskCode")?c("Error al generar cdigo de tarea nico"):(s(P=>P.filter(z=>z.id.startsWith("temp-"))),c(B instanceof Error?B.message:"Error al guardar")),i("error")}}},[y]),S=f.useCallback(async(_,M)=>{var B,P;if(!y)return;i("saving");const W=t.find(z=>z.id===_);if(W)try{const z=M.startDate!==void 0?M.startDate:W.startDate,G=M.endDate!==void 0?M.endDate:W.endDate;if(z&&G&&G<z){c("La fecha de fin debe ser posterior a la fecha de inicio"),i("error");return}const ae={...W,...((B=M.title)==null?void 0:B.trim())&&{title:M.title.trim()},...typeof M.description=="string"&&{description:M.description.trim()},...M.startDate!==void 0&&{startDate:M.startDate||void 0},...M.endDate!==void 0&&{endDate:M.endDate||void 0},...M.category&&{category:M.category},...M.priority&&{priority:M.priority},...M.size&&{size:M.size},...M.estimatedTime!==void 0&&{estimatedTime:M.estimatedTime},...M.timeOfDay&&{timeOfDay:M.timeOfDay},...M.isPrivate!==void 0&&{isPrivate:M.isPrivate},...M.isRecurrent!==void 0&&{isRecurrent:M.isRecurrent},...M.recurrence&&{recurrence:M.recurrence}};ae.progress=Li(typeof M.description=="string"?M.description:W.description||""),s(se=>se.map(H=>H.id===_?ae:H).sort((H,ie)=>{var fe,le;return H.startDate&&ie.startDate?H.startDate.getTime()-ie.startDate.getTime():H.startDate?-1:ie.startDate?1:(((fe=ie.createdAt)==null?void 0:fe.seconds)||0)-(((le=H.createdAt)==null?void 0:le.seconds)||0)}));const Y=ke(xe,"tasks",_),X={updatedAt:ht()};(P=M.title)!=null&&P.trim()&&(X.title=M.title.trim()),typeof M.description=="string"&&(X.description=M.description.trim()||null),M.startDate!==void 0&&(X.startDate=M.startDate?ka.fromDate(M.startDate):null),M.endDate!==void 0&&(X.endDate=M.endDate?ka.fromDate(M.endDate):null),M.category&&(X.category=M.category),M.priority&&(X.priority=M.priority),M.size&&(X.size=M.size),M.estimatedTime!==void 0&&(X.estimatedTime=M.estimatedTime),M.timeOfDay&&(X.timeOfDay=M.timeOfDay),M.isPrivate!==void 0&&(X.isPrivate=M.isPrivate),M.isRecurrent!==void 0&&(X.isRecurrent=M.isRecurrent,M.isRecurrent||(X.recurrence=null)),M.recurrence&&(X.recurrence={frequency:M.recurrence.frequency,pattern:M.recurrence.pattern},M.recurrence.pattern==="custom"&&M.recurrence.customDays&&(X.recurrence.customDays=M.recurrence.customDays)),X.progress=ae.progress,Me.logWrite("tasks","useTaskData.editTask",_),await ar(Y,X),i("saved"),v()}catch(z){console.error("Error al actualizar:",z),s(G=>G.map(ae=>ae.id===_?W:ae)),c(z instanceof Error?z.message:"Error al actualizar"),i("error")}},[y,t,v]),E=f.useCallback(async(_,M)=>{if(y){i("saving");try{const W=t.find(B=>B.id===_);if(!W)throw new Error("Tarea no encontrada");if(!W.isRecurrent){M&&s(P=>P.filter(z=>z.id!==_));const B=ke(xe,"tasks",_);Me.logWrite("tasks","useTaskData.toggleTask",_),await ar(B,{completed:M,updatedAt:ht()}),i("saved");return}p(W),x("complete"),d(!0)}catch(W){if(console.error("Error al actualizar estado:",W),M){const B=t.find(P=>P.id===_);B&&s(P=>[...P,B])}c(W instanceof Error?W.message:"Error al actualizar"),i("error")}}},[y,t]),k=f.useCallback(async _=>{if(!y)return;i("saving");const M=t.find(W=>W.id===_);if(M)try{s(W=>W.filter(B=>B.id!==_)),Me.logDelete("tasks","useTaskData.deleteTask",_),await Vo(ke(xe,"tasks",_)),i("saved")}catch(W){console.error("Error al eliminar:",W),s(B=>[...B,M].sort((P,z)=>{var G,ae;return P.startDate&&z.startDate?P.startDate.getTime()-z.startDate.getTime():P.startDate?-1:z.startDate?1:(((G=z.createdAt)==null?void 0:G.seconds)||0)-(((ae=P.createdAt)==null?void 0:ae.seconds)||0)})),c(W instanceof Error?W.message:"Error al eliminar"),i("error")}},[y,t]),D=f.useCallback(async _=>{var M,W,B,P,z,G,ae,Y,X,se;if(!(!h||!y)){i("saving");try{const H=await Fy(y.uid),ie={id:`temp-${Date.now()}`,taskCode:H,title:h.title,description:((M=_.description)==null?void 0:M.trim())||h.description||"",completed:!1,createdAt:{seconds:Date.now()/1e3},startDate:_.startDate||void 0,endDate:_.endDate||void 0,isRecurrent:!0,category:h.category,priority:h.priority||"delete",size:h.size||"pequea",elapsedSeconds:0,progress:Li(((W=_.description)==null?void 0:W.trim())||h.description||""),isPrivate:h.isPrivate||!1,..._.timeOfDay&&{timeOfDay:_.timeOfDay},recurrence:{pattern:((B=h.recurrence)==null?void 0:B.pattern)||"daily",frequency:((P=h.recurrence)==null?void 0:P.frequency)||1,...((z=h.recurrence)==null?void 0:z.pattern)==="custom"&&{customDays:h.recurrence.customDays}}};s(de=>[...de.filter(ge=>ge.id!==h.id),ie].sort((ge,Se)=>{var oe,J;return ge.startDate&&Se.startDate?ge.startDate.getTime()-Se.startDate.getTime():ge.startDate?-1:Se.startDate?1:(((oe=Se.createdAt)==null?void 0:oe.seconds)||0)-(((J=ge.createdAt)==null?void 0:J.seconds)||0)}));const fe=ke(xe,"tasks",h.id);Me.logWrite("tasks","useTaskData.completeRecurrentTask",h.id),await ar(fe,{completed:!0,updatedAt:ht()});const le={userId:y.uid,taskCode:H,title:h.title,completed:!1,createdAt:ht(),elapsedSeconds:0,startDate:_.startDate?ka.fromDate(_.startDate):null,endDate:_.endDate?ka.fromDate(_.endDate):null,isRecurrent:!0,category:h.category,priority:h.priority||"delete",size:h.size||"pequea",..._.timeOfDay&&{timeOfDay:_.timeOfDay},recurrence:{pattern:((G=h.recurrence)==null?void 0:G.pattern)||"daily",frequency:((ae=h.recurrence)==null?void 0:ae.frequency)||1,...((Y=h.recurrence)==null?void 0:Y.pattern)==="custom"&&{customDays:h.recurrence.customDays}}};((X=_.description)!=null&&X.trim()||h.description)&&(le.description=((se=_.description)==null?void 0:se.trim())||h.description),le.progress=Li(le.description||""),Me.logWrite("tasks","useTaskData.completeRecurrentTask.next");const K=await wl(Bt(xe,"tasks"),le);s(de=>de.map(je=>je.id===ie.id?{...je,id:K.id}:je)),i("saved"),v()}catch(H){console.error("Error al procesar tarea recurrente:",H),H instanceof Error&&H.message.includes("taskCode")?c("Error al generar cdigo de tarea recurrente"):(s(ie=>[...ie.filter(le=>!le.id.startsWith("temp-")),h].sort((le,K)=>{var de,je;return le.startDate&&K.startDate?le.startDate.getTime()-K.startDate.getTime():le.startDate?-1:K.startDate?1:(((de=K.createdAt)==null?void 0:de.seconds)||0)-(((je=le.createdAt)==null?void 0:je.seconds)||0)})),c(H instanceof Error?H.message:"Error al actualizar tarea recurrente")),i("error")}}},[h,y,v]),T=f.useCallback((_,M)=>{x("create"),p({id:"",taskCode:0,title:"",completed:!1,category:"personal",priority:"delete",size:"pequea",createdAt:{seconds:Date.now()/1e3},..._?{startDate:_}:{},...M?{isPrivate:!0}:{},timeOfDay:void 0,progress:0}),d(!0)},[]),R=f.useCallback(_=>{p(_),x("edit"),d(!0),i("idle")},[]),O=Ha("Task data"),U=f.useCallback(async()=>{try{i("loading"),c(null),await nm()}catch(_){console.error("Error clearing cache:",_),c("Error al limpiar el cache. Intenta recargar la pgina manualmente."),i("error")}},[]),I=f.useMemo(()=>t.filter(_=>!_.isPrivate),[t]);return f.useMemo(()=>({tasks:I,allTasks:n,status:a,error:o,showRecurrenceModal:u,currentTask:h,modalMode:g,addTask:N,editTask:S,toggleTask:E,deleteTask:k,completeRecurrentTask:D,setShowRecurrenceModal:v,openEditModal:R,openCreateModal:T,getPublicTasks:b,loadTasks:w,resync:O,clearCacheAndReload:U}),[I,t,n,a,o,u,h,g,N,S,E,k,D,v,T,b,w,O,U])},z5=({date:t,variant:s="compact"})=>{const n=Qt(),{allTasks:r,status:a}=qo(),i=a==="loading",o=ps(t),c=ci(t),u=r.filter(x=>{if(!x.completed||!x.updatedAt)return!1;const y=x.updatedAt;return y>=o&&y<=c}).length,d=r.filter(x=>x.completed||!x.startDate?!1:x.startDate<=c).length,h=r.filter(x=>{if(x.completed||!x.startDate)return!1;const y=x.startDate;return y>=o&&y<=c}).length,p=r.filter(x=>x.completed||!x.startDate?!1:x.startDate<o).length,g=()=>{n("/task/list")};return e.jsx(Ir,{title:"Tareas",icon:tm,variant:s,loading:i,onClick:()=>n("/task/list"),children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-lg font-bold text-purple-600",children:[u,"/",d]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[h," hoy",p>0&&e.jsxs("span",{className:"text-red-500 ml-1",children:[" ",p," vencidas"]})]})]}),e.jsxs($,{size:"sm",variant:"outline",onClick:x=>{x.stopPropagation(),g()},className:"flex items-center gap-1",children:[e.jsx(cs,{className:"w-3 h-3"}),s==="detailed"&&"Nueva"]})]}),s==="detailed"&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-purple-500 h-2 rounded-full transition-all duration-300",style:{width:`${d>0?u/d*100:0}%`}})}),e.jsx("p",{className:"text-xs text-gray-600",children:d>0?`${(u/d*100).toFixed(0)}% progreso diario`:"Sin tareas pendientes"})]})]})})},F5=(t,s)=>{const n=vn.length,r=t!=null&&t.habits?Object.entries(t.habits).filter(([c,u])=>c.endsWith(`_${s}`)&&u).map(([c])=>{const u=parseInt(c.split("_")[0]);return vn.find(d=>d.id===u)}).filter(Boolean):[],a=r.length,i=vn.filter(c=>!r.some(u=>(u==null?void 0:u.id)===c.id)),o=["morning","afternoon","night","anytime"].map(c=>{const u=i.filter(d=>d.timeOfDay===c);return{timeOfDay:c,habits:u.map(d=>({id:d.id,name:d.name,icon:d.icon,goal:d.goal}))}}).filter(c=>c.habits.length>0);return{completed:a,total:n,incompletedByTimeOfDay:o}},B5=t=>{if(!(t!=null&&t.drinks)||!Array.isArray(t.drinks))return[];const s=new Map;return t.drinks.forEach(n=>{const r=n.type,a=n.amount||0;if(s.has(r)){const i=s.get(r);s.set(r,{amount:i.amount+a,count:i.count+1})}else s.set(r,{amount:a,count:1})}),Array.from(s.entries()).map(([n,r])=>({type:n,amount:r.amount,count:r.count})).sort((n,r)=>r.amount-n.amount)},H5=t=>{if(!(t!=null&&t.moods)||!Array.isArray(t.moods))return{count:0,average:0,highest:0,lowest:0,details:[]};const s=t.moods,n=s.length;if(n===0)return{count:0,average:0,highest:0,lowest:0,details:[]};const r=Zw(s),a=s.map(u=>u.value??im(u.text)),i=Math.max(...a),o=Math.min(...a),c=s.map(u=>({emoji:u.emoji,text:u.text,value:u.value??im(u.text),time:u.time}));return{count:n,average:r,highest:i,lowest:o,details:c}},vN=async(t,s)=>{var c;const n=Ie(s),[r,a]=n.split("-"),i=ka.fromDate(ps(s)),o=ka.fromDate(ci(s));try{const u=await ot(ke(xe,"journal",`${t}_${n}`)),d=await ot(ke(xe,"moods",`${t}_${n}`)),h=await ot(ke(xe,"water",`${t}_${n}`)),p=await ot(ke(xe,"exercises",`${t}_${n}`)),g=await ot(ke(xe,"pomodoro",`${t}_${n}`)),x=await ot(ke(xe,"habits",`${t}_${r}-${a}`)),y=await ot(ke(xe,"negative-habits",`${t}_${r}-${a}`)),b=xn(Bt(xe,"tasks"),Et("userId","==",t),Et("completed","==",!0),Et("updatedAt",">=",i),Et("updatedAt","<=",o)),w=(await gn(b)).size,N=xn(Bt(xe,"tasks"),Et("userId","==",t),Et("completed","==",!1),Et("dueDate","<=",o)),E=(await gn(N)).size,k=xn(Bt(xe,"tasks"),Et("userId","==",t),Et("completed","==",!1),Et("dueDate",">=",i),Et("dueDate","<=",o)),T=(await gn(k)).size,R=xn(Bt(xe,"tasks"),Et("userId","==",t),Et("completed","==",!1),Et("dueDate","<",i)),U=(await gn(R)).size;return{journal:{words:u.exists()?(u.data().text||"").split(/\s+/).filter(Boolean).length:0},mood:H5(d.exists()?d.data():null),water:{intake:h.exists()&&h.data().totalWater||0,drinkDetails:h.exists()?B5(h.data()):[]},exercise:(()=>{var B,P;const _=p.exists()?p.data():null;console.log(" fetchDailySummary - Exercise data for",n,":",_),console.log(" fetchDailySummary - Exercise summary:",_==null?void 0:_.summary);const M=((B=_==null?void 0:_.summary)==null?void 0:B.totalDuration)||0,W=((P=_==null?void 0:_.summary)==null?void 0:P.totalCalories)||0;return console.log(" fetchDailySummary - extracted minutes:",M,"calories:",W),{minutes:M,calories:W}})(),pomodoro:(()=>{var G;const _=g.exists()?g.data():null;console.log(" fetchDailySummary - Pomodoro data for",n,":",_);const M=(_==null?void 0:_.count)||0;let W=0;_!=null&&_.sessions&&Array.isArray(_.sessions)&&(W=_.sessions.reduce((ae,Y)=>{const X=Y.duration?Math.round(Y.duration/60):0;return ae+X},0)),console.log(" fetchDailySummary - extracted count:",M,"workMinutes:",W),console.log(" fetchDailySummary - sessions found:",((G=_==null?void 0:_.sessions)==null?void 0:G.length)||0),console.log(" fetchDailySummary - available keys:",_?Object.keys(_):"no data");const B=300,P=B>0?Math.min(100,W/B*100):0,z=M>0?W/M:0;return{count:M,expectedMinutes:B,workMinutes:W,completionRate:parseFloat(P.toFixed(1)),averageSessionLength:parseFloat(z.toFixed(1))}})(),habits:F5(x.exists()?x.data():null,n),negativeHabits:{count:y.exists()?Object.keys(((c=y.data().habits)==null?void 0:c[n])||{}).length:0},tasks:{completed:w,activeAndOverdue:E,todayPending:T,overdue:U}}}catch(u){throw console.error(" fetchDailySummary - Error in try block:",u),u}},U5={journal:{words:0},mood:{count:0,average:0,highest:0,lowest:0,details:[]},habits:{completed:0,total:vn.length,incompletedByTimeOfDay:[]},negativeHabits:{count:0},exercise:{minutes:0,calories:0},tasks:{completed:0,activeAndOverdue:0,todayPending:0,overdue:0},pomodoro:{count:0,expectedMinutes:0,workMinutes:0,completionRate:0,averageSessionLength:0},water:{intake:0,drinkDetails:[]}},Ru=new Map,bd=t=>{const{user:s}=Je(),[n,r]=f.useState(U5),[a,i]=f.useState(!0),[o,c]=f.useState(null),u=f.useCallback(async()=>{if(!s){i(!1);return}const h=`${s.uid}_${Ie(t)}`;if(Ru.has(h)){const p=Ru.get(h);r(p.summary),i(!1);return}i(!0),c(null);try{console.log(" Loading daily summary for:",Ie(t));const p=await vN(s.uid,t);Ru.set(h,{summary:p,loading:!1,subscribers:new Set,unsubscribes:[]}),r(p),i(!1)}catch(p){console.error("Error loading daily summary:",p),c(p instanceof Error?p.message:"Error loading summary"),i(!1)}},[s,t]);f.useEffect(()=>{u()},[u]);const d=f.useCallback(()=>{if(!s)return;const h=`${s.uid}_${Ie(t)}`;Ru.delete(h),u()},[s,t,u]);return{summary:n,loading:a,error:o,refetch:d}},W5=({date:t,variant:s="compact"})=>{const n=Qt(),{summary:r,loading:a}=bd(t),o=r.pomodoro.workMinutes,u=Math.min(o/300*100,100),d=Math.floor(o/60),h=o%60,p=d>0?`${d}h ${h}min`:`${h}min`,g=x=>{x.stopPropagation(),n("/pomodoro")};return e.jsx(Ir,{title:"Pomodoro",icon:zo,variant:s,loading:a,onClick:()=>n("/pomodoro"),children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold text-red-600",children:p}),e.jsxs("p",{className:"text-xs text-gray-500",children:["de 5h (",u.toFixed(0),"%)"]})]}),e.jsxs($,{size:"sm",variant:"outline",onClick:g,className:"flex items-center gap-1 bg-red-50 hover:bg-red-100 border-red-200",children:[e.jsx(Sn,{className:"w-3 h-3"}),s==="detailed"&&"Iniciar"]})]}),s==="detailed"&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{children:"Progreso diario"}),e.jsxs("span",{children:[u.toFixed(0),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-red-500 h-2 rounded-full transition-all duration-300",style:{width:`${Math.min(u,100)}%`}})})]})]})})},Y5=({date:t,variant:s="compact"})=>{const n=Qt(),{summary:r,loading:a}=bd(t),i=r.exercise.calories,o=r.exercise.minutes,c=500,u=Math.min(i/c*100,100),d=h=>{h.stopPropagation(),n("/exercise")};return e.jsx(Ir,{title:"Ejercicio",icon:Zj,variant:s,loading:a,onClick:()=>n("/exercise"),children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-lg font-bold text-green-600",children:[i," cal"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["de ",c," cal (",u.toFixed(0),"%) - ",o,"min"]})]}),e.jsxs($,{size:"sm",variant:"outline",onClick:d,className:"flex items-center gap-1 bg-green-50 hover:bg-green-100 border-green-200",children:[e.jsx(cs,{className:"w-3 h-3"}),s==="detailed"&&"Registrar"]})]}),s==="detailed"&&e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-300",style:{width:`${u}%`}})})]})})},V5=({date:t,variant:s="compact"})=>{const n=Qt(),{summary:r,loading:a}=bd(t),i=r.journal.words,o=i>0,c=u=>{u.stopPropagation(),n("/journal")};return e.jsx(Ir,{title:"Diario",icon:md,variant:s,loading:a,onClick:()=>n("/journal"),children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:o?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-lg font-bold text-indigo-600",children:[i," palabras"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Entrada registrada"})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Sin entrada"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Escribe tus pensamientos"})]})}),e.jsxs($,{size:"sm",variant:"outline",onClick:c,className:"flex items-center gap-1 bg-indigo-50 hover:bg-indigo-100 border-indigo-200",children:[e.jsx(jr,{className:"w-3 h-3"}),s==="detailed"&&(o?"Editar":"Escribir")]})]}),s==="detailed"&&o&&e.jsx("div",{className:"text-xs text-gray-600 p-2 bg-gray-50 rounded",children:e.jsxs("p",{children:[" Tienes una entrada de ",i," palabras para hoy"]})})]})})},yN=t=>{const[s,n]=f.useState(null),[r,a]=f.useState("idle"),[i,o]=f.useState(null),{user:c}=Je(),u=f.useCallback(async()=>{if(!c)return;a("saving"),o(null);const x=Ie(t);try{Me.logRead("energy","useEnergyData.loadEnergyData");const y=ke(Bt(xe,"energy"),`${c.uid}_${x}`),b=await ot(y);if(b.exists()){const v=b.data();v&&Array.isArray(v.entries)?n(v):n({id:`${c.uid}_${x}`,userId:c.uid,date:x,entries:[]})}else n(null);a("saved")}catch(y){console.error("Error loading energy data:",y),o(y instanceof Error?y.message:"Error loading energy data"),a("error")}},[c,t]);f.useEffect(()=>{u()},[u]);const d=f.useCallback(async(x,y)=>{if(!c)return;a("saving"),o(null);const b=Ie(t),v=`${c.uid}_${b}`,w=new Date,N=jn(t,w.getHours(),w.getMinutes()),S={level:x,comment:y,timestamp:N.timestamp,time:w.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})},E=(s==null?void 0:s.entries)||[],k={id:v,userId:c.uid,date:b,entries:[...E,S]};n(k);try{const D=ke(Bt(xe,"energy"),v);Me.logWrite("energy","useEnergyData.addEntry"),await Zt(D,k),a("saved")}catch(D){console.error("Energy - Error al guardar:",D),n(s),o(D instanceof Error?D.message:"Error al guardar"),a("error")}},[c,t,s]),h=f.useCallback(async(x,y)=>{if(!c||!s)return;a("saving"),o(null);const b=s;try{const v=s.entries.map(S=>S.timestamp===x?y:S),w={...s,entries:v};n(w);const N=ke(Bt(xe,"energy"),s.id);Me.logWrite("energy","useEnergyData.updateEntry",s.id),await Zt(N,w),a("saved")}catch(v){console.error("Energy - Error al actualizar:",v),n(b),o(v instanceof Error?v.message:"Error al actualizar"),a("error")}},[c,s]),p=f.useCallback(async x=>{if(!c||!s)return;a("saving"),o(null);const y=s;try{const b=s.entries.filter(w=>w.timestamp!==x),v=ke(Bt(xe,"energy"),s.id);if(b.length===0)n(null),Me.logDelete("energy","useEnergyData.deleteEntry",s.id),await Vo(v);else{const w={...s,entries:b};n(w),Me.logWrite("energy","useEnergyData.deleteEntry",s.id),await Zt(v,w)}a("saved")}catch(b){console.error("Energy - Error al eliminar:",b),n(y),o(b instanceof Error?b.message:"Error al eliminar"),a("error")}},[c,s]),g=Ha("Energy data");return{energyHistory:(s==null?void 0:s.entries)||[],status:r,error:i,addEntry:d,updateEntry:h,deleteEntry:p,loadEnergyData:u,resync:g}},G5=({date:t,variant:s="compact"})=>{const n=Qt(),{energyHistory:r,status:a}=yN(t),i=a==="saving"||a==="pending",o=r||[],c=o.length,u=o.length>0?o.reduce((x,y)=>x+y.level,0)/o.length:0,d=o[o.length-1],h=x=>x>=4.5?nw:x>=3.5?op:x>=2.5?lp:x>=1.5?rw:aw,p=x=>x>=4.5?"text-green-600":x>=3.5?"text-lime-500":x>=2.5?"text-yellow-500":x>=1.5?"text-orange-500":"text-red-500",g=h(u);return e.jsx(Ir,{title:"Nivel de Energa",icon:op,variant:s,loading:i,onClick:()=>n("/mood"),children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:c>0?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{className:`w-6 h-6 ${p(u)}`}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium",children:[u.toFixed(1),"/5"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[c," registro",c>1?"s":""]})]})]})}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(lp,{className:"w-6 h-6 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Sin registros"})]})}),e.jsxs($,{size:"sm",variant:"outline",onClick:x=>{x.stopPropagation(),n("/mood")},className:"flex items-center gap-1",children:[e.jsx(cs,{className:"w-3 h-3"}),s==="detailed"&&"Registrar"]})]}),s==="detailed"&&d&&e.jsxs("div",{className:"text-xs text-gray-600 p-2 bg-gray-50 rounded",children:[e.jsx("p",{className:"font-medium",children:"ltimo registro:"}),e.jsxs("p",{children:["Nivel ",d.level,"/5 - ",d.time,d.comment&&` - "${d.comment}"`]})]})]})})},q5=({date:t,variant:s="compact"})=>{const n=Qt(),{summary:r,loading:a,error:i}=bd(t),o=nt(t,"EEEE, d MMMM",{locale:Zs}),c=[{label:"Hbitos",value:`${r.habits.completed}/${r.habits.total}`,progress:r.habits.total>0?r.habits.completed/r.habits.total*100:0,color:"bg-green-500"},{label:"Agua",value:`${r.water.intake}ml`,progress:Math.min(r.water.intake/2500*100,100),color:"bg-blue-500"},{label:"Tareas",value:`${r.tasks.completed}/${r.tasks.activeAndOverdue}`,progress:r.tasks.activeAndOverdue>0?r.tasks.completed/r.tasks.activeAndOverdue*100:0,color:"bg-purple-500"},{label:"Tiempo Trabajado",value:r.pomodoro.workMinutes>0?`${Math.floor(r.pomodoro.workMinutes/60)}h ${r.pomodoro.workMinutes%60}min`:"Sin datos",progress:Math.min(r.pomodoro.workMinutes/300*100,100),color:"bg-red-500"},{label:"Ejercicio",value:r.exercise.calories>0?`${r.exercise.calories}cal`:"Sin datos",progress:Math.min(r.exercise.calories/500*100,100),color:"bg-orange-500"},{label:"nimo",value:r.mood.count>0?`${r.mood.average.toFixed(1)}/10`:"Sin datos",progress:r.mood.average*10,color:"bg-yellow-500"}],u=Object.values(r).some(d=>Object.values(d).some(h=>typeof h=="number"&&h>0));return e.jsx(Ir,{title:s==="detailed"?`Resumen - ${o}`:"Resumen del Da",icon:s==="detailed"?ns:Nl,variant:s,loading:a,error:i||void 0,onClick:()=>n("/stats"),children:u?e.jsx("div",{className:"space-y-2",children:s==="compact"?e.jsx("div",{className:"grid grid-cols-3 gap-2 text-center",children:c.slice(0,6).map((d,h)=>e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 truncate",children:d.label}),e.jsx("p",{className:"text-sm font-medium truncate",children:d.value})]},h))}):e.jsxs("div",{className:"space-y-3",children:[c.map((d,h)=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:d.label}),e.jsx("span",{className:"text-sm text-gray-600",children:d.value})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:`${d.color} h-1.5 rounded-full transition-all duration-300`,style:{width:`${Math.min(d.progress,100)}%`}})})]},h)),e.jsxs("div",{className:"grid grid-cols-2 gap-2 pt-2 border-t border-gray-100",children:[r.exercise.minutes>0&&e.jsx("div",{className:"text-xs text-gray-600 p-2 bg-gray-50 rounded",children:e.jsxs("p",{children:[" ",r.exercise.minutes," min ejercicio"]})}),r.journal.words>0&&e.jsx("div",{className:"text-xs text-gray-600 p-2 bg-gray-50 rounded",children:e.jsxs("p",{children:[" ",r.journal.words," palabras"]})}),r.pomodoro.count>0&&e.jsx("div",{className:"text-xs text-gray-600 p-2 bg-gray-50 rounded",children:e.jsxs("p",{children:[" ",r.pomodoro.count," sesiones"]})}),r.negativeHabits.count>0&&e.jsx("div",{className:"text-xs text-red-600 p-2 bg-red-50 rounded",children:e.jsxs("p",{children:[" ",r.negativeHabits.count," hbitos negativos"]})})]})]})}):e.jsx("div",{className:"text-center py-2",children:e.jsx("p",{className:"text-sm text-gray-500",children:"No hay datos registrados para hoy"})})})},K5=({date:t,variant:s="compact"})=>{const n=Qt(),{summary:r,loading:a}=bd(t),o=(()=>{let h=0,p=0;const g=r.habits.total>0?r.habits.completed/r.habits.total*30:0;h+=g,p+=30;const x=Math.min(r.water.intake/2e3*20,20);h+=x,p+=20;const y=r.tasks.activeAndOverdue>0?r.tasks.completed/r.tasks.activeAndOverdue*25:0;h+=y,p+=25;const b=Math.min(r.exercise.calories/500*15,15);h+=b,p+=15;const v=r.journal.words>0?10:0;return h+=v,p+=10,p>0?Math.round(h/p*100):0})(),c=h=>h>=80?"text-green-600":h>=60?"text-yellow-600":h>=40?"text-orange-600":"text-red-600",u=h=>h>=80?"bg-green-500":h>=60?"bg-yellow-500":h>=40?"bg-orange-500":"bg-red-500",d=h=>h>=80?"Excelente da!":h>=60?"Buen progreso!":h>=40?"Sigue as":"Puedes mejorar";return e.jsx(Ir,{title:"Score Diario",icon:jO,variant:s,loading:a,onClick:()=>n("/stats"),children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-3xl font-bold ${c(o)}`,children:[o,"%"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:d(o)})]}),s==="detailed"&&e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:`${u(o)} h-3 rounded-full transition-all duration-300 flex items-center justify-end pr-2`,style:{width:`${o}%`},children:o>20&&e.jsx(Nl,{className:"w-3 h-3 text-white"})})})]})})},J5=({date:t,variant:s="detailed",className:n})=>{const r=Qt(),{completedHabits:a,status:i,toggleHabit:o}=Fm(t),c=i==="saving"||i==="pending",[u,d]=f.useState(null),h=Ie(t),p=new Date().getHours(),x=p>=6&&p<12?"morning":p>=12&&p<18?"afternoon":p>=18&&p<24?"night":"anytime",[y,b]=f.useState(new Set([x])),v=vn.reduce((R,O)=>{const U=O.timeOfDay||"anytime";return R[U]||(R[U]=[]),R[U].push(O),R},{}),w={morning:" Maana",afternoon:" Tarde",night:" Noche",anytime:" Cualquier momento"},N=["morning","afternoon","night","anytime"],S=R=>{b(O=>{const U=new Set(O);return U.has(R)?U.delete(R):U.add(R),U})},E=async R=>{if(u!==R){d(R);try{await o(R,h)}catch(O){console.error("Error toggling habit:",O)}finally{d(null)}}},k=vn.length,D=Object.entries(a).filter(([R,O])=>R.endsWith(`_${h}`)&&O).length,T=k>0?D/k*100:0;return e.jsx(Ir,{title:"Hbitos del Da",icon:aa,variant:s,loading:c,className:n,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-green-50 to-blue-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-lg font-bold text-green-600",children:[D,"/",k," completados"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[T.toFixed(0),"% del da"]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"w-16 h-16 relative",children:[e.jsxs("svg",{className:"w-16 h-16 transform -rotate-90",viewBox:"0 0 100 100",children:[e.jsx("circle",{cx:"50",cy:"50",r:"40",stroke:"currentColor",strokeWidth:"8",fill:"transparent",className:"text-gray-200"}),e.jsx("circle",{cx:"50",cy:"50",r:"40",stroke:"currentColor",strokeWidth:"8",fill:"transparent",strokeDasharray:`${2*Math.PI*40}`,strokeDashoffset:`${2*Math.PI*40*(1-T/100)}`,className:"text-green-500 transition-all duration-300"})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("span",{className:"text-xs font-bold text-green-600",children:[T.toFixed(0),"%"]})})]})})]}),e.jsx("div",{className:"space-y-3",children:N.map(R=>{const O=v[R]||[];if(O.length===0)return null;const U=R===x,I=y.has(R);return e.jsxs("div",{className:ce("border rounded-lg transition-all duration-200",U?"border-blue-300 bg-blue-50 shadow-sm":"border-gray-200 bg-white"),children:[e.jsxs("button",{type:"button",onClick:()=>S(R),className:ce("w-full flex items-center justify-between p-3 text-left hover:bg-gray-50 transition-colors rounded-lg",U&&"hover:bg-blue-100"),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:ce("text-sm font-medium",U?"text-blue-700":"text-gray-700"),children:w[R]}),U&&e.jsx(en,{className:"w-3 h-3 text-blue-500"})]}),I?e.jsx(Gn,{className:"w-4 h-4 text-gray-400"}):e.jsx(Ma,{className:"w-4 h-4 text-gray-400"})]}),I&&e.jsx("div",{className:"space-y-2 px-3 pb-3",children:O.map(_=>{const M=`${_.id}_${h}`,W=a[M]||!1,B=u===_.id;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{type:"button",onClick:P=>{P.stopPropagation(),E(_.id)},disabled:B,className:ce("flex-1 flex items-center gap-3 p-2 rounded-md transition-all duration-200 text-left",W?"bg-green-100 text-green-800 hover:bg-green-200":"bg-gray-50 text-gray-700 hover:bg-gray-100",B&&"opacity-50 cursor-not-allowed"),children:[e.jsx("div",{className:"flex-shrink-0",children:B?e.jsx(fs,{className:"w-4 h-4 animate-spin"}):W?e.jsx(aa,{className:"w-4 h-4 text-green-600"}):e.jsx(ox,{className:"w-4 h-4 text-gray-400"})}),e.jsx("span",{className:"text-lg mr-2",children:_.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:ce("text-sm font-medium truncate",W&&"line-through"),children:_.name}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:_.goal})]})]}),_.steps&&_.steps.length>0&&e.jsx("button",{type:"button",onClick:P=>{P.stopPropagation(),r(`/habit/${_.id}/run`,{state:{date:t.toISOString()}})},className:"flex-shrink-0 p-2 rounded-md bg-blue-50 text-blue-600 hover:bg-blue-100 transition-colors",title:"Iniciar hbito paso a paso",children:e.jsx(Sn,{className:"w-4 h-4"})})]},_.id)})})]},R)})})]})})},Ri="Puedes usar etiquetas HTML bsicas como <b>, <i> o <br> para dar formato a la respuesta.",Ic={goals:{model:"gemini-2.5-flash",prompts:{taskSuggestions:`Asistente Inteligente de Planificacin de Objetivos
Eres un experto en productividad y planificacin de objetivos que ayuda a las personas a estructurar mejor sus metas mediante tareas especficas y accionables.

Tu funcin principal:
Analizar un objetivo especfico, sus tareas actuales y avances para sugerir nuevas tareas que ayuden a completar el objetivo de manera ms efectiva.

Instrucciones:
1. Analiza el objetivo principal y su descripcin
2. Revisa las tareas existentes para identificar patrones y vacos
3. Considera los avances registrados para entender el progreso actual
4. Si hay una meta numrica, ten en cuenta el valor objetivo y actual
5. Sugiere 5-8 tareas especficas, accionables y realistas
6. Ordena las tareas por prioridad o secuencia lgica
7. Incluye tareas de diferentes tipos: preparacin, ejecucin, seguimiento, validacin

Formato de respuesta:
Proporciona una lista numerada de tareas sugeridas con una breve explicacin de por qu cada una es importante.

`+Ri},params:{temperature:.7,top_p:.9}},task:{model:"gemini-2.5-flash",prompt:`Asistente Inteligente de Productividad y Gestin de Estado de nimo
Eres un experto en productividad personal que entiende cmo el estado emocional afecta el rendimiento y la motivacin para completar tareas.

Contexto
Soy Alexander, ingeniero de sistemas, y necesito ayuda para elegir qu tareas abordar basndome en mi estado de nimo actual y mis tareas pendientes.

Tu funcin principal:
Analizar la correlacin entre mi estado emocional actual y mis tareas pendientes para sugerir la secuencia ptima de trabajo que maximice mi productividad y bienestar.

Instrucciones:
1. Evala mi estado de nimo actual y su impacto en diferentes tipos de tareas
2. Considera factores como:
    Nivel de energa mental requerido para cada tarea
    Complejidad tcnica vs emocional
    Urgencia e importancia
    Potencial de la tarea para mejorar o empeorar mi estado de nimo
    Mi perfil profesional como ingeniero de sistemas
3. Prioriza tareas que:
    Sean apropiadas para mi estado emocional actual
    Puedan generar momentum positivo
    Balanceen productividad con bienestar mental

Formato de respuesta:
 **Anlisis de tu estado actual:**
[Muy breve evaluacin del estado de nimo y su impacto en la productividad]

 **Secuencia recomendada:**
1.  [Tarea] - [Razn muy breve especfica basada en tu estado]
2.  [Tarea] - [Razn muy breve especfica basada en tu estado]
3.  [Tarea] - [Razn muy breve especfica basada en tu estado]

 **Estrategia adicional:**
[Consejo muy breve especfico para mantener la motivacin y productividad]

Usa colores:  (ideal ahora),  (despus de ganar momentum),  (cuando tengas ms energa).
`+Ri,prompts:{breakdown:`Asistente para Desglosar Tareas y Combatir la Procrastinacin
Eres un experto en productividad y gestin del tiempo. Tu tarea es ayudarme a combatir la procrastinacin desglosando mis tareas en elementos ms pequeos y manejables.

Contexto
Soy Alexander, ingeniero de sistemas, y necesito ayuda para estructurar mis tareas de manera efectiva para evitar la procrastinacin.

Instrucciones:
Realiza las siguientes acciones:
    Analiza la tarea principal y desglsala en mximo 5 subtareas especficas
    Si te doy pasos iniciales, respeta hasta donde ms se pueda su redaccin (verifica si son completos, si hay pasos faltantes antes, durante o despus)
    Verifica la coherencia lgica entre los pasos y ordnalos de forma secuencial
    Considera mi profesin y nivel de experiencia al estimar el tiempo para cada subtarea
    Usa emojis relevantes al inicio de cada subtarea para hacerlas ms atractivas

Formato de respuesta:
- [ ] [Emoji] [Descripcin clara de la subtarea] (X min)
- [ ] [Emoji] [Descripcin clara de la subtarea] (X min)
- [ ] [Emoji] [Descripcin clara de la subtarea] (X min)
 Total de tiempo estimado: [X] minutos

...

Reglas importantes:
 NO incluyas explicaciones tuyas, solo las subtareas y sus tiempos
 Cada subtarea debe estar en una sola lnea con emoji, descripcin y tiempo
 Mantn las respuestas breves y claras, evitando explicaciones innecesarias
 Las estimaciones de tiempo deben ser realistas basadas en mi perfil profesional`,improveDescription:`Eres un asistente experto en redaccin de tareas. Basndote en el ttulo y la descripcin actual, mejora el texto sin cambiar su intencin. Si la descripcin est vaca, genera una de mximo 100 palabras que defina claramente el objetivo de la tarea.Reglas importantes:
 NO incluyas explicaciones tuyas, solo la descripcin solicitada
 Mantn las respuestas breves y claras, evitando explicaciones innecesarias
`,ideas:"Sugiere ideas o ejemplos concretos para abordar la tarea. Entrega consejos breves, prcticos ayuden a iniciarla o completarla.Las ideas deben ser breves (mximo 50 palabras cada una) y enfocadas en superar la inercia inicial o desbloquear el progreso.\\n\\n### **{FORMATO DE RESPUESTA}**\\nEntrega las ideas como una lista simple, sin explicaciones adicionales. No excedas las 150 palabras en total.\\nEjemplo:\\n- Idea 1: [Descripcin breve y accionable]\\n- Idea 2: [Descripcin breve y accionable]\\n",reprioritize:'Eres un sistema experto en priorizacin de tareas diseado para ser ESTRICTO y evitar que todo parezca prioritario.\\n\\n### **{PERFIL DE USUARIO}**\\nAlexander: ingeniero de sistemas, 31 aos, trabaja desde casa, busca optimizar productividad y bienestar.\\n\\n### **{CRITERIOS ESTRICTOS DE PRIORIZACIN}**\\n**URGENTE = `true` SOLO SI:**\\n- Tiene fecha lmite en las prximas 24-48 horas\\n- Su retraso causa consecuencias inmediatas graves\\n- Bloquea el trabajo de otras personas\\n- Es requerido para funciones crticas del da\\n** MXIMO 20-30% de tareas pueden ser urgentes**\\n\\n**IMPORTANTE = `true` SOLO SI:**\\n- Contribuye directamente a objetivos principales (salud, productividad, ingresos)\\n- Su no realizacin afecta metas a largo plazo\\n- Es fundamental para el crecimiento profesional/personal\\n** MXIMO 40-50% de tareas pueden ser importantes**\\n\\n### **{DISTRIBUCIN OBJETIVO}**\\n- **Urgente + Importante**: 10-15% (hacer YA)\\n- **Importante (no urgente)**: 25-35% (planificar)\\n- **Urgente (no importante)**: 10-15% (delegar/minimizar)\\n- **Ni urgente ni importante**: 35-55% (eliminar/posponer)\\n\\n### **{INSTRUCCIONES}**\\n1. **urgent**: `true` solo si cumple criterios estrictos de urgencia\\n2. **important**: `true` solo si impacta objetivos clave de Alexander\\n3. **size**: "pequea" (<1h), "mediana" (1-3h), "grande" (>3h)\\n4. **estimatedTime**: Minutos realistas considerando el perfil tcnico\\n\\n**REGLA CRTICA**: Si ms del 50% resultan urgent/important, REVISA y s ms estricto.\\n\\n### **{FORMATO DE RESPUESTA OBLIGATORIO}**\\nDevuelve nicamente un JSON con un array de objetos {"id":"1","urgent":false,"important":true,"size":"mediana","estimatedTime":90}'}},journal:{model:"gemini-2.5-flash",prompt:`### **{ROL}**
Eres un experto en redaccin y comunicacin clara. Tu especialidad es mejorar textos manteniendo su esencia.

### **{CONTEXTO}**
Recibirs entradas de diario que necesitan una mejor redaccin para ser ms entendibles. Estos mensajes pueden contener ideas mezcladas, estructuras confusas o lenguaje poco claro.

### **{RESULTADO ESPERADO}**
Necesito que mejores la redaccin de las entradas de diario que te envo, para que sean:
- Ms directas y naturales
- Con trminos coloquiales en lugar de formalismos
- Fciles de entender

Lo ms importante: tu **NICA** labor es mejorar cmo est escrito el mensaje. **NO** debes:
- Cambiar el sentido o significado del texto original
- Aadir informacin nueva o inventar contexto
- Responder al contenido del mensaje
- Interpretarlo o dar opiniones sobre l
- Reaccionar al mensaje de ninguna forma
- Aunque el mensaje inicie con la palabra "Necesito", no debes actuar, solo mejorar la redaccin tal cual como se te pide.

### **{FORMATO_SOLICITADO}**
Entrega nicamente el texto mejorado, sin explicaciones adicionales ni comentarios.

### **{RESTRICCIONES O CONDICIONES}**
- Mantn todos los detalles importantes del mensaje original
- Si el mensaje contiene trminos tcnicos, mantenlos
- Simplifica cuando sea posible, pero sin perder informacin relevante
- No aadas saludos ni despedidas si no estaban en el mensaje original

### **{CONSEJOS}**
Los siguientes consejos pueden ser tiles para tu tarea (no es obligatorio seguirlos todos):
- Palabras simples: Escribe como si hablaras con un amigo, evita vocabulario complejo
- Frases cortas: Divide ideas complejas en partes fciles de entender
- Sin frases de IA: Nunca uses "profundicemos," "libera tu potencial," "solucin revolucionaria," "enfoque transformador," "aprovecha esta estrategia," "optimiza tu flujo de trabajo," etc.
- S directo: Di lo que quieres decir sin rodeos
- Flujo natural: Est bien empezar frases con "y," "pero" o "entonces"
- Voz real: No fuerces simpata ni emocin falsa
- Gramtica conversacional: Estructuras simples, no escritura acadmica
- Corta lo innecesario: Elimina adjetivos y adverbios que no aportan
- Usa ejemplos: Explica con casos concretos en lugar de ideas abstractas
- S honesto: Reconoce lmites, no exageres ni vendas humo
- Escribe como si chatearas: Casual, directo, como hablas en la vida real
- Transiciones naturales: Usa conectores simples como "la cosa es," "y," "pero"

Antes de terminar, asegrate de que el texto:
- Suena como algo que diras en voz alta
- Usa palabras que usara una persona normal
- No suena a texto publicitario
- Se siente autntico y honesto
- Va al grano rpido

### **{ESTILO}**
El estilo de escritura debe parecer hablado, como si lo estuviera contando en voz alta. Uso palabras comunes, no me complico con adornos o tecnicismos. Prefiero frases naturales, incluso si son largas, pero que fluyan como un pensamiento. No me gusta sonar falso ni muy estructurado. A veces repito conectores como "pues", "entonces" o "como que" y palabras como "bsicamente" porque as hablo yo. Cuando explico algo, voy directo al punto, pero sin sonar cortante. Si escribo sobre algo emocional, no filtro mucho: lo digo tal cual lo sent. Quiero que suene autntico, claro y sin vueltas raras.

### {PALABRAS QUE NO USO}
A continuacin, te doy algunas palabras que no uso. Te encuentro como escribira un colombiano para que no vayas a usar trminos espaoles o mexicanos, por ejemplo: bronca, chamba, chido, buena onda,
### {PALABRAS QUE SI USO}
Sin exagerar su uso digo palabras como: ratito, pues, entonces, como que, bsicamente, osea, creo, obviamente, etc. No me gusta sonar muy formal o tcnico, prefiero un tono ms relajado y cercano.Pero si las repito excesivamente puedes cambiarlo para que el texto no quede lleno de muletillas


{MENSAJE-ORIGINAL}

`},meal:{model:"gemini-2.5-flash",prompts:{meal:`## {ROL}
Asume el rol de un **experto nutricionista especializado en composicin corporal y chef profesional** con amplia experiencia en:
- Reduccin de grasa visceral y mejora de la composicin corporal
- Planificacin de mens balanceados para personas con condiciones mdicas especficas
- Optimizacin nutricional para trabajo sedentario y niveles de energa constante
- Creacin de planes alimentarios personalizados que maximizan el uso de ingredientes disponibles

## {CONTEXTO PERSONAL DETALLADO}
**Perfil del Usuario: Alexander**
- **Edad**: 31 aos
- **Peso actual**: 84.70 kg
- **IMC**: 26.7 (sobrepeso leve)
- **Condicin mdica**: Un rin y medio (post-ciruga infantil)
- **Actividad fsica**: Moderada, algunas veces por semana
- **Estilo de vida**: Trabajo sedentario desde casa
- **Objetivos prioritarios**:
  4. Energa constante durante jornada laboral sedentaria
  5. Prdida de peso gradual y sostenible

## {INSTRUCCIONES}
Genera una comida usando NICAMENTE los ingredientes proporcionados
- Sea meal prep friendly cuando posible

- **name**: Incluir bebidas recomendadas
- **notes**: Max 50 palabras; Beneficios anti-grasa visceral, hidratacin, tiempo prep, almacenamiento
- **recipe**: Max 50 palabras; Mtodo saludable, tips sabor, opciones meal prep`,day:`## {ROL}
Asume el rol de un **experto nutricionista especializado en composicin corporal y chef profesional** con amplia experiencia en:
- Reduccin de grasa visceral y mejora de la composicin corporal
- Planificacin de mens balanceados para personas con condiciones mdicas especficas
- Optimizacin nutricional para trabajo sedentario y niveles de energa constante
- Creacin de planes alimentarios personalizados que maximizan el uso de ingredientes disponibles

## {CONTEXTO PERSONAL DETALLADO}
**Perfil del Usuario: Alexander**
- **Edad**: 31 aos, **Peso**: 84.70 kg, **IMC**: 26.7
- **CRTICO**: Grasa visceral nivel 11 (Alta)
- **CRTICO**: Hidratacin 50.6% (insuficiente)
- **Condicin mdica**: Un rin y medio
- **Estilo de vida**: Trabajo sedentario desde casa
## {DISTRIBUCIN DIARIA}
**5 comidas especficas:**
1. **Desayuno** - Energtico sin picos de azcar, pero saciante
2. **Snack maana** - Ligero, hidratante
3. **Almuerzo** - Comida principal, anti-inflamatoria
4. **Snack tarde** - Saciante
5. **Cena** - Ligera, recuperacin nocturna

### Practicidad (ESENCIAL):
- **Recetas populares y probadas** disponibles en internet (siempre busca en internet para cumplir la tarea)
- **Preparaciones fciles**
- **Meal prep friendly**: que se puedan preparar en lotes
- **Sabores atractivos**: especias, hierbas, combinaciones apetitosas
## {INSTRUCCIONES FINALES}
Genera plan completo usando NICAMENTE ingredientes:
- **Recetas conocidas por ser sabrosas**
Formato JSON con llaves: breakfast, morningSnack, lunch, afternoonSnack, dinner
Cada comida: {"name":"","notes":"","recipe":""}
- **name**: Incluir bebidas recomendadas
- **notes**: Beneficios anti-grasa visceral, hidratacin, tiempo prep, almacenamiento
- **recipe**: Mtodo saludable, tips sabor, opciones meal prep`}},mood:{model:"gemini-2.5-flash",prompt:`### **{ROL}**
Eres un psiclogo especializado en anlisis emocional y bienestar mental con experiencia en:
- Interpretacin de patrones emocionales a partir de texto escrito
- Identificacin de estados de nimo complejos y matices emocionales
- Correlacin entre eventos diarios y respuestas emocionales
- Anlisis del lenguaje emocional en entradas de diario personal

### **{CONTEXTO PERSONAL}**
**Perfil del Usuario: Alexander**
- Ingeniero de sistemas de 31 aos
- Trabajo sedentario desde casa
- Personalidad analtica y reflexiva
- Busca mejorar su bienestar fsico y emocional
- Tiende a procesar las emociones de forma racional
- Usa el diario como herramienta de autoconocimiento

### **{RESULTADO ESPERADO}**
Analiza la entrada del diario y sugiere estados de nimo especficos que:
- Reflejen con precisin las emociones expresadas en el texto
- Capturen matices emocionales (no solo estados bsicos)
- Consideren el contexto y las circunstancias mencionadas
- Sean relevantes para el momento especfico del da
- Ayuden al usuario a entender mejor sus patrones emocionales

### **{INSTRUCCIONES ESPECFICAS}**
1. **Lee cuidadosamente** la entrada del diario completa
2. **Identifica emociones explcitas** (lo que dice directamente)
3. **Detecta emociones implcitas** (lo que se puede inferir del tono, contexto)
4. **Considera la progresin temporal** si menciona eventos a lo largo del da
5. **Usa NICAMENTE** los estados de nimo de la lista proporcionada
6. **Asigna horarios lgicos** basndote en:
   - Eventos mencionados (trabajo, comidas, ejercicio)
   - Momento probable del da para cada emocin
   - Secuencia cronolgica natural
7. **Proporciona razones especficas** que conecten el texto con el estado de nimo

### **{CRITERIOS DE CALIDAD}**
- **Precisin emocional**: El estado de nimo debe coincidir con lo expresado
- **Contexto relevante**: La razn debe citar elementos especficos del texto
- **Horarios realistas**: Que tengan sentido con las actividades mencionadas
- **Diversidad emocional**: Capturar diferentes matices si existen
- **Granularidad apropiada**: Ni muy genrico ni demasiado especfico

### **{RESTRICCIONES CRTICAS}**
- **SOLO** usar estados de nimo de la lista proporcionada
- **NO** inventar emociones que no estn en la lista
- **NO** asumir contexto no mencionado en el texto
- **NO** agregar interpretaciones psicolgicas profundas
- **NO** incluir consejos o recomendaciones

### **{FORMATO REQUERIDO}**
Devuelve el resultado NICAMENTE en formato JSON vlido:
[{"emoji":"","text":"optimista","time":"09:30","reason":"Menciona sentirse motivado para empezar el da con energa"}]

- **emoji**: El emoji asociado al estado de nimo de la lista
- **text**: El nombre exacto del estado de nimo de la lista
- **time**: Hora en formato HH:mm (24 horas)
- **reason**: Explicacin breve y especfica basada en el texto del diario

### **{ESTILO DE ANLISIS}**
Analiza de forma natural y humana, como si fueras un psiclogo emptico que entiende los matices emocionales. No te quedes solo en lo obvio: busca las emociones que estn entre lneas, pero siempre respaldndote en lo que realmente dice el texto. Si hay emociones mixtas o que cambian durante el da, refljalo con mltiples entradas en horarios diferentes.`},habit:{model:"gemini-2.5-flash",prompts:{predict:`### **{ROL}**
Eres un especialista en ciencias del comportamiento y formacin de hbitos con experiencia en:
- Anlisis de patrones de comportamiento a partir de datos histricos
- Identificacin de factores que influyen en el xito o fallo de hbitos
- Psicologa de la motivacin y adherencia a rutinas
- Estrategias prcticas para mejorar la consistencia en hbitos

### **{CONTEXTO PERSONAL}**
**Perfil del Usuario: Alexander**
- Ingeniero de sistemas de 31 aos
- Trabajo sedentario desde casa
- Personalidad analtica que aprecia datos y patrones
- Busca optimizar su rutina diaria y bienestar
- Tiende a ser autoexigente con sus metas
- Valora la eficiencia y estrategias basadas en evidencia

### **{RESULTADO ESPERADO}**
Analiza el historial de hbitos y proporciona:
1. **Identificacin de hbitos en riesgo** - Cules tienden a fallarse
2. **Anlisis de patrones** - Por qu fallan (das, circunstancias, factores)
3. **Predicciones precisas** - Probabilidad de fallo futuro
4. **Consejos actionables** - Estrategias especficas y prcticas

### **{INSTRUCCIONES DE ANLISIS}**
1. **Examina los datos histricos**:
   - Frecuencia de xitos vs fallos por hbito
   - Patrones temporales (das de la semana, fechas especficas)
   - Rachas de xito y periodos de fallo
   - Tendencias recientes vs histricas

2. **Identifica factores de riesgo**:
   - Hbitos con tasa de fallo >30%
   - Patrones estacionales o cclicos
   - Correlaciones entre fallos de diferentes hbitos
   - Momentos crticos de abandono

3. **Proporciona consejos especficos**:
   - Basados en el perfil de Alexander (trabajo desde casa, analtico)
   - Estrategias probadas cientficamente
   - Ajustes prcticos e implementables
   - Enfoque en sistemas, no solo motivacin

### **{FORMATO DE RESPUESTA}**
Estructura tu anlisis as:

 **Anlisis de Patrones**
[Resumen de los patrones ms importantes encontrados]

 **Hbitos en Riesgo**
 **[Nombre del hbito]** - [% de fallo] - [Patrn identificado]
 **[Nombre del hbito]** - [% de fallo] - [Patrn identificado]

 **Estrategias Especficas**
**Para [Hbito X]:**
- [Consejo especfico y actionable]
- [Ajuste prctico basado en el patrn]

**Para [Hbito Y]:**
- [Consejo especfico y actionable]
- [Ajuste prctico basado en el patrn]

 **Recomendacin Principal**
[Consejo principal para mejorar la adherencia general]

### **{ESTILO DE COMUNICACIN}**
Habla de forma directa y prctica, como un coach experto que entiende los retos reales. Usa datos concretos cuando los tengas, pero explica de manera simple. No uses frases motivacionales vacas: enfcate en estrategias actionables que Alexander pueda implementar maana mismo. Reconoce los xitos antes de sealar reas de mejora.`+Ri,suggest:`### **{ROL}**
Eres un especialista en desarrollo personal y optimizacin de rutinas con experiencia en:
- Diseo de sistemas de hbitos personalizados
- Integracin de hbitos con metas de salud y productividad
- Anlisis holstico de estilo de vida para identificar oportunidades
- Creacin de rutinas sostenibles para profesionales del conocimiento

### **{CONTEXTO PERSONAL}**
**Perfil del Usuario: Alexander**
- Ingeniero de sistemas de 31 aos
- Trabajo sedentario desde casa
- Objetivos de salud: reducir grasa visceral, mejorar hidratacin
- Busca optimizar productividad y bienestar
- Personalidad analtica, aprecia sistemas eficientes
- Valora hbitos que se integren naturalmente a su rutina

### **{RESULTADO ESPERADO}**
Basndote en las metas y actividades de otros mdulos, sugiere nuevos hbitos que:
- **Se alineen** con objetivos especficos de salud y productividad
- **Se integren** naturalmente con rutinas existentes
- **Sean sostenibles** para un estilo de vida sedentario
- **Generen impacto** medible en bienestar y rendimiento

### **{CRITERIOS DE SUGERENCIAS}**
1. **Relevancia**: Conectados directamente con metas existentes
2. **Viabilidad**: Realistas para trabajo desde casa
3. **Especificidad**: Claros, medibles y accionables
4. **Progresividad**: Que se puedan implementar gradualmente
5. **Sinergia**: Que potencien otros hbitos o actividades

### **{CATEGORAS DE HBITOS}**
Considera estas reas prioritarias:

** Salud Fsica**
- Hbitos anti-grasa visceral
- Hidratacin y nutricin
- Movimiento durante trabajo sedentario
- Calidad del sueo

** Productividad**
- Tcnicas de enfoque y concentracin
- Gestin de energa mental
- Rutinas de inicio y cierre de jornada
- Descansos activos

** Bienestar Mental**
- Manejo del estrs
- Mindfulness y reflexin
- Conexin social
- Desarrollo personal

### **{FORMATO DE SUGERENCIAS}**
Presenta cada hbito as:

##  **Hbitos Sugeridos**

### **[Categora] - [Nombre del Hbito]**
** Objetivo:** [A qu meta especfica contribuye]
** Frecuencia:** [Cundo y qu tan seguido]
** Accin especfica:** [Qu hacer exactamente]
** Integracin:** [Cmo conecta con rutina actual]
** Mtrica:** [Cmo medir el progreso]
** Por qu funciona:** [Razn cientfica o prctica]

### **{INSTRUCCIONES ESPECFICAS}**
- **Analiza primero** las actividades y metas de otros mdulos
- **Prioriza 3-5 hbitos** mximo (no abrumar)
- **Enfcate en gaps** que no estn cubiertos actualmente
- **Considera el timing** - cundo encajan mejor en el da
- **Incluye micro-hbitos** que se puedan stackear con rutinas existentes

### **{ESTILO DE COMUNICACIN}**
Explica de forma prctica y directa, como un consultor que entiende las limitaciones reales del trabajo desde casa. Justifica cada sugerencia con el beneficio especfico que tendr. No propongas hbitos genricos: personalzalos para el contexto de Alexander. Enfcate en la implementacin prctica, no solo en los beneficios.`+Ri}},negativeHabit:{model:"gemini-2.5-flash",prompts:{impact:`### **{ROL}**
Eres un psiclogo especializado en modificacin de conducta y anlisis de patrones comportamentales con experiencia en:
- Identificacin de patrones en hbitos destructivos
- Anlisis del impacto de comportamientos negativos en bienestar general
- Correlacin entre hbitos negativos y factores desencadenantes
- Evaluacin de riesgos para la salud fsica y mental

### **{CONTEXTO PERSONAL}**
**Perfil del Usuario: Alexander**
- Ingeniero de sistemas de 31 aos
- Trabajo sedentario desde casa
- Objetivos de salud: reducir grasa visceral (nivel 11), mejorar hidratacin
- Personalidad analtica, responde bien a datos concretos
- Busca optimizar su bienestar y productividad
- Tiende a ser autoexigente y reflexivo sobre sus comportamientos

### **{RESULTADO ESPERADO}**
Analiza el historial de hbitos negativos y proporciona:
1. **Impacto especfico** de cada hbito en su salud y metas
2. **Patrones temporales** y factores desencadenantes
3. **Correlaciones** entre diferentes hbitos negativos
4. **Evaluacin de riesgo** para objetivos de salud especficos
5. **Insights actionables** para la toma de conciencia

### **{INSTRUCCIONES DE ANLISIS}**
1. **Examina la frecuencia y patrones**:
   - Das de la semana con mayor incidencia
   - Horarios ms comunes para cada hbito
   - Rachas o clusters de comportamientos
   - Tendencias temporales (mejorando, empeorando, estable)

2. **Identifica correlaciones**:
   - Hbitos que tienden a ocurrir juntos
   - Efectos domin entre comportamientos
   - Relacin con estados emocionales o situaciones

3. **Evala impacto especfico**:
   - Efecto directo en grasa visceral y hidratacin
   - Impacto en productividad y energa
   - Consecuencias para trabajo sedentario
   - Interferencia con hbitos positivos

### **{FORMATO DE ANLISIS}**
Estructura tu respuesta as:

 **Resumen de Patrones**
[Visin general de los patrones ms significativos]

 **Impacto por Hbito**
**[Nombre del hbito]** - [Frecuencia]
 **Impacto directo:** [Cmo afecta objetivos especficos]
 **Patrn detectado:** [Cundo/por qu ocurre]
 **Riesgo:** [Nivel de prioridad para abordar]

 **Correlaciones Crticas**
 [Hbito A] + [Hbito B]: [Relacin y impacto combinado]
 [Trigger comn]: [Situaciones que desencadenan mltiples hbitos]

 **Prioridades de Intervencin**
1. **[Hbito ms crtico]** - [Razn por la cual es prioritario]
2. **[Segundo hbito]** - [Razn por la cual es importante]

### **{ESTILO DE COMUNICACIN}**
S directo pero emptico. Como Alexander es analtico, usa datos especficos y evita sermones. Enfcate en el impacto real y medible, no en juicios morales. Reconoce que entender los patrones es el primer paso para cambiarlos.`+Ri,action:`### **{ROL}**
Eres un especialista en intervencin conductual inmediata con experiencia en:
- Estrategias de interrupcin de patrones de hbitos negativos
- Tcnicas de reemplazo de comportamientos en tiempo real
- Motivacin y redireccin de impulsos destructivos
- Creacin de alternativas saludables e inmediatamente disponibles

### **{CONTEXTO PERSONAL}**
**Perfil del Usuario: Alexander**
- Ingeniero de sistemas de 31 aos
- Trabajo sedentario desde casa
- Objetivos crticos: reducir grasa visceral, mejorar hidratacin
- Personalidad analtica, responde a lgica y sistemas
- Ambiente de trabajo desde casa (acceso limitado a ciertas alternativas)
- Valora eficiencia y estrategias que funcionen inmediatamente

### **{RESULTADO ESPERADO}**
Cuando Alexander registre un hbito negativo, proporciona:
1. **Alternativas inmediatas** que pueda hacer en ese momento
2. **Estrategias de redireccin** especficas para su entorno
3. **Acciones de "damage control"** para minimizar el impacto
4. **Tcnicas de prevencin** para la prxima vez
5. **Recordatorios motivacionales** conectados con sus metas especficas

### **{ESTRATEGIAS POR CONTEXTO}**
** Trabajo desde Casa:**
- Alternativas que no requieran salir
- Uso de elementos disponibles en casa
- Tcnicas que funcionen durante breaks laborales
- Actividades que mejoren energa para el trabajo

** Anti-Grasa Visceral:**
- Actividades que aceleren metabolismo
- Comportamientos que reduzcan cortisol
- Alternativas que promuevan hidratacin
- Acciones que no saboteena nutricin

** Disponibilidad Inmediata:**
- Acciones de 2-5 minutos mximo
- Sin preparacin especial requerida
- Que funcionen en cualquier momento del da
- Compatibles con horario de trabajo

### **{FORMATO DE RESPUESTA}**
Estructura tu intervencin as:

 **Alternativa Inmediata**
[Accin especfica que puede hacer AHORA mismo en lugar del hbito negativo]

 **Redireccin Inteligente**
[Estrategia para canalizar el impulso hacia algo productivo]

 **Damage Control**
[Qu hacer para minimizar el impacto si ya ocurri el hbito]

 **Conexin con Metas**
[Recordatorio especfico de cmo evitar este hbito lo acerca a sus objetivos]

 **Prevencin Futura**
[Estrategia especfica basada en su patrn histrico para evitar repeticin]

### **{CRITERIOS DE CALIDAD}**
- **Inmediatez**: Ejecutable en <5 minutos
- **Disponibilidad**: Sin recursos especiales
- **Especificidad**: Adaptado al hbito especfico registrado
- **Realismo**: Factible en su entorno de trabajo desde casa
- **Impacto**: Que contribuya positivamente a sus metas de salud

### **{CONSIDERACIONES ESPECIALES}**
Considera las tendencias previas del usuario para:
- Personalizar alternativas basadas en patrones histricos
- Sugerir estrategias que han funcionado antes
- Evitar recomendaciones que ya ha intentado sin xito
- Adaptar el nivel de intensidad de la intervencin

### **{ESTILO DE COMUNICACIN}**
S emptico pero orientado a la accin. No juzgues el comportamiento, enfcate en la solucin inmediata. Como Alexander es analtico, explica brevemente POR QU la alternativa es mejor, pero mantn el foco en QU hacer ahora. Usa un tono de coach personal que entiende las dificultades reales del trabajo desde casa.`+Ri}},statistics:{model:"gemini-2.5-flash",prompt:"Eres un coach personal experto en anlisis de comportamiento y bienestar, con conocimientos en Terapia Cognitivo-Conductual (TCC) y Terapia de Aceptacin y Compromiso (ACT). Analiza el siguiente resumen de actividad diaria. \\nTu objetivo es: \\n1. Identificar patrones de comportamiento significativos (positivos y negativos). \\n2. Analizar la conexin entre diferentes actividades (ej. cmo el ejercicio afecta el estado de nimo o la productividad). \\n3. Ofrecer recomendaciones accionables y personalizadas basadas en los principios de TCC y ACT para: \\n    a. Reforzar comportamientos positivos. \\n    b. Abordar comportamientos problemticos, sugiriendo alternativas y estrategias de manejo. \\n    c. Fomentar la aceptacin de pensamientos y emociones difciles, y el compromiso con acciones valiosas. \\n    d. Ayudar a identificar y reestructurar pensamientos negativos o poco tiles (TCC). \\n    e. Promover la flexibilidad psicolgica (ACT). \\n4. Proveer ideas para mejorar la descripcin de tareas, priorizacin y efectividad general, considerando el contexto del usuario (Alexander, ingeniero de sistemas, 31 aos, trabaja desde casa, busca reducir grasa visceral, mejorar hidratacin y optimizar productividad y bienestar). \\n5. Mantn un tono emptico, analtico y motivador. Utiliza un lenguaje claro y directo. \\n\\nFormato de respuesta sugerido: \\n** Anlisis General y Patrones:** \\n[Breve resumen de los patrones ms destacados del da, conexiones entre actividades y estado de nimo/productividad.] \\n\\n** Recomendaciones (TCC/ACT):** \\n   **Para [Comportamiento/Patrn Especfico]:** \\n    **Observacin:** [Descripcin del patrn] \\n    **Insight (TCC/ACT):** [Aplicacin de un principio de TCC/ACT, ej. identificacin de pensamiento automtico, defusin cognitiva, clarificacin de valores] \\n    **Accin Sugerida:** [Consejo prctico y accionable] \\n\\n** Mejoras para Tasks y Productividad:** \\n    **Para mejorar descripciones:** [Sugerencia especfica] \\n    **Para optimizar prioridades:** [Idea basada en el anlisis] \\n    **Para aumentar efectividad:** [Consejo adicional] \\n\\nRecuerda usar el contexto personal de Alexander para que las recomendaciones sean relevantes y efectivas. \\n"+Ri},dailyInsight:{model:"gemini-2.5-flash",prompt:`### **{ROL}**
Eres un coach personal especializado en anlisis de patrones comportamentales y optimizacin de rutinas diarias con experiencia en:
- Anlisis de datos de comportamiento para identificar patrones significativos
- Generacin de consejos personalizados basados en tendencias histricas
- Optimizacin de rutinas para profesionales que trabajan desde casa
- Integracin de metas de salud con productividad diaria

### **{CONTEXTO PERSONAL}**
**Perfil del Usuario: Alexander**
- Ingeniero de sistemas de 31 aos
- Trabajo sedentario desde casa, se levanta a las 6 AM
- Personalidad analtica, aprecia datos concretos y patrones
- Busca optimizar productividad y mantener consistencia en hbitos

### **{RESULTADO ESPERADO}**
Basndote en los patrones de comportamiento de los ltimos 7 das, genera:
1. **Un consejo especfico para HOY** que sea inmediatamente accionable
2. **Conexin directa** con patrones identificados y metas personales
3. **Timing perfecto** considerando que es temprano en la maana
4. **Accin concreta** que pueda realizar desde casa en los prximos 30 minutos

### **{CRITERIOS DE CALIDAD}**
- **Especificidad**: No consejos genricos, usar datos reales de patrones
- **Accionabilidad**: Que pueda ejecutarse inmediatamente desde casa
- **Relevancia**: Conectado directamente con sus metas de salud y productividad
- **Brevedad**: Mximo 2-3 oraciones, directo al punto
- **Personalizacin**: Considerar patrones nicos de Alexander

### **{REAS DE ENFOQUE PRIORITARIO}**
1. **Hidratacin crtica**: Meta 2.5L
2. **Consistencia de hbitos**: Especialmente fines de semana
3. **Energa para trabajo**: Mantener productividad desde casa
4. **Patrones de mejora**: Aprovechar momentum positivo
5. **Prevencin de retrocesos**: Identificar das de riesgo

### **{FORMATO REQUERIDO}**
Responde NICAMENTE en formato markdown limpio:
- Usa **negrita** para enfatizar puntos clave
- Usa *cursiva* para acciones especficas
- Mximo 3 oraciones en total
- Sin encabezados, solo el consejo directo
- Termina con una accin especfica si es relevante

### **{EJEMPLOS DE CALIDAD}**
**BUENO**: "Tus mejores das de productividad coinciden con **hidratacin temprana** de 600ml antes de las 9 AM. Hoy es martes y sueles tener menos energa, as que *bebe 300ml ahora* y elige tareas que requieran menos concentracin."

**MALO**: "Es importante mantener hbitos saludables y beber suficiente agua durante el da."

### **{CONSIDERACIONES ESPECIALES}**
- Si hay patrones negativos, enfocar en soluciones inmediatas
- Si hay tendencias positivas, reforzar y expandir
- Considerar da de la semana y patrones histricos especficos
- Priorizar acciones que tengan mayor impacto en sus metas crticas
- Mantener tono motivador pero realista

### **{ESTILO DE COMUNICACIN}**
Directo, basado en datos, emptico pero orientado a la accin. Como Alexander es analtico, usa referencias especficas a sus patrones. Evita motivacin superficial: enfcate en estrategias prcticas que funcionen para su contexto de trabajo desde casa.

`+Ri}},Lr=t=>Ic[t],bN=async(t,s,n)=>{var c,u,d,h,p,g,x,y;const r="AIzaSyAW4Ot-z7OH4ZR3OeaN7vcbkEDlWpo1aMY",a=`https://generativelanguage.googleapis.com/v1beta/models/${s.model}:generateContent`,o={contents:[{parts:[{text:s.prompt?`${s.prompt}

${t}`:t}]}],generationConfig:{temperature:(n==null?void 0:n.temperature)??((c=s.params)==null?void 0:c.temperature)??.7,topP:(n==null?void 0:n.topP)??((u=s.params)==null?void 0:u.top_p)??.8,maxOutputTokens:(n==null?void 0:n.maxOutputTokens)??4096,candidateCount:1}};try{const b=await fetch(`${a}?key=${r}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!b.ok){const w=await b.json().catch(()=>({}));throw new Error(`Error en la API de Gemini (${b.status}): ${((d=w.error)==null?void 0:d.message)||b.statusText}`)}const v=await b.json();if(!((y=(x=(g=(p=(h=v.candidates)==null?void 0:h[0])==null?void 0:p.content)==null?void 0:g.parts)==null?void 0:x[0])!=null&&y.text))throw new Error("Respuesta invlida de la API de Gemini");return v.candidates[0].content.parts[0].text.trim()}catch(b){throw b instanceof Error?b:new Error(`Error inesperado al generar respuesta AI: ${String(b)}`)}},Ap={cardio:{name:"Cardio",description:"Ejercicios cardiovasculares",icon:""},strength:{name:"Fuerza",description:"Ejercicios de fuerza y resistencia",icon:""},flexibility:{name:"Flexibilidad",description:"Ejercicios de estiramiento",icon:""}},so=[{id:1,name:"Pasos",icon:"",category:"cardio",targetMuscles:["piernas"],caloriesPerHour:200,description:"Registro de pasos diarios",stepsPerKm:1312},{id:2,name:"Trotar",icon:"",category:"cardio",targetMuscles:["piernas","core"],defaultDuration:30,caloriesPerHour:500,description:"Trote suave a ritmo constante",stepsPerKm:1200},{id:3,name:"Bicicleta",icon:"",category:"cardio",targetMuscles:["piernas","core"],defaultDuration:45,defaultDistance:1e4,caloriesPerHour:450,description:"Ciclismo recreativo"},{id:4,name:"Caminata",icon:"",category:"cardio",targetMuscles:["piernas"],defaultDuration:30,caloriesPerHour:250,description:"Caminata a paso moderado",stepsPerKm:1400},{id:5,name:"Natacin",icon:"",category:"cardio",targetMuscles:["todo el cuerpo"],defaultDuration:30,caloriesPerHour:550,description:"Natacin estilo libre"},{id:6,name:"Tenis",icon:"",category:"cardio",targetMuscles:["todo el cuerpo"],defaultDuration:60,caloriesPerHour:500,description:"Partido recreativo de tenis"},{id:7,name:"Abdominales",icon:"",category:"strength",targetMuscles:["abdominales","core"],defaultSets:3,defaultReps:15,caloriesPerHour:300,description:"Series de abdominales bsicos"},{id:8,name:"Pesas de mano",icon:"",category:"strength",targetMuscles:["brazos","hombros"],defaultSets:3,defaultReps:12,caloriesPerHour:250,description:"Ejercicios con mancuernas ligeras"},{id:9,name:"Flexiones",icon:"",category:"strength",targetMuscles:["pecho","trceps","hombros"],defaultSets:3,defaultReps:10,caloriesPerHour:350,description:"Flexiones de pecho (pushups)"},{id:10,name:"Sentadillas",icon:"",category:"strength",targetMuscles:["cudriceps","glteos","core"],defaultSets:3,defaultReps:12,caloriesPerHour:400,description:"Sentadillas sin peso adicional"},{id:11,name:"Burpees",icon:"",category:"strength",targetMuscles:["todo el cuerpo"],defaultSets:3,defaultReps:15,caloriesPerHour:700,description:"Ejercicio completo de cardio y fuerza"},{id:12,name:"Yoga",icon:"",category:"flexibility",targetMuscles:["todo el cuerpo"],defaultDuration:20,caloriesPerHour:250,description:"Rutina bsica de yoga"},{id:13,name:"Estiramientos",icon:"",category:"flexibility",targetMuscles:["todo el cuerpo"],defaultDuration:15,caloriesPerHour:150,description:"Rutina de estiramientos generales"}],X5={cardio:"bg-red-500",strength:"bg-blue-500",flexibility:"bg-green-500"},Z5=async(t,s)=>{var r;const n=Ie(t);try{const[a,i]=n.split("-"),o=`${a}-${i}`,c=ke(xe,"habits",`${s}_${o}`),u=await ot(c);let d={completed:0,total:0,completedList:[],missedList:[]};if(u.exists()){const se=u.data().habits||{},H=vn.length;let ie=0;const fe=[],le=[];vn.forEach(K=>{const de=`${K.id}_${n}`;se[de]?(ie++,fe.push(K.name)):le.push(K.name)}),d={completed:ie,total:H,completedList:fe,missedList:le}}const h=ke(xe,"moods",`${s}_${n}`),p=await ot(h);let g={average:0,entries:[],count:0};if(p.exists()){const se=p.data().moods||[];if(se.length>0){const H=se.reduce((ie,fe)=>{const le=fe.value||(()=>{const de=[{emoji:"",text:"Enamorado",value:10},{emoji:"",text:"Feliz",value:10},{emoji:"",text:"Energtico",value:10},{emoji:"",text:"Productivo",value:10},{emoji:"",text:"Confiado",value:9},{emoji:"",text:"Tranquilo",value:8},{emoji:"",text:"Pensativo",value:6},{emoji:"",text:"Aburrido",value:5},{emoji:"",text:"Pereza",value:4},{emoji:"",text:"Confundido",value:5},{emoji:"",text:"Nervioso",value:3},{emoji:"",text:"Abrumado",value:3},{emoji:"",text:"Frustracin",value:3},{emoji:"",text:"Ansioso",value:2},{emoji:"",text:"Cansado",value:2},{emoji:"",text:"Triste",value:1},{emoji:"",text:"Enojado",value:1},{emoji:"",text:"Enfermo",value:1}].find(je=>je.text===fe.text);return(de==null?void 0:de.value)??5})();return ie+le},0)/se.length;g={average:Math.round(H*10)/10,entries:se.map(ie=>({time:ie.time,mood:ie.text||"",emoji:ie.emoji||""})),count:se.length}}}const x=ke(xe,"energy",`${s}_${n}`),y=await ot(x);let b={average:0,entries:[],count:0};if(y.exists()){const se=y.data().entries||[];if(se.length>0){const H=se.reduce((ie,fe)=>ie+(fe.level||0),0)/se.length;b={average:Math.round(H*10)/10,entries:se.map(ie=>({time:ie.time,level:ie.level||0,comment:ie.comment||""})),count:se.length}}}const v=ke(xe,"exercises",`${s}_${n}`),w=await ot(v);let N={minutes:0,calories:0,types:[]};if(w.exists()){const se=w.data().exercises||[],H=se.reduce((le,K)=>le+(K.duration||0),0),ie=se.reduce((le,K)=>le+(K.calories||0),0),fe=se.map(le=>{const K=so.find(de=>de.id===le.exerciseId);return K?K.name:"Unknown"}).filter(le=>le!=="Unknown");N={minutes:H,calories:ie,types:[...new Set(fe)]}}const S=ke(xe,"water",`${s}_${n}`),E=await ot(S);let k={liters:0,entries:0};if(E.exists()){const se=E.data().drinks||[],ie=se.reduce((fe,le)=>fe+(le.amount||0),0)/1e3;k={liters:Math.round(ie*10)/10,entries:se.length}}const D=new Date(t);D.setHours(0,0,0,0);const T=new Date(t);T.setHours(23,59,59,999);const R=xn(Bt(xe,"tasks"),Et("userId","==",s),Et("completed","==",!0),Et("updatedAt",">=",ka.fromDate(D)),Et("updatedAt","<=",ka.fromDate(T))),O=await gn(R);let U={completed:0,pending:0,completedTitles:[]};const I=O.docs;U={completed:I.length,pending:0,completedTitles:I.map(X=>X.data().title||"").slice(0,5)};const _=ke(xe,"pomodoro",`${s}_${n}`),M=await ot(_);let W={sessions:0,minutes:0,completionRate:0};if(M.exists()){const se=M.data().sessions||[],H=se.length,ie=se.reduce((K,de)=>{const je=de.duration?Math.round(de.duration/60):0;return K+je},0),fe=H*25,le=fe>0?Math.min(100,ie/fe*100):0;W={sessions:H,minutes:ie,completionRate:Math.round(le*10)/10}}const B=ke(xe,"journal",`${s}_${n}`),P=await ot(B);let z={hasEntry:!1,wordCount:0};if(P.exists()){const se=P.data().text||"";z={hasEntry:se.length>0,wordCount:se.split(/\s+/).filter(H=>H.length>0).length}}const G=ke(xe,"negative-habits",`${s}_${o}`),ae=await ot(G);let Y={count:0,types:[]};if(ae.exists()){const se=((r=ae.data().habits)==null?void 0:r[n])||{},H=Object.entries(se).filter(([ie,fe])=>fe!==void 0);Y={count:H.length,types:H.map(([ie,fe])=>`Hbito Negativo ${ie}`).slice(0,3)}}return{date:n,habits:d,mood:g,energy:b,exercise:N,water:k,tasks:U,pomodoro:W,negativeHabits:Y,journal:z}}catch(a){return console.error("Error collecting day data:",a),{date:n,habits:{completed:0,total:0,completedList:[],missedList:[]},mood:{average:0,entries:[],count:0},energy:{average:0,entries:[],count:0},exercise:{minutes:0,calories:0,types:[]},water:{liters:0,entries:0},tasks:{completed:0,pending:0,completedTitles:[]},pomodoro:{sessions:0,minutes:0,completionRate:0},negativeHabits:{count:0,types:[]},journal:{hasEntry:!1,wordCount:0}}}},Q5=t=>{const s=t.map(J=>J.habits.completed/Math.max(J.habits.total,1)),n=s.reduce((J,ye)=>J+ye,0)/7,r=(s[5]+s[6])/2,a=s.slice(0,5).reduce((J,ye)=>J+ye,0)/5,o=t.flatMap(J=>J.habits.missedList).reduce((J,ye)=>(J[ye]=(J[ye]||0)+1,J),{}),c=Object.entries(o).sort(([,J],[,ye])=>ye-J).slice(0,2).map(([J])=>J);let u=`Promedio semanal de hbitos: ${Math.round(n*100)}%`;c.length>0&&(u+=`, ms olvidados: ${c.join(", ")}`),r<a-.2?u+=", con notable bajn en fines de semana":r>a+.1&&(u+=", mejor rendimiento en fines de semana");const d=t.map(J=>J.mood.average).filter(J=>J>0);let p=`Estado de nimo promedio: ${(d.length>0?d.reduce((J,ye)=>J+ye,0)/d.length:0).toFixed(1)}/10`;const g=t.map((J,ye)=>({day:["Lun","Mar","Mi","Jue","Vie","Sb","Dom"][ye],mood:J.mood.average})).filter(J=>J.mood>0&&J.mood<5).map(J=>J.day);g.length>0&&(p+=`, das difciles: ${g.join(", ")}`);const x=t.map(J=>J.energy.average).filter(J=>J>0),y=x.length>0?x.reduce((J,ye)=>J+ye,0)/x.length:0;let b=`Nivel de energa promedio: ${y.toFixed(1)}/5`;const v=t.map((J,ye)=>({day:["Lun","Mar","Mi","Jue","Vie","Sb","Dom"][ye],energy:J.energy.average})).filter(J=>J.energy>0&&J.energy<2.5).map(J=>J.day);v.length>0?b+=`, das con baja energa: ${v.join(", ")}`:y>=4&&(b+=" - excelente nivel energtico");const w=t.map(J=>J.exercise.minutes),N=w.reduce((J,ye)=>J+ye,0),S=w.filter(J=>J>0).length,k=t.flatMap(J=>J.exercise.types).reduce((J,ye)=>(J[ye]=(J[ye]||0)+1,J),{}),D=Object.entries(k).sort(([,J],[,ye])=>ye-J).slice(0,3).map(([J])=>J);let T=`${S}/7 das con ejercicio (${N} min total)`;D.length>0&&(T+=`, principales: ${D.join(", ")}`),S>=5?T+=" - excelente consistencia":S>=3?T+=" - buen ritmo":S>0?T+=" - necesita ms consistencia":T+=" - semana sedentaria";const O=t.map(J=>J.water.liters).reduce((J,ye)=>J+ye,0)/7;let U=`Hidratacin promedio: ${O.toFixed(1)}L/da`;O<1.5?U+=" - crtica, muy por debajo de la meta (2.5L)":O<2?U+=" - insuficiente, necesita mejorar":O>=2.5?U+=" - excelente, cumpliendo meta":U+=" - mejorando, cerca de la meta";const M=t.map(J=>J.tasks.completed).reduce((J,ye)=>J+ye,0)/7;let W=`Productividad: ${M.toFixed(1)} tareas/da promedio`;const B=t.map((J,ye)=>({day:["Lun","Mar","Mi","Jue","Vie","Sb","Dom"][ye],tasks:J.tasks.completed})).filter(J=>J.tasks>=Math.max(M*1.2,5)).map(J=>J.day);B.length>0&&(W+=`, mejores das: ${B.join(", ")}`);const P=t.map(J=>J.pomodoro.sessions),G=P.reduce((J,ye)=>J+ye,0)/7,Y=t.map(J=>J.pomodoro.minutes).reduce((J,ye)=>J+ye,0);let X=`Pomodoros: ${G.toFixed(1)} sesiones/da promedio (${Y} min total)`;const se=P.filter(J=>J>0).length;se>=5?X+=" - excelente consistencia en trabajo enfocado":se>=3?X+=" - buen uso de tcnica Pomodoro":se>0?X+=" - uso ocasional de trabajo enfocado":X+=" - sin trabajo enfocado registrado";const ie=t.map(J=>J.negativeHabits.count).reduce((J,ye)=>J+ye,0);let le=`Hbitos negativos: ${(ie/7).toFixed(1)} incidencias/da promedio`;const K=t.map((J,ye)=>({day:["Lun","Mar","Mi","Jue","Vie","Sb","Dom"][ye],count:J.negativeHabits.count})).filter(J=>J.count>2).map(J=>J.day);K.length>0?le+=`, das difciles: ${K.join(", ")}`:ie===0&&(le+=" - excelente autocontrol esta semana");const de=t.slice(-3),je=t.slice(0,4),ge=de.reduce((J,ye)=>J+ye.habits.completed/Math.max(ye.habits.total,1),0)/3,Se=je.reduce((J,ye)=>J+ye.habits.completed/Math.max(ye.habits.total,1),0)/4;let oe="";return ge>Se+.1?oe="Tendencia positiva: mejorando durante la semana":ge<Se-.1?oe="Tendencia descendente: perdiendo momentum":oe="Tendencia estable durante la semana",{habitsPattern:u,moodPattern:p,energyPattern:b,exercisePattern:T,hydrationPattern:U,productivityPattern:W,pomodoroPattern:X,negativeHabitsPattern:le,weeklyTrends:oe}},eL=(t,s,n)=>{const r=new Date,i=["domingo","lunes","martes","mircoles","jueves","viernes","sbado"][t.getDay()],o=r.getHours();let c="";o>=5&&o<12?c="Es temprano en la maana, momento ideal para establecer el tono del da.":o>=12&&o<18?c="Es medio da, buen momento para ajustar el curso del da.":c="Es tarde, momento de reflexionar y planificar.";const u=n[n.length-2];let d="";if(u){const h=u.habits.completedList.length>0?`Ayer completaste: ${u.habits.completedList.slice(0,3).join(", ")}`:"Ayer no completaste hbitos",p=u.mood.average>0?`Estado de nimo ayer: ${u.mood.average}/10`:"Sin registro de estado de nimo ayer",g=u.energy.average>0?`Nivel de energa ayer: ${u.energy.average}/5`:"Sin registro de energa ayer",x=u.exercise.minutes>0?`Ejercicio ayer: ${u.exercise.minutes}min (${u.exercise.types.join(", ")})`:"Sin ejercicio ayer",y=u.pomodoro.sessions>0?`Trabajo enfocado ayer: ${u.pomodoro.sessions} pomodoros (${u.pomodoro.minutes}min)`:"Sin trabajo enfocado ayer",b=u.negativeHabits.count>0?`Hbitos negativos ayer: ${u.negativeHabits.count} incidencias`:"Sin hbitos negativos ayer";d=`
### RENDIMIENTO RECIENTE
${h}
${p}
${g}
${x}
${y}
Hidratacin ayer: ${u.water.liters}L
Tareas completadas ayer: ${u.tasks.completed}
${b}`}return`
### CONTEXTO PERSONAL
Alexander, ingeniero de sistemas de 31 aos, trabaja desde casa. 
Se levanta a las 6 AM y necesita optimizar su da basndose en sus patrones reales.

### METAS PRINCIPALES
- Reducir grasa visceral (actualmente nivel 11)
- Alcanzar 2.5L de agua diaria
- Mantener alta productividad trabajando desde casa
- Consistencia en hbitos saludables

### ANLISIS DE PATRONES (LTIMOS 7 DAS)
**Hbitos:** ${s.habitsPattern}
**Estado de nimo:** ${s.moodPattern}
**Nivel de energa:** ${s.energyPattern}
**Ejercicio:** ${s.exercisePattern}
**Hidratacin:** ${s.hydrationPattern}
**Productividad:** ${s.productivityPattern}
**Trabajo enfocado:** ${s.pomodoroPattern}
**Hbitos negativos:** ${s.negativeHabitsPattern}
**Tendencia general:** ${s.weeklyTrends}
${d}

### CONTEXTO ACTUAL
Hoy es ${i}. ${c}

### INSTRUCCIONES
Genera UN consejo especfico y accionable para HOY que:
1. Aproveche los patrones positivos identificados
2. Aborde las reas ms crticas para sus metas
3. Sea realista para trabajo desde casa
4. Incluya una accin especfica que pueda hacer AHORA

Responde NICAMENTE en formato markdown limpio:
- Usa **negrita** para enfatizar puntos clave
- Usa *cursiva* para acciones especficas  
- Mximo 3 oraciones en total
- Sin encabezados, solo el consejo directo
- Termina con una accin especfica si es relevante
`},tL=async(t,s)=>{try{const n=[];for(let c=6;c>=0;c--){const u=HI(t,c),d=await Z5(u,s);n.push(d)}const r=Q5(n),a=eL(t,r,n),i=Lr("dailyInsight");if(!i)throw new Error("No AI config found for daily insights");return{content:(await bN(a,i)).trim(),prompt:a}}catch(n){console.error("Error generating daily insight:",n);const a=["domingo","lunes","martes","mircoles","jueves","viernes","sbado"][t.getDay()];return{content:{lunes:"Empieza la semana hidratndote bien (600ml ahora) y elige 1-2 tareas importantes para generar momentum.",martes:"Los martes sueles tener menos energa. Prioriza hidratacin y tareas que requieran menos concentracin.",mircoles:"Mitad de semana es tu momento fuerte. Aprovecha para las tareas ms desafiantes.",jueves:"Mantn el ritmo con agua constante y ejercicio ligero para preparar el fin de semana.",viernes:"Los viernes bajas el ritmo. Enfcate en completar pendientes importantes antes del fin de semana.",sbado:"Fin de semana: balance entre descanso y mantener hbitos bsicos (agua e hidratacin).",domingo:"Da de recuperacin. Planifica la prxima semana y mantn hbitos ligeros."}[a]||"Enfcate en hidratacin constante y mantn tus hbitos bsicos.",quickAction:"Beber 300ml agua",prompt:"Insight generado automticamente (modo fallback - no se utiliz IA)"}}},Hy="daily_insight",Uy=5,sL=t=>{const[s,n]=f.useState(null),[r,a]=f.useState(!1),[i,o]=f.useState(null),{user:c}=Je(),u=Ie(t),d=f.useCallback(y=>{if(!y||y.date!==u||!y.isValid)return!0;const b=new Date(y.generatedAt),v=new Date,w=new Date;return w.setHours(Uy,0,0,0),v>=w&&b<w},[u]),h=f.useCallback(()=>{try{const y=localStorage.getItem(`${Hy}_${u}`);if(!y)return null;const b=JSON.parse(y);return!b.content||!b.generatedAt||!b.date?null:b}catch(y){return console.error("Error loading cached insight:",y),null}},[u]),p=f.useCallback(y=>{try{localStorage.setItem(`${Hy}_${u}`,JSON.stringify(y))}catch(b){console.error("Error saving insight to cache:",b)}},[u]),g=f.useCallback(async()=>{if(!c)return o("Usuario no autenticado"),null;try{a(!0),o(null);const y=await tL(t,c.uid);if(!y)throw new Error("No se pudo generar el insight");const b={content:y.content,quickAction:y.quickAction,generatedAt:new Date().toISOString(),date:u,isValid:!0,prompt:y.prompt};return p(b),b}catch(y){const b=y instanceof Error?y.message:"Error desconocido";return console.error("Error generating insight:",y),o(b),null}finally{a(!1)}},[t,u,p,c]),x=f.useCallback(async()=>{const y=await g();y&&n(y)},[g]);return f.useEffect(()=>{(async()=>{const b=h();if(d(b)){const v=await g();v?n(v):b&&n(b)}else b&&n(b)})()},[u,h,d,g]),f.useEffect(()=>{const y=()=>{const v=new Date,w=new Date;if(w.setHours(Uy,0,0,0),v>=w){const N=h();d(N)&&x()}};y();const b=setInterval(y,9e5);return()=>clearInterval(b)},[u,h,d,x]),{insight:s,loading:r,error:i,regenerateInsight:x,lastPrompt:s==null?void 0:s.prompt}},kt=km,Dx=Am,nL=Dm,jN=f.forwardRef(({className:t,...s},n)=>e.jsx(Rl,{ref:n,className:ce("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s}));jN.displayName=Rl.displayName;const wt=f.forwardRef(({className:t,children:s,...n},r)=>e.jsxs(nL,{children:[e.jsx(jN,{}),e.jsxs(Ol,{ref:r,className:ce("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...n,children:[s,e.jsxs(ud,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(Ws,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));wt.displayName=Ol.displayName;const At=({className:t,...s})=>e.jsx("div",{className:ce("flex flex-col space-y-1.5 text-center sm:text-left",t),...s});At.displayName="DialogHeader";const Cn=({className:t,...s})=>e.jsx("div",{className:ce("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s});Cn.displayName="DialogFooter";const _t=f.forwardRef(({className:t,...s},n)=>e.jsx(Pl,{ref:n,className:ce("text-lg font-semibold leading-none tracking-tight",t),...s}));_t.displayName=Pl.displayName;const cn=f.forwardRef(({className:t,...s},n)=>e.jsx(Ml,{ref:n,className:ce("text-sm text-muted-foreground",t),...s}));cn.displayName=Ml.displayName;const rL=({date:t,variant:s="detailed",className:n})=>{const{insight:r,loading:a,error:i,regenerateInsight:o,lastPrompt:c}=sL(t),[u,d]=f.useState(!1),h=async()=>{await o()},p=g=>{const x=Ht.parse(g,{breaks:!0,gfm:!0});return{__html:xi.sanitize(x)}};return e.jsxs(Ir,{title:" Insight del Da",icon:Tu,variant:s,loading:a,className:n,children:[e.jsx("div",{className:"space-y-3",children:a?e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx(fs,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Generando insight personalizado..."})]})}):i?e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-600 mb-2",children:[e.jsx(Tu,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Error al generar insight"})]}),e.jsx("p",{className:"text-sm text-red-600 mb-3",children:i}),e.jsx("button",{type:"button",onClick:h,className:"text-sm text-red-700 hover:text-red-800 underline",children:"Intentar nuevamente"})]}):r?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"p-4 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:e.jsx(Tu,{className:"w-5 h-5 text-blue-600"})}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"text-sm text-blue-900 leading-relaxed prose prose-sm prose-blue max-w-none",dangerouslySetInnerHTML:p(r.content)})})]})}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 px-1",children:[e.jsx("span",{children:"Basado en tus ltimos 7 das"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:["Generado: ",new Date(r.generatedAt).toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[c&&e.jsx("button",{type:"button",onClick:()=>d(!0),className:"p-1 hover:bg-gray-100 rounded-md transition-colors",title:"Ver prompt enviado a la IA",children:e.jsx(Sl,{className:"w-3 h-3 text-gray-400 hover:text-gray-600"})}),e.jsx("button",{type:"button",onClick:h,className:"p-1 hover:bg-gray-100 rounded-md transition-colors",title:"Regenerar insight",children:e.jsx(ao,{className:"w-3 h-3 text-gray-400 hover:text-gray-600"})})]})]})]}),r.quickAction&&e.jsx("div",{className:"pt-2 border-t border-gray-100",children:e.jsx("button",{type:"button",className:ce("w-full p-2 text-sm font-medium rounded-md transition-colors","bg-green-50 text-green-700 hover:bg-green-100 border border-green-200"),onClick:()=>{console.log("Quick action:",r.quickAction)},children:r.quickAction})})]}):e.jsxs("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 mb-2",children:[e.jsx(Tu,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Sin insight disponible"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"No hay suficientes datos para generar un insight personalizado."}),e.jsx("button",{type:"button",onClick:h,className:"text-sm text-blue-600 hover:text-blue-700 underline",children:"Generar insight"})]})}),e.jsx(kt,{open:u,onOpenChange:d,children:e.jsxs(wt,{className:"max-w-4xl max-h-[80vh]",children:[e.jsxs(At,{children:[e.jsxs(_t,{className:"flex items-center gap-2",children:[e.jsx(Sl,{className:"w-5 h-5"}),"Prompt enviado a la IA"]}),e.jsx(cn,{children:"Este es el prompt completo que se envi al modelo de IA para generar el insight personalizado."})]}),e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"relative",children:e.jsx("pre",{className:"bg-gray-50 border rounded-lg p-4 text-sm font-mono leading-relaxed overflow-auto max-h-[50vh] whitespace-pre-wrap",children:c||"No hay prompt disponible"})})})]})})]})},aL=()=>{const[t,s]=f.useState(new Date);return E4(),e.jsxs(ln,{children:[e.jsx(La,{selectedDate:t,onChange:s}),e.jsx("div",{className:"mb-8",children:e.jsx(K5,{date:t,variant:"detailed"})}),e.jsx("div",{className:"mb-8",children:e.jsx(rL,{date:t,variant:"detailed"})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-4 xl:grid-cols-8 gap-4 mb-8",children:[e.jsx(R4,{date:t,variant:"compact"}),e.jsx(O4,{date:t,variant:"compact"}),e.jsx(P4,{date:t,variant:"compact"}),e.jsx(z5,{date:t,variant:"compact"}),e.jsx(W5,{date:t,variant:"compact"}),e.jsx(Y5,{date:t,variant:"compact"}),e.jsx(V5,{date:t,variant:"compact"}),e.jsx(G5,{date:t,variant:"compact"})]}),e.jsx("div",{className:"mb-8",children:e.jsx(q5,{date:t,variant:"detailed"})}),e.jsx("div",{className:"mb-8",children:e.jsx(J5,{date:t})}),e.jsx("div",{className:"mt-6",children:e.jsx(C4,{})})]})};function _p(t,[s,n]){return Math.min(n,Math.max(s,t))}function kx(t){const s=f.useRef({value:t,previous:t});return f.useMemo(()=>(s.current.value!==t&&(s.current.previous=s.current.value,s.current.value=t),s.current.previous),[t])}var iL=[" ","Enter","ArrowUp","ArrowDown"],oL=[" ","Enter"],Uo="Select",[Wm,Ym,lL]=AR(Uo),[Wl,uY]=za(Uo,[lL,Al]),Vm=Al(),[cL,mo]=Wl(Uo),[dL,uL]=Wl(Uo),wN=t=>{const{__scopeSelect:s,children:n,open:r,defaultOpen:a,onOpenChange:i,value:o,defaultValue:c,onValueChange:u,dir:d,name:h,autoComplete:p,disabled:g,required:x,form:y}=t,b=Vm(s),[v,w]=f.useState(null),[N,S]=f.useState(null),[E,k]=f.useState(!1),D=_m(d),[T,R]=Oa({prop:r,defaultProp:a??!1,onChange:i,caller:Uo}),[O,U]=Oa({prop:o,defaultProp:c,onChange:u,caller:Uo}),I=f.useRef(null),_=v?y||!!v.closest("form"):!0,[M,W]=f.useState(new Set),B=Array.from(M).map(P=>P.props.value).join(";");return e.jsx(Qp,{...b,children:e.jsxs(cL,{required:x,scope:s,trigger:v,onTriggerChange:w,valueNode:N,onValueNodeChange:S,valueNodeHasChildren:E,onValueNodeHasChildrenChange:k,contentId:_l(),value:O,onValueChange:U,open:T,onOpenChange:R,dir:D,triggerPointerDownPosRef:I,disabled:g,children:[e.jsx(Wm.Provider,{scope:s,children:e.jsx(dL,{scope:t.__scopeSelect,onNativeOptionAdd:f.useCallback(P=>{W(z=>new Set(z).add(P))},[]),onNativeOptionRemove:f.useCallback(P=>{W(z=>{const G=new Set(z);return G.delete(P),G})},[]),children:n})}),_?e.jsxs(VN,{"aria-hidden":!0,required:x,tabIndex:-1,name:h,autoComplete:p,value:O,onChange:P=>U(P.target.value),disabled:g,form:y,children:[O===void 0?e.jsx("option",{value:""}):null,Array.from(M)]},B):null]})})};wN.displayName=Uo;var NN="SelectTrigger",SN=f.forwardRef((t,s)=>{const{__scopeSelect:n,disabled:r=!1,...a}=t,i=Vm(n),o=mo(NN,n),c=o.disabled||r,u=bs(s,o.onTriggerChange),d=Ym(n),h=f.useRef("touch"),[p,g,x]=qN(b=>{const v=d().filter(S=>!S.disabled),w=v.find(S=>S.value===o.value),N=KN(v,b,w);N!==void 0&&o.onValueChange(N.value)}),y=b=>{c||(o.onOpenChange(!0),x()),b&&(o.triggerPointerDownPosRef.current={x:Math.round(b.pageX),y:Math.round(b.pageY)})};return e.jsx(Tm,{asChild:!0,...i,children:e.jsx(jt.button,{type:"button",role:"combobox","aria-controls":o.contentId,"aria-expanded":o.open,"aria-required":o.required,"aria-autocomplete":"none",dir:o.dir,"data-state":o.open?"open":"closed",disabled:c,"data-disabled":c?"":void 0,"data-placeholder":GN(o.value)?"":void 0,...a,ref:u,onClick:it(a.onClick,b=>{b.currentTarget.focus(),h.current!=="mouse"&&y(b)}),onPointerDown:it(a.onPointerDown,b=>{h.current=b.pointerType;const v=b.target;v.hasPointerCapture(b.pointerId)&&v.releasePointerCapture(b.pointerId),b.button===0&&b.ctrlKey===!1&&b.pointerType==="mouse"&&(y(b),b.preventDefault())}),onKeyDown:it(a.onKeyDown,b=>{const v=p.current!=="";!(b.ctrlKey||b.altKey||b.metaKey)&&b.key.length===1&&g(b.key),!(v&&b.key===" ")&&iL.includes(b.key)&&(y(),b.preventDefault())})})})});SN.displayName=NN;var CN="SelectValue",EN=f.forwardRef((t,s)=>{const{__scopeSelect:n,className:r,style:a,children:i,placeholder:o="",...c}=t,u=mo(CN,n),{onValueNodeHasChildrenChange:d}=u,h=i!==void 0,p=bs(s,u.onValueNodeChange);return pi(()=>{d(h)},[d,h]),e.jsx(jt.span,{...c,ref:p,style:{pointerEvents:"none"},children:GN(u.value)?e.jsx(e.Fragment,{children:o}):i})});EN.displayName=CN;var mL="SelectIcon",TN=f.forwardRef((t,s)=>{const{__scopeSelect:n,children:r,...a}=t;return e.jsx(jt.span,{"aria-hidden":!0,...a,ref:s,children:r||""})});TN.displayName=mL;var hL="SelectPortal",DN=t=>e.jsx(Ej,{asChild:!0,...t});DN.displayName=hL;var Wo="SelectContent",kN=f.forwardRef((t,s)=>{const n=mo(Wo,t.__scopeSelect),[r,a]=f.useState();if(pi(()=>{a(new DocumentFragment)},[]),!n.open){const i=r;return i?Ki.createPortal(e.jsx(AN,{scope:t.__scopeSelect,children:e.jsx(Wm.Slot,{scope:t.__scopeSelect,children:e.jsx("div",{children:t.children})})}),i):null}return e.jsx(_N,{...t,ref:s})});kN.displayName=Wo;var Kr=10,[AN,ho]=Wl(Wo),fL="SelectContentImpl",pL=Aj("SelectContent.RemoveScroll"),_N=f.forwardRef((t,s)=>{const{__scopeSelect:n,position:r="item-aligned",onCloseAutoFocus:a,onEscapeKeyDown:i,onPointerDownOutside:o,side:c,sideOffset:u,align:d,alignOffset:h,arrowPadding:p,collisionBoundary:g,collisionPadding:x,sticky:y,hideWhenDetached:b,avoidCollisions:v,...w}=t,N=mo(Wo,n),[S,E]=f.useState(null),[k,D]=f.useState(null),T=bs(s,K=>E(K)),[R,O]=f.useState(null),[U,I]=f.useState(null),_=Ym(n),[M,W]=f.useState(!1),B=f.useRef(!1);f.useEffect(()=>{if(S)return Tj(S)},[S]),Dj();const P=f.useCallback(K=>{const[de,...je]=_().map(oe=>oe.ref.current),[ge]=je.slice(-1),Se=document.activeElement;for(const oe of K)if(oe===Se||(oe==null||oe.scrollIntoView({block:"nearest"}),oe===de&&k&&(k.scrollTop=0),oe===ge&&k&&(k.scrollTop=k.scrollHeight),oe==null||oe.focus(),document.activeElement!==Se))return},[_,k]),z=f.useCallback(()=>P([R,S]),[P,R,S]);f.useEffect(()=>{M&&z()},[M,z]);const{onOpenChange:G,triggerPointerDownPosRef:ae}=N;f.useEffect(()=>{if(S){let K={x:0,y:0};const de=ge=>{var Se,oe;K={x:Math.abs(Math.round(ge.pageX)-(((Se=ae.current)==null?void 0:Se.x)??0)),y:Math.abs(Math.round(ge.pageY)-(((oe=ae.current)==null?void 0:oe.y)??0))}},je=ge=>{K.x<=10&&K.y<=10?ge.preventDefault():S.contains(ge.target)||G(!1),document.removeEventListener("pointermove",de),ae.current=null};return ae.current!==null&&(document.addEventListener("pointermove",de),document.addEventListener("pointerup",je,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",de),document.removeEventListener("pointerup",je,{capture:!0})}}},[S,G,ae]),f.useEffect(()=>{const K=()=>G(!1);return window.addEventListener("blur",K),window.addEventListener("resize",K),()=>{window.removeEventListener("blur",K),window.removeEventListener("resize",K)}},[G]);const[Y,X]=qN(K=>{const de=_().filter(Se=>!Se.disabled),je=de.find(Se=>Se.ref.current===document.activeElement),ge=KN(de,K,je);ge&&setTimeout(()=>ge.ref.current.focus())}),se=f.useCallback((K,de,je)=>{const ge=!B.current&&!je;(N.value!==void 0&&N.value===de||ge)&&(O(K),ge&&(B.current=!0))},[N.value]),H=f.useCallback(()=>S==null?void 0:S.focus(),[S]),ie=f.useCallback((K,de,je)=>{const ge=!B.current&&!je;(N.value!==void 0&&N.value===de||ge)&&I(K)},[N.value]),fe=r==="popper"?Rp:RN,le=fe===Rp?{side:c,sideOffset:u,align:d,alignOffset:h,arrowPadding:p,collisionBoundary:g,collisionPadding:x,sticky:y,hideWhenDetached:b,avoidCollisions:v}:{};return e.jsx(AN,{scope:n,content:S,viewport:k,onViewportChange:D,itemRefCallback:se,selectedItem:R,onItemLeave:H,itemTextRefCallback:ie,focusSelectedItem:z,selectedItemText:U,position:r,isPositioned:M,searchRef:Y,children:e.jsx(kj,{as:pL,allowPinchZoom:!0,children:e.jsx(_j,{asChild:!0,trapped:N.open,onMountAutoFocus:K=>{K.preventDefault()},onUnmountAutoFocus:it(a,K=>{var de;(de=N.trigger)==null||de.focus({preventScroll:!0}),K.preventDefault()}),children:e.jsx(Xp,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:K=>K.preventDefault(),onDismiss:()=>N.onOpenChange(!1),children:e.jsx(fe,{role:"listbox",id:N.contentId,"data-state":N.open?"open":"closed",dir:N.dir,onContextMenu:K=>K.preventDefault(),...w,...le,onPlaced:()=>W(!0),ref:T,style:{display:"flex",flexDirection:"column",outline:"none",...w.style},onKeyDown:it(w.onKeyDown,K=>{const de=K.ctrlKey||K.altKey||K.metaKey;if(K.key==="Tab"&&K.preventDefault(),!de&&K.key.length===1&&X(K.key),["ArrowUp","ArrowDown","Home","End"].includes(K.key)){let ge=_().filter(Se=>!Se.disabled).map(Se=>Se.ref.current);if(["ArrowUp","End"].includes(K.key)&&(ge=ge.slice().reverse()),["ArrowUp","ArrowDown"].includes(K.key)){const Se=K.target,oe=ge.indexOf(Se);ge=ge.slice(oe+1)}setTimeout(()=>P(ge)),K.preventDefault()}})})})})})})});_N.displayName=fL;var xL="SelectItemAlignedPosition",RN=f.forwardRef((t,s)=>{const{__scopeSelect:n,onPlaced:r,...a}=t,i=mo(Wo,n),o=ho(Wo,n),[c,u]=f.useState(null),[d,h]=f.useState(null),p=bs(s,T=>h(T)),g=Ym(n),x=f.useRef(!1),y=f.useRef(!0),{viewport:b,selectedItem:v,selectedItemText:w,focusSelectedItem:N}=o,S=f.useCallback(()=>{if(i.trigger&&i.valueNode&&c&&d&&b&&v&&w){const T=i.trigger.getBoundingClientRect(),R=d.getBoundingClientRect(),O=i.valueNode.getBoundingClientRect(),U=w.getBoundingClientRect();if(i.dir!=="rtl"){const Se=U.left-R.left,oe=O.left-Se,J=T.left-oe,ye=T.width+J,xt=Math.max(ye,R.width),gt=window.innerWidth-Kr,dt=_p(oe,[Kr,Math.max(Kr,gt-xt)]);c.style.minWidth=ye+"px",c.style.left=dt+"px"}else{const Se=R.right-U.right,oe=window.innerWidth-O.right-Se,J=window.innerWidth-T.right-oe,ye=T.width+J,xt=Math.max(ye,R.width),gt=window.innerWidth-Kr,dt=_p(oe,[Kr,Math.max(Kr,gt-xt)]);c.style.minWidth=ye+"px",c.style.right=dt+"px"}const I=g(),_=window.innerHeight-Kr*2,M=b.scrollHeight,W=window.getComputedStyle(d),B=parseInt(W.borderTopWidth,10),P=parseInt(W.paddingTop,10),z=parseInt(W.borderBottomWidth,10),G=parseInt(W.paddingBottom,10),ae=B+P+M+G+z,Y=Math.min(v.offsetHeight*5,ae),X=window.getComputedStyle(b),se=parseInt(X.paddingTop,10),H=parseInt(X.paddingBottom,10),ie=T.top+T.height/2-Kr,fe=_-ie,le=v.offsetHeight/2,K=v.offsetTop+le,de=B+P+K,je=ae-de;if(de<=ie){const Se=I.length>0&&v===I[I.length-1].ref.current;c.style.bottom="0px";const oe=d.clientHeight-b.offsetTop-b.offsetHeight,J=Math.max(fe,le+(Se?H:0)+oe+z),ye=de+J;c.style.height=ye+"px"}else{const Se=I.length>0&&v===I[0].ref.current;c.style.top="0px";const J=Math.max(ie,B+b.offsetTop+(Se?se:0)+le)+je;c.style.height=J+"px",b.scrollTop=de-ie+b.offsetTop}c.style.margin=`${Kr}px 0`,c.style.minHeight=Y+"px",c.style.maxHeight=_+"px",r==null||r(),requestAnimationFrame(()=>x.current=!0)}},[g,i.trigger,i.valueNode,c,d,b,v,w,i.dir,r]);pi(()=>S(),[S]);const[E,k]=f.useState();pi(()=>{d&&k(window.getComputedStyle(d).zIndex)},[d]);const D=f.useCallback(T=>{T&&y.current===!0&&(S(),N==null||N(),y.current=!1)},[S,N]);return e.jsx(vL,{scope:n,contentWrapper:c,shouldExpandOnScrollRef:x,onScrollButtonChange:D,children:e.jsx("div",{ref:u,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:E},children:e.jsx(jt.div,{...a,ref:p,style:{boxSizing:"border-box",maxHeight:"100%",...a.style}})})})});RN.displayName=xL;var gL="SelectPopperPosition",Rp=f.forwardRef((t,s)=>{const{__scopeSelect:n,align:r="start",collisionPadding:a=Kr,...i}=t,o=Vm(n);return e.jsx(Zp,{...o,...i,ref:s,align:r,collisionPadding:a,style:{boxSizing:"border-box",...i.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});Rp.displayName=gL;var[vL,Ax]=Wl(Wo,{}),Op="SelectViewport",ON=f.forwardRef((t,s)=>{const{__scopeSelect:n,nonce:r,...a}=t,i=ho(Op,n),o=Ax(Op,n),c=bs(s,i.onViewportChange),u=f.useRef(0);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:r}),e.jsx(Wm.Slot,{scope:n,children:e.jsx(jt.div,{"data-radix-select-viewport":"",role:"presentation",...a,ref:c,style:{position:"relative",flex:1,overflow:"hidden auto",...a.style},onScroll:it(a.onScroll,d=>{const h=d.currentTarget,{contentWrapper:p,shouldExpandOnScrollRef:g}=o;if(g!=null&&g.current&&p){const x=Math.abs(u.current-h.scrollTop);if(x>0){const y=window.innerHeight-Kr*2,b=parseFloat(p.style.minHeight),v=parseFloat(p.style.height),w=Math.max(b,v);if(w<y){const N=w+x,S=Math.min(y,N),E=N-S;p.style.height=S+"px",p.style.bottom==="0px"&&(h.scrollTop=E>0?E:0,p.style.justifyContent="flex-end")}}}u.current=h.scrollTop})})})]})});ON.displayName=Op;var PN="SelectGroup",[yL,bL]=Wl(PN),jL=f.forwardRef((t,s)=>{const{__scopeSelect:n,...r}=t,a=_l();return e.jsx(yL,{scope:n,id:a,children:e.jsx(jt.div,{role:"group","aria-labelledby":a,...r,ref:s})})});jL.displayName=PN;var MN="SelectLabel",IN=f.forwardRef((t,s)=>{const{__scopeSelect:n,...r}=t,a=bL(MN,n);return e.jsx(jt.div,{id:a.id,...r,ref:s})});IN.displayName=MN;var dm="SelectItem",[wL,LN]=Wl(dm),$N=f.forwardRef((t,s)=>{const{__scopeSelect:n,value:r,disabled:a=!1,textValue:i,...o}=t,c=mo(dm,n),u=ho(dm,n),d=c.value===r,[h,p]=f.useState(i??""),[g,x]=f.useState(!1),y=bs(s,N=>{var S;return(S=u.itemRefCallback)==null?void 0:S.call(u,N,r,a)}),b=_l(),v=f.useRef("touch"),w=()=>{a||(c.onValueChange(r),c.onOpenChange(!1))};if(r==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return e.jsx(wL,{scope:n,value:r,disabled:a,textId:b,isSelected:d,onItemTextChange:f.useCallback(N=>{p(S=>S||((N==null?void 0:N.textContent)??"").trim())},[]),children:e.jsx(Wm.ItemSlot,{scope:n,value:r,disabled:a,textValue:h,children:e.jsx(jt.div,{role:"option","aria-labelledby":b,"data-highlighted":g?"":void 0,"aria-selected":d&&g,"data-state":d?"checked":"unchecked","aria-disabled":a||void 0,"data-disabled":a?"":void 0,tabIndex:a?void 0:-1,...o,ref:y,onFocus:it(o.onFocus,()=>x(!0)),onBlur:it(o.onBlur,()=>x(!1)),onClick:it(o.onClick,()=>{v.current!=="mouse"&&w()}),onPointerUp:it(o.onPointerUp,()=>{v.current==="mouse"&&w()}),onPointerDown:it(o.onPointerDown,N=>{v.current=N.pointerType}),onPointerMove:it(o.onPointerMove,N=>{var S;v.current=N.pointerType,a?(S=u.onItemLeave)==null||S.call(u):v.current==="mouse"&&N.currentTarget.focus({preventScroll:!0})}),onPointerLeave:it(o.onPointerLeave,N=>{var S;N.currentTarget===document.activeElement&&((S=u.onItemLeave)==null||S.call(u))}),onKeyDown:it(o.onKeyDown,N=>{var E;((E=u.searchRef)==null?void 0:E.current)!==""&&N.key===" "||(oL.includes(N.key)&&w(),N.key===" "&&N.preventDefault())})})})})});$N.displayName=dm;var Lc="SelectItemText",zN=f.forwardRef((t,s)=>{const{__scopeSelect:n,className:r,style:a,...i}=t,o=mo(Lc,n),c=ho(Lc,n),u=LN(Lc,n),d=uL(Lc,n),[h,p]=f.useState(null),g=bs(s,w=>p(w),u.onItemTextChange,w=>{var N;return(N=c.itemTextRefCallback)==null?void 0:N.call(c,w,u.value,u.disabled)}),x=h==null?void 0:h.textContent,y=f.useMemo(()=>e.jsx("option",{value:u.value,disabled:u.disabled,children:x},u.value),[u.disabled,u.value,x]),{onNativeOptionAdd:b,onNativeOptionRemove:v}=d;return pi(()=>(b(y),()=>v(y)),[b,v,y]),e.jsxs(e.Fragment,{children:[e.jsx(jt.span,{id:u.textId,...i,ref:g}),u.isSelected&&o.valueNode&&!o.valueNodeHasChildren?Ki.createPortal(i.children,o.valueNode):null]})});zN.displayName=Lc;var FN="SelectItemIndicator",BN=f.forwardRef((t,s)=>{const{__scopeSelect:n,...r}=t;return LN(FN,n).isSelected?e.jsx(jt.span,{"aria-hidden":!0,...r,ref:s}):null});BN.displayName=FN;var Pp="SelectScrollUpButton",HN=f.forwardRef((t,s)=>{const n=ho(Pp,t.__scopeSelect),r=Ax(Pp,t.__scopeSelect),[a,i]=f.useState(!1),o=bs(s,r.onScrollButtonChange);return pi(()=>{if(n.viewport&&n.isPositioned){let c=function(){const d=u.scrollTop>0;i(d)};const u=n.viewport;return c(),u.addEventListener("scroll",c),()=>u.removeEventListener("scroll",c)}},[n.viewport,n.isPositioned]),a?e.jsx(WN,{...t,ref:o,onAutoScroll:()=>{const{viewport:c,selectedItem:u}=n;c&&u&&(c.scrollTop=c.scrollTop-u.offsetHeight)}}):null});HN.displayName=Pp;var Mp="SelectScrollDownButton",UN=f.forwardRef((t,s)=>{const n=ho(Mp,t.__scopeSelect),r=Ax(Mp,t.__scopeSelect),[a,i]=f.useState(!1),o=bs(s,r.onScrollButtonChange);return pi(()=>{if(n.viewport&&n.isPositioned){let c=function(){const d=u.scrollHeight-u.clientHeight,h=Math.ceil(u.scrollTop)<d;i(h)};const u=n.viewport;return c(),u.addEventListener("scroll",c),()=>u.removeEventListener("scroll",c)}},[n.viewport,n.isPositioned]),a?e.jsx(WN,{...t,ref:o,onAutoScroll:()=>{const{viewport:c,selectedItem:u}=n;c&&u&&(c.scrollTop=c.scrollTop+u.offsetHeight)}}):null});UN.displayName=Mp;var WN=f.forwardRef((t,s)=>{const{__scopeSelect:n,onAutoScroll:r,...a}=t,i=ho("SelectScrollButton",n),o=f.useRef(null),c=Ym(n),u=f.useCallback(()=>{o.current!==null&&(window.clearInterval(o.current),o.current=null)},[]);return f.useEffect(()=>()=>u(),[u]),pi(()=>{var h;const d=c().find(p=>p.ref.current===document.activeElement);(h=d==null?void 0:d.ref.current)==null||h.scrollIntoView({block:"nearest"})},[c]),e.jsx(jt.div,{"aria-hidden":!0,...a,ref:s,style:{flexShrink:0,...a.style},onPointerDown:it(a.onPointerDown,()=>{o.current===null&&(o.current=window.setInterval(r,50))}),onPointerMove:it(a.onPointerMove,()=>{var d;(d=i.onItemLeave)==null||d.call(i),o.current===null&&(o.current=window.setInterval(r,50))}),onPointerLeave:it(a.onPointerLeave,()=>{u()})})}),NL="SelectSeparator",YN=f.forwardRef((t,s)=>{const{__scopeSelect:n,...r}=t;return e.jsx(jt.div,{"aria-hidden":!0,...r,ref:s})});YN.displayName=NL;var Ip="SelectArrow",SL=f.forwardRef((t,s)=>{const{__scopeSelect:n,...r}=t,a=Vm(n),i=mo(Ip,n),o=ho(Ip,n);return i.open&&o.position==="popper"?e.jsx(ex,{...a,...r,ref:s}):null});SL.displayName=Ip;var CL="SelectBubbleInput",VN=f.forwardRef(({__scopeSelect:t,value:s,...n},r)=>{const a=f.useRef(null),i=bs(r,a),o=kx(s);return f.useEffect(()=>{const c=a.current;if(!c)return;const u=window.HTMLSelectElement.prototype,h=Object.getOwnPropertyDescriptor(u,"value").set;if(o!==s&&h){const p=new Event("change",{bubbles:!0});h.call(c,s),c.dispatchEvent(p)}},[o,s]),e.jsx(jt.select,{...n,style:{..._w,...n.style},ref:i,defaultValue:s})});VN.displayName=CL;function GN(t){return t===""||t===void 0}function qN(t){const s=Vi(t),n=f.useRef(""),r=f.useRef(0),a=f.useCallback(o=>{const c=n.current+o;s(c),function u(d){n.current=d,window.clearTimeout(r.current),d!==""&&(r.current=window.setTimeout(()=>u(""),1e3))}(c)},[s]),i=f.useCallback(()=>{n.current="",window.clearTimeout(r.current)},[]);return f.useEffect(()=>()=>window.clearTimeout(r.current),[]),[n,a,i]}function KN(t,s,n){const a=s.length>1&&Array.from(s).every(d=>d===s[0])?s[0]:s,i=n?t.indexOf(n):-1;let o=EL(t,Math.max(i,0));a.length===1&&(o=o.filter(d=>d!==n));const u=o.find(d=>d.textValue.toLowerCase().startsWith(a.toLowerCase()));return u!==n?u:void 0}function EL(t,s){return t.map((n,r)=>t[(s+r)%t.length])}var TL=wN,JN=SN,DL=EN,kL=TN,AL=DN,XN=kN,_L=ON,ZN=IN,QN=$N,RL=zN,OL=BN,eS=HN,tS=UN,sS=YN;const Tt=TL,Dt=DL,vt=f.forwardRef(({className:t,children:s,...n},r)=>e.jsxs(JN,{ref:r,className:ce("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...n,children:[s,e.jsx(kL,{asChild:!0,children:e.jsx(Gn,{className:"h-4 w-4 opacity-50"})})]}));vt.displayName=JN.displayName;const nS=f.forwardRef(({className:t,...s},n)=>e.jsx(eS,{ref:n,className:ce("flex cursor-default items-center justify-center py-1",t),...s,children:e.jsx(Fo,{className:"h-4 w-4"})}));nS.displayName=eS.displayName;const rS=f.forwardRef(({className:t,...s},n)=>e.jsx(tS,{ref:n,className:ce("flex cursor-default items-center justify-center py-1",t),...s,children:e.jsx(Gn,{className:"h-4 w-4"})}));rS.displayName=tS.displayName;const yt=f.forwardRef(({className:t,children:s,position:n="popper",...r},a)=>e.jsx(AL,{children:e.jsxs(XN,{ref:a,className:ce("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:n,...r,children:[e.jsx(nS,{}),e.jsx(_L,{className:ce("p-1",n==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),e.jsx(rS,{})]})}));yt.displayName=XN.displayName;const PL=f.forwardRef(({className:t,...s},n)=>e.jsx(ZN,{ref:n,className:ce("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...s}));PL.displayName=ZN.displayName;const Pe=f.forwardRef(({className:t,children:s,...n},r)=>e.jsxs(QN,{ref:r,className:ce("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(OL,{children:e.jsx(Fa,{className:"h-4 w-4"})})}),e.jsx(RL,{children:s})]}));Pe.displayName=QN.displayName;const ML=f.forwardRef(({className:t,...s},n)=>e.jsx(sS,{ref:n,className:ce("-mx-1 my-1 h-px bg-muted",t),...s}));ML.displayName=sS.displayName;const Wy={lastMonth:{label:"ltimo mes",getValue:t=>({start:ls(Mc(t,1)),end:vr(Mc(t,1))})},currentMonth:{label:"Mes actual",getValue:t=>({start:ls(t),end:vr(t)})},last3Months:{label:"ltimos 3 meses",getValue:t=>({start:ls(Mc(t,2)),end:vr(t)})},last6Months:{label:"ltimos 6 meses",getValue:t=>({start:ls(Mc(t,5)),end:vr(t)})},lastYear:{label:"ltimo ao",getValue:t=>({start:rp(sy(t)),end:ty(sy(t))})},currentYear:{label:"Ao actual",getValue:t=>({start:rp(t),end:ty(t)})}},IL=({onPeriodChange:t})=>{const s=n=>{const r=new Date,a=Wy[n];if(a){const{start:i,end:o}=a.getValue(r);t(i,o)}};return e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("span",{className:"text-sm font-medium",children:"Mostrar perodo:"}),e.jsxs(Tt,{onValueChange:s,defaultValue:"currentMonth",children:[e.jsx(vt,{className:"w-[180px]",children:e.jsx(Dt,{placeholder:"Seleccionar perodo"})}),e.jsx(yt,{children:Object.entries(Wy).map(([n,{label:r}])=>e.jsx(Pe,{value:n,children:r},n))})]})]})},Ce=f.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:ce("rounded-lg border bg-card text-card-foreground shadow-sm overflow-hidden",t),...s}));Ce.displayName="Card";const Kt=f.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:ce("flex flex-col space-y-1.5 p-4 md:p-6",t),...s}));Kt.displayName="CardHeader";const Gt=f.forwardRef(({className:t,...s},n)=>e.jsx("h3",{ref:n,className:ce("text-lg md:text-2xl font-semibold leading-none tracking-tight",t),...s}));Gt.displayName="CardTitle";const Gi=f.forwardRef(({className:t,...s},n)=>e.jsx("p",{ref:n,className:ce("text-sm md:text-base text-muted-foreground",t),...s}));Gi.displayName="CardDescription";const Ae=f.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:ce("p-4 md:p-6 pt-0",t),...s}));Ae.displayName="CardContent";const In=f.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:ce("flex items-center p-4 md:p-6 pt-0",t),...s}));In.displayName="CardFooter";var um={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */um.exports;(function(t,s){(function(){var n,r="4.17.21",a=200,i="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",o="Expected a function",c="Invalid `variable` option passed into `_.template`",u="__lodash_hash_undefined__",d=500,h="__lodash_placeholder__",p=1,g=2,x=4,y=1,b=2,v=1,w=2,N=4,S=8,E=16,k=32,D=64,T=128,R=256,O=512,U=30,I="...",_=800,M=16,W=1,B=2,P=3,z=1/0,G=9007199254740991,ae=17976931348623157e292,Y=NaN,X=4294967295,se=X-1,H=X>>>1,ie=[["ary",T],["bind",v],["bindKey",w],["curry",S],["curryRight",E],["flip",O],["partial",k],["partialRight",D],["rearg",R]],fe="[object Arguments]",le="[object Array]",K="[object AsyncFunction]",de="[object Boolean]",je="[object Date]",ge="[object DOMException]",Se="[object Error]",oe="[object Function]",J="[object GeneratorFunction]",ye="[object Map]",xt="[object Number]",gt="[object Null]",dt="[object Object]",qs="[object Promise]",Ss="[object Proxy]",q="[object RegExp]",ne="[object Set]",me="[object String]",Te="[object Symbol]",Ee="[object Undefined]",Ne="[object WeakMap]",Re="[object WeakSet]",qe="[object ArrayBuffer]",st="[object DataView]",es="[object Float32Array]",Os="[object Float64Array]",qt="[object Int8Array]",tn="[object Int16Array]",Ks="[object Int32Array]",ds="[object Uint8Array]",zs="[object Uint8ClampedArray]",Ps="[object Uint16Array]",$n="[object Uint32Array]",Ve=/\b__p \+= '';/g,ut=/\b(__p \+=) '' \+/g,Nt=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Ut=/&(?:amp|lt|gt|quot|#39);/g,Ge=/[&<>"']/g,ft=RegExp(Ut.source),Lt=RegExp(Ge.source),_e=/<%-([\s\S]+?)%>/g,Be=/<%([\s\S]+?)%>/g,Xe=/<%=([\s\S]+?)%>/g,Rt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,$t=/^\w*$/,Ot=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,xs=/[\\^$.*+?()[\]{}|]/g,gs=RegExp(xs.source),Wt=/^\s+/,Jn=/\s/,wa=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,dr=/\{\n\/\* \[wrapped with (.+)\] \*/,Fr=/,? & /,bi=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Br=/[()=,{}\[\]\/\s]/,Md=/\\(\\)?/g,Id=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Xl=/\w*$/,Ld=/^[-+]0x[0-9a-f]+$/i,uh=/^0b[01]+$/i,Ke=/^\[object .+?Constructor\]$/,Q=/^0o[0-7]+$/i,De=/^(?:0|[1-9]\d*)$/,He=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,as=/($^)/,dn=/['\n\r\u2028\u2029\\]/g,Cs="\\ud800-\\udfff",En="\\u0300-\\u036f",Hr="\\ufe20-\\ufe2f",go="\\u20d0-\\u20ff",Xo=En+Hr+go,sn="\\u2700-\\u27bf",Zl="a-z\\xdf-\\xf6\\xf8-\\xff",$d="\\xac\\xb1\\xd7\\xf7",SE="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",CE="\\u2000-\\u206f",EE=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",_g="A-Z\\xc0-\\xd6\\xd8-\\xde",Rg="\\ufe0e\\ufe0f",Og=$d+SE+CE+EE,mh="[']",TE="["+Cs+"]",Pg="["+Og+"]",zd="["+Xo+"]",Mg="\\d+",DE="["+sn+"]",Ig="["+Zl+"]",Lg="[^"+Cs+Og+Mg+sn+Zl+_g+"]",hh="\\ud83c[\\udffb-\\udfff]",kE="(?:"+zd+"|"+hh+")",$g="[^"+Cs+"]",fh="(?:\\ud83c[\\udde6-\\uddff]){2}",ph="[\\ud800-\\udbff][\\udc00-\\udfff]",Zo="["+_g+"]",zg="\\u200d",Fg="(?:"+Ig+"|"+Lg+")",AE="(?:"+Zo+"|"+Lg+")",Bg="(?:"+mh+"(?:d|ll|m|re|s|t|ve))?",Hg="(?:"+mh+"(?:D|LL|M|RE|S|T|VE))?",Ug=kE+"?",Wg="["+Rg+"]?",_E="(?:"+zg+"(?:"+[$g,fh,ph].join("|")+")"+Wg+Ug+")*",RE="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",OE="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Yg=Wg+Ug+_E,PE="(?:"+[DE,fh,ph].join("|")+")"+Yg,ME="(?:"+[$g+zd+"?",zd,fh,ph,TE].join("|")+")",IE=RegExp(mh,"g"),LE=RegExp(zd,"g"),xh=RegExp(hh+"(?="+hh+")|"+ME+Yg,"g"),$E=RegExp([Zo+"?"+Ig+"+"+Bg+"(?="+[Pg,Zo,"$"].join("|")+")",AE+"+"+Hg+"(?="+[Pg,Zo+Fg,"$"].join("|")+")",Zo+"?"+Fg+"+"+Bg,Zo+"+"+Hg,OE,RE,Mg,PE].join("|"),"g"),zE=RegExp("["+zg+Cs+Xo+Rg+"]"),FE=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,BE=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],HE=-1,ws={};ws[es]=ws[Os]=ws[qt]=ws[tn]=ws[Ks]=ws[ds]=ws[zs]=ws[Ps]=ws[$n]=!0,ws[fe]=ws[le]=ws[qe]=ws[de]=ws[st]=ws[je]=ws[Se]=ws[oe]=ws[ye]=ws[xt]=ws[dt]=ws[q]=ws[ne]=ws[me]=ws[Ne]=!1;var vs={};vs[fe]=vs[le]=vs[qe]=vs[st]=vs[de]=vs[je]=vs[es]=vs[Os]=vs[qt]=vs[tn]=vs[Ks]=vs[ye]=vs[xt]=vs[dt]=vs[q]=vs[ne]=vs[me]=vs[Te]=vs[ds]=vs[zs]=vs[Ps]=vs[$n]=!0,vs[Se]=vs[oe]=vs[Ne]=!1;var UE={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},WE={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},YE={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},VE={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},GE=parseFloat,qE=parseInt,Vg=typeof fc=="object"&&fc&&fc.Object===Object&&fc,KE=typeof self=="object"&&self&&self.Object===Object&&self,yn=Vg||KE||Function("return this")(),gh=s&&!s.nodeType&&s,vo=gh&&!0&&t&&!t.nodeType&&t,Gg=vo&&vo.exports===gh,vh=Gg&&Vg.process,wr=function(){try{var te=vo&&vo.require&&vo.require("util").types;return te||vh&&vh.binding&&vh.binding("util")}catch{}}(),qg=wr&&wr.isArrayBuffer,Kg=wr&&wr.isDate,Jg=wr&&wr.isMap,Xg=wr&&wr.isRegExp,Zg=wr&&wr.isSet,Qg=wr&&wr.isTypedArray;function ur(te,pe,ue){switch(ue.length){case 0:return te.call(pe);case 1:return te.call(pe,ue[0]);case 2:return te.call(pe,ue[0],ue[1]);case 3:return te.call(pe,ue[0],ue[1],ue[2])}return te.apply(pe,ue)}function JE(te,pe,ue,$e){for(var rt=-1,Jt=te==null?0:te.length;++rt<Jt;){var nn=te[rt];pe($e,nn,ue(nn),te)}return $e}function Nr(te,pe){for(var ue=-1,$e=te==null?0:te.length;++ue<$e&&pe(te[ue],ue,te)!==!1;);return te}function XE(te,pe){for(var ue=te==null?0:te.length;ue--&&pe(te[ue],ue,te)!==!1;);return te}function e0(te,pe){for(var ue=-1,$e=te==null?0:te.length;++ue<$e;)if(!pe(te[ue],ue,te))return!1;return!0}function ji(te,pe){for(var ue=-1,$e=te==null?0:te.length,rt=0,Jt=[];++ue<$e;){var nn=te[ue];pe(nn,ue,te)&&(Jt[rt++]=nn)}return Jt}function Fd(te,pe){var ue=te==null?0:te.length;return!!ue&&Qo(te,pe,0)>-1}function yh(te,pe,ue){for(var $e=-1,rt=te==null?0:te.length;++$e<rt;)if(ue(pe,te[$e]))return!0;return!1}function Es(te,pe){for(var ue=-1,$e=te==null?0:te.length,rt=Array($e);++ue<$e;)rt[ue]=pe(te[ue],ue,te);return rt}function wi(te,pe){for(var ue=-1,$e=pe.length,rt=te.length;++ue<$e;)te[rt+ue]=pe[ue];return te}function bh(te,pe,ue,$e){var rt=-1,Jt=te==null?0:te.length;for($e&&Jt&&(ue=te[++rt]);++rt<Jt;)ue=pe(ue,te[rt],rt,te);return ue}function ZE(te,pe,ue,$e){var rt=te==null?0:te.length;for($e&&rt&&(ue=te[--rt]);rt--;)ue=pe(ue,te[rt],rt,te);return ue}function jh(te,pe){for(var ue=-1,$e=te==null?0:te.length;++ue<$e;)if(pe(te[ue],ue,te))return!0;return!1}var QE=wh("length");function eT(te){return te.split("")}function tT(te){return te.match(bi)||[]}function t0(te,pe,ue){var $e;return ue(te,function(rt,Jt,nn){if(pe(rt,Jt,nn))return $e=Jt,!1}),$e}function Bd(te,pe,ue,$e){for(var rt=te.length,Jt=ue+($e?1:-1);$e?Jt--:++Jt<rt;)if(pe(te[Jt],Jt,te))return Jt;return-1}function Qo(te,pe,ue){return pe===pe?hT(te,pe,ue):Bd(te,s0,ue)}function sT(te,pe,ue,$e){for(var rt=ue-1,Jt=te.length;++rt<Jt;)if($e(te[rt],pe))return rt;return-1}function s0(te){return te!==te}function n0(te,pe){var ue=te==null?0:te.length;return ue?Sh(te,pe)/ue:Y}function wh(te){return function(pe){return pe==null?n:pe[te]}}function Nh(te){return function(pe){return te==null?n:te[pe]}}function r0(te,pe,ue,$e,rt){return rt(te,function(Jt,nn,us){ue=$e?($e=!1,Jt):pe(ue,Jt,nn,us)}),ue}function nT(te,pe){var ue=te.length;for(te.sort(pe);ue--;)te[ue]=te[ue].value;return te}function Sh(te,pe){for(var ue,$e=-1,rt=te.length;++$e<rt;){var Jt=pe(te[$e]);Jt!==n&&(ue=ue===n?Jt:ue+Jt)}return ue}function Ch(te,pe){for(var ue=-1,$e=Array(te);++ue<te;)$e[ue]=pe(ue);return $e}function rT(te,pe){return Es(pe,function(ue){return[ue,te[ue]]})}function a0(te){return te&&te.slice(0,c0(te)+1).replace(Wt,"")}function mr(te){return function(pe){return te(pe)}}function Eh(te,pe){return Es(pe,function(ue){return te[ue]})}function Ql(te,pe){return te.has(pe)}function i0(te,pe){for(var ue=-1,$e=te.length;++ue<$e&&Qo(pe,te[ue],0)>-1;);return ue}function o0(te,pe){for(var ue=te.length;ue--&&Qo(pe,te[ue],0)>-1;);return ue}function aT(te,pe){for(var ue=te.length,$e=0;ue--;)te[ue]===pe&&++$e;return $e}var iT=Nh(UE),oT=Nh(WE);function lT(te){return"\\"+VE[te]}function cT(te,pe){return te==null?n:te[pe]}function el(te){return zE.test(te)}function dT(te){return FE.test(te)}function uT(te){for(var pe,ue=[];!(pe=te.next()).done;)ue.push(pe.value);return ue}function Th(te){var pe=-1,ue=Array(te.size);return te.forEach(function($e,rt){ue[++pe]=[rt,$e]}),ue}function l0(te,pe){return function(ue){return te(pe(ue))}}function Ni(te,pe){for(var ue=-1,$e=te.length,rt=0,Jt=[];++ue<$e;){var nn=te[ue];(nn===pe||nn===h)&&(te[ue]=h,Jt[rt++]=ue)}return Jt}function Hd(te){var pe=-1,ue=Array(te.size);return te.forEach(function($e){ue[++pe]=$e}),ue}function mT(te){var pe=-1,ue=Array(te.size);return te.forEach(function($e){ue[++pe]=[$e,$e]}),ue}function hT(te,pe,ue){for(var $e=ue-1,rt=te.length;++$e<rt;)if(te[$e]===pe)return $e;return-1}function fT(te,pe,ue){for(var $e=ue+1;$e--;)if(te[$e]===pe)return $e;return $e}function tl(te){return el(te)?xT(te):QE(te)}function Ur(te){return el(te)?gT(te):eT(te)}function c0(te){for(var pe=te.length;pe--&&Jn.test(te.charAt(pe)););return pe}var pT=Nh(YE);function xT(te){for(var pe=xh.lastIndex=0;xh.test(te);)++pe;return pe}function gT(te){return te.match(xh)||[]}function vT(te){return te.match($E)||[]}var yT=function te(pe){pe=pe==null?yn:sl.defaults(yn.Object(),pe,sl.pick(yn,BE));var ue=pe.Array,$e=pe.Date,rt=pe.Error,Jt=pe.Function,nn=pe.Math,us=pe.Object,Dh=pe.RegExp,bT=pe.String,Sr=pe.TypeError,Ud=ue.prototype,jT=Jt.prototype,nl=us.prototype,Wd=pe["__core-js_shared__"],Yd=jT.toString,is=nl.hasOwnProperty,wT=0,d0=function(){var l=/[^.]+$/.exec(Wd&&Wd.keys&&Wd.keys.IE_PROTO||"");return l?"Symbol(src)_1."+l:""}(),Vd=nl.toString,NT=Yd.call(us),ST=yn._,CT=Dh("^"+Yd.call(is).replace(xs,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Gd=Gg?pe.Buffer:n,Si=pe.Symbol,qd=pe.Uint8Array,u0=Gd?Gd.allocUnsafe:n,Kd=l0(us.getPrototypeOf,us),m0=us.create,h0=nl.propertyIsEnumerable,Jd=Ud.splice,f0=Si?Si.isConcatSpreadable:n,ec=Si?Si.iterator:n,yo=Si?Si.toStringTag:n,Xd=function(){try{var l=So(us,"defineProperty");return l({},"",{}),l}catch{}}(),ET=pe.clearTimeout!==yn.clearTimeout&&pe.clearTimeout,TT=$e&&$e.now!==yn.Date.now&&$e.now,DT=pe.setTimeout!==yn.setTimeout&&pe.setTimeout,Zd=nn.ceil,Qd=nn.floor,kh=us.getOwnPropertySymbols,kT=Gd?Gd.isBuffer:n,p0=pe.isFinite,AT=Ud.join,_T=l0(us.keys,us),rn=nn.max,Tn=nn.min,RT=$e.now,OT=pe.parseInt,x0=nn.random,PT=Ud.reverse,Ah=So(pe,"DataView"),tc=So(pe,"Map"),_h=So(pe,"Promise"),rl=So(pe,"Set"),sc=So(pe,"WeakMap"),nc=So(us,"create"),eu=sc&&new sc,al={},MT=Co(Ah),IT=Co(tc),LT=Co(_h),$T=Co(rl),zT=Co(sc),tu=Si?Si.prototype:n,rc=tu?tu.valueOf:n,g0=tu?tu.toString:n;function L(l){if(Ms(l)&&!at(l)&&!(l instanceof Pt)){if(l instanceof Cr)return l;if(is.call(l,"__wrapped__"))return vv(l)}return new Cr(l)}var il=function(){function l(){}return function(m){if(!ks(m))return{};if(m0)return m0(m);l.prototype=m;var j=new l;return l.prototype=n,j}}();function su(){}function Cr(l,m){this.__wrapped__=l,this.__actions__=[],this.__chain__=!!m,this.__index__=0,this.__values__=n}L.templateSettings={escape:_e,evaluate:Be,interpolate:Xe,variable:"",imports:{_:L}},L.prototype=su.prototype,L.prototype.constructor=L,Cr.prototype=il(su.prototype),Cr.prototype.constructor=Cr;function Pt(l){this.__wrapped__=l,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=X,this.__views__=[]}function FT(){var l=new Pt(this.__wrapped__);return l.__actions__=Xn(this.__actions__),l.__dir__=this.__dir__,l.__filtered__=this.__filtered__,l.__iteratees__=Xn(this.__iteratees__),l.__takeCount__=this.__takeCount__,l.__views__=Xn(this.__views__),l}function BT(){if(this.__filtered__){var l=new Pt(this);l.__dir__=-1,l.__filtered__=!0}else l=this.clone(),l.__dir__*=-1;return l}function HT(){var l=this.__wrapped__.value(),m=this.__dir__,j=at(l),C=m<0,A=j?l.length:0,F=ek(0,A,this.__views__),V=F.start,Z=F.end,re=Z-V,ve=C?Z:V-1,be=this.__iteratees__,we=be.length,Oe=0,We=Tn(re,this.__takeCount__);if(!j||!C&&A==re&&We==re)return B0(l,this.__actions__);var Qe=[];e:for(;re--&&Oe<We;){ve+=m;for(var mt=-1,et=l[ve];++mt<we;){var St=be[mt],zt=St.iteratee,pr=St.type,Bn=zt(et);if(pr==B)et=Bn;else if(!Bn){if(pr==W)continue e;break e}}Qe[Oe++]=et}return Qe}Pt.prototype=il(su.prototype),Pt.prototype.constructor=Pt;function bo(l){var m=-1,j=l==null?0:l.length;for(this.clear();++m<j;){var C=l[m];this.set(C[0],C[1])}}function UT(){this.__data__=nc?nc(null):{},this.size=0}function WT(l){var m=this.has(l)&&delete this.__data__[l];return this.size-=m?1:0,m}function YT(l){var m=this.__data__;if(nc){var j=m[l];return j===u?n:j}return is.call(m,l)?m[l]:n}function VT(l){var m=this.__data__;return nc?m[l]!==n:is.call(m,l)}function GT(l,m){var j=this.__data__;return this.size+=this.has(l)?0:1,j[l]=nc&&m===n?u:m,this}bo.prototype.clear=UT,bo.prototype.delete=WT,bo.prototype.get=YT,bo.prototype.has=VT,bo.prototype.set=GT;function Ya(l){var m=-1,j=l==null?0:l.length;for(this.clear();++m<j;){var C=l[m];this.set(C[0],C[1])}}function qT(){this.__data__=[],this.size=0}function KT(l){var m=this.__data__,j=nu(m,l);if(j<0)return!1;var C=m.length-1;return j==C?m.pop():Jd.call(m,j,1),--this.size,!0}function JT(l){var m=this.__data__,j=nu(m,l);return j<0?n:m[j][1]}function XT(l){return nu(this.__data__,l)>-1}function ZT(l,m){var j=this.__data__,C=nu(j,l);return C<0?(++this.size,j.push([l,m])):j[C][1]=m,this}Ya.prototype.clear=qT,Ya.prototype.delete=KT,Ya.prototype.get=JT,Ya.prototype.has=XT,Ya.prototype.set=ZT;function Va(l){var m=-1,j=l==null?0:l.length;for(this.clear();++m<j;){var C=l[m];this.set(C[0],C[1])}}function QT(){this.size=0,this.__data__={hash:new bo,map:new(tc||Ya),string:new bo}}function eD(l){var m=pu(this,l).delete(l);return this.size-=m?1:0,m}function tD(l){return pu(this,l).get(l)}function sD(l){return pu(this,l).has(l)}function nD(l,m){var j=pu(this,l),C=j.size;return j.set(l,m),this.size+=j.size==C?0:1,this}Va.prototype.clear=QT,Va.prototype.delete=eD,Va.prototype.get=tD,Va.prototype.has=sD,Va.prototype.set=nD;function jo(l){var m=-1,j=l==null?0:l.length;for(this.__data__=new Va;++m<j;)this.add(l[m])}function rD(l){return this.__data__.set(l,u),this}function aD(l){return this.__data__.has(l)}jo.prototype.add=jo.prototype.push=rD,jo.prototype.has=aD;function Wr(l){var m=this.__data__=new Ya(l);this.size=m.size}function iD(){this.__data__=new Ya,this.size=0}function oD(l){var m=this.__data__,j=m.delete(l);return this.size=m.size,j}function lD(l){return this.__data__.get(l)}function cD(l){return this.__data__.has(l)}function dD(l,m){var j=this.__data__;if(j instanceof Ya){var C=j.__data__;if(!tc||C.length<a-1)return C.push([l,m]),this.size=++j.size,this;j=this.__data__=new Va(C)}return j.set(l,m),this.size=j.size,this}Wr.prototype.clear=iD,Wr.prototype.delete=oD,Wr.prototype.get=lD,Wr.prototype.has=cD,Wr.prototype.set=dD;function v0(l,m){var j=at(l),C=!j&&Eo(l),A=!j&&!C&&ki(l),F=!j&&!C&&!A&&dl(l),V=j||C||A||F,Z=V?Ch(l.length,bT):[],re=Z.length;for(var ve in l)(m||is.call(l,ve))&&!(V&&(ve=="length"||A&&(ve=="offset"||ve=="parent")||F&&(ve=="buffer"||ve=="byteLength"||ve=="byteOffset")||Ja(ve,re)))&&Z.push(ve);return Z}function y0(l){var m=l.length;return m?l[Hh(0,m-1)]:n}function uD(l,m){return xu(Xn(l),wo(m,0,l.length))}function mD(l){return xu(Xn(l))}function Rh(l,m,j){(j!==n&&!Yr(l[m],j)||j===n&&!(m in l))&&Ga(l,m,j)}function ac(l,m,j){var C=l[m];(!(is.call(l,m)&&Yr(C,j))||j===n&&!(m in l))&&Ga(l,m,j)}function nu(l,m){for(var j=l.length;j--;)if(Yr(l[j][0],m))return j;return-1}function hD(l,m,j,C){return Ci(l,function(A,F,V){m(C,A,j(A),V)}),C}function b0(l,m){return l&&Sa(m,un(m),l)}function fD(l,m){return l&&Sa(m,Qn(m),l)}function Ga(l,m,j){m=="__proto__"&&Xd?Xd(l,m,{configurable:!0,enumerable:!0,value:j,writable:!0}):l[m]=j}function Oh(l,m){for(var j=-1,C=m.length,A=ue(C),F=l==null;++j<C;)A[j]=F?n:ff(l,m[j]);return A}function wo(l,m,j){return l===l&&(j!==n&&(l=l<=j?l:j),m!==n&&(l=l>=m?l:m)),l}function Er(l,m,j,C,A,F){var V,Z=m&p,re=m&g,ve=m&x;if(j&&(V=A?j(l,C,A,F):j(l)),V!==n)return V;if(!ks(l))return l;var be=at(l);if(be){if(V=sk(l),!Z)return Xn(l,V)}else{var we=Dn(l),Oe=we==oe||we==J;if(ki(l))return W0(l,Z);if(we==dt||we==fe||Oe&&!A){if(V=re||Oe?{}:cv(l),!Z)return re?YD(l,fD(V,l)):WD(l,b0(V,l))}else{if(!vs[we])return A?l:{};V=nk(l,we,Z)}}F||(F=new Wr);var We=F.get(l);if(We)return We;F.set(l,V),$v(l)?l.forEach(function(et){V.add(Er(et,m,j,et,l,F))}):Iv(l)&&l.forEach(function(et,St){V.set(St,Er(et,m,j,St,l,F))});var Qe=ve?re?Qh:Zh:re?Qn:un,mt=be?n:Qe(l);return Nr(mt||l,function(et,St){mt&&(St=et,et=l[St]),ac(V,St,Er(et,m,j,St,l,F))}),V}function pD(l){var m=un(l);return function(j){return j0(j,l,m)}}function j0(l,m,j){var C=j.length;if(l==null)return!C;for(l=us(l);C--;){var A=j[C],F=m[A],V=l[A];if(V===n&&!(A in l)||!F(V))return!1}return!0}function w0(l,m,j){if(typeof l!="function")throw new Sr(o);return mc(function(){l.apply(n,j)},m)}function ic(l,m,j,C){var A=-1,F=Fd,V=!0,Z=l.length,re=[],ve=m.length;if(!Z)return re;j&&(m=Es(m,mr(j))),C?(F=yh,V=!1):m.length>=a&&(F=Ql,V=!1,m=new jo(m));e:for(;++A<Z;){var be=l[A],we=j==null?be:j(be);if(be=C||be!==0?be:0,V&&we===we){for(var Oe=ve;Oe--;)if(m[Oe]===we)continue e;re.push(be)}else F(m,we,C)||re.push(be)}return re}var Ci=K0(Na),N0=K0(Mh,!0);function xD(l,m){var j=!0;return Ci(l,function(C,A,F){return j=!!m(C,A,F),j}),j}function ru(l,m,j){for(var C=-1,A=l.length;++C<A;){var F=l[C],V=m(F);if(V!=null&&(Z===n?V===V&&!fr(V):j(V,Z)))var Z=V,re=F}return re}function gD(l,m,j,C){var A=l.length;for(j=lt(j),j<0&&(j=-j>A?0:A+j),C=C===n||C>A?A:lt(C),C<0&&(C+=A),C=j>C?0:Fv(C);j<C;)l[j++]=m;return l}function S0(l,m){var j=[];return Ci(l,function(C,A,F){m(C,A,F)&&j.push(C)}),j}function bn(l,m,j,C,A){var F=-1,V=l.length;for(j||(j=ak),A||(A=[]);++F<V;){var Z=l[F];m>0&&j(Z)?m>1?bn(Z,m-1,j,C,A):wi(A,Z):C||(A[A.length]=Z)}return A}var Ph=J0(),C0=J0(!0);function Na(l,m){return l&&Ph(l,m,un)}function Mh(l,m){return l&&C0(l,m,un)}function au(l,m){return ji(m,function(j){return Xa(l[j])})}function No(l,m){m=Ti(m,l);for(var j=0,C=m.length;l!=null&&j<C;)l=l[Ca(m[j++])];return j&&j==C?l:n}function E0(l,m,j){var C=m(l);return at(l)?C:wi(C,j(l))}function zn(l){return l==null?l===n?Ee:gt:yo&&yo in us(l)?QD(l):mk(l)}function Ih(l,m){return l>m}function vD(l,m){return l!=null&&is.call(l,m)}function yD(l,m){return l!=null&&m in us(l)}function bD(l,m,j){return l>=Tn(m,j)&&l<rn(m,j)}function Lh(l,m,j){for(var C=j?yh:Fd,A=l[0].length,F=l.length,V=F,Z=ue(F),re=1/0,ve=[];V--;){var be=l[V];V&&m&&(be=Es(be,mr(m))),re=Tn(be.length,re),Z[V]=!j&&(m||A>=120&&be.length>=120)?new jo(V&&be):n}be=l[0];var we=-1,Oe=Z[0];e:for(;++we<A&&ve.length<re;){var We=be[we],Qe=m?m(We):We;if(We=j||We!==0?We:0,!(Oe?Ql(Oe,Qe):C(ve,Qe,j))){for(V=F;--V;){var mt=Z[V];if(!(mt?Ql(mt,Qe):C(l[V],Qe,j)))continue e}Oe&&Oe.push(Qe),ve.push(We)}}return ve}function jD(l,m,j,C){return Na(l,function(A,F,V){m(C,j(A),F,V)}),C}function oc(l,m,j){m=Ti(m,l),l=hv(l,m);var C=l==null?l:l[Ca(Dr(m))];return C==null?n:ur(C,l,j)}function T0(l){return Ms(l)&&zn(l)==fe}function wD(l){return Ms(l)&&zn(l)==qe}function ND(l){return Ms(l)&&zn(l)==je}function lc(l,m,j,C,A){return l===m?!0:l==null||m==null||!Ms(l)&&!Ms(m)?l!==l&&m!==m:SD(l,m,j,C,lc,A)}function SD(l,m,j,C,A,F){var V=at(l),Z=at(m),re=V?le:Dn(l),ve=Z?le:Dn(m);re=re==fe?dt:re,ve=ve==fe?dt:ve;var be=re==dt,we=ve==dt,Oe=re==ve;if(Oe&&ki(l)){if(!ki(m))return!1;V=!0,be=!1}if(Oe&&!be)return F||(F=new Wr),V||dl(l)?iv(l,m,j,C,A,F):XD(l,m,re,j,C,A,F);if(!(j&y)){var We=be&&is.call(l,"__wrapped__"),Qe=we&&is.call(m,"__wrapped__");if(We||Qe){var mt=We?l.value():l,et=Qe?m.value():m;return F||(F=new Wr),A(mt,et,j,C,F)}}return Oe?(F||(F=new Wr),ZD(l,m,j,C,A,F)):!1}function CD(l){return Ms(l)&&Dn(l)==ye}function $h(l,m,j,C){var A=j.length,F=A,V=!C;if(l==null)return!F;for(l=us(l);A--;){var Z=j[A];if(V&&Z[2]?Z[1]!==l[Z[0]]:!(Z[0]in l))return!1}for(;++A<F;){Z=j[A];var re=Z[0],ve=l[re],be=Z[1];if(V&&Z[2]){if(ve===n&&!(re in l))return!1}else{var we=new Wr;if(C)var Oe=C(ve,be,re,l,m,we);if(!(Oe===n?lc(be,ve,y|b,C,we):Oe))return!1}}return!0}function D0(l){if(!ks(l)||ok(l))return!1;var m=Xa(l)?CT:Ke;return m.test(Co(l))}function ED(l){return Ms(l)&&zn(l)==q}function TD(l){return Ms(l)&&Dn(l)==ne}function DD(l){return Ms(l)&&wu(l.length)&&!!ws[zn(l)]}function k0(l){return typeof l=="function"?l:l==null?er:typeof l=="object"?at(l)?R0(l[0],l[1]):_0(l):Xv(l)}function zh(l){if(!uc(l))return _T(l);var m=[];for(var j in us(l))is.call(l,j)&&j!="constructor"&&m.push(j);return m}function kD(l){if(!ks(l))return uk(l);var m=uc(l),j=[];for(var C in l)C=="constructor"&&(m||!is.call(l,C))||j.push(C);return j}function Fh(l,m){return l<m}function A0(l,m){var j=-1,C=Zn(l)?ue(l.length):[];return Ci(l,function(A,F,V){C[++j]=m(A,F,V)}),C}function _0(l){var m=tf(l);return m.length==1&&m[0][2]?uv(m[0][0],m[0][1]):function(j){return j===l||$h(j,l,m)}}function R0(l,m){return nf(l)&&dv(m)?uv(Ca(l),m):function(j){var C=ff(j,l);return C===n&&C===m?pf(j,l):lc(m,C,y|b)}}function iu(l,m,j,C,A){l!==m&&Ph(m,function(F,V){if(A||(A=new Wr),ks(F))AD(l,m,V,j,iu,C,A);else{var Z=C?C(af(l,V),F,V+"",l,m,A):n;Z===n&&(Z=F),Rh(l,V,Z)}},Qn)}function AD(l,m,j,C,A,F,V){var Z=af(l,j),re=af(m,j),ve=V.get(re);if(ve){Rh(l,j,ve);return}var be=F?F(Z,re,j+"",l,m,V):n,we=be===n;if(we){var Oe=at(re),We=!Oe&&ki(re),Qe=!Oe&&!We&&dl(re);be=re,Oe||We||Qe?at(Z)?be=Z:Fs(Z)?be=Xn(Z):We?(we=!1,be=W0(re,!0)):Qe?(we=!1,be=Y0(re,!0)):be=[]:hc(re)||Eo(re)?(be=Z,Eo(Z)?be=Bv(Z):(!ks(Z)||Xa(Z))&&(be=cv(re))):we=!1}we&&(V.set(re,be),A(be,re,C,F,V),V.delete(re)),Rh(l,j,be)}function O0(l,m){var j=l.length;if(j)return m+=m<0?j:0,Ja(m,j)?l[m]:n}function P0(l,m,j){m.length?m=Es(m,function(F){return at(F)?function(V){return No(V,F.length===1?F[0]:F)}:F}):m=[er];var C=-1;m=Es(m,mr(Ze()));var A=A0(l,function(F,V,Z){var re=Es(m,function(ve){return ve(F)});return{criteria:re,index:++C,value:F}});return nT(A,function(F,V){return UD(F,V,j)})}function _D(l,m){return M0(l,m,function(j,C){return pf(l,C)})}function M0(l,m,j){for(var C=-1,A=m.length,F={};++C<A;){var V=m[C],Z=No(l,V);j(Z,V)&&cc(F,Ti(V,l),Z)}return F}function RD(l){return function(m){return No(m,l)}}function Bh(l,m,j,C){var A=C?sT:Qo,F=-1,V=m.length,Z=l;for(l===m&&(m=Xn(m)),j&&(Z=Es(l,mr(j)));++F<V;)for(var re=0,ve=m[F],be=j?j(ve):ve;(re=A(Z,be,re,C))>-1;)Z!==l&&Jd.call(Z,re,1),Jd.call(l,re,1);return l}function I0(l,m){for(var j=l?m.length:0,C=j-1;j--;){var A=m[j];if(j==C||A!==F){var F=A;Ja(A)?Jd.call(l,A,1):Yh(l,A)}}return l}function Hh(l,m){return l+Qd(x0()*(m-l+1))}function OD(l,m,j,C){for(var A=-1,F=rn(Zd((m-l)/(j||1)),0),V=ue(F);F--;)V[C?F:++A]=l,l+=j;return V}function Uh(l,m){var j="";if(!l||m<1||m>G)return j;do m%2&&(j+=l),m=Qd(m/2),m&&(l+=l);while(m);return j}function pt(l,m){return of(mv(l,m,er),l+"")}function PD(l){return y0(ul(l))}function MD(l,m){var j=ul(l);return xu(j,wo(m,0,j.length))}function cc(l,m,j,C){if(!ks(l))return l;m=Ti(m,l);for(var A=-1,F=m.length,V=F-1,Z=l;Z!=null&&++A<F;){var re=Ca(m[A]),ve=j;if(re==="__proto__"||re==="constructor"||re==="prototype")return l;if(A!=V){var be=Z[re];ve=C?C(be,re,Z):n,ve===n&&(ve=ks(be)?be:Ja(m[A+1])?[]:{})}ac(Z,re,ve),Z=Z[re]}return l}var L0=eu?function(l,m){return eu.set(l,m),l}:er,ID=Xd?function(l,m){return Xd(l,"toString",{configurable:!0,enumerable:!1,value:gf(m),writable:!0})}:er;function LD(l){return xu(ul(l))}function Tr(l,m,j){var C=-1,A=l.length;m<0&&(m=-m>A?0:A+m),j=j>A?A:j,j<0&&(j+=A),A=m>j?0:j-m>>>0,m>>>=0;for(var F=ue(A);++C<A;)F[C]=l[C+m];return F}function $D(l,m){var j;return Ci(l,function(C,A,F){return j=m(C,A,F),!j}),!!j}function ou(l,m,j){var C=0,A=l==null?C:l.length;if(typeof m=="number"&&m===m&&A<=H){for(;C<A;){var F=C+A>>>1,V=l[F];V!==null&&!fr(V)&&(j?V<=m:V<m)?C=F+1:A=F}return A}return Wh(l,m,er,j)}function Wh(l,m,j,C){var A=0,F=l==null?0:l.length;if(F===0)return 0;m=j(m);for(var V=m!==m,Z=m===null,re=fr(m),ve=m===n;A<F;){var be=Qd((A+F)/2),we=j(l[be]),Oe=we!==n,We=we===null,Qe=we===we,mt=fr(we);if(V)var et=C||Qe;else ve?et=Qe&&(C||Oe):Z?et=Qe&&Oe&&(C||!We):re?et=Qe&&Oe&&!We&&(C||!mt):We||mt?et=!1:et=C?we<=m:we<m;et?A=be+1:F=be}return Tn(F,se)}function $0(l,m){for(var j=-1,C=l.length,A=0,F=[];++j<C;){var V=l[j],Z=m?m(V):V;if(!j||!Yr(Z,re)){var re=Z;F[A++]=V===0?0:V}}return F}function z0(l){return typeof l=="number"?l:fr(l)?Y:+l}function hr(l){if(typeof l=="string")return l;if(at(l))return Es(l,hr)+"";if(fr(l))return g0?g0.call(l):"";var m=l+"";return m=="0"&&1/l==-z?"-0":m}function Ei(l,m,j){var C=-1,A=Fd,F=l.length,V=!0,Z=[],re=Z;if(j)V=!1,A=yh;else if(F>=a){var ve=m?null:KD(l);if(ve)return Hd(ve);V=!1,A=Ql,re=new jo}else re=m?[]:Z;e:for(;++C<F;){var be=l[C],we=m?m(be):be;if(be=j||be!==0?be:0,V&&we===we){for(var Oe=re.length;Oe--;)if(re[Oe]===we)continue e;m&&re.push(we),Z.push(be)}else A(re,we,j)||(re!==Z&&re.push(we),Z.push(be))}return Z}function Yh(l,m){return m=Ti(m,l),l=hv(l,m),l==null||delete l[Ca(Dr(m))]}function F0(l,m,j,C){return cc(l,m,j(No(l,m)),C)}function lu(l,m,j,C){for(var A=l.length,F=C?A:-1;(C?F--:++F<A)&&m(l[F],F,l););return j?Tr(l,C?0:F,C?F+1:A):Tr(l,C?F+1:0,C?A:F)}function B0(l,m){var j=l;return j instanceof Pt&&(j=j.value()),bh(m,function(C,A){return A.func.apply(A.thisArg,wi([C],A.args))},j)}function Vh(l,m,j){var C=l.length;if(C<2)return C?Ei(l[0]):[];for(var A=-1,F=ue(C);++A<C;)for(var V=l[A],Z=-1;++Z<C;)Z!=A&&(F[A]=ic(F[A]||V,l[Z],m,j));return Ei(bn(F,1),m,j)}function H0(l,m,j){for(var C=-1,A=l.length,F=m.length,V={};++C<A;){var Z=C<F?m[C]:n;j(V,l[C],Z)}return V}function Gh(l){return Fs(l)?l:[]}function qh(l){return typeof l=="function"?l:er}function Ti(l,m){return at(l)?l:nf(l,m)?[l]:gv(ts(l))}var zD=pt;function Di(l,m,j){var C=l.length;return j=j===n?C:j,!m&&j>=C?l:Tr(l,m,j)}var U0=ET||function(l){return yn.clearTimeout(l)};function W0(l,m){if(m)return l.slice();var j=l.length,C=u0?u0(j):new l.constructor(j);return l.copy(C),C}function Kh(l){var m=new l.constructor(l.byteLength);return new qd(m).set(new qd(l)),m}function FD(l,m){var j=m?Kh(l.buffer):l.buffer;return new l.constructor(j,l.byteOffset,l.byteLength)}function BD(l){var m=new l.constructor(l.source,Xl.exec(l));return m.lastIndex=l.lastIndex,m}function HD(l){return rc?us(rc.call(l)):{}}function Y0(l,m){var j=m?Kh(l.buffer):l.buffer;return new l.constructor(j,l.byteOffset,l.length)}function V0(l,m){if(l!==m){var j=l!==n,C=l===null,A=l===l,F=fr(l),V=m!==n,Z=m===null,re=m===m,ve=fr(m);if(!Z&&!ve&&!F&&l>m||F&&V&&re&&!Z&&!ve||C&&V&&re||!j&&re||!A)return 1;if(!C&&!F&&!ve&&l<m||ve&&j&&A&&!C&&!F||Z&&j&&A||!V&&A||!re)return-1}return 0}function UD(l,m,j){for(var C=-1,A=l.criteria,F=m.criteria,V=A.length,Z=j.length;++C<V;){var re=V0(A[C],F[C]);if(re){if(C>=Z)return re;var ve=j[C];return re*(ve=="desc"?-1:1)}}return l.index-m.index}function G0(l,m,j,C){for(var A=-1,F=l.length,V=j.length,Z=-1,re=m.length,ve=rn(F-V,0),be=ue(re+ve),we=!C;++Z<re;)be[Z]=m[Z];for(;++A<V;)(we||A<F)&&(be[j[A]]=l[A]);for(;ve--;)be[Z++]=l[A++];return be}function q0(l,m,j,C){for(var A=-1,F=l.length,V=-1,Z=j.length,re=-1,ve=m.length,be=rn(F-Z,0),we=ue(be+ve),Oe=!C;++A<be;)we[A]=l[A];for(var We=A;++re<ve;)we[We+re]=m[re];for(;++V<Z;)(Oe||A<F)&&(we[We+j[V]]=l[A++]);return we}function Xn(l,m){var j=-1,C=l.length;for(m||(m=ue(C));++j<C;)m[j]=l[j];return m}function Sa(l,m,j,C){var A=!j;j||(j={});for(var F=-1,V=m.length;++F<V;){var Z=m[F],re=C?C(j[Z],l[Z],Z,j,l):n;re===n&&(re=l[Z]),A?Ga(j,Z,re):ac(j,Z,re)}return j}function WD(l,m){return Sa(l,sf(l),m)}function YD(l,m){return Sa(l,ov(l),m)}function cu(l,m){return function(j,C){var A=at(j)?JE:hD,F=m?m():{};return A(j,l,Ze(C,2),F)}}function ol(l){return pt(function(m,j){var C=-1,A=j.length,F=A>1?j[A-1]:n,V=A>2?j[2]:n;for(F=l.length>3&&typeof F=="function"?(A--,F):n,V&&Fn(j[0],j[1],V)&&(F=A<3?n:F,A=1),m=us(m);++C<A;){var Z=j[C];Z&&l(m,Z,C,F)}return m})}function K0(l,m){return function(j,C){if(j==null)return j;if(!Zn(j))return l(j,C);for(var A=j.length,F=m?A:-1,V=us(j);(m?F--:++F<A)&&C(V[F],F,V)!==!1;);return j}}function J0(l){return function(m,j,C){for(var A=-1,F=us(m),V=C(m),Z=V.length;Z--;){var re=V[l?Z:++A];if(j(F[re],re,F)===!1)break}return m}}function VD(l,m,j){var C=m&v,A=dc(l);function F(){var V=this&&this!==yn&&this instanceof F?A:l;return V.apply(C?j:this,arguments)}return F}function X0(l){return function(m){m=ts(m);var j=el(m)?Ur(m):n,C=j?j[0]:m.charAt(0),A=j?Di(j,1).join(""):m.slice(1);return C[l]()+A}}function ll(l){return function(m){return bh(Kv(qv(m).replace(IE,"")),l,"")}}function dc(l){return function(){var m=arguments;switch(m.length){case 0:return new l;case 1:return new l(m[0]);case 2:return new l(m[0],m[1]);case 3:return new l(m[0],m[1],m[2]);case 4:return new l(m[0],m[1],m[2],m[3]);case 5:return new l(m[0],m[1],m[2],m[3],m[4]);case 6:return new l(m[0],m[1],m[2],m[3],m[4],m[5]);case 7:return new l(m[0],m[1],m[2],m[3],m[4],m[5],m[6])}var j=il(l.prototype),C=l.apply(j,m);return ks(C)?C:j}}function GD(l,m,j){var C=dc(l);function A(){for(var F=arguments.length,V=ue(F),Z=F,re=cl(A);Z--;)V[Z]=arguments[Z];var ve=F<3&&V[0]!==re&&V[F-1]!==re?[]:Ni(V,re);if(F-=ve.length,F<j)return sv(l,m,du,A.placeholder,n,V,ve,n,n,j-F);var be=this&&this!==yn&&this instanceof A?C:l;return ur(be,this,V)}return A}function Z0(l){return function(m,j,C){var A=us(m);if(!Zn(m)){var F=Ze(j,3);m=un(m),j=function(Z){return F(A[Z],Z,A)}}var V=l(m,j,C);return V>-1?A[F?m[V]:V]:n}}function Q0(l){return Ka(function(m){var j=m.length,C=j,A=Cr.prototype.thru;for(l&&m.reverse();C--;){var F=m[C];if(typeof F!="function")throw new Sr(o);if(A&&!V&&fu(F)=="wrapper")var V=new Cr([],!0)}for(C=V?C:j;++C<j;){F=m[C];var Z=fu(F),re=Z=="wrapper"?ef(F):n;re&&rf(re[0])&&re[1]==(T|S|k|R)&&!re[4].length&&re[9]==1?V=V[fu(re[0])].apply(V,re[3]):V=F.length==1&&rf(F)?V[Z]():V.thru(F)}return function(){var ve=arguments,be=ve[0];if(V&&ve.length==1&&at(be))return V.plant(be).value();for(var we=0,Oe=j?m[we].apply(this,ve):be;++we<j;)Oe=m[we].call(this,Oe);return Oe}})}function du(l,m,j,C,A,F,V,Z,re,ve){var be=m&T,we=m&v,Oe=m&w,We=m&(S|E),Qe=m&O,mt=Oe?n:dc(l);function et(){for(var St=arguments.length,zt=ue(St),pr=St;pr--;)zt[pr]=arguments[pr];if(We)var Bn=cl(et),xr=aT(zt,Bn);if(C&&(zt=G0(zt,C,A,We)),F&&(zt=q0(zt,F,V,We)),St-=xr,We&&St<ve){var Bs=Ni(zt,Bn);return sv(l,m,du,et.placeholder,j,zt,Bs,Z,re,ve-St)}var Vr=we?j:this,Qa=Oe?Vr[l]:l;return St=zt.length,Z?zt=hk(zt,Z):Qe&&St>1&&zt.reverse(),be&&re<St&&(zt.length=re),this&&this!==yn&&this instanceof et&&(Qa=mt||dc(Qa)),Qa.apply(Vr,zt)}return et}function ev(l,m){return function(j,C){return jD(j,l,m(C),{})}}function uu(l,m){return function(j,C){var A;if(j===n&&C===n)return m;if(j!==n&&(A=j),C!==n){if(A===n)return C;typeof j=="string"||typeof C=="string"?(j=hr(j),C=hr(C)):(j=z0(j),C=z0(C)),A=l(j,C)}return A}}function Jh(l){return Ka(function(m){return m=Es(m,mr(Ze())),pt(function(j){var C=this;return l(m,function(A){return ur(A,C,j)})})})}function mu(l,m){m=m===n?" ":hr(m);var j=m.length;if(j<2)return j?Uh(m,l):m;var C=Uh(m,Zd(l/tl(m)));return el(m)?Di(Ur(C),0,l).join(""):C.slice(0,l)}function qD(l,m,j,C){var A=m&v,F=dc(l);function V(){for(var Z=-1,re=arguments.length,ve=-1,be=C.length,we=ue(be+re),Oe=this&&this!==yn&&this instanceof V?F:l;++ve<be;)we[ve]=C[ve];for(;re--;)we[ve++]=arguments[++Z];return ur(Oe,A?j:this,we)}return V}function tv(l){return function(m,j,C){return C&&typeof C!="number"&&Fn(m,j,C)&&(j=C=n),m=Za(m),j===n?(j=m,m=0):j=Za(j),C=C===n?m<j?1:-1:Za(C),OD(m,j,C,l)}}function hu(l){return function(m,j){return typeof m=="string"&&typeof j=="string"||(m=kr(m),j=kr(j)),l(m,j)}}function sv(l,m,j,C,A,F,V,Z,re,ve){var be=m&S,we=be?V:n,Oe=be?n:V,We=be?F:n,Qe=be?n:F;m|=be?k:D,m&=~(be?D:k),m&N||(m&=-4);var mt=[l,m,A,We,we,Qe,Oe,Z,re,ve],et=j.apply(n,mt);return rf(l)&&fv(et,mt),et.placeholder=C,pv(et,l,m)}function Xh(l){var m=nn[l];return function(j,C){if(j=kr(j),C=C==null?0:Tn(lt(C),292),C&&p0(j)){var A=(ts(j)+"e").split("e"),F=m(A[0]+"e"+(+A[1]+C));return A=(ts(F)+"e").split("e"),+(A[0]+"e"+(+A[1]-C))}return m(j)}}var KD=rl&&1/Hd(new rl([,-0]))[1]==z?function(l){return new rl(l)}:bf;function nv(l){return function(m){var j=Dn(m);return j==ye?Th(m):j==ne?mT(m):rT(m,l(m))}}function qa(l,m,j,C,A,F,V,Z){var re=m&w;if(!re&&typeof l!="function")throw new Sr(o);var ve=C?C.length:0;if(ve||(m&=-97,C=A=n),V=V===n?V:rn(lt(V),0),Z=Z===n?Z:lt(Z),ve-=A?A.length:0,m&D){var be=C,we=A;C=A=n}var Oe=re?n:ef(l),We=[l,m,j,C,A,be,we,F,V,Z];if(Oe&&dk(We,Oe),l=We[0],m=We[1],j=We[2],C=We[3],A=We[4],Z=We[9]=We[9]===n?re?0:l.length:rn(We[9]-ve,0),!Z&&m&(S|E)&&(m&=-25),!m||m==v)var Qe=VD(l,m,j);else m==S||m==E?Qe=GD(l,m,Z):(m==k||m==(v|k))&&!A.length?Qe=qD(l,m,j,C):Qe=du.apply(n,We);var mt=Oe?L0:fv;return pv(mt(Qe,We),l,m)}function rv(l,m,j,C){return l===n||Yr(l,nl[j])&&!is.call(C,j)?m:l}function av(l,m,j,C,A,F){return ks(l)&&ks(m)&&(F.set(m,l),iu(l,m,n,av,F),F.delete(m)),l}function JD(l){return hc(l)?n:l}function iv(l,m,j,C,A,F){var V=j&y,Z=l.length,re=m.length;if(Z!=re&&!(V&&re>Z))return!1;var ve=F.get(l),be=F.get(m);if(ve&&be)return ve==m&&be==l;var we=-1,Oe=!0,We=j&b?new jo:n;for(F.set(l,m),F.set(m,l);++we<Z;){var Qe=l[we],mt=m[we];if(C)var et=V?C(mt,Qe,we,m,l,F):C(Qe,mt,we,l,m,F);if(et!==n){if(et)continue;Oe=!1;break}if(We){if(!jh(m,function(St,zt){if(!Ql(We,zt)&&(Qe===St||A(Qe,St,j,C,F)))return We.push(zt)})){Oe=!1;break}}else if(!(Qe===mt||A(Qe,mt,j,C,F))){Oe=!1;break}}return F.delete(l),F.delete(m),Oe}function XD(l,m,j,C,A,F,V){switch(j){case st:if(l.byteLength!=m.byteLength||l.byteOffset!=m.byteOffset)return!1;l=l.buffer,m=m.buffer;case qe:return!(l.byteLength!=m.byteLength||!F(new qd(l),new qd(m)));case de:case je:case xt:return Yr(+l,+m);case Se:return l.name==m.name&&l.message==m.message;case q:case me:return l==m+"";case ye:var Z=Th;case ne:var re=C&y;if(Z||(Z=Hd),l.size!=m.size&&!re)return!1;var ve=V.get(l);if(ve)return ve==m;C|=b,V.set(l,m);var be=iv(Z(l),Z(m),C,A,F,V);return V.delete(l),be;case Te:if(rc)return rc.call(l)==rc.call(m)}return!1}function ZD(l,m,j,C,A,F){var V=j&y,Z=Zh(l),re=Z.length,ve=Zh(m),be=ve.length;if(re!=be&&!V)return!1;for(var we=re;we--;){var Oe=Z[we];if(!(V?Oe in m:is.call(m,Oe)))return!1}var We=F.get(l),Qe=F.get(m);if(We&&Qe)return We==m&&Qe==l;var mt=!0;F.set(l,m),F.set(m,l);for(var et=V;++we<re;){Oe=Z[we];var St=l[Oe],zt=m[Oe];if(C)var pr=V?C(zt,St,Oe,m,l,F):C(St,zt,Oe,l,m,F);if(!(pr===n?St===zt||A(St,zt,j,C,F):pr)){mt=!1;break}et||(et=Oe=="constructor")}if(mt&&!et){var Bn=l.constructor,xr=m.constructor;Bn!=xr&&"constructor"in l&&"constructor"in m&&!(typeof Bn=="function"&&Bn instanceof Bn&&typeof xr=="function"&&xr instanceof xr)&&(mt=!1)}return F.delete(l),F.delete(m),mt}function Ka(l){return of(mv(l,n,jv),l+"")}function Zh(l){return E0(l,un,sf)}function Qh(l){return E0(l,Qn,ov)}var ef=eu?function(l){return eu.get(l)}:bf;function fu(l){for(var m=l.name+"",j=al[m],C=is.call(al,m)?j.length:0;C--;){var A=j[C],F=A.func;if(F==null||F==l)return A.name}return m}function cl(l){var m=is.call(L,"placeholder")?L:l;return m.placeholder}function Ze(){var l=L.iteratee||vf;return l=l===vf?k0:l,arguments.length?l(arguments[0],arguments[1]):l}function pu(l,m){var j=l.__data__;return ik(m)?j[typeof m=="string"?"string":"hash"]:j.map}function tf(l){for(var m=un(l),j=m.length;j--;){var C=m[j],A=l[C];m[j]=[C,A,dv(A)]}return m}function So(l,m){var j=cT(l,m);return D0(j)?j:n}function QD(l){var m=is.call(l,yo),j=l[yo];try{l[yo]=n;var C=!0}catch{}var A=Vd.call(l);return C&&(m?l[yo]=j:delete l[yo]),A}var sf=kh?function(l){return l==null?[]:(l=us(l),ji(kh(l),function(m){return h0.call(l,m)}))}:jf,ov=kh?function(l){for(var m=[];l;)wi(m,sf(l)),l=Kd(l);return m}:jf,Dn=zn;(Ah&&Dn(new Ah(new ArrayBuffer(1)))!=st||tc&&Dn(new tc)!=ye||_h&&Dn(_h.resolve())!=qs||rl&&Dn(new rl)!=ne||sc&&Dn(new sc)!=Ne)&&(Dn=function(l){var m=zn(l),j=m==dt?l.constructor:n,C=j?Co(j):"";if(C)switch(C){case MT:return st;case IT:return ye;case LT:return qs;case $T:return ne;case zT:return Ne}return m});function ek(l,m,j){for(var C=-1,A=j.length;++C<A;){var F=j[C],V=F.size;switch(F.type){case"drop":l+=V;break;case"dropRight":m-=V;break;case"take":m=Tn(m,l+V);break;case"takeRight":l=rn(l,m-V);break}}return{start:l,end:m}}function tk(l){var m=l.match(dr);return m?m[1].split(Fr):[]}function lv(l,m,j){m=Ti(m,l);for(var C=-1,A=m.length,F=!1;++C<A;){var V=Ca(m[C]);if(!(F=l!=null&&j(l,V)))break;l=l[V]}return F||++C!=A?F:(A=l==null?0:l.length,!!A&&wu(A)&&Ja(V,A)&&(at(l)||Eo(l)))}function sk(l){var m=l.length,j=new l.constructor(m);return m&&typeof l[0]=="string"&&is.call(l,"index")&&(j.index=l.index,j.input=l.input),j}function cv(l){return typeof l.constructor=="function"&&!uc(l)?il(Kd(l)):{}}function nk(l,m,j){var C=l.constructor;switch(m){case qe:return Kh(l);case de:case je:return new C(+l);case st:return FD(l,j);case es:case Os:case qt:case tn:case Ks:case ds:case zs:case Ps:case $n:return Y0(l,j);case ye:return new C;case xt:case me:return new C(l);case q:return BD(l);case ne:return new C;case Te:return HD(l)}}function rk(l,m){var j=m.length;if(!j)return l;var C=j-1;return m[C]=(j>1?"& ":"")+m[C],m=m.join(j>2?", ":" "),l.replace(wa,`{
/* [wrapped with `+m+`] */
`)}function ak(l){return at(l)||Eo(l)||!!(f0&&l&&l[f0])}function Ja(l,m){var j=typeof l;return m=m??G,!!m&&(j=="number"||j!="symbol"&&De.test(l))&&l>-1&&l%1==0&&l<m}function Fn(l,m,j){if(!ks(j))return!1;var C=typeof m;return(C=="number"?Zn(j)&&Ja(m,j.length):C=="string"&&m in j)?Yr(j[m],l):!1}function nf(l,m){if(at(l))return!1;var j=typeof l;return j=="number"||j=="symbol"||j=="boolean"||l==null||fr(l)?!0:$t.test(l)||!Rt.test(l)||m!=null&&l in us(m)}function ik(l){var m=typeof l;return m=="string"||m=="number"||m=="symbol"||m=="boolean"?l!=="__proto__":l===null}function rf(l){var m=fu(l),j=L[m];if(typeof j!="function"||!(m in Pt.prototype))return!1;if(l===j)return!0;var C=ef(j);return!!C&&l===C[0]}function ok(l){return!!d0&&d0 in l}var lk=Wd?Xa:wf;function uc(l){var m=l&&l.constructor,j=typeof m=="function"&&m.prototype||nl;return l===j}function dv(l){return l===l&&!ks(l)}function uv(l,m){return function(j){return j==null?!1:j[l]===m&&(m!==n||l in us(j))}}function ck(l){var m=bu(l,function(C){return j.size===d&&j.clear(),C}),j=m.cache;return m}function dk(l,m){var j=l[1],C=m[1],A=j|C,F=A<(v|w|T),V=C==T&&j==S||C==T&&j==R&&l[7].length<=m[8]||C==(T|R)&&m[7].length<=m[8]&&j==S;if(!(F||V))return l;C&v&&(l[2]=m[2],A|=j&v?0:N);var Z=m[3];if(Z){var re=l[3];l[3]=re?G0(re,Z,m[4]):Z,l[4]=re?Ni(l[3],h):m[4]}return Z=m[5],Z&&(re=l[5],l[5]=re?q0(re,Z,m[6]):Z,l[6]=re?Ni(l[5],h):m[6]),Z=m[7],Z&&(l[7]=Z),C&T&&(l[8]=l[8]==null?m[8]:Tn(l[8],m[8])),l[9]==null&&(l[9]=m[9]),l[0]=m[0],l[1]=A,l}function uk(l){var m=[];if(l!=null)for(var j in us(l))m.push(j);return m}function mk(l){return Vd.call(l)}function mv(l,m,j){return m=rn(m===n?l.length-1:m,0),function(){for(var C=arguments,A=-1,F=rn(C.length-m,0),V=ue(F);++A<F;)V[A]=C[m+A];A=-1;for(var Z=ue(m+1);++A<m;)Z[A]=C[A];return Z[m]=j(V),ur(l,this,Z)}}function hv(l,m){return m.length<2?l:No(l,Tr(m,0,-1))}function hk(l,m){for(var j=l.length,C=Tn(m.length,j),A=Xn(l);C--;){var F=m[C];l[C]=Ja(F,j)?A[F]:n}return l}function af(l,m){if(!(m==="constructor"&&typeof l[m]=="function")&&m!="__proto__")return l[m]}var fv=xv(L0),mc=DT||function(l,m){return yn.setTimeout(l,m)},of=xv(ID);function pv(l,m,j){var C=m+"";return of(l,rk(C,fk(tk(C),j)))}function xv(l){var m=0,j=0;return function(){var C=RT(),A=M-(C-j);if(j=C,A>0){if(++m>=_)return arguments[0]}else m=0;return l.apply(n,arguments)}}function xu(l,m){var j=-1,C=l.length,A=C-1;for(m=m===n?C:m;++j<m;){var F=Hh(j,A),V=l[F];l[F]=l[j],l[j]=V}return l.length=m,l}var gv=ck(function(l){var m=[];return l.charCodeAt(0)===46&&m.push(""),l.replace(Ot,function(j,C,A,F){m.push(A?F.replace(Md,"$1"):C||j)}),m});function Ca(l){if(typeof l=="string"||fr(l))return l;var m=l+"";return m=="0"&&1/l==-z?"-0":m}function Co(l){if(l!=null){try{return Yd.call(l)}catch{}try{return l+""}catch{}}return""}function fk(l,m){return Nr(ie,function(j){var C="_."+j[0];m&j[1]&&!Fd(l,C)&&l.push(C)}),l.sort()}function vv(l){if(l instanceof Pt)return l.clone();var m=new Cr(l.__wrapped__,l.__chain__);return m.__actions__=Xn(l.__actions__),m.__index__=l.__index__,m.__values__=l.__values__,m}function pk(l,m,j){(j?Fn(l,m,j):m===n)?m=1:m=rn(lt(m),0);var C=l==null?0:l.length;if(!C||m<1)return[];for(var A=0,F=0,V=ue(Zd(C/m));A<C;)V[F++]=Tr(l,A,A+=m);return V}function xk(l){for(var m=-1,j=l==null?0:l.length,C=0,A=[];++m<j;){var F=l[m];F&&(A[C++]=F)}return A}function gk(){var l=arguments.length;if(!l)return[];for(var m=ue(l-1),j=arguments[0],C=l;C--;)m[C-1]=arguments[C];return wi(at(j)?Xn(j):[j],bn(m,1))}var vk=pt(function(l,m){return Fs(l)?ic(l,bn(m,1,Fs,!0)):[]}),yk=pt(function(l,m){var j=Dr(m);return Fs(j)&&(j=n),Fs(l)?ic(l,bn(m,1,Fs,!0),Ze(j,2)):[]}),bk=pt(function(l,m){var j=Dr(m);return Fs(j)&&(j=n),Fs(l)?ic(l,bn(m,1,Fs,!0),n,j):[]});function jk(l,m,j){var C=l==null?0:l.length;return C?(m=j||m===n?1:lt(m),Tr(l,m<0?0:m,C)):[]}function wk(l,m,j){var C=l==null?0:l.length;return C?(m=j||m===n?1:lt(m),m=C-m,Tr(l,0,m<0?0:m)):[]}function Nk(l,m){return l&&l.length?lu(l,Ze(m,3),!0,!0):[]}function Sk(l,m){return l&&l.length?lu(l,Ze(m,3),!0):[]}function Ck(l,m,j,C){var A=l==null?0:l.length;return A?(j&&typeof j!="number"&&Fn(l,m,j)&&(j=0,C=A),gD(l,m,j,C)):[]}function yv(l,m,j){var C=l==null?0:l.length;if(!C)return-1;var A=j==null?0:lt(j);return A<0&&(A=rn(C+A,0)),Bd(l,Ze(m,3),A)}function bv(l,m,j){var C=l==null?0:l.length;if(!C)return-1;var A=C-1;return j!==n&&(A=lt(j),A=j<0?rn(C+A,0):Tn(A,C-1)),Bd(l,Ze(m,3),A,!0)}function jv(l){var m=l==null?0:l.length;return m?bn(l,1):[]}function Ek(l){var m=l==null?0:l.length;return m?bn(l,z):[]}function Tk(l,m){var j=l==null?0:l.length;return j?(m=m===n?1:lt(m),bn(l,m)):[]}function Dk(l){for(var m=-1,j=l==null?0:l.length,C={};++m<j;){var A=l[m];C[A[0]]=A[1]}return C}function wv(l){return l&&l.length?l[0]:n}function kk(l,m,j){var C=l==null?0:l.length;if(!C)return-1;var A=j==null?0:lt(j);return A<0&&(A=rn(C+A,0)),Qo(l,m,A)}function Ak(l){var m=l==null?0:l.length;return m?Tr(l,0,-1):[]}var _k=pt(function(l){var m=Es(l,Gh);return m.length&&m[0]===l[0]?Lh(m):[]}),Rk=pt(function(l){var m=Dr(l),j=Es(l,Gh);return m===Dr(j)?m=n:j.pop(),j.length&&j[0]===l[0]?Lh(j,Ze(m,2)):[]}),Ok=pt(function(l){var m=Dr(l),j=Es(l,Gh);return m=typeof m=="function"?m:n,m&&j.pop(),j.length&&j[0]===l[0]?Lh(j,n,m):[]});function Pk(l,m){return l==null?"":AT.call(l,m)}function Dr(l){var m=l==null?0:l.length;return m?l[m-1]:n}function Mk(l,m,j){var C=l==null?0:l.length;if(!C)return-1;var A=C;return j!==n&&(A=lt(j),A=A<0?rn(C+A,0):Tn(A,C-1)),m===m?fT(l,m,A):Bd(l,s0,A,!0)}function Ik(l,m){return l&&l.length?O0(l,lt(m)):n}var Lk=pt(Nv);function Nv(l,m){return l&&l.length&&m&&m.length?Bh(l,m):l}function $k(l,m,j){return l&&l.length&&m&&m.length?Bh(l,m,Ze(j,2)):l}function zk(l,m,j){return l&&l.length&&m&&m.length?Bh(l,m,n,j):l}var Fk=Ka(function(l,m){var j=l==null?0:l.length,C=Oh(l,m);return I0(l,Es(m,function(A){return Ja(A,j)?+A:A}).sort(V0)),C});function Bk(l,m){var j=[];if(!(l&&l.length))return j;var C=-1,A=[],F=l.length;for(m=Ze(m,3);++C<F;){var V=l[C];m(V,C,l)&&(j.push(V),A.push(C))}return I0(l,A),j}function lf(l){return l==null?l:PT.call(l)}function Hk(l,m,j){var C=l==null?0:l.length;return C?(j&&typeof j!="number"&&Fn(l,m,j)?(m=0,j=C):(m=m==null?0:lt(m),j=j===n?C:lt(j)),Tr(l,m,j)):[]}function Uk(l,m){return ou(l,m)}function Wk(l,m,j){return Wh(l,m,Ze(j,2))}function Yk(l,m){var j=l==null?0:l.length;if(j){var C=ou(l,m);if(C<j&&Yr(l[C],m))return C}return-1}function Vk(l,m){return ou(l,m,!0)}function Gk(l,m,j){return Wh(l,m,Ze(j,2),!0)}function qk(l,m){var j=l==null?0:l.length;if(j){var C=ou(l,m,!0)-1;if(Yr(l[C],m))return C}return-1}function Kk(l){return l&&l.length?$0(l):[]}function Jk(l,m){return l&&l.length?$0(l,Ze(m,2)):[]}function Xk(l){var m=l==null?0:l.length;return m?Tr(l,1,m):[]}function Zk(l,m,j){return l&&l.length?(m=j||m===n?1:lt(m),Tr(l,0,m<0?0:m)):[]}function Qk(l,m,j){var C=l==null?0:l.length;return C?(m=j||m===n?1:lt(m),m=C-m,Tr(l,m<0?0:m,C)):[]}function eA(l,m){return l&&l.length?lu(l,Ze(m,3),!1,!0):[]}function tA(l,m){return l&&l.length?lu(l,Ze(m,3)):[]}var sA=pt(function(l){return Ei(bn(l,1,Fs,!0))}),nA=pt(function(l){var m=Dr(l);return Fs(m)&&(m=n),Ei(bn(l,1,Fs,!0),Ze(m,2))}),rA=pt(function(l){var m=Dr(l);return m=typeof m=="function"?m:n,Ei(bn(l,1,Fs,!0),n,m)});function aA(l){return l&&l.length?Ei(l):[]}function iA(l,m){return l&&l.length?Ei(l,Ze(m,2)):[]}function oA(l,m){return m=typeof m=="function"?m:n,l&&l.length?Ei(l,n,m):[]}function cf(l){if(!(l&&l.length))return[];var m=0;return l=ji(l,function(j){if(Fs(j))return m=rn(j.length,m),!0}),Ch(m,function(j){return Es(l,wh(j))})}function Sv(l,m){if(!(l&&l.length))return[];var j=cf(l);return m==null?j:Es(j,function(C){return ur(m,n,C)})}var lA=pt(function(l,m){return Fs(l)?ic(l,m):[]}),cA=pt(function(l){return Vh(ji(l,Fs))}),dA=pt(function(l){var m=Dr(l);return Fs(m)&&(m=n),Vh(ji(l,Fs),Ze(m,2))}),uA=pt(function(l){var m=Dr(l);return m=typeof m=="function"?m:n,Vh(ji(l,Fs),n,m)}),mA=pt(cf);function hA(l,m){return H0(l||[],m||[],ac)}function fA(l,m){return H0(l||[],m||[],cc)}var pA=pt(function(l){var m=l.length,j=m>1?l[m-1]:n;return j=typeof j=="function"?(l.pop(),j):n,Sv(l,j)});function Cv(l){var m=L(l);return m.__chain__=!0,m}function xA(l,m){return m(l),l}function gu(l,m){return m(l)}var gA=Ka(function(l){var m=l.length,j=m?l[0]:0,C=this.__wrapped__,A=function(F){return Oh(F,l)};return m>1||this.__actions__.length||!(C instanceof Pt)||!Ja(j)?this.thru(A):(C=C.slice(j,+j+(m?1:0)),C.__actions__.push({func:gu,args:[A],thisArg:n}),new Cr(C,this.__chain__).thru(function(F){return m&&!F.length&&F.push(n),F}))});function vA(){return Cv(this)}function yA(){return new Cr(this.value(),this.__chain__)}function bA(){this.__values__===n&&(this.__values__=zv(this.value()));var l=this.__index__>=this.__values__.length,m=l?n:this.__values__[this.__index__++];return{done:l,value:m}}function jA(){return this}function wA(l){for(var m,j=this;j instanceof su;){var C=vv(j);C.__index__=0,C.__values__=n,m?A.__wrapped__=C:m=C;var A=C;j=j.__wrapped__}return A.__wrapped__=l,m}function NA(){var l=this.__wrapped__;if(l instanceof Pt){var m=l;return this.__actions__.length&&(m=new Pt(this)),m=m.reverse(),m.__actions__.push({func:gu,args:[lf],thisArg:n}),new Cr(m,this.__chain__)}return this.thru(lf)}function SA(){return B0(this.__wrapped__,this.__actions__)}var CA=cu(function(l,m,j){is.call(l,j)?++l[j]:Ga(l,j,1)});function EA(l,m,j){var C=at(l)?e0:xD;return j&&Fn(l,m,j)&&(m=n),C(l,Ze(m,3))}function TA(l,m){var j=at(l)?ji:S0;return j(l,Ze(m,3))}var DA=Z0(yv),kA=Z0(bv);function AA(l,m){return bn(vu(l,m),1)}function _A(l,m){return bn(vu(l,m),z)}function RA(l,m,j){return j=j===n?1:lt(j),bn(vu(l,m),j)}function Ev(l,m){var j=at(l)?Nr:Ci;return j(l,Ze(m,3))}function Tv(l,m){var j=at(l)?XE:N0;return j(l,Ze(m,3))}var OA=cu(function(l,m,j){is.call(l,j)?l[j].push(m):Ga(l,j,[m])});function PA(l,m,j,C){l=Zn(l)?l:ul(l),j=j&&!C?lt(j):0;var A=l.length;return j<0&&(j=rn(A+j,0)),Nu(l)?j<=A&&l.indexOf(m,j)>-1:!!A&&Qo(l,m,j)>-1}var MA=pt(function(l,m,j){var C=-1,A=typeof m=="function",F=Zn(l)?ue(l.length):[];return Ci(l,function(V){F[++C]=A?ur(m,V,j):oc(V,m,j)}),F}),IA=cu(function(l,m,j){Ga(l,j,m)});function vu(l,m){var j=at(l)?Es:A0;return j(l,Ze(m,3))}function LA(l,m,j,C){return l==null?[]:(at(m)||(m=m==null?[]:[m]),j=C?n:j,at(j)||(j=j==null?[]:[j]),P0(l,m,j))}var $A=cu(function(l,m,j){l[j?0:1].push(m)},function(){return[[],[]]});function zA(l,m,j){var C=at(l)?bh:r0,A=arguments.length<3;return C(l,Ze(m,4),j,A,Ci)}function FA(l,m,j){var C=at(l)?ZE:r0,A=arguments.length<3;return C(l,Ze(m,4),j,A,N0)}function BA(l,m){var j=at(l)?ji:S0;return j(l,ju(Ze(m,3)))}function HA(l){var m=at(l)?y0:PD;return m(l)}function UA(l,m,j){(j?Fn(l,m,j):m===n)?m=1:m=lt(m);var C=at(l)?uD:MD;return C(l,m)}function WA(l){var m=at(l)?mD:LD;return m(l)}function YA(l){if(l==null)return 0;if(Zn(l))return Nu(l)?tl(l):l.length;var m=Dn(l);return m==ye||m==ne?l.size:zh(l).length}function VA(l,m,j){var C=at(l)?jh:$D;return j&&Fn(l,m,j)&&(m=n),C(l,Ze(m,3))}var GA=pt(function(l,m){if(l==null)return[];var j=m.length;return j>1&&Fn(l,m[0],m[1])?m=[]:j>2&&Fn(m[0],m[1],m[2])&&(m=[m[0]]),P0(l,bn(m,1),[])}),yu=TT||function(){return yn.Date.now()};function qA(l,m){if(typeof m!="function")throw new Sr(o);return l=lt(l),function(){if(--l<1)return m.apply(this,arguments)}}function Dv(l,m,j){return m=j?n:m,m=l&&m==null?l.length:m,qa(l,T,n,n,n,n,m)}function kv(l,m){var j;if(typeof m!="function")throw new Sr(o);return l=lt(l),function(){return--l>0&&(j=m.apply(this,arguments)),l<=1&&(m=n),j}}var df=pt(function(l,m,j){var C=v;if(j.length){var A=Ni(j,cl(df));C|=k}return qa(l,C,m,j,A)}),Av=pt(function(l,m,j){var C=v|w;if(j.length){var A=Ni(j,cl(Av));C|=k}return qa(m,C,l,j,A)});function _v(l,m,j){m=j?n:m;var C=qa(l,S,n,n,n,n,n,m);return C.placeholder=_v.placeholder,C}function Rv(l,m,j){m=j?n:m;var C=qa(l,E,n,n,n,n,n,m);return C.placeholder=Rv.placeholder,C}function Ov(l,m,j){var C,A,F,V,Z,re,ve=0,be=!1,we=!1,Oe=!0;if(typeof l!="function")throw new Sr(o);m=kr(m)||0,ks(j)&&(be=!!j.leading,we="maxWait"in j,F=we?rn(kr(j.maxWait)||0,m):F,Oe="trailing"in j?!!j.trailing:Oe);function We(Bs){var Vr=C,Qa=A;return C=A=n,ve=Bs,V=l.apply(Qa,Vr),V}function Qe(Bs){return ve=Bs,Z=mc(St,m),be?We(Bs):V}function mt(Bs){var Vr=Bs-re,Qa=Bs-ve,Zv=m-Vr;return we?Tn(Zv,F-Qa):Zv}function et(Bs){var Vr=Bs-re,Qa=Bs-ve;return re===n||Vr>=m||Vr<0||we&&Qa>=F}function St(){var Bs=yu();if(et(Bs))return zt(Bs);Z=mc(St,mt(Bs))}function zt(Bs){return Z=n,Oe&&C?We(Bs):(C=A=n,V)}function pr(){Z!==n&&U0(Z),ve=0,C=re=A=Z=n}function Bn(){return Z===n?V:zt(yu())}function xr(){var Bs=yu(),Vr=et(Bs);if(C=arguments,A=this,re=Bs,Vr){if(Z===n)return Qe(re);if(we)return U0(Z),Z=mc(St,m),We(re)}return Z===n&&(Z=mc(St,m)),V}return xr.cancel=pr,xr.flush=Bn,xr}var KA=pt(function(l,m){return w0(l,1,m)}),JA=pt(function(l,m,j){return w0(l,kr(m)||0,j)});function XA(l){return qa(l,O)}function bu(l,m){if(typeof l!="function"||m!=null&&typeof m!="function")throw new Sr(o);var j=function(){var C=arguments,A=m?m.apply(this,C):C[0],F=j.cache;if(F.has(A))return F.get(A);var V=l.apply(this,C);return j.cache=F.set(A,V)||F,V};return j.cache=new(bu.Cache||Va),j}bu.Cache=Va;function ju(l){if(typeof l!="function")throw new Sr(o);return function(){var m=arguments;switch(m.length){case 0:return!l.call(this);case 1:return!l.call(this,m[0]);case 2:return!l.call(this,m[0],m[1]);case 3:return!l.call(this,m[0],m[1],m[2])}return!l.apply(this,m)}}function ZA(l){return kv(2,l)}var QA=zD(function(l,m){m=m.length==1&&at(m[0])?Es(m[0],mr(Ze())):Es(bn(m,1),mr(Ze()));var j=m.length;return pt(function(C){for(var A=-1,F=Tn(C.length,j);++A<F;)C[A]=m[A].call(this,C[A]);return ur(l,this,C)})}),uf=pt(function(l,m){var j=Ni(m,cl(uf));return qa(l,k,n,m,j)}),Pv=pt(function(l,m){var j=Ni(m,cl(Pv));return qa(l,D,n,m,j)}),e_=Ka(function(l,m){return qa(l,R,n,n,n,m)});function t_(l,m){if(typeof l!="function")throw new Sr(o);return m=m===n?m:lt(m),pt(l,m)}function s_(l,m){if(typeof l!="function")throw new Sr(o);return m=m==null?0:rn(lt(m),0),pt(function(j){var C=j[m],A=Di(j,0,m);return C&&wi(A,C),ur(l,this,A)})}function n_(l,m,j){var C=!0,A=!0;if(typeof l!="function")throw new Sr(o);return ks(j)&&(C="leading"in j?!!j.leading:C,A="trailing"in j?!!j.trailing:A),Ov(l,m,{leading:C,maxWait:m,trailing:A})}function r_(l){return Dv(l,1)}function a_(l,m){return uf(qh(m),l)}function i_(){if(!arguments.length)return[];var l=arguments[0];return at(l)?l:[l]}function o_(l){return Er(l,x)}function l_(l,m){return m=typeof m=="function"?m:n,Er(l,x,m)}function c_(l){return Er(l,p|x)}function d_(l,m){return m=typeof m=="function"?m:n,Er(l,p|x,m)}function u_(l,m){return m==null||j0(l,m,un(m))}function Yr(l,m){return l===m||l!==l&&m!==m}var m_=hu(Ih),h_=hu(function(l,m){return l>=m}),Eo=T0(function(){return arguments}())?T0:function(l){return Ms(l)&&is.call(l,"callee")&&!h0.call(l,"callee")},at=ue.isArray,f_=qg?mr(qg):wD;function Zn(l){return l!=null&&wu(l.length)&&!Xa(l)}function Fs(l){return Ms(l)&&Zn(l)}function p_(l){return l===!0||l===!1||Ms(l)&&zn(l)==de}var ki=kT||wf,x_=Kg?mr(Kg):ND;function g_(l){return Ms(l)&&l.nodeType===1&&!hc(l)}function v_(l){if(l==null)return!0;if(Zn(l)&&(at(l)||typeof l=="string"||typeof l.splice=="function"||ki(l)||dl(l)||Eo(l)))return!l.length;var m=Dn(l);if(m==ye||m==ne)return!l.size;if(uc(l))return!zh(l).length;for(var j in l)if(is.call(l,j))return!1;return!0}function y_(l,m){return lc(l,m)}function b_(l,m,j){j=typeof j=="function"?j:n;var C=j?j(l,m):n;return C===n?lc(l,m,n,j):!!C}function mf(l){if(!Ms(l))return!1;var m=zn(l);return m==Se||m==ge||typeof l.message=="string"&&typeof l.name=="string"&&!hc(l)}function j_(l){return typeof l=="number"&&p0(l)}function Xa(l){if(!ks(l))return!1;var m=zn(l);return m==oe||m==J||m==K||m==Ss}function Mv(l){return typeof l=="number"&&l==lt(l)}function wu(l){return typeof l=="number"&&l>-1&&l%1==0&&l<=G}function ks(l){var m=typeof l;return l!=null&&(m=="object"||m=="function")}function Ms(l){return l!=null&&typeof l=="object"}var Iv=Jg?mr(Jg):CD;function w_(l,m){return l===m||$h(l,m,tf(m))}function N_(l,m,j){return j=typeof j=="function"?j:n,$h(l,m,tf(m),j)}function S_(l){return Lv(l)&&l!=+l}function C_(l){if(lk(l))throw new rt(i);return D0(l)}function E_(l){return l===null}function T_(l){return l==null}function Lv(l){return typeof l=="number"||Ms(l)&&zn(l)==xt}function hc(l){if(!Ms(l)||zn(l)!=dt)return!1;var m=Kd(l);if(m===null)return!0;var j=is.call(m,"constructor")&&m.constructor;return typeof j=="function"&&j instanceof j&&Yd.call(j)==NT}var hf=Xg?mr(Xg):ED;function D_(l){return Mv(l)&&l>=-G&&l<=G}var $v=Zg?mr(Zg):TD;function Nu(l){return typeof l=="string"||!at(l)&&Ms(l)&&zn(l)==me}function fr(l){return typeof l=="symbol"||Ms(l)&&zn(l)==Te}var dl=Qg?mr(Qg):DD;function k_(l){return l===n}function A_(l){return Ms(l)&&Dn(l)==Ne}function __(l){return Ms(l)&&zn(l)==Re}var R_=hu(Fh),O_=hu(function(l,m){return l<=m});function zv(l){if(!l)return[];if(Zn(l))return Nu(l)?Ur(l):Xn(l);if(ec&&l[ec])return uT(l[ec]());var m=Dn(l),j=m==ye?Th:m==ne?Hd:ul;return j(l)}function Za(l){if(!l)return l===0?l:0;if(l=kr(l),l===z||l===-z){var m=l<0?-1:1;return m*ae}return l===l?l:0}function lt(l){var m=Za(l),j=m%1;return m===m?j?m-j:m:0}function Fv(l){return l?wo(lt(l),0,X):0}function kr(l){if(typeof l=="number")return l;if(fr(l))return Y;if(ks(l)){var m=typeof l.valueOf=="function"?l.valueOf():l;l=ks(m)?m+"":m}if(typeof l!="string")return l===0?l:+l;l=a0(l);var j=uh.test(l);return j||Q.test(l)?qE(l.slice(2),j?2:8):Ld.test(l)?Y:+l}function Bv(l){return Sa(l,Qn(l))}function P_(l){return l?wo(lt(l),-G,G):l===0?l:0}function ts(l){return l==null?"":hr(l)}var M_=ol(function(l,m){if(uc(m)||Zn(m)){Sa(m,un(m),l);return}for(var j in m)is.call(m,j)&&ac(l,j,m[j])}),Hv=ol(function(l,m){Sa(m,Qn(m),l)}),Su=ol(function(l,m,j,C){Sa(m,Qn(m),l,C)}),I_=ol(function(l,m,j,C){Sa(m,un(m),l,C)}),L_=Ka(Oh);function $_(l,m){var j=il(l);return m==null?j:b0(j,m)}var z_=pt(function(l,m){l=us(l);var j=-1,C=m.length,A=C>2?m[2]:n;for(A&&Fn(m[0],m[1],A)&&(C=1);++j<C;)for(var F=m[j],V=Qn(F),Z=-1,re=V.length;++Z<re;){var ve=V[Z],be=l[ve];(be===n||Yr(be,nl[ve])&&!is.call(l,ve))&&(l[ve]=F[ve])}return l}),F_=pt(function(l){return l.push(n,av),ur(Uv,n,l)});function B_(l,m){return t0(l,Ze(m,3),Na)}function H_(l,m){return t0(l,Ze(m,3),Mh)}function U_(l,m){return l==null?l:Ph(l,Ze(m,3),Qn)}function W_(l,m){return l==null?l:C0(l,Ze(m,3),Qn)}function Y_(l,m){return l&&Na(l,Ze(m,3))}function V_(l,m){return l&&Mh(l,Ze(m,3))}function G_(l){return l==null?[]:au(l,un(l))}function q_(l){return l==null?[]:au(l,Qn(l))}function ff(l,m,j){var C=l==null?n:No(l,m);return C===n?j:C}function K_(l,m){return l!=null&&lv(l,m,vD)}function pf(l,m){return l!=null&&lv(l,m,yD)}var J_=ev(function(l,m,j){m!=null&&typeof m.toString!="function"&&(m=Vd.call(m)),l[m]=j},gf(er)),X_=ev(function(l,m,j){m!=null&&typeof m.toString!="function"&&(m=Vd.call(m)),is.call(l,m)?l[m].push(j):l[m]=[j]},Ze),Z_=pt(oc);function un(l){return Zn(l)?v0(l):zh(l)}function Qn(l){return Zn(l)?v0(l,!0):kD(l)}function Q_(l,m){var j={};return m=Ze(m,3),Na(l,function(C,A,F){Ga(j,m(C,A,F),C)}),j}function e2(l,m){var j={};return m=Ze(m,3),Na(l,function(C,A,F){Ga(j,A,m(C,A,F))}),j}var t2=ol(function(l,m,j){iu(l,m,j)}),Uv=ol(function(l,m,j,C){iu(l,m,j,C)}),s2=Ka(function(l,m){var j={};if(l==null)return j;var C=!1;m=Es(m,function(F){return F=Ti(F,l),C||(C=F.length>1),F}),Sa(l,Qh(l),j),C&&(j=Er(j,p|g|x,JD));for(var A=m.length;A--;)Yh(j,m[A]);return j});function n2(l,m){return Wv(l,ju(Ze(m)))}var r2=Ka(function(l,m){return l==null?{}:_D(l,m)});function Wv(l,m){if(l==null)return{};var j=Es(Qh(l),function(C){return[C]});return m=Ze(m),M0(l,j,function(C,A){return m(C,A[0])})}function a2(l,m,j){m=Ti(m,l);var C=-1,A=m.length;for(A||(A=1,l=n);++C<A;){var F=l==null?n:l[Ca(m[C])];F===n&&(C=A,F=j),l=Xa(F)?F.call(l):F}return l}function i2(l,m,j){return l==null?l:cc(l,m,j)}function o2(l,m,j,C){return C=typeof C=="function"?C:n,l==null?l:cc(l,m,j,C)}var Yv=nv(un),Vv=nv(Qn);function l2(l,m,j){var C=at(l),A=C||ki(l)||dl(l);if(m=Ze(m,4),j==null){var F=l&&l.constructor;A?j=C?new F:[]:ks(l)?j=Xa(F)?il(Kd(l)):{}:j={}}return(A?Nr:Na)(l,function(V,Z,re){return m(j,V,Z,re)}),j}function c2(l,m){return l==null?!0:Yh(l,m)}function d2(l,m,j){return l==null?l:F0(l,m,qh(j))}function u2(l,m,j,C){return C=typeof C=="function"?C:n,l==null?l:F0(l,m,qh(j),C)}function ul(l){return l==null?[]:Eh(l,un(l))}function m2(l){return l==null?[]:Eh(l,Qn(l))}function h2(l,m,j){return j===n&&(j=m,m=n),j!==n&&(j=kr(j),j=j===j?j:0),m!==n&&(m=kr(m),m=m===m?m:0),wo(kr(l),m,j)}function f2(l,m,j){return m=Za(m),j===n?(j=m,m=0):j=Za(j),l=kr(l),bD(l,m,j)}function p2(l,m,j){if(j&&typeof j!="boolean"&&Fn(l,m,j)&&(m=j=n),j===n&&(typeof m=="boolean"?(j=m,m=n):typeof l=="boolean"&&(j=l,l=n)),l===n&&m===n?(l=0,m=1):(l=Za(l),m===n?(m=l,l=0):m=Za(m)),l>m){var C=l;l=m,m=C}if(j||l%1||m%1){var A=x0();return Tn(l+A*(m-l+GE("1e-"+((A+"").length-1))),m)}return Hh(l,m)}var x2=ll(function(l,m,j){return m=m.toLowerCase(),l+(j?Gv(m):m)});function Gv(l){return xf(ts(l).toLowerCase())}function qv(l){return l=ts(l),l&&l.replace(He,iT).replace(LE,"")}function g2(l,m,j){l=ts(l),m=hr(m);var C=l.length;j=j===n?C:wo(lt(j),0,C);var A=j;return j-=m.length,j>=0&&l.slice(j,A)==m}function v2(l){return l=ts(l),l&&Lt.test(l)?l.replace(Ge,oT):l}function y2(l){return l=ts(l),l&&gs.test(l)?l.replace(xs,"\\$&"):l}var b2=ll(function(l,m,j){return l+(j?"-":"")+m.toLowerCase()}),j2=ll(function(l,m,j){return l+(j?" ":"")+m.toLowerCase()}),w2=X0("toLowerCase");function N2(l,m,j){l=ts(l),m=lt(m);var C=m?tl(l):0;if(!m||C>=m)return l;var A=(m-C)/2;return mu(Qd(A),j)+l+mu(Zd(A),j)}function S2(l,m,j){l=ts(l),m=lt(m);var C=m?tl(l):0;return m&&C<m?l+mu(m-C,j):l}function C2(l,m,j){l=ts(l),m=lt(m);var C=m?tl(l):0;return m&&C<m?mu(m-C,j)+l:l}function E2(l,m,j){return j||m==null?m=0:m&&(m=+m),OT(ts(l).replace(Wt,""),m||0)}function T2(l,m,j){return(j?Fn(l,m,j):m===n)?m=1:m=lt(m),Uh(ts(l),m)}function D2(){var l=arguments,m=ts(l[0]);return l.length<3?m:m.replace(l[1],l[2])}var k2=ll(function(l,m,j){return l+(j?"_":"")+m.toLowerCase()});function A2(l,m,j){return j&&typeof j!="number"&&Fn(l,m,j)&&(m=j=n),j=j===n?X:j>>>0,j?(l=ts(l),l&&(typeof m=="string"||m!=null&&!hf(m))&&(m=hr(m),!m&&el(l))?Di(Ur(l),0,j):l.split(m,j)):[]}var _2=ll(function(l,m,j){return l+(j?" ":"")+xf(m)});function R2(l,m,j){return l=ts(l),j=j==null?0:wo(lt(j),0,l.length),m=hr(m),l.slice(j,j+m.length)==m}function O2(l,m,j){var C=L.templateSettings;j&&Fn(l,m,j)&&(m=n),l=ts(l),m=Su({},m,C,rv);var A=Su({},m.imports,C.imports,rv),F=un(A),V=Eh(A,F),Z,re,ve=0,be=m.interpolate||as,we="__p += '",Oe=Dh((m.escape||as).source+"|"+be.source+"|"+(be===Xe?Id:as).source+"|"+(m.evaluate||as).source+"|$","g"),We="//# sourceURL="+(is.call(m,"sourceURL")?(m.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++HE+"]")+`
`;l.replace(Oe,function(et,St,zt,pr,Bn,xr){return zt||(zt=pr),we+=l.slice(ve,xr).replace(dn,lT),St&&(Z=!0,we+=`' +
__e(`+St+`) +
'`),Bn&&(re=!0,we+=`';
`+Bn+`;
__p += '`),zt&&(we+=`' +
((__t = (`+zt+`)) == null ? '' : __t) +
'`),ve=xr+et.length,et}),we+=`';
`;var Qe=is.call(m,"variable")&&m.variable;if(!Qe)we=`with (obj) {
`+we+`
}
`;else if(Br.test(Qe))throw new rt(c);we=(re?we.replace(Ve,""):we).replace(ut,"$1").replace(Nt,"$1;"),we="function("+(Qe||"obj")+`) {
`+(Qe?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(Z?", __e = _.escape":"")+(re?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+we+`return __p
}`;var mt=Jv(function(){return Jt(F,We+"return "+we).apply(n,V)});if(mt.source=we,mf(mt))throw mt;return mt}function P2(l){return ts(l).toLowerCase()}function M2(l){return ts(l).toUpperCase()}function I2(l,m,j){if(l=ts(l),l&&(j||m===n))return a0(l);if(!l||!(m=hr(m)))return l;var C=Ur(l),A=Ur(m),F=i0(C,A),V=o0(C,A)+1;return Di(C,F,V).join("")}function L2(l,m,j){if(l=ts(l),l&&(j||m===n))return l.slice(0,c0(l)+1);if(!l||!(m=hr(m)))return l;var C=Ur(l),A=o0(C,Ur(m))+1;return Di(C,0,A).join("")}function $2(l,m,j){if(l=ts(l),l&&(j||m===n))return l.replace(Wt,"");if(!l||!(m=hr(m)))return l;var C=Ur(l),A=i0(C,Ur(m));return Di(C,A).join("")}function z2(l,m){var j=U,C=I;if(ks(m)){var A="separator"in m?m.separator:A;j="length"in m?lt(m.length):j,C="omission"in m?hr(m.omission):C}l=ts(l);var F=l.length;if(el(l)){var V=Ur(l);F=V.length}if(j>=F)return l;var Z=j-tl(C);if(Z<1)return C;var re=V?Di(V,0,Z).join(""):l.slice(0,Z);if(A===n)return re+C;if(V&&(Z+=re.length-Z),hf(A)){if(l.slice(Z).search(A)){var ve,be=re;for(A.global||(A=Dh(A.source,ts(Xl.exec(A))+"g")),A.lastIndex=0;ve=A.exec(be);)var we=ve.index;re=re.slice(0,we===n?Z:we)}}else if(l.indexOf(hr(A),Z)!=Z){var Oe=re.lastIndexOf(A);Oe>-1&&(re=re.slice(0,Oe))}return re+C}function F2(l){return l=ts(l),l&&ft.test(l)?l.replace(Ut,pT):l}var B2=ll(function(l,m,j){return l+(j?" ":"")+m.toUpperCase()}),xf=X0("toUpperCase");function Kv(l,m,j){return l=ts(l),m=j?n:m,m===n?dT(l)?vT(l):tT(l):l.match(m)||[]}var Jv=pt(function(l,m){try{return ur(l,n,m)}catch(j){return mf(j)?j:new rt(j)}}),H2=Ka(function(l,m){return Nr(m,function(j){j=Ca(j),Ga(l,j,df(l[j],l))}),l});function U2(l){var m=l==null?0:l.length,j=Ze();return l=m?Es(l,function(C){if(typeof C[1]!="function")throw new Sr(o);return[j(C[0]),C[1]]}):[],pt(function(C){for(var A=-1;++A<m;){var F=l[A];if(ur(F[0],this,C))return ur(F[1],this,C)}})}function W2(l){return pD(Er(l,p))}function gf(l){return function(){return l}}function Y2(l,m){return l==null||l!==l?m:l}var V2=Q0(),G2=Q0(!0);function er(l){return l}function vf(l){return k0(typeof l=="function"?l:Er(l,p))}function q2(l){return _0(Er(l,p))}function K2(l,m){return R0(l,Er(m,p))}var J2=pt(function(l,m){return function(j){return oc(j,l,m)}}),X2=pt(function(l,m){return function(j){return oc(l,j,m)}});function yf(l,m,j){var C=un(m),A=au(m,C);j==null&&!(ks(m)&&(A.length||!C.length))&&(j=m,m=l,l=this,A=au(m,un(m)));var F=!(ks(j)&&"chain"in j)||!!j.chain,V=Xa(l);return Nr(A,function(Z){var re=m[Z];l[Z]=re,V&&(l.prototype[Z]=function(){var ve=this.__chain__;if(F||ve){var be=l(this.__wrapped__),we=be.__actions__=Xn(this.__actions__);return we.push({func:re,args:arguments,thisArg:l}),be.__chain__=ve,be}return re.apply(l,wi([this.value()],arguments))})}),l}function Z2(){return yn._===this&&(yn._=ST),this}function bf(){}function Q2(l){return l=lt(l),pt(function(m){return O0(m,l)})}var eR=Jh(Es),tR=Jh(e0),sR=Jh(jh);function Xv(l){return nf(l)?wh(Ca(l)):RD(l)}function nR(l){return function(m){return l==null?n:No(l,m)}}var rR=tv(),aR=tv(!0);function jf(){return[]}function wf(){return!1}function iR(){return{}}function oR(){return""}function lR(){return!0}function cR(l,m){if(l=lt(l),l<1||l>G)return[];var j=X,C=Tn(l,X);m=Ze(m),l-=X;for(var A=Ch(C,m);++j<l;)m(j);return A}function dR(l){return at(l)?Es(l,Ca):fr(l)?[l]:Xn(gv(ts(l)))}function uR(l){var m=++wT;return ts(l)+m}var mR=uu(function(l,m){return l+m},0),hR=Xh("ceil"),fR=uu(function(l,m){return l/m},1),pR=Xh("floor");function xR(l){return l&&l.length?ru(l,er,Ih):n}function gR(l,m){return l&&l.length?ru(l,Ze(m,2),Ih):n}function vR(l){return n0(l,er)}function yR(l,m){return n0(l,Ze(m,2))}function bR(l){return l&&l.length?ru(l,er,Fh):n}function jR(l,m){return l&&l.length?ru(l,Ze(m,2),Fh):n}var wR=uu(function(l,m){return l*m},1),NR=Xh("round"),SR=uu(function(l,m){return l-m},0);function CR(l){return l&&l.length?Sh(l,er):0}function ER(l,m){return l&&l.length?Sh(l,Ze(m,2)):0}return L.after=qA,L.ary=Dv,L.assign=M_,L.assignIn=Hv,L.assignInWith=Su,L.assignWith=I_,L.at=L_,L.before=kv,L.bind=df,L.bindAll=H2,L.bindKey=Av,L.castArray=i_,L.chain=Cv,L.chunk=pk,L.compact=xk,L.concat=gk,L.cond=U2,L.conforms=W2,L.constant=gf,L.countBy=CA,L.create=$_,L.curry=_v,L.curryRight=Rv,L.debounce=Ov,L.defaults=z_,L.defaultsDeep=F_,L.defer=KA,L.delay=JA,L.difference=vk,L.differenceBy=yk,L.differenceWith=bk,L.drop=jk,L.dropRight=wk,L.dropRightWhile=Nk,L.dropWhile=Sk,L.fill=Ck,L.filter=TA,L.flatMap=AA,L.flatMapDeep=_A,L.flatMapDepth=RA,L.flatten=jv,L.flattenDeep=Ek,L.flattenDepth=Tk,L.flip=XA,L.flow=V2,L.flowRight=G2,L.fromPairs=Dk,L.functions=G_,L.functionsIn=q_,L.groupBy=OA,L.initial=Ak,L.intersection=_k,L.intersectionBy=Rk,L.intersectionWith=Ok,L.invert=J_,L.invertBy=X_,L.invokeMap=MA,L.iteratee=vf,L.keyBy=IA,L.keys=un,L.keysIn=Qn,L.map=vu,L.mapKeys=Q_,L.mapValues=e2,L.matches=q2,L.matchesProperty=K2,L.memoize=bu,L.merge=t2,L.mergeWith=Uv,L.method=J2,L.methodOf=X2,L.mixin=yf,L.negate=ju,L.nthArg=Q2,L.omit=s2,L.omitBy=n2,L.once=ZA,L.orderBy=LA,L.over=eR,L.overArgs=QA,L.overEvery=tR,L.overSome=sR,L.partial=uf,L.partialRight=Pv,L.partition=$A,L.pick=r2,L.pickBy=Wv,L.property=Xv,L.propertyOf=nR,L.pull=Lk,L.pullAll=Nv,L.pullAllBy=$k,L.pullAllWith=zk,L.pullAt=Fk,L.range=rR,L.rangeRight=aR,L.rearg=e_,L.reject=BA,L.remove=Bk,L.rest=t_,L.reverse=lf,L.sampleSize=UA,L.set=i2,L.setWith=o2,L.shuffle=WA,L.slice=Hk,L.sortBy=GA,L.sortedUniq=Kk,L.sortedUniqBy=Jk,L.split=A2,L.spread=s_,L.tail=Xk,L.take=Zk,L.takeRight=Qk,L.takeRightWhile=eA,L.takeWhile=tA,L.tap=xA,L.throttle=n_,L.thru=gu,L.toArray=zv,L.toPairs=Yv,L.toPairsIn=Vv,L.toPath=dR,L.toPlainObject=Bv,L.transform=l2,L.unary=r_,L.union=sA,L.unionBy=nA,L.unionWith=rA,L.uniq=aA,L.uniqBy=iA,L.uniqWith=oA,L.unset=c2,L.unzip=cf,L.unzipWith=Sv,L.update=d2,L.updateWith=u2,L.values=ul,L.valuesIn=m2,L.without=lA,L.words=Kv,L.wrap=a_,L.xor=cA,L.xorBy=dA,L.xorWith=uA,L.zip=mA,L.zipObject=hA,L.zipObjectDeep=fA,L.zipWith=pA,L.entries=Yv,L.entriesIn=Vv,L.extend=Hv,L.extendWith=Su,yf(L,L),L.add=mR,L.attempt=Jv,L.camelCase=x2,L.capitalize=Gv,L.ceil=hR,L.clamp=h2,L.clone=o_,L.cloneDeep=c_,L.cloneDeepWith=d_,L.cloneWith=l_,L.conformsTo=u_,L.deburr=qv,L.defaultTo=Y2,L.divide=fR,L.endsWith=g2,L.eq=Yr,L.escape=v2,L.escapeRegExp=y2,L.every=EA,L.find=DA,L.findIndex=yv,L.findKey=B_,L.findLast=kA,L.findLastIndex=bv,L.findLastKey=H_,L.floor=pR,L.forEach=Ev,L.forEachRight=Tv,L.forIn=U_,L.forInRight=W_,L.forOwn=Y_,L.forOwnRight=V_,L.get=ff,L.gt=m_,L.gte=h_,L.has=K_,L.hasIn=pf,L.head=wv,L.identity=er,L.includes=PA,L.indexOf=kk,L.inRange=f2,L.invoke=Z_,L.isArguments=Eo,L.isArray=at,L.isArrayBuffer=f_,L.isArrayLike=Zn,L.isArrayLikeObject=Fs,L.isBoolean=p_,L.isBuffer=ki,L.isDate=x_,L.isElement=g_,L.isEmpty=v_,L.isEqual=y_,L.isEqualWith=b_,L.isError=mf,L.isFinite=j_,L.isFunction=Xa,L.isInteger=Mv,L.isLength=wu,L.isMap=Iv,L.isMatch=w_,L.isMatchWith=N_,L.isNaN=S_,L.isNative=C_,L.isNil=T_,L.isNull=E_,L.isNumber=Lv,L.isObject=ks,L.isObjectLike=Ms,L.isPlainObject=hc,L.isRegExp=hf,L.isSafeInteger=D_,L.isSet=$v,L.isString=Nu,L.isSymbol=fr,L.isTypedArray=dl,L.isUndefined=k_,L.isWeakMap=A_,L.isWeakSet=__,L.join=Pk,L.kebabCase=b2,L.last=Dr,L.lastIndexOf=Mk,L.lowerCase=j2,L.lowerFirst=w2,L.lt=R_,L.lte=O_,L.max=xR,L.maxBy=gR,L.mean=vR,L.meanBy=yR,L.min=bR,L.minBy=jR,L.stubArray=jf,L.stubFalse=wf,L.stubObject=iR,L.stubString=oR,L.stubTrue=lR,L.multiply=wR,L.nth=Ik,L.noConflict=Z2,L.noop=bf,L.now=yu,L.pad=N2,L.padEnd=S2,L.padStart=C2,L.parseInt=E2,L.random=p2,L.reduce=zA,L.reduceRight=FA,L.repeat=T2,L.replace=D2,L.result=a2,L.round=NR,L.runInContext=te,L.sample=HA,L.size=YA,L.snakeCase=k2,L.some=VA,L.sortedIndex=Uk,L.sortedIndexBy=Wk,L.sortedIndexOf=Yk,L.sortedLastIndex=Vk,L.sortedLastIndexBy=Gk,L.sortedLastIndexOf=qk,L.startCase=_2,L.startsWith=R2,L.subtract=SR,L.sum=CR,L.sumBy=ER,L.template=O2,L.times=cR,L.toFinite=Za,L.toInteger=lt,L.toLength=Fv,L.toLower=P2,L.toNumber=kr,L.toSafeInteger=P_,L.toString=ts,L.toUpper=M2,L.trim=I2,L.trimEnd=L2,L.trimStart=$2,L.truncate=z2,L.unescape=F2,L.uniqueId=uR,L.upperCase=B2,L.upperFirst=xf,L.each=Ev,L.eachRight=Tv,L.first=wv,yf(L,function(){var l={};return Na(L,function(m,j){is.call(L.prototype,j)||(l[j]=m)}),l}(),{chain:!1}),L.VERSION=r,Nr(["bind","bindKey","curry","curryRight","partial","partialRight"],function(l){L[l].placeholder=L}),Nr(["drop","take"],function(l,m){Pt.prototype[l]=function(j){j=j===n?1:rn(lt(j),0);var C=this.__filtered__&&!m?new Pt(this):this.clone();return C.__filtered__?C.__takeCount__=Tn(j,C.__takeCount__):C.__views__.push({size:Tn(j,X),type:l+(C.__dir__<0?"Right":"")}),C},Pt.prototype[l+"Right"]=function(j){return this.reverse()[l](j).reverse()}}),Nr(["filter","map","takeWhile"],function(l,m){var j=m+1,C=j==W||j==P;Pt.prototype[l]=function(A){var F=this.clone();return F.__iteratees__.push({iteratee:Ze(A,3),type:j}),F.__filtered__=F.__filtered__||C,F}}),Nr(["head","last"],function(l,m){var j="take"+(m?"Right":"");Pt.prototype[l]=function(){return this[j](1).value()[0]}}),Nr(["initial","tail"],function(l,m){var j="drop"+(m?"":"Right");Pt.prototype[l]=function(){return this.__filtered__?new Pt(this):this[j](1)}}),Pt.prototype.compact=function(){return this.filter(er)},Pt.prototype.find=function(l){return this.filter(l).head()},Pt.prototype.findLast=function(l){return this.reverse().find(l)},Pt.prototype.invokeMap=pt(function(l,m){return typeof l=="function"?new Pt(this):this.map(function(j){return oc(j,l,m)})}),Pt.prototype.reject=function(l){return this.filter(ju(Ze(l)))},Pt.prototype.slice=function(l,m){l=lt(l);var j=this;return j.__filtered__&&(l>0||m<0)?new Pt(j):(l<0?j=j.takeRight(-l):l&&(j=j.drop(l)),m!==n&&(m=lt(m),j=m<0?j.dropRight(-m):j.take(m-l)),j)},Pt.prototype.takeRightWhile=function(l){return this.reverse().takeWhile(l).reverse()},Pt.prototype.toArray=function(){return this.take(X)},Na(Pt.prototype,function(l,m){var j=/^(?:filter|find|map|reject)|While$/.test(m),C=/^(?:head|last)$/.test(m),A=L[C?"take"+(m=="last"?"Right":""):m],F=C||/^find/.test(m);A&&(L.prototype[m]=function(){var V=this.__wrapped__,Z=C?[1]:arguments,re=V instanceof Pt,ve=Z[0],be=re||at(V),we=function(St){var zt=A.apply(L,wi([St],Z));return C&&Oe?zt[0]:zt};be&&j&&typeof ve=="function"&&ve.length!=1&&(re=be=!1);var Oe=this.__chain__,We=!!this.__actions__.length,Qe=F&&!Oe,mt=re&&!We;if(!F&&be){V=mt?V:new Pt(this);var et=l.apply(V,Z);return et.__actions__.push({func:gu,args:[we],thisArg:n}),new Cr(et,Oe)}return Qe&&mt?l.apply(this,Z):(et=this.thru(we),Qe?C?et.value()[0]:et.value():et)})}),Nr(["pop","push","shift","sort","splice","unshift"],function(l){var m=Ud[l],j=/^(?:push|sort|unshift)$/.test(l)?"tap":"thru",C=/^(?:pop|shift)$/.test(l);L.prototype[l]=function(){var A=arguments;if(C&&!this.__chain__){var F=this.value();return m.apply(at(F)?F:[],A)}return this[j](function(V){return m.apply(at(V)?V:[],A)})}}),Na(Pt.prototype,function(l,m){var j=L[m];if(j){var C=j.name+"";is.call(al,C)||(al[C]=[]),al[C].push({name:m,func:j})}}),al[du(n,w).name]=[{name:"wrapper",func:n}],Pt.prototype.clone=FT,Pt.prototype.reverse=BT,Pt.prototype.value=HT,L.prototype.at=gA,L.prototype.chain=vA,L.prototype.commit=yA,L.prototype.next=bA,L.prototype.plant=wA,L.prototype.reverse=NA,L.prototype.toJSON=L.prototype.valueOf=L.prototype.value=SA,L.prototype.first=L.prototype.head,ec&&(L.prototype[ec]=jA),L},sl=yT();vo?((vo.exports=sl)._=sl,gh._=sl):yn._=sl}).call(fc)})(um,um.exports);var kn=um.exports;const aS=(t,s)=>{const[n,r]=f.useState(null),[a,i]=f.useState(!0),[o,c]=f.useState(null),{user:u}=Je();return f.useEffect(()=>{(async()=>{if(r(null),!!u){i(!0),c(null);try{const h=[],p=new Date(t),g=new Date(s);for(;p<=g;)h.push(Ie(p)),p.setDate(p.getDate()+1);const x=new Map(h.map(_=>[_,{date:_,drinks:[],totalWater:0}])),y=h.map(_=>{const M=ke(xe,"water",`${u.uid}_${_}`);return ot(M)});(await Promise.all(y)).forEach(_=>{if(_.exists()){const M=_.data();x.set(M.date,{date:M.date,drinks:M.drinks||[],totalWater:M.totalWater||0})}});const v=Array.from(x.values()),w=kn.sumBy(v,"totalWater"),N=v.filter(_=>_.totalWater>0).length,S=v.filter(_=>_.totalWater>=2e3).length,E=N>0?w/N:0,k=v.flatMap(_=>_.drinks),D=kn.groupBy(k,"type"),T=Object.entries(D).map(([_,M])=>({type:_,count:M.length,totalAmount:kn.sumBy(M,"amount"),percentage:kn.sumBy(M,"amount")/w*100||0})).sort((_,M)=>M.totalAmount-_.totalAmount),R=kn.groupBy(k,_=>or[_.type].category),O=Object.entries(R).map(([_,M])=>({category:_,totalAmount:kn.sumBy(M,"amount"),percentage:kn.sumBy(M,"amount")/w*100||0})).sort((_,M)=>M.totalAmount-_.totalAmount);let U;s.getTime()-t.getTime()>2592e6&&(U=Object.entries(kn.groupBy(v,_=>_.date.substring(0,7))).map(([_,M])=>({month:`${_}-01`,average:kn.sumBy(M,"totalWater")/M.length})).sort((_,M)=>new Date(_.month).getTime()-new Date(M.month).getTime()));const I=v.map(_=>({date:_.date,intake:_.totalWater}));r({dailyStats:I,summary:{totalIntake:w,avgDailyIntake:E,daysTracked:N,daysWithGoal:S},drinkStats:T,categoryStats:O,...U&&{monthlyAverages:U}})}catch(h){console.error("Error al cargar estadsticas:",h),c(h instanceof Error?h.message:"Error al cargar estadsticas")}finally{i(!1)}}})()},[u,t,s]),{stats:n,loading:a,error:o}},Yy=["#60A5FA","#34D399","#A78BFA","#F87171","#FBBF24","#A3E635"],LL=({startDate:t,endDate:s})=>{const{stats:n,loading:r,error:a}=aS(t,s);if(r)return e.jsx(Ce,{className:"w-full",children:e.jsx(Ae,{className:"flex items-center justify-center p-6",children:e.jsx(fs,{className:"w-6 h-6 animate-spin"})})});if(a||!n)return e.jsx(Ce,{className:"w-full",children:e.jsx(Ae,{className:"p-6",children:e.jsx("p",{className:"text-red-500",children:"Error al cargar estadsticas"})})});const i=o=>nt(new Date(o),"dd MMM",{locale:Zs});return e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(Ce,{className:"w-full md:col-span-2",children:[e.jsx(Kt,{className:"pb-2",children:e.jsx(Gt,{children:"Resumen del Perodo"})}),e.jsx(Ae,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-muted",children:[" ",e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[Math.round(n.summary.avgDailyIntake),"ml"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Promedio diario"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted",children:[" ",e.jsx("div",{className:"text-2xl font-bold text-green-600",children:n.summary.daysTracked}),e.jsx("div",{className:"text-sm text-gray-600",children:"Das registrados"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted",children:[" ",e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:n.summary.daysWithGoal}),e.jsx("div",{className:"text-sm text-gray-600",children:"Das meta alcanzada"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted",children:[" ",e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:[Math.round(n.summary.totalIntake/1e3),"L"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total consumido"})]})]})})]}),e.jsxs(Ce,{className:"w-full md:col-span-2",children:[e.jsx(Kt,{children:e.jsx(Gt,{children:"Tendencia de Consumo"})}),e.jsx(Ae,{children:e.jsx("div",{className:"h-[300px]",children:e.jsx(On,{width:"100%",height:"100%",children:e.jsxs(Oo,{data:n.dailyStats,children:[e.jsx(Aa,{strokeDasharray:"3 3"}),e.jsx(Qr,{dataKey:"date",tickFormatter:i,interval:"preserveStartEnd"}),e.jsx(_r,{tickFormatter:o=>`${o}ml`}),e.jsx(Pn,{formatter:o=>[`${o}ml`,"Consumo"],labelFormatter:o=>nt(new Date(o),"dd MMMM yyyy",{locale:Zs})}),e.jsx(Ji,{type:"monotone",dataKey:"intake",stroke:"#60A5FA",strokeWidth:2,dot:!1})]})})})})]}),e.jsxs(Ce,{className:"w-full",children:[e.jsx(Kt,{children:e.jsx(Gt,{children:"Distribucin por Categora"})}),e.jsx(Ae,{children:e.jsx("div",{className:"h-[300px]",children:e.jsx(On,{width:"100%",height:"100%",children:e.jsxs(hd,{children:[e.jsx(fd,{data:n.categoryStats,dataKey:"totalAmount",nameKey:"category",cx:"50%",cy:"50%",outerRadius:100,label:({category:o})=>rd[o],children:n.categoryStats.map((o,c)=>e.jsx(pd,{fill:Yy[c%Yy.length]},o.category))}),e.jsx(Pn,{formatter:o=>[`${o}ml`,"Cantidad"],labelFormatter:o=>rd[o]})]})})})})]}),e.jsxs(Ce,{className:"w-full",children:[e.jsx(Kt,{children:e.jsx(Gt,{children:"Top Bebidas"})}),"        ",e.jsx(Ae,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[" ",n.drinkStats.slice(0,6).map(o=>{const c=or[o.type],u=io[c.icon];return e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-muted hover:bg-accent transition-colors",children:[e.jsx(u,{className:`w-8 h-8 ${c.color} flex-shrink-0`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[" ",e.jsx("div",{className:"font-medium text-base",children:c.name})," ",e.jsxs("div",{className:"text-sm text-muted-foreground",children:[" ",Math.round(o.totalAmount),"ml"]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[" ",o.count," veces (",Math.round(o.percentage),"%)"]})]})]},o.type)})]})})]}),n.monthlyAverages&&e.jsxs(Ce,{className:"w-full md:col-span-2",children:[e.jsx(Kt,{children:e.jsx(Gt,{children:"Promedios Mensuales"})}),e.jsx(Ae,{children:e.jsx("div",{className:"h-[300px]",children:e.jsx(On,{width:"100%",height:"100%",children:e.jsxs(Pm,{data:n.monthlyAverages,children:[e.jsx(Aa,{strokeDasharray:"3 3"}),e.jsx(Qr,{dataKey:"month",tickFormatter:o=>{const c=new Date(o);return nt(c,"MMM yyyy",{locale:Zs})}}),e.jsx(_r,{tickFormatter:o=>`${Math.round(o)}ml`}),e.jsx(Pn,{formatter:o=>[`${Math.round(o)}ml`,"Promedio"],labelFormatter:o=>{const c=new Date(o);return nt(c,"MMMM yyyy",{locale:Zs})}}),e.jsx(Xc,{dataKey:"average",fill:"#60A5FA"})]})})})})]})]})};var _x="Progress",Rx=100,[$L,mY]=za(_x),[zL,FL]=$L(_x),iS=f.forwardRef((t,s)=>{const{__scopeProgress:n,value:r=null,max:a,getValueLabel:i=BL,...o}=t;(a||a===0)&&!Vy(a)&&console.error(HL(`${a}`,"Progress"));const c=Vy(a)?a:Rx;r!==null&&!Gy(r,c)&&console.error(UL(`${r}`,"Progress"));const u=Gy(r,c)?r:null,d=mm(u)?i(u,c):void 0;return e.jsx(zL,{scope:n,value:u,max:c,children:e.jsx(jt.div,{"aria-valuemax":c,"aria-valuemin":0,"aria-valuenow":mm(u)?u:void 0,"aria-valuetext":d,role:"progressbar","data-state":cS(u,c),"data-value":u??void 0,"data-max":c,...o,ref:s})})});iS.displayName=_x;var oS="ProgressIndicator",lS=f.forwardRef((t,s)=>{const{__scopeProgress:n,...r}=t,a=FL(oS,n);return e.jsx(jt.div,{"data-state":cS(a.value,a.max),"data-value":a.value??void 0,"data-max":a.max,...r,ref:s})});lS.displayName=oS;function BL(t,s){return`${Math.round(t/s*100)}%`}function cS(t,s){return t==null?"indeterminate":t===s?"complete":"loading"}function mm(t){return typeof t=="number"}function Vy(t){return mm(t)&&!isNaN(t)&&t>0}function Gy(t,s){return mm(t)&&!isNaN(t)&&t<=s&&t>=0}function HL(t,s){return`Invalid prop \`max\` of value \`${t}\` supplied to \`${s}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${Rx}\`.`}function UL(t,s){return`Invalid prop \`value\` of value \`${t}\` supplied to \`${s}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${Rx} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var dS=iS,WL=lS;const lr=f.forwardRef(({className:t,value:s,...n},r)=>e.jsx(dS,{ref:r,className:ce("relative h-4 w-full overflow-hidden rounded-full bg-secondary",t),...n,children:e.jsx(WL,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})}));lr.displayName=dS.displayName;const YL=({intake:t,goal:s})=>{const n=()=>{const r=t/s*100;return r>=100?"Excelente! Has alcanzado tu meta diaria ":r>=75?"Vas muy bien! Ya casi llegas a tu meta ":r>=50?"A mitad de camino! Sigue as ":r>=25?"Buen comienzo! Mantn el ritmo ":"Comienza tu da con buena hidratacin! "};return e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"font-medium text-lg flex items-center gap-2",children:[e.jsx(nx,{className:"w-5 h-5"}),"Hidratacin"]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:t>s?"text-blue-500 font-medium":"",children:[t,"ml / ",s,"ml"]}),e.jsx("div",{className:"text-xs text-gray-500",children:t>s?`+${t-s}ml extra`:""})]})]}),e.jsx(lr,{value:Math.min(t/s*100,100),className:"h-3"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2 text-center",children:n()})]})};function VL(t,s){return f.useReducer((n,r)=>s[n][r]??n,t)}var Ox="ScrollArea",[uS,hY]=za(Ox),[GL,$r]=uS(Ox),mS=f.forwardRef((t,s)=>{const{__scopeScrollArea:n,type:r="hover",dir:a,scrollHideDelay:i=600,...o}=t,[c,u]=f.useState(null),[d,h]=f.useState(null),[p,g]=f.useState(null),[x,y]=f.useState(null),[b,v]=f.useState(null),[w,N]=f.useState(0),[S,E]=f.useState(0),[k,D]=f.useState(!1),[T,R]=f.useState(!1),O=bs(s,I=>u(I)),U=_m(a);return e.jsx(GL,{scope:n,type:r,dir:U,scrollHideDelay:i,scrollArea:c,viewport:d,onViewportChange:h,content:p,onContentChange:g,scrollbarX:x,onScrollbarXChange:y,scrollbarXEnabled:k,onScrollbarXEnabledChange:D,scrollbarY:b,onScrollbarYChange:v,scrollbarYEnabled:T,onScrollbarYEnabledChange:R,onCornerWidthChange:N,onCornerHeightChange:E,children:e.jsx(jt.div,{dir:U,...o,ref:O,style:{position:"relative","--radix-scroll-area-corner-width":w+"px","--radix-scroll-area-corner-height":S+"px",...t.style}})})});mS.displayName=Ox;var hS="ScrollAreaViewport",fS=f.forwardRef((t,s)=>{const{__scopeScrollArea:n,children:r,nonce:a,...i}=t,o=$r(hS,n),c=f.useRef(null),u=bs(s,c,o.onViewportChange);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:a}),e.jsx(jt.div,{"data-radix-scroll-area-viewport":"",...i,ref:u,style:{overflowX:o.scrollbarXEnabled?"scroll":"hidden",overflowY:o.scrollbarYEnabled?"scroll":"hidden",...t.style},children:e.jsx("div",{ref:o.onContentChange,style:{minWidth:"100%",display:"table"},children:r})})]})});fS.displayName=hS;var Ua="ScrollAreaScrollbar",Px=f.forwardRef((t,s)=>{const{forceMount:n,...r}=t,a=$r(Ua,t.__scopeScrollArea),{onScrollbarXEnabledChange:i,onScrollbarYEnabledChange:o}=a,c=t.orientation==="horizontal";return f.useEffect(()=>(c?i(!0):o(!0),()=>{c?i(!1):o(!1)}),[c,i,o]),a.type==="hover"?e.jsx(qL,{...r,ref:s,forceMount:n}):a.type==="scroll"?e.jsx(KL,{...r,ref:s,forceMount:n}):a.type==="auto"?e.jsx(pS,{...r,ref:s,forceMount:n}):a.type==="always"?e.jsx(Mx,{...r,ref:s}):null});Px.displayName=Ua;var qL=f.forwardRef((t,s)=>{const{forceMount:n,...r}=t,a=$r(Ua,t.__scopeScrollArea),[i,o]=f.useState(!1);return f.useEffect(()=>{const c=a.scrollArea;let u=0;if(c){const d=()=>{window.clearTimeout(u),o(!0)},h=()=>{u=window.setTimeout(()=>o(!1),a.scrollHideDelay)};return c.addEventListener("pointerenter",d),c.addEventListener("pointerleave",h),()=>{window.clearTimeout(u),c.removeEventListener("pointerenter",d),c.removeEventListener("pointerleave",h)}}},[a.scrollArea,a.scrollHideDelay]),e.jsx(gi,{present:n||i,children:e.jsx(pS,{"data-state":i?"visible":"hidden",...r,ref:s})})}),KL=f.forwardRef((t,s)=>{const{forceMount:n,...r}=t,a=$r(Ua,t.__scopeScrollArea),i=t.orientation==="horizontal",o=qm(()=>u("SCROLL_END"),100),[c,u]=VL("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return f.useEffect(()=>{if(c==="idle"){const d=window.setTimeout(()=>u("HIDE"),a.scrollHideDelay);return()=>window.clearTimeout(d)}},[c,a.scrollHideDelay,u]),f.useEffect(()=>{const d=a.viewport,h=i?"scrollLeft":"scrollTop";if(d){let p=d[h];const g=()=>{const x=d[h];p!==x&&(u("SCROLL"),o()),p=x};return d.addEventListener("scroll",g),()=>d.removeEventListener("scroll",g)}},[a.viewport,i,u,o]),e.jsx(gi,{present:n||c!=="hidden",children:e.jsx(Mx,{"data-state":c==="hidden"?"hidden":"visible",...r,ref:s,onPointerEnter:it(t.onPointerEnter,()=>u("POINTER_ENTER")),onPointerLeave:it(t.onPointerLeave,()=>u("POINTER_LEAVE"))})})}),pS=f.forwardRef((t,s)=>{const n=$r(Ua,t.__scopeScrollArea),{forceMount:r,...a}=t,[i,o]=f.useState(!1),c=t.orientation==="horizontal",u=qm(()=>{if(n.viewport){const d=n.viewport.offsetWidth<n.viewport.scrollWidth,h=n.viewport.offsetHeight<n.viewport.scrollHeight;o(c?d:h)}},10);return Dl(n.viewport,u),Dl(n.content,u),e.jsx(gi,{present:r||i,children:e.jsx(Mx,{"data-state":i?"visible":"hidden",...a,ref:s})})}),Mx=f.forwardRef((t,s)=>{const{orientation:n="vertical",...r}=t,a=$r(Ua,t.__scopeScrollArea),i=f.useRef(null),o=f.useRef(0),[c,u]=f.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),d=bS(c.viewport,c.content),h={...r,sizes:c,onSizesChange:u,hasThumb:d>0&&d<1,onThumbChange:g=>i.current=g,onThumbPointerUp:()=>o.current=0,onThumbPointerDown:g=>o.current=g};function p(g,x){return t3(g,o.current,c,x)}return n==="horizontal"?e.jsx(JL,{...h,ref:s,onThumbPositionChange:()=>{if(a.viewport&&i.current){const g=a.viewport.scrollLeft,x=qy(g,c,a.dir);i.current.style.transform=`translate3d(${x}px, 0, 0)`}},onWheelScroll:g=>{a.viewport&&(a.viewport.scrollLeft=g)},onDragScroll:g=>{a.viewport&&(a.viewport.scrollLeft=p(g,a.dir))}}):n==="vertical"?e.jsx(XL,{...h,ref:s,onThumbPositionChange:()=>{if(a.viewport&&i.current){const g=a.viewport.scrollTop,x=qy(g,c);i.current.style.transform=`translate3d(0, ${x}px, 0)`}},onWheelScroll:g=>{a.viewport&&(a.viewport.scrollTop=g)},onDragScroll:g=>{a.viewport&&(a.viewport.scrollTop=p(g))}}):null}),JL=f.forwardRef((t,s)=>{const{sizes:n,onSizesChange:r,...a}=t,i=$r(Ua,t.__scopeScrollArea),[o,c]=f.useState(),u=f.useRef(null),d=bs(s,u,i.onScrollbarXChange);return f.useEffect(()=>{u.current&&c(getComputedStyle(u.current))},[u]),e.jsx(gS,{"data-orientation":"horizontal",...a,ref:d,sizes:n,style:{bottom:0,left:i.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:i.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":Gm(n)+"px",...t.style},onThumbPointerDown:h=>t.onThumbPointerDown(h.x),onDragScroll:h=>t.onDragScroll(h.x),onWheelScroll:(h,p)=>{if(i.viewport){const g=i.viewport.scrollLeft+h.deltaX;t.onWheelScroll(g),wS(g,p)&&h.preventDefault()}},onResize:()=>{u.current&&i.viewport&&o&&r({content:i.viewport.scrollWidth,viewport:i.viewport.offsetWidth,scrollbar:{size:u.current.clientWidth,paddingStart:fm(o.paddingLeft),paddingEnd:fm(o.paddingRight)}})}})}),XL=f.forwardRef((t,s)=>{const{sizes:n,onSizesChange:r,...a}=t,i=$r(Ua,t.__scopeScrollArea),[o,c]=f.useState(),u=f.useRef(null),d=bs(s,u,i.onScrollbarYChange);return f.useEffect(()=>{u.current&&c(getComputedStyle(u.current))},[u]),e.jsx(gS,{"data-orientation":"vertical",...a,ref:d,sizes:n,style:{top:0,right:i.dir==="ltr"?0:void 0,left:i.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":Gm(n)+"px",...t.style},onThumbPointerDown:h=>t.onThumbPointerDown(h.y),onDragScroll:h=>t.onDragScroll(h.y),onWheelScroll:(h,p)=>{if(i.viewport){const g=i.viewport.scrollTop+h.deltaY;t.onWheelScroll(g),wS(g,p)&&h.preventDefault()}},onResize:()=>{u.current&&i.viewport&&o&&r({content:i.viewport.scrollHeight,viewport:i.viewport.offsetHeight,scrollbar:{size:u.current.clientHeight,paddingStart:fm(o.paddingTop),paddingEnd:fm(o.paddingBottom)}})}})}),[ZL,xS]=uS(Ua),gS=f.forwardRef((t,s)=>{const{__scopeScrollArea:n,sizes:r,hasThumb:a,onThumbChange:i,onThumbPointerUp:o,onThumbPointerDown:c,onThumbPositionChange:u,onDragScroll:d,onWheelScroll:h,onResize:p,...g}=t,x=$r(Ua,n),[y,b]=f.useState(null),v=bs(s,O=>b(O)),w=f.useRef(null),N=f.useRef(""),S=x.viewport,E=r.content-r.viewport,k=Vi(h),D=Vi(u),T=qm(p,10);function R(O){if(w.current){const U=O.clientX-w.current.left,I=O.clientY-w.current.top;d({x:U,y:I})}}return f.useEffect(()=>{const O=U=>{const I=U.target;(y==null?void 0:y.contains(I))&&k(U,E)};return document.addEventListener("wheel",O,{passive:!1}),()=>document.removeEventListener("wheel",O,{passive:!1})},[S,y,E,k]),f.useEffect(D,[r,D]),Dl(y,T),Dl(x.content,T),e.jsx(ZL,{scope:n,scrollbar:y,hasThumb:a,onThumbChange:Vi(i),onThumbPointerUp:Vi(o),onThumbPositionChange:D,onThumbPointerDown:Vi(c),children:e.jsx(jt.div,{...g,ref:v,style:{position:"absolute",...g.style},onPointerDown:it(t.onPointerDown,O=>{O.button===0&&(O.target.setPointerCapture(O.pointerId),w.current=y.getBoundingClientRect(),N.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",x.viewport&&(x.viewport.style.scrollBehavior="auto"),R(O))}),onPointerMove:it(t.onPointerMove,R),onPointerUp:it(t.onPointerUp,O=>{const U=O.target;U.hasPointerCapture(O.pointerId)&&U.releasePointerCapture(O.pointerId),document.body.style.webkitUserSelect=N.current,x.viewport&&(x.viewport.style.scrollBehavior=""),w.current=null})})})}),hm="ScrollAreaThumb",vS=f.forwardRef((t,s)=>{const{forceMount:n,...r}=t,a=xS(hm,t.__scopeScrollArea);return e.jsx(gi,{present:n||a.hasThumb,children:e.jsx(QL,{ref:s,...r})})}),QL=f.forwardRef((t,s)=>{const{__scopeScrollArea:n,style:r,...a}=t,i=$r(hm,n),o=xS(hm,n),{onThumbPositionChange:c}=o,u=bs(s,p=>o.onThumbChange(p)),d=f.useRef(void 0),h=qm(()=>{d.current&&(d.current(),d.current=void 0)},100);return f.useEffect(()=>{const p=i.viewport;if(p){const g=()=>{if(h(),!d.current){const x=s3(p,c);d.current=x,c()}};return c(),p.addEventListener("scroll",g),()=>p.removeEventListener("scroll",g)}},[i.viewport,h,c]),e.jsx(jt.div,{"data-state":o.hasThumb?"visible":"hidden",...a,ref:u,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...r},onPointerDownCapture:it(t.onPointerDownCapture,p=>{const x=p.target.getBoundingClientRect(),y=p.clientX-x.left,b=p.clientY-x.top;o.onThumbPointerDown({x:y,y:b})}),onPointerUp:it(t.onPointerUp,o.onThumbPointerUp)})});vS.displayName=hm;var Ix="ScrollAreaCorner",yS=f.forwardRef((t,s)=>{const n=$r(Ix,t.__scopeScrollArea),r=!!(n.scrollbarX&&n.scrollbarY);return n.type!=="scroll"&&r?e.jsx(e3,{...t,ref:s}):null});yS.displayName=Ix;var e3=f.forwardRef((t,s)=>{const{__scopeScrollArea:n,...r}=t,a=$r(Ix,n),[i,o]=f.useState(0),[c,u]=f.useState(0),d=!!(i&&c);return Dl(a.scrollbarX,()=>{var p;const h=((p=a.scrollbarX)==null?void 0:p.offsetHeight)||0;a.onCornerHeightChange(h),u(h)}),Dl(a.scrollbarY,()=>{var p;const h=((p=a.scrollbarY)==null?void 0:p.offsetWidth)||0;a.onCornerWidthChange(h),o(h)}),d?e.jsx(jt.div,{...r,ref:s,style:{width:i,height:c,position:"absolute",right:a.dir==="ltr"?0:void 0,left:a.dir==="rtl"?0:void 0,bottom:0,...t.style}}):null});function fm(t){return t?parseInt(t,10):0}function bS(t,s){const n=t/s;return isNaN(n)?0:n}function Gm(t){const s=bS(t.viewport,t.content),n=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,r=(t.scrollbar.size-n)*s;return Math.max(r,18)}function t3(t,s,n,r="ltr"){const a=Gm(n),i=a/2,o=s||i,c=a-o,u=n.scrollbar.paddingStart+o,d=n.scrollbar.size-n.scrollbar.paddingEnd-c,h=n.content-n.viewport,p=r==="ltr"?[0,h]:[h*-1,0];return jS([u,d],p)(t)}function qy(t,s,n="ltr"){const r=Gm(s),a=s.scrollbar.paddingStart+s.scrollbar.paddingEnd,i=s.scrollbar.size-a,o=s.content-s.viewport,c=i-r,u=n==="ltr"?[0,o]:[o*-1,0],d=_p(t,u);return jS([0,o],[0,c])(d)}function jS(t,s){return n=>{if(t[0]===t[1]||s[0]===s[1])return s[0];const r=(s[1]-s[0])/(t[1]-t[0]);return s[0]+r*(n-t[0])}}function wS(t,s){return t>0&&t<s}var s3=(t,s=()=>{})=>{let n={left:t.scrollLeft,top:t.scrollTop},r=0;return function a(){const i={left:t.scrollLeft,top:t.scrollTop},o=n.left!==i.left,c=n.top!==i.top;(o||c)&&s(),n=i,r=window.requestAnimationFrame(a)}(),()=>window.cancelAnimationFrame(r)};function qm(t,s){const n=Vi(t),r=f.useRef(0);return f.useEffect(()=>()=>window.clearTimeout(r.current),[]),f.useCallback(()=>{window.clearTimeout(r.current),r.current=window.setTimeout(n,s)},[n,s])}function Dl(t,s){const n=Vi(s);pi(()=>{let r=0;if(t){const a=new ResizeObserver(()=>{cancelAnimationFrame(r),r=window.requestAnimationFrame(n)});return a.observe(t),()=>{window.cancelAnimationFrame(r),a.unobserve(t)}}},[t,n])}var NS=mS,n3=fS,r3=yS;const Km=f.forwardRef(({className:t,children:s,...n},r)=>e.jsxs(NS,{ref:r,className:ce("relative overflow-hidden",t),...n,children:[e.jsx(n3,{className:"h-full w-full rounded-[inherit]",children:s}),e.jsx(SS,{}),e.jsx(r3,{})]}));Km.displayName=NS.displayName;const SS=f.forwardRef(({className:t,orientation:s="vertical",...n},r)=>e.jsx(Px,{ref:r,orientation:s,className:ce("flex touch-none select-none transition-colors",s==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",s==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...n,children:e.jsx(vS,{className:"relative flex-1 rounded-full bg-border"})}));SS.displayName=Px.displayName;const a3=({isOpen:t,onClose:s,onSelect:n})=>{var h;const[r,a]=f.useState(null),[i,o]=f.useState("water"),c=Object.entries(or).reduce((p,[g,x])=>{const y=x.category;return p[y]||(p[y]=[]),p[y].push({key:g,...x}),p},{}),u=p=>{a(r===p?null:p)},d=p=>{r&&(n(r,p),a(null),s())};return e.jsx(kt,{open:t,onOpenChange:s,children:e.jsxs(wt,{className:"sm:max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx(At,{children:e.jsx(_t,{className:"text-xl",children:"Seleccionar bebida"})}),e.jsxs("div",{className:"flex flex-col gap-4 flex-1",children:[e.jsxs(Tt,{value:i,onValueChange:o,children:[e.jsx(vt,{className:"w-full md:w-64",children:e.jsx(Dt,{placeholder:"Selecciona una categora"})}),e.jsx(yt,{children:Object.entries(rd).map(([p,g])=>e.jsx(Pe,{value:p,children:g},p))})]}),e.jsx(Km,{className:"flex-1",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3 p-1",children:(h=c[i])==null?void 0:h.map(p=>{const g=io[p.icon],x=r===p.key;return e.jsx("div",{className:"relative",children:e.jsxs($,{variant:x?"default":"outline",className:"w-full h-20 flex flex-col items-center justify-center gap-2 p-3 text-center transition-all hover:scale-105 transform",onClick:()=>u(p.key),children:[e.jsx(g,{className:`w-6 h-6 ${x?"text-white":p.color} flex-shrink-0`}),e.jsx("span",{className:"text-xs leading-tight break-words font-medium",children:p.name})]})},p.key)})})}),r&&e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-4 shadow-sm",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3",children:[e.jsx("div",{className:"flex items-center gap-3 sm:flex-shrink-0",children:(()=>{const p=or[r],g=io[p.icon];return e.jsxs(e.Fragment,{children:[e.jsx(g,{className:`w-6 h-6 ${p.color}`}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:p.name}),e.jsx("p",{className:"text-sm text-gray-600",children:"Selecciona la cantidad"})]})]})})()}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-2",children:or[r].amounts.map(p=>e.jsxs($,{variant:"outline",size:"sm",className:"bg-white hover:bg-blue-50 border-blue-200 text-blue-700 font-medium transition-all hover:scale-105 transform",onClick:()=>d(p),children:[p,"ml"]},p))})}),e.jsx($,{variant:"ghost",size:"sm",className:"text-gray-500 hover:text-gray-700 sm:flex-shrink-0",onClick:()=>a(null),children:""})]})})]})]})})},i3=["water","sparklingWater","flavoredWater","coffee","tea","aromatica","milk","juice","sportsdrink","soda","energyDrink"],o3=({selectedDrink:t,onDrinkSelect:s,onAmountSelect:n,disabled:r})=>{const[a,i]=f.useState(!1),o=(u,d)=>{n(u,d),i(!1)},c=u=>{s(t===u?null:u)};return e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Agregar bebida"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Selecciona una bebida para registrar"})]}),"      ",e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:[i3.map(u=>{const d=or[u],h=io[d.icon],p=t===u;return e.jsxs($,{variant:p?"default":"outline",className:ce("h-20 w-full flex flex-col items-center justify-center gap-1 p-2","transition-all duration-200 hover:scale-105",p&&"ring-2 ring-blue-500 ring-offset-1"),onClick:()=>c(u),disabled:r,children:[e.jsx(h,{className:ce("w-5 h-5 flex-shrink-0",p?"text-white":d.color)}),e.jsx("span",{className:"text-xs font-medium leading-tight text-center",children:d.name})]},u)}),e.jsxs($,{variant:"outline",className:"h-20 w-full flex flex-col items-center justify-center gap-1 p-2 border-dashed border-2 hover:border-blue-300 hover:bg-blue-50",onClick:()=>i(!0),disabled:r,children:[e.jsx(cs,{className:"w-5 h-5 text-gray-400"}),e.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Ms"})]})]}),t&&e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:(()=>{const u=or[t],d=io[u.icon];return e.jsxs(e.Fragment,{children:[e.jsx(d,{className:ce("w-5 h-5",u.color)}),e.jsx("span",{className:"font-medium text-gray-900",children:u.name})]})})()}),e.jsx($,{variant:"ghost",size:"sm",className:"text-gray-400 hover:text-gray-600 h-8 w-8 p-0",onClick:()=>s(null),children:e.jsx(Ws,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:or[t].amounts.map(u=>e.jsx($,{variant:"outline",className:"h-10 bg-white hover:bg-blue-50 hover:border-blue-300",onClick:()=>{n(t,u),s(null)},children:e.jsxs("span",{className:"font-medium",children:[u,"ml"]})},u))})]}),e.jsx(a3,{isOpen:a,onClose:()=>i(!1),onSelect:o})]})},Fe=f.forwardRef(({className:t,type:s,inputMode:n,...r},a)=>{const i=n||l3(s);return e.jsx("input",{type:s,inputMode:i,className:ce("flex h-11 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background","file:border-0 file:bg-transparent file:text-sm file:font-medium","placeholder:text-muted-foreground","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","disabled:cursor-not-allowed disabled:opacity-50","transition-colors duration-150","touch-manipulation","appearance-none [-webkit-appearance:none]",t),ref:a,...r})});Fe.displayName="Input";function l3(t){switch(t){case"email":return"email";case"tel":return"tel";case"number":return"numeric";case"search":return"search";case"url":return"url";default:return"text"}}const c3=({drink:t,isOpen:s,onClose:n,onSave:r})=>{const[a,i]=f.useState(""),[o,c]=f.useState("");if(f.useEffect(()=>{t&&(i(t.amount.toString()),c(t.time))},[t]),!t)return null;const u=or[t.type],d=io[u.icon],h=()=>{const p={...t,amount:parseInt(a),time:o,hydration:parseInt(a)*u.hydrationFactor};r(p),n()};return e.jsx(kt,{open:s,onOpenChange:n,children:e.jsxs(wt,{className:"sm:max-w-md",children:[e.jsx(At,{children:e.jsxs(_t,{className:"flex items-center gap-2",children:[e.jsx(d,{className:`w-5 h-5 ${u.color}`}),"Editar ",u.name]})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{htmlFor:"amount",className:"text-sm font-medium",children:"Cantidad (ml)"}),e.jsx(Fe,{id:"amount",type:"number",value:a,onChange:p=>i(p.target.value),min:"0",step:"50"})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{htmlFor:"time",className:"text-sm font-medium",children:"Hora"}),e.jsx(Fe,{id:"time",type:"time",value:o,onChange:p=>c(p.target.value)})]})]}),e.jsxs(Cn,{className:"sm:justify-start",children:[e.jsx($,{type:"button",variant:"secondary",onClick:n,children:"Cancelar"}),e.jsx($,{type:"button",onClick:h,disabled:!a||!o,children:"Guardar cambios"})]})]})})},d3=({drinks:t,showHistory:s,onToggleHistory:n,onDeleteDrink:r,onEditDrink:a,isCurrentDate:i})=>{const[o,c]=f.useState(null),u=(h,p)=>{c({index:h,drink:p})},d=h=>{o&&(a(o.index,h),c(null))};return e.jsxs("div",{children:[e.jsxs($,{variant:"outline",className:"w-full",onClick:n,children:[s?e.jsx(Fo,{className:"w-4 h-4 mr-2"}):e.jsx(Gn,{className:"w-4 h-4 mr-2"}),"Historial de hoy"]}),s&&t.length>0&&e.jsx("div",{className:"mt-4 space-y-2",children:t.map((h,p)=>{const g=or[h.type],x=io[g.icon];return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-muted rounded-lg",children:[e.jsx(x,{className:`w-5 h-5 ${g.color} flex-shrink-0`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"font-medium text-sm",children:g.name}),e.jsxs("span",{className:"text-muted-foreground text-sm font-medium",children:[h.amount,"ml"]})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:h.time})]}),i&&e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx($,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-accent-foreground/10 touch-manipulation",onClick:()=>u(p,h),title:"Editar",children:e.jsx(Mm,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx($,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-destructive/10 touch-manipulation",onClick:()=>r(p),title:"Eliminar",children:e.jsx(oo,{className:"h-4 w-4 text-destructive"})})]})]},h.timestamp)})}),s&&t.length===0&&e.jsxs("div",{className:"mt-4 text-center text-muted-foreground text-sm py-4",children:[" ","No hay registros para este da"]}),e.jsx(c3,{drink:(o==null?void 0:o.drink)||null,isOpen:!!o,onClose:()=>c(null),onSave:d})]})};var tt=function(){return tt=Object.assign||function(s){for(var n,r=1,a=arguments.length;r<a;r++){n=arguments[r];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(s[i]=n[i])}return s},tt.apply(this,arguments)};function u3(t,s){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&s.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(t);a<r.length;a++)s.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(t,r[a])&&(n[r[a]]=t[r[a]]);return n}function CS(t,s,n){for(var r=0,a=s.length,i;r<a;r++)(i||!(r in s))&&(i||(i=Array.prototype.slice.call(s,0,r)),i[r]=s[r]);return t.concat(i||Array.prototype.slice.call(s))}function jd(t){return t.mode==="multiple"}function wd(t){return t.mode==="range"}function Jm(t){return t.mode==="single"}var m3={root:"rdp",multiple_months:"rdp-multiple_months",with_weeknumber:"rdp-with_weeknumber",vhidden:"rdp-vhidden",button_reset:"rdp-button_reset",button:"rdp-button",caption:"rdp-caption",caption_start:"rdp-caption_start",caption_end:"rdp-caption_end",caption_between:"rdp-caption_between",caption_label:"rdp-caption_label",caption_dropdowns:"rdp-caption_dropdowns",dropdown:"rdp-dropdown",dropdown_month:"rdp-dropdown_month",dropdown_year:"rdp-dropdown_year",dropdown_icon:"rdp-dropdown_icon",months:"rdp-months",month:"rdp-month",table:"rdp-table",tbody:"rdp-tbody",tfoot:"rdp-tfoot",head:"rdp-head",head_row:"rdp-head_row",head_cell:"rdp-head_cell",nav:"rdp-nav",nav_button:"rdp-nav_button",nav_button_previous:"rdp-nav_button_previous",nav_button_next:"rdp-nav_button_next",nav_icon:"rdp-nav_icon",row:"rdp-row",weeknumber:"rdp-weeknumber",cell:"rdp-cell",day:"rdp-day",day_today:"rdp-day_today",day_outside:"rdp-day_outside",day_selected:"rdp-day_selected",day_disabled:"rdp-day_disabled",day_hidden:"rdp-day_hidden",day_range_start:"rdp-day_range_start",day_range_end:"rdp-day_range_end",day_range_middle:"rdp-day_range_middle"};function h3(t,s){return nt(t,"LLLL y",s)}function f3(t,s){return nt(t,"d",s)}function p3(t,s){return nt(t,"LLLL",s)}function x3(t){return"".concat(t)}function g3(t,s){return nt(t,"cccccc",s)}function v3(t,s){return nt(t,"yyyy",s)}var y3=Object.freeze({__proto__:null,formatCaption:h3,formatDay:f3,formatMonthCaption:p3,formatWeekNumber:x3,formatWeekdayName:g3,formatYearCaption:v3}),b3=function(t,s,n){return nt(t,"do MMMM (EEEE)",n)},j3=function(){return"Month: "},w3=function(){return"Go to next month"},N3=function(){return"Go to previous month"},S3=function(t,s){return nt(t,"cccc",s)},C3=function(t){return"Week n. ".concat(t)},E3=function(){return"Year: "},T3=Object.freeze({__proto__:null,labelDay:b3,labelMonthDropdown:j3,labelNext:w3,labelPrevious:N3,labelWeekNumber:C3,labelWeekday:S3,labelYearDropdown:E3});function D3(){var t="buttons",s=m3,n=VR,r={},a={},i=1,o={},c=new Date;return{captionLayout:t,classNames:s,formatters:y3,labels:T3,locale:n,modifiersClassNames:r,modifiers:a,numberOfMonths:i,styles:o,today:c,mode:"default"}}function k3(t){var s=t.fromYear,n=t.toYear,r=t.fromMonth,a=t.toMonth,i=t.fromDate,o=t.toDate;return r?i=ls(r):s&&(i=new Date(s,0,1)),a?o=vr(a):n&&(o=new Date(n,11,31)),{fromDate:i?ps(i):void 0,toDate:o?ps(o):void 0}}var ES=f.createContext(void 0);function A3(t){var s,n=t.initialProps,r=D3(),a=k3(n),i=a.fromDate,o=a.toDate,c=(s=n.captionLayout)!==null&&s!==void 0?s:r.captionLayout;c!=="buttons"&&(!i||!o)&&(c="buttons");var u;(Jm(n)||jd(n)||wd(n))&&(u=n.onSelect);var d=tt(tt(tt({},r),n),{captionLayout:c,classNames:tt(tt({},r.classNames),n.classNames),components:tt({},n.components),formatters:tt(tt({},r.formatters),n.formatters),fromDate:i,labels:tt(tt({},r.labels),n.labels),mode:n.mode||r.mode,modifiers:tt(tt({},r.modifiers),n.modifiers),modifiersClassNames:tt(tt({},r.modifiersClassNames),n.modifiersClassNames),onSelect:u,styles:tt(tt({},r.styles),n.styles),toDate:o});return e.jsx(ES.Provider,{value:d,children:t.children})}function js(){var t=f.useContext(ES);if(!t)throw new Error("useDayPicker must be used within a DayPickerProvider.");return t}function TS(t){var s=js(),n=s.locale,r=s.classNames,a=s.styles,i=s.formatters.formatCaption;return e.jsx("div",{className:r.caption_label,style:a.caption_label,"aria-live":"polite",role:"presentation",id:t.id,children:i(t.displayMonth,{locale:n})})}function _3(t){return e.jsx("svg",tt({width:"8px",height:"8px",viewBox:"0 0 120 120","data-testid":"iconDropdown"},t,{children:e.jsx("path",{d:"M4.22182541,48.2218254 C8.44222828,44.0014225 15.2388494,43.9273804 19.5496459,47.9996989 L19.7781746,48.2218254 L60,88.443 L100.221825,48.2218254 C104.442228,44.0014225 111.238849,43.9273804 115.549646,47.9996989 L115.778175,48.2218254 C119.998577,52.4422283 120.07262,59.2388494 116.000301,63.5496459 L115.778175,63.7781746 L67.7781746,111.778175 C63.5577717,115.998577 56.7611506,116.07262 52.4503541,112.000301 L52.2218254,111.778175 L4.22182541,63.7781746 C-0.0739418023,59.4824074 -0.0739418023,52.5175926 4.22182541,48.2218254 Z",fill:"currentColor",fillRule:"nonzero"})}))}function DS(t){var s,n,r=t.onChange,a=t.value,i=t.children,o=t.caption,c=t.className,u=t.style,d=js(),h=(n=(s=d.components)===null||s===void 0?void 0:s.IconDropdown)!==null&&n!==void 0?n:_3;return e.jsxs("div",{className:c,style:u,children:[e.jsx("span",{className:d.classNames.vhidden,children:t["aria-label"]}),e.jsx("select",{name:t.name,"aria-label":t["aria-label"],className:d.classNames.dropdown,style:d.styles.dropdown,value:a,onChange:r,children:i}),e.jsxs("div",{className:d.classNames.caption_label,style:d.styles.caption_label,"aria-hidden":"true",children:[o,e.jsx(h,{className:d.classNames.dropdown_icon,style:d.styles.dropdown_icon})]})]})}function R3(t){var s,n=js(),r=n.fromDate,a=n.toDate,i=n.styles,o=n.locale,c=n.formatters.formatMonthCaption,u=n.classNames,d=n.components,h=n.labels.labelMonthDropdown;if(!r)return e.jsx(e.Fragment,{});if(!a)return e.jsx(e.Fragment,{});var p=[];if(ZR(r,a))for(var g=ls(r),x=r.getMonth();x<=a.getMonth();x++)p.push(Sf(g,x));else for(var g=ls(new Date),x=0;x<=11;x++)p.push(Sf(g,x));var y=function(v){var w=Number(v.target.value),N=Sf(ls(t.displayMonth),w);t.onChange(N)},b=(s=d==null?void 0:d.Dropdown)!==null&&s!==void 0?s:DS;return e.jsx(b,{name:"months","aria-label":h(),className:u.dropdown_month,style:i.dropdown_month,onChange:y,value:t.displayMonth.getMonth(),caption:c(t.displayMonth,{locale:o}),children:p.map(function(v){return e.jsx("option",{value:v.getMonth(),children:c(v,{locale:o})},v.getMonth())})})}function O3(t){var s,n=t.displayMonth,r=js(),a=r.fromDate,i=r.toDate,o=r.locale,c=r.styles,u=r.classNames,d=r.components,h=r.formatters.formatYearCaption,p=r.labels.labelYearDropdown,g=[];if(!a)return e.jsx(e.Fragment,{});if(!i)return e.jsx(e.Fragment,{});for(var x=a.getFullYear(),y=i.getFullYear(),b=x;b<=y;b++)g.push(ny(rp(new Date),b));var v=function(N){var S=ny(ls(n),Number(N.target.value));t.onChange(S)},w=(s=d==null?void 0:d.Dropdown)!==null&&s!==void 0?s:DS;return e.jsx(w,{name:"years","aria-label":p(),className:u.dropdown_year,style:c.dropdown_year,onChange:v,value:n.getFullYear(),caption:h(n,{locale:o}),children:g.map(function(N){return e.jsx("option",{value:N.getFullYear(),children:h(N,{locale:o})},N.getFullYear())})})}function P3(t,s){var n=f.useState(t),r=n[0],a=n[1],i=s===void 0?r:s;return[i,a]}function M3(t){var s=t.month,n=t.defaultMonth,r=t.today,a=s||n||r||new Date,i=t.toDate,o=t.fromDate,c=t.numberOfMonths,u=c===void 0?1:c;if(i&&Jc(i,a)<0){var d=-1*(u-1);a=ra(i,d)}return o&&Jc(a,o)<0&&(a=o),ls(a)}function I3(){var t=js(),s=M3(t),n=P3(s,t.month),r=n[0],a=n[1],i=function(o){var c;if(!t.disableNavigation){var u=ls(o);a(u),(c=t.onMonthChange)===null||c===void 0||c.call(t,u)}};return[r,i]}function L3(t,s){for(var n=s.reverseMonths,r=s.numberOfMonths,a=ls(t),i=ls(ra(a,r)),o=Jc(i,a),c=[],u=0;u<o;u++){var d=ra(a,u);c.push(d)}return n&&(c=c.reverse()),c}function $3(t,s){if(!s.disableNavigation){var n=s.toDate,r=s.pagedNavigation,a=s.numberOfMonths,i=a===void 0?1:a,o=r?i:1,c=ls(t);if(!n)return ra(c,o);var u=Jc(n,t);if(!(u<i))return ra(c,o)}}function z3(t,s){if(!s.disableNavigation){var n=s.fromDate,r=s.pagedNavigation,a=s.numberOfMonths,i=a===void 0?1:a,o=r?i:1,c=ls(t);if(!n)return ra(c,-o);var u=Jc(c,n);if(!(u<=0))return ra(c,-o)}}var kS=f.createContext(void 0);function F3(t){var s=js(),n=I3(),r=n[0],a=n[1],i=L3(r,s),o=$3(r,s),c=z3(r,s),u=function(p){return i.some(function(g){return tx(p,g)})},d=function(p,g){u(p)||(g&&Is(p,g)?a(ra(p,1+s.numberOfMonths*-1)):a(p))},h={currentMonth:r,displayMonths:i,goToMonth:a,goToDate:d,previousMonth:c,nextMonth:o,isDateDisplayed:u};return e.jsx(kS.Provider,{value:h,children:t.children})}function Nd(){var t=f.useContext(kS);if(!t)throw new Error("useNavigation must be used within a NavigationProvider");return t}function Ky(t){var s,n=js(),r=n.classNames,a=n.styles,i=n.components,o=Nd().goToMonth,c=function(h){o(ra(h,t.displayIndex?-t.displayIndex:0))},u=(s=i==null?void 0:i.CaptionLabel)!==null&&s!==void 0?s:TS,d=e.jsx(u,{id:t.id,displayMonth:t.displayMonth});return e.jsxs("div",{className:r.caption_dropdowns,style:a.caption_dropdowns,children:[e.jsx("div",{className:r.vhidden,children:d}),e.jsx(R3,{onChange:c,displayMonth:t.displayMonth}),e.jsx(O3,{onChange:c,displayMonth:t.displayMonth})]})}function B3(t){return e.jsx("svg",tt({width:"16px",height:"16px",viewBox:"0 0 120 120"},t,{children:e.jsx("path",{d:"M69.490332,3.34314575 C72.6145263,0.218951416 77.6798462,0.218951416 80.8040405,3.34314575 C83.8617626,6.40086786 83.9268205,11.3179931 80.9992143,14.4548388 L80.8040405,14.6568542 L35.461,60 L80.8040405,105.343146 C83.8617626,108.400868 83.9268205,113.317993 80.9992143,116.454839 L80.8040405,116.656854 C77.7463184,119.714576 72.8291931,119.779634 69.6923475,116.852028 L69.490332,116.656854 L18.490332,65.6568542 C15.4326099,62.5991321 15.367552,57.6820069 18.2951583,54.5451612 L18.490332,54.3431458 L69.490332,3.34314575 Z",fill:"currentColor",fillRule:"nonzero"})}))}function H3(t){return e.jsx("svg",tt({width:"16px",height:"16px",viewBox:"0 0 120 120"},t,{children:e.jsx("path",{d:"M49.8040405,3.34314575 C46.6798462,0.218951416 41.6145263,0.218951416 38.490332,3.34314575 C35.4326099,6.40086786 35.367552,11.3179931 38.2951583,14.4548388 L38.490332,14.6568542 L83.8333725,60 L38.490332,105.343146 C35.4326099,108.400868 35.367552,113.317993 38.2951583,116.454839 L38.490332,116.656854 C41.5480541,119.714576 46.4651794,119.779634 49.602025,116.852028 L49.8040405,116.656854 L100.804041,65.6568542 C103.861763,62.5991321 103.926821,57.6820069 100.999214,54.5451612 L100.804041,54.3431458 L49.8040405,3.34314575 Z",fill:"currentColor"})}))}var pm=f.forwardRef(function(t,s){var n=js(),r=n.classNames,a=n.styles,i=[r.button_reset,r.button];t.className&&i.push(t.className);var o=i.join(" "),c=tt(tt({},a.button_reset),a.button);return t.style&&Object.assign(c,t.style),e.jsx("button",tt({},t,{ref:s,type:"button",className:o,style:c}))});function U3(t){var s,n,r=js(),a=r.dir,i=r.locale,o=r.classNames,c=r.styles,u=r.labels,d=u.labelPrevious,h=u.labelNext,p=r.components;if(!t.nextMonth&&!t.previousMonth)return e.jsx(e.Fragment,{});var g=d(t.previousMonth,{locale:i}),x=[o.nav_button,o.nav_button_previous].join(" "),y=h(t.nextMonth,{locale:i}),b=[o.nav_button,o.nav_button_next].join(" "),v=(s=p==null?void 0:p.IconRight)!==null&&s!==void 0?s:H3,w=(n=p==null?void 0:p.IconLeft)!==null&&n!==void 0?n:B3;return e.jsxs("div",{className:o.nav,style:c.nav,children:[!t.hidePrevious&&e.jsx(pm,{name:"previous-month","aria-label":g,className:x,style:c.nav_button_previous,disabled:!t.previousMonth,onClick:t.onPreviousClick,children:a==="rtl"?e.jsx(v,{className:o.nav_icon,style:c.nav_icon}):e.jsx(w,{className:o.nav_icon,style:c.nav_icon})}),!t.hideNext&&e.jsx(pm,{name:"next-month","aria-label":y,className:b,style:c.nav_button_next,disabled:!t.nextMonth,onClick:t.onNextClick,children:a==="rtl"?e.jsx(w,{className:o.nav_icon,style:c.nav_icon}):e.jsx(v,{className:o.nav_icon,style:c.nav_icon})})]})}function Jy(t){var s=js().numberOfMonths,n=Nd(),r=n.previousMonth,a=n.nextMonth,i=n.goToMonth,o=n.displayMonths,c=o.findIndex(function(y){return tx(t.displayMonth,y)}),u=c===0,d=c===o.length-1,h=s>1&&(u||!d),p=s>1&&(d||!u),g=function(){r&&i(r)},x=function(){a&&i(a)};return e.jsx(U3,{displayMonth:t.displayMonth,hideNext:h,hidePrevious:p,nextMonth:a,previousMonth:r,onPreviousClick:g,onNextClick:x})}function W3(t){var s,n=js(),r=n.classNames,a=n.disableNavigation,i=n.styles,o=n.captionLayout,c=n.components,u=(s=c==null?void 0:c.CaptionLabel)!==null&&s!==void 0?s:TS,d;return a?d=e.jsx(u,{id:t.id,displayMonth:t.displayMonth}):o==="dropdown"?d=e.jsx(Ky,{displayMonth:t.displayMonth,id:t.id}):o==="dropdown-buttons"?d=e.jsxs(e.Fragment,{children:[e.jsx(Ky,{displayMonth:t.displayMonth,displayIndex:t.displayIndex,id:t.id}),e.jsx(Jy,{displayMonth:t.displayMonth,displayIndex:t.displayIndex,id:t.id})]}):d=e.jsxs(e.Fragment,{children:[e.jsx(u,{id:t.id,displayMonth:t.displayMonth,displayIndex:t.displayIndex}),e.jsx(Jy,{displayMonth:t.displayMonth,id:t.id})]}),e.jsx("div",{className:r.caption,style:i.caption,children:d})}function Y3(t){var s=js(),n=s.footer,r=s.styles,a=s.classNames.tfoot;return n?e.jsx("tfoot",{className:a,style:r.tfoot,children:e.jsx("tr",{children:e.jsx("td",{colSpan:8,children:n})})}):e.jsx(e.Fragment,{})}function V3(t,s,n){for(var r=n?sx(new Date):Pa(new Date,{locale:t,weekStartsOn:s}),a=[],i=0;i<7;i++){var o=os(r,i);a.push(o)}return a}function G3(){var t=js(),s=t.classNames,n=t.styles,r=t.showWeekNumber,a=t.locale,i=t.weekStartsOn,o=t.ISOWeek,c=t.formatters.formatWeekdayName,u=t.labels.labelWeekday,d=V3(a,i,o);return e.jsxs("tr",{style:n.head_row,className:s.head_row,children:[r&&e.jsx("td",{style:n.head_cell,className:s.head_cell}),d.map(function(h,p){return e.jsx("th",{scope:"col",className:s.head_cell,style:n.head_cell,"aria-label":u(h,{locale:a}),children:c(h,{locale:a})},p)})]})}function q3(){var t,s=js(),n=s.classNames,r=s.styles,a=s.components,i=(t=a==null?void 0:a.HeadRow)!==null&&t!==void 0?t:G3;return e.jsx("thead",{style:r.head,className:n.head,children:e.jsx(i,{})})}function K3(t){var s=js(),n=s.locale,r=s.formatters.formatDay;return e.jsx(e.Fragment,{children:r(t.date,{locale:n})})}var Lx=f.createContext(void 0);function J3(t){if(!jd(t.initialProps)){var s={selected:void 0,modifiers:{disabled:[]}};return e.jsx(Lx.Provider,{value:s,children:t.children})}return e.jsx(X3,{initialProps:t.initialProps,children:t.children})}function X3(t){var s=t.initialProps,n=t.children,r=s.selected,a=s.min,i=s.max,o=function(d,h,p){var g,x;(g=s.onDayClick)===null||g===void 0||g.call(s,d,h,p);var y=!!(h.selected&&a&&(r==null?void 0:r.length)===a);if(!y){var b=!!(!h.selected&&i&&(r==null?void 0:r.length)===i);if(!b){var v=r?CS([],r):[];if(h.selected){var w=v.findIndex(function(N){return pn(d,N)});v.splice(w,1)}else v.push(d);(x=s.onSelect)===null||x===void 0||x.call(s,v,d,h,p)}}},c={disabled:[]};r&&c.disabled.push(function(d){var h=i&&r.length>i-1,p=r.some(function(g){return pn(g,d)});return!!(h&&!p)});var u={selected:r,onDayClick:o,modifiers:c};return e.jsx(Lx.Provider,{value:u,children:n})}function $x(){var t=f.useContext(Lx);if(!t)throw new Error("useSelectMultiple must be used within a SelectMultipleProvider");return t}function Z3(t,s){var n=s||{},r=n.from,a=n.to;return r&&a?pn(a,t)&&pn(r,t)?void 0:pn(a,t)?{from:a,to:void 0}:pn(r,t)?void 0:Qu(r,t)?{from:t,to:a}:{from:r,to:t}:a?Qu(t,a)?{from:a,to:t}:{from:t,to:a}:r?Is(t,r)?{from:t,to:r}:{from:r,to:t}:{from:t,to:void 0}}var zx=f.createContext(void 0);function Q3(t){if(!wd(t.initialProps)){var s={selected:void 0,modifiers:{range_start:[],range_end:[],range_middle:[],disabled:[]}};return e.jsx(zx.Provider,{value:s,children:t.children})}return e.jsx(e$,{initialProps:t.initialProps,children:t.children})}function e$(t){var s=t.initialProps,n=t.children,r=s.selected,a=r||{},i=a.from,o=a.to,c=s.min,u=s.max,d=function(x,y,b){var v,w;(v=s.onDayClick)===null||v===void 0||v.call(s,x,y,b);var N=Z3(x,r);(w=s.onSelect)===null||w===void 0||w.call(s,N,x,y,b)},h={range_start:[],range_end:[],range_middle:[],disabled:[]};if(i?(h.range_start=[i],o?(h.range_end=[o],pn(i,o)||(h.range_middle=[{after:i,before:o}])):h.range_end=[i]):o&&(h.range_start=[o],h.range_end=[o]),c&&(i&&!o&&h.disabled.push({after:$c(i,c-1),before:os(i,c-1)}),i&&o&&h.disabled.push({after:i,before:os(i,c-1)}),!i&&o&&h.disabled.push({after:$c(o,c-1),before:os(o,c-1)})),u){if(i&&!o&&(h.disabled.push({before:os(i,-u+1)}),h.disabled.push({after:os(i,u-1)})),i&&o){var p=di(o,i)+1,g=u-p;h.disabled.push({before:$c(i,g)}),h.disabled.push({after:os(o,g)})}!i&&o&&(h.disabled.push({before:os(o,-u+1)}),h.disabled.push({after:os(o,u-1)}))}return e.jsx(zx.Provider,{value:{selected:r,onDayClick:d,modifiers:h},children:n})}function Fx(){var t=f.useContext(zx);if(!t)throw new Error("useSelectRange must be used within a SelectRangeProvider");return t}function Gu(t){return Array.isArray(t)?CS([],t):t!==void 0?[t]:[]}function t$(t){var s={};return Object.entries(t).forEach(function(n){var r=n[0],a=n[1];s[r]=Gu(a)}),s}var ia;(function(t){t.Outside="outside",t.Disabled="disabled",t.Selected="selected",t.Hidden="hidden",t.Today="today",t.RangeStart="range_start",t.RangeEnd="range_end",t.RangeMiddle="range_middle"})(ia||(ia={}));var s$=ia.Selected,ti=ia.Disabled,n$=ia.Hidden,r$=ia.Today,Pf=ia.RangeEnd,Mf=ia.RangeMiddle,If=ia.RangeStart,a$=ia.Outside;function i$(t,s,n){var r,a=(r={},r[s$]=Gu(t.selected),r[ti]=Gu(t.disabled),r[n$]=Gu(t.hidden),r[r$]=[t.today],r[Pf]=[],r[Mf]=[],r[If]=[],r[a$]=[],r);return t.fromDate&&a[ti].push({before:t.fromDate}),t.toDate&&a[ti].push({after:t.toDate}),jd(t)?a[ti]=a[ti].concat(s.modifiers[ti]):wd(t)&&(a[ti]=a[ti].concat(n.modifiers[ti]),a[If]=n.modifiers[If],a[Mf]=n.modifiers[Mf],a[Pf]=n.modifiers[Pf]),a}var AS=f.createContext(void 0);function o$(t){var s=js(),n=$x(),r=Fx(),a=i$(s,n,r),i=t$(s.modifiers),o=tt(tt({},a),i);return e.jsx(AS.Provider,{value:o,children:t.children})}function _S(){var t=f.useContext(AS);if(!t)throw new Error("useModifiers must be used within a ModifiersProvider");return t}function l$(t){return!!(t&&typeof t=="object"&&"before"in t&&"after"in t)}function c$(t){return!!(t&&typeof t=="object"&&"from"in t)}function d$(t){return!!(t&&typeof t=="object"&&"after"in t)}function u$(t){return!!(t&&typeof t=="object"&&"before"in t)}function m$(t){return!!(t&&typeof t=="object"&&"dayOfWeek"in t)}function h$(t,s){var n,r=s.from,a=s.to;if(r&&a){var i=di(a,r)<0;i&&(n=[a,r],r=n[0],a=n[1]);var o=di(t,r)>=0&&di(a,t)>=0;return o}return a?pn(a,t):r?pn(r,t):!1}function f$(t){return qj(t)}function p$(t){return Array.isArray(t)&&t.every(qj)}function x$(t,s){return s.some(function(n){if(typeof n=="boolean")return n;if(f$(n))return pn(t,n);if(p$(n))return n.includes(t);if(c$(n))return h$(t,n);if(m$(n))return n.dayOfWeek.includes(t.getDay());if(l$(n)){var r=di(n.before,t),a=di(n.after,t),i=r>0,o=a<0,c=Qu(n.before,n.after);return c?o&&i:i||o}return d$(n)?di(t,n.after)>0:u$(n)?di(n.before,t)>0:typeof n=="function"?n(t):!1})}function Bx(t,s,n){var r=Object.keys(s).reduce(function(i,o){var c=s[o];return x$(t,c)&&i.push(o),i},[]),a={};return r.forEach(function(i){return a[i]=!0}),n&&!tx(t,n)&&(a.outside=!0),a}function g$(t,s){for(var n=ls(t[0]),r=vr(t[t.length-1]),a,i,o=n;o<=r;){var c=Bx(o,s),u=!c.disabled&&!c.hidden;if(!u){o=os(o,1);continue}if(c.selected)return o;c.today&&!i&&(i=o),a||(a=o),o=os(o,1)}return i||a}var v$=365;function RS(t,s){var n=s.moveBy,r=s.direction,a=s.context,i=s.modifiers,o=s.retry,c=o===void 0?{count:0,lastFocused:t}:o,u=a.weekStartsOn,d=a.fromDate,h=a.toDate,p=a.locale,g={day:os,week:Kc,month:ra,year:KR,startOfWeek:function(v){return a.ISOWeek?sx(v):Pa(v,{locale:p,weekStartsOn:u})},endOfWeek:function(v){return a.ISOWeek?Gj(v):Rr(v,{locale:p,weekStartsOn:u})}},x=g[n](t,r==="after"?1:-1);r==="before"&&d?x=JR([d,x]):r==="after"&&h&&(x=XR([h,x]));var y=!0;if(i){var b=Bx(x,i);y=!b.disabled&&!b.hidden}return y?x:c.count>v$?c.lastFocused:RS(x,{moveBy:n,direction:r,context:a,modifiers:i,retry:tt(tt({},c),{count:c.count+1})})}var OS=f.createContext(void 0);function y$(t){var s=Nd(),n=_S(),r=f.useState(),a=r[0],i=r[1],o=f.useState(),c=o[0],u=o[1],d=g$(s.displayMonths,n),h=a??(c&&s.isDateDisplayed(c))?c:d,p=function(){u(a),i(void 0)},g=function(v){i(v)},x=js(),y=function(v,w){if(a){var N=RS(a,{moveBy:v,direction:w,context:x,modifiers:n});pn(a,N)||(s.goToDate(N,a),g(N))}},b={focusedDay:a,focusTarget:h,blur:p,focus:g,focusDayAfter:function(){return y("day","after")},focusDayBefore:function(){return y("day","before")},focusWeekAfter:function(){return y("week","after")},focusWeekBefore:function(){return y("week","before")},focusMonthBefore:function(){return y("month","before")},focusMonthAfter:function(){return y("month","after")},focusYearBefore:function(){return y("year","before")},focusYearAfter:function(){return y("year","after")},focusStartOfWeek:function(){return y("startOfWeek","before")},focusEndOfWeek:function(){return y("endOfWeek","after")}};return e.jsx(OS.Provider,{value:b,children:t.children})}function Hx(){var t=f.useContext(OS);if(!t)throw new Error("useFocusContext must be used within a FocusProvider");return t}function b$(t,s){var n=_S(),r=Bx(t,n,s);return r}var Ux=f.createContext(void 0);function j$(t){if(!Jm(t.initialProps)){var s={selected:void 0};return e.jsx(Ux.Provider,{value:s,children:t.children})}return e.jsx(w$,{initialProps:t.initialProps,children:t.children})}function w$(t){var s=t.initialProps,n=t.children,r=function(i,o,c){var u,d,h;if((u=s.onDayClick)===null||u===void 0||u.call(s,i,o,c),o.selected&&!s.required){(d=s.onSelect)===null||d===void 0||d.call(s,void 0,i,o,c);return}(h=s.onSelect)===null||h===void 0||h.call(s,i,i,o,c)},a={selected:s.selected,onDayClick:r};return e.jsx(Ux.Provider,{value:a,children:n})}function PS(){var t=f.useContext(Ux);if(!t)throw new Error("useSelectSingle must be used within a SelectSingleProvider");return t}function N$(t,s){var n=js(),r=PS(),a=$x(),i=Fx(),o=Hx(),c=o.focusDayAfter,u=o.focusDayBefore,d=o.focusWeekAfter,h=o.focusWeekBefore,p=o.blur,g=o.focus,x=o.focusMonthBefore,y=o.focusMonthAfter,b=o.focusYearBefore,v=o.focusYearAfter,w=o.focusStartOfWeek,N=o.focusEndOfWeek,S=function(z){var G,ae,Y,X;Jm(n)?(G=r.onDayClick)===null||G===void 0||G.call(r,t,s,z):jd(n)?(ae=a.onDayClick)===null||ae===void 0||ae.call(a,t,s,z):wd(n)?(Y=i.onDayClick)===null||Y===void 0||Y.call(i,t,s,z):(X=n.onDayClick)===null||X===void 0||X.call(n,t,s,z)},E=function(z){var G;g(t),(G=n.onDayFocus)===null||G===void 0||G.call(n,t,s,z)},k=function(z){var G;p(),(G=n.onDayBlur)===null||G===void 0||G.call(n,t,s,z)},D=function(z){var G;(G=n.onDayMouseEnter)===null||G===void 0||G.call(n,t,s,z)},T=function(z){var G;(G=n.onDayMouseLeave)===null||G===void 0||G.call(n,t,s,z)},R=function(z){var G;(G=n.onDayPointerEnter)===null||G===void 0||G.call(n,t,s,z)},O=function(z){var G;(G=n.onDayPointerLeave)===null||G===void 0||G.call(n,t,s,z)},U=function(z){var G;(G=n.onDayTouchCancel)===null||G===void 0||G.call(n,t,s,z)},I=function(z){var G;(G=n.onDayTouchEnd)===null||G===void 0||G.call(n,t,s,z)},_=function(z){var G;(G=n.onDayTouchMove)===null||G===void 0||G.call(n,t,s,z)},M=function(z){var G;(G=n.onDayTouchStart)===null||G===void 0||G.call(n,t,s,z)},W=function(z){var G;(G=n.onDayKeyUp)===null||G===void 0||G.call(n,t,s,z)},B=function(z){var G;switch(z.key){case"ArrowLeft":z.preventDefault(),z.stopPropagation(),n.dir==="rtl"?c():u();break;case"ArrowRight":z.preventDefault(),z.stopPropagation(),n.dir==="rtl"?u():c();break;case"ArrowDown":z.preventDefault(),z.stopPropagation(),d();break;case"ArrowUp":z.preventDefault(),z.stopPropagation(),h();break;case"PageUp":z.preventDefault(),z.stopPropagation(),z.shiftKey?b():x();break;case"PageDown":z.preventDefault(),z.stopPropagation(),z.shiftKey?v():y();break;case"Home":z.preventDefault(),z.stopPropagation(),w();break;case"End":z.preventDefault(),z.stopPropagation(),N();break}(G=n.onDayKeyDown)===null||G===void 0||G.call(n,t,s,z)},P={onClick:S,onFocus:E,onBlur:k,onKeyDown:B,onKeyUp:W,onMouseEnter:D,onMouseLeave:T,onPointerEnter:R,onPointerLeave:O,onTouchCancel:U,onTouchEnd:I,onTouchMove:_,onTouchStart:M};return P}function S$(){var t=js(),s=PS(),n=$x(),r=Fx(),a=Jm(t)?s.selected:jd(t)?n.selected:wd(t)?r.selected:void 0;return a}function C$(t){return Object.values(ia).includes(t)}function E$(t,s){var n=[t.classNames.day];return Object.keys(s).forEach(function(r){var a=t.modifiersClassNames[r];if(a)n.push(a);else if(C$(r)){var i=t.classNames["day_".concat(r)];i&&n.push(i)}}),n}function T$(t,s){var n=tt({},t.styles.day);return Object.keys(s).forEach(function(r){var a;n=tt(tt({},n),(a=t.modifiersStyles)===null||a===void 0?void 0:a[r])}),n}function D$(t,s,n){var r,a,i,o=js(),c=Hx(),u=b$(t,s),d=N$(t,u),h=S$(),p=!!(o.onDayClick||o.mode!=="default");f.useEffect(function(){var D;u.outside||c.focusedDay&&p&&pn(c.focusedDay,t)&&((D=n.current)===null||D===void 0||D.focus())},[c.focusedDay,t,n,p,u.outside]);var g=E$(o,u).join(" "),x=T$(o,u),y=!!(u.outside&&!o.showOutsideDays||u.hidden),b=(i=(a=o.components)===null||a===void 0?void 0:a.DayContent)!==null&&i!==void 0?i:K3,v=e.jsx(b,{date:t,displayMonth:s,activeModifiers:u}),w={style:x,className:g,children:v,role:"gridcell"},N=c.focusTarget&&pn(c.focusTarget,t)&&!u.outside,S=c.focusedDay&&pn(c.focusedDay,t),E=tt(tt(tt({},w),(r={disabled:u.disabled,role:"gridcell"},r["aria-selected"]=u.selected,r.tabIndex=S||N?0:-1,r)),d),k={isButton:p,isHidden:y,activeModifiers:u,selectedDays:h,buttonProps:E,divProps:w};return k}function k$(t){var s=f.useRef(null),n=D$(t.date,t.displayMonth,s);return n.isHidden?e.jsx("div",{role:"gridcell"}):n.isButton?e.jsx(pm,tt({name:"day",ref:s},n.buttonProps)):e.jsx("div",tt({},n.divProps))}function A$(t){var s=t.number,n=t.dates,r=js(),a=r.onWeekNumberClick,i=r.styles,o=r.classNames,c=r.locale,u=r.labels.labelWeekNumber,d=r.formatters.formatWeekNumber,h=d(Number(s),{locale:c});if(!a)return e.jsx("span",{className:o.weeknumber,style:i.weeknumber,children:h});var p=u(Number(s),{locale:c}),g=function(x){a(s,n,x)};return e.jsx(pm,{name:"week-number","aria-label":p,className:o.weeknumber,style:i.weeknumber,onClick:g,children:h})}function _$(t){var s,n,r=js(),a=r.styles,i=r.classNames,o=r.showWeekNumber,c=r.components,u=(s=c==null?void 0:c.Day)!==null&&s!==void 0?s:k$,d=(n=c==null?void 0:c.WeekNumber)!==null&&n!==void 0?n:A$,h;return o&&(h=e.jsx("td",{className:i.cell,style:a.cell,children:e.jsx(d,{number:t.weekNumber,dates:t.dates})})),e.jsxs("tr",{className:i.row,style:a.row,children:[h,t.dates.map(function(p){return e.jsx("td",{className:i.cell,style:a.cell,role:"presentation",children:e.jsx(u,{displayMonth:t.displayMonth,date:p})},qR(p))})]})}function Xy(t,s,n){for(var r=n!=null&&n.ISOWeek?Gj(s):Rr(s,n),a=n!=null&&n.ISOWeek?sx(t):Pa(t,n),i=di(r,a),o=[],c=0;c<=i;c++)o.push(os(a,c));var u=o.reduce(function(d,h){var p=n!=null&&n.ISOWeek?QR(h):eO(h,n),g=d.find(function(x){return x.weekNumber===p});return g?(g.dates.push(h),d):(d.push({weekNumber:p,dates:[h]}),d)},[]);return u}function R$(t,s){var n=Xy(ls(t),vr(t),s);if(s!=null&&s.useFixedWeeks){var r=GR(t,s);if(r<6){var a=n[n.length-1],i=a.dates[a.dates.length-1],o=Kc(i,6-r),c=Xy(Kc(i,1),o,s);n.push.apply(n,c)}}return n}function O$(t){var s,n,r,a=js(),i=a.locale,o=a.classNames,c=a.styles,u=a.hideHead,d=a.fixedWeeks,h=a.components,p=a.weekStartsOn,g=a.firstWeekContainsDate,x=a.ISOWeek,y=R$(t.displayMonth,{useFixedWeeks:!!d,ISOWeek:x,locale:i,weekStartsOn:p,firstWeekContainsDate:g}),b=(s=h==null?void 0:h.Head)!==null&&s!==void 0?s:q3,v=(n=h==null?void 0:h.Row)!==null&&n!==void 0?n:_$,w=(r=h==null?void 0:h.Footer)!==null&&r!==void 0?r:Y3;return e.jsxs("table",{id:t.id,className:o.table,style:c.table,role:"grid","aria-labelledby":t["aria-labelledby"],children:[!u&&e.jsx(b,{}),e.jsx("tbody",{className:o.tbody,style:c.tbody,children:y.map(function(N){return e.jsx(v,{displayMonth:t.displayMonth,dates:N.dates,weekNumber:N.weekNumber},N.weekNumber)})}),e.jsx(w,{displayMonth:t.displayMonth})]})}function P$(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var M$=P$()?f.useLayoutEffect:f.useEffect,Lf=!1,I$=0;function Zy(){return"react-day-picker-".concat(++I$)}function L$(t){var s,n=t??(Lf?Zy():null),r=f.useState(n),a=r[0],i=r[1];return M$(function(){a===null&&i(Zy())},[]),f.useEffect(function(){Lf===!1&&(Lf=!0)},[]),(s=t??a)!==null&&s!==void 0?s:void 0}function $$(t){var s,n,r=js(),a=r.dir,i=r.classNames,o=r.styles,c=r.components,u=Nd().displayMonths,d=L$(r.id?"".concat(r.id,"-").concat(t.displayIndex):void 0),h=r.id?"".concat(r.id,"-grid-").concat(t.displayIndex):void 0,p=[i.month],g=o.month,x=t.displayIndex===0,y=t.displayIndex===u.length-1,b=!x&&!y;a==="rtl"&&(s=[x,y],y=s[0],x=s[1]),x&&(p.push(i.caption_start),g=tt(tt({},g),o.caption_start)),y&&(p.push(i.caption_end),g=tt(tt({},g),o.caption_end)),b&&(p.push(i.caption_between),g=tt(tt({},g),o.caption_between));var v=(n=c==null?void 0:c.Caption)!==null&&n!==void 0?n:W3;return e.jsxs("div",{className:p.join(" "),style:g,children:[e.jsx(v,{id:d,displayMonth:t.displayMonth,displayIndex:t.displayIndex}),e.jsx(O$,{id:h,"aria-labelledby":d,displayMonth:t.displayMonth})]},t.displayIndex)}function z$(t){var s=js(),n=s.classNames,r=s.styles;return e.jsx("div",{className:n.months,style:r.months,children:t.children})}function F$(t){var s,n,r=t.initialProps,a=js(),i=Hx(),o=Nd(),c=f.useState(!1),u=c[0],d=c[1];f.useEffect(function(){a.initialFocus&&i.focusTarget&&(u||(i.focus(i.focusTarget),d(!0)))},[a.initialFocus,u,i.focus,i.focusTarget,i]);var h=[a.classNames.root,a.className];a.numberOfMonths>1&&h.push(a.classNames.multiple_months),a.showWeekNumber&&h.push(a.classNames.with_weeknumber);var p=tt(tt({},a.styles.root),a.style),g=Object.keys(r).filter(function(y){return y.startsWith("data-")}).reduce(function(y,b){var v;return tt(tt({},y),(v={},v[b]=r[b],v))},{}),x=(n=(s=r.components)===null||s===void 0?void 0:s.Months)!==null&&n!==void 0?n:z$;return e.jsx("div",tt({className:h.join(" "),style:p,dir:a.dir,id:a.id,nonce:r.nonce,title:r.title,lang:r.lang},g,{children:e.jsx(x,{children:o.displayMonths.map(function(y,b){return e.jsx($$,{displayIndex:b,displayMonth:y},b)})})}))}function B$(t){var s=t.children,n=u3(t,["children"]);return e.jsx(A3,{initialProps:n,children:e.jsx(F3,{children:e.jsx(j$,{initialProps:n,children:e.jsx(J3,{initialProps:n,children:e.jsx(Q3,{initialProps:n,children:e.jsx(o$,{children:e.jsx(y$,{children:s})})})})})})})}function H$(t){return e.jsx(B$,tt({},t,{children:e.jsx(F$,{initialProps:t})}))}function Sd({className:t,classNames:s,showOutsideDays:n=!0,components:r,...a}){return e.jsx(H$,{showOutsideDays:n,className:ce("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:ce(td({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:ce(td({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...s},components:{IconLeft:()=>e.jsx(ix,{className:"h-4 w-4"}),IconRight:()=>e.jsx(Ma,{className:"h-4 w-4"}),...r},...a})}Sd.displayName="Calendar";const U$=({selectedDate:t,goal:s=2500})=>{const[n,r]=f.useState(ls(t));f.useEffect(()=>{r(ls(t))},[t]);const a=f.useMemo(()=>ls(n),[n]),i=f.useMemo(()=>vr(n),[n]),{stats:o,loading:c}=aS(a,i),u=f.useMemo(()=>{const h={};return o==null||o.dailyStats.forEach(({date:p,intake:g})=>{h[p]=g}),h},[o]),d=h=>{const p=Ie(h.date),g=u[p]||0,x=Math.min(g/s,1),y=28,b=3,v=(y-b)/2,w=2*Math.PI*v,N=w-x*w,S=g>=s;return e.jsxs("div",{className:"relative flex items-center justify-center w-7 h-7",children:[e.jsxs("svg",{width:y,height:y,className:"absolute",children:[e.jsx("circle",{cx:y/2,cy:y/2,r:v,stroke:S?"#bfdbfe":"#e5e7eb",strokeWidth:b,fill:"none"}),e.jsx("circle",{cx:y/2,cy:y/2,r:v,stroke:S?"#3b82f6":"#9ca3af",strokeWidth:b,fill:"none",strokeDasharray:w,strokeDashoffset:N,strokeLinecap:"round",style:{transform:"rotate(-90deg)",transformOrigin:"50% 50%"}})]}),e.jsx("span",{className:"text-[10px] font-medium z-10",children:h.date.getDate()})]})};return e.jsxs(Ce,{className:"w-full",children:[e.jsxs(Kt,{className:"flex flex-col items-center gap-2",children:[e.jsx(nx,{className:"w-5 h-5 text-blue-600"}),e.jsx(Gt,{className:"text-center",children:"Historial Mensual"})]}),e.jsxs(Ae,{className:"relative p-4",children:[c&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/50 z-10",children:e.jsx(fs,{className:"w-6 h-6 animate-spin"})}),e.jsx(Sd,{month:n,onMonthChange:r,showOutsideDays:!0,components:{DayContent:d},className:"p-0 w-full"})]})]})},W$=({selectedDate:t,goal:s})=>{const[n,r]=f.useState(null),[a,i]=f.useState(!1),{user:o}=Je(),{intake:c,drinks:u,status:d,error:h,addDrink:p,editDrink:g,deleteDrink:x,resync:y}=Xw(t),{isOnline:b}=ua();if(!o)return e.jsx(Ce,{className:"w-full",children:e.jsx(Ae,{className:"p-4 text-center",children:e.jsx("p",{children:"Inicia sesin para registrar tu hidratacin"})})});const v=Ie(t)===Ie(new Date);return e.jsxs(Ce,{className:"w-full shadow-sm border-0 bg-gradient-to-br from-white to-blue-50/30",children:[e.jsx(Ae,{className:"p-6 md:p-8",children:e.jsxs("div",{className:"space-y-8",children:[e.jsx(YL,{intake:c,goal:s}),v&&e.jsx("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:e.jsx(o3,{selectedDrink:n,onDrinkSelect:r,onAmountSelect:(w,N)=>{p(w,N),r(null)},disabled:d==="saving"||!b})}),e.jsx(d3,{drinks:u,showHistory:a,onToggleHistory:()=>i(!a),onDeleteDrink:x,onEditDrink:g,isCurrentDate:v}),h&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 shadow-sm",children:e.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-red-500 rounded-full flex-shrink-0"}),h]})}),d==="saving"&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4 shadow-sm",children:e.jsxs("p",{className:"text-sm text-blue-600 flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin flex-shrink-0"}),"Guardando tu progreso..."]})})]})}),e.jsxs(In,{className:"justify-center gap-2 text-xs p-2",children:[d==="saving"&&e.jsx("span",{className:"text-blue-500",children:"Guardando..."}),d==="pending"&&e.jsx("span",{className:"text-yellow-600",children:"Pendiente de sincronizar"}),d==="saved"&&e.jsx("span",{className:"text-green-600",children:"Sincronizado"}),d==="error"&&e.jsx("span",{className:"text-red-600",children:"Error de sincronizacin"}),!b&&e.jsx("span",{className:"text-orange-600",children:"Offline"}),e.jsx($,{onClick:y,variant:"link",className:"p-0 h-auto",children:"Reintentar"})]})]})},Y$=t=>{const[s,n]=f.useState(null),[r,a]=f.useState(!0),[i,o]=f.useState(null),{user:c}=Je();return f.useEffect(()=>{(async()=>{if(c){a(!0),o(null);try{const d=[];for(let S=6;S>=0;S--){const E=new Date(t);E.setDate(E.getDate()-S),d.push(Ie(E))}const h=await Promise.all(d.map(async S=>{const E=ke(xe,"water",`${c.uid}_${S}`),k=await ot(E);return k.exists()?{date:S,drinks:k.data().drinks||[],totalWater:k.data().totalWater||0}:{date:S,drinks:[],totalWater:0}})),p=kn.sumBy(h,"totalWater"),g=p/7,x=h.flatMap(S=>S.drinks),y=kn.groupBy(x,"type"),b=Object.entries(y).map(([S,E])=>({type:S,count:E.length,totalAmount:kn.sumBy(E,"amount"),percentage:kn.sumBy(E,"amount")/p*100||0})).sort((S,E)=>E.count-S.count),v=kn.groupBy(x,S=>or[S.type].category),w=Object.entries(v).map(([S,E])=>({category:S,totalAmount:kn.sumBy(E,"amount"),percentage:kn.sumBy(E,"amount")/p*100||0})).sort((S,E)=>E.totalAmount-S.totalAmount),N=h.map(S=>({date:S.date,intake:S.totalWater}));n({totalIntake:p,avgDailyIntake:g,commonDrinks:b,dailyIntake:N,categoryStats:w})}catch(d){console.error("Error al cargar estadsticas:",d),o(d instanceof Error?d.message:"Error al cargar estadsticas")}finally{a(!1)}}})()},[c,t]),{stats:s,loading:r,error:i}},Qy=["#60A5FA","#34D399","#A78BFA","#F87171","#FBBF24","#A3E635"],V$=({selectedDate:t})=>{const{stats:s,loading:n,error:r}=Y$(t);return n?e.jsx(Ce,{className:"w-full",children:e.jsx(Ae,{className:"flex items-center justify-center p-6",children:e.jsx(fs,{className:"w-6 h-6 animate-spin"})})}):r||!s?e.jsx(Ce,{className:"w-full",children:e.jsx(Ae,{className:"p-6",children:e.jsx("p",{className:"text-red-500",children:"Error al cargar estadsticas"})})}):e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(Ce,{className:"w-full",children:[e.jsx(Kt,{children:e.jsx(Gt,{children:"Consumo Diario"})}),e.jsxs(Ae,{children:[e.jsx("div",{className:"h-64",children:e.jsx(On,{width:"100%",height:"100%",children:e.jsxs(Pm,{data:s.dailyIntake,children:[e.jsx(Qr,{dataKey:"date",tickFormatter:a=>new Date(a).toLocaleDateString("es-ES",{weekday:"short"})}),e.jsx(_r,{tickFormatter:a=>`${a}ml`}),e.jsx(Pn,{formatter:a=>[`${a}ml`,"Consumo"],labelFormatter:a=>new Date(a).toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"short"})}),e.jsx(Xc,{dataKey:"intake",fill:"#60A5FA"})]})})}),e.jsxs("div",{className:"mt-4 text-sm text-gray-500 text-center",children:["Promedio diario: ",Math.round(s.avgDailyIntake),"ml"]})]})]}),e.jsxs(Ce,{className:"w-full",children:[e.jsx(Kt,{children:e.jsx(Gt,{children:"Distribucin por Categora"})}),e.jsx(Ae,{children:e.jsx("div",{className:"h-64",children:e.jsx(On,{width:"100%",height:"100%",children:e.jsxs(hd,{children:[e.jsx(fd,{data:s.categoryStats,dataKey:"totalAmount",nameKey:"category",cx:"50%",cy:"50%",outerRadius:80,label:({category:a})=>rd[a],children:s.categoryStats.map((a,i)=>e.jsx(pd,{fill:Qy[i%Qy.length]},a.category))}),e.jsx(Pn,{formatter:a=>[`${a}ml`,"Cantidad"],labelFormatter:a=>rd[a]})]})})})})]}),e.jsxs(Ce,{className:"w-full md:col-span-2",children:[e.jsx(Kt,{children:e.jsx(Gt,{children:"Bebidas Ms Consumidas"})}),e.jsxs(Ae,{children:["          ",e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4",children:[" ",s.commonDrinks.slice(0,6).map(a=>{const i=or[a.type],o=io[i.icon];return e.jsxs("div",{className:"flex flex-col items-center p-4 rounded-lg bg-muted text-center",children:[e.jsx(o,{className:`w-6 h-6 ${i.color} mb-2 flex-shrink-0`}),e.jsx("span",{className:"font-medium text-sm leading-tight",children:i.name})," ",e.jsxs("span",{className:"text-sm text-muted-foreground mt-1",children:[" ",a.totalAmount,"ml"]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[" ",a.count," veces"]})]},a.type)})]})]})]})]})};var G$="Label",MS=f.forwardRef((t,s)=>e.jsx(jt.label,{...t,ref:s,onMouseDown:n=>{var a;n.target.closest("button, input, select, textarea")||((a=t.onMouseDown)==null||a.call(t,n),!n.defaultPrevented&&n.detail>1&&n.preventDefault())}}));MS.displayName=G$;var IS=MS;const q$=Il("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),ze=f.forwardRef(({className:t,...s},n)=>e.jsx(IS,{ref:n,className:ce(q$(),t),...s}));ze.displayName=IS.displayName;var Xm="Tabs",[K$,fY]=za(Xm,[Rm]),LS=Rm(),[J$,Wx]=K$(Xm),$S=f.forwardRef((t,s)=>{const{__scopeTabs:n,value:r,onValueChange:a,defaultValue:i,orientation:o="horizontal",dir:c,activationMode:u="automatic",...d}=t,h=_m(c),[p,g]=Oa({prop:r,onChange:a,defaultProp:i??"",caller:Xm});return e.jsx(J$,{scope:n,baseId:_l(),value:p,onValueChange:g,orientation:o,dir:h,activationMode:u,children:e.jsx(jt.div,{dir:h,"data-orientation":o,...d,ref:s})})});$S.displayName=Xm;var zS="TabsList",FS=f.forwardRef((t,s)=>{const{__scopeTabs:n,loop:r=!0,...a}=t,i=Wx(zS,n),o=LS(n);return e.jsx(Rj,{asChild:!0,...o,orientation:i.orientation,dir:i.dir,loop:r,children:e.jsx(jt.div,{role:"tablist","aria-orientation":i.orientation,...a,ref:s})})});FS.displayName=zS;var BS="TabsTrigger",HS=f.forwardRef((t,s)=>{const{__scopeTabs:n,value:r,disabled:a=!1,...i}=t,o=Wx(BS,n),c=LS(n),u=YS(o.baseId,r),d=VS(o.baseId,r),h=r===o.value;return e.jsx(Oj,{asChild:!0,...c,focusable:!a,active:h,children:e.jsx(jt.button,{type:"button",role:"tab","aria-selected":h,"aria-controls":d,"data-state":h?"active":"inactive","data-disabled":a?"":void 0,disabled:a,id:u,...i,ref:s,onMouseDown:it(t.onMouseDown,p=>{!a&&p.button===0&&p.ctrlKey===!1?o.onValueChange(r):p.preventDefault()}),onKeyDown:it(t.onKeyDown,p=>{[" ","Enter"].includes(p.key)&&o.onValueChange(r)}),onFocus:it(t.onFocus,()=>{const p=o.activationMode!=="manual";!h&&!a&&p&&o.onValueChange(r)})})})});HS.displayName=BS;var US="TabsContent",WS=f.forwardRef((t,s)=>{const{__scopeTabs:n,value:r,forceMount:a,children:i,...o}=t,c=Wx(US,n),u=YS(c.baseId,r),d=VS(c.baseId,r),h=r===c.value,p=f.useRef(h);return f.useEffect(()=>{const g=requestAnimationFrame(()=>p.current=!1);return()=>cancelAnimationFrame(g)},[]),e.jsx(gi,{present:a||h,children:({present:g})=>e.jsx(jt.div,{"data-state":h?"active":"inactive","data-orientation":c.orientation,role:"tabpanel","aria-labelledby":u,hidden:!g,id:d,tabIndex:0,...o,ref:s,style:{...t.style,animationDuration:p.current?"0s":void 0},children:g&&i})})});WS.displayName=US;function YS(t,s){return`${t}-trigger-${s}`}function VS(t,s){return`${t}-content-${s}`}var X$=$S,GS=FS,qS=HS,KS=WS;const ma=X$,ha=f.forwardRef(({className:t,...s},n)=>e.jsx(GS,{ref:n,className:ce("inline-flex h-10 md:h-12 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground w-full md:w-auto overflow-x-auto",t),...s}));ha.displayName=GS.displayName;const Ds=f.forwardRef(({className:t,...s},n)=>e.jsx(qS,{ref:n,className:ce("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 md:px-4 md:py-2 text-sm md:text-base font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm touch-manipulation active:scale-95 min-w-0 flex-1 md:flex-initial",t),...s}));Ds.displayName=qS.displayName;const ys=f.forwardRef(({className:t,...s},n)=>e.jsx(KS,{ref:n,className:ce("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...s}));ys.displayName=KS.displayName;const Ec=new Map,Tc=new Map;function JS(t,s){const{user:n}=Je(),[r,a]=f.useState(s),[i,o]=f.useState("idle"),[c,u]=f.useState(null),d=f.useRef(!1),h=f.useCallback(async()=>{if(!n||d.current)return;const g=`${n.uid}_${t}`;if(Ec.has(g)){const y=Ec.get(g);a({...s,...y}),d.current=!0;return}if(Tc.has(g))try{const y=await Tc.get(g);a({...s,...y}),d.current=!0;return}catch{}o("loading"),u(null);const x=(async()=>{try{const y=ke(xe,"settings",g);Me.logRead("settings","useModuleSettings.loadSettings",g);const b=await ot(y),v=b.exists()?b.data():{};return Ec.set(g,v),Tc.delete(g),v}catch(y){throw Tc.delete(g),y}})();Tc.set(g,x);try{const y=await x;a({...s,...y}),o("idle"),d.current=!0}catch(y){u(y.message),o("error")}},[n,t]);return f.useEffect(()=>{h()},[h]),{settings:r,status:i,error:c,saveSettings:async g=>{if(!n)return;o("saving"),u(null);const x=r,y=`${n.uid}_${t}`;try{const b={...r,...g};a(b),o("saved");const v=ke(xe,"settings",y),w=Object.fromEntries(Object.entries(g).filter(([,S])=>S!==void 0&&!(typeof S=="number"&&isNaN(S))));Me.logWrite("settings","useModuleSettings.saveSettings",y),await Zt(v,{userId:n.uid,...w},{merge:!0});const N=Ec.get(y)||{};Ec.set(y,{...N,...w})}catch(b){throw a(x),u(b.message),o("error"),b}},refetch:h}}const Z$=()=>{const[t,s]=f.useState(new Date),[n,r]=f.useState(new Date),[a,i]=f.useState(new Date),{user:o}=Je(),c=f.useMemo(()=>({dailyGoal:2e3}),[]),{settings:u,saveSettings:d}=JS("water",c),[h,p]=f.useState(u.dailyGoal);f.useEffect(()=>{p(u.dailyGoal)},[u.dailyGoal]);const g=(x,y)=>{r(x),i(y)};return o?e.jsxs(ln,{children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Control de Hidratacin"}),e.jsx("p",{className:"text-gray-500",children:"Registra y monitorea tu consumo diario de agua"})]}),e.jsxs(ma,{defaultValue:"daily",className:"w-full",children:[e.jsxs(ha,{className:"mb-6",children:[e.jsx(Ds,{value:"daily",children:"Registro Diario"}),e.jsx(Ds,{value:"stats",children:"Estadsticas"}),e.jsx(Ds,{value:"settings",children:"Configuracin"})]}),e.jsxs(ys,{value:"daily",children:[e.jsx(La,{selectedDate:t,onChange:s}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-[1fr_300px]",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx(W$,{selectedDate:t,goal:u.dailyGoal}),e.jsx(V$,{selectedDate:t})]}),e.jsx("div",{children:e.jsx(U$,{selectedDate:t,goal:u.dailyGoal})})]})]}),e.jsxs(ys,{value:"stats",children:[e.jsx(IL,{onPeriodChange:g}),e.jsx(LL,{startDate:n,endDate:a})]}),e.jsx(ys,{value:"settings",className:"space-y-4",children:e.jsx(Ce,{children:e.jsxs(Ae,{className:"pt-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx(ze,{htmlFor:"goal",children:"Meta diaria (ml)"}),e.jsx(Fe,{id:"goal",type:"number",value:h,onChange:x=>p(Number(x.target.value))})]}),e.jsx($,{onClick:()=>d({dailyGoal:h}),children:"Guardar"})]})})})]})]}):e.jsx(ln,{children:e.jsx(Ce,{children:e.jsx(Ae,{className:"p-6",children:e.jsx("p",{className:"text-center",children:"Inicia sesin para ver tus estadsticas de hidratacin"})})})})},Q$=(t,s=2e3)=>{const n=f.useRef(),r=f.useRef(null),a=f.useCallback(c=>{r.current=c,n.current&&clearTimeout(n.current),n.current=setTimeout(async()=>{if(r.current)try{await t(r.current),r.current=null}catch(u){console.error("Error in debounced write:",u)}},s)},[t,s]),i=f.useCallback(async()=>{if(n.current&&clearTimeout(n.current),r.current)try{await t(r.current),r.current=null}catch(c){console.error("Error in flush write:",c)}},[t]),o=f.useCallback(()=>{n.current&&clearTimeout(n.current)},[]);return{debouncedWrite:a,flushPendingWrite:i,cleanup:o,hasPendingWrite:()=>r.current!==null}},$f=crypto.randomUUID(),Dc=30*60,ez=({onComplete:t,onCancel:s,selectedDate:n})=>{const{user:r}=Je(),[a,i]=f.useState(null),[o,c]=f.useState(!1),u=f.useRef(),d=f.useRef(!1),h=f.useRef(0),p=Kw();f.useEffect(()=>{p.setOnCompletion(E=>{console.log("Callback de finalizacin llamado, guardando sesin..."),t(E)})},[p,t]);const g=Ie(n||new Date),x=Q$(async E=>{if(!r)return;const k=ke(xe,"pomodoro",`${r.uid}_${g}`);await Zt(k,E,{merge:!0})},1e3),y=f.useCallback(()=>{u.current&&(cancelAnimationFrame(u.current),u.current=void 0)},[]),b=f.useCallback(()=>{d.current||(d.current=!0,y(),p.stopTimer(),i(null),c(!1),setTimeout(()=>{d.current=!1},100))},[y,p]),v=f.useCallback(E=>{const k=(Date.now()-E)/1e3;return Math.max(0,Dc-k)},[]);f.useEffect(()=>{if(!r)return;const E=ke(xe,"pomodoro",`${r.uid}_${g}`),k=fO(E,D=>{if(!D.exists()){b();return}const R=D.data().activePomodoro;if(!R||o){b();return}if(R.deviceId!==$f&&!p.isActive)return;if(v(R.startTime.timestamp)<=0){const U=Date.now();U-h.current>5e3&&(h.current=U,x.debouncedWrite({activePomodoro:null,updatedAt:ht()})),R.deviceId===$f&&t(Dc),b();return}i(R),p.isActive||p.startTimer()});return()=>{k(),y(),x.cleanup()}},[r,g,p.isActive,o,v,y,b,t,x]);const w=f.useCallback(async()=>{if(!r||p.isActive)return;const E=new Date,D={startTime:jn(n||E,E.getHours(),E.getMinutes()),duration:Dc,deviceId:$f};i(D),c(!1),p.startTimer();try{const T=ke(xe,"pomodoro",`${r.uid}_${g}`);await Zt(T,{userId:r.uid,date:g,activePomodoro:D,updatedAt:ht()},{merge:!0})}catch(T){console.error("Error starting timer:",T),b()}},[r,g,p.isActive,n,b,p]),N=f.useCallback(async()=>{if(!(!r||!a||o))try{c(!0),x.debouncedWrite({activePomodoro:null,updatedAt:ht()});const E=p.time;E>0&&s(E),b()}catch(E){console.error("Error stopping timer:",E),c(!1)}},[r,g,a,o,p.time,s,b,x]),S=E=>{const k=Math.floor(E/60),D=Math.floor(E%60);return`${k<10?"0":""}${k}:${D<10?"0":""}${D}`};return{time:Dc-p.time,isActive:p.isActive,formattedTime:S(Dc-p.time),startTimer:w,stopTimer:N}},tz=(t="week")=>{const[s,n]=f.useState(null),[r,a]=f.useState(!0),[i,o]=f.useState(null),{user:c}=Je();return f.useEffect(()=>{(async()=>{if(!c){a(!1);return}try{a(!0),o(null);const d=ci(new Date),h=ps(t==="week"?$c(d,7):Mc(d,1)),p=tO({start:h,end:d}),g=[],x={};if((await Promise.allSettled(p.map(async E=>{const k=Ie(E),D=ke(xe,"pomodoro",`${c.uid}_${k}`);try{const T=await ot(D);if(T.exists()){const R=T.data();return{dateStr:k,data:R}}}catch(T){console.error("PomodoroStats - Error fetching doc:",T)}return null}))).forEach(E=>{if(E.status==="fulfilled"&&E.value){const{dateStr:k,data:D}=E.value;g.push(...D.sessions);const R=D.sessions.filter(O=>O.completed).reduce((O,U)=>O+U.duration,0)/60;x[k]=R}}),g.length===0){n({totalSessions:0,totalTime:0,averageSessionTime:0,completionRate:0,...t==="week"&&{averageWeekdayHours:0}}),a(!1);return}const b=Object.entries(x).reduce((E,[k,D])=>D>E[1]?[k,D]:E,["",0]),v=g.filter(E=>E.completed),w=g.reduce((E,k)=>E+k.duration,0);let N;if(t==="week"){const E=Object.entries(x).filter(([T])=>{const R=new Date(T).getDay();return R!==0&&R!==6}),k=E.reduce((T,[,R])=>T+R,0),D=E.length;N=D>0?k/60/D:0}const S={totalSessions:g.length,totalTime:w,averageSessionTime:w/g.length,completionRate:v.length/g.length*100,...N!==void 0&&{averageWeekdayHours:N},...b[1]>0&&{bestDay:{date:nt(new Date(b[0]),"dd/MM/yyyy"),minutes:b[1]}}};n(S)}catch(d){console.error("Error fetching pomodoro stats:",d),o(d instanceof Error?d.message:"Error al cargar las estadsticas")}finally{a(!1)}})()},[c,t]),{stats:s,loading:r,error:i}},sz=(t,s)=>{const[n,r]=f.useState(null),[a,i]=f.useState(!0),[o,c]=f.useState(null),{user:u}=Je();return f.useEffect(()=>{(async()=>{if(r(null),!!u){i(!0),c(null);try{const h=[],p=new Date(t);for(;p<=s;)h.push(Ie(p)),p.setDate(p.getDate()+1);const x=(await Promise.allSettled(h.map(y=>ot(ke(xe,"pomodoro",`${u.uid}_${y}`))))).map((y,b)=>{if(y.status==="fulfilled"){const v=y.value,N=(v.exists()?v.data().sessions||[]:[]).filter(S=>S.completed).reduce((S,E)=>S+(E.duration||0),0)/60;return{date:h[b],minutes:N}}return console.error("PomodoroStatsRange - Error fetching doc:",y.reason),{date:h[b],minutes:0}});r({dailyStats:x})}catch(h){console.error("Error al cargar estadsticas:",h),c(h instanceof Error?h.message:"Error al cargar estadsticas")}finally{i(!1)}}})()},[u,t,s]),{stats:n,loading:a,error:o}},nz=({count:t,onIncrement:s,disabled:n,status:r})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex flex-col items-center min-w-[3rem]",children:[e.jsx("span",{className:"font-medium text-lg",children:t}),e.jsx("span",{className:"text-xs text-gray-500",children:"completados"})]}),e.jsx($,{variant:"outline",size:"icon",onClick:s,disabled:n,className:"h-8 w-8",children:e.jsx(cs,{className:"w-4 h-4"})}),r==="saving"&&e.jsx("span",{className:"text-xs text-blue-500 animate-pulse",children:"Guardando..."}),r==="error"&&e.jsx("span",{className:"text-xs text-red-500",children:"Error al guardar"})]}),Yx=OR,Zm=f.forwardRef(({className:t,...s},n)=>e.jsx(_R,{ref:n,className:ce("border-b",t),...s}));Zm.displayName="AccordionItem";const Qm=f.forwardRef(({className:t,children:s,...n},r)=>e.jsx(RR,{className:"flex",children:e.jsxs(Pj,{ref:r,className:ce("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",t),...n,children:[s,e.jsx(Gn,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})}));Qm.displayName=Pj.displayName;const eh=f.forwardRef(({className:t,children:s,...n},r)=>e.jsx(Mj,{ref:r,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...n,children:e.jsx("div",{className:ce("pb-4 pt-0",t),children:s})}));eh.displayName=Mj.displayName;const eb=t=>new Date(t).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit",hour12:!1}),rz=({sessions:t,onDeleteSession:s,onEditSession:n})=>{const[r,a]=f.useState(!1),i=[...t].sort((o,c)=>c.startTime.timestamp-o.startTime.timestamp);return e.jsx(Yx,{type:"single",collapsible:!0,onValueChange:o=>a(!!o),value:r?"history":"",children:e.jsxs(Zm,{value:"history",className:"border-none",children:[e.jsx(Qm,{className:"w-full h-11 flex items-center justify-center gap-2 border rounded-lg bg-background hover:bg-accent data-[state=open]:rounded-b-none",children:e.jsx("span",{className:"text-sm font-semibold",children:"Historial de hoy"})}),e.jsx(eh,{className:"mt-2 space-y-2",children:i.length===0?e.jsx("div",{className:"text-center text-gray-500 text-sm py-2",children:"No hay sesiones registradas hoy"}):i.map((o,c)=>e.jsxs("div",{className:"flex flex-col p-2.5 bg-muted rounded-lg text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[o.completed?e.jsx(aa,{className:"w-4 h-4 text-green-500 flex-shrink-0"}):e.jsx(wO,{className:"w-4 h-4 text-red-500 flex-shrink-0"}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-xs text-gray-400 w-4",children:c+1}),e.jsx("span",{children:eb(o.startTime.timestamp)}),e.jsx("span",{className:"text-gray-400",children:""}),e.jsx("span",{children:eb(o.endTime.timestamp)})]})}),e.jsxs("span",{className:"text-gray-500 whitespace-nowrap",children:[Math.floor(o.duration/60),"min"]}),e.jsxs("div",{className:"flex gap-1 ml-2",children:[n&&e.jsx($,{variant:"ghost",size:"icon",className:"h-auto w-auto p-1",onClick:()=>n(o),children:e.jsx(jr,{className:"w-4 h-4 text-muted-foreground"})}),s&&e.jsx($,{variant:"ghost",size:"icon",className:"h-auto w-auto p-1",onClick:()=>s(o),children:e.jsx(oo,{className:"w-4 h-4 text-destructive"})})]})]}),o.description&&e.jsx("div",{className:"ml-6 mt-1 text-xs text-gray-500",children:o.description})]},o.startTime.timestamp))})]})})},az=({time:t,isActive:s,onStart:n,onStop:r,disabled:a})=>{const[i,o]=f.useState(!1),c=async d=>{if(d.preventDefault(),!i)try{o(!0),await r()}finally{o(!1)}},u=async d=>{if(d.preventDefault(),!i)try{o(!0),await n()}finally{o(!1)}};return e.jsxs("div",{className:"flex flex-col items-center gap-6",children:[e.jsx("div",{className:"text-6xl font-mono tracking-wider",children:t}),e.jsx("div",{className:"flex gap-4",children:s?e.jsxs($,{size:"lg",onClick:c,disabled:a||i,variant:"destructive",className:"w-40 text-lg",children:[i?e.jsx(fs,{className:"w-5 h-5 mr-2 animate-spin"}):e.jsx(lx,{className:"w-5 h-5 mr-2"}),i?"Deteniendo...":"Detener"]}):e.jsxs($,{size:"lg",onClick:u,disabled:a||i,className:"w-40 text-lg",children:[i?e.jsx(fs,{className:"w-5 h-5 mr-2 animate-spin"}):e.jsx(Sn,{className:"w-5 h-5 mr-2"}),i?"Iniciando...":"Iniciar"]})}),e.jsx("div",{className:"text-sm text-gray-500",children:s?e.jsx(e.Fragment,{children:i?e.jsx("span",{children:"Procesando cambio de estado..."}):e.jsx("span",{children:"Concentracin en progreso..."})}):e.jsx("span",{children:"30 minutos de concentracin"})})]})},iz=({progress:t,currentTime:s,totalTime:n,isActive:r})=>{const a=Math.min(Math.max(t,0),100);return e.jsxs("div",{className:"space-y-2",children:[e.jsx(lr,{value:a,className:`h-2 transition-all duration-300 ${r?"bg-gray-100":"bg-gray-50"}`}),e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:s}),e.jsx("span",{className:"text-gray-500",children:" restantes"})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("span",{children:"Total: "}),e.jsx("span",{className:"font-medium",children:n})]})]}),e.jsx("div",{className:"text-center text-sm text-gray-500",children:a>0&&e.jsxs("span",{children:[Math.round(a),"% completado"]})})]})};var th="Checkbox",[oz,pY]=za(th),[lz,Vx]=oz(th);function cz(t){const{__scopeCheckbox:s,checked:n,children:r,defaultChecked:a,disabled:i,form:o,name:c,onCheckedChange:u,required:d,value:h="on",internal_do_not_use_render:p}=t,[g,x]=Oa({prop:n,defaultProp:a??!1,onChange:u,caller:th}),[y,b]=f.useState(null),[v,w]=f.useState(null),N=f.useRef(!1),S=y?!!o||!!y.closest("form"):!0,E={checked:g,disabled:i,setChecked:x,control:y,setControl:b,name:c,form:o,value:h,hasConsumerStoppedPropagationRef:N,required:d,defaultChecked:no(a)?!1:a,isFormControl:S,bubbleInput:v,setBubbleInput:w};return e.jsx(lz,{scope:s,...E,children:dz(p)?p(E):r})}var XS="CheckboxTrigger",ZS=f.forwardRef(({__scopeCheckbox:t,onKeyDown:s,onClick:n,...r},a)=>{const{control:i,value:o,disabled:c,checked:u,required:d,setControl:h,setChecked:p,hasConsumerStoppedPropagationRef:g,isFormControl:x,bubbleInput:y}=Vx(XS,t),b=bs(a,h),v=f.useRef(u);return f.useEffect(()=>{const w=i==null?void 0:i.form;if(w){const N=()=>p(v.current);return w.addEventListener("reset",N),()=>w.removeEventListener("reset",N)}},[i,p]),e.jsx(jt.button,{type:"button",role:"checkbox","aria-checked":no(u)?"mixed":u,"aria-required":d,"data-state":nC(u),"data-disabled":c?"":void 0,disabled:c,value:o,...r,ref:b,onKeyDown:it(s,w=>{w.key==="Enter"&&w.preventDefault()}),onClick:it(n,w=>{p(N=>no(N)?!0:!N),y&&x&&(g.current=w.isPropagationStopped(),g.current||w.stopPropagation())})})});ZS.displayName=XS;var Gx=f.forwardRef((t,s)=>{const{__scopeCheckbox:n,name:r,checked:a,defaultChecked:i,required:o,disabled:c,value:u,onCheckedChange:d,form:h,...p}=t;return e.jsx(cz,{__scopeCheckbox:n,checked:a,defaultChecked:i,disabled:c,required:o,onCheckedChange:d,name:r,form:h,value:u,internal_do_not_use_render:({isFormControl:g})=>e.jsxs(e.Fragment,{children:[e.jsx(ZS,{...p,ref:s,__scopeCheckbox:n}),g&&e.jsx(sC,{__scopeCheckbox:n})]})})});Gx.displayName=th;var QS="CheckboxIndicator",eC=f.forwardRef((t,s)=>{const{__scopeCheckbox:n,forceMount:r,...a}=t,i=Vx(QS,n);return e.jsx(gi,{present:r||no(i.checked)||i.checked===!0,children:e.jsx(jt.span,{"data-state":nC(i.checked),"data-disabled":i.disabled?"":void 0,...a,ref:s,style:{pointerEvents:"none",...t.style}})})});eC.displayName=QS;var tC="CheckboxBubbleInput",sC=f.forwardRef(({__scopeCheckbox:t,...s},n)=>{const{control:r,hasConsumerStoppedPropagationRef:a,checked:i,defaultChecked:o,required:c,disabled:u,name:d,value:h,form:p,bubbleInput:g,setBubbleInput:x}=Vx(tC,t),y=bs(n,x),b=kx(i),v=Ij(r);f.useEffect(()=>{const N=g;if(!N)return;const S=window.HTMLInputElement.prototype,k=Object.getOwnPropertyDescriptor(S,"checked").set,D=!a.current;if(b!==i&&k){const T=new Event("click",{bubbles:D});N.indeterminate=no(i),k.call(N,no(i)?!1:i),N.dispatchEvent(T)}},[g,b,i,a]);const w=f.useRef(no(i)?!1:i);return e.jsx(jt.input,{type:"checkbox","aria-hidden":!0,defaultChecked:o??w.current,required:c,disabled:u,name:d,value:h,form:p,...s,tabIndex:-1,ref:y,style:{...s.style,...v,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});sC.displayName=tC;function dz(t){return typeof t=="function"}function no(t){return t==="indeterminate"}function nC(t){return no(t)?"indeterminate":t?"checked":"unchecked"}const Rs=f.forwardRef(({className:t,...s},n)=>e.jsx(Gx,{ref:n,className:ce("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...s,children:e.jsx(eC,{className:ce("flex items-center justify-center text-current"),children:e.jsx(Fa,{className:"h-4 w-4"})})}));Rs.displayName=Gx.displayName;const uz=({session:t,onClose:s,onSave:n})=>{const[r,a]=f.useState(""),[i,o]=f.useState(""),[c,u]=f.useState(!1),[d,h]=f.useState("");if(f.useEffect(()=>{if(t){const g=new Date(t.startTime.timestamp),x=new Date(t.endTime.timestamp);a(`${String(g.getHours()).padStart(2,"0")}:${String(g.getMinutes()).padStart(2,"0")}`),o(`${String(x.getHours()).padStart(2,"0")}:${String(x.getMinutes()).padStart(2,"0")}`),u(t.completed),h(t.description||"")}},[t]),!t)return null;const p=()=>{const g=new Date(t.startTime.timestamp),[x,y]=r.split(":").map(Number),[b,v]=i.split(":").map(Number),w=new Date(g);w.setHours(x,y,0,0);const N=new Date(g);N.setHours(b,v,0,0),N<w&&N.setDate(N.getDate()+1);const S={startTime:{timestamp:w.getTime(),utcOffset:-w.getTimezoneOffset(),formatted:new Date(w).toLocaleString("es-ES",{day:"numeric",month:"long",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!0})+` UTC${-w.getTimezoneOffset()>=0?"+":"-"}${Math.abs(Math.floor(-w.getTimezoneOffset()/60))}`},endTime:{timestamp:N.getTime(),utcOffset:-N.getTimezoneOffset(),formatted:new Date(N).toLocaleString("es-ES",{day:"numeric",month:"long",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!0})+` UTC${-N.getTimezoneOffset()>=0?"+":"-"}${Math.abs(Math.floor(-N.getTimezoneOffset()/60))}`},duration:(N.getTime()-w.getTime())/1e3,completed:c,description:d.trim()||void 0};n(t,S),s()};return e.jsx(kt,{open:!!t,onOpenChange:g=>{g||s()},children:e.jsxs(wt,{className:"sm:max-w-md",children:[e.jsx(At,{children:e.jsx(_t,{children:"Editar Sesin Pomodoro"})}),e.jsxs("div",{className:"py-4 space-y-4",children:[" ",e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[" ",e.jsx(ze,{htmlFor:"startTime",children:"Hora inicio"}),e.jsx(Fe,{id:"startTime",type:"time",value:r,onChange:g=>a(g.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ze,{htmlFor:"endTime",children:"Hora fin"}),e.jsx(Fe,{id:"endTime",type:"time",value:i,onChange:g=>o(g.target.value)})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ze,{htmlFor:"description",children:"Descripcin (opcional)"}),e.jsx(Fe,{id:"description",type:"text",value:d,onChange:g=>h(g.target.value),placeholder:"Qu hiciste en esta sesin?"})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-2",children:[" ",e.jsx(Rs,{id:"completed",checked:c,onCheckedChange:g=>u(!!g)}),e.jsx(ze,{htmlFor:"completed",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Sesin completada"})]})]}),e.jsxs(Cn,{children:[e.jsx($,{variant:"outline",onClick:s,children:"Cancelar"}),e.jsx($,{onClick:p,children:"Guardar cambios"})]})]})})},Ou=t=>{const s=Math.floor(t/60),n=t%60;return s>0?`${s}h ${n}min`:`${n}min`},mz=t=>t===100?{icon:iw,message:"Meta diaria alcanzada! ",description:"Has completado tu objetivo del da Excelente trabajo!",color:"text-green-600"}:t>=75?{icon:Ll,message:"Casi ah! ",description:"Ests muy cerca de alcanzar tu meta diaria",color:"text-blue-600"}:t>=50?{icon:en,message:"Buen progreso! ",description:"Mantn el ritmo, vas por buen camino",color:"text-indigo-600"}:t>=25?{icon:en,message:"Sigue adelante! ",description:"Has comenzado bien, mantn el enfoque",color:"text-blue-600"}:{icon:en,message:"Comencemos! ",description:"Es un buen momento para enfocarse en tus objetivos",color:"text-gray-600"},hz=t=>t>=100?{background:"bg-green-500",text:"text-green-700",icon:"bg-green-100"}:t>=75?{background:"bg-blue-500",text:"text-blue-700",icon:"bg-blue-100"}:t>=50?{background:"bg-indigo-500",text:"text-indigo-700",icon:"bg-indigo-100"}:t>=25?{background:"bg-blue-500",text:"text-blue-700",icon:"bg-blue-100"}:{background:"bg-gray-500",text:"text-gray-700",icon:"bg-gray-100"},fz=({sessions:t,dailyGoal:s=300})=>{const n=t.filter(p=>p.completed).reduce((p,g)=>p+g.duration,0),r=Math.floor(n/60),a=Math.min(Math.round(r/s*100),100),i=Math.max(s-r,0),{icon:o,message:c,description:u,color:d}=mz(a),h=hz(a);return e.jsx(Ce,{className:"p-6 bg-gradient-to-br from-white to-gray-50",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-full ${h.icon} mt-1`,children:e.jsx(o,{className:`w-5 h-5 ${d}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:`font-semibold text-lg ${d}`,children:c}),e.jsx("p",{className:"text-sm text-gray-600",children:u})]})]}),e.jsxs("div",{className:"text-sm text-gray-600 flex justify-between items-center",children:[e.jsxs("span",{children:["Meta diaria: ",Ou(s)]}),e.jsxs("span",{className:`font-medium ${d}`,children:[a,"% completado"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(lr,{value:a,className:"h-3"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Tiempo efectivo"}),e.jsx("p",{className:`text-lg font-semibold ${h.text}`,children:Ou(r)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Tiempo restante"}),e.jsx("p",{className:"text-lg font-semibold text-gray-700",children:Ou(i)})]})]})]}),e.jsx("div",{className:"text-center",children:a<100?e.jsxs("p",{className:"text-sm text-gray-600",children:["Te faltan ",e.jsx("span",{className:"font-medium",children:Ou(i)})," para alcanzar tu meta diaria"]}):e.jsx("p",{className:"text-sm font-medium text-green-600",children:"Felicitaciones! Has superado tu meta diaria de productividad "})})]})})},tb=t=>{const s=Math.floor(t/60),n=t%60;return`${s<10?"0":""}${s}:${n<10?"0":""}${n}`},Fc=t=>{if(t<60)return`${t} min`;const s=Math.floor(t/60),n=t%60;return`${s}h ${n}min`};var rC="AlertDialog",[pz,xY]=za(rC,[Lj]),vi=Lj(),aC=t=>{const{__scopeAlertDialog:s,...n}=t,r=vi(s);return e.jsx(km,{...r,...n,modal:!0})};aC.displayName=rC;var xz="AlertDialogTrigger",iC=f.forwardRef((t,s)=>{const{__scopeAlertDialog:n,...r}=t,a=vi(n);return e.jsx(Am,{...a,...r,ref:s})});iC.displayName=xz;var gz="AlertDialogPortal",oC=t=>{const{__scopeAlertDialog:s,...n}=t,r=vi(s);return e.jsx(Dm,{...r,...n})};oC.displayName=gz;var vz="AlertDialogOverlay",lC=f.forwardRef((t,s)=>{const{__scopeAlertDialog:n,...r}=t,a=vi(n);return e.jsx(Rl,{...a,...r,ref:s})});lC.displayName=vz;var pl="AlertDialogContent",[yz,bz]=pz(pl),jz=Cj("AlertDialogContent"),cC=f.forwardRef((t,s)=>{const{__scopeAlertDialog:n,children:r,...a}=t,i=vi(n),o=f.useRef(null),c=bs(s,o),u=f.useRef(null);return e.jsx(PR,{contentName:pl,titleName:dC,docsSlug:"alert-dialog",children:e.jsx(yz,{scope:n,cancelRef:u,children:e.jsxs(Ol,{role:"alertdialog",...i,...a,ref:c,onOpenAutoFocus:it(a.onOpenAutoFocus,d=>{var h;d.preventDefault(),(h=u.current)==null||h.focus({preventScroll:!0})}),onPointerDownOutside:d=>d.preventDefault(),onInteractOutside:d=>d.preventDefault(),children:[e.jsx(jz,{children:r}),e.jsx(Nz,{contentRef:o})]})})})});cC.displayName=pl;var dC="AlertDialogTitle",uC=f.forwardRef((t,s)=>{const{__scopeAlertDialog:n,...r}=t,a=vi(n);return e.jsx(Pl,{...a,...r,ref:s})});uC.displayName=dC;var mC="AlertDialogDescription",hC=f.forwardRef((t,s)=>{const{__scopeAlertDialog:n,...r}=t,a=vi(n);return e.jsx(Ml,{...a,...r,ref:s})});hC.displayName=mC;var wz="AlertDialogAction",fC=f.forwardRef((t,s)=>{const{__scopeAlertDialog:n,...r}=t,a=vi(n);return e.jsx(ud,{...a,...r,ref:s})});fC.displayName=wz;var pC="AlertDialogCancel",xC=f.forwardRef((t,s)=>{const{__scopeAlertDialog:n,...r}=t,{cancelRef:a}=bz(pC,n),i=vi(n),o=bs(s,a);return e.jsx(ud,{...i,...r,ref:o})});xC.displayName=pC;var Nz=({contentRef:t})=>{const s=`\`${pl}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${pl}\` by passing a \`${mC}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${pl}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return f.useEffect(()=>{var r;document.getElementById((r=t.current)==null?void 0:r.getAttribute("aria-describedby"))||console.warn(s)},[s,t]),null},Sz=aC,Cz=iC,Ez=oC,gC=lC,vC=cC,yC=fC,bC=xC,jC=uC,wC=hC;const Wa=Sz,yi=Cz,Tz=Ez,NC=f.forwardRef(({className:t,...s},n)=>e.jsx(gC,{className:ce("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s,ref:n}));NC.displayName=gC.displayName;const fa=f.forwardRef(({className:t,...s},n)=>e.jsxs(Tz,{children:[e.jsx(NC,{}),e.jsx(vC,{ref:n,className:ce("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...s})]}));fa.displayName=vC.displayName;const pa=({className:t,...s})=>e.jsx("div",{className:ce("flex flex-col space-y-2 text-center sm:text-left",t),...s});pa.displayName="AlertDialogHeader";const xa=({className:t,...s})=>e.jsx("div",{className:ce("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s});xa.displayName="AlertDialogFooter";const ga=f.forwardRef(({className:t,...s},n)=>e.jsx(jC,{ref:n,className:ce("text-lg font-semibold",t),...s}));ga.displayName=jC.displayName;const va=f.forwardRef(({className:t,...s},n)=>e.jsx(wC,{ref:n,className:ce("text-sm text-muted-foreground",t),...s}));va.displayName=wC.displayName;const ya=f.forwardRef(({className:t,...s},n)=>e.jsx(yC,{ref:n,className:ce(td(),t),...s}));ya.displayName=yC.displayName;const ba=f.forwardRef(({className:t,...s},n)=>e.jsx(bC,{ref:n,className:ce(td({variant:"outline"}),"mt-2 sm:mt-0",t),...s}));ba.displayName=bC.displayName;const zf=30*60,Dz=({selectedDate:t})=>{const{user:s}=Je(),n=300,[r,a]=f.useState(!1),[i,o]=f.useState(null),{supported:c,permission:u,preferences:d,requestPermission:h,sendNotification:p,updatePreferences:g,startPersistentNotification:x,stopPersistentNotification:y}=vx(),{count:b,sessions:v,status:w,error:N,saveSession:S,deleteSession:E,editSession:k,addManualSession:D,resync:T}=qw(t),{isOnline:R}=ua(),O=f.useCallback(async H=>{await S(H,!0),d.enabled&&u==="granted"&&p("Pomodoro completado! ",{body:"Has completado exitosamente tu sesin de concentracin",requireInteraction:!0})},[S,d,u,p]),U=f.useCallback(async H=>{await S(H,!1,{description:"Sesin interrumpida manualmente"})},[S]),{time:I,isActive:_,formattedTime:M,startTimer:W,stopTimer:B}=ez({onComplete:O,onCancel:U,selectedDate:t}),P=(zf-I)/zf*100,z=async()=>{c&&(d.enabled?g({enabled:!1}):u==="default"?a(!0):u==="granted"&&g({enabled:!0}))},G=async()=>{await h()&&g({enabled:!0}),a(!1)},ae=async()=>{w==="saving"||!R||await D()},Y=H=>{o(H)},X=async(H,ie)=>{await k(H,ie),o(null)},se=f.useRef(I);return f.useEffect(()=>{se.current=I},[I]),f.useEffect(()=>{!c||!d.enabled||u!=="granted"||(_?x("Pomodoro en progreso",()=>`Tiempo restante: ${tb(Math.ceil(se.current))}`):y())},[_,c,d.enabled,u,x,y]),f.useEffect(()=>()=>{y()},[y]),s?e.jsxs("div",{className:"space-y-6",children:[e.jsx(fz,{sessions:v,dailyGoal:n}),e.jsx(Ce,{className:"w-full",children:e.jsxs(Ae,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(en,{className:"w-5 h-5"}),e.jsx("h2",{className:"text-lg font-medium",children:"Pomodoro Timer"})]}),c&&e.jsx($,{variant:"outline",size:"sm",onClick:z,className:"flex items-center gap-2","aria-label":d.enabled?"Desactivar notificaciones":"Activar notificaciones",children:d.enabled?e.jsxs(e.Fragment,{children:[e.jsx(ip,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Wu,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline"})]})})]}),e.jsx(nz,{count:b,onIncrement:ae,disabled:w==="saving"||!R,status:w})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(az,{time:M,isActive:_,onStart:W,onStop:B,disabled:w==="saving"||!R}),e.jsx(iz,{progress:P,currentTime:M,totalTime:tb(zf),isActive:_})]}),e.jsx("div",{className:"mt-6",children:e.jsx(rz,{sessions:v,onEditSession:Y,onDeleteSession:E})})]})}),i&&e.jsx(uz,{session:i,onClose:()=>o(null),onSave:X}),e.jsx(Wa,{open:r,onOpenChange:a,children:e.jsxs(fa,{children:[e.jsxs(pa,{children:[e.jsx(ga,{children:"Activar notificaciones"}),e.jsx(va,{children:"Te gustara recibir notificaciones cuando se complete un Pomodoro? Esto te ayudar a mantenerte informado incluso cuando el navegador est en segundo plano."})]}),e.jsxs(xa,{children:[e.jsx(ba,{children:"No, gracias"}),e.jsx(ya,{onClick:G,children:"Activar notificaciones"})]})]})}),N&&e.jsx("p",{className:"mt-2 text-sm text-red-500",children:N}),e.jsxs("div",{className:"flex justify-center items-center gap-2 text-xs p-2",children:[w==="saving"&&e.jsx("span",{className:"text-blue-500",children:"Guardando..."}),w==="pending"&&e.jsx("span",{className:"text-yellow-600",children:"Pendiente de sincronizar"}),w==="saved"&&e.jsx("span",{className:"text-green-600",children:"Sincronizado"}),w==="error"&&e.jsx("span",{className:"text-red-600",children:"Error de sincronizacin"}),!R&&e.jsx("span",{className:"text-orange-600",children:"Offline"}),e.jsx($,{onClick:T,variant:"link",className:"p-0 h-auto",children:"Reintentar"})]})]}):e.jsxs(Ce,{className:"w-full",children:[e.jsx(Ae,{className:"p-4 text-center",children:e.jsx("p",{children:"Inicia sesin para usar el temporizador Pomodoro"})}),e.jsxs(In,{className:"justify-center gap-2 text-xs p-2",children:[w==="saving"&&e.jsx("span",{className:"text-blue-500",children:"Guardando..."}),w==="pending"&&e.jsx("span",{className:"text-yellow-600",children:"Pendiente de sincronizar"}),w==="saved"&&e.jsx("span",{className:"text-green-600",children:"Sincronizado"}),w==="error"&&e.jsx("span",{className:"text-red-600",children:"Error de sincronizacin"}),!R&&e.jsx("span",{className:"text-orange-600",children:"Offline"}),e.jsx($,{onClick:T,variant:"link",className:"p-0 h-auto",children:"Reintentar"})]})]})},sb=({dateRange:t})=>{var i;const{user:s}=Je(),{stats:n,loading:r,error:a}=tz(t);return s?r?e.jsxs(Ce,{children:[e.jsx(Kt,{children:e.jsxs(Gt,{children:["Estadsticas (",t==="week"?"Semana":"Mes",")"]})}),e.jsx(Ae,{children:e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsx("p",{className:"text-gray-500",children:"Cargando estadsticas..."})})})]}):a?e.jsxs(Ce,{children:[e.jsx(Kt,{children:e.jsxs(Gt,{children:["Estadsticas (",t==="week"?"Semana":"Mes",")"]})}),e.jsx(Ae,{children:e.jsx("div",{className:"text-red-500",children:"Error al cargar las estadsticas. Por favor, intenta de nuevo."})})]}):n?e.jsxs(Ce,{children:[e.jsx(Kt,{children:e.jsxs(Gt,{children:["Estadsticas ",t==="week"?"de la Semana":"del Mes"]})}),e.jsx(Ae,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2 text-center text-sm",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Sesiones"}),e.jsx("p",{className:"text-lg font-semibold",children:n.totalSessions})]}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Tiempo Total"}),e.jsx("p",{className:"text-lg font-semibold",children:Fc(Math.floor(n.totalTime/60))})]}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Promedio/Sesin"}),e.jsx("p",{className:"text-lg font-semibold",children:Fc(Math.floor(n.averageSessionTime/60))})]}),t==="week"?e.jsxs("div",{className:"space-y-0.5 col-span-2",children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Promedio diario"}),e.jsxs("p",{className:"text-lg font-semibold",children:[(i=n.averageWeekdayHours)==null?void 0:i.toFixed(1),"h/da"]})]}):e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Completitud"}),e.jsxs("p",{className:"text-lg font-semibold",children:[n.completionRate.toFixed(1),"%"]})]}),n.bestDay&&e.jsxs("div",{className:"space-y-0.5 col-span-2",children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Mejor Da"}),e.jsx("p",{className:"text-lg font-semibold",children:Fc(Math.floor(n.bestDay.minutes))}),e.jsx("p",{className:"text-xs text-gray-400",children:n.bestDay.date})]})]})})]}):e.jsxs(Ce,{children:[e.jsx(Kt,{children:e.jsxs(Gt,{children:["Estadsticas (",t==="week"?"Semana":"Mes",")"]})}),e.jsx(Ae,{children:e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-gray-500",children:"No hay datos disponibles"})})})]}):null},kz=({selectedDate:t,goal:s=300})=>{const[n,r]=f.useState(ls(t));f.useEffect(()=>{r(ls(t))},[t]);const a=f.useMemo(()=>ls(n),[n]),i=f.useMemo(()=>vr(n),[n]),{stats:o,loading:c}=sz(a,i),u=f.useMemo(()=>{const h={};return o==null||o.dailyStats.forEach(({date:p,minutes:g})=>{h[p]=g}),h},[o]),d=h=>{const p=Ie(h.date),g=u[p]||0,x=Math.min(g/s,1),y=28,b=3,v=(y-b)/2,w=2*Math.PI*v,N=w-x*w,S=g>=s;return e.jsxs("div",{className:"relative flex items-center justify-center w-7 h-7",children:[e.jsxs("svg",{width:y,height:y,className:"absolute",children:[e.jsx("circle",{cx:y/2,cy:y/2,r:v,stroke:S?"#fecaca":"#e5e7eb",strokeWidth:b,fill:"none"}),e.jsx("circle",{cx:y/2,cy:y/2,r:v,stroke:S?"#f87171":"#9ca3af",strokeWidth:b,fill:"none",strokeDasharray:w,strokeDashoffset:N,strokeLinecap:"round",style:{transform:"rotate(-90deg)",transformOrigin:"50% 50%"}})]}),e.jsx("span",{className:"text-[10px] font-medium z-10",children:h.date.getDate()})]})};return e.jsxs(Ce,{className:"w-full",children:[e.jsxs(Kt,{className:"flex flex-col items-center gap-2",children:[e.jsx(zo,{className:"w-5 h-5 text-red-600"}),e.jsx(Gt,{className:"text-center",children:"Historial Mensual"})]}),e.jsxs(Ae,{className:"relative p-4",children:[c&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/50 z-10",children:e.jsx(fs,{className:"w-6 h-6 animate-spin"})}),e.jsx(Sd,{month:n,onMonthChange:r,showOutsideDays:!0,components:{DayContent:d},className:"p-0 w-full"})]})]})};function Az(){const[t,s]=f.useState(new Date),{user:n}=Je();return n?e.jsxs(ln,{children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Pomodoro Timer"}),e.jsx("p",{className:"text-gray-500",children:"Gestiona tus sesiones de trabajo y productividad"})]}),e.jsx(La,{selectedDate:t,onChange:s}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-[1fr_300px]",children:[e.jsx("div",{className:"space-y-6",children:e.jsx(Dz,{selectedDate:t})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(kz,{selectedDate:t}),e.jsx(sb,{dateRange:"week"}),e.jsx(sb,{dateRange:"month"})]})]})]}):e.jsx(ln,{children:e.jsx("div",{className:"text-center py-8",children:e.jsx("h2",{className:"text-xl font-semibold",children:"Inicia sesin para ver tus estadsticas"})})})}const _z=({onSelect:t,disabled:s})=>e.jsx("div",{className:"grid grid-cols-3 gap-2 mb-4",children:Po.map(n=>e.jsx("div",{className:"relative",children:e.jsxs($,{variant:"outline",onClick:()=>t(n),className:"h-12 text-lg w-full relative",disabled:s,children:[e.jsx("span",{children:n.emoji}),e.jsx("span",{className:"w-full text-center text-xs text-gray-500 mt-1",children:n.text})]})},n.emoji))}),Rz=({isOpen:t,onClose:s,moodEntry:n,onSave:r,onDelete:a})=>{const[i,o]=f.useState(""),[c,u]=f.useState(!1);f.useEffect(()=>{n!=null&&n.time&&o(n.time)},[n]);const d=async()=>{if(n){u(!0);try{const[p,g]=i.split(":").map(Number),x=new Date(n.timestamp),y=jn(x,p,g);await r({...n,time:i,timestamp:y.timestamp}),s()}catch(p){console.error("Error al guardar:",p)}finally{u(!1)}}},h=async()=>{if(a){u(!0);try{await a(),s()}catch(p){console.error("Error al eliminar:",p)}finally{u(!1)}}};return e.jsx(kt,{open:t,onOpenChange:s,children:e.jsxs(wt,{className:"sm:max-w-md",children:[e.jsx(At,{children:e.jsx(_t,{children:"Editar registro"})}),e.jsxs("div",{className:"flex items-center gap-4 py-4",children:[e.jsx("span",{className:"text-2xl",children:n==null?void 0:n.emoji}),e.jsx("span",{children:n==null?void 0:n.text})]}),e.jsx("div",{className:"grid gap-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{htmlFor:"time",className:"text-sm",children:"Hora:"}),e.jsx(Fe,{id:"time",type:"time",value:i,onChange:p=>o(p.target.value)})]})}),e.jsxs(Cn,{className:"gap-2 sm:gap-0",children:[a&&e.jsx($,{variant:"destructive",onClick:h,disabled:c,className:"w-full sm:w-auto",children:"Eliminar"}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsx($,{variant:"outline",onClick:s,disabled:c,className:"flex-1 sm:flex-none",children:"Cancelar"}),e.jsx($,{onClick:d,disabled:c,className:"flex-1 sm:flex-none",children:"Guardar"})]})]})]})})},Oz=({moods:t,onUpdateMood:s,onDeleteMood:n})=>{const[r,a]=f.useState(!1),[i,o]=f.useState(null),c=[...t].sort((x,y)=>x.timestamp-y.timestamp),u=r?c:c.slice(0,3),d=t.length>3,h=x=>{o(x)},p=async x=>{i&&await s(i.timestamp,x)},g=async()=>{i&&await n(i.timestamp)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-4 space-y-2",children:[u.map((x,y)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-muted rounded hover:bg-accent transition-colors",children:[e.jsx("span",{className:"text-xl",children:x.emoji}),e.jsx("span",{children:x.text}),e.jsx("span",{className:"text-gray-500 ml-auto",children:x.time}),e.jsx($,{variant:"ghost",size:"sm",className:"ml-2 h-8 w-8 p-0",onClick:()=>h(x),children:e.jsx(Mm,{className:"h-4 w-4"})})]},`${x.timestamp}_${y}`)),d&&e.jsx($,{variant:"ghost",className:"w-full h-8 text-sm text-gray-500 hover:text-gray-900",onClick:()=>a(!r),children:r?e.jsxs("span",{className:"flex items-center gap-1",children:["Ver menos ",e.jsx(Fo,{className:"h-4 w-4"})]}):e.jsxs("span",{className:"flex items-center gap-1",children:["Ver ms (",t.length-3,") ",e.jsx(Gn,{className:"h-4 w-4"})]})}),t.length===0&&e.jsx("div",{className:"text-center text-gray-500 py-4",children:"No hay registros para este da"})]}),e.jsx(Rz,{isOpen:i!==null,onClose:()=>o(null),moodEntry:i,onSave:p,onDelete:g})]})},Pz=["bg-red-500 text-white","bg-orange-500 text-white","bg-yellow-400 text-black","bg-lime-500 text-black","bg-green-600 text-white"],Mz=[aw,rw,lp,op,nw],SC=({onSelect:t,disabled:s})=>{const[n,r]=f.useState(""),a=i=>{t(i,n||void 0),r("")};return e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"text",placeholder:"Comentario opcional",value:n,onChange:i=>r(i.target.value),className:"w-full border rounded p-2 text-sm"}),e.jsx("div",{className:"grid grid-cols-5 gap-2 mb-2",children:[1,2,3,4,5].map(i=>{const o=Mz[i-1];return e.jsx($,{variant:"default",className:`h-12 w-full ${Pz[i-1]} flex items-center justify-center`,onClick:()=>a(i),disabled:s,children:e.jsx(o,{className:"h-5 w-5"})},i)})})]})},Iz=({isOpen:t,onClose:s,energyEntry:n,onSave:r,onDelete:a})=>{const[i,o]=f.useState(""),[c,u]=f.useState(3),[d,h]=f.useState(""),[p,g]=f.useState(!1);f.useEffect(()=>{n&&(o(n.time),u(n.level),h(n.comment||""))},[n]);const x=async()=>{if(n){g(!0);try{const[b,v]=i.split(":").map(Number),w=new Date(n.timestamp),N=jn(w,b,v);await r({level:c,comment:d||void 0,time:i,timestamp:N.timestamp}),s()}finally{g(!1)}}},y=async()=>{if(!(!a||!n)){g(!0);try{await a(),s()}finally{g(!1)}}};return e.jsx(kt,{open:t,onOpenChange:s,children:e.jsxs(wt,{className:"sm:max-w-md",children:[e.jsx(At,{children:e.jsx(_t,{children:"Editar registro"})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{htmlFor:"time",className:"text-sm",children:"Hora:"}),e.jsx(Fe,{id:"time",type:"time",value:i,onChange:b=>o(b.target.value)})]}),e.jsx(Fe,{type:"text",placeholder:"Comentario opcional",value:d,onChange:b=>h(b.target.value)}),e.jsx(SC,{onSelect:b=>u(b),disabled:!1})]}),e.jsxs(Cn,{className:"gap-2 sm:gap-0",children:[a&&e.jsx($,{variant:"destructive",onClick:y,disabled:p,className:"w-full sm:w-auto",children:"Eliminar"}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsx($,{variant:"outline",onClick:s,disabled:p,className:"flex-1 sm:flex-none",children:"Cancelar"}),e.jsx($,{onClick:x,disabled:p,className:"flex-1 sm:flex-none",children:"Guardar"})]})]})]})})},Lz=["bg-red-500","bg-orange-500","bg-yellow-400","bg-lime-500","bg-green-600"],$z=({entries:t,onUpdate:s,onDelete:n})=>{const[r,a]=f.useState(!1),[i,o]=f.useState(null),c=[...t].sort((p,g)=>p.timestamp-g.timestamp),u=t.length>0?Math.round(t.reduce((p,g)=>p+g.level,0)/t.length*10)/10:0,d=async p=>{i&&(await s(i.timestamp,p),o(null))},h=async()=>{i&&(await n(i.timestamp),o(null))};return e.jsxs(e.Fragment,{children:[e.jsx(Yx,{type:"single",collapsible:!0,value:r?"history":"",onValueChange:p=>a(!!p),children:e.jsxs(Zm,{value:"history",className:"border-none",children:[e.jsx(Qm,{className:"w-full h-11 flex items-center justify-between gap-2 border rounded-lg bg-background hover:bg-accent data-[state=open]:rounded-b-none",children:e.jsx("span",{className:"text-sm font-semibold",children:"Historial de hoy"})}),e.jsxs(eh,{className:"mt-2 space-y-2",children:[c.length===0?e.jsx("div",{className:"text-center text-gray-500 text-sm py-2",children:"No hay registros para este da"}):c.map((p,g)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-muted rounded",children:[e.jsx("span",{className:`w-3 h-3 rounded-full ${Lz[p.level-1]}`}),e.jsxs("span",{className:"text-sm",children:["Nivel ",p.level]}),p.comment&&e.jsx("span",{className:"text-sm flex-1",children:p.comment}),e.jsx("span",{className:"text-gray-500 ml-auto text-sm",children:p.time}),e.jsx($,{variant:"ghost",size:"sm",className:"ml-2 h-8 w-8 p-0",onClick:()=>o(p),children:e.jsx(Mm,{className:"h-4 w-4"})})]},`${p.timestamp}_${g}`)),c.length>0&&e.jsxs("div",{className:"text-center text-xs text-muted-foreground",children:["Promedio del da: ",u]})]})]})}),e.jsx(Iz,{isOpen:i!==null,onClose:()=>o(null),energyEntry:i,onSave:d,onDelete:h})]})},It=f.forwardRef(({className:t,...s},n)=>e.jsx("textarea",{className:ce("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:n,...s}));It.displayName="Textarea";const zz=Il("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),hi=f.forwardRef(({className:t,variant:s,...n},r)=>e.jsx("div",{ref:r,role:"alert",className:ce(zz({variant:s}),t),...n}));hi.displayName="Alert";const Fz=f.forwardRef(({className:t,...s},n)=>e.jsx("h5",{ref:n,className:ce("mb-1 font-medium leading-none tracking-tight",t),...s}));Fz.displayName="AlertTitle";const fi=f.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:ce("text-sm [&_p]:leading-relaxed",t),...s}));fi.displayName="AlertDescription";const Bz=()=>{const[t,s]=f.useState(!1),[n,r]=f.useState(""),[a,i]=f.useState(null),[o,c]=f.useState(!1),{user:u}=Je(),d=async()=>{var p;if(!(!u||!n.trim())){c(!0),i(null);try{const g=JSON.parse(n);if(!Array.isArray(g))throw new Error("El JSON debe ser un array de objetos");let x=0;for(const y of g){if(!y.date||!Array.isArray(y.moods)){console.warn("Datos invlidos para un da:",y);continue}const b=`${u.uid}_${y.date}`,v=ke(Bt(xe,"moods"),b),w=await ot(v),N=w.exists()?((p=w.data())==null?void 0:p.moods)||[]:[],S=y.moods.map((D,T)=>{let R,O;if(D.time){R=D.time;const[U,I]=D.time.split(":").map(Number),_=new Date(y.date);_.setHours(U,I,0,0),O=_.getTime()}else if(D.hour!==void 0&&D.minute!==void 0){R=`${D.hour.toString().padStart(2,"0")}:${D.minute.toString().padStart(2,"0")}`;const U=new Date(y.date);U.setHours(D.hour,D.minute,0,0),O=U.getTime()}else{const U=new Date,I=U.getHours(),_=U.getMinutes()+T;R=`${I.toString().padStart(2,"0")}:${(_%60).toString().padStart(2,"0")}`;const M=new Date(y.date);O=jn(M,I,_%60).timestamp}return{emoji:D.emoji,text:D.text,time:R,timestamp:O}}),E=[...N,...S],k={id:b,userId:u.uid,date:y.date,moods:E};await Zt(v,k),x+=S.length}bt.success(`Se importaron ${x} estados de nimo correctamente`),r(""),s(!1)}catch(g){const x=g instanceof Error?g.message:"Error al importar estados de nimo";i(x),bt.error(x)}finally{c(!1)}}};return e.jsxs(kt,{open:t,onOpenChange:s,children:[e.jsx(Dx,{asChild:!0,children:e.jsxs($,{variant:"outline",size:"sm",children:[e.jsx(Bo,{className:"h-4 w-4 mr-2"}),"Importar Estados"]})}),e.jsxs(wt,{className:"max-w-2xl",children:[e.jsx(At,{children:e.jsx(_t,{children:"Importar Estados de nimo desde JSON"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:'Pegue el JSON con los estados de nimo a importar. El campo "time" es opcional.'}),e.jsxs("details",{className:"text-xs text-gray-500",children:[e.jsx("summary",{className:"cursor-pointer hover:text-gray-700",children:"Ver ejemplo de formato"}),e.jsx("pre",{className:"mt-2 p-2 bg-gray-50 rounded text-xs overflow-x-auto",children:`[
  {
    "date": "2024-01-15",
    "moods": [
      {
        "emoji": "",
        "text": "Feliz",
        "time": "09:30"
      },
      {
        "emoji": "",
        "text": "Tranquilo",
        "hour": 14,
        "minute": 15
      },
      {
        "emoji": "",
        "text": "Pensativo"
      }
    ]
  }
]`})]})]}),e.jsx(It,{value:n,onChange:p=>r(p.target.value),placeholder:"Pegue aqu el JSON con los estados de nimo...",className:"min-h-[200px] font-mono text-sm"}),a&&e.jsxs(hi,{variant:"destructive",children:[e.jsx(ro,{className:"h-4 w-4"}),e.jsx(fi,{children:a})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx($,{variant:"outline",onClick:()=>s(!1),children:"Cancelar"}),e.jsx($,{onClick:d,disabled:!n.trim()||o,children:o?"Importando...":"Importar"})]})]})]})]})},oa=IR,la=LR,Hz=$R,CC=f.forwardRef(({className:t,inset:s,children:n,...r},a)=>e.jsxs($j,{ref:a,className:ce("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",s&&"pl-8",t),...r,children:[n,e.jsx(Ma,{className:"ml-auto h-4 w-4"})]}));CC.displayName=$j.displayName;const EC=f.forwardRef(({className:t,...s},n)=>e.jsx(zj,{ref:n,className:ce("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...s}));EC.displayName=zj.displayName;const Pr=f.forwardRef(({className:t,sideOffset:s=4,...n},r)=>e.jsx(MR,{children:e.jsx(Fj,{ref:r,sideOffset:s,className:ce("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...n})}));Pr.displayName=Fj.displayName;const Ft=f.forwardRef(({className:t,inset:s,...n},r)=>e.jsx(Bj,{ref:r,className:ce("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s&&"pl-8",t),...n}));Ft.displayName=Bj.displayName;const Uz=f.forwardRef(({className:t,children:s,checked:n,...r},a)=>e.jsxs(Hj,{ref:a,className:ce("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:n,...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Uj,{children:e.jsx(Fa,{className:"h-4 w-4"})})}),s]}));Uz.displayName=Hj.displayName;const Wz=f.forwardRef(({className:t,children:s,...n},r)=>e.jsxs(Wj,{ref:r,className:ce("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Uj,{children:e.jsx(ox,{className:"h-2 w-2 fill-current"})})}),s]}));Wz.displayName=Wj.displayName;const Yz=f.forwardRef(({className:t,inset:s,...n},r)=>e.jsx(Yj,{ref:r,className:ce("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",t),...n}));Yz.displayName=Yj.displayName;const Yl=f.forwardRef(({className:t,...s},n)=>e.jsx(Vj,{ref:n,className:ce("-mx-1 my-1 h-px bg-muted",t),...s}));Yl.displayName=Vj.displayName;const Vz={entry:"",setEntry:()=>{}},TC=f.createContext(Vz),Gz=({children:t})=>{const[s,n]=f.useState("");return e.jsx(TC.Provider,{value:{entry:s,setEntry:n},children:t})},DC=()=>f.useContext(TC),qz={isUnlocked:!1,setUnlocked:()=>{}},kC=f.createContext(qz),Kz=({children:t})=>{const[s,n]=f.useState(!1);return e.jsx(kC.Provider,{value:{isUnlocked:s,setUnlocked:n},children:t})},qx=()=>f.useContext(kC),zr=t=>t.trim().split(/\s+/).filter(Boolean).length,$i=Lr("mood"),Jz=$i?`https://generativelanguage.googleapis.com/v1beta/models/${$i.model}:generateContent`:"",Xz=({selectedDate:t,open:s,onOpenChange:n})=>{const{user:r}=Je(),{entry:a}=DC(),{isUnlocked:i}=qx(),[o,c]=f.useState(!1),u=s!==void 0?s:o,d=n??c,[h,p]=f.useState(!1),[g,x]=f.useState([]),[y,b]=f.useState(""),[v,w]=f.useState(0),N="AIzaSyAW4Ot-z7OH4ZR3OeaN7vcbkEDlWpo1aMY",S=Po.map(I=>I.text).join(", "),E=($i==null?void 0:$i.prompt)??'Analiza la siguiente entrada del diario y sugiere estados de nimo en formato JSON: [{"emoji":"","text":"","time":"HH:mm","reason":""}]',k=$i==null?void 0:$i.params;if(f.useEffect(()=>{u&&i&&(async()=>{const I=a||await D();b(`${E}
Moods disponibles: ${S}. Solo usa estos valores.
${I}`)})()},[u,a,i]),f.useEffect(()=>{w(zr(y))},[y]),!i)return null;const D=async()=>{if(!r)return"";const I=Ie(t),_=ke(xe,"journal",`${r.uid}_${I}`),M=await ot(_);return M.exists()&&M.data().text||""},T=I=>{try{const _=I.match(/\[[\s\S]*\]/);if(!_)return[];const M=JSON.parse(_[0]);if(!Array.isArray(M))return[];const W=new Set(Po.map(z=>z.text)),B={maana:"09:00",tarde:"15:00",noche:"21:00"},P=new Map(Po.map(z=>[z.text,z.emoji]));return M.filter(z=>W.has(z.text)).map(z=>({...z,emoji:z.emoji||P.get(z.text)||"",time:z.time||B[z.timeOfDay??""]||"12:00"}))}catch{return[]}},R=async I=>{var _,M,W,B,P;p(!0);try{if(!I.trim()){x([]);return}const G=await(await fetch(`${Jz}?key=${N}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:I}]}],...k})})).json(),ae=((P=(B=(W=(M=(_=G==null?void 0:G.candidates)==null?void 0:_[0])==null?void 0:M.content)==null?void 0:W.parts)==null?void 0:B[0])==null?void 0:P.text)||"",Y=T(ae);x(Y)}catch{x([])}finally{p(!1)}},O=async I=>{if(!r)return;const _=Ie(t),M=`${r.uid}_${_}`,W=ke(Bt(xe,"moods"),M);let B=12,P=0;if(I.time){const[H,ie]=I.time.split(":").map(Number);B=H??12,P=ie??0}else I.timeOfDay&&(B={maana:9,tarde:15,noche:21}[I.timeOfDay]??12);const z=`${B.toString().padStart(2,"0")}:${P.toString().padStart(2,"0")}`,G=jn(t,B,P),ae=await ot(W),Y=ae.exists()&&Array.isArray(ae.data().moods)?ae.data().moods:[],X=Po.find(H=>H.text===I.text),se={emoji:I.emoji||(X==null?void 0:X.emoji)||"",text:I.text,time:z,timestamp:G.timestamp};await Zt(W,{id:M,userId:r.uid,date:_,moods:[...Y,se]})},U=()=>{d(!1),x([]),b(""),w(0)};return e.jsxs(kt,{open:u,onOpenChange:I=>I?d(!0):U(),children:[s===void 0&&e.jsxs($,{variant:"outline",size:"sm",onClick:()=>d(!0),className:"flex items-center gap-2",children:[e.jsx(Gs,{className:"h-4 w-4"}),"Analizar Diario"]}),e.jsxs(wt,{className:"max-w-2xl",children:[e.jsx(At,{children:e.jsx(_t,{children:"Sugerencias de estados de nimo"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(It,{value:y,onChange:I=>b(I.target.value),className:"max-h-[500px] overflow-y-auto"}),e.jsxs("p",{className:"text-xs text-right",children:["Tokens: ",v," ",v>3500&&e.jsx("span",{className:"text-red-500",children:"Prompt demasiado largo!"})]}),e.jsxs($,{onClick:()=>R(y),disabled:h||!N,className:"w-full flex items-center justify-center gap-2",children:[h&&e.jsx(fs,{className:"h-4 w-4 animate-spin"}),h?"Consultando...":"Analizar"]}),h&&e.jsxs("p",{className:"flex items-center justify-center gap-2 text-sm",children:[e.jsx(fs,{className:"h-4 w-4 animate-spin"})," Consultando..."]}),!h&&g.map((I,_)=>e.jsxs("div",{className:"border rounded p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:I.emoji}),e.jsx("span",{children:I.text}),e.jsx("span",{className:"ml-auto text-sm text-gray-500",children:I.time})]}),I.reason&&e.jsx("p",{className:"text-sm text-gray-500",dangerouslySetInnerHTML:{__html:xi.sanitize(I.reason)}}),e.jsx($,{size:"sm",className:"ml-auto",onClick:()=>O(I),children:"Registrar"})]},_)),!h&&g.length===0&&e.jsx("p",{className:"text-sm text-center text-gray-500",children:"No se encontraron sugerencias"})]})]})]})},Zz=({selectedDate:t})=>{const[s,n]=f.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs(oa,{children:[e.jsx(la,{asChild:!0,children:e.jsxs($,{size:"sm",variant:"outline",className:"flex items-center gap-2 text-blue-600",children:[e.jsx(Gs,{className:"w-4 h-4"}),"IA"]})}),e.jsx(Pr,{align:"end",children:e.jsx(Ft,{onSelect:()=>n(!0),children:"Sugerir moods"})})]}),e.jsx(Xz,{selectedDate:t,open:s,onOpenChange:n})]})},AC=({selectedDate:t,energyFirst:s=!1})=>{const{user:n}=Je(),{isUnlocked:r}=qx(),{moodHistory:a,status:i,error:o,addMood:c,updateMood:u,deleteMood:d,resync:h}=Qw(t),{energyHistory:p,status:g,error:x,addEntry:y,updateEntry:b,deleteEntry:v,resync:w}=yN(t),{isOnline:N}=ua(),S=p.slice().sort((R,O)=>O.timestamp-R.timestamp)[0],E=["text-red-500","text-orange-500","text-yellow-500","text-lime-600","text-green-600"];if(!n)return e.jsx(Ce,{className:"w-full",children:e.jsx(Ae,{className:"p-4 text-center",children:e.jsx("p",{children:"Inicia sesin para registrar tu estado de nimo"})})});const k=Ie(t)===Ie(new Date),D=e.jsxs(Ce,{className:"w-full",children:[e.jsxs(Ae,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"font-medium",children:"Estado de nimo"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Bz,{}),r&&e.jsx(Zz,{selectedDate:t})]})]}),k&&e.jsx(_z,{onSelect:c,disabled:i==="saving"||!N}),e.jsx(Oz,{moods:a,onUpdateMood:u,onDeleteMood:d}),o&&e.jsx("p",{className:"mt-2 text-sm text-red-500",children:o})]}),e.jsxs(In,{className:"justify-center gap-2 text-xs p-2",children:[i==="saving"&&e.jsx("span",{className:"text-blue-500",children:"Guardando..."}),i==="pending"&&e.jsx("span",{className:"text-yellow-600",children:"Pendiente de sincronizar"}),i==="saved"&&e.jsx("span",{className:"text-green-600",children:"Sincronizado"}),i==="error"&&e.jsx("span",{className:"text-red-500",children:"Error al guardar"}),!N&&e.jsx("span",{className:"text-orange-600",children:"Offline"}),e.jsx($,{onClick:h,variant:"link",className:"p-0 h-auto text-xs",children:"Reintentar"})]})]}),T=e.jsxs(Ce,{className:"w-full",children:[e.jsxs(Ae,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("h3",{className:"font-medium",children:["Nivel de energa",S&&e.jsxs("span",{className:`ml-2 ${E[S.level-1]}`,children:["(",S.level,")"]})]}),e.jsx("div",{className:"flex items-center gap-2"})]}),k&&e.jsx("div",{className:"mb-4",children:e.jsx(SC,{onSelect:y,disabled:g==="saving"||!N})}),e.jsx($z,{entries:p,onUpdate:b,onDelete:v}),x&&e.jsx("p",{className:"mt-2 text-sm text-red-500",children:x})]}),e.jsxs(In,{className:"justify-center gap-2 text-xs p-2",children:[g==="saving"&&e.jsx("span",{className:"text-blue-500",children:"Guardando..."}),g==="pending"&&e.jsx("span",{className:"text-yellow-600",children:"Pendiente de sincronizar"}),g==="saved"&&e.jsx("span",{className:"text-green-600",children:"Sincronizado"}),g==="error"&&e.jsx("span",{className:"text-red-500",children:"Error al guardar"}),!N&&e.jsx("span",{className:"text-orange-600",children:"Offline"}),e.jsx($,{onClick:w,variant:"link",className:"p-0 h-auto text-xs",children:"Reintentar"})]})]});return e.jsxs("div",{className:"space-y-4",children:[s?T:D,s?D:T]})},nb=["#FF8042","#00C49F","#FFBB28","#FF8042","#0088FE","#FF0000"],Qz=()=>{const[t,s]=f.useState(new Date),[n]=f.useState([]);return e.jsxs(ln,{children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Estado de nimo"}),e.jsx("p",{className:"text-gray-500",children:"Registra y analiza tu estado emocional para mejorar tu bienestar"})]}),e.jsx(La,{selectedDate:t,onChange:s}),e.jsxs(ma,{defaultValue:"tracker",className:"space-y-4",children:[e.jsxs(ha,{children:[e.jsx(Ds,{value:"tracker",children:"Registro Diario"}),e.jsx(Ds,{value:"analytics",children:"Anlisis"}),e.jsx(Ds,{value:"settings",children:"Configuracin"})]}),e.jsx(ys,{value:"tracker",className:"space-y-4",children:e.jsx(AC,{selectedDate:t})}),e.jsx(ys,{value:"analytics",className:"space-y-4",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsx(Ce,{children:e.jsxs(Ae,{className:"pt-6",children:[e.jsx("h3",{className:"font-medium mb-4",children:"Distribucin de Estados de nimo"}),e.jsx("div",{className:"h-64",children:e.jsx(On,{width:"100%",height:"100%",children:e.jsxs(hd,{children:[e.jsx(fd,{data:n,cx:"50%",cy:"50%",labelLine:!1,outerRadius:80,fill:"#8884d8",dataKey:"value",label:({cx:r,cy:a,midAngle:i,innerRadius:o,outerRadius:c,value:u,index:d})=>{const h=Math.PI/180,p=25+o+(c-o),g=r+p*Math.cos(-i*h),x=a+p*Math.sin(-i*h);return e.jsx("text",{x:g,y:x,fill:"#888",textAnchor:g>r?"start":"end",dominantBaseline:"central",children:`${n[d].name} (${u})`})},children:n.map(r=>e.jsx(pd,{fill:nb[r%nb.length]},`cell-${r}`))}),e.jsx(Pn,{})]})})})]})}),e.jsx(Ce,{children:e.jsx(Ae,{className:"pt-6",children:e.jsx("h3",{className:"font-medium mb-4",children:"Patrones y Tendencias"})})})]})}),e.jsxs(ys,{value:"settings",className:"space-y-4",children:[e.jsx(Ce,{children:e.jsx(Ae,{className:"pt-6",children:e.jsx("h3",{className:"font-medium mb-4",children:"Configuracin de Estados de nimo"})})}),"        "]})]})]})},e6=({onLock:t})=>e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(NO,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Mi Diario"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-sm text-gray-500",children:new Date().toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long"})})}),e.jsx($,{variant:"ghost",size:"icon",onClick:t,title:"Bloquear diario",children:e.jsx(ow,{className:"w-4 h-4"})})]})]}),t6=({value:t,onChange:s})=>e.jsx(It,{value:t,onChange:n=>s(n.target.value),placeholder:"Cmo ha sido tu da?",className:"w-full h-64 resize-none"}),_C=({lastUpdated:t,className:s=""})=>t?e.jsxs("div",{className:`flex items-center gap-2 text-sm text-gray-500 ${s}`,children:[e.jsx(en,{className:"w-4 h-4"}),e.jsxs("span",{children:["ltima actualizacin: ",t]})]}):null,s6=({onUnlock:t,lastUpdated:s})=>{const[n,r]=f.useState(""),[a,i]=f.useState(!1),o=c=>{c.preventDefault(),n==="1234"?(t(),i(!1)):i(!0)};return e.jsx(Ce,{className:"w-full",children:e.jsx(Ae,{className:"p-4",children:e.jsxs("form",{onSubmit:o,className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx(ow,{className:"w-12 h-12 text-blue-500"})}),e.jsx("h3",{className:"text-center text-lg font-medium",children:"Diario Protegido"}),e.jsx("p",{className:"text-center text-sm text-gray-500",children:"Ingresa la contrasea para acceder a tu diario"}),e.jsx(Fe,{type:"password",value:n,onChange:c=>r(c.target.value),placeholder:"Contrasea",className:a?"border-destructive focus-visible:ring-destructive":""}),a&&e.jsx("p",{className:"text-sm text-red-500 text-center",children:"Contrasea incorrecta"}),e.jsx($,{type:"submit",className:"w-full",children:"Desbloquear"}),e.jsx(_C,{lastUpdated:s,className:"justify-center"})]})})})},n6=Il("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}}),Mt=f.forwardRef(({className:t,variant:s,...n},r)=>e.jsx("div",{ref:r,className:ce(n6({variant:s}),t),...n}));Mt.displayName="Badge";const Cd={PERSONAL:"personal",WORK:"work",JIKKO:"jikko",UNICAUCA:"unicauca",ENTREAGILES:"entreagiles",CERTMIND:"certmind",HOME:"home",HEALTH:"health",SHOPPING:"shopping",STUDY:"study",SOCIAL:"social",OTHER:"other"},Qs={personal:"Personal",work:"Trabajo",jikko:"Jikko",unicauca:"Unicauca",entreagiles:"EntreAgiles",certmind:"CertMind",home:"Casa",health:"Salud",shopping:"Compras",study:"Estudio",social:"Social",other:"Otro"},Ra={personal:{bg:"bg-green-100",text:"text-green-700"},work:{bg:"bg-blue-100",text:"text-blue-700"},jikko:{bg:"bg-blue-100",text:"text-orange-700"},unicauca:{bg:"bg-red-100",text:"text-teal-700"},entreagiles:{bg:"bg-black-100",text:"text-lime-700"},certmind:{bg:"bg-purple-100",text:"text-purple-700"},home:{bg:"bg-green-100",text:"text-green-700"},health:{bg:"bg-pink-100",text:"text-red-700"},shopping:{bg:"bg-pink-100",text:"text-yellow-700"},study:{bg:"bg-indigo-100",text:"text-indigo-700"},social:{bg:"bg-pink-100",text:"text-pink-700"},other:{bg:"bg-gray-100",text:"text-gray-700"}},r6={daily:"Diario",weekly:"Semanal",monthly:"Mensual"},rb={do:{label:"HACER",color:"bg-red-500",text:"Urgente e importante"},decide:{label:"DECIDIR",color:"bg-orange-500",text:"Importante, no urgente"},delegate:{label:"DELEGAR",color:"bg-blue-500",text:"Urgente, no importante"},delete:{label:"ELIMINAR",color:"bg-gray-500",text:"Ni urgente ni importante"},none:{label:"",color:"",text:""}},ab=t=>nt(t,"dd/MM"),a6=t=>t!=null&&t.type&&r6[t.type]||"",i6=(t="none")=>rb[t]||rb.none,o6=t=>t?Is(ps(t),ps(new Date)):!1,RC=f.memo(({task:t,onEdit:s,onDelete:n,onView:r})=>{const a=Qt(),i=f.useCallback(d=>{d.stopPropagation(),s(t)},[s,t]),o=f.useCallback(d=>{d.stopPropagation(),r==null||r(t)},[r,t]),c=f.useCallback(d=>{d.stopPropagation(),a(`/task/${t.taskCode}/run`)},[a,t.taskCode]),u=f.useCallback(()=>{n(t.id)},[n,t.id]);return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx($,{variant:"ghost",size:"sm",onClick:c,className:"h-7 w-7 p-0 text-green-600 hover:text-green-700 hover:bg-green-50",title:"Ejecutar tarea",children:e.jsx(Sn,{className:"h-3 w-3"})}),e.jsx($,{variant:"ghost",size:"sm",onClick:i,className:"h-7 w-7 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",title:"Editar tarea",children:e.jsx(jr,{className:"h-3 w-3"})}),e.jsx($,{variant:"ghost",size:"sm",onClick:o,className:"h-7 w-7 p-0 text-gray-600 hover:text-gray-700 hover:bg-gray-100",title:"Ver detalles",children:e.jsx(Sl,{className:"h-3 w-3"})}),e.jsxs(oa,{children:[e.jsx(la,{asChild:!0,children:e.jsx($,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 hover:bg-gray-50",onClick:d=>d.stopPropagation(),children:e.jsx(SO,{className:"w-3 h-3"})})}),e.jsx(Pr,{align:"end",className:"w-48",children:e.jsxs(Wa,{children:[e.jsx(yi,{asChild:!0,children:e.jsxs(Ft,{onSelect:d=>d.preventDefault(),className:"text-sm text-red-600 focus:text-red-600",children:[e.jsx("span",{className:"mr-2",children:""}),"Eliminar tarea"]})}),e.jsxs(fa,{children:[e.jsxs(pa,{children:[e.jsx(ga,{children:"Eliminar tarea?"}),e.jsxs(va,{children:['Esta accin no se puede deshacer. La tarea "',t.title,'" ser eliminada permanentemente.']})]}),e.jsxs(xa,{children:[e.jsx(ba,{children:"Cancelar"}),e.jsx(ya,{onClick:u,className:"bg-red-600 hover:bg-red-700",children:"Eliminar"})]})]})]})})]})]})});RC.displayName="CompactTaskActions";const ad=f.memo(({task:t,onDelete:s,onEdit:n,onView:r,onMove:a,onAssignTimeOfDay:i,showCategoryLabel:o=!0})=>{const c=Qt(),u=o6(t.startDate??null),d=i6(t.priority),h=f.useCallback(()=>{r==null||r(t)},[r,t]),p=()=>t.completed?"default":u?"destructive":"secondary",g=()=>t.completed?e.jsx(Ll,{className:"h-3 w-3"}):u?e.jsx(en,{className:"h-3 w-3"}):e.jsx(ns,{className:"h-3 w-3"}),x=()=>{if(t.completed)return"Completada";if(u)return"Vencida";if(t.startDate){const y=ps(new Date),b=os(y,1);if(Is(t.startDate,ps(os(y,1))))return"Hoy";if(Is(t.startDate,ps(os(b,1))))return"Maana"}return"Pendiente"};return e.jsxs("div",{className:"hover:bg-gray-50 transition-colors cursor-pointer",onClick:h,children:[e.jsx("div",{className:"md:hidden",children:e.jsx(Ce,{className:ce("border border-gray-200 bg-white m-2",t.completed&&"opacity-75",!t.completed&&u&&"border-l-4 border-l-red-500 bg-red-50/30"),children:e.jsx(Ae,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[o&&e.jsx("div",{className:"flex-shrink-0 mt-1",children:e.jsx(Cl,{className:"h-4 w-4 text-gray-400"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:ce("text-sm font-medium text-gray-900 flex-1",t.completed&&"line-through text-gray-500"),children:t.title}),e.jsxs("span",{className:"text-xs font-mono text-gray-400",children:["#",t.taskCode]})]}),t.description&&e.jsx("p",{className:ce("text-xs text-gray-500 mt-1 line-clamp-2",t.completed&&"line-through"),children:t.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Mt,{variant:p(),className:"text-xs",children:e.jsxs("div",{className:"flex items-center gap-1",children:[g(),e.jsx("span",{children:x()})]})}),t.isPrivate&&e.jsx(Mt,{variant:"outline",className:"text-xs",children:""})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500",children:[o&&e.jsx("span",{children:Qs[t.category]}),t.estimatedTime&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:""}),e.jsxs("span",{children:[t.estimatedTime,"m"]})]}),t.startDate&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:""}),e.jsx("span",{children:ab(t.startDate)})]}),d.label&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:""}),e.jsx("span",{children:d.label})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx($,{variant:"ghost",size:"sm",onClick:y=>{y.stopPropagation(),c(`/task/${t.taskCode}/run`)},className:"h-6 w-6 p-0 text-green-600",children:e.jsx(Sn,{className:"h-3 w-3"})}),e.jsx($,{variant:"ghost",size:"sm",onClick:y=>{y.stopPropagation(),n(t)},className:"h-6 w-6 p-0 text-blue-600",children:e.jsx(jr,{className:"h-3 w-3"})})]})]})]})})})}),e.jsxs("div",{className:"hidden md:grid grid-cols-12 gap-4 p-4 border-b border-gray-100",children:[e.jsx("div",{className:"col-span-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[o&&e.jsx("div",{className:"flex-shrink-0 mt-1",children:e.jsx(Cl,{className:"h-4 w-4 text-gray-400"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:ce("text-sm font-medium text-gray-900 flex-1",t.completed&&"line-through text-gray-500"),children:t.title}),e.jsxs("span",{className:"text-xs font-mono text-gray-400",children:["#",t.taskCode]})]}),t.description&&e.jsx("p",{className:ce("text-xs text-gray-500 mt-1 line-clamp-1",t.completed&&"line-through"),children:t.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[o&&e.jsx("span",{className:"text-xs text-gray-500",children:Qs[t.category]}),t.isPrivate&&e.jsx(Mt,{variant:"outline",className:"text-xs",children:" Privada"}),t.isRecurrent&&e.jsxs(Mt,{variant:"outline",className:"text-xs",children:[e.jsx(cx,{className:"w-3 h-3 mr-1"}),a6(t.recurrence)]})]})]})]})}),e.jsx("div",{className:"col-span-2 flex justify-center items-center",children:e.jsx(Mt,{variant:p(),className:"text-xs",children:e.jsxs("div",{className:"flex items-center gap-1",children:[g(),e.jsx("span",{children:x()})]})})}),e.jsx("div",{className:"col-span-1 flex justify-center items-center",children:d.label?e.jsx(Mt,{variant:"outline",className:"text-xs",style:{backgroundColor:d.color+"20",color:d.color},children:d.label}):e.jsx("span",{className:"text-xs text-gray-400",children:"Sin prioridad"})}),e.jsx("div",{className:"col-span-1 flex justify-center items-center",children:t.estimatedTime?e.jsxs("span",{className:"text-xs text-gray-600",children:[t.estimatedTime,"m"]}):e.jsx("span",{className:"text-xs text-gray-400",children:"-"})}),e.jsx("div",{className:"col-span-2 flex justify-center items-center",children:t.startDate?e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-600",children:[e.jsx(ns,{className:"h-3 w-3"}),e.jsx("span",{children:ab(t.startDate)})]}):e.jsx("span",{className:"text-xs text-gray-400",children:"Sin fecha"})}),e.jsx("div",{className:"col-span-2 flex justify-center items-center",children:e.jsx(RC,{task:t,onEdit:n,onDelete:s,onView:r,onMove:a,onAssignTimeOfDay:i})})]})]})});ad.displayName="TaskItemList";function l6(t){const s="https://calendar.google.com/calendar/render",n=new URLSearchParams;n.append("action","TEMPLATE"),n.append("text",t.title);const r=o=>nt(o,"yyyyMMdd'T'HHmmss"),a=r(t.startDate),i=t.endDate?r(t.endDate):r(new Date(t.startDate.getTime()+60*60*1e3));return n.append("dates",`${a}/${i}`),t.description&&n.append("details",t.description),n.append("ctz","America/Bogota"),`${s}?${n.toString()}`}function c6(t){const s=l6(t);window.open(s,"_blank","noopener,noreferrer")}function OC(){return{exportTaskToGoogleCalendar:f.useCallback(s=>{if(s.isPrivate){console.warn("Private tasks cannot be exported to Google Calendar");return}if(!s.startDate){console.warn("Task must have a start date to export");return}let n="";const r=Qs[s.category];if(n+=` Categora: ${r}

`,s.priority&&(n+=` Prioridad: ${{do:" HACER (Urgente e Importante)",decide:" DECIDIR (Importante)",delegate:" DELEGAR (Urgente)",delete:" ELIMINAR"}[s.priority]}

`),s.estimatedTime){const i=Math.floor(s.estimatedTime/60),o=s.estimatedTime%60,c=i>0?`${i}h ${o}min`:`${o}min`;n+=` Tiempo estimado: ${c}

`}s.description&&(n+=` Descripcin:
${s.description}

`),s.isRecurrent&&s.recurrence&&(n+=` Tarea recurrente (${s.recurrence.pattern})
`),n+=`
---
Tarea #${s.taskCode} - Life Tracker`;let a=s.endDate;!a&&s.estimatedTime&&(a=new Date(s.startDate.getTime()+s.estimatedTime*60*1e3)),c6({title:s.title,description:n,startDate:s.startDate,endDate:a})},[])}}const d6=t=>{const s={do:{label:"HACER",color:"bg-red-500",text:"Urgente e importante",urgent:!0,important:!0},decide:{label:"DECIDIR",color:"bg-yellow-500",text:"Importante pero no urgente",urgent:!1,important:!0},delegate:{label:"DELEGAR",color:"bg-blue-500",text:"Urgente pero no importante",urgent:!0,important:!1},delete:{label:"ELIMINAR",color:"bg-gray-500",text:"Ni urgente ni importante",urgent:!1,important:!1},none:{label:"",color:"",text:"",urgent:!1,important:!1}};return s[t]||s.none},u6=t=>{if(!t)return"";if(t<60)return`${t} min`;{const s=Math.floor(t/60),n=t%60;return n===0?`${s}h`:`${s}h ${n}min`}},sh=({task:t,isOpen:s,onClose:n,onEdit:r,onToggle:a,onDelete:i})=>{if(!t)return null;const o=Qt(),{exportTaskToGoogleCalendar:c}=OC(),u=Ra[t.category],d=d6(t.priority),h=t.isRecurrent&&t.recurrence?Vw(t.startDate||new Date,t.recurrence.pattern,t.recurrence.customDays):"",p=t.startDate&&Is(ps(t.startDate),ps(new Date)),{total:g,checked:x}=Um(t.description||""),y=g>0,b=y?t.progress??x/g*100:0,v=gN(t.description||"");return e.jsx(kt,{open:s,onOpenChange:w=>{w||n()},children:e.jsxs(wt,{className:"max-w-5xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[e.jsxs("div",{className:"col-span-12 md:col-span-8 space-y-6",children:[e.jsx(At,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[t.isPrivate&&e.jsx("span",{className:"text-lg mt-1",children:""}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(_t,{className:"text-2xl font-semibold leading-tight break-words text-gray-900",children:t.title}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["en lista ",e.jsx("span",{className:"font-medium",children:Qs[t.category]})]}),e.jsx("div",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-md bg-gray-100 text-gray-700",children:e.jsxs("span",{className:"text-xs font-mono",children:["#",t.taskCode]})})]})]})]})}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[t.startDate&&e.jsxs("div",{className:`inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium ${p?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"}`,children:[e.jsx("span",{children:""}),FI(t.startDate),p&&" (Vencida)"]}),t.timeOfDay&&e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium bg-orange-100 text-orange-800",children:[e.jsx("span",{children:""}),t.timeOfDay==="morning"&&"Maana",t.timeOfDay==="afternoon"&&"Tarde",t.timeOfDay==="evening"&&"Noche"]})]}),t.description&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx("span",{children:""}),"Descripcin"]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("div",{className:"prose prose-sm max-w-none text-gray-700",dangerouslySetInnerHTML:{__html:v}}),y&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Progreso de elementos"}),e.jsxs("span",{className:"text-gray-600",children:[x," de ",g," completados"]})]}),e.jsx(lr,{value:b,className:"h-2"})]})]})]}),t.priority&&d.text||t.isRecurrent&&h?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx("span",{children:""}),"Detalles adicionales"]}),t.priority&&d.text&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Matriz de Eisenhower"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:d.text}),e.jsxs("div",{className:"flex gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"Urgente:"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${d.urgent?"bg-red-100 text-red-800":"bg-gray-100 text-gray-600"}`,children:d.urgent?"S":"No"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"Importante:"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${d.important?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-600"}`,children:d.important?"S":"No"})]}),d.label&&e.jsxs("div",{className:`inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium text-white ${d.color}`,children:[e.jsx("span",{children:""}),d.label]})]})]})]}):null]}),e.jsxs("div",{className:"col-span-12 md:col-span-4 space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 uppercase tracking-wide",children:"Acciones"}),e.jsxs("div",{className:"space-y-2",children:[a&&e.jsx($,{onClick:()=>a(t.id,!t.completed),variant:t.completed?"outline":"default",className:"w-full justify-start gap-2",children:t.completed?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:""}),"Marcar pendiente"]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:""}),"Marcar completada"]})}),e.jsxs($,{onClick:()=>o(`/task/${t.taskCode}/run`),variant:"outline",className:"w-full justify-start gap-2",children:[e.jsx(Sn,{className:"w-4 h-4"}),"Ejecutar"]}),t.startDate&&!t.isPrivate&&e.jsxs($,{variant:"outline",className:"w-full justify-start gap-2",onClick:()=>c(t),children:[e.jsx(ns,{className:"w-4 h-4"}),"Exportar a Google Calendar"]}),e.jsxs($,{onClick:()=>r(t),variant:"outline",className:"w-full justify-start gap-2",children:[e.jsx("span",{children:""}),"Editar"]}),i&&e.jsxs(Wa,{children:[e.jsx(yi,{asChild:!0,children:e.jsxs($,{variant:"outline",className:"w-full justify-start gap-2 text-red-600 hover:text-red-700 hover:bg-red-50",children:[e.jsx("span",{children:""}),"Eliminar"]})}),e.jsxs(fa,{children:[e.jsxs(pa,{children:[e.jsx(ga,{children:"Eliminar tarea?"}),e.jsxs(va,{children:['Esta accin no se puede deshacer. La tarea "',t.title,'" ser eliminada permanentemente.']})]}),e.jsxs(xa,{children:[e.jsx(ba,{children:"Cancelar"}),e.jsx(ya,{onClick:()=>{i(t.id),n()},className:"bg-red-600 hover:bg-red-700",children:"Eliminar"})]})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 uppercase tracking-wide",children:"Organizacin"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Lista"}),e.jsxs("div",{className:`inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium ${u.bg} ${u.text}`,children:[e.jsx("span",{children:""}),Qs[t.category]]})]}),t.size&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Tamao"}),e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium bg-gray-100 text-gray-800",children:[e.jsx("span",{children:""}),t.size]})]}),t.estimatedTime&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Tiempo estimado"}),e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium bg-emerald-100 text-emerald-800",children:[e.jsx("span",{children:""}),u6(t.estimatedTime)]})]}),t.isRecurrent&&h&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Recurrencia"}),e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium bg-purple-100 text-purple-800",children:[e.jsx("span",{children:""}),h]})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"text-sm text-gray-500 pt-2 border-t",children:[e.jsx("p",{className:"font-medium text-gray-600 mb-1",children:"Creada"}),t.createdAt?new Date(t.createdAt.seconds*1e3).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):"Recientemente"]})})]})]}),e.jsx(Cn,{className:"mt-6 border-t pt-4",children:e.jsx($,{variant:"outline",onClick:n,children:"Cerrar"})})]})})},m6=({value:t,onChange:s,multiline:n})=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(CO,{className:"w-4 h-4"}),"Ttulo"]}),n?e.jsx(It,{value:t,onChange:r=>s(r.target.value),placeholder:"Una tarea por lnea",className:"min-h-[120px]"}):e.jsx(Fe,{value:t,onChange:r=>s(r.target.value),placeholder:"Ttulo de la tarea..."})]}),h6=({textAreaRef:t,value:s,onChange:n})=>{const r=f.useCallback(()=>{const c=t.current;if(!c)return;const{selectionStart:u,selectionEnd:d}=c,h=s.split(`
`);let p=0,g=0;for(let b=0;b<h.length;b++){if(p+h[b].length+1>u){g=b;break}p+=h[b].length+1}if(g===0)return;const x=h[g];h[g]=h[g-1],h[g-1]=x;const y=h.join(`
`);n(y),setTimeout(()=>{const b=h[g-1].length,v=u-p,w=p-b-1+v,N=d-p+w;c.setSelectionRange(Math.max(0,w),Math.max(0,N)),c.focus()},0)},[t,s,n]),a=f.useCallback(()=>{const c=t.current;if(!c)return;const{selectionStart:u,selectionEnd:d}=c,h=s.split(`
`);let p=0,g=0;for(let b=0;b<h.length;b++){if(p+h[b].length+1>u){g=b;break}p+=h[b].length+1}if(g===h.length-1)return;const x=h[g];h[g]=h[g+1],h[g+1]=x;const y=h.join(`
`);n(y),setTimeout(()=>{const b=h[g+1].length,v=u-p,w=p+b+1+v,N=d-p+w;c.setSelectionRange(w,N),c.focus()},0)},[t,s,n]),i=f.useCallback(()=>{var v;const c=t.current;if(!c)return;const{selectionStart:u,selectionEnd:d}=c,h=s.split(`
`);let p=0,g=0;for(let w=0;w<h.length;w++){if(p+h[w].length+1>u){g=w;break}p+=h[w].length+1}const x=h[g];let y=x;if(x.match(/^\s*-\s*\[\s*\]\s*/))y=x.replace(/^\s*-\s*\[\s*\]\s*/,"- [x] ");else if(x.match(/^\s*-\s*\[x\]\s*/i))y=x.replace(/^\s*-\s*\[x\]\s*/i,"- [ ] ");else{const w=((v=x.match(/^\s*/))==null?void 0:v[0])||"",N=x.slice(w.length);y=w+"- [ ] "+N}h[g]=y;const b=h.join(`
`);n(b),setTimeout(()=>{const w=y.length-x.length,N=u+(u>p?w:0),S=d+w;c.setSelectionRange(N,S),c.focus()},0)},[t,s,n]);return{handleKeyDown:f.useCallback(c=>{if(c.altKey&&c.key==="ArrowUp"){c.preventDefault(),r();return}if(c.altKey&&c.key==="ArrowDown"){c.preventDefault(),a();return}if(c.ctrlKey&&c.key==="l"){c.preventDefault(),i();return}},[r,a,i]),moveLineUp:r,moveLineDown:a,toggleCheckboxLine:i}},f6=({value:t,onChange:s})=>{const n=f.useRef(null),{handleKeyDown:r}=h6({textAreaRef:n,value:t,onChange:s});return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(EO,{className:"w-4 h-4"}),"Descripcin de la tarea",e.jsx("span",{className:"text-xs text-gray-500 ml-2",children:"(Alt+ mover lneas, Ctrl+L toggle checkbox)"})]}),e.jsx(It,{ref:n,value:t,onChange:a=>s(a.target.value),onKeyDown:r,placeholder:"Agrega ms detalles sobre la tarea...",className:"min-h-[250px] resize-y"})]})},$a=({className:t})=>{const[s,n]=f.useState(0);return f.useEffect(()=>{const r=setInterval(()=>{n(a=>{const i=a+5;return i>=100?(clearInterval(r),100):i})},500);return()=>clearInterval(r)},[]),e.jsxs("div",{className:`flex items-center gap-2 ${t??""}`,children:[e.jsx(lr,{value:s,className:"flex-1"}),e.jsxs("span",{className:"text-xs text-muted-foreground w-8 text-right",children:[s,"%"]})]})},zi=Lr("task"),p6=zi?`https://generativelanguage.googleapis.com/v1beta/models/${zi.model}:generateContent`:"",x6=({title:t,description:s,onInsert:n})=>{var w;const[r,a]=f.useState(!1),[i,o]=f.useState(""),[c,u]=f.useState(""),[d,h]=f.useState(!1),[p,g]=f.useState(0),x="AIzaSyAW4Ot-z7OH4ZR3OeaN7vcbkEDlWpo1aMY",y=((w=zi==null?void 0:zi.prompts)==null?void 0:w.breakdown)??"Desglosa la siguiente tarea en subtareas concretas y accionables:",b=zi==null?void 0:zi.params;f.useEffect(()=>{r&&o(`${y}
Tarea: ${t}
Descripcion: ${s}`)},[r,t,s]),f.useEffect(()=>{g(zr(i))},[i]);const v=async()=>{var N,S,E,k,D;if(t){h(!0);try{const R=await(await fetch(`${p6}?key=${x}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:i}]}],...b})})).json(),O=(D=(k=(E=(S=(N=R==null?void 0:R.candidates)==null?void 0:N[0])==null?void 0:S.content)==null?void 0:E.parts)==null?void 0:k[0])==null?void 0:D.text;u(O||"No se pudo obtener sugerencia")}catch{u("Error al consultar la API")}finally{h(!1)}}};return e.jsxs(e.Fragment,{children:[e.jsxs($,{type:"button",variant:"outline",size:"sm",onClick:()=>a(!0),className:"flex items-center gap-2",children:[e.jsx(Gs,{className:"w-4 h-4"})," Subtareas IA"]}),e.jsx(kt,{open:r,onOpenChange:a,children:e.jsxs(wt,{className:"w-[95vw] h-[90vh] max-w-none max-h-none overflow-hidden flex flex-col sm:w-[90vw] sm:h-[85vh]",children:[e.jsxs(At,{className:"flex-shrink-0",children:[e.jsx(_t,{className:"text-xl",children:"Desglose de Tarea con IA"}),e.jsx(cn,{children:"La IA descompondr tu tarea en subtareas concretas y accionables. Usa el panel izquierdo para editar el prompt y visualiza el resultado en el panel derecho."})]}),e.jsxs("div",{className:"flex-1 flex flex-col sm:flex-row gap-4 min-h-0 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[e.jsxs("div",{className:"flex-1 flex flex-col mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2 flex-shrink-0",children:"Prompt para IA"}),e.jsx(It,{value:i,onChange:N=>o(N.target.value),className:"flex-1 resize-none min-h-0",placeholder:"Escribe o modifica el prompt para la IA..."})]}),e.jsxs("div",{className:"flex flex-col gap-3 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"text-gray-500",children:["Tokens: ",p]}),p>3500&&e.jsx("span",{className:"text-red-500 font-medium",children:"Prompt demasiado largo!"})]}),e.jsxs($,{onClick:v,disabled:d||!x||p>3500,className:"w-full flex items-center justify-center gap-2",size:"lg",children:[d&&e.jsx(fs,{className:"w-4 h-4 animate-spin"}),e.jsx(Gs,{className:"w-4 h-4"}),d?"Consultando IA...":"Obtener subtareas"]}),d&&e.jsx($a,{className:"mt-2"})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 sm:border-l sm:border-gray-200 sm:pl-4 border-t sm:border-t-0 border-gray-200 pt-4 sm:pt-0",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Resultado"}),c&&e.jsxs($,{type:"button",size:"sm",variant:"outline",onClick:()=>{navigator.clipboard.writeText(c),bt.success("Texto copiado al portapapeles")},className:"flex items-center gap-1",children:[e.jsx(da,{className:"w-4 h-4"}),"Copiar"]})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[e.jsx(It,{readOnly:!0,value:c||(d?"Generando subtareas...":"Las subtareas aparecern aqu despus de generar"),className:"flex-1 resize-none bg-gray-50 border-gray-200 min-h-0",placeholder:"Las subtareas aparecern aqu..."}),c&&e.jsx("div",{className:"mt-3 flex-shrink-0",children:e.jsx($,{type:"button",className:"w-full",onClick:()=>{n(c),bt.success("Subtareas insertadas en descripcin"),a(!1),u("")},variant:"default",children:" Insertar en descripcin"})})]})]})]}),e.jsx("div",{className:"flex-shrink-0 mt-4 pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 text-xs text-gray-500",children:[e.jsx("span",{children:" Tip: Describe tu tarea con detalle para obtener mejores subtareas"}),!x]})})]})})]})},Fi=Lr("task"),g6=Fi?`https://generativelanguage.googleapis.com/v1beta/models/${Fi.model}:generateContent`:"",v6=({title:t,description:s,onInsert:n})=>{var w;const[r,a]=f.useState(!1),[i,o]=f.useState(""),[c,u]=f.useState(""),[d,h]=f.useState(!1),[p,g]=f.useState(0),x="AIzaSyAW4Ot-z7OH4ZR3OeaN7vcbkEDlWpo1aMY",y=((w=Fi==null?void 0:Fi.prompts)==null?void 0:w.improveDescription)??"Mejora la descripcin de la tarea sin cambiar su esencia. Si no hay descripcin, genera una basada en el ttulo (mx. 150 palabras).",b=Fi==null?void 0:Fi.params;f.useEffect(()=>{r&&o(`${y}
Ttulo: ${t}
Descripcin actual: ${s||"N/A"}`)},[r,t,s]),f.useEffect(()=>{g(zr(i))},[i]);const v=async()=>{var N,S,E,k,D;if(t){h(!0);try{const R=await(await fetch(`${g6}?key=${x}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:i}]}],...b})})).json(),O=(D=(k=(E=(S=(N=R==null?void 0:R.candidates)==null?void 0:N[0])==null?void 0:S.content)==null?void 0:E.parts)==null?void 0:k[0])==null?void 0:D.text;u(O||"No se pudo obtener sugerencia")}catch{u("Error al consultar la API")}finally{h(!1)}}};return e.jsxs(e.Fragment,{children:[e.jsxs($,{type:"button",variant:"outline",size:"sm",onClick:()=>a(!0),className:"flex items-center gap-2",children:[e.jsx(Gs,{className:"w-4 h-4"})," Mejorar descripcin"]}),e.jsx(kt,{open:r,onOpenChange:a,children:e.jsxs(wt,{className:"w-[95vw] h-[90vh] max-w-none max-h-none overflow-hidden flex flex-col sm:w-[90vw] sm:h-[85vh]",children:[e.jsxs(At,{className:"flex-shrink-0",children:[e.jsx(_t,{className:"text-xl",children:"Mejorar Descripcin con IA"}),e.jsx(cn,{children:"La IA mejorar la descripcin de tu tarea sin cambiar su esencia. Usa el panel izquierdo para editar el prompt y visualiza el resultado en el panel derecho."})]}),e.jsxs("div",{className:"flex-1 flex flex-col sm:flex-row gap-4 min-h-0 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[e.jsxs("div",{className:"flex-1 flex flex-col mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2 flex-shrink-0",children:"Prompt para IA"}),e.jsx(It,{value:i,onChange:N=>o(N.target.value),className:"flex-1 resize-none min-h-0",placeholder:"Escribe o modifica el prompt para la IA..."})]}),e.jsxs("div",{className:"flex flex-col gap-3 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"text-gray-500",children:["Tokens: ",p]}),p>3500&&e.jsx("span",{className:"text-red-500 font-medium",children:"Prompt demasiado largo!"})]}),e.jsxs($,{onClick:v,disabled:d||!x||p>3500,className:"w-full flex items-center justify-center gap-2",size:"lg",children:[d&&e.jsx(fs,{className:"w-4 h-4 animate-spin"}),e.jsx(Gs,{className:"w-4 h-4"}),d?"Consultando IA...":"Obtener descripcin"]}),d&&e.jsx($a,{className:"mt-2"})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 sm:border-l sm:border-gray-200 sm:pl-4 border-t sm:border-t-0 border-gray-200 pt-4 sm:pt-0",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Resultado"}),c&&e.jsxs($,{type:"button",size:"sm",variant:"outline",onClick:()=>{navigator.clipboard.writeText(c),bt.success("Texto copiado al portapapeles")},className:"flex items-center gap-1",children:[e.jsx(da,{className:"w-4 h-4"}),"Copiar"]})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[e.jsx(It,{readOnly:!0,value:c||(d?"Generando descripcin mejorada...":"La descripcin mejorada aparecer aqu despus de generar"),className:"flex-1 resize-none bg-gray-50 border-gray-200 min-h-0",placeholder:"La descripcin mejorada aparecer aqu..."}),c&&e.jsx("div",{className:"mt-3 flex-shrink-0",children:e.jsx($,{type:"button",className:"w-full",onClick:()=>{n(c),bt.success("Descripcin insertada"),a(!1),u("")},variant:"default",children:" Insertar en descripcin"})})]})]})]}),e.jsx("div",{className:"flex-shrink-0 mt-4 pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 text-xs text-gray-500",children:[e.jsx("span",{children:" Tip: La IA mantendr la esencia de tu tarea mientras mejora la claridad"}),!x]})})]})})]})},Bi=Lr("task"),y6=Bi?`https://generativelanguage.googleapis.com/v1beta/models/${Bi.model}:generateContent`:"",b6=({title:t,description:s,onInsert:n})=>{var w;const[r,a]=f.useState(!1),[i,o]=f.useState(""),[c,u]=f.useState(""),[d,h]=f.useState(!1),[p,g]=f.useState(0),x="AIzaSyAW4Ot-z7OH4ZR3OeaN7vcbkEDlWpo1aMY",y=((w=Bi==null?void 0:Bi.prompts)==null?void 0:w.ideas)??"Sugiere ejemplos o estrategias breves para abordar la tarea. Mximo 150 palabras.",b=Bi==null?void 0:Bi.params;f.useEffect(()=>{r&&o(`${y}
Ttulo: ${t}
Descripcin: ${s}`)},[r,t,s]),f.useEffect(()=>{g(zr(i))},[i]);const v=async()=>{var N,S,E,k,D;if(t){h(!0);try{const R=await(await fetch(`${y6}?key=${x}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:i}]}],...b})})).json(),O=(D=(k=(E=(S=(N=R==null?void 0:R.candidates)==null?void 0:N[0])==null?void 0:S.content)==null?void 0:E.parts)==null?void 0:k[0])==null?void 0:D.text;u(O||"No se pudo obtener sugerencia")}catch{u("Error al consultar la API")}finally{h(!1)}}};return e.jsxs(e.Fragment,{children:[e.jsxs($,{type:"button",variant:"outline",size:"sm",onClick:()=>a(!0),className:"flex items-center gap-2",children:[e.jsx(Gs,{className:"w-4 h-4"})," Ideas"]}),e.jsx(kt,{open:r,onOpenChange:a,children:e.jsxs(wt,{className:"w-[95vw] h-[90vh] max-w-none max-h-none overflow-hidden flex flex-col sm:w-[90vw] sm:h-[85vh]",children:[e.jsxs(At,{className:"flex-shrink-0",children:[e.jsx(_t,{className:"text-xl",children:"Ideas para la Tarea con IA"}),e.jsx(cn,{children:"La IA te sugerir ejemplos y estrategias para abordar tu tarea. Usa el panel izquierdo para editar el prompt y visualiza el resultado en el panel derecho."})]}),e.jsxs("div",{className:"flex-1 flex flex-col sm:flex-row gap-4 min-h-0 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[e.jsxs("div",{className:"flex-1 flex flex-col mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2 flex-shrink-0",children:"Prompt para IA"}),e.jsx(It,{value:i,onChange:N=>o(N.target.value),className:"flex-1 resize-none min-h-0",placeholder:"Escribe o modifica el prompt para la IA..."})]}),e.jsxs("div",{className:"flex flex-col gap-3 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"text-gray-500",children:["Tokens: ",p]}),p>3500&&e.jsx("span",{className:"text-red-500 font-medium",children:"Prompt demasiado largo!"})]}),e.jsxs($,{onClick:v,disabled:d||!x||p>3500,className:"w-full flex items-center justify-center gap-2",size:"lg",children:[d&&e.jsx(fs,{className:"w-4 h-4 animate-spin"}),e.jsx(Gs,{className:"w-4 h-4"}),d?"Consultando IA...":"Obtener ideas"]}),d&&e.jsx($a,{className:"mt-2"})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 sm:border-l sm:border-gray-200 sm:pl-4 border-t sm:border-t-0 border-gray-200 pt-4 sm:pt-0",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Resultado"}),c&&e.jsxs($,{type:"button",size:"sm",variant:"outline",onClick:()=>{navigator.clipboard.writeText(c),bt.success("Texto copiado al portapapeles")},className:"flex items-center gap-1",children:[e.jsx(da,{className:"w-4 h-4"}),"Copiar"]})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[e.jsx(It,{readOnly:!0,value:c||(d?"Generando ideas...":"Las ideas aparecern aqu despus de generar"),className:"flex-1 resize-none bg-gray-50 border-gray-200 min-h-0",placeholder:"Las ideas aparecern aqu..."}),c&&e.jsx("div",{className:"mt-3 flex-shrink-0",children:e.jsx($,{type:"button",className:"w-full",onClick:()=>{n(c),bt.success("Ideas insertadas en descripcin"),a(!1),u("")},variant:"default",children:" Insertar en descripcin"})})]})]})]}),e.jsx("div",{className:"flex-shrink-0 mt-4 pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 text-xs text-gray-500",children:[e.jsx("span",{children:" Tip: S especfico sobre el contexto de tu tarea para mejores ideas"}),!x]})})]})})]})};function j6(t){if(typeof document>"u")return;let s=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",s.appendChild(n),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}const PC=ee.createContext({drawerRef:{current:null},overlayRef:{current:null},onPress:()=>{},onRelease:()=>{},onDrag:()=>{},onNestedDrag:()=>{},onNestedOpenChange:()=>{},onNestedRelease:()=>{},openProp:void 0,dismissible:!1,isOpen:!1,isDragging:!1,keyboardIsOpen:{current:!1},snapPointsOffset:null,snapPoints:null,handleOnly:!1,modal:!1,shouldFade:!1,activeSnapPoint:null,onOpenChange:()=>{},setActiveSnapPoint:()=>{},closeDrawer:()=>{},direction:"bottom",shouldScaleBackground:!1,setBackgroundColorOnScale:!0,noBodyStyles:!1,container:null,autoFocus:!1}),Ed=()=>{const t=ee.useContext(PC);if(!t)throw new Error("useDrawerContext must be used within a Drawer.Root");return t};j6(`[data-vaul-drawer]{touch-action:none;will-change:transform;transition:transform .5s cubic-bezier(.32, .72, 0, 1);animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=open]{animation-name:slideFromBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=closed]{animation-name:slideToBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=open]{animation-name:slideFromTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=closed]{animation-name:slideToTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=open]{animation-name:slideFromLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=closed]{animation-name:slideToLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=open]{animation-name:slideFromRight}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=closed]{animation-name:slideToRight}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,100%,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,-100%,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(-100%,0,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(100%,0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-overlay][data-vaul-snap-points=false]{animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-overlay][data-vaul-snap-points=false][data-state=open]{animation-name:fadeIn}[data-vaul-overlay][data-state=closed]{animation-name:fadeOut}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:0;transition:opacity .5s cubic-bezier(.32, .72, 0, 1)}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:1}[data-vaul-drawer]:not([data-vaul-custom-container=true])::after{content:'';position:absolute;background:inherit;background-color:inherit}[data-vaul-drawer][data-vaul-drawer-direction=top]::after{top:initial;bottom:100%;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=bottom]::after{top:100%;bottom:initial;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=left]::after{left:initial;right:100%;top:0;bottom:0;width:200%}[data-vaul-drawer][data-vaul-drawer-direction=right]::after{left:100%;right:initial;top:0;bottom:0;width:200%}[data-vaul-overlay][data-vaul-snap-points=true]:not([data-vaul-snap-points-overlay=true]):not(
[data-state=closed]
){opacity:0}[data-vaul-overlay][data-vaul-snap-points-overlay=true]{opacity:1}[data-vaul-handle]{display:block;position:relative;opacity:.7;background:#e2e2e4;margin-left:auto;margin-right:auto;height:5px;width:32px;border-radius:1rem;touch-action:pan-y}[data-vaul-handle]:active,[data-vaul-handle]:hover{opacity:1}[data-vaul-handle-hitarea]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:max(100%,2.75rem);height:max(100%,2.75rem);touch-action:inherit}@media (hover:hover) and (pointer:fine){[data-vaul-drawer]{user-select:none}}@media (pointer:fine){[data-vaul-handle-hitarea]:{width:100%;height:100%}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{to{opacity:0}}@keyframes slideFromBottom{from{transform:translate3d(0,100%,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToBottom{to{transform:translate3d(0,100%,0)}}@keyframes slideFromTop{from{transform:translate3d(0,-100%,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToTop{to{transform:translate3d(0,-100%,0)}}@keyframes slideFromLeft{from{transform:translate3d(-100%,0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToLeft{to{transform:translate3d(-100%,0,0)}}@keyframes slideFromRight{from{transform:translate3d(100%,0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToRight{to{transform:translate3d(100%,0,0)}}`);const w6=24,N6=typeof window<"u"?f.useLayoutEffect:f.useEffect;function ib(...t){return(...s)=>{for(let n of t)typeof n=="function"&&n(...s)}}function S6(){return Kx(/^Mac/)}function C6(){return Kx(/^iPhone/)}function ob(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function E6(){return Kx(/^iPad/)||S6()&&navigator.maxTouchPoints>1}function MC(){return C6()||E6()}function Kx(t){return typeof window<"u"&&window.navigator!=null?t.test(window.navigator.platform):void 0}const Ff=typeof document<"u"&&window.visualViewport;function lb(t){let s=window.getComputedStyle(t);return/(auto|scroll)/.test(s.overflow+s.overflowX+s.overflowY)}function IC(t){for(lb(t)&&(t=t.parentElement);t&&!lb(t);)t=t.parentElement;return t||document.scrollingElement||document.documentElement}const T6=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);let Pu=0,Bf;function D6(t={}){let{isDisabled:s}=t;N6(()=>{if(!s)return Pu++,Pu===1&&MC()&&(Bf=k6()),()=>{Pu--,Pu===0&&(Bf==null||Bf())}},[s])}function k6(){let t,s=0,n=p=>{t=IC(p.target),!(t===document.documentElement&&t===document.body)&&(s=p.changedTouches[0].pageY)},r=p=>{if(!t||t===document.documentElement||t===document.body){p.preventDefault();return}let g=p.changedTouches[0].pageY,x=t.scrollTop,y=t.scrollHeight-t.clientHeight;y!==0&&((x<=0&&g>s||x>=y&&g<s)&&p.preventDefault(),s=g)},a=p=>{let g=p.target;Lp(g)&&g!==document.activeElement&&(p.preventDefault(),g.style.transform="translateY(-2000px)",g.focus(),requestAnimationFrame(()=>{g.style.transform=""}))},i=p=>{let g=p.target;Lp(g)&&(g.style.transform="translateY(-2000px)",requestAnimationFrame(()=>{g.style.transform="",Ff&&(Ff.height<window.innerHeight?requestAnimationFrame(()=>{cb(g)}):Ff.addEventListener("resize",()=>cb(g),{once:!0}))}))},o=()=>{window.scrollTo(0,0)},c=window.pageXOffset,u=window.pageYOffset,d=ib(A6(document.documentElement,"paddingRight",`${window.innerWidth-document.documentElement.clientWidth}px`));window.scrollTo(0,0);let h=ib(kc(document,"touchstart",n,{passive:!1,capture:!0}),kc(document,"touchmove",r,{passive:!1,capture:!0}),kc(document,"touchend",a,{passive:!1,capture:!0}),kc(document,"focus",i,!0),kc(window,"scroll",o));return()=>{d(),h(),window.scrollTo(c,u)}}function A6(t,s,n){let r=t.style[s];return t.style[s]=n,()=>{t.style[s]=r}}function kc(t,s,n,r){return t.addEventListener(s,n,r),()=>{t.removeEventListener(s,n,r)}}function cb(t){let s=document.scrollingElement||document.documentElement;for(;t&&t!==s;){let n=IC(t);if(n!==document.documentElement&&n!==document.body&&n!==t){let r=n.getBoundingClientRect().top,a=t.getBoundingClientRect().top,i=t.getBoundingClientRect().bottom;const o=n.getBoundingClientRect().bottom+w6;i>o&&(n.scrollTop+=a-r)}t=n.parentElement}}function Lp(t){return t instanceof HTMLInputElement&&!T6.has(t.type)||t instanceof HTMLTextAreaElement||t instanceof HTMLElement&&t.isContentEditable}function _6(t,s){typeof t=="function"?t(s):t!=null&&(t.current=s)}function R6(...t){return s=>t.forEach(n=>_6(n,s))}function LC(...t){return f.useCallback(R6(...t),t)}const $C=new WeakMap;function an(t,s,n=!1){if(!t||!(t instanceof HTMLElement))return;let r={};Object.entries(s).forEach(([a,i])=>{if(a.startsWith("--")){t.style.setProperty(a,i);return}r[a]=t.style[a],t.style[a]=i}),!n&&$C.set(t,r)}function O6(t,s){if(!t||!(t instanceof HTMLElement))return;let n=$C.get(t);n&&(t.style[s]=n[s])}const on=t=>{switch(t){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return t}};function Mu(t,s){if(!t)return null;const n=window.getComputedStyle(t),r=n.transform||n.webkitTransform||n.mozTransform;let a=r.match(/^matrix3d\((.+)\)$/);return a?parseFloat(a[1].split(", ")[on(s)?13:12]):(a=r.match(/^matrix\((.+)\)$/),a?parseFloat(a[1].split(", ")[on(s)?5:4]):null)}function P6(t){return 8*(Math.log(t+1)-2)}function Hf(t,s){if(!t)return()=>{};const n=t.style.cssText;return Object.assign(t.style,s),()=>{t.style.cssText=n}}function M6(...t){return(...s)=>{for(const n of t)typeof n=="function"&&n(...s)}}const As={DURATION:.5,EASE:[.32,.72,0,1]},zC=.4,I6=.25,L6=100,FC=8,ko=16,$p=26,Uf="vaul-dragging";function BC(t){const s=ee.useRef(t);return ee.useEffect(()=>{s.current=t}),ee.useMemo(()=>(...n)=>s.current==null?void 0:s.current.call(s,...n),[])}function $6({defaultProp:t,onChange:s}){const n=ee.useState(t),[r]=n,a=ee.useRef(r),i=BC(s);return ee.useEffect(()=>{a.current!==r&&(i(r),a.current=r)},[r,a,i]),n}function HC({prop:t,defaultProp:s,onChange:n=()=>{}}){const[r,a]=$6({defaultProp:s,onChange:n}),i=t!==void 0,o=i?t:r,c=BC(n),u=ee.useCallback(d=>{if(i){const p=typeof d=="function"?d(t):d;p!==t&&c(p)}else a(d)},[i,t,a,c]);return[o,u]}function z6({activeSnapPointProp:t,setActiveSnapPointProp:s,snapPoints:n,drawerRef:r,overlayRef:a,fadeFromIndex:i,onSnapPointChange:o,direction:c="bottom",container:u,snapToSequentialPoint:d}){const[h,p]=HC({prop:t,defaultProp:n==null?void 0:n[0],onChange:s}),[g,x]=ee.useState(typeof window<"u"?{innerWidth:window.innerWidth,innerHeight:window.innerHeight}:void 0);ee.useEffect(()=>{function T(){x({innerWidth:window.innerWidth,innerHeight:window.innerHeight})}return window.addEventListener("resize",T),()=>window.removeEventListener("resize",T)},[]);const y=ee.useMemo(()=>h===(n==null?void 0:n[n.length-1])||null,[n,h]),b=ee.useMemo(()=>n==null?void 0:n.findIndex(T=>T===h),[n,h]),v=n&&n.length>0&&(i||i===0)&&!Number.isNaN(i)&&n[i]===h||!n,w=ee.useMemo(()=>{const T=u?{width:u.getBoundingClientRect().width,height:u.getBoundingClientRect().height}:typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0};var R;return(R=n==null?void 0:n.map(O=>{const U=typeof O=="string";let I=0;if(U&&(I=parseInt(O,10)),on(c)){const M=U?I:g?O*T.height:0;return g?c==="bottom"?T.height-M:-T.height+M:M}const _=U?I:g?O*T.width:0;return g?c==="right"?T.width-_:-T.width+_:_}))!=null?R:[]},[n,g,u]),N=ee.useMemo(()=>b!==null?w==null?void 0:w[b]:null,[w,b]),S=ee.useCallback(T=>{var R;const O=(R=w==null?void 0:w.findIndex(U=>U===T))!=null?R:null;o(O),an(r.current,{transition:`transform ${As.DURATION}s cubic-bezier(${As.EASE.join(",")})`,transform:on(c)?`translate3d(0, ${T}px, 0)`:`translate3d(${T}px, 0, 0)`}),w&&O!==w.length-1&&O!==i&&O<i?an(a.current,{transition:`opacity ${As.DURATION}s cubic-bezier(${As.EASE.join(",")})`,opacity:"0"}):an(a.current,{transition:`opacity ${As.DURATION}s cubic-bezier(${As.EASE.join(",")})`,opacity:"1"}),p(n==null?void 0:n[Math.max(O,0)])},[r.current,n,w,i,a,p]);ee.useEffect(()=>{if(h||t){var T;const R=(T=n==null?void 0:n.findIndex(O=>O===t||O===h))!=null?T:-1;w&&R!==-1&&typeof w[R]=="number"&&S(w[R])}},[h,t,n,w,S]);function E({draggedDistance:T,closeDrawer:R,velocity:O,dismissible:U}){if(i===void 0)return;const I=c==="bottom"||c==="right"?(N??0)-T:(N??0)+T,_=b===i-1,M=b===0,W=T>0;if(_&&an(a.current,{transition:`opacity ${As.DURATION}s cubic-bezier(${As.EASE.join(",")})`}),!d&&O>2&&!W){U?R():S(w[0]);return}if(!d&&O>2&&W&&w&&n){S(w[n.length-1]);return}const B=w==null?void 0:w.reduce((z,G)=>typeof z!="number"||typeof G!="number"?z:Math.abs(G-I)<Math.abs(z-I)?G:z),P=on(c)?window.innerHeight:window.innerWidth;if(O>zC&&Math.abs(T)<P*.4){const z=W?1:-1;if(z>0&&y){S(w[n.length-1]);return}if(M&&z<0&&U&&R(),b===null)return;S(w[b+z]);return}S(B)}function k({draggedDistance:T}){if(N===null)return;const R=c==="bottom"||c==="right"?N-T:N+T;(c==="bottom"||c==="right")&&R<w[w.length-1]||(c==="top"||c==="left")&&R>w[w.length-1]||an(r.current,{transform:on(c)?`translate3d(0, ${R}px, 0)`:`translate3d(${R}px, 0, 0)`})}function D(T,R){if(!n||typeof b!="number"||!w||i===void 0)return null;const O=b===i-1;if(b>=i&&R)return 0;if(O&&!R)return 1;if(!v&&!O)return null;const I=O?b+1:b-1,_=O?w[I]-w[I-1]:w[I+1]-w[I],M=T/Math.abs(_);return O?1-M:M}return{isLastSnapPoint:y,activeSnapPoint:h,shouldFade:v,getPercentageDragged:D,setActiveSnapPoint:p,activeSnapPointIndex:b,onRelease:E,onDrag:k,snapPointsOffset:w}}const F6=()=>()=>{};function B6(){const{direction:t,isOpen:s,shouldScaleBackground:n,setBackgroundColorOnScale:r,noBodyStyles:a}=Ed(),i=ee.useRef(null),o=f.useMemo(()=>document.body.style.backgroundColor,[]);function c(){return(window.innerWidth-$p)/window.innerWidth}ee.useEffect(()=>{if(s&&n){i.current&&clearTimeout(i.current);const u=document.querySelector("[data-vaul-drawer-wrapper]")||document.querySelector("[vaul-drawer-wrapper]");if(!u)return;M6(r&&!a?Hf(document.body,{background:"black"}):F6,Hf(u,{transformOrigin:on(t)?"top":"left",transitionProperty:"transform, border-radius",transitionDuration:`${As.DURATION}s`,transitionTimingFunction:`cubic-bezier(${As.EASE.join(",")})`}));const d=Hf(u,{borderRadius:`${FC}px`,overflow:"hidden",...on(t)?{transform:`scale(${c()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`}:{transform:`scale(${c()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`}});return()=>{d(),i.current=window.setTimeout(()=>{o?document.body.style.background=o:document.body.style.removeProperty("background")},As.DURATION*1e3)}}},[s,n,o])}let Ac=null;function H6({isOpen:t,modal:s,nested:n,hasBeenOpened:r,preventScrollRestoration:a,noBodyStyles:i}){const[o,c]=ee.useState(()=>typeof window<"u"?window.location.href:""),u=ee.useRef(0),d=ee.useCallback(()=>{if(ob()&&Ac===null&&t&&!i){Ac={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:p,innerHeight:g}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:`${-u.current}px`,left:`${-p}px`,right:"0px",height:"auto"}),window.setTimeout(()=>window.requestAnimationFrame(()=>{const x=g-window.innerHeight;x&&u.current>=g&&(document.body.style.top=`${-(u.current+x)}px`)}),300)}},[t]),h=ee.useCallback(()=>{if(ob()&&Ac!==null&&!i){const p=-parseInt(document.body.style.top,10),g=-parseInt(document.body.style.left,10);Object.assign(document.body.style,Ac),window.requestAnimationFrame(()=>{if(a&&o!==window.location.href){c(window.location.href);return}window.scrollTo(g,p)}),Ac=null}},[o]);return ee.useEffect(()=>{function p(){u.current=window.scrollY}return p(),window.addEventListener("scroll",p),()=>{window.removeEventListener("scroll",p)}},[]),ee.useEffect(()=>{n||!r||(t?(!window.matchMedia("(display-mode: standalone)").matches&&d(),s||window.setTimeout(()=>{h()},500)):h())},[t,r,o,s,n,d,h]),{restorePositionSetting:h}}function U6({open:t,onOpenChange:s,children:n,onDrag:r,onRelease:a,snapPoints:i,shouldScaleBackground:o=!1,setBackgroundColorOnScale:c=!0,closeThreshold:u=I6,scrollLockTimeout:d=L6,dismissible:h=!0,handleOnly:p=!1,fadeFromIndex:g=i&&i.length-1,activeSnapPoint:x,setActiveSnapPoint:y,fixed:b,modal:v=!0,onClose:w,nested:N,noBodyStyles:S,direction:E="bottom",defaultOpen:k=!1,disablePreventScroll:D=!0,snapToSequentialPoint:T=!1,preventScrollRestoration:R=!1,repositionInputs:O=!0,onAnimationEnd:U,container:I,autoFocus:_=!1}){var M,W;const[B=!1,P]=HC({defaultProp:k,prop:t,onChange:Ve=>{s==null||s(Ve),!Ve&&!N&&Re(),setTimeout(()=>{U==null||U(Ve)},As.DURATION*1e3),Ve&&!v&&typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),Ve||(document.body.style.pointerEvents="auto")}}),[z,G]=ee.useState(!1),[ae,Y]=ee.useState(!1),[X,se]=ee.useState(!1),H=ee.useRef(null),ie=ee.useRef(null),fe=ee.useRef(null),le=ee.useRef(null),K=ee.useRef(null),de=ee.useRef(!1),je=ee.useRef(null),ge=ee.useRef(0),Se=ee.useRef(!1),oe=ee.useRef(0),J=ee.useRef(null),ye=ee.useRef(((M=J.current)==null?void 0:M.getBoundingClientRect().height)||0),xt=ee.useRef(((W=J.current)==null?void 0:W.getBoundingClientRect().width)||0),gt=ee.useRef(0),dt=ee.useCallback(Ve=>{i&&Ve===me.length-1&&(ie.current=new Date)},[]),{activeSnapPoint:qs,activeSnapPointIndex:Ss,setActiveSnapPoint:q,onRelease:ne,snapPointsOffset:me,onDrag:Te,shouldFade:Ee,getPercentageDragged:Ne}=z6({snapPoints:i,activeSnapPointProp:x,setActiveSnapPointProp:y,drawerRef:J,fadeFromIndex:g,overlayRef:H,onSnapPointChange:dt,direction:E,container:I,snapToSequentialPoint:T});D6({isDisabled:!B||ae||!v||X||!z||!O||!D});const{restorePositionSetting:Re}=H6({isOpen:B,modal:v,nested:N,hasBeenOpened:z,preventScrollRestoration:R,noBodyStyles:S});function qe(){return(window.innerWidth-$p)/window.innerWidth}function st(Ve){var ut,Nt;!h&&!i||J.current&&!J.current.contains(Ve.target)||(ye.current=((ut=J.current)==null?void 0:ut.getBoundingClientRect().height)||0,xt.current=((Nt=J.current)==null?void 0:Nt.getBoundingClientRect().width)||0,Y(!0),fe.current=new Date,MC()&&window.addEventListener("touchend",()=>de.current=!1,{once:!0}),Ve.target.setPointerCapture(Ve.pointerId),ge.current=on(E)?Ve.pageY:Ve.pageX)}function es(Ve,ut){var Nt,Ut;let Ge=Ve;const ft=(Nt=window.getSelection())==null?void 0:Nt.toString(),Lt=J.current?Mu(J.current,E):null,_e=new Date;if(Ge.hasAttribute("data-vaul-no-drag")||Ge.closest("[data-vaul-no-drag]"))return!1;if(E==="right"||E==="left")return!0;if(ie.current&&_e.getTime()-ie.current.getTime()<500)return!1;if(Lt!==null&&(E==="bottom"?Lt>0:Lt<0))return!0;if(ft&&ft.length>0)return!1;if(_e.getTime()-((Ut=K.current)==null?void 0:Ut.getTime())<d&&Lt===0||ut)return K.current=_e,!1;for(;Ge;){if(Ge.scrollHeight>Ge.clientHeight){if(Ge.scrollTop!==0)return K.current=new Date,!1;if(Ge.getAttribute("role")==="dialog")return!0}Ge=Ge.parentNode}return!0}function Os(Ve){if(J.current&&ae){const ut=E==="bottom"||E==="right"?1:-1,Nt=(ge.current-(on(E)?Ve.pageY:Ve.pageX))*ut,Ut=Nt>0,Ge=i&&!h&&!Ut;if(Ge&&Ss===0)return;const ft=Math.abs(Nt),Lt=document.querySelector("[data-vaul-drawer-wrapper]"),_e=E==="bottom"||E==="top"?ye.current:xt.current;let Be=ft/_e;const Xe=Ne(ft,Ut);if(Xe!==null&&(Be=Xe),Ge&&Be>=1||!de.current&&!es(Ve.target,Ut))return;if(J.current.classList.add(Uf),de.current=!0,an(J.current,{transition:"none"}),an(H.current,{transition:"none"}),i&&Te({draggedDistance:Nt}),Ut&&!i){const $t=P6(Nt),Ot=Math.min($t*-1,0)*ut;an(J.current,{transform:on(E)?`translate3d(0, ${Ot}px, 0)`:`translate3d(${Ot}px, 0, 0)`});return}const Rt=1-Be;if((Ee||g&&Ss===g-1)&&(r==null||r(Ve,Be),an(H.current,{opacity:`${Rt}`,transition:"none"},!0)),Lt&&H.current&&o){const $t=Math.min(qe()+Be*(1-qe()),1),Ot=8-Be*8,xs=Math.max(0,14-Be*14);an(Lt,{borderRadius:`${Ot}px`,transform:on(E)?`scale(${$t}) translate3d(0, ${xs}px, 0)`:`scale(${$t}) translate3d(${xs}px, 0, 0)`,transition:"none"},!0)}if(!i){const $t=ft*ut;an(J.current,{transform:on(E)?`translate3d(0, ${$t}px, 0)`:`translate3d(${$t}px, 0, 0)`})}}}ee.useEffect(()=>{var Ve;function ut(){if(!J.current||!O)return;const Nt=document.activeElement;if(Lp(Nt)||Se.current){var Ut;const Ge=((Ut=window.visualViewport)==null?void 0:Ut.height)||0,ft=window.innerHeight;let Lt=ft-Ge;const _e=J.current.getBoundingClientRect().height||0,Be=_e>ft*.8;gt.current||(gt.current=_e);const Xe=J.current.getBoundingClientRect().top;if(Math.abs(oe.current-Lt)>60&&(Se.current=!Se.current),i&&i.length>0&&me&&Ss){const Rt=me[Ss]||0;Lt+=Rt}if(oe.current=Lt,_e>Ge||Se.current){const Rt=J.current.getBoundingClientRect().height;let $t=Rt;Rt>Ge&&($t=Ge-(Be?Xe:$p)),b?J.current.style.height=`${Rt-Math.max(Lt,0)}px`:J.current.style.height=`${Math.max($t,Ge-Xe)}px`}else J.current.style.height=`${gt.current}px`;i&&i.length>0&&!Se.current?J.current.style.bottom="0px":J.current.style.bottom=`${Math.max(Lt,0)}px`}}return(Ve=window.visualViewport)==null||Ve.addEventListener("resize",ut),()=>{var Nt;return(Nt=window.visualViewport)==null?void 0:Nt.removeEventListener("resize",ut)}},[Ss,i,me]);function qt(Ve){Ks(),w==null||w(),Ve||P(!1),setTimeout(()=>{i&&q(i[0])},As.DURATION*1e3)}function tn(){if(!J.current)return;const Ve=document.querySelector("[data-vaul-drawer-wrapper]"),ut=Mu(J.current,E);an(J.current,{transform:"translate3d(0, 0, 0)",transition:`transform ${As.DURATION}s cubic-bezier(${As.EASE.join(",")})`}),an(H.current,{transition:`opacity ${As.DURATION}s cubic-bezier(${As.EASE.join(",")})`,opacity:"1"}),o&&ut&&ut>0&&B&&an(Ve,{borderRadius:`${FC}px`,overflow:"hidden",...on(E)?{transform:`scale(${qe()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${qe()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${As.DURATION}s`,transitionTimingFunction:`cubic-bezier(${As.EASE.join(",")})`},!0)}function Ks(){!ae||!J.current||(J.current.classList.remove(Uf),de.current=!1,Y(!1),le.current=new Date)}function ds(Ve){if(!ae||!J.current)return;J.current.classList.remove(Uf),de.current=!1,Y(!1),le.current=new Date;const ut=Mu(J.current,E);if(!es(Ve.target,!1)||!ut||Number.isNaN(ut)||fe.current===null)return;const Nt=le.current.getTime()-fe.current.getTime(),Ut=ge.current-(on(E)?Ve.pageY:Ve.pageX),Ge=Math.abs(Ut)/Nt;if(Ge>.05&&(se(!0),setTimeout(()=>{se(!1)},200)),i){ne({draggedDistance:Ut*(E==="bottom"||E==="right"?1:-1),closeDrawer:qt,velocity:Ge,dismissible:h}),a==null||a(Ve,!0);return}if(E==="bottom"||E==="right"?Ut>0:Ut<0){tn(),a==null||a(Ve,!0);return}if(Ge>zC){qt(),a==null||a(Ve,!1);return}var ft;const Lt=Math.min((ft=J.current.getBoundingClientRect().height)!=null?ft:0,window.innerHeight);var _e;const Be=Math.min((_e=J.current.getBoundingClientRect().width)!=null?_e:0,window.innerWidth),Xe=E==="left"||E==="right";if(Math.abs(ut)>=(Xe?Be:Lt)*u){qt(),a==null||a(Ve,!1);return}a==null||a(Ve,!0),tn()}ee.useEffect(()=>(B&&(an(document.documentElement,{scrollBehavior:"auto"}),ie.current=new Date),()=>{O6(document.documentElement,"scrollBehavior")}),[B]);function zs(Ve){const ut=Ve?(window.innerWidth-ko)/window.innerWidth:1,Nt=Ve?-ko:0;je.current&&window.clearTimeout(je.current),an(J.current,{transition:`transform ${As.DURATION}s cubic-bezier(${As.EASE.join(",")})`,transform:`scale(${ut}) translate3d(0, ${Nt}px, 0)`}),!Ve&&J.current&&(je.current=setTimeout(()=>{const Ut=Mu(J.current,E);an(J.current,{transition:"none",transform:on(E)?`translate3d(0, ${Ut}px, 0)`:`translate3d(${Ut}px, 0, 0)`})},500))}function Ps(Ve,ut){if(ut<0)return;const Nt=(window.innerWidth-ko)/window.innerWidth,Ut=Nt+ut*(1-Nt),Ge=-ko+ut*ko;an(J.current,{transform:on(E)?`scale(${Ut}) translate3d(0, ${Ge}px, 0)`:`scale(${Ut}) translate3d(${Ge}px, 0, 0)`,transition:"none"})}function $n(Ve,ut){const Nt=on(E)?window.innerHeight:window.innerWidth,Ut=ut?(Nt-ko)/Nt:1,Ge=ut?-ko:0;ut&&an(J.current,{transition:`transform ${As.DURATION}s cubic-bezier(${As.EASE.join(",")})`,transform:on(E)?`scale(${Ut}) translate3d(0, ${Ge}px, 0)`:`scale(${Ut}) translate3d(${Ge}px, 0, 0)`})}return ee.createElement(km,{defaultOpen:k,onOpenChange:Ve=>{!h&&!Ve||(Ve?G(!0):qt(!0),P(Ve))},open:B},ee.createElement(PC.Provider,{value:{activeSnapPoint:qs,snapPoints:i,setActiveSnapPoint:q,drawerRef:J,overlayRef:H,onOpenChange:s,onPress:st,onRelease:ds,onDrag:Os,dismissible:h,handleOnly:p,isOpen:B,isDragging:ae,shouldFade:Ee,closeDrawer:qt,onNestedDrag:Ps,onNestedOpenChange:zs,onNestedRelease:$n,keyboardIsOpen:Se,modal:v,snapPointsOffset:me,direction:E,shouldScaleBackground:o,setBackgroundColorOnScale:c,noBodyStyles:S,container:I,autoFocus:_}},n))}const UC=ee.forwardRef(function({...t},s){const{overlayRef:n,snapPoints:r,onRelease:a,shouldFade:i,isOpen:o,modal:c}=Ed(),u=LC(s,n),d=r&&r.length>0;return c?ee.createElement(Rl,{onMouseUp:a,ref:u,"data-vaul-overlay":"","data-vaul-snap-points":o&&d?"true":"false","data-vaul-snap-points-overlay":o&&i?"true":"false",...t}):(typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),null)});UC.displayName="Drawer.Overlay";const WC=ee.forwardRef(function({onPointerDownOutside:t,style:s,onOpenAutoFocus:n,...r},a){const{drawerRef:i,onPress:o,onRelease:c,onDrag:u,keyboardIsOpen:d,snapPointsOffset:h,modal:p,isOpen:g,direction:x,snapPoints:y,container:b,handleOnly:v,autoFocus:w}=Ed(),[N,S]=ee.useState(!1),E=LC(a,i),k=ee.useRef(null),D=ee.useRef(null),T=ee.useRef(!1),R=y&&y.length>0;B6();const O=(I,_,M=0)=>{if(T.current)return!0;const W=Math.abs(I.y),B=Math.abs(I.x),P=B>W,z=["bottom","right"].includes(_)?1:-1;if(_==="left"||_==="right"){if(!(I.x*z<0)&&B>=0&&B<=M)return P}else if(!(I.y*z<0)&&W>=0&&W<=M)return!P;return T.current=!0,!0};ee.useEffect(()=>{R&&window.requestAnimationFrame(()=>{S(!0)})},[]);function U(I){k.current=null,T.current=!1,c(I)}return ee.createElement(Ol,{"data-vaul-drawer-direction":x,"data-vaul-drawer":"","data-vaul-delayed-snap-points":N?"true":"false","data-vaul-snap-points":g&&R?"true":"false","data-vaul-custom-container":b?"true":"false",...r,ref:E,style:h&&h.length>0?{"--snap-point-height":`${h[0]}px`,...s}:s,onPointerDown:I=>{v||(r.onPointerDown==null||r.onPointerDown.call(r,I),k.current={x:I.pageX,y:I.pageY},o(I))},onOpenAutoFocus:I=>{n==null||n(I),w||I.preventDefault()},onPointerDownOutside:I=>{if(t==null||t(I),!p||I.defaultPrevented){I.preventDefault();return}d.current&&(d.current=!1)},onFocusOutside:I=>{if(!p){I.preventDefault();return}},onPointerMove:I=>{if(D.current=I,v||(r.onPointerMove==null||r.onPointerMove.call(r,I),!k.current))return;const _=I.pageY-k.current.y,M=I.pageX-k.current.x,W=I.pointerType==="touch"?10:2;O({x:M,y:_},x,W)?u(I):(Math.abs(M)>W||Math.abs(_)>W)&&(k.current=null)},onPointerUp:I=>{r.onPointerUp==null||r.onPointerUp.call(r,I),k.current=null,T.current=!1,c(I)},onPointerOut:I=>{r.onPointerOut==null||r.onPointerOut.call(r,I),U(D.current)},onContextMenu:I=>{r.onContextMenu==null||r.onContextMenu.call(r,I),U(D.current)}})});WC.displayName="Drawer.Content";const W6=250,Y6=120,V6=ee.forwardRef(function({preventCycle:t=!1,children:s,...n},r){const{closeDrawer:a,isDragging:i,snapPoints:o,activeSnapPoint:c,setActiveSnapPoint:u,dismissible:d,handleOnly:h,isOpen:p,onPress:g,onDrag:x}=Ed(),y=ee.useRef(null),b=ee.useRef(!1);function v(){if(b.current){S();return}window.setTimeout(()=>{w()},Y6)}function w(){if(i||t||b.current){S();return}if(S(),(!o||o.length===0)&&d){a();return}if(c===o[o.length-1]&&d){a();return}const k=o.findIndex(T=>T===c);if(k===-1)return;const D=o[k+1];u(D)}function N(){y.current=window.setTimeout(()=>{b.current=!0},W6)}function S(){window.clearTimeout(y.current),b.current=!1}return ee.createElement("div",{onClick:v,onPointerCancel:S,onPointerDown:E=>{h&&g(E),N()},onPointerMove:E=>{h&&x(E)},ref:r,"data-vaul-drawer-visible":p?"true":"false","data-vaul-handle":"","aria-hidden":"true",...n},ee.createElement("span",{"data-vaul-handle-hitarea":"","aria-hidden":"true"},s))});V6.displayName="Drawer.Handle";function G6(t){const s=Ed(),{container:n=s.container,...r}=t;return ee.createElement(Dm,{container:n,...r})}const ja={Root:U6,Content:WC,Overlay:UC,Trigger:Am,Portal:G6,Close:ud,Title:Pl,Description:Ml},Jx=({shouldScaleBackground:t=!0,...s})=>e.jsx(ja.Root,{shouldScaleBackground:t,...s});Jx.displayName="Drawer";const YC=ja.Trigger,q6=ja.Portal,VC=ja.Close,GC=f.forwardRef(({className:t,...s},n)=>e.jsx(ja.Overlay,{ref:n,className:ce("fixed inset-0 z-50 bg-black/80",t),...s}));GC.displayName=ja.Overlay.displayName;const Xx=f.forwardRef(({className:t,children:s,...n},r)=>e.jsxs(q6,{children:[e.jsx(GC,{}),e.jsxs(ja.Content,{ref:r,className:ce("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",t),...n,children:[e.jsx("div",{className:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"}),s]})]}));Xx.displayName="DrawerContent";const Zx=({className:t,...s})=>e.jsx("div",{className:ce("grid gap-1.5 p-4 text-center sm:text-left",t),...s});Zx.displayName="DrawerHeader";const Qx=({className:t,...s})=>e.jsx("div",{className:ce("mt-auto flex flex-col gap-2 p-4",t),...s});Qx.displayName="DrawerFooter";const eg=f.forwardRef(({className:t,...s},n)=>e.jsx(ja.Title,{ref:n,className:ce("text-lg font-semibold leading-none tracking-tight",t),...s}));eg.displayName=ja.Title.displayName;const tg=f.forwardRef(({className:t,...s},n)=>e.jsx(ja.Description,{ref:n,className:ce("text-sm text-muted-foreground",t),...s}));tg.displayName=ja.Description.displayName;var nh="Popover",[qC,gY]=za(nh,[Al]),Td=Al(),[K6,fo]=qC(nh),KC=t=>{const{__scopePopover:s,children:n,open:r,defaultOpen:a,onOpenChange:i,modal:o=!1}=t,c=Td(s),u=f.useRef(null),[d,h]=f.useState(!1),[p,g]=Oa({prop:r,defaultProp:a??!1,onChange:i,caller:nh});return e.jsx(Qp,{...c,children:e.jsx(K6,{scope:s,contentId:_l(),triggerRef:u,open:p,onOpenChange:g,onOpenToggle:f.useCallback(()=>g(x=>!x),[g]),hasCustomAnchor:d,onCustomAnchorAdd:f.useCallback(()=>h(!0),[]),onCustomAnchorRemove:f.useCallback(()=>h(!1),[]),modal:o,children:n})})};KC.displayName=nh;var JC="PopoverAnchor",J6=f.forwardRef((t,s)=>{const{__scopePopover:n,...r}=t,a=fo(JC,n),i=Td(n),{onCustomAnchorAdd:o,onCustomAnchorRemove:c}=a;return f.useEffect(()=>(o(),()=>c()),[o,c]),e.jsx(Tm,{...i,...r,ref:s})});J6.displayName=JC;var XC="PopoverTrigger",ZC=f.forwardRef((t,s)=>{const{__scopePopover:n,...r}=t,a=fo(XC,n),i=Td(n),o=bs(s,a.triggerRef),c=e.jsx(jt.button,{type:"button","aria-haspopup":"dialog","aria-expanded":a.open,"aria-controls":a.contentId,"data-state":n1(a.open),...r,ref:o,onClick:it(t.onClick,a.onOpenToggle)});return a.hasCustomAnchor?c:e.jsx(Tm,{asChild:!0,...i,children:c})});ZC.displayName=XC;var sg="PopoverPortal",[X6,Z6]=qC(sg,{forceMount:void 0}),QC=t=>{const{__scopePopover:s,forceMount:n,children:r,container:a}=t,i=fo(sg,s);return e.jsx(X6,{scope:s,forceMount:n,children:e.jsx(gi,{present:n||i.open,children:e.jsx(Ej,{asChild:!0,container:a,children:r})})})};QC.displayName=sg;var kl="PopoverContent",e1=f.forwardRef((t,s)=>{const n=Z6(kl,t.__scopePopover),{forceMount:r=n.forceMount,...a}=t,i=fo(kl,t.__scopePopover);return e.jsx(gi,{present:r||i.open,children:i.modal?e.jsx(eF,{...a,ref:s}):e.jsx(tF,{...a,ref:s})})});e1.displayName=kl;var Q6=Aj("PopoverContent.RemoveScroll"),eF=f.forwardRef((t,s)=>{const n=fo(kl,t.__scopePopover),r=f.useRef(null),a=bs(s,r),i=f.useRef(!1);return f.useEffect(()=>{const o=r.current;if(o)return Tj(o)},[]),e.jsx(kj,{as:Q6,allowPinchZoom:!0,children:e.jsx(t1,{...t,ref:a,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:it(t.onCloseAutoFocus,o=>{var c;o.preventDefault(),i.current||(c=n.triggerRef.current)==null||c.focus()}),onPointerDownOutside:it(t.onPointerDownOutside,o=>{const c=o.detail.originalEvent,u=c.button===0&&c.ctrlKey===!0,d=c.button===2||u;i.current=d},{checkForDefaultPrevented:!1}),onFocusOutside:it(t.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1})})})}),tF=f.forwardRef((t,s)=>{const n=fo(kl,t.__scopePopover),r=f.useRef(!1),a=f.useRef(!1);return e.jsx(t1,{...t,ref:s,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{var o,c;(o=t.onCloseAutoFocus)==null||o.call(t,i),i.defaultPrevented||(r.current||(c=n.triggerRef.current)==null||c.focus(),i.preventDefault()),r.current=!1,a.current=!1},onInteractOutside:i=>{var u,d;(u=t.onInteractOutside)==null||u.call(t,i),i.defaultPrevented||(r.current=!0,i.detail.originalEvent.type==="pointerdown"&&(a.current=!0));const o=i.target;((d=n.triggerRef.current)==null?void 0:d.contains(o))&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&a.current&&i.preventDefault()}})}),t1=f.forwardRef((t,s)=>{const{__scopePopover:n,trapFocus:r,onOpenAutoFocus:a,onCloseAutoFocus:i,disableOutsidePointerEvents:o,onEscapeKeyDown:c,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:h,...p}=t,g=fo(kl,n),x=Td(n);return Dj(),e.jsx(_j,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:a,onUnmountAutoFocus:i,children:e.jsx(Xp,{asChild:!0,disableOutsidePointerEvents:o,onInteractOutside:h,onEscapeKeyDown:c,onPointerDownOutside:u,onFocusOutside:d,onDismiss:()=>g.onOpenChange(!1),children:e.jsx(Zp,{"data-state":n1(g.open),role:"dialog",id:g.contentId,...x,...p,ref:s,style:{...p.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),s1="PopoverClose",sF=f.forwardRef((t,s)=>{const{__scopePopover:n,...r}=t,a=fo(s1,n);return e.jsx(jt.button,{type:"button",...r,ref:s,onClick:it(t.onClick,()=>a.onOpenChange(!1))})});sF.displayName=s1;var nF="PopoverArrow",rF=f.forwardRef((t,s)=>{const{__scopePopover:n,...r}=t,a=Td(n);return e.jsx(ex,{...a,...r,ref:s})});rF.displayName=nF;function n1(t){return t?"open":"closed"}var aF=KC,iF=ZC,oF=QC,r1=e1;const Dd=aF,kd=iF,Vl=f.forwardRef(({className:t,align:s="center",sideOffset:n=4,...r},a)=>e.jsx(oF,{children:e.jsx(r1,{ref:a,align:s,sideOffset:n,className:ce("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...r})}));Vl.displayName=r1.displayName;function ng(t=768){const[s,n]=f.useState(!1);return f.useEffect(()=>{const r=()=>{const a=window.innerWidth<t,i="ontouchstart"in window||navigator.maxTouchPoints>0,o=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);n(a||i&&o)};return r(),window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[t]),s}function db({value:t,onChange:s,placeholder:n="Seleccionar fecha",disabled:r=!1,className:a,minDate:i,maxDate:o}){const c=ng(),[u,d]=f.useState(!1),[h,p]=f.useState(t);f.useEffect(()=>{p(t)},[t]);const g=b=>{p(b),s==null||s(b),d(!1)},x=h?nt(h,"PPP",{locale:Zs}):n,y=e.jsx(Sd,{mode:"single",selected:h,onSelect:g,disabled:r,fromDate:i,toDate:o,initialFocus:!0});return c?e.jsxs(Jx,{open:u,onOpenChange:d,children:[e.jsx(YC,{asChild:!0,children:e.jsxs($,{variant:"outline",disabled:r,className:ce("w-full justify-start text-left font-normal",!h&&"text-muted-foreground",a),children:[e.jsx(ns,{className:"mr-2 h-4 w-4"}),x]})}),e.jsxs(Xx,{children:[e.jsxs(Zx,{className:"text-left",children:[e.jsx(eg,{children:"Seleccionar fecha"}),e.jsx(tg,{children:"Elige la fecha que desees"})]}),e.jsx("div",{className:"px-4 pb-4",children:y}),e.jsx(Qx,{className:"pt-2",children:e.jsx(VC,{asChild:!0,children:e.jsx($,{variant:"outline",children:"Cancelar"})})})]})]}):e.jsxs(Dd,{open:u,onOpenChange:d,children:[e.jsx(kd,{asChild:!0,children:e.jsxs($,{variant:"outline",disabled:r,className:ce("w-full justify-start text-left font-normal",!h&&"text-muted-foreground",a),children:[e.jsx(ns,{className:"mr-2 h-4 w-4"}),x]})}),e.jsx(Vl,{className:"w-auto p-0",align:"start",children:y})]})}const lF=()=>{const t=[];for(let s=6;s<=22;s++)t.push(`${s.toString().padStart(2,"0")}:00`),s<22&&t.push(`${s.toString().padStart(2,"0")}:30`);return t},cF=({startDate:t,endDate:s,onStartDateChange:n,onEndDateChange:r,showClearButton:a=!1})=>{const i=ng(),o=f.useMemo(()=>lF(),[]),c=v=>Ie(v),u=v=>nt(v,"HH:mm"),d=(v,w)=>{const[N,S,E]=v.split("-").map(Number),k=new Date;if(k.setFullYear(N,S-1,E),w){const[D,T]=w.split(":").map(Number);k.setHours(D,T,0,0)}else k.setHours(12,0,0,0);return k},h=v=>{if(!v){n(void 0);return}const w=t?u(t):void 0,N=d(v,w);if(s){const S=nd(t,s,N);r(S)}n(N)},p=v=>{if(!t)return;const w=c(t),N=d(w,v);if(s){const S=nd(t,s,N);r(S)}n(N)},g=v=>{if(!v){r(void 0);return}const w=s?u(s):void 0,N=d(v,w);r(N)},x=v=>{if(!s)return;const w=c(s),N=d(w,v);r(N)},y=v=>{if(!t)return;const w=new Date(t.getTime()+v*60*1e3);r(w)},b=()=>{if(t){const v=c(t),w=d(v);n(w)}r(void 0)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ns,{className:"w-4 h-4"}),"Fecha y Hora de Inicio"]}),a&&t&&e.jsx($,{variant:"ghost",size:"sm",onClick:()=>n(void 0),className:"h-8 px-2",children:e.jsx(Ws,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex gap-2",children:[i?e.jsx("div",{className:"flex-1",children:e.jsx(db,{value:t,onChange:n,placeholder:"Seleccionar fecha"})}):e.jsx(Fe,{type:"date",className:"flex-1",value:t?c(t):"",onChange:v=>h(v.target.value||void 0)}),e.jsxs(Tt,{value:t?u(t):"",onValueChange:p,disabled:!t,children:[e.jsx(vt,{className:"w-32",children:e.jsx(Dt,{placeholder:"Hora",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(en,{className:"w-3 h-3"}),t?u(t):"Hora"]})})}),e.jsx(yt,{children:o.map(v=>e.jsx(Pe,{value:v,children:v},v))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ns,{className:"w-4 h-4"}),"Fecha y Hora de Fin (opcional)"]}),s&&e.jsx($,{variant:"ghost",size:"sm",onClick:()=>r(void 0),className:"h-8 px-2",children:e.jsx(Ws,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex gap-2",children:[i?e.jsx("div",{className:"flex-1",children:e.jsx(db,{value:s,onChange:r,placeholder:"Seleccionar fecha"})}):e.jsx(Fe,{type:"date",className:"flex-1",value:s?c(s):"",onChange:v=>g(v.target.value||void 0)}),e.jsxs(Tt,{value:s?u(s):"",onValueChange:x,disabled:!s,children:[e.jsx(vt,{className:"w-32",children:e.jsx(Dt,{placeholder:"Hora",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(en,{className:"w-3 h-3"}),s?u(s):"Hora"]})})}),e.jsx(yt,{children:o.map(v=>e.jsx(Pe,{value:v,children:v},v))})]})]})]}),t&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("span",{className:"text-xs text-gray-600 w-full",children:"Duracin rpida:"}),e.jsx($,{type:"button",variant:"outline",size:"sm",onClick:()=>y(30),className:"h-7 text-xs",children:"30 min"}),e.jsx($,{type:"button",variant:"outline",size:"sm",onClick:()=>y(60),className:"h-7 text-xs",children:"1 hora"}),e.jsx($,{type:"button",variant:"outline",size:"sm",onClick:()=>y(120),className:"h-7 text-xs",children:"2 horas"}),e.jsx($,{type:"button",variant:"outline",size:"sm",onClick:b,className:"h-7 text-xs",children:"Sin hora"})]})]})};function dF({value:t,onChange:s,options:n,placeholder:r="Seleccionar opcin",disabled:a=!1,className:i,label:o,description:c}){const u=ng(),[d,h]=f.useState(!1),[p,g]=f.useState(t);f.useEffect(()=>{g(t)},[t]);const x=v=>{g(v),s==null||s(v),h(!1)},y=n.find(v=>v.value===p),b=(y==null?void 0:y.label)||r;return u?e.jsxs(Jx,{open:d,onOpenChange:h,children:[e.jsx(YC,{asChild:!0,children:e.jsxs($,{variant:"outline",disabled:a,className:ce("w-full justify-between text-left font-normal h-11",!p&&"text-muted-foreground",i),children:[e.jsx("span",{className:"truncate",children:b}),e.jsx(Gn,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsxs(Xx,{className:"max-h-[80vh]",children:[e.jsxs(Zx,{className:"text-left",children:[e.jsx(eg,{children:o||"Seleccionar opcin"}),c&&e.jsx(tg,{children:c})]}),e.jsx(Km,{className:"px-4 max-h-[60vh]",children:e.jsx("div",{className:"space-y-1 pb-4",children:n.map(v=>e.jsxs("button",{disabled:v.disabled,onClick:()=>!v.disabled&&x(v.value),className:ce("flex w-full items-center rounded-lg px-4 py-3 text-left transition-colors","hover:bg-accent hover:text-accent-foreground","focus:bg-accent focus:text-accent-foreground focus:outline-none","disabled:pointer-events-none disabled:opacity-50","active:scale-[0.98] transition-transform",p===v.value&&"bg-accent font-medium"),children:[e.jsx("span",{className:"flex-1",children:v.label}),p===v.value&&e.jsx(Fa,{className:"ml-2 h-5 w-5 shrink-0 text-primary"})]},v.value))})}),e.jsx(Qx,{className:"pt-2",children:e.jsx(VC,{asChild:!0,children:e.jsx($,{variant:"outline",children:"Cancelar"})})})]})]}):e.jsxs(Tt,{value:p,onValueChange:x,disabled:a,children:[e.jsx(vt,{className:ce("w-full",i),children:e.jsx(Dt,{placeholder:r})}),e.jsx(yt,{children:n.map(v=>e.jsx(Pe,{value:v.value,disabled:v.disabled,children:v.label},v.value))})]})}const uF=({value:t,onChange:s})=>{const r=Object.values(Cd).map(a=>({value:a,label:Qs[a]}));return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Cl,{className:"w-4 h-4"}),"Categora"]}),e.jsx(dF,{value:t,onChange:a=>s(a),options:r,placeholder:"Selecciona una categora",label:"Categora",description:"Clasifica tu tarea segn su tipo"})]})},mF=({value:t,onChange:s})=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(en,{className:"w-4 h-4"}),"Tiempo estimado (min)"]}),e.jsx(Fe,{type:"number",min:"0",placeholder:"Ej. 30",value:t??"",onChange:n=>{const r=n.target.value;s(r===""?void 0:Number(r))}})]}),a1=({initialDate:t,initialConfig:s}={})=>{const[n,r]=f.useState(t||new Date),[a,i]=f.useState(s),o=(d,h)=>h?zI(d,h.pattern,h.customDays):d;return{date:n,setDate:r,config:a,setConfig:i,calculateNextDate:o,getRecurrenceText:(d,h)=>h?Vw(d,h.pattern,h.customDays):"",updateRecurrenceConfig:(d,h)=>{const p={pattern:d,frequency:1,...d==="custom"&&{customDays:h||1}};i(p),r(o(new Date,p))},formatDateForInput:Np}},hF=({isRecurrent:t,onRecurrentChange:s,config:n,onConfigChange:r})=>{const{getRecurrenceText:a}=a1({initialConfig:n}),i=o=>{const c={...n||{},frequency:1,pattern:o,...o==="custom"&&{customDays:(n==null?void 0:n.customDays)||1}};r(c)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Rs,{id:"isRecurrent",checked:t,onCheckedChange:o=>{s(o)}}),e.jsx("label",{htmlFor:"isRecurrent",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Tarea recurrente"})]}),t&&n&&e.jsxs("div",{className:"pl-6 space-y-4",children:[e.jsxs(Tt,{value:n.pattern,onValueChange:o=>i(o),children:[e.jsx(vt,{className:"w-full",children:e.jsx(Dt,{placeholder:"Selecciona frecuencia"})}),e.jsxs(yt,{children:[e.jsx(Pe,{value:"daily",children:"Diariamente"}),e.jsx(Pe,{value:"weekly",children:"Semanalmente"}),e.jsx(Pe,{value:"monthly",children:"Mensualmente"}),e.jsx(Pe,{value:"custom",children:"Personalizado"})]})]}),n.pattern==="custom"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{type:"number",min:"1",value:n.customDays,onChange:o=>{const c=parseInt(o.target.value);c>0&&r({...n,customDays:c})},className:"w-24"}),e.jsx("span",{className:"text-sm text-gray-500",children:"das"})]}),n&&e.jsx("div",{className:"text-sm text-blue-600",children:a(new Date,n)})]})]})},rg=({openCreateModal:t,onSave:s,isModalOpen:n=!1})=>{const r=f.useCallback(a=>{const i=document.activeElement,o=i instanceof HTMLInputElement||i instanceof HTMLTextAreaElement||i instanceof HTMLSelectElement||(i==null?void 0:i.getAttribute("contenteditable"))==="true";if(a.ctrlKey&&a.key==="n"&&!o){a.preventDefault(),a.stopPropagation(),t();return}if(a.ctrlKey&&a.key==="s"&&n&&s){a.preventDefault(),a.stopPropagation(),s();return}},[t,s,n]);return f.useEffect(()=>(document.addEventListener("keydown",r),()=>{document.removeEventListener("keydown",r)}),[r]),{openCreateModal:t}},Gl=({isOpen:t,onClose:s,onConfirm:n,task:r,mode:a})=>{const{calculateNextDate:i}=a1({initialConfig:r.recurrence,initialDate:r.startDate}),[o,c]=f.useState(()=>a==="create"?{title:"",description:"",category:"personal",isRecurrent:!1,isPrivate:r.isPrivate||!1,priority:"delete",size:"pequea",estimatedTime:void 0,timeOfDay:void 0}:{title:r.title||"",description:r.description||"",startDate:a==="complete"?i(new Date,r.recurrence):r.startDate||void 0,endDate:r.endDate||void 0,isRecurrent:r.isRecurrent??!1,isPrivate:r.isPrivate??!1,category:r.category||"personal",recurrence:r.recurrence,priority:r.priority||"delete",size:r.size||"pequea",estimatedTime:r.estimatedTime,timeOfDay:r.timeOfDay}),[u,d]=f.useState(()=>r.priority==="do"||r.priority==="delegate"),[h,p]=f.useState(()=>r.priority==="do"||r.priority==="decide"),[g,x]=f.useState(r.size||"pequea");f.useEffect(()=>{t&&(a==="create"?(c({title:"",description:"",category:"personal",isRecurrent:!1,isPrivate:r.isPrivate||!1,priority:"delete",size:"pequea",estimatedTime:void 0,timeOfDay:void 0}),d(!1),p(!1),x("pequea")):(c({title:r.title||"",description:r.description||"",startDate:a==="complete"?i(new Date,r.recurrence):r.startDate||void 0,endDate:r.endDate||void 0,isRecurrent:r.isRecurrent||!1,isPrivate:r.isPrivate||!1,category:r.category||"personal",recurrence:r.recurrence,priority:r.priority||"delete",size:r.size||"pequea",estimatedTime:r.estimatedTime,timeOfDay:r.timeOfDay}),d(r.priority==="do"||r.priority==="delegate"),p(r.priority==="do"||r.priority==="decide"),x(r.size||"pequea")))},[r,a,t]);const y=()=>{if(!o.title.trim())return;const v=u&&h?"do":h?"decide":u?"delegate":"delete";a==="create"?(o.title.split(`
`).map(N=>N.trim()).filter(Boolean).forEach(N=>{n({...o,title:N,priority:v,size:g})}),s()):n({...o,priority:v,size:g})};rg({openCreateModal:()=>{},onSave:y,isModalOpen:t});const b=()=>{switch(a){case"create":return"Nueva Tarea";case"edit":return"Editar Tarea";case"complete":return"Completar Tarea";default:return""}};return e.jsx(kt,{open:t,onOpenChange:s,children:e.jsxs(wt,{className:"max-w-[95vw] w-[95vw] max-h-[90vh] h-[80vh] overflow-y-auto sm:max-w-[90vw] sm:w-[90vw] lg:max-w-[85vw] lg:w-[85vw]",children:[e.jsxs(At,{children:[e.jsx(_t,{children:b()}),a==="complete"&&e.jsx(cn,{children:r.title})]}),e.jsxs("div",{className:"grid gap-6 py-4 lg:grid-cols-2",children:[e.jsxs("div",{className:"space-y-4",children:[a!=="complete"&&e.jsx(m6,{multiline:a==="create",value:o.title,onChange:v=>c(w=>({...w,title:v}))}),e.jsx(f6,{value:o.description||"",onChange:v=>c(w=>({...w,description:v}))}),a==="edit"&&e.jsxs(e.Fragment,{children:[e.jsx(x6,{title:o.title,description:o.description||"",onInsert:v=>c(w=>({...w,description:(w.description?w.description+`
`:"")+v}))}),e.jsx(v6,{title:o.title,description:o.description||"",onInsert:v=>c(w=>({...w,description:(w.description?w.description+`
`:"")+v}))}),e.jsx(b6,{title:o.title,description:o.description||"",onInsert:v=>c(w=>({...w,description:(w.description?w.description+`
`:"")+v}))})]})]}),e.jsxs("div",{className:"space-y-6",children:[a!=="complete"&&e.jsx(uF,{value:o.category,onChange:v=>c(w=>({...w,category:v}))}),a!=="complete"&&e.jsx(cF,{startDate:o.startDate,endDate:o.endDate,onStartDateChange:v=>c(w=>({...w,startDate:v})),onEndDateChange:v=>c(w=>({...w,endDate:v})),showClearButton:!0}),a!=="complete"&&e.jsx(hF,{isRecurrent:o.isRecurrent??!1,onRecurrentChange:v=>c(w=>({...w,isRecurrent:v,recurrence:v?{pattern:"daily",frequency:1}:void 0})),config:o.recurrence,onConfigChange:v=>c(w=>({...w,recurrence:v}))}),a!=="complete"&&e.jsx(mF,{value:o.estimatedTime,onChange:v=>c(w=>({...w,estimatedTime:v}))}),a!=="complete"&&e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Rs,{checked:u,onCheckedChange:v=>d(!!v)}),"Urgente"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Rs,{checked:h,onCheckedChange:v=>p(!!v)}),"Importante"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Rs,{checked:o.isPrivate??!1,onCheckedChange:v=>c(w=>({...w,isPrivate:!!v}))})," Privada (solo en Journal)"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Tamao"}),e.jsxs(Tt,{value:g,onValueChange:v=>x(v),children:[e.jsx(vt,{className:"h-8 w-28",children:e.jsx(Dt,{placeholder:"Tamao"})}),e.jsxs(yt,{children:[e.jsx(Pe,{value:"pequea",children:"pequea"}),e.jsx(Pe,{value:"mediana",children:"mediana"}),e.jsx(Pe,{value:"grande",children:"grande"})]})]})]})]})]})]}),e.jsxs(Cn,{children:[e.jsx($,{variant:"outline",onClick:s,children:"Cancelar"}),e.jsx($,{onClick:y,disabled:!o.title.trim(),children:a==="complete"?"Completar":a==="create"?"Crear":"Guardar cambios"})]})]})})},fF=({selectedDate:t})=>{const{allTasks:s,status:n,error:r,showRecurrenceModal:a,currentTask:i,modalMode:o,addTask:c,editTask:u,toggleTask:d,deleteTask:h,completeRecurrentTask:p,setShowRecurrenceModal:g,openEditModal:x,openCreateModal:y}=qo(),[b,v]=f.useState(null),[w,N]=f.useState(!1),[S,E]=f.useState(""),[k,D]=f.useState(!1),T=s.filter(M=>M.isPrivate),R=T.filter(M=>M.startDate&&pn(M.startDate,t)),O=T.filter(M=>!M.completed&&(!M.startDate||!pn(M.startDate,t))),U=()=>{y(t,!0)},I=()=>{try{const M=JSON.parse(S);if(!Array.isArray(M)){bt.error("El JSON debe contener un array de tareas");return}let W=0,B=0;M.forEach(P=>{if(P.title){let z;if(P.startDate||P.dueDate){const G=P.startDate||P.dueDate,ae=new Date(G);isNaN(ae.getTime())?(B++,console.warn(`Fecha invlida para tarea "${P.title}": ${G}`)):z=ae}c({title:P.title,description:P.description||"",startDate:z,category:P.category||"personal",priority:P.priority||void 0,isPrivate:!0,isRecurrent:P.isRecurrent||!1,size:P.size||void 0}),W++}}),B>0?bt.warning(`${W} tareas importadas. ${B} fechas invlidas fueron omitidas.`):bt.success(`${W} tareas privadas importadas correctamente`),E(""),D(!1)}catch(M){bt.error("Error al importar las tareas. Verifica el formato JSON."),console.error("Error de importacin:",M)}},_=()=>{const M=T.map(B=>{var P,z,G;return{title:B.title,description:B.description||"",startDate:(P=B.startDate)==null?void 0:P.toISOString(),endDate:(z=B.endDate)==null?void 0:z.toISOString(),category:B.category,priority:B.priority,size:B.size,completed:B.completed,isRecurrent:B.isRecurrent||!1,...B.recurrence&&{recurrence:{frequency:B.recurrence.frequency,pattern:B.recurrence.pattern,customDays:B.recurrence.customDays,nextDate:(G=B.recurrence.nextDate)==null?void 0:G.toISOString()}}}}),W=JSON.stringify(M,null,2);navigator.clipboard.writeText(W).then(()=>{bt.success("Tareas privadas copiadas al portapapeles con fechas incluidas")})};return e.jsxs(Ce,{className:"w-full mt-4",children:[e.jsx(Kt,{children:e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Gt,{className:"text-lg",children:" Tareas Privadas"}),e.jsxs(Mt,{variant:"secondary",className:"text-xs",children:[T.length," total"]})]})})}),e.jsxs(Ae,{className:"space-y-4",children:[R.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-sm text-gray-600 mb-2",children:["Para hoy (",R.length,")"]}),e.jsx("div",{className:"space-y-2",children:R.map(M=>e.jsx(ad,{task:M,onDelete:h,onEdit:x,onView:W=>{v(W),N(!0)},onMove:(W,B)=>u(W,{startDate:B||void 0}),onAssignTimeOfDay:(W,B)=>u(W,{timeOfDay:B})},M.id))})]}),O.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-sm text-gray-600 mb-2",children:["Pendientes (",O.length,")"]}),e.jsx("div",{className:"space-y-2",children:O.map(M=>e.jsx(ad,{task:M,onDelete:h,onEdit:x,onView:W=>{v(W),N(!0)},onMove:(W,B)=>u(W,{startDate:B||void 0}),onAssignTimeOfDay:(W,B)=>u(W,{timeOfDay:B})},M.id))})]}),T.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("p",{children:"No tienes tareas privadas"}),e.jsx("p",{className:"text-sm",children:"Crea una nueva o importa desde JSON"})]}),n==="saving"&&e.jsx(Mt,{variant:"secondary",className:"text-xs",children:"Guardando..."}),r&&e.jsx("p",{className:"text-sm text-red-500",children:r})]}),e.jsxs(In,{className:"justify-end flex-wrap gap-2",children:[e.jsxs(kt,{open:k,onOpenChange:D,children:[e.jsx(Dx,{asChild:!0,children:e.jsxs($,{size:"sm",variant:"outline",children:[e.jsx(Bo,{className:"w-4 h-4 mr-2"}),"Importar"]})}),e.jsxs(wt,{children:[e.jsxs(At,{children:[e.jsx(_t,{children:"Importar Tareas Privadas"}),e.jsx(cn,{children:"Pega el JSON con las tareas a importar. Todas se marcar\\u00e1n como privadas."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(It,{placeholder:`Ejemplo - Puedes incluir fechas en formato ISO (YYYY-MM-DD) o dejarlas sin fecha:
[
  {
    "title": "Reflexin personal importante",
    "description": "Pensar sobre mis metas de vida",
    "dueDate": "2024-12-31",
    "category": "personal",
    "priority": "do",
    "size": "mediana"
  },
  {
    "title": "Tarea sensible del trabajo",
    "description": "Revisar tema confidencial",
    "dueDate": "2024-06-15T14:30:00Z",
    "category": "work",
    "priority": "decide"
  },
  {
    "title": "Tarea sin fecha especfica",
    "description": "Esta tarea no tiene fecha lmite",
    "category": "personal"
  }
]

Formatos de fecha soportados:
- "2024-12-31" (solo fecha)
- "2024-06-15T14:30:00Z" (fecha y hora ISO)
- "2024-06-15T14:30:00" (fecha y hora local)
- Sin campo "dueDate" = sin fecha asignada`,value:S,onChange:M=>E(M.target.value),rows:15,className:"font-mono text-sm"}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx($,{variant:"outline",onClick:()=>D(!1),children:"Cancelar"}),e.jsx($,{onClick:I,disabled:!S.trim(),children:"Importar Tareas"})]})]})]})]}),e.jsxs($,{size:"sm",variant:"outline",onClick:_,children:[e.jsx(br,{className:"w-4 h-4 mr-2"}),"Exportar"]}),e.jsxs($,{size:"sm",onClick:U,children:[e.jsx(cs,{className:"w-4 h-4 mr-2"}),"Nueva Privada"]})]}),e.jsx(Gl,{isOpen:a,onClose:()=>g(),onConfirm:M=>{const W={...M,isPrivate:!0};o==="complete"?p(W):o==="edit"?u(i.id,W):c(W)},task:i||{id:"",taskCode:0,title:"",completed:!1,category:"personal",createdAt:{seconds:Date.now()/1e3}},mode:o}),e.jsx(sh,{task:b,isOpen:w,onClose:()=>N(!1),onEdit:M=>{N(!1),x(M)},onToggle:d})]})},pF=t=>t.charAt(0).toUpperCase()+t.slice(1),xF=({open:t,onOpenChange:s})=>{const{user:n}=Je(),[r,a]=f.useState("config"),[i,o]=f.useState("thisWeek"),[c,u]=f.useState(new Date),[d,h]=f.useState(new Date),[p,g]=f.useState({includeJournal:!0,includeMoods:!0,includeEnergy:!0,includePrivateTasks:!0}),[x,y]=f.useState(!1),b=(T,R)=>{g(O=>({...O,[T]:R}))},v=()=>{const T=new Date;if(i==="thisWeek")return{start:Pa(T,{weekStartsOn:1}),end:Rr(T,{weekStartsOn:1})};if(i==="lastWeek"){const R=sO(T);return{start:Pa(R,{weekStartsOn:1}),end:Rr(R,{weekStartsOn:1})}}else return{start:c,end:d}},w=async(T,R)=>{if(!n)return{journals:[],moods:[],energy:[],privateTasks:[]};const O=[],U=[],I=[];for(let M=new Date(T);M<=R;M.setDate(M.getDate()+1)){const W=Ie(M);if(p.includeJournal){const B=ke(xe,"journal",`${n.uid}_${W}`),P=await ot(B);P.exists()&&O.push({userId:n.uid,text:P.data().text||"",date:W,lastUpdated:P.data().lastUpdated||new Date,displayTime:P.data().displayTime||""})}if(p.includeMoods){const B=ke(xe,"moods",`${n.uid}_${W}`),P=await ot(B);P.exists()&&U.push(P.data())}if(p.includeEnergy){const B=ke(xe,"energy",`${n.uid}_${W}`),P=await ot(B);P.exists()&&I.push(P.data())}}let _=[];if(p.includePrivateTasks){const M=xn(Bt(xe,"tasks"),Et("userId","==",n.uid),Et("isPrivate","==",!0));_=(await gn(M)).docs.map(B=>({id:B.id,...B.data()})).filter(B=>{var Y;if(!((Y=B.createdAt)!=null&&Y.seconds))return!1;const P=new Date(B.createdAt.seconds*1e3),z=Ie(P),G=Ie(T),ae=Ie(R);return z>=G&&z<=ae})}return{journals:O,moods:U,energy:I,privateTasks:_}},N=async()=>{if(!n)return;const{start:T,end:R}=v(),{journals:O,moods:U,energy:I,privateTasks:_}=await w(T,R);let M=`# Diario del ${nt(T,"dd MMMM yyyy",{locale:Zs})} al ${nt(R,"dd MMMM yyyy",{locale:Zs})}

`;for(let z=new Date(T);z<=R;z.setDate(z.getDate()+1)){const G=Ie(z),ae=nt(z,"EEEE, d 'de' MMMM 'de' yyyy",{locale:Zs});M+=`### ${pF(ae)}

`;let Y=!1;if(p.includeMoods){const X=U.find(se=>se.date===G);X!=null&&X.moods&&X.moods.length>0&&(M+=`**Estados de nimo:**
`,X.moods.forEach(se=>{M+=`- ${se.time}: ${se.emoji} ${se.text}
`}),M+=`
`,Y=!0)}if(p.includeEnergy){const X=I.find(se=>se.date===G);X!=null&&X.entries&&X.entries.length>0&&(M+=`**Niveles de energa:**
`,X.entries.forEach(se=>{const H=se.comment?` - ${se.comment}`:"";M+=`- ${se.time}: Nivel ${se.level}/5${H}
`}),M+=`
`,Y=!0)}if(p.includePrivateTasks){const X=_.filter(se=>{var ie;if(!((ie=se.createdAt)!=null&&ie.seconds))return!1;const H=new Date(se.createdAt.seconds*1e3);return Ie(H)===G});X.length>0&&(M+=`**Tareas privadas:**
`,X.forEach(se=>{const H=se.completed?"":"",ie=se.description?` - ${se.description}`:"";M+=`- ${H} ${se.title}${ie}
`}),M+=`
`,Y=!0)}if(p.includeJournal){const X=O.find(se=>se.date===G);X!=null&&X.text&&X.text.trim()&&(M+=`**Diario:**
${X.text}

`,Y=!0)}Y||(M+=`_Sin entradas para este da_

`)}const W=new Blob([M],{type:"text/markdown;charset=utf-8"}),B=URL.createObjectURL(W),P=document.createElement("a");P.href=B,P.download=`${Ie(T)}_a_${Ie(R)}.md`,document.body.appendChild(P),P.click(),document.body.removeChild(P),URL.revokeObjectURL(B)},S=async()=>{y(!0),a("processing");try{await N(),setTimeout(()=>{E()},1e3)}catch(T){console.error("Error exporting:",T)}finally{y(!1)}},E=()=>{a("config"),y(!1),s(!1)},k=()=>Object.values(p).some(Boolean),D=()=>{const{start:T,end:R}=v();return`${nt(T,"dd/MM/yyyy")} - ${nt(R,"dd/MM/yyyy")}`};return e.jsx(kt,{open:t,onOpenChange:E,children:e.jsxs(wt,{className:"max-w-lg",children:[e.jsx(At,{children:e.jsxs(_t,{className:"flex items-center gap-2",children:[e.jsx(br,{className:"w-5 h-5"}),"Exportar Diario"]})}),r==="config"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(Ce,{children:[e.jsx(Kt,{className:"pb-3",children:e.jsxs(Gt,{className:"text-sm flex items-center gap-2",children:[e.jsx(ns,{className:"w-4 h-4"}),"Rango de fechas"]})}),e.jsxs(Ae,{className:"space-y-3",children:[e.jsxs(Tt,{value:i,onValueChange:T=>o(T),children:[e.jsx(vt,{className:"w-full",children:e.jsx(Dt,{placeholder:"Seleccionar rango"})}),e.jsxs(yt,{children:[e.jsx(Pe,{value:"thisWeek",children:"Esta semana"}),e.jsx(Pe,{value:"lastWeek",children:"Semana pasada"}),e.jsx(Pe,{value:"custom",children:"Rango personalizado"})]})]}),i==="custom"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"date",className:"border rounded-md px-2 py-1 flex-1 text-sm",value:Np(c),onChange:T=>u(new Date(T.target.value)),placeholder:"Fecha de inicio",title:"Fecha de inicio"}),e.jsx("input",{type:"date",className:"border rounded-md px-2 py-1 flex-1 text-sm",value:Np(d),onChange:T=>h(new Date(T.target.value)),placeholder:"Fecha de fin",title:"Fecha de fin"})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:["Exportando: ",D()]})]})]}),e.jsxs(Ce,{children:[e.jsx(Kt,{className:"pb-3",children:e.jsx(Gt,{className:"text-sm",children:"Contenido a incluir"})}),e.jsx(Ae,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Rs,{id:"journal",checked:p.includeJournal,onCheckedChange:T=>b("includeJournal",!!T),className:"mt-1"}),e.jsxs("div",{className:"flex items-start gap-2 flex-1",children:[e.jsx(md,{className:"w-4 h-4 mt-1 text-gray-600"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"journal",className:"text-sm font-medium cursor-pointer block",children:"Entradas del diario"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Contenido textual del diario personal"})]})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Rs,{id:"moods",checked:p.includeMoods,onCheckedChange:T=>b("includeMoods",!!T),className:"mt-1"}),e.jsxs("div",{className:"flex items-start gap-2 flex-1",children:[e.jsx(TO,{className:"w-4 h-4 mt-1 text-gray-600"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"moods",className:"text-sm font-medium cursor-pointer block",children:"Estados de nimo"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Emociones registradas con hora y emoji"})]})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Rs,{id:"energy",checked:p.includeEnergy,onCheckedChange:T=>b("includeEnergy",!!T),className:"mt-1"}),e.jsxs("div",{className:"flex items-start gap-2 flex-1",children:[e.jsx(DO,{className:"w-4 h-4 mt-1 text-gray-600"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"energy",className:"text-sm font-medium cursor-pointer block",children:"Niveles de energa"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Registros de energa del 1-5 con comentarios"})]})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Rs,{id:"tasks",checked:p.includePrivateTasks,onCheckedChange:T=>b("includePrivateTasks",!!T),className:"mt-1"}),e.jsxs("div",{className:"flex items-start gap-2 flex-1",children:[e.jsx(rx,{className:"w-4 h-4 mt-1 text-gray-600"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tasks",className:"text-sm font-medium cursor-pointer block",children:"Tareas privadas"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Tareas marcadas como privadas"})]})]})]})]})})]})]}),r==="processing"&&e.jsxs("div",{className:"py-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Generando archivo markdown..."})]}),e.jsx(Cn,{className:"gap-2",children:r==="config"&&e.jsxs(e.Fragment,{children:[e.jsx($,{variant:"outline",onClick:E,children:"Cancelar"}),e.jsxs($,{onClick:S,disabled:!k()||x,className:"flex items-center gap-2",children:[e.jsx(br,{className:"w-4 h-4"}),"Exportar"]})]})})]})})},_c=({title:t,tasks:s,onDelete:n,onEdit:r,onView:a,onMove:i,onAssignTimeOfDay:o})=>{if(s.length===0)return null;const c={do:0,decide:1,delegate:2,delete:3},u=s.sort((d,h)=>{var x,y;const p=c[d.priority||"none"]??4,g=c[h.priority||"none"]??4;return p!==g?p-g:d.startDate&&h.startDate?d.startDate.getTime()-h.startDate.getTime():!d.startDate&&!h.startDate?(((x=h.createdAt)==null?void 0:x.seconds)||0)-(((y=d.createdAt)==null?void 0:y.seconds)||0):d.startDate?-1:1});return e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-medium text-sm text-gray-500 uppercase tracking-wider pt-4",children:t}),e.jsx("div",{className:"hidden md:block",children:e.jsx(Ce,{children:e.jsxs(Ae,{className:"p-0",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-4 p-4 bg-gray-50 border-b text-sm font-medium text-gray-700",children:[e.jsx("div",{className:"col-span-4",children:"Tarea"}),e.jsx("div",{className:"col-span-2 text-center",children:"Estado"}),e.jsx("div",{className:"col-span-1 text-center",children:"Prioridad"}),e.jsx("div",{className:"col-span-1 text-center",children:"Tiempo"}),e.jsx("div",{className:"col-span-2 text-center",children:"Fecha"}),e.jsx("div",{className:"col-span-2 text-center",children:"Acciones"})]}),e.jsx("div",{className:"divide-y divide-gray-100",children:u.map(d=>e.jsx(ad,{task:d,onDelete:n,onEdit:r,onView:a,onMove:i,onAssignTimeOfDay:o},d.id))})]})})}),e.jsx("div",{className:"md:hidden space-y-3",children:u.map(d=>e.jsx(ad,{task:d,onDelete:n,onEdit:r,onView:a,onMove:i,onAssignTimeOfDay:o},d.id))})]})},ub={all:"Todas las fechas",today:"Hoy",week:"Esta semana",month:"Este mes",overdue:"Vencidas",noDate:"Sin fecha"},gF=({tasks:t,onDelete:s,onEdit:n,onView:r,onMove:a,onAssignTimeOfDay:i,status:o,error:c})=>{const[u,d]=f.useState("all"),[h,p]=f.useState("all"),[g,x]=f.useState(!1),[y,b]=f.useState(""),v=f.useMemo(()=>{let E=u==="all"?t:t.filter(I=>I.category===u);if(y.trim()){const I=y.toLowerCase().trim();E=E.filter(_=>_.title.toLowerCase().includes(I)||_.description&&_.description.toLowerCase().includes(I))}const k=new Date,D=ps(k),T=Pa(k),R=Rr(k),O=ls(k),U=vr(k);switch(h){case"today":return E.filter(I=>I.startDate&&Ro(I.startDate,{start:D,end:ci(k)}));case"week":return E.filter(I=>I.startDate&&Ro(I.startDate,{start:T,end:R}));case"month":return E.filter(I=>I.startDate&&Ro(I.startDate,{start:O,end:U}));case"overdue":return E.filter(I=>I.startDate&&Is(I.startDate,D));case"noDate":return E.filter(I=>!I.startDate);default:return E}},[t,u,h,y]),w=f.useMemo(()=>y.trim()!==""||u!=="all"||h!=="all",[y,u,h]),N=()=>{b(""),d("all"),p("all")},S=f.useMemo(()=>{const E=new Date,k=ps(E),D=ci(E),T=Rr(E);return v.reduce((R,O)=>(O.startDate&&Is(O.startDate,k)?R.overdue.push(O):O.startDate?Is(O.startDate,D)?R.today.push(O):Is(O.startDate,T)?R.thisWeek.push(O):R.future.push(O):R.noDate.push(O),R),{overdue:[],today:[],thisWeek:[],future:[],noDate:[]})},[v]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-4 items-stretch sm:items-center",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx($l,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(Fe,{placeholder:"Buscar tareas por nombre o descripcin...",value:y,onChange:E=>b(E.target.value),className:"pl-10 pr-10"}),y&&e.jsx($,{variant:"ghost",size:"sm",onClick:()=>b(""),className:"absolute right-1 top-1/2 transform -translate-y-1/2 h-6 w-6 p-0 hover:bg-gray-100",children:e.jsx(Ws,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"md:hidden flex gap-2",children:[e.jsxs($,{variant:w?"default":"outline",onClick:()=>x(!g),className:`flex items-center gap-2 ${w?"bg-blue-600 hover:bg-blue-700":""}`,children:[e.jsx(xd,{className:"w-4 h-4"}),"Filtros",w&&e.jsx("span",{className:"bg-white text-blue-600 rounded-full px-2 py-0.5 text-xs font-medium",children:"Activos"})]}),w&&e.jsx($,{variant:"ghost",onClick:N,className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(Ws,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"hidden md:flex",children:w&&e.jsxs($,{variant:"ghost",onClick:N,className:"text-red-600 hover:text-red-700 hover:bg-red-50 flex items-center gap-2",children:[e.jsx(Ws,{className:"w-4 h-4"}),"Limpiar filtros"]})})]}),"      ",e.jsxs("div",{className:`space-y-4 md:space-y-0 md:flex md:items-center md:gap-4 ${g?"block":"hidden md:flex"}`,children:[e.jsxs("div",{className:"flex-1 space-y-2 md:space-y-0",children:[e.jsx("span",{className:"text-sm text-gray-500 font-medium block md:inline md:mr-2",children:"Categora:"}),e.jsxs(Tt,{value:u,onValueChange:E=>d(E),children:[e.jsx(vt,{className:`w-full md:w-[180px] ${u!=="all"?"border-blue-500 bg-blue-50":""}`,children:e.jsx(Dt,{children:u==="all"?"Todas las categoras":Qs[u]})}),e.jsxs(yt,{children:[e.jsx(Pe,{value:"all",children:"Todas las categoras"}),Object.entries(Cd).map(([E,k])=>e.jsx(Pe,{value:k,children:Qs[k]},E))]})]})]}),e.jsxs("div",{className:"flex-1 space-y-2 md:space-y-0",children:[e.jsx("span",{className:"text-sm text-gray-500 font-medium block md:inline md:mr-2",children:"Fecha:"}),e.jsxs(Tt,{value:h,onValueChange:E=>p(E),children:[e.jsx(vt,{className:`w-full md:w-[180px] ${h!=="all"?"border-blue-500 bg-blue-50":""}`,children:e.jsx(Dt,{children:ub[h]})}),e.jsx(yt,{children:Object.entries(ub).map(([E,k])=>e.jsx(Pe,{value:E,children:k},E))})]})]})]}),e.jsxs("div",{children:[e.jsx(_c,{title:"Tareas Vencidas",tasks:S.overdue,onDelete:s,onEdit:n,onView:r,onMove:a,onAssignTimeOfDay:i}),e.jsx(_c,{title:"Para Hoy",tasks:S.today,onDelete:s,onEdit:n,onView:r,onMove:a,onAssignTimeOfDay:i}),e.jsx(_c,{title:"Esta Semana",tasks:S.thisWeek,onDelete:s,onEdit:n,onView:r,onMove:a,onAssignTimeOfDay:i}),e.jsx(_c,{title:"Prximamente",tasks:S.future,onDelete:s,onEdit:n,onView:r,onMove:a,onAssignTimeOfDay:i}),e.jsx(_c,{title:"Sin Fecha",tasks:S.noDate,onDelete:s,onEdit:n,onView:r,onMove:a,onAssignTimeOfDay:i}),v.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:u==="all"&&h==="all"?"No hay tareas pendientes":"No hay tareas pendientes con los filtros seleccionados"}),o&&o!=="idle"&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs text-gray-500",children:[o==="loading"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border border-gray-300 border-t-blue-500 rounded-full animate-spin"}),e.jsx("span",{children:"Cargando tareas..."})]}),o==="saving"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border border-gray-300 border-t-blue-500 rounded-full animate-spin"}),e.jsx("span",{children:"Guardando..."})]}),o==="pending"&&e.jsx("span",{className:"text-yellow-600",children:"Pendiente de sincronizar"}),o==="saved"&&e.jsx("span",{className:"text-green-600",children:" Sincronizado"}),o==="error"&&c&&e.jsx("span",{className:"text-red-600",children:" Error de sincronizacin"})]})})]})]})},ag=({error:t,onRetry:s,showClearCache:n=!1})=>{const r=(t==null?void 0:t.includes("sincronizacin"))||(t==null?void 0:t.includes("INTERNAL ASSERTION"))||(t==null?void 0:t.includes("Unexpected state")),a=async()=>{try{await nm()}catch(i){console.error("Error clearing cache:",i),alert("Error al limpiar el cache. Intenta recargar la pgina manualmente.")}};return t?e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-600 mb-2",children:[e.jsx(lw,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Error de sincronizacin"})]}),e.jsx("p",{className:"text-sm text-red-600 mb-3",children:t}),e.jsxs("div",{className:"flex gap-2",children:[s&&e.jsxs($,{type:"button",onClick:s,size:"sm",variant:"outline",className:"text-red-600 border-red-300 hover:bg-red-50",children:[e.jsx(ao,{className:"w-4 h-4 mr-1"}),"Reintentar"]}),(r||n)&&e.jsxs($,{type:"button",onClick:a,size:"sm",variant:"outline",className:"text-red-600 border-red-300 hover:bg-red-50",children:[e.jsx(oo,{className:"w-4 h-4 mr-1"}),"Limpiar Cache"]})]}),r&&e.jsx("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded",children:e.jsxs("p",{className:"text-xs text-yellow-800",children:[e.jsx("strong",{children:"Sugerencia:"})," Este error suele ocurrir cuando hay conflictos entre datos guardados offline y en el servidor. Limpiar el cache ayudar a resolver el problema, aunque tendrs que volver a sincronizar tus datos."]})})]}):null},vF={daily:"Diario",weekly:"Semanal",monthly:"Mensual"},mb={do:{label:"HACER",color:"bg-red-500",text:"Urgente e importante"},decide:{label:"DECIDIR",color:"bg-orange-500",text:"Importante, no urgente"},delegate:{label:"DELEGAR",color:"bg-blue-500",text:"Urgente, no importante"},delete:{label:"ELIMINAR",color:"bg-gray-500",text:"Ni urgente ni importante"},none:{label:"",color:"",text:""}},Wf={do:{icon:"",num:1,style:"bg-red-600 text-white"},decide:{icon:"",num:2,style:"bg-orange-500 text-white"},delegate:{icon:"",num:3,style:"bg-blue-500 text-white"},delete:{icon:"",num:4,style:"bg-gray-500 text-white"},none:{icon:"",num:4,style:"bg-gray-500 text-white"}},yF=t=>nt(t,"dd/MM"),bF=t=>t!=null&&t.type&&vF[t.type]||"",jF=(t="none")=>mb[t]||mb.none,wF=t=>t?Is(ps(t),ps(new Date)):!1,i1=f.memo(({task:t,showCategoryLabel:s,overdue:n})=>{var c,u;const r={bg:((c=Ra[t.category])==null?void 0:c.bg)||"bg-purple-100",text:((u=Ra[t.category])==null?void 0:u.text)||"text-purple-800"},a=jF(t.priority),i=bF(t.recurrence),o="text-xs px-1.5 py-0.5";return e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s&&e.jsxs(Mt,{className:ce(o,r.bg,r.text),children:[e.jsx(Cl,{className:"w-3 h-3 mr-1"}),Qs[t.category]]}),t.startDate&&e.jsxs(Mt,{variant:n?"destructive":"secondary",className:o,children:[e.jsx(ns,{className:"w-3 h-3 mr-1"}),yF(t.startDate),n&&" (vencida)"]}),e.jsx(Mr,{children:e.jsxs(Hs,{children:[e.jsx(Us,{asChild:!0,children:e.jsxs(Mt,{className:ce(o,"gap-0.5",Wf[t.priority||"none"].style),children:[e.jsx("span",{className:"mr-0.5",children:Wf[t.priority||"none"].icon}),Wf[t.priority||"none"].num]})}),e.jsx(Ls,{children:a.text})]})}),t.estimatedTime!==void 0&&e.jsxs(Mt,{variant:"outline",className:o,children:[e.jsx(en,{className:"w-3 h-3 mr-1"}),t.estimatedTime,"m"]}),t.isRecurrent&&i&&e.jsxs(Mt,{variant:"outline",className:o,children:[e.jsx(cx,{className:"w-3 h-3 mr-1"}),i]})]})});i1.displayName="TaskBadges";const o1=f.memo(({task:t,onEdit:s,onDelete:n,onMove:r,onAssignTimeOfDay:a})=>{const i=Qt(),o=f.useCallback(S=>{S.stopPropagation(),r==null||r(t.id,ea(new Date))},[r,t.id]),c=f.useCallback(S=>{S.stopPropagation(),r==null||r(t.id,ea(os(new Date,1)))},[r,t.id]),u=f.useCallback(S=>{S.stopPropagation(),r==null||r(t.id,ea(os(new Date,2)))},[r,t.id]),d=f.useCallback(S=>{S.stopPropagation(),r==null||r(t.id,null)},[r,t.id]),h=f.useCallback(S=>{S.stopPropagation(),a==null||a(t.id,"morning")},[a,t.id]),p=f.useCallback(S=>{S.stopPropagation(),a==null||a(t.id,"afternoon")},[a,t.id]),g=f.useCallback(S=>{S.stopPropagation(),a==null||a(t.id,"evening")},[a,t.id]),x=f.useCallback(S=>{S.stopPropagation(),s(t)},[s,t]),y=f.useCallback(()=>{n(t.id)},[n,t.id]),b=f.useCallback(S=>{S.stopPropagation(),i(`/task/${t.taskCode}/run`)},[i,t.taskCode]),v="h-6 w-6 md:h-5 md:w-5 p-0 rounded-full hover:bg-muted",w=r&&e.jsxs("div",{className:"flex gap-1 pr-2 border-r border-gray-200",children:[e.jsx($,{variant:"ghost",size:"icon",className:v,title:"Asignar para hoy",onClick:o,children:e.jsx("span",{role:"img","aria-label":"hoy",className:"text-xs",children:""})}),e.jsx($,{variant:"ghost",size:"icon",className:v,title:"Asignar para maana",onClick:c,children:e.jsx("span",{role:"img","aria-label":"maana",className:"text-xs",children:""})}),e.jsx($,{variant:"ghost",size:"icon",className:v,title:"Asignar para pasado maana",onClick:u,children:e.jsx("span",{role:"img","aria-label":"pasado maana",className:"text-xs",children:""})}),e.jsx($,{variant:"ghost",size:"icon",className:v,title:"Quitar fecha",onClick:d,children:e.jsx("span",{role:"img","aria-label":"sin fecha",className:"text-xs",children:""})})]}),N=a&&e.jsxs("div",{className:"flex gap-1 pl-2",children:[e.jsx($,{variant:"ghost",size:"icon",className:ce(v,"bg-amber-50 hover:bg-amber-100"),title:"Horario: Maana (6AM-12PM)",onClick:h,children:e.jsx("span",{role:"img","aria-label":"horario maana",className:"text-xs",children:""})}),e.jsx($,{variant:"ghost",size:"icon",className:ce(v,"bg-blue-50 hover:bg-blue-100"),title:"Horario: Tarde (12PM-6PM)",onClick:p,children:e.jsx("span",{role:"img","aria-label":"horario tarde",className:"text-xs",children:""})}),e.jsx($,{variant:"ghost",size:"icon",className:ce(v,"bg-purple-50 hover:bg-purple-100"),title:"Horario: Noche (6PM-12AM)",onClick:g,children:e.jsx("span",{role:"img","aria-label":"horario noche",className:"text-xs",children:""})})]});return e.jsxs("div",{className:"flex justify-between w-full",children:[e.jsxs("div",{className:"flex gap-1",children:[w,N]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx($,{variant:"ghost",size:"icon",className:v,title:"Ejecutar",onClick:b,children:e.jsx(Sn,{className:"w-3 h-3 md:w-3 md:h-3 text-green-600"})}),e.jsx($,{variant:"ghost",size:"icon",className:v,title:"Editar tarea",onClick:x,children:e.jsx(jr,{className:"w-3 h-3 md:w-3 md:h-3 text-muted-foreground"})}),e.jsxs(Wa,{children:[e.jsx(yi,{asChild:!0,children:e.jsx($,{variant:"ghost",size:"icon",className:ce(v,"hover:bg-red-50"),title:"Eliminar tarea",onClick:S=>S.stopPropagation(),children:e.jsx(Ws,{className:"w-3 h-3 md:w-3 md:h-3 text-red-500"})})}),e.jsxs(fa,{children:[e.jsxs(pa,{children:[e.jsx(ga,{children:"Eliminar tarea?"}),e.jsxs(va,{children:['Esta accin no se puede deshacer. La tarea "',t.title,'" ser eliminada permanentemente.']})]}),e.jsxs(xa,{children:[e.jsx(ba,{children:"Cancelar"}),e.jsx(ya,{onClick:y,className:"bg-red-600 hover:bg-red-700",children:"Eliminar"})]})]})]})]})]})});o1.displayName="TaskKanbanActions";const l1=f.memo(({task:t,onDelete:s,onEdit:n,onView:r,onMove:a,onAssignTimeOfDay:i,showCategoryLabel:o=!0})=>{const c=wF(t.startDate??null),{total:u,checked:d}=Um(t.description||""),h=u?t.progress??d/u*100:0,p=f.useCallback(()=>{r==null||r(t)},[r,t]),g=ce("cursor-pointer relative hover:shadow-md transition-all duration-200 border-0 shadow-sm text-sm w-full max-w-none lg:max-w-[18rem]",t.completed?"bg-muted/30":"bg-white",!t.completed&&c&&"border-l-4 border-l-red-500 bg-red-50");return e.jsxs(Ce,{onClick:p,className:g,children:[e.jsx(Ae,{className:"p-2 md:p-2 flex flex-col gap-1.5",children:e.jsx("div",{className:"flex items-start gap-2",children:e.jsxs("div",{className:"flex-1 min-w-0 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t.isPrivate&&e.jsx("span",{className:"text-xs",children:""}),e.jsx("span",{className:ce("text-sm break-words line-clamp-2 font-medium flex-1",t.completed?"line-through text-muted-foreground":"text-foreground"),children:t.title}),e.jsxs("span",{className:"text-xs font-mono text-gray-400 flex-shrink-0",children:["#",t.taskCode]})]}),e.jsx("div",{className:"flex flex-wrap gap-1 pt-0.5",children:e.jsx(i1,{task:t,showCategoryLabel:o,overdue:c})}),u>0&&e.jsxs("div",{className:"pt-1 space-y-0.5",children:[e.jsx(lr,{value:h,className:"h-1"}),e.jsxs("p",{className:"text-[10px] text-right text-muted-foreground",children:[d," de ",u]})]})]})})}),e.jsx(In,{className:"px-2 py-1.5 bg-gray-50/50 border-t border-gray-100 p-0 md:p-0",children:e.jsx("div",{className:"px-2 py-1.5 w-full",children:e.jsx(o1,{task:t,onEdit:n,onDelete:s,onMove:a,onAssignTimeOfDay:i})})})]})});l1.displayName="TaskItemKanban";const hb={all:"Todas las fechas",today:"Hoy",tomorrow:"Maana",week:"Esta semana",month:"Este mes",overdue:"Vencidas",noDate:"Sin fecha"},fb={all:"Todas",do:"do",decide:"decide",delegate:"delegate",delete:"delete"},pb={all:"Todas",none:"Sin tamao",pequea:"pequea",mediana:"mediana",grande:"grande"},Iu={all:"Todas",yes:"S",no:"No"},xb={all:"Todas",t60:"1h",t120:"2h",t180:"3h",none:"Sin estimacin"},gb={default:"Predeterminado",priorityAsc:"Prioridad ",priorityDesc:"Prioridad ",durationAsc:"Duracin ",durationDesc:"Duracin "},NF=({tasks:t,onDelete:s,onEdit:n,onView:r,onMove:a,onAdd:i,onFilteredTasksChange:o})=>{const[c,u]=f.useState(null),[d,h]=f.useState("all"),[p,g]=f.useState("today"),[x,y]=f.useState("all"),[b,v]=f.useState("all"),[w,N]=f.useState("all"),[S,E]=f.useState("all"),[k,D]=f.useState("all"),[T,R]=f.useState("default"),[O,U]=f.useState(!1),[I,_]=f.useState(""),M=f.useMemo(()=>{let H=t.filter(oe=>!oe.isRecurrent&&!oe.isPrivate);if(I.trim()){const oe=I.toLowerCase().trim();H=H.filter(J=>J.title.toLowerCase().includes(oe)||J.description&&J.description.toLowerCase().includes(oe))}if(d!=="all"&&(H=H.filter(oe=>oe.category===d)),x!=="all"&&(H=H.filter(oe=>oe.priority===x)),b!=="all"&&(b==="none"?H=H.filter(oe=>!oe.size):H=H.filter(oe=>oe.size===b)),k!=="all")if(k==="none")H=H.filter(oe=>oe.estimatedTime===void 0);else{const J={t60:60,t120:120,t180:180,all:1/0,none:0}[k];H=H.filter(ye=>(ye.estimatedTime??1/0)<=J)}w!=="all"&&(H=H.filter(oe=>{const J=oe.priority==="do"||oe.priority==="delegate";return w==="yes"?J:!J})),S!=="all"&&(H=H.filter(oe=>{const J=oe.priority==="do"||oe.priority==="decide";return S==="yes"?J:!J}));const ie=new Date,fe=ps(ie),le=Pa(ie),K=Rr(ie),de=ls(ie),je=vr(ie),ge=os(fe,1),Se=ci(ge);switch(p){case"today":return H.filter(oe=>oe.startDate&&Ro(oe.startDate,{start:fe,end:ci(ie)}));case"tomorrow":return H.filter(oe=>oe.startDate&&Ro(oe.startDate,{start:ge,end:Se}));case"week":return H.filter(oe=>oe.startDate&&Ro(oe.startDate,{start:le,end:K}));case"month":return H.filter(oe=>oe.startDate&&Ro(oe.startDate,{start:de,end:je}));case"overdue":return H.filter(oe=>oe.startDate&&Is(oe.startDate,fe));case"noDate":return H.filter(oe=>!oe.startDate);default:return H}},[t,d,x,b,w,S,k,p,I]);f.useEffect(()=>{o==null||o(M)},[M,o]);const W=f.useMemo(()=>I.trim()!==""||d!=="all"||p!=="today"||x!=="all"||b!=="all"||w!=="all"||S!=="all"||k!=="all",[I,d,p,x,b,w,S,k]),B=()=>{_(""),h("all"),g("today"),y("all"),v("all"),N("all"),E("all"),D("all"),R("default")},P=f.useMemo(()=>{const H=new Date,ie=ps(H),fe=ci(H),le=os(ps(H),1),K=ci(le),de=Rr(H),je={do:0,decide:1,delegate:2,delete:3},ge=M.reduce((oe,J)=>(J.startDate&&Is(J.startDate,ie)?oe.overdue.push(J):J.startDate?Is(J.startDate,fe)?oe.today.push(J):Is(J.startDate,K)?oe.tomorrow.push(J):Is(J.startDate,de)?oe.thisWeek.push(J):oe.future.push(J):oe.noDate.push(J),oe),{overdue:[],today:[],tomorrow:[],thisWeek:[],future:[],noDate:[]}),Se=(oe,J)=>{var qs,Ss;const ye=je[oe.priority||"none"]??4,xt=je[J.priority||"none"]??4,gt=oe.estimatedTime??1/0,dt=J.estimatedTime??1/0;switch(T){case"priorityAsc":if(ye!==xt)return xt-ye;break;case"priorityDesc":if(ye!==xt)return ye-xt;break;case"durationAsc":if(gt!==dt)return gt-dt;break;case"durationDesc":if(gt!==dt)return dt-gt;break;default:if(ye!==xt)return ye-xt}return oe.startDate&&J.startDate?oe.startDate.getTime()-J.startDate.getTime():!oe.startDate&&!J.startDate?(((qs=J.createdAt)==null?void 0:qs.seconds)||0)-(((Ss=oe.createdAt)==null?void 0:Ss.seconds)||0):oe.startDate?-1:1};return Object.values(ge).forEach(oe=>{oe.sort(Se)}),ge},[M,T]),z=f.useMemo(()=>{const H={overdue:0,today:0,tomorrow:0,thisWeek:0,future:0,noDate:0};return Object.keys(P).forEach(ie=>{H[ie]=P[ie].reduce((fe,le)=>fe+(le.estimatedTime||0),0)}),H},[P]),G=f.useMemo(()=>Object.values(z).reduce((H,ie)=>H+ie,0),[z]),ae=[{key:"overdue",title:"Vencidas"},{key:"today",title:"Para Hoy"},{key:"tomorrow",title:"Maana"},{key:"thisWeek",title:"Esta Semana"},{key:"future",title:"Prximamente"},{key:"noDate",title:"Sin Fecha"}],Y=H=>{const ie=new Date;switch(H){case"overdue":return ea(os(ps(ie),-1));case"today":return ea(ie);case"tomorrow":return ea(os(ps(ie),1));case"thisWeek":return ea(Rr(ie));case"future":return ea(Kc(ie,1));case"noDate":default:return null}},X=H=>{c&&(a(c.id,Y(H)),u(null))},se=()=>{const H=M.map(fe=>({nombre:fe.title,descripcin:fe.description||"",categoria:Qs[fe.category],prioridad:fe.priority||"sin prioridad",tamao:fe.size||"sin tamao",fecha:fe.startDate?new Date(fe.startDate).toLocaleDateString("es-ES"):"sin fecha",completada:fe.completed?"S":"No"})),ie=JSON.stringify(H,null,2);navigator.clipboard.writeText(ie).then(()=>{bt.success(`${H.length} tareas filtradas copiadas al portapapeles`)}).catch(()=>{bt.error("Error al copiar las tareas")})};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-end items-center text-xs text-gray-500 gap-1",children:[e.jsx(en,{className:"w-3 h-3"}),Fc(G)]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-4 items-stretch sm:items-center",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx($l,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(Fe,{placeholder:"Buscar tareas por nombre...",value:I,onChange:H=>_(H.target.value),className:"pl-10 pr-10"}),I&&e.jsx($,{variant:"ghost",size:"sm",onClick:()=>_(""),className:"absolute right-1 top-1/2 transform -translate-y-1/2 h-6 w-6 p-0 hover:bg-gray-100",children:e.jsx(Ws,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"md:hidden flex gap-2",children:[e.jsxs($,{variant:W?"default":"outline",onClick:()=>U(!O),className:`flex items-center gap-2 ${W?"bg-blue-600 hover:bg-blue-700":""}`,children:[e.jsx(xd,{className:"w-4 h-4"}),"Filtros",W&&e.jsx("span",{className:"bg-white text-blue-600 rounded-full px-2 py-0.5 text-xs font-medium",children:"Activos"})]}),W&&e.jsx($,{variant:"ghost",onClick:B,className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(Ws,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"hidden md:flex",children:W&&e.jsxs($,{variant:"ghost",onClick:B,className:"text-red-600 hover:text-red-700 hover:bg-red-50 flex items-center gap-2",children:[e.jsx(Ws,{className:"w-4 h-4"}),"Limpiar filtros"]})})]}),e.jsx("div",{className:`${O?"block":"hidden md:block"}`,children:e.jsxs("div",{className:"flex flex-wrap items-end gap-3 md:gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Categora"}),e.jsxs(Tt,{value:d,onValueChange:H=>h(H),children:[e.jsx(vt,{className:`w-32 ${d!=="all"?"border-blue-500 bg-blue-50":""}`,children:e.jsx(Dt,{children:d==="all"?"Todas":Qs[d]})}),e.jsxs(yt,{children:[e.jsx(Pe,{value:"all",children:"Todas"}),Object.values(Cd).map(H=>e.jsx(Pe,{value:H,children:Qs[H]},H))]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Fecha"}),e.jsxs(Tt,{value:p,onValueChange:H=>g(H),children:[e.jsx(vt,{className:`w-32 ${p!=="today"?"border-blue-500 bg-blue-50":""}`,children:e.jsx(Dt,{children:hb[p]})}),e.jsx(yt,{children:Object.entries(hb).map(([H,ie])=>e.jsx(Pe,{value:H,children:ie},H))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Prioridad"}),e.jsxs(Tt,{value:x,onValueChange:H=>y(H),children:[e.jsx(vt,{className:`w-24 ${x!=="all"?"border-blue-500 bg-blue-50":""}`,children:e.jsx(Dt,{children:fb[x]})}),e.jsx(yt,{children:Object.entries(fb).map(([H,ie])=>e.jsx(Pe,{value:H,children:ie},H))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Tamao"}),e.jsxs(Tt,{value:b,onValueChange:H=>v(H),children:[e.jsx(vt,{className:`w-24 ${b!=="all"?"border-blue-500 bg-blue-50":""}`,children:e.jsx(Dt,{children:pb[b]})}),e.jsx(yt,{children:Object.entries(pb).map(([H,ie])=>e.jsx(Pe,{value:H,children:ie},H))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Urgente"}),e.jsxs(Tt,{value:w,onValueChange:H=>N(H),children:[e.jsx(vt,{className:`w-20 ${w!=="all"?"border-blue-500 bg-blue-50":""}`,children:e.jsx(Dt,{children:Iu[w]})}),e.jsx(yt,{children:Object.entries(Iu).map(([H,ie])=>e.jsx(Pe,{value:H,children:ie},H))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Importante"}),e.jsxs(Tt,{value:S,onValueChange:H=>E(H),children:[e.jsx(vt,{className:`w-20 ${S!=="all"?"border-blue-500 bg-blue-50":""}`,children:e.jsx(Dt,{children:Iu[S]})}),e.jsx(yt,{children:Object.entries(Iu).map(([H,ie])=>e.jsx(Pe,{value:H,children:ie},H))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Estimado"}),e.jsxs(Tt,{value:k,onValueChange:H=>D(H),children:[e.jsx(vt,{className:`w-24 ${k!=="all"?"border-blue-500 bg-blue-50":""}`,children:e.jsx(Dt,{children:xb[k]})}),e.jsx(yt,{children:Object.entries(xb).map(([H,ie])=>e.jsx(Pe,{value:H,children:ie},H))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Ordenar"}),e.jsxs(Tt,{value:T,onValueChange:H=>R(H),children:[e.jsx(vt,{className:"w-28",children:e.jsx(Dt,{children:gb[T]})}),e.jsx(yt,{children:Object.entries(gb).map(([H,ie])=>e.jsx(Pe,{value:H,children:ie},H))})]})]}),e.jsx("div",{className:"flex items-end gap-2",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Exportar filtradas"}),e.jsxs($,{variant:"outline",size:"sm",onClick:se,className:"flex items-center gap-1 min-w-fit",disabled:M.length===0,title:`Copia al portapapeles las ${M.length} tareas que se muestran actualmente con todos los filtros aplicados`,children:[e.jsx(da,{className:"w-3 h-3"}),e.jsxs("span",{className:"whitespace-nowrap",children:["Copiar visibles (",M.length,")"]})]})]})})]})}),e.jsx("div",{className:"flex flex-col lg:flex-row items-start gap-2 lg:gap-4 overflow-x-auto pb-2 p-2 lg:p-3 rounded bg-gradient-to-br from-blue-50 via-indigo-50 to-indigo-100",children:ae.map(H=>e.jsxs("div",{className:"w-full lg:w-[16rem] xl:w-[18rem] lg:flex-shrink-0 space-y-2",onDragOver:ie=>ie.preventDefault(),onDrop:()=>X(H.key),children:[e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsxs("h3",{className:"font-medium text-xs lg:text-sm text-gray-500 uppercase tracking-wider flex items-center gap-1",children:[H.title,z[H.key]>0&&e.jsxs("span",{className:"text-[10px] text-gray-400 flex items-center gap-1",children:[e.jsx(en,{className:"w-3 h-3"}),Fc(z[H.key])]})]}),e.jsx("div",{className:"flex gap-1",children:e.jsx($,{size:"icon",variant:"ghost",onClick:()=>i(Y(H.key)),className:"h-6 w-6 lg:h-8 lg:w-8",children:e.jsx(cs,{className:"w-3 h-3 lg:w-4 lg:h-4"})})})]}),P[H.key].map(ie=>e.jsx("div",{draggable:!0,onDragStart:()=>u(ie),onDragEnd:()=>u(null),children:e.jsx(l1,{task:ie,onDelete:s,onEdit:n,onView:r,onMove:a,showCategoryLabel:d==="all"})},ie.id))]},H.key))})]})},SF={do:{color:"bg-red-500",text:"Hacer (urgente + importante)",label:" do"},decide:{color:"bg-orange-500",text:"Decidir (importante)",label:" decide"},delegate:{color:"bg-blue-500",text:"Delegar (urgente)",label:" delegate"},delete:{color:"bg-gray-400",text:"Eliminar (sin prioridad)",label:" delete"}},CF=()=>e.jsxs("div",{className:"mt-6 text-sm",children:[e.jsx("h2",{className:"font-medium mb-2",children:"Convenciones de prioridad"}),e.jsx("ul",{className:"space-y-1",children:Object.entries(SF).map(([t,s])=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(Mt,{className:`text-xs font-normal px-2 py-0.5 text-white ${s.color}`,children:s.label}),e.jsx("span",{children:s.text})]},t))})]}),Hi=Lr("task"),EF=Hi?`https://generativelanguage.googleapis.com/v1beta/models/${Hi.model}:generateContent`:"",c1=({tasks:t,open:s,onOpenChange:n})=>{const[r,a]=f.useState(!1),i=s!==void 0?s:r,o=n??a,[c,u]=f.useState(null),[d,h]=f.useState(""),[p,g]=f.useState(!1),[x,y]=f.useState(""),[b,v]=f.useState(0),w="AIzaSyAW4Ot-z7OH4ZR3OeaN7vcbkEDlWpo1aMY",N=(Hi==null?void 0:Hi.prompt)??"Eres un asistente de productividad. Basndote en el estado de nimo y las tareas pendientes sugiere cul debera abordar primero.",S=Hi==null?void 0:Hi.params;f.useEffect(()=>{if(c){const T=t.sort((R,O)=>{var U,I;return(((U=R.startDate)==null?void 0:U.getTime())||1/0)-(((I=O.startDate)==null?void 0:I.getTime())||1/0)}).slice(0,15).map(R=>`- ${R.title}${R.startDate?` (vence ${nt(R.startDate,"yyyy-MM-dd")})`:""} - ${Qs[R.category]}`).join(`
`);y(`${N}
Estado de nimo: ${c.text}
Tareas pendientes:
${T}`)}else y("")},[c,t]),f.useEffect(()=>{v(zr(x))},[x]);const E=T=>{try{const R=Ht.parse(T);return xi.sanitize(R)}catch(R){return console.error("Error procesando Markdown:",R),xi.sanitize(T.replace(/\n/g,"<br>"))}},k=async()=>{var T,R,O,U,I;if(c){g(!0);try{const M=await(await fetch(`${EF}?key=${w}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:x}]}],...S})})).json(),W=(I=(U=(O=(R=(T=M==null?void 0:M.candidates)==null?void 0:T[0])==null?void 0:R.content)==null?void 0:O.parts)==null?void 0:U[0])==null?void 0:I.text;h(W||"No se pudo obtener sugerencia")}catch{h("Error al consultar la API")}finally{g(!1)}}},D=()=>{o(!1),h(""),u(null)};return e.jsxs(kt,{open:i,onOpenChange:T=>T?o(!0):D(),children:[s===void 0&&e.jsxs($,{size:"sm",variant:"outline",onClick:()=>o(!0),className:"flex items-center gap-2",children:[e.jsx(Gs,{className:"w-4 h-4"}),"Sugerir tarea"]}),e.jsx(wt,{className:"max-w-6xl h-[80vh]",children:e.jsxs("div",{className:"flex-1 flex flex-col sm:flex-row gap-4 min-h-0 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[e.jsxs("div",{className:"flex-1 flex flex-col space-y-4 mb-3",children:[e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx("h2",{className:"text-lg font-medium mb-1",children:"Sugerencia de tarea con IA"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Selecciona tu estado de nimo para recibir recomendaciones personalizadas"})]}),!c&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Cmo te sientes?"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:Po.map(T=>e.jsx("div",{className:"relative",children:e.jsxs($,{variant:"outline",onClick:()=>u(T),className:"h-12 text-lg w-full relative",children:[e.jsx("span",{children:T.emoji}),e.jsx("span",{className:"w-full text-center text-xs text-gray-500 mt-1",children:T.text})]})},T.emoji))})]}),c&&e.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[e.jsx("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-3 p-2 bg-gray-50 rounded-md",children:e.jsxs("span",{children:["Estado de nimo: ",e.jsxs("strong",{children:[c.emoji," ",c.text]})]})}),e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Prompt para IA:"}),e.jsx(It,{value:x,onChange:T=>y(T.target.value),className:"flex-1 resize-none min-h-0",placeholder:"Modifica el prompt para personalizar la sugerencia..."})]})]}),c&&e.jsxs("div",{className:"flex flex-col gap-3 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"text-gray-500",children:["Tokens: ",b]}),b>3500&&e.jsx("span",{className:"text-red-500 font-medium",children:"Prompt demasiado largo!"})]}),e.jsxs($,{onClick:k,disabled:p||!w||b>3500,className:"w-full flex items-center justify-center gap-2",size:"lg",children:[p&&e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx(Gs,{className:"w-4 h-4"}),p?"Consultando IA...":"Generar sugerencia"]}),p&&e.jsx($a,{className:"mt-2"})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 sm:border-l sm:border-gray-200 sm:pl-4 border-t sm:border-t-0 border-gray-200 pt-4 sm:pt-0",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"Resultado"}),d?e.jsx("div",{className:"flex-1 p-4 bg-muted rounded-md overflow-auto",children:e.jsx("div",{className:`prose prose-sm max-w-none dark:prose-invert\r
                    prose-headings:text-foreground prose-p:text-foreground \r
                    prose-strong:text-foreground prose-ul:text-foreground \r
                    prose-ol:text-foreground prose-li:text-foreground\r
                    prose-code:bg-accent prose-code:px-1 prose-code:py-0.5 prose-code:rounded prose-code:text-foreground\r
                    prose-pre:bg-accent prose-pre:border prose-pre:text-foreground\r
                    prose-blockquote:border-l-accent prose-blockquote:text-foreground`,dangerouslySetInnerHTML:{__html:E(d)}})}):e.jsx("div",{className:"flex-1 flex items-center justify-center text-gray-500 text-sm",children:c?"Haz clic en 'Generar sugerencia' para obtener recomendaciones":"Selecciona tu estado de nimo para comenzar"})]})]})})]})},Ui=Lr("task"),TF=Ui?`https://generativelanguage.googleapis.com/v1beta/models/${Ui.model}:generateContent`:"",d1=({tasks:t,onUpdate:s,open:n,onOpenChange:r})=>{var E;const[a,i]=f.useState(!1),o=n!==void 0?n:a,c=r??i,[u,d]=f.useState(!1),[h,p]=f.useState(""),[g,x]=f.useState(""),[y,b]=f.useState(0),v="AIzaSyAW4Ot-z7OH4ZR3OeaN7vcbkEDlWpo1aMY",w=((E=Ui==null?void 0:Ui.prompts)==null?void 0:E.reprioritize)??"Analiza la lista de tareas y devuelve un JSON con id, urgent, important, size y estimatedTime (minutos).",N=Ui==null?void 0:Ui.params;f.useEffect(()=>{if(o){const k=t.map(D=>`- id:${D.id} title:${D.title} desc:${D.description||""} priority:${D.priority||""} size:${D.size||""} time:${D.estimatedTime||""}`).join(`
`);x(`${w}
${k}`)}},[o,t]),f.useEffect(()=>{b(zr(g))},[g]);const S=async()=>{var k,D,T,R,O;if(t.length!==0){d(!0);try{const I=await(await fetch(`${TF}?key=${v}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:g}]}],...N})})).json(),_=((O=(R=(T=(D=(k=I==null?void 0:I.candidates)==null?void 0:k[0])==null?void 0:D.content)==null?void 0:T.parts)==null?void 0:R[0])==null?void 0:O.text)||"";p(_);const M=_.match(/```json([\s\S]*?)```/),W=M?M[1]:_;JSON.parse(W).forEach(P=>{const z=P.urgent&&P.important?"do":P.important?"decide":P.urgent?"delegate":"delete";s(P.id,{priority:z,size:P.size,estimatedTime:P.estimatedTime})})}catch{p("Error al consultar la API")}finally{d(!1)}}};return e.jsxs(e.Fragment,{children:[n===void 0&&e.jsxs($,{size:"sm",variant:"outline",onClick:()=>c(!0),className:"flex items-center gap-2",children:[e.jsx(Gs,{className:"w-4 h-4"}),"Repriorizar"]}),e.jsx(kt,{open:o,onOpenChange:c,children:e.jsxs(wt,{className:"max-w-6xl h-[80vh]",children:[e.jsxs(At,{className:"flex-shrink-0 pb-1 space-y-0",children:[e.jsx(_t,{className:"text-lg font-medium",children:"Repriorizar Tareas con IA"}),e.jsx(cn,{className:"text-sm mt-1",children:"La IA analizar tus tareas y ajustar automticamente prioridad, tamao y tiempo estimado."})]}),e.jsxs("div",{className:"flex-1 flex flex-col sm:flex-row gap-4 min-h-0 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[e.jsxs("div",{className:"flex-1 flex flex-col mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2 flex-shrink-0",children:"Prompt para IA"}),e.jsx(It,{value:g,onChange:k=>x(k.target.value),className:"flex-1 resize-none min-h-0",placeholder:"Lista de tareas a analizar..."})]}),e.jsxs("div",{className:"flex flex-col gap-3 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"text-gray-500",children:["Tokens: ",y]}),y>3500&&e.jsx("span",{className:"text-red-500 font-medium",children:"Prompt demasiado largo!"})]}),e.jsxs($,{onClick:S,disabled:u||!v||y>3500,className:"w-full flex items-center justify-center gap-2",size:"lg",children:[u&&e.jsx(fs,{className:"w-4 h-4 animate-spin"}),e.jsx(Gs,{className:"w-4 h-4"}),u?"Analizando...":"Repriorizar tareas"]}),u&&e.jsx($a,{className:"mt-2"})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 sm:border-l sm:border-gray-200 sm:pl-4 border-t sm:border-t-0 border-gray-200 pt-4 sm:pt-0",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Resultado del anlisis"}),h&&e.jsxs($,{type:"button",size:"sm",variant:"outline",onClick:()=>{navigator.clipboard.writeText(h),bt.success("Anlisis copiado al portapapeles")},className:"flex items-center gap-1",children:[e.jsx(da,{className:"w-4 h-4"}),"Copiar"]})]}),e.jsx("div",{className:"flex-1 flex flex-col min-h-0",children:e.jsx("div",{className:"flex-1 bg-gray-50 border border-gray-200 rounded-md p-3 overflow-auto",children:h?e.jsx("pre",{className:"text-xs whitespace-pre-wrap font-mono text-gray-700",children:h}):u?e.jsx("div",{className:"text-sm text-gray-500",children:"Analizando tareas..."}):e.jsx("div",{className:"text-sm text-gray-500",children:"El anlisis y repriorizacion aparecer aqu. Las tareas se actualizarn automticamente una vez completado el anlisis."})})})]})]}),e.jsx("div",{className:"flex-shrink-0 mt-4 pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 text-xs text-gray-500",children:[e.jsx("span",{children:" Tip: Las tareas se actualizarn automticamente segn la matriz de Eisenhower"}),!v]})})]})})]})},DF={daily:"Diario",weekly:"Semanal",monthly:"Mensual"},vb={do:{label:"HACER",color:"bg-red-500",text:"Urgente e importante"},decide:{label:"DECIDIR",color:"bg-orange-500",text:"Importante, no urgente"},delegate:{label:"DELEGAR",color:"bg-blue-500",text:"Urgente, no importante"},delete:{label:"ELIMINAR",color:"bg-gray-500",text:"Ni urgente ni importante"},none:{label:"",color:"",text:""}},Yf={do:{icon:"",num:1,style:"bg-red-600 text-white"},decide:{icon:"",num:2,style:"bg-orange-500 text-white"},delegate:{icon:"",num:3,style:"bg-blue-500 text-white"},delete:{icon:"",num:4,style:"bg-gray-500 text-white"},none:{icon:"",num:4,style:"bg-gray-500 text-white"}},kF=t=>nt(t,"dd/MM"),AF=t=>t!=null&&t.type&&DF[t.type]||"",_F=(t="none")=>vb[t]||vb.none,RF=t=>t?Is(ps(t),ps(new Date)):!1,OF=(t,s)=>{const n=nt(t,"HH:mm");if(s){const r=nt(s,"HH:mm");return`${n} - ${r}`}return n},u1=f.memo(({task:t,showCategoryLabel:s,overdue:n})=>{var o,c;const r={bg:((o=Ra[t.category])==null?void 0:o.bg)||"bg-purple-100",text:((c=Ra[t.category])==null?void 0:c.text)||"text-purple-800"},a=_F(t.priority),i=AF(t.recurrence);return e.jsxs("div",{className:"flex flex-wrap gap-0.5 leading-none",children:[s&&e.jsxs(Mt,{className:ce("text-xs px-1 py-0 h-auto",r.bg,r.text),children:[e.jsx(Cl,{className:"w-3 h-3 mr-0.5"}),Qs[t.category]]}),t.startDate&&e.jsxs(Mt,{variant:n?"destructive":"secondary",className:"text-xs px-1 py-0 h-auto",children:[e.jsx(ns,{className:"w-3 h-3 mr-0.5"}),kF(t.startDate),n&&" (vencida)"]}),t.startDate&&(t.startDate.getHours()!==12||t.startDate.getMinutes()!==0)&&e.jsxs(Mt,{variant:"outline",className:"text-xs px-1 py-0 h-auto bg-blue-50 text-blue-700",children:[e.jsx(en,{className:"w-3 h-3 mr-0.5"}),OF(t.startDate,t.endDate)]}),e.jsx(Mr,{children:e.jsxs(Hs,{children:[e.jsx(Us,{asChild:!0,children:e.jsxs(Mt,{className:ce("text-xs px-1 py-0 h-auto gap-0.5",Yf[t.priority||"none"].style),children:[e.jsx("span",{children:Yf[t.priority||"none"].icon}),Yf[t.priority||"none"].num]})}),e.jsx(Ls,{children:a.text})]})}),t.estimatedTime!==void 0&&e.jsxs(Mt,{variant:"outline",className:"text-xs px-1 py-0 h-auto",children:[e.jsx(en,{className:"w-3 h-3 mr-0.5"}),t.estimatedTime,"m"]}),t.isRecurrent&&i&&e.jsxs(Mt,{variant:"outline",className:"text-xs px-1 py-0 h-auto",children:[e.jsx(cx,{className:"w-3 h-3 mr-0.5"}),i]}),!s&&t.size&&e.jsx(Mt,{variant:"outline",className:"text-xs px-1 py-0 h-auto",children:t.size})]})});u1.displayName="TaskBadges";const m1=f.memo(({task:t,onEdit:s,onDelete:n,onMove:r})=>{const a=Qt(),i=f.useCallback(x=>{x.stopPropagation(),r==null||r(t.id,ea(new Date))},[r,t.id]),o=f.useCallback(x=>{x.stopPropagation(),r==null||r(t.id,ea(os(new Date,1)))},[r,t.id]),c=f.useCallback(x=>{x.stopPropagation(),r==null||r(t.id,ea(os(new Date,2)))},[r,t.id]),u=f.useCallback(x=>{x.stopPropagation(),r==null||r(t.id,null)},[r,t.id]),d=f.useCallback(x=>{x.stopPropagation(),s(t)},[s,t]),h=f.useCallback(()=>{n(t.id)},[n,t.id]),p=f.useCallback(x=>{x.stopPropagation(),a(`/task/${t.taskCode}/run`)},[a,t.taskCode]),g="h-4 w-4 p-0 rounded-full hover:bg-muted";return e.jsxs("div",{className:"flex items-center justify-center gap-0.5 py-0.5",children:[r&&e.jsxs("div",{className:"flex gap-0.5 pr-1 border-r border-gray-200",children:[e.jsx($,{variant:"ghost",size:"icon",className:g,title:"Asignar para hoy",onClick:i,children:e.jsx("span",{role:"img","aria-label":"hoy",className:"text-[10px]",children:""})}),e.jsx($,{variant:"ghost",size:"icon",className:g,title:"Asignar para maana",onClick:o,children:e.jsx("span",{role:"img","aria-label":"maana",className:"text-[10px]",children:""})}),e.jsx($,{variant:"ghost",size:"icon",className:g,title:"Asignar para pasado maana",onClick:c,children:e.jsx("span",{role:"img","aria-label":"pasado maana",className:"text-[10px]",children:""})}),e.jsx($,{variant:"ghost",size:"icon",className:g,title:"Quitar fecha",onClick:u,children:e.jsx("span",{role:"img","aria-label":"sin fecha",className:"text-[10px]",children:""})})]}),e.jsx($,{variant:"ghost",size:"icon",className:g,title:"Ejecutar",onClick:p,children:e.jsx(Sn,{className:"w-2.5 h-2.5 text-green-600"})}),e.jsx($,{variant:"ghost",size:"icon",className:g,title:"Editar tarea",onClick:d,children:e.jsx(jr,{className:"w-2.5 h-2.5 text-muted-foreground"})}),e.jsxs(Wa,{children:[e.jsx(yi,{asChild:!0,children:e.jsx($,{variant:"ghost",size:"icon",className:ce(g,"hover:bg-red-50"),title:"Eliminar tarea",onClick:x=>x.stopPropagation(),children:e.jsx(Ws,{className:"w-2.5 h-2.5 text-red-500"})})}),e.jsxs(fa,{children:[e.jsxs(pa,{children:[e.jsx(ga,{children:"Eliminar tarea?"}),e.jsxs(va,{children:['Esta accin no se puede deshacer. La tarea "',t.title,'" ser eliminada permanentemente.']})]}),e.jsxs(xa,{children:[e.jsx(ba,{children:"Cancelar"}),e.jsx(ya,{onClick:h,className:"bg-red-600 hover:bg-red-700",children:"Eliminar"})]})]})]})]})});m1.displayName="TaskCalendarActions";const Ad=f.memo(({task:t,onDelete:s,onEdit:n,onView:r,onMove:a,showCategoryLabel:i=!0})=>{const o=RF(t.startDate??null),{total:c,checked:u}=Um(t.description||""),d=c?t.progress??u/c*100:0,h=f.useCallback(()=>{r==null||r(t)},[r,t]),p=ce("cursor-pointer relative hover:shadow-md transition-all duration-200 border-0 shadow-sm bg-white",t.completed&&"opacity-70 bg-gray-50",!t.completed&&o&&"border-l-4 border-l-red-500 bg-red-50");return e.jsxs(Ce,{onClick:h,className:p,children:[e.jsxs(Ae,{className:"px-1 py-0.5 space-y-0.5",children:[e.jsx("div",{className:"space-y-0",children:e.jsxs("div",{className:"flex items-center gap-1",children:[t.isPrivate&&e.jsx("span",{className:"text-[10px]",children:""}),e.jsx("span",{className:ce("text-xs font-medium leading-none line-clamp-1 flex-1",t.completed?"line-through text-muted-foreground":"text-foreground"),children:t.title}),e.jsxs("span",{className:"text-[10px] font-mono text-gray-400 flex-shrink-0",children:["#",t.taskCode]})]})}),e.jsx(u1,{task:t,showCategoryLabel:i,overdue:o}),c>0&&e.jsxs("div",{className:"space-y-0",children:[e.jsx(lr,{value:d,className:"h-0.5"}),e.jsxs("p",{className:"text-[10px] text-right text-muted-foreground leading-none",children:[u," de ",c]})]})]}),e.jsx(In,{className:"!px-0.5 !py-0.5 bg-gray-50/50 border-t border-gray-100",children:e.jsx("div",{className:"w-full",children:e.jsx(m1,{task:t,onEdit:n,onDelete:s,onMove:a})})})]})});Ad.displayName="TaskItemCalendar";const PF=({tasks:t,onDelete:s,onEdit:n,onView:r,onMove:a})=>{const i=ps(new Date),o=f.useMemo(()=>t.filter(c=>c.startDate?Is(c.startDate,i)&&!c.completed:!1).sort((c,u)=>c.startDate&&u.startDate?c.startDate.getTime()-u.startDate.getTime():0),[t,i]);return o.length===0?null:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"sticky top-0 bg-white py-2 z-10",children:e.jsxs("h3",{className:"text-sm font-semibold text-red-600 flex items-center gap-2",children:[e.jsx("span",{children:""}),"Tareas Vencidas (",o.length,")"]})}),e.jsx("div",{className:"space-y-2",children:o.map(c=>e.jsx(Ad,{task:c,onDelete:s,onEdit:n,onView:r,onMove:a,showCategoryLabel:!0},c.id))})]})},rh=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function ql(t){const s=Object.prototype.toString.call(t);return s==="[object Window]"||s==="[object global]"}function ig(t){return"nodeType"in t}function cr(t){var s,n;return t?ql(t)?t:ig(t)&&(s=(n=t.ownerDocument)==null?void 0:n.defaultView)!=null?s:window:window}function og(t){const{Document:s}=cr(t);return t instanceof s}function _d(t){return ql(t)?!1:t instanceof cr(t).HTMLElement}function h1(t){return t instanceof cr(t).SVGElement}function Kl(t){return t?ql(t)?t.document:ig(t)?og(t)?t:_d(t)||h1(t)?t.ownerDocument:document:document:document}const co=rh?f.useLayoutEffect:f.useEffect;function lg(t){const s=f.useRef(t);return co(()=>{s.current=t}),f.useCallback(function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return s.current==null?void 0:s.current(...r)},[])}function MF(){const t=f.useRef(null),s=f.useCallback((r,a)=>{t.current=setInterval(r,a)},[]),n=f.useCallback(()=>{t.current!==null&&(clearInterval(t.current),t.current=null)},[]);return[s,n]}function cg(t,s){s===void 0&&(s=[t]);const n=f.useRef(t);return co(()=>{n.current!==t&&(n.current=t)},s),n}function Rd(t,s){const n=f.useRef();return f.useMemo(()=>{const r=t(n.current);return n.current=r,r},[...s])}function zp(t){const s=lg(t),n=f.useRef(null),r=f.useCallback(a=>{a!==n.current&&(s==null||s(a,n.current)),n.current=a},[]);return[n,r]}function Fp(t){const s=f.useRef();return f.useEffect(()=>{s.current=t},[t]),s.current}let Vf={};function dg(t,s){return f.useMemo(()=>{if(s)return s;const n=Vf[t]==null?0:Vf[t]+1;return Vf[t]=n,t+"-"+n},[t,s])}function f1(t){return function(s){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return r.reduce((i,o)=>{const c=Object.entries(o);for(const[u,d]of c){const h=i[u];h!=null&&(i[u]=h+t*d)}return i},{...s})}}const xl=f1(1),xm=f1(-1);function IF(t){return"clientX"in t&&"clientY"in t}function p1(t){if(!t)return!1;const{KeyboardEvent:s}=cr(t.target);return s&&t instanceof s}function LF(t){if(!t)return!1;const{TouchEvent:s}=cr(t.target);return s&&t instanceof s}function Bp(t){if(LF(t)){if(t.touches&&t.touches.length){const{clientX:s,clientY:n}=t.touches[0];return{x:s,y:n}}else if(t.changedTouches&&t.changedTouches.length){const{clientX:s,clientY:n}=t.changedTouches[0];return{x:s,y:n}}}return IF(t)?{x:t.clientX,y:t.clientY}:null}const gm=Object.freeze({Translate:{toString(t){if(!t)return;const{x:s,y:n}=t;return"translate3d("+(s?Math.round(s):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(t){if(!t)return;const{scaleX:s,scaleY:n}=t;return"scaleX("+s+") scaleY("+n+")"}},Transform:{toString(t){if(t)return[gm.Translate.toString(t),gm.Scale.toString(t)].join(" ")}},Transition:{toString(t){let{property:s,duration:n,easing:r}=t;return s+" "+n+"ms "+r}}}),yb="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function $F(t){return t.matches(yb)?t:t.querySelector(yb)}const zF={display:"none"};function FF(t){let{id:s,value:n}=t;return ee.createElement("div",{id:s,style:zF},n)}function BF(t){let{id:s,announcement:n,ariaLiveType:r="assertive"}=t;const a={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return ee.createElement("div",{id:s,style:a,role:"status","aria-live":r,"aria-atomic":!0},n)}function HF(){const[t,s]=f.useState("");return{announce:f.useCallback(r=>{r!=null&&s(r)},[]),announcement:t}}const x1=f.createContext(null);function UF(t){const s=f.useContext(x1);f.useEffect(()=>{if(!s)throw new Error("useDndMonitor must be used within a children of <DndContext>");return s(t)},[t,s])}function WF(){const[t]=f.useState(()=>new Set),s=f.useCallback(r=>(t.add(r),()=>t.delete(r)),[t]);return[f.useCallback(r=>{let{type:a,event:i}=r;t.forEach(o=>{var c;return(c=o[a])==null?void 0:c.call(o,i)})},[t]),s]}const YF={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},VF={onDragStart(t){let{active:s}=t;return"Picked up draggable item "+s.id+"."},onDragOver(t){let{active:s,over:n}=t;return n?"Draggable item "+s.id+" was moved over droppable area "+n.id+".":"Draggable item "+s.id+" is no longer over a droppable area."},onDragEnd(t){let{active:s,over:n}=t;return n?"Draggable item "+s.id+" was dropped over droppable area "+n.id:"Draggable item "+s.id+" was dropped."},onDragCancel(t){let{active:s}=t;return"Dragging was cancelled. Draggable item "+s.id+" was dropped."}};function GF(t){let{announcements:s=VF,container:n,hiddenTextDescribedById:r,screenReaderInstructions:a=YF}=t;const{announce:i,announcement:o}=HF(),c=dg("DndLiveRegion"),[u,d]=f.useState(!1);if(f.useEffect(()=>{d(!0)},[]),UF(f.useMemo(()=>({onDragStart(p){let{active:g}=p;i(s.onDragStart({active:g}))},onDragMove(p){let{active:g,over:x}=p;s.onDragMove&&i(s.onDragMove({active:g,over:x}))},onDragOver(p){let{active:g,over:x}=p;i(s.onDragOver({active:g,over:x}))},onDragEnd(p){let{active:g,over:x}=p;i(s.onDragEnd({active:g,over:x}))},onDragCancel(p){let{active:g,over:x}=p;i(s.onDragCancel({active:g,over:x}))}}),[i,s])),!u)return null;const h=ee.createElement(ee.Fragment,null,ee.createElement(FF,{id:r,value:a.draggable}),ee.createElement(BF,{id:c,announcement:o}));return n?Ki.createPortal(h,n):h}var _n;(function(t){t.DragStart="dragStart",t.DragMove="dragMove",t.DragEnd="dragEnd",t.DragCancel="dragCancel",t.DragOver="dragOver",t.RegisterDroppable="registerDroppable",t.SetDroppableDisabled="setDroppableDisabled",t.UnregisterDroppable="unregisterDroppable"})(_n||(_n={}));function vm(){}function qF(t,s){return f.useMemo(()=>({sensor:t,options:s??{}}),[t,s])}function KF(){for(var t=arguments.length,s=new Array(t),n=0;n<t;n++)s[n]=arguments[n];return f.useMemo(()=>[...s].filter(r=>r!=null),[...s])}const ca=Object.freeze({x:0,y:0});function JF(t,s){let{data:{value:n}}=t,{data:{value:r}}=s;return r-n}function XF(t,s){if(!t||t.length===0)return null;const[n]=t;return n[s]}function ZF(t,s){const n=Math.max(s.top,t.top),r=Math.max(s.left,t.left),a=Math.min(s.left+s.width,t.left+t.width),i=Math.min(s.top+s.height,t.top+t.height),o=a-r,c=i-n;if(r<a&&n<i){const u=s.width*s.height,d=t.width*t.height,h=o*c,p=h/(u+d-h);return Number(p.toFixed(4))}return 0}const QF=t=>{let{collisionRect:s,droppableRects:n,droppableContainers:r}=t;const a=[];for(const i of r){const{id:o}=i,c=n.get(o);if(c){const u=ZF(c,s);u>0&&a.push({id:o,data:{droppableContainer:i,value:u}})}}return a.sort(JF)};function eB(t,s,n){return{...t,scaleX:s&&n?s.width/n.width:1,scaleY:s&&n?s.height/n.height:1}}function g1(t,s){return t&&s?{x:t.left-s.left,y:t.top-s.top}:ca}function tB(t){return function(n){for(var r=arguments.length,a=new Array(r>1?r-1:0),i=1;i<r;i++)a[i-1]=arguments[i];return a.reduce((o,c)=>({...o,top:o.top+t*c.y,bottom:o.bottom+t*c.y,left:o.left+t*c.x,right:o.right+t*c.x}),{...n})}}const sB=tB(1);function nB(t){if(t.startsWith("matrix3d(")){const s=t.slice(9,-1).split(/, /);return{x:+s[12],y:+s[13],scaleX:+s[0],scaleY:+s[5]}}else if(t.startsWith("matrix(")){const s=t.slice(7,-1).split(/, /);return{x:+s[4],y:+s[5],scaleX:+s[0],scaleY:+s[3]}}return null}function rB(t,s,n){const r=nB(s);if(!r)return t;const{scaleX:a,scaleY:i,x:o,y:c}=r,u=t.left-o-(1-a)*parseFloat(n),d=t.top-c-(1-i)*parseFloat(n.slice(n.indexOf(" ")+1)),h=a?t.width/a:t.width,p=i?t.height/i:t.height;return{width:h,height:p,top:d,right:u+h,bottom:d+p,left:u}}const aB={ignoreTransform:!1};function Od(t,s){s===void 0&&(s=aB);let n=t.getBoundingClientRect();if(s.ignoreTransform){const{transform:d,transformOrigin:h}=cr(t).getComputedStyle(t);d&&(n=rB(n,d,h))}const{top:r,left:a,width:i,height:o,bottom:c,right:u}=n;return{top:r,left:a,width:i,height:o,bottom:c,right:u}}function bb(t){return Od(t,{ignoreTransform:!0})}function iB(t){const s=t.innerWidth,n=t.innerHeight;return{top:0,left:0,right:s,bottom:n,width:s,height:n}}function oB(t,s){return s===void 0&&(s=cr(t).getComputedStyle(t)),s.position==="fixed"}function lB(t,s){s===void 0&&(s=cr(t).getComputedStyle(t));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(a=>{const i=s[a];return typeof i=="string"?n.test(i):!1})}function ug(t,s){const n=[];function r(a){if(s!=null&&n.length>=s||!a)return n;if(og(a)&&a.scrollingElement!=null&&!n.includes(a.scrollingElement))return n.push(a.scrollingElement),n;if(!_d(a)||h1(a)||n.includes(a))return n;const i=cr(t).getComputedStyle(a);return a!==t&&lB(a,i)&&n.push(a),oB(a,i)?n:r(a.parentNode)}return t?r(t):n}function v1(t){const[s]=ug(t,1);return s??null}function Gf(t){return!rh||!t?null:ql(t)?t:ig(t)?og(t)||t===Kl(t).scrollingElement?window:_d(t)?t:null:null}function y1(t){return ql(t)?t.scrollX:t.scrollLeft}function b1(t){return ql(t)?t.scrollY:t.scrollTop}function Hp(t){return{x:y1(t),y:b1(t)}}var fn;(function(t){t[t.Forward=1]="Forward",t[t.Backward=-1]="Backward"})(fn||(fn={}));function j1(t){return!rh||!t?!1:t===document.scrollingElement}function w1(t){const s={x:0,y:0},n=j1(t)?{height:window.innerHeight,width:window.innerWidth}:{height:t.clientHeight,width:t.clientWidth},r={x:t.scrollWidth-n.width,y:t.scrollHeight-n.height},a=t.scrollTop<=s.y,i=t.scrollLeft<=s.x,o=t.scrollTop>=r.y,c=t.scrollLeft>=r.x;return{isTop:a,isLeft:i,isBottom:o,isRight:c,maxScroll:r,minScroll:s}}const cB={x:.2,y:.2};function dB(t,s,n,r,a){let{top:i,left:o,right:c,bottom:u}=n;r===void 0&&(r=10),a===void 0&&(a=cB);const{isTop:d,isBottom:h,isLeft:p,isRight:g}=w1(t),x={x:0,y:0},y={x:0,y:0},b={height:s.height*a.y,width:s.width*a.x};return!d&&i<=s.top+b.height?(x.y=fn.Backward,y.y=r*Math.abs((s.top+b.height-i)/b.height)):!h&&u>=s.bottom-b.height&&(x.y=fn.Forward,y.y=r*Math.abs((s.bottom-b.height-u)/b.height)),!g&&c>=s.right-b.width?(x.x=fn.Forward,y.x=r*Math.abs((s.right-b.width-c)/b.width)):!p&&o<=s.left+b.width&&(x.x=fn.Backward,y.x=r*Math.abs((s.left+b.width-o)/b.width)),{direction:x,speed:y}}function uB(t){if(t===document.scrollingElement){const{innerWidth:i,innerHeight:o}=window;return{top:0,left:0,right:i,bottom:o,width:i,height:o}}const{top:s,left:n,right:r,bottom:a}=t.getBoundingClientRect();return{top:s,left:n,right:r,bottom:a,width:t.clientWidth,height:t.clientHeight}}function N1(t){return t.reduce((s,n)=>xl(s,Hp(n)),ca)}function mB(t){return t.reduce((s,n)=>s+y1(n),0)}function hB(t){return t.reduce((s,n)=>s+b1(n),0)}function fB(t,s){if(s===void 0&&(s=Od),!t)return;const{top:n,left:r,bottom:a,right:i}=s(t);v1(t)&&(a<=0||i<=0||n>=window.innerHeight||r>=window.innerWidth)&&t.scrollIntoView({block:"center",inline:"center"})}const pB=[["x",["left","right"],mB],["y",["top","bottom"],hB]];class mg{constructor(s,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const r=ug(n),a=N1(r);this.rect={...s},this.width=s.width,this.height=s.height;for(const[i,o,c]of pB)for(const u of o)Object.defineProperty(this,u,{get:()=>{const d=c(r),h=a[i]-d;return this.rect[u]+h},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Bc{constructor(s){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var r;return(r=this.target)==null?void 0:r.removeEventListener(...n)})},this.target=s}add(s,n,r){var a;(a=this.target)==null||a.addEventListener(s,n,r),this.listeners.push([s,n,r])}}function xB(t){const{EventTarget:s}=cr(t);return t instanceof s?t:Kl(t)}function qf(t,s){const n=Math.abs(t.x),r=Math.abs(t.y);return typeof s=="number"?Math.sqrt(n**2+r**2)>s:"x"in s&&"y"in s?n>s.x&&r>s.y:"x"in s?n>s.x:"y"in s?r>s.y:!1}var Ar;(function(t){t.Click="click",t.DragStart="dragstart",t.Keydown="keydown",t.ContextMenu="contextmenu",t.Resize="resize",t.SelectionChange="selectionchange",t.VisibilityChange="visibilitychange"})(Ar||(Ar={}));function jb(t){t.preventDefault()}function gB(t){t.stopPropagation()}var hs;(function(t){t.Space="Space",t.Down="ArrowDown",t.Right="ArrowRight",t.Left="ArrowLeft",t.Up="ArrowUp",t.Esc="Escape",t.Enter="Enter",t.Tab="Tab"})(hs||(hs={}));const S1={start:[hs.Space,hs.Enter],cancel:[hs.Esc],end:[hs.Space,hs.Enter,hs.Tab]},vB=(t,s)=>{let{currentCoordinates:n}=s;switch(t.code){case hs.Right:return{...n,x:n.x+25};case hs.Left:return{...n,x:n.x-25};case hs.Down:return{...n,y:n.y+25};case hs.Up:return{...n,y:n.y-25}}};class C1{constructor(s){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=s;const{event:{target:n}}=s;this.props=s,this.listeners=new Bc(Kl(n)),this.windowListeners=new Bc(cr(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Ar.Resize,this.handleCancel),this.windowListeners.add(Ar.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Ar.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:s,onStart:n}=this.props,r=s.node.current;r&&fB(r),n(ca)}handleKeyDown(s){if(p1(s)){const{active:n,context:r,options:a}=this.props,{keyboardCodes:i=S1,coordinateGetter:o=vB,scrollBehavior:c="smooth"}=a,{code:u}=s;if(i.end.includes(u)){this.handleEnd(s);return}if(i.cancel.includes(u)){this.handleCancel(s);return}const{collisionRect:d}=r.current,h=d?{x:d.left,y:d.top}:ca;this.referenceCoordinates||(this.referenceCoordinates=h);const p=o(s,{active:n,context:r.current,currentCoordinates:h});if(p){const g=xm(p,h),x={x:0,y:0},{scrollableAncestors:y}=r.current;for(const b of y){const v=s.code,{isTop:w,isRight:N,isLeft:S,isBottom:E,maxScroll:k,minScroll:D}=w1(b),T=uB(b),R={x:Math.min(v===hs.Right?T.right-T.width/2:T.right,Math.max(v===hs.Right?T.left:T.left+T.width/2,p.x)),y:Math.min(v===hs.Down?T.bottom-T.height/2:T.bottom,Math.max(v===hs.Down?T.top:T.top+T.height/2,p.y))},O=v===hs.Right&&!N||v===hs.Left&&!S,U=v===hs.Down&&!E||v===hs.Up&&!w;if(O&&R.x!==p.x){const I=b.scrollLeft+g.x,_=v===hs.Right&&I<=k.x||v===hs.Left&&I>=D.x;if(_&&!g.y){b.scrollTo({left:I,behavior:c});return}_?x.x=b.scrollLeft-I:x.x=v===hs.Right?b.scrollLeft-k.x:b.scrollLeft-D.x,x.x&&b.scrollBy({left:-x.x,behavior:c});break}else if(U&&R.y!==p.y){const I=b.scrollTop+g.y,_=v===hs.Down&&I<=k.y||v===hs.Up&&I>=D.y;if(_&&!g.x){b.scrollTo({top:I,behavior:c});return}_?x.y=b.scrollTop-I:x.y=v===hs.Down?b.scrollTop-k.y:b.scrollTop-D.y,x.y&&b.scrollBy({top:-x.y,behavior:c});break}}this.handleMove(s,xl(xm(p,this.referenceCoordinates),x))}}}handleMove(s,n){const{onMove:r}=this.props;s.preventDefault(),r(n)}handleEnd(s){const{onEnd:n}=this.props;s.preventDefault(),this.detach(),n()}handleCancel(s){const{onCancel:n}=this.props;s.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}C1.activators=[{eventName:"onKeyDown",handler:(t,s,n)=>{let{keyboardCodes:r=S1,onActivation:a}=s,{active:i}=n;const{code:o}=t.nativeEvent;if(r.start.includes(o)){const c=i.activatorNode.current;return c&&t.target!==c?!1:(t.preventDefault(),a==null||a({event:t.nativeEvent}),!0)}return!1}}];function wb(t){return!!(t&&"distance"in t)}function Nb(t){return!!(t&&"delay"in t)}class hg{constructor(s,n,r){var a;r===void 0&&(r=xB(s.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=s,this.events=n;const{event:i}=s,{target:o}=i;this.props=s,this.events=n,this.document=Kl(o),this.documentListeners=new Bc(this.document),this.listeners=new Bc(r),this.windowListeners=new Bc(cr(o)),this.initialCoordinates=(a=Bp(i))!=null?a:ca,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:s,props:{options:{activationConstraint:n,bypassActivationConstraint:r}}}=this;if(this.listeners.add(s.move.name,this.handleMove,{passive:!1}),this.listeners.add(s.end.name,this.handleEnd),s.cancel&&this.listeners.add(s.cancel.name,this.handleCancel),this.windowListeners.add(Ar.Resize,this.handleCancel),this.windowListeners.add(Ar.DragStart,jb),this.windowListeners.add(Ar.VisibilityChange,this.handleCancel),this.windowListeners.add(Ar.ContextMenu,jb),this.documentListeners.add(Ar.Keydown,this.handleKeydown),n){if(r!=null&&r({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(Nb(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if(wb(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(s,n){const{active:r,onPending:a}=this.props;a(r,s,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:s}=this,{onStart:n}=this.props;s&&(this.activated=!0,this.documentListeners.add(Ar.Click,gB,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Ar.SelectionChange,this.removeTextSelection),n(s))}handleMove(s){var n;const{activated:r,initialCoordinates:a,props:i}=this,{onMove:o,options:{activationConstraint:c}}=i;if(!a)return;const u=(n=Bp(s))!=null?n:ca,d=xm(a,u);if(!r&&c){if(wb(c)){if(c.tolerance!=null&&qf(d,c.tolerance))return this.handleCancel();if(qf(d,c.distance))return this.handleStart()}if(Nb(c)&&qf(d,c.tolerance))return this.handleCancel();this.handlePending(c,d);return}s.cancelable&&s.preventDefault(),o(u)}handleEnd(){const{onAbort:s,onEnd:n}=this.props;this.detach(),this.activated||s(this.props.active),n()}handleCancel(){const{onAbort:s,onCancel:n}=this.props;this.detach(),this.activated||s(this.props.active),n()}handleKeydown(s){s.code===hs.Esc&&this.handleCancel()}removeTextSelection(){var s;(s=this.document.getSelection())==null||s.removeAllRanges()}}const yB={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class fg extends hg{constructor(s){const{event:n}=s,r=Kl(n.target);super(s,yB,r)}}fg.activators=[{eventName:"onPointerDown",handler:(t,s)=>{let{nativeEvent:n}=t,{onActivation:r}=s;return!n.isPrimary||n.button!==0?!1:(r==null||r({event:n}),!0)}}];const bB={move:{name:"mousemove"},end:{name:"mouseup"}};var Up;(function(t){t[t.RightClick=2]="RightClick"})(Up||(Up={}));class jB extends hg{constructor(s){super(s,bB,Kl(s.event.target))}}jB.activators=[{eventName:"onMouseDown",handler:(t,s)=>{let{nativeEvent:n}=t,{onActivation:r}=s;return n.button===Up.RightClick?!1:(r==null||r({event:n}),!0)}}];const Kf={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class wB extends hg{constructor(s){super(s,Kf)}static setup(){return window.addEventListener(Kf.move.name,s,{capture:!1,passive:!1}),function(){window.removeEventListener(Kf.move.name,s)};function s(){}}}wB.activators=[{eventName:"onTouchStart",handler:(t,s)=>{let{nativeEvent:n}=t,{onActivation:r}=s;const{touches:a}=n;return a.length>1?!1:(r==null||r({event:n}),!0)}}];var Hc;(function(t){t[t.Pointer=0]="Pointer",t[t.DraggableRect=1]="DraggableRect"})(Hc||(Hc={}));var ym;(function(t){t[t.TreeOrder=0]="TreeOrder",t[t.ReversedTreeOrder=1]="ReversedTreeOrder"})(ym||(ym={}));function NB(t){let{acceleration:s,activator:n=Hc.Pointer,canScroll:r,draggingRect:a,enabled:i,interval:o=5,order:c=ym.TreeOrder,pointerCoordinates:u,scrollableAncestors:d,scrollableAncestorRects:h,delta:p,threshold:g}=t;const x=CB({delta:p,disabled:!i}),[y,b]=MF(),v=f.useRef({x:0,y:0}),w=f.useRef({x:0,y:0}),N=f.useMemo(()=>{switch(n){case Hc.Pointer:return u?{top:u.y,bottom:u.y,left:u.x,right:u.x}:null;case Hc.DraggableRect:return a}},[n,a,u]),S=f.useRef(null),E=f.useCallback(()=>{const D=S.current;if(!D)return;const T=v.current.x*w.current.x,R=v.current.y*w.current.y;D.scrollBy(T,R)},[]),k=f.useMemo(()=>c===ym.TreeOrder?[...d].reverse():d,[c,d]);f.useEffect(()=>{if(!i||!d.length||!N){b();return}for(const D of k){if((r==null?void 0:r(D))===!1)continue;const T=d.indexOf(D),R=h[T];if(!R)continue;const{direction:O,speed:U}=dB(D,R,N,s,g);for(const I of["x","y"])x[I][O[I]]||(U[I]=0,O[I]=0);if(U.x>0||U.y>0){b(),S.current=D,y(E,o),v.current=U,w.current=O;return}}v.current={x:0,y:0},w.current={x:0,y:0},b()},[s,E,r,b,i,o,JSON.stringify(N),JSON.stringify(x),y,d,k,h,JSON.stringify(g)])}const SB={x:{[fn.Backward]:!1,[fn.Forward]:!1},y:{[fn.Backward]:!1,[fn.Forward]:!1}};function CB(t){let{delta:s,disabled:n}=t;const r=Fp(s);return Rd(a=>{if(n||!r||!a)return SB;const i={x:Math.sign(s.x-r.x),y:Math.sign(s.y-r.y)};return{x:{[fn.Backward]:a.x[fn.Backward]||i.x===-1,[fn.Forward]:a.x[fn.Forward]||i.x===1},y:{[fn.Backward]:a.y[fn.Backward]||i.y===-1,[fn.Forward]:a.y[fn.Forward]||i.y===1}}},[n,s,r])}function EB(t,s){const n=s!=null?t.get(s):void 0,r=n?n.node.current:null;return Rd(a=>{var i;return s==null?null:(i=r??a)!=null?i:null},[r,s])}function TB(t,s){return f.useMemo(()=>t.reduce((n,r)=>{const{sensor:a}=r,i=a.activators.map(o=>({eventName:o.eventName,handler:s(o.handler,r)}));return[...n,...i]},[]),[t,s])}var id;(function(t){t[t.Always=0]="Always",t[t.BeforeDragging=1]="BeforeDragging",t[t.WhileDragging=2]="WhileDragging"})(id||(id={}));var Wp;(function(t){t.Optimized="optimized"})(Wp||(Wp={}));const Sb=new Map;function DB(t,s){let{dragging:n,dependencies:r,config:a}=s;const[i,o]=f.useState(null),{frequency:c,measure:u,strategy:d}=a,h=f.useRef(t),p=v(),g=cg(p),x=f.useCallback(function(w){w===void 0&&(w=[]),!g.current&&o(N=>N===null?w:N.concat(w.filter(S=>!N.includes(S))))},[g]),y=f.useRef(null),b=Rd(w=>{if(p&&!n)return Sb;if(!w||w===Sb||h.current!==t||i!=null){const N=new Map;for(let S of t){if(!S)continue;if(i&&i.length>0&&!i.includes(S.id)&&S.rect.current){N.set(S.id,S.rect.current);continue}const E=S.node.current,k=E?new mg(u(E),E):null;S.rect.current=k,k&&N.set(S.id,k)}return N}return w},[t,i,n,p,u]);return f.useEffect(()=>{h.current=t},[t]),f.useEffect(()=>{p||x()},[n,p]),f.useEffect(()=>{i&&i.length>0&&o(null)},[JSON.stringify(i)]),f.useEffect(()=>{p||typeof c!="number"||y.current!==null||(y.current=setTimeout(()=>{x(),y.current=null},c))},[c,p,x,...r]),{droppableRects:b,measureDroppableContainers:x,measuringScheduled:i!=null};function v(){switch(d){case id.Always:return!1;case id.BeforeDragging:return n;default:return!n}}}function E1(t,s){return Rd(n=>t?n||(typeof s=="function"?s(t):t):null,[s,t])}function kB(t,s){return E1(t,s)}function AB(t){let{callback:s,disabled:n}=t;const r=lg(s),a=f.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:i}=window;return new i(r)},[r,n]);return f.useEffect(()=>()=>a==null?void 0:a.disconnect(),[a]),a}function pg(t){let{callback:s,disabled:n}=t;const r=lg(s),a=f.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:i}=window;return new i(r)},[n]);return f.useEffect(()=>()=>a==null?void 0:a.disconnect(),[a]),a}function _B(t){return new mg(Od(t),t)}function Cb(t,s,n){s===void 0&&(s=_B);const[r,a]=f.useState(null);function i(){a(u=>{if(!t)return null;if(t.isConnected===!1){var d;return(d=u??n)!=null?d:null}const h=s(t);return JSON.stringify(u)===JSON.stringify(h)?u:h})}const o=AB({callback(u){if(t)for(const d of u){const{type:h,target:p}=d;if(h==="childList"&&p instanceof HTMLElement&&p.contains(t)){i();break}}}}),c=pg({callback:i});return co(()=>{i(),t?(c==null||c.observe(t),o==null||o.observe(document.body,{childList:!0,subtree:!0})):(c==null||c.disconnect(),o==null||o.disconnect())},[t]),r}function RB(t){const s=E1(t);return g1(t,s)}const Eb=[];function OB(t){const s=f.useRef(t),n=Rd(r=>t?r&&r!==Eb&&t&&s.current&&t.parentNode===s.current.parentNode?r:ug(t):Eb,[t]);return f.useEffect(()=>{s.current=t},[t]),n}function PB(t){const[s,n]=f.useState(null),r=f.useRef(t),a=f.useCallback(i=>{const o=Gf(i.target);o&&n(c=>c?(c.set(o,Hp(o)),new Map(c)):null)},[]);return f.useEffect(()=>{const i=r.current;if(t!==i){o(i);const c=t.map(u=>{const d=Gf(u);return d?(d.addEventListener("scroll",a,{passive:!0}),[d,Hp(d)]):null}).filter(u=>u!=null);n(c.length?new Map(c):null),r.current=t}return()=>{o(t),o(i)};function o(c){c.forEach(u=>{const d=Gf(u);d==null||d.removeEventListener("scroll",a)})}},[a,t]),f.useMemo(()=>t.length?s?Array.from(s.values()).reduce((i,o)=>xl(i,o),ca):N1(t):ca,[t,s])}function Tb(t,s){s===void 0&&(s=[]);const n=f.useRef(null);return f.useEffect(()=>{n.current=null},s),f.useEffect(()=>{const r=t!==ca;r&&!n.current&&(n.current=t),!r&&n.current&&(n.current=null)},[t]),n.current?xm(t,n.current):ca}function MB(t){f.useEffect(()=>{if(!rh)return;const s=t.map(n=>{let{sensor:r}=n;return r.setup==null?void 0:r.setup()});return()=>{for(const n of s)n==null||n()}},t.map(s=>{let{sensor:n}=s;return n}))}function IB(t,s){return f.useMemo(()=>t.reduce((n,r)=>{let{eventName:a,handler:i}=r;return n[a]=o=>{i(o,s)},n},{}),[t,s])}function T1(t){return f.useMemo(()=>t?iB(t):null,[t])}const Db=[];function LB(t,s){s===void 0&&(s=Od);const[n]=t,r=T1(n?cr(n):null),[a,i]=f.useState(Db);function o(){i(()=>t.length?t.map(u=>j1(u)?r:new mg(s(u),u)):Db)}const c=pg({callback:o});return co(()=>{c==null||c.disconnect(),o(),t.forEach(u=>c==null?void 0:c.observe(u))},[t]),a}function $B(t){if(!t)return null;if(t.children.length>1)return t;const s=t.children[0];return _d(s)?s:t}function zB(t){let{measure:s}=t;const[n,r]=f.useState(null),a=f.useCallback(d=>{for(const{target:h}of d)if(_d(h)){r(p=>{const g=s(h);return p?{...p,width:g.width,height:g.height}:g});break}},[s]),i=pg({callback:a}),o=f.useCallback(d=>{const h=$B(d);i==null||i.disconnect(),h&&(i==null||i.observe(h)),r(h?s(h):null)},[s,i]),[c,u]=zp(o);return f.useMemo(()=>({nodeRef:c,rect:n,setRef:u}),[n,c,u])}const FB=[{sensor:fg,options:{}},{sensor:C1,options:{}}],BB={current:{}},qu={draggable:{measure:bb},droppable:{measure:bb,strategy:id.WhileDragging,frequency:Wp.Optimized},dragOverlay:{measure:Od}};class Uc extends Map{get(s){var n;return s!=null&&(n=super.get(s))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(s=>{let{disabled:n}=s;return!n})}getNodeFor(s){var n,r;return(n=(r=this.get(s))==null?void 0:r.node.current)!=null?n:void 0}}const HB={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Uc,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:vm},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:qu,measureDroppableContainers:vm,windowRect:null,measuringScheduled:!1},UB={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:vm,draggableNodes:new Map,over:null,measureDroppableContainers:vm},xg=f.createContext(UB),WB=f.createContext(HB);function YB(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Uc}}}function VB(t,s){switch(s.type){case _n.DragStart:return{...t,draggable:{...t.draggable,initialCoordinates:s.initialCoordinates,active:s.active}};case _n.DragMove:return t.draggable.active==null?t:{...t,draggable:{...t.draggable,translate:{x:s.coordinates.x-t.draggable.initialCoordinates.x,y:s.coordinates.y-t.draggable.initialCoordinates.y}}};case _n.DragEnd:case _n.DragCancel:return{...t,draggable:{...t.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case _n.RegisterDroppable:{const{element:n}=s,{id:r}=n,a=new Uc(t.droppable.containers);return a.set(r,n),{...t,droppable:{...t.droppable,containers:a}}}case _n.SetDroppableDisabled:{const{id:n,key:r,disabled:a}=s,i=t.droppable.containers.get(n);if(!i||r!==i.key)return t;const o=new Uc(t.droppable.containers);return o.set(n,{...i,disabled:a}),{...t,droppable:{...t.droppable,containers:o}}}case _n.UnregisterDroppable:{const{id:n,key:r}=s,a=t.droppable.containers.get(n);if(!a||r!==a.key)return t;const i=new Uc(t.droppable.containers);return i.delete(n),{...t,droppable:{...t.droppable,containers:i}}}default:return t}}function GB(t){let{disabled:s}=t;const{active:n,activatorEvent:r,draggableNodes:a}=f.useContext(xg),i=Fp(r),o=Fp(n==null?void 0:n.id);return f.useEffect(()=>{if(!s&&!r&&i&&o!=null){if(!p1(i)||document.activeElement===i.target)return;const c=a.get(o);if(!c)return;const{activatorNode:u,node:d}=c;if(!u.current&&!d.current)return;requestAnimationFrame(()=>{for(const h of[u.current,d.current]){if(!h)continue;const p=$F(h);if(p){p.focus();break}}})}},[r,s,a,o,i]),null}function qB(t,s){let{transform:n,...r}=s;return t!=null&&t.length?t.reduce((a,i)=>i({transform:a,...r}),n):n}function KB(t){return f.useMemo(()=>({draggable:{...qu.draggable,...t==null?void 0:t.draggable},droppable:{...qu.droppable,...t==null?void 0:t.droppable},dragOverlay:{...qu.dragOverlay,...t==null?void 0:t.dragOverlay}}),[t==null?void 0:t.draggable,t==null?void 0:t.droppable,t==null?void 0:t.dragOverlay])}function JB(t){let{activeNode:s,measure:n,initialRect:r,config:a=!0}=t;const i=f.useRef(!1),{x:o,y:c}=typeof a=="boolean"?{x:a,y:a}:a;co(()=>{if(!o&&!c||!s){i.current=!1;return}if(i.current||!r)return;const d=s==null?void 0:s.node.current;if(!d||d.isConnected===!1)return;const h=n(d),p=g1(h,r);if(o||(p.x=0),c||(p.y=0),i.current=!0,Math.abs(p.x)>0||Math.abs(p.y)>0){const g=v1(d);g&&g.scrollBy({top:p.y,left:p.x})}},[s,o,c,r,n])}const D1=f.createContext({...ca,scaleX:1,scaleY:1});var Wi;(function(t){t[t.Uninitialized=0]="Uninitialized",t[t.Initializing=1]="Initializing",t[t.Initialized=2]="Initialized"})(Wi||(Wi={}));const XB=f.memo(function(s){var n,r,a,i;let{id:o,accessibility:c,autoScroll:u=!0,children:d,sensors:h=FB,collisionDetection:p=QF,measuring:g,modifiers:x,...y}=s;const b=f.useReducer(VB,void 0,YB),[v,w]=b,[N,S]=WF(),[E,k]=f.useState(Wi.Uninitialized),D=E===Wi.Initialized,{draggable:{active:T,nodes:R,translate:O},droppable:{containers:U}}=v,I=T!=null?R.get(T):null,_=f.useRef({initial:null,translated:null}),M=f.useMemo(()=>{var Ge;return T!=null?{id:T,data:(Ge=I==null?void 0:I.data)!=null?Ge:BB,rect:_}:null},[T,I]),W=f.useRef(null),[B,P]=f.useState(null),[z,G]=f.useState(null),ae=cg(y,Object.values(y)),Y=dg("DndDescribedBy",o),X=f.useMemo(()=>U.getEnabled(),[U]),se=KB(g),{droppableRects:H,measureDroppableContainers:ie,measuringScheduled:fe}=DB(X,{dragging:D,dependencies:[O.x,O.y],config:se.droppable}),le=EB(R,T),K=f.useMemo(()=>z?Bp(z):null,[z]),de=Ut(),je=kB(le,se.draggable.measure);JB({activeNode:T!=null?R.get(T):null,config:de.layoutShiftCompensation,initialRect:je,measure:se.draggable.measure});const ge=Cb(le,se.draggable.measure,je),Se=Cb(le?le.parentElement:null),oe=f.useRef({activatorEvent:null,active:null,activeNode:le,collisionRect:null,collisions:null,droppableRects:H,draggableNodes:R,draggingNode:null,draggingNodeRect:null,droppableContainers:U,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),J=U.getNodeFor((n=oe.current.over)==null?void 0:n.id),ye=zB({measure:se.dragOverlay.measure}),xt=(r=ye.nodeRef.current)!=null?r:le,gt=D?(a=ye.rect)!=null?a:ge:null,dt=!!(ye.nodeRef.current&&ye.rect),qs=RB(dt?null:ge),Ss=T1(xt?cr(xt):null),q=OB(D?J??le:null),ne=LB(q),me=qB(x,{transform:{x:O.x-qs.x,y:O.y-qs.y,scaleX:1,scaleY:1},activatorEvent:z,active:M,activeNodeRect:ge,containerNodeRect:Se,draggingNodeRect:gt,over:oe.current.over,overlayNodeRect:ye.rect,scrollableAncestors:q,scrollableAncestorRects:ne,windowRect:Ss}),Te=K?xl(K,O):null,Ee=PB(q),Ne=Tb(Ee),Re=Tb(Ee,[ge]),qe=xl(me,Ne),st=gt?sB(gt,me):null,es=M&&st?p({active:M,collisionRect:st,droppableRects:H,droppableContainers:X,pointerCoordinates:Te}):null,Os=XF(es,"id"),[qt,tn]=f.useState(null),Ks=dt?me:xl(me,Re),ds=eB(Ks,(i=qt==null?void 0:qt.rect)!=null?i:null,ge),zs=f.useRef(null),Ps=f.useCallback((Ge,ft)=>{let{sensor:Lt,options:_e}=ft;if(W.current==null)return;const Be=R.get(W.current);if(!Be)return;const Xe=Ge.nativeEvent,Rt=new Lt({active:W.current,activeNode:Be,event:Xe,options:_e,context:oe,onAbort(Ot){if(!R.get(Ot))return;const{onDragAbort:gs}=ae.current,Wt={id:Ot};gs==null||gs(Wt),N({type:"onDragAbort",event:Wt})},onPending(Ot,xs,gs,Wt){if(!R.get(Ot))return;const{onDragPending:wa}=ae.current,dr={id:Ot,constraint:xs,initialCoordinates:gs,offset:Wt};wa==null||wa(dr),N({type:"onDragPending",event:dr})},onStart(Ot){const xs=W.current;if(xs==null)return;const gs=R.get(xs);if(!gs)return;const{onDragStart:Wt}=ae.current,Jn={activatorEvent:Xe,active:{id:xs,data:gs.data,rect:_}};Ki.unstable_batchedUpdates(()=>{Wt==null||Wt(Jn),k(Wi.Initializing),w({type:_n.DragStart,initialCoordinates:Ot,active:xs}),N({type:"onDragStart",event:Jn}),P(zs.current),G(Xe)})},onMove(Ot){w({type:_n.DragMove,coordinates:Ot})},onEnd:$t(_n.DragEnd),onCancel:$t(_n.DragCancel)});zs.current=Rt;function $t(Ot){return async function(){const{active:gs,collisions:Wt,over:Jn,scrollAdjustedTranslate:wa}=oe.current;let dr=null;if(gs&&wa){const{cancelDrop:Fr}=ae.current;dr={activatorEvent:Xe,active:gs,collisions:Wt,delta:wa,over:Jn},Ot===_n.DragEnd&&typeof Fr=="function"&&await Promise.resolve(Fr(dr))&&(Ot=_n.DragCancel)}W.current=null,Ki.unstable_batchedUpdates(()=>{w({type:Ot}),k(Wi.Uninitialized),tn(null),P(null),G(null),zs.current=null;const Fr=Ot===_n.DragEnd?"onDragEnd":"onDragCancel";if(dr){const bi=ae.current[Fr];bi==null||bi(dr),N({type:Fr,event:dr})}})}}},[R]),$n=f.useCallback((Ge,ft)=>(Lt,_e)=>{const Be=Lt.nativeEvent,Xe=R.get(_e);if(W.current!==null||!Xe||Be.dndKit||Be.defaultPrevented)return;const Rt={active:Xe};Ge(Lt,ft.options,Rt)===!0&&(Be.dndKit={capturedBy:ft.sensor},W.current=_e,Ps(Lt,ft))},[R,Ps]),Ve=TB(h,$n);MB(h),co(()=>{ge&&E===Wi.Initializing&&k(Wi.Initialized)},[ge,E]),f.useEffect(()=>{const{onDragMove:Ge}=ae.current,{active:ft,activatorEvent:Lt,collisions:_e,over:Be}=oe.current;if(!ft||!Lt)return;const Xe={active:ft,activatorEvent:Lt,collisions:_e,delta:{x:qe.x,y:qe.y},over:Be};Ki.unstable_batchedUpdates(()=>{Ge==null||Ge(Xe),N({type:"onDragMove",event:Xe})})},[qe.x,qe.y]),f.useEffect(()=>{const{active:Ge,activatorEvent:ft,collisions:Lt,droppableContainers:_e,scrollAdjustedTranslate:Be}=oe.current;if(!Ge||W.current==null||!ft||!Be)return;const{onDragOver:Xe}=ae.current,Rt=_e.get(Os),$t=Rt&&Rt.rect.current?{id:Rt.id,rect:Rt.rect.current,data:Rt.data,disabled:Rt.disabled}:null,Ot={active:Ge,activatorEvent:ft,collisions:Lt,delta:{x:Be.x,y:Be.y},over:$t};Ki.unstable_batchedUpdates(()=>{tn($t),Xe==null||Xe(Ot),N({type:"onDragOver",event:Ot})})},[Os]),co(()=>{oe.current={activatorEvent:z,active:M,activeNode:le,collisionRect:st,collisions:es,droppableRects:H,draggableNodes:R,draggingNode:xt,draggingNodeRect:gt,droppableContainers:U,over:qt,scrollableAncestors:q,scrollAdjustedTranslate:qe},_.current={initial:gt,translated:st}},[M,le,es,st,R,xt,gt,H,U,qt,q,qe]),NB({...de,delta:O,draggingRect:st,pointerCoordinates:Te,scrollableAncestors:q,scrollableAncestorRects:ne});const ut=f.useMemo(()=>({active:M,activeNode:le,activeNodeRect:ge,activatorEvent:z,collisions:es,containerNodeRect:Se,dragOverlay:ye,draggableNodes:R,droppableContainers:U,droppableRects:H,over:qt,measureDroppableContainers:ie,scrollableAncestors:q,scrollableAncestorRects:ne,measuringConfiguration:se,measuringScheduled:fe,windowRect:Ss}),[M,le,ge,z,es,Se,ye,R,U,H,qt,ie,q,ne,se,fe,Ss]),Nt=f.useMemo(()=>({activatorEvent:z,activators:Ve,active:M,activeNodeRect:ge,ariaDescribedById:{draggable:Y},dispatch:w,draggableNodes:R,over:qt,measureDroppableContainers:ie}),[z,Ve,M,ge,w,Y,R,qt,ie]);return ee.createElement(x1.Provider,{value:S},ee.createElement(xg.Provider,{value:Nt},ee.createElement(WB.Provider,{value:ut},ee.createElement(D1.Provider,{value:ds},d)),ee.createElement(GB,{disabled:(c==null?void 0:c.restoreFocus)===!1})),ee.createElement(GF,{...c,hiddenTextDescribedById:Y}));function Ut(){const Ge=(B==null?void 0:B.autoScrollEnabled)===!1,ft=typeof u=="object"?u.enabled===!1:u===!1,Lt=D&&!Ge&&!ft;return typeof u=="object"?{...u,enabled:Lt}:{enabled:Lt}}}),ZB=f.createContext(null),kb="button",QB="Draggable";function k1(t){let{id:s,data:n,disabled:r=!1,attributes:a}=t;const i=dg(QB),{activators:o,activatorEvent:c,active:u,activeNodeRect:d,ariaDescribedById:h,draggableNodes:p,over:g}=f.useContext(xg),{role:x=kb,roleDescription:y="draggable",tabIndex:b=0}=a??{},v=(u==null?void 0:u.id)===s,w=f.useContext(v?D1:ZB),[N,S]=zp(),[E,k]=zp(),D=IB(o,s),T=cg(n);co(()=>(p.set(s,{id:s,key:i,node:N,activatorNode:E,data:T}),()=>{const O=p.get(s);O&&O.key===i&&p.delete(s)}),[p,s]);const R=f.useMemo(()=>({role:x,tabIndex:b,"aria-disabled":r,"aria-pressed":v&&x===kb?!0:void 0,"aria-roledescription":y,"aria-describedby":h.draggable}),[r,x,b,v,y,h.draggable]);return{active:u,activatorEvent:c,activeNodeRect:d,attributes:R,isDragging:v,listeners:r?void 0:D,node:N,over:g,setNodeRef:S,setActivatorNodeRef:k,transform:w}}const eH=({task:t,onDelete:s,onEdit:n,onQuickUpdate:r,onToggle:a,style:i,className:o,isDraggable:c=!0})=>{const[u,d]=f.useState(!1),h=Qt(),{exportTaskToGoogleCalendar:p}=OC(),{attributes:g,listeners:x,setNodeRef:y,transform:b,isDragging:v}=k1({id:`task-${t.id}`,data:{task:t,type:"task-move"},disabled:!c||u}),w=Ra[t.category]||Ra.personal,N=()=>({"text-red-700":"#b91c1c","text-blue-700":"#1d4ed8","text-green-700":"#15803d","text-purple-700":"#7e22ce","text-orange-700":"#c2410c","text-pink-700":"#be185d"})[w.text]||"#7e22ce",S=B=>{B.stopPropagation(),d(!1),n(t)},E=B=>{B.stopPropagation(),d(!1),s(t.id)},k=B=>{B.stopPropagation(),d(!1),a&&a(t.id,!t.completed)},D=B=>{B.stopPropagation(),d(!1),h(`/task/${t.taskCode}/run`)},T=B=>{B.stopPropagation(),d(!1),p(t)},R=t.startDate?nt(t.startDate,"HH:mm"):"",O=t.endDate?nt(t.endDate,"HH:mm"):"",U=f.useMemo(()=>{if(!t.startDate||!t.endDate)return null;const B=t.endDate.getTime()-t.startDate.getTime(),P=Math.floor(B/6e4);if(P<60)return{minutes:P,label:`${P} min`};{const z=Math.floor(P/60),G=P%60;return{minutes:P,label:G>0?`${z}h ${G}min`:`${z}h`}}},[t.startDate,t.endDate]),I=B=>{if(!t.endDate||!t.startDate)return;const P=new Date(t.endDate);P.setMinutes(P.getMinutes()+B),!(P.getTime()-t.startDate.getTime()<15*6e4)&&(P.getHours()>22||P.getHours()===22&&P.getMinutes()>0||(d(!1),r?r({...t,endDate:P}):n({...t,endDate:P})))},_=f.useMemo(()=>U?{by30:U.minutes>=45,by60:U.minutes>=75}:{by30:!1,by60:!1},[U]),M=f.useMemo(()=>{if(!t.endDate)return{by30:!1,by60:!1,by120:!1};const B=P=>{const z=new Date(t.endDate);return z.setMinutes(z.getMinutes()+P),z.getHours()<22||z.getHours()===22&&z.getMinutes()===0};return{by30:B(30),by60:B(60),by120:B(120)}},[t.endDate]),W=b?{transform:gm.Transform.toString(b),zIndex:1e3}:{};return e.jsxs(Dd,{open:u,onOpenChange:d,children:[e.jsx(kd,{asChild:!0,children:e.jsxs("div",{className:ce("cursor-pointer overflow-hidden rounded text-white text-xs relative","hover:opacity-90 transition-opacity","flex",v&&"opacity-50 shadow-lg",o),style:{...i,...W,backgroundColor:N(),minHeight:"48px"},children:[c&&e.jsx("div",{ref:y,...g,...x,className:"w-6 flex-shrink-0 bg-black/10 hover:bg-black/20 flex items-center justify-center cursor-move border-r border-white/20 transition-colors",title:"Arrastrar para mover tarea",children:e.jsx(cw,{className:"w-4 h-4 opacity-75"})}),e.jsxs("div",{className:"flex-1 p-1 flex flex-col min-w-0",children:[e.jsx("div",{className:"font-semibold leading-tight truncate",children:t.title}),e.jsxs("div",{className:"text-[10px] opacity-90 leading-tight mt-0.5",children:[R,O&&` - ${O}`]}),t.isPrivate&&e.jsx("div",{className:"text-[10px] opacity-75",children:""})]})]})}),e.jsx(Vl,{className:"w-80 p-3",align:"start",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h4",{className:"font-semibold text-sm flex-1",children:t.title}),t.isPrivate&&e.jsx("span",{className:"text-sm",children:""})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["#",t.taskCode]})]}),e.jsxs("div",{className:"space-y-2 text-xs",children:[t.startDate&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(en,{className:"w-3 h-3 text-muted-foreground"}),e.jsxs("span",{children:[nt(t.startDate,"dd/MM/yyyy")," - ",R,O&&` a ${O}`]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded",style:{backgroundColor:N()}}),e.jsx("span",{children:Qs[t.category]})]})]}),U&&e.jsxs("div",{className:"space-y-2 p-2 bg-muted/50 rounded-md",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium",children:[e.jsx(zo,{className:"w-3 h-3"}),e.jsxs("span",{children:["Duracin: ",U.label]})]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsx($,{variant:"outline",size:"sm",className:"h-7 text-xs px-2",onClick:()=>I(-60),disabled:!_.by60,title:_.by60?"Reducir 1 hora":"Duracin mnima: 15 min",children:"-1h"}),e.jsx($,{variant:"outline",size:"sm",className:"h-7 text-xs px-2",onClick:()=>I(-30),disabled:!_.by30,title:_.by30?"Reducir 30 minutos":"Duracin mnima: 15 min",children:"-30"}),e.jsx($,{variant:"outline",size:"sm",className:"h-7 text-xs px-2",onClick:()=>I(30),disabled:!M.by30,title:M.by30?"Aumentar 30 minutos":"Lmite: 22:00",children:"+30"}),e.jsx($,{variant:"outline",size:"sm",className:"h-7 text-xs px-2",onClick:()=>I(60),disabled:!M.by60,title:M.by60?"Aumentar 1 hora":"Lmite: 22:00",children:"+1h"}),e.jsx($,{variant:"outline",size:"sm",className:"h-7 text-xs px-2",onClick:()=>I(120),disabled:!M.by120,title:M.by120?"Aumentar 2 horas":"Lmite: 22:00",children:"+2h"})]})]}),t.description&&e.jsxs("div",{className:"text-xs text-muted-foreground max-h-20 overflow-y-auto",children:[t.description.slice(0,200),t.description.length>200&&"..."]}),!t.isPrivate&&e.jsxs($,{variant:"ghost",size:"sm",className:"w-full justify-start gap-2 h-8 text-xs",onClick:T,children:[e.jsx(ns,{className:"w-3 h-3"}),"Exportar a Google Calendar"]}),e.jsxs("div",{className:"space-y-2 pt-2 border-t",children:[e.jsxs("div",{className:"flex gap-2",children:[a&&e.jsx($,{variant:t.completed?"outline":"default",size:"sm",className:"flex-1 h-8 text-xs",onClick:k,title:t.completed?"Marcar como pendiente":"Marcar como completada",children:t.completed?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mr-1",children:""}),"Pendiente"]}):e.jsxs(e.Fragment,{children:[e.jsx(Fa,{className:"w-3 h-3 mr-1"}),"Completar"]})}),e.jsxs($,{variant:"outline",size:"sm",className:"flex-1 h-8 text-xs",onClick:D,title:"Ejecutar tarea con timer",children:[e.jsx(Sn,{className:"w-3 h-3 mr-1 text-green-600"}),"Ejecutar"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs($,{variant:"outline",size:"sm",className:"flex-1 h-8 text-xs",onClick:S,title:"Editar tarea",children:[e.jsx(jr,{className:"w-3 h-3 mr-1"}),"Editar"]}),e.jsx($,{variant:"destructive",size:"sm",className:"h-8 text-xs px-3",onClick:E,title:"Eliminar tarea",children:e.jsx(Ws,{className:"w-3 h-3"})})]})]})]})})]})},tH=({habit:t,customTime:s,onComplete:n,onReset:r,style:a,className:i})=>{const[o,c]=f.useState(!1),{attributes:u,listeners:d,setNodeRef:h,transform:p,isDragging:g}=k1({id:`habit-${t.id}`,data:{habit:t,type:"habit-move",currentTime:s||t.baseTime},disabled:o}),x=eN[t.id]||"bg-purple-500",y=()=>({"bg-blue-500":"#3b82f6","bg-green-500":"#22c55e","bg-yellow-500":"#eab308","bg-orange-500":"#f97316","bg-purple-500":"#a855f7","bg-pink-500":"#ec4899","bg-red-500":"#ef4444","bg-teal-500":"#14b8a6","bg-indigo-500":"#6366f1","bg-gray-500":"#6b7280","bg-lime-500":"#84cc16","bg-amber-500":"#f59e0b","bg-cyan-500":"#06b6d4","bg-fuchsia-500":"#d946ef","bg-rose-500":"#f43f5e","bg-violet-500":"#8b5cf6","bg-sky-500":"#0ea5e9","bg-emerald-500":"#10b981","bg-yellow-600":"#ca8a04","bg-pink-600":"#db2777","bg-blue-600":"#2563eb","bg-green-600":"#16a34a"})[x]||"#a855f7",b=S=>{S.stopPropagation(),c(!1),n(t.id)},v=S=>{S.stopPropagation(),c(!1),r&&r(t.id)},w=p?{transform:gm.Transform.toString(p),zIndex:1e3}:{},N=s&&s!==t.baseTime;return e.jsxs(Dd,{open:o,onOpenChange:c,children:[e.jsx(kd,{asChild:!0,children:e.jsxs("div",{className:ce("cursor-pointer overflow-hidden rounded text-white text-xs relative","hover:opacity-90 transition-opacity","flex",g&&"opacity-50 shadow-lg",i),style:{...a,...w,backgroundColor:y(),minHeight:"25px"},children:[e.jsx("div",{ref:h,...u,...d,className:"w-6 flex-shrink-0 bg-black/10 hover:bg-black/20 flex items-center justify-center cursor-move border-r border-white/20 transition-colors",title:"Arrastrar para mover hbito",children:e.jsx(cw,{className:"w-4 h-4 opacity-75"})}),e.jsx("div",{className:"flex-1 px-2 flex items-center min-w-0",children:e.jsxs("div",{className:"flex items-center gap-1.5 w-full",children:[e.jsx("span",{className:"text-base leading-none flex-shrink-0",children:t.icon}),e.jsx("span",{className:"font-medium text-xs leading-none truncate flex-1",children:t.name})]})})]})}),e.jsx(Vl,{className:"w-80 p-3",align:"start",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"space-y-1",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-2xl",children:t.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-sm",children:t.name}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Duracin: ",t.goal]})]})]})}),e.jsxs("div",{className:"text-xs space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Hora:"}),e.jsx("span",{className:"font-medium",children:s||t.baseTime})]}),N&&e.jsxs("div",{className:"text-[10px] text-amber-600 flex items-center gap-1",children:[e.jsx("span",{children:""}),e.jsxs("span",{children:["Hora personalizada (base: ",t.baseTime,")"]})]})]}),t.steps&&t.steps.length>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Pasos:"}),e.jsx("ul",{className:"text-xs space-y-1 pl-4",children:t.steps.map((S,E)=>e.jsx("li",{className:"list-disc text-gray-600",children:S},E))})]}),e.jsxs("div",{className:"space-y-2 pt-2 border-t",children:[e.jsxs($,{variant:"default",size:"sm",className:"w-full h-8 text-xs bg-green-600 hover:bg-green-700",onClick:b,title:"Marcar como completado",children:[e.jsx(Fa,{className:"w-3 h-3 mr-1"}),"Completar"]}),N&&r&&e.jsxs($,{variant:"outline",size:"sm",className:"w-full h-8 text-xs",onClick:v,title:"Volver a hora base",children:[e.jsx(kO,{className:"w-3 h-3 mr-1"}),"Restablecer hora (",t.baseTime,")"]})]}),e.jsx("div",{className:"text-[10px] text-muted-foreground pt-2 border-t",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{children:""}),e.jsx("span",{children:"Arrastra desde el borde izquierdo para cambiar la hora"})]})})]})})]})};function sH(t){const s=t.match(/(\d+)\s*(min|h|hora)/i);if(!s)return 30;const n=parseInt(s[1],10);return s[2].toLowerCase().startsWith("h")?n*60:n}function nH(t){return 25}function A1(t,s){const[n,r]=t.split(":").map(i=>parseInt(i,10)),a=new Date(s);return a.setHours(n,r,0,0),a}const Rc="habit-calendar-times",rH=t=>{const s=Ie(t),{completedHabits:n,toggleHabit:r}=Fm(t),[a,i]=f.useState(0),o=f.useCallback((p,g)=>{var x,y,b;try{return((x=JSON.parse(localStorage.getItem(Rc)||"{}")[g])==null?void 0:x[p])||((y=vn.find(w=>w.id===p))==null?void 0:y.baseTime)||"09:00"}catch(v){return console.error("Error reading habit time from localStorage:",v),((b=vn.find(w=>w.id===p))==null?void 0:b.baseTime)||"09:00"}},[]),c=f.useCallback((p,g,x)=>{try{const y=JSON.parse(localStorage.getItem(Rc)||"{}");y[g]||(y[g]={}),y[g][p]=x,localStorage.setItem(Rc,JSON.stringify(y)),console.log("Saved habit time to localStorage:",{habitId:p,date:g,time:x,data:y}),i(b=>b+1)}catch(y){console.error("Error saving habit time to localStorage:",y)}},[]),u=f.useCallback((p,g)=>{var x;try{const y=JSON.parse(localStorage.getItem(Rc)||"{}");(x=y[g])!=null&&x[p]&&(delete y[g][p],Object.keys(y[g]).length===0&&delete y[g],localStorage.setItem(Rc,JSON.stringify(y)),i(b=>b+1))}catch(y){console.error("Error resetting habit time in localStorage:",y)}},[]),d=async(p,g)=>{await r(p,g)};return{habits:f.useMemo(()=>vn.filter(p=>{const g=`${p.id}_${s}`;return!(n[g]===!0)}).map(p=>{const g=o(p.id,s),x=A1(g,t),y=sH(p.goal),b=Gw(x,6),v=nH(),w=`${p.id}_${s}`,N=n[w]===!0;return{...p,displayTime:g,displayTimeDate:x,durationMinutes:y,top:b,height:v,isCompleted:N}}),[s,n,t,a,o]),updateHabitTime:c,resetHabitTime:u,getHabitTime:o,toggleHabitCompletion:d}},_1=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899","#14B8A6","#F97316"],R1="life-tracker-external-calendars",Jf=_1,aH=_1[0],iH=1e4,oH=4,Lu={borderWidth:"2px",borderStyle:"dashed",opacityBackground:.4,opacityBorder:1};function po(){try{const t=localStorage.getItem(R1);if(!t)return _b();const s=JSON.parse(t),n=s.events.map(r=>({...r,startDate:new Date(r.startDate),endDate:new Date(r.endDate)}));return{calendars:s.calendars||[],events:n,hiddenEventIds:s.hiddenEventIds||[],lastGlobalSync:s.lastGlobalSync}}catch(t){return console.error("Error reading external calendar data from localStorage:",t),_b()}}function Ko(t){try{localStorage.setItem(R1,JSON.stringify(t))}catch(s){throw console.error("Error saving external calendar data to localStorage:",s),new Error("No se pudo guardar la configuracin de calendarios")}}function lH(t){const s=po();s.calendars.push(t),Ko(s)}function Ab(t,s){const n=po(),r=n.calendars.findIndex(a=>a.id===t);r!==-1&&(n.calendars[r]={...n.calendars[r],...s},Ko(n))}function cH(t){const s=po();s.calendars=s.calendars.filter(r=>r.id!==t),s.events=s.events.filter(r=>r.calendarId!==t);const n=s.events.filter(r=>r.calendarId===t).map(r=>r.uid);s.hiddenEventIds=s.hiddenEventIds.filter(r=>!n.includes(r)),Ko(s)}function dH(t,s){const n=po();n.events=n.events.filter(a=>a.calendarId!==t),n.events.push(...s);const r=n.calendars.findIndex(a=>a.id===t);r!==-1&&(n.calendars[r].lastSyncedAt=Date.now()),Ko(n)}function uH(t){const s=po();s.hiddenEventIds.includes(t)||(s.hiddenEventIds.push(t),Ko(s))}function mH(t){const s=po();s.hiddenEventIds=s.hiddenEventIds.filter(n=>n!==t),Ko(s)}function hH(){const t=po();t.lastGlobalSync=Date.now(),Ko(t)}function _b(){return{calendars:[],events:[],hiddenEventIds:[]}}class ah{constructor(s){he(this,"icaltype","binary");this.value=s}static fromString(s){return new ah(s)}decodeValue(){return this._b64_decode(this.value)}setEncodedValue(s){this.value=this._b64_encode(s)}_b64_encode(s){let n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r,a,i,o,c,u,d,h,p=0,g=0,x="",y=[];if(!s)return s;do r=s.charCodeAt(p++),a=s.charCodeAt(p++),i=s.charCodeAt(p++),h=r<<16|a<<8|i,o=h>>18&63,c=h>>12&63,u=h>>6&63,d=h&63,y[g++]=n.charAt(o)+n.charAt(c)+n.charAt(u)+n.charAt(d);while(p<s.length);x=y.join("");let b=s.length%3;return(b?x.slice(0,b-3):x)+"===".slice(b||3)}_b64_decode(s){let n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r,a,i,o,c,u,d,h,p=0,g=0,x="",y=[];if(!s)return s;s+="";do o=n.indexOf(s.charAt(p++)),c=n.indexOf(s.charAt(p++)),u=n.indexOf(s.charAt(p++)),d=n.indexOf(s.charAt(p++)),h=o<<18|c<<12|u<<6|d,r=h>>16&255,a=h>>8&255,i=h&255,u==64?y[g++]=String.fromCharCode(r):d==64?y[g++]=String.fromCharCode(r,a):y[g++]=String.fromCharCode(r,a,i);while(p<s.length);return x=y.join(""),x}toString(){return this.value}}const fH=/([PDWHMTS]{1,1})/,pH=["weeks","days","hours","minutes","seconds","isNegative"];class Mn{constructor(s){he(this,"weeks",0);he(this,"days",0);he(this,"hours",0);he(this,"minutes",0);he(this,"seconds",0);he(this,"isNegative",!1);he(this,"icalclass","icalduration");he(this,"icaltype","duration");this.wrappedJSObject=this,this.fromData(s)}static fromSeconds(s){return new Mn().fromSeconds(s)}static isValueString(s){return s[0]==="P"||s[1]==="P"}static fromString(s){let n=0,r=Object.create(null),a=0;for(;(n=s.search(fH))!==-1;){let i=s[n],o=s.slice(0,Math.max(0,n));s=s.slice(n+1),a+=xH(i,o,r)}if(a<2)throw new Error('invalid duration value: Not enough duration components in "'+s+'"');return new Mn(r)}static fromData(s){return new Mn(s)}clone(){return Mn.fromData(this)}toSeconds(){let s=this.seconds+60*this.minutes+3600*this.hours+86400*this.days+604800*this.weeks;return this.isNegative?-s:s}fromSeconds(s){let n=Math.abs(s);return this.isNegative=s<0,this.days=hn(n/86400),this.days%7==0?(this.weeks=this.days/7,this.days=0):this.weeks=0,n-=(this.days+7*this.weeks)*86400,this.hours=hn(n/3600),n-=this.hours*3600,this.minutes=hn(n/60),n-=this.minutes*60,this.seconds=n,this}fromData(s){for(let n of pH)s&&n in s?this[n]=s[n]:this[n]=0}reset(){this.isNegative=!1,this.weeks=0,this.days=0,this.hours=0,this.minutes=0,this.seconds=0}compare(s){let n=this.toSeconds(),r=s.toSeconds();return(n>r)-(n<r)}normalize(){this.fromSeconds(this.toSeconds())}toString(){if(this.toSeconds()==0)return"PT0S";{let s="";this.isNegative&&(s+="-"),s+="P";let n=!1;return this.weeks?this.days||this.hours||this.minutes||this.seconds?s+=this.weeks*7+this.days+"D":(s+=this.weeks+"W",n=!0):this.days&&(s+=this.days+"D"),n||(this.hours||this.minutes||this.seconds)&&(s+="T",this.hours&&(s+=this.hours+"H"),this.minutes&&(s+=this.minutes+"M"),this.seconds&&(s+=this.seconds+"S")),s}}toICALString(){return this.toString()}}function xH(t,s,n){let r;switch(t){case"P":s&&s==="-"?n.isNegative=!0:n.isNegative=!1;break;case"D":r="days";break;case"W":r="weeks";break;case"H":r="hours";break;case"M":r="minutes";break;case"S":r="seconds";break;default:return 0}if(r){if(!s&&s!==0)throw new Error('invalid duration value: Missing number before "'+t+'"');let a=parseInt(s,10);if(od(a))throw new Error('invalid duration value: Invalid number "'+s+'" before "'+t+'"');n[r]=a}return 1}class oi{constructor(s){he(this,"start",null);he(this,"end",null);he(this,"duration",null);he(this,"icalclass","icalperiod");he(this,"icaltype","period");if(this.wrappedJSObject=this,s&&"start"in s){if(s.start&&!(s.start instanceof Ye))throw new TypeError(".start must be an instance of ICAL.Time");this.start=s.start}if(s&&s.end&&s.duration)throw new Error("cannot accept both end and duration");if(s&&"end"in s){if(s.end&&!(s.end instanceof Ye))throw new TypeError(".end must be an instance of ICAL.Time");this.end=s.end}if(s&&"duration"in s){if(s.duration&&!(s.duration instanceof Mn))throw new TypeError(".duration must be an instance of ICAL.Duration");this.duration=s.duration}}static fromString(s,n){let r=s.split("/");if(r.length!==2)throw new Error('Invalid string value: "'+s+'" must contain a "/" char.');let a={start:Ye.fromDateTimeString(r[0],n)},i=r[1];return Mn.isValueString(i)?a.duration=Mn.fromString(i):a.end=Ye.fromDateTimeString(i,n),new oi(a)}static fromData(s){return new oi(s)}static fromJSON(s,n,r){function a(i,o){return r?Ye.fromString(i,o):Ye.fromDateTimeString(i,o)}return Mn.isValueString(s[1])?oi.fromData({start:a(s[0],n),duration:Mn.fromString(s[1])}):oi.fromData({start:a(s[0],n),end:a(s[1],n)})}clone(){return oi.fromData({start:this.start?this.start.clone():null,end:this.end?this.end.clone():null,duration:this.duration?this.duration.clone():null})}getDuration(){return this.duration?this.duration:this.end.subtractDate(this.start)}getEnd(){if(this.end)return this.end;{let s=this.start.clone();return s.addDuration(this.duration),s}}compare(s){return s.compare(this.start)<0?1:s.compare(this.getEnd())>0?-1:0}toString(){return this.start+"/"+(this.end||this.duration)}toJSON(){return[this.start.toString(),(this.end||this.duration).toString()]}toICALString(){return this.start.toICALString()+"/"+(this.end||this.duration).toICALString()}}var yl;const Le=class Le{constructor(s,n){he(this,"icalclass","icaltime");he(this,"_cachedUnixTime",null);he(this,"zone",null);he(this,"_pendingNormalization",!1);this.wrappedJSObject=this,this._time=Object.create(null),this._time.year=0,this._time.month=1,this._time.day=1,this._time.hour=0,this._time.minute=0,this._time.second=0,this._time.isDate=!1,this.fromData(s,n)}static daysInMonth(s,n){let r=[0,31,28,31,30,31,30,31,31,30,31,30,31],a=30;return s<1||s>12||(a=r[s],s==2&&(a+=Le.isLeapYear(n))),a}static isLeapYear(s){return s<=1752?s%4==0:s%4==0&&s%100!=0||s%400==0}static fromDayOfYear(s,n){let r=n,a=s,i=new Le;i.auto_normalize=!1;let o=Le.isLeapYear(r)?1:0;if(a<1)return r--,o=Le.isLeapYear(r)?1:0,a+=Le.daysInYearPassedMonth[o][12],Le.fromDayOfYear(a,r);if(a>Le.daysInYearPassedMonth[o][12])return o=Le.isLeapYear(r)?1:0,a-=Le.daysInYearPassedMonth[o][12],r++,Le.fromDayOfYear(a,r);i.year=r,i.isDate=!0;for(let c=11;c>=0;c--)if(a>Le.daysInYearPassedMonth[o][c]){i.month=c+1,i.day=a-Le.daysInYearPassedMonth[o][c];break}return i.auto_normalize=!0,i}static fromStringv2(s){return new Le({year:parseInt(s.slice(0,4),10),month:parseInt(s.slice(5,7),10),day:parseInt(s.slice(8,10),10),isDate:!0})}static fromDateString(s){return new Le({year:An(s.slice(0,4)),month:An(s.slice(5,7)),day:An(s.slice(8,10)),isDate:!0})}static fromDateTimeString(s,n){if(s.length<19)throw new Error('invalid date-time value: "'+s+'"');let r,a;s.slice(-1)==="Z"?r=ss.utcTimezone:n&&(a=n.getParameter("tzid"),n.parent&&(n.parent.name==="standard"||n.parent.name==="daylight"?r=ss.localTimezone:a&&(r=n.parent.getTimeZoneByID(a))));const i={year:An(s.slice(0,4)),month:An(s.slice(5,7)),day:An(s.slice(8,10)),hour:An(s.slice(11,13)),minute:An(s.slice(14,16)),second:An(s.slice(17,19))};return a&&!r&&(i.timezone=a),new Le(i,r)}static fromString(s,n){return s.length>10?Le.fromDateTimeString(s,n):Le.fromDateString(s)}static fromJSDate(s,n){return new Le().fromJSDate(s,n)}static now(){return Le.fromJSDate(new Date,!1)}static weekOneStarts(s,n){let r=Le.fromData({year:s,month:1,day:1,isDate:!0}),a=r.dayOfWeek(),i=n||Le.DEFAULT_WEEK_START;return a>Le.THURSDAY&&(r.day+=7),i>Le.THURSDAY&&(r.day-=7),r.day-=a-i,r}static getDominicalLetter(s){let n="GFEDCBA",r=(s+(s/4|0)+(s/400|0)-(s/100|0)-1)%7;return Le.isLeapYear(s)?n[(r+6)%7]+n[r]:n[r]}static get epochTime(){return To(this,yl)||Eu(this,yl,Le.fromData({year:1970,month:1,day:1,hour:0,minute:0,second:0,isDate:!1,timezone:"Z"})),To(this,yl)}static _cmp_attr(s,n,r){return s[r]>n[r]?1:s[r]<n[r]?-1:0}get icaltype(){return this.isDate?"date":"date-time"}get year(){return this._getTimeAttr("year")}set year(s){this._setTimeAttr("year",s)}get month(){return this._getTimeAttr("month")}set month(s){this._setTimeAttr("month",s)}get day(){return this._getTimeAttr("day")}set day(s){this._setTimeAttr("day",s)}get hour(){return this._getTimeAttr("hour")}set hour(s){this._setTimeAttr("hour",s)}get minute(){return this._getTimeAttr("minute")}set minute(s){this._setTimeAttr("minute",s)}get second(){return this._getTimeAttr("second")}set second(s){this._setTimeAttr("second",s)}get isDate(){return this._getTimeAttr("isDate")}set isDate(s){this._setTimeAttr("isDate",s)}_getTimeAttr(s){return this._pendingNormalization&&(this._normalize(),this._pendingNormalization=!1),this._time[s]}_setTimeAttr(s,n){s==="isDate"&&n&&!this._time.isDate&&this.adjust(0,0,0,0),this._cachedUnixTime=null,this._pendingNormalization=!0,this._time[s]=n}clone(){return new Le(this._time,this.zone)}reset(){this.fromData(Le.epochTime),this.zone=ss.utcTimezone}resetTo(s,n,r,a,i,o,c){this.fromData({year:s,month:n,day:r,hour:a,minute:i,second:o,zone:c})}fromJSDate(s,n){return s?n?(this.zone=ss.utcTimezone,this.year=s.getUTCFullYear(),this.month=s.getUTCMonth()+1,this.day=s.getUTCDate(),this.hour=s.getUTCHours(),this.minute=s.getUTCMinutes(),this.second=s.getUTCSeconds()):(this.zone=ss.localTimezone,this.year=s.getFullYear(),this.month=s.getMonth()+1,this.day=s.getDate(),this.hour=s.getHours(),this.minute=s.getMinutes(),this.second=s.getSeconds()):this.reset(),this._cachedUnixTime=null,this}fromData(s,n){if(s)for(let[r,a]of Object.entries(s))r!=="icaltype"&&(this[r]=a);if(n&&(this.zone=n),s&&!("isDate"in s)?this.isDate=!("hour"in s):s&&"isDate"in s&&(this.isDate=s.isDate),s&&"timezone"in s){let r=jm.get(s.timezone);this.zone=r||ss.localTimezone}return s&&"zone"in s&&(this.zone=s.zone),this.zone||(this.zone=ss.localTimezone),this._cachedUnixTime=null,this}dayOfWeek(s){let n=s||Le.SUNDAY,r=(this.year<<12)+(this.month<<8)+(this.day<<3)+n;if(r in Le._dowCache)return Le._dowCache[r];let a=this.day,i=this.month+(this.month<3?12:0),o=this.year-(this.month<3?1:0),c=a+o+hn((i+1)*26/10)+hn(o/4);return c+=hn(o/100)*6+hn(o/400),c=(c+7-n)%7+1,Le._dowCache[r]=c,c}dayOfYear(){let s=Le.isLeapYear(this.year)?1:0;return Le.daysInYearPassedMonth[s][this.month-1]+this.day}startOfWeek(s){let n=s||Le.SUNDAY,r=this.clone();return r.day-=(this.dayOfWeek()+7-n)%7,r.isDate=!0,r.hour=0,r.minute=0,r.second=0,r}endOfWeek(s){let n=s||Le.SUNDAY,r=this.clone();return r.day+=(7-this.dayOfWeek()+n-Le.SUNDAY)%7,r.isDate=!0,r.hour=0,r.minute=0,r.second=0,r}startOfMonth(){let s=this.clone();return s.day=1,s.isDate=!0,s.hour=0,s.minute=0,s.second=0,s}endOfMonth(){let s=this.clone();return s.day=Le.daysInMonth(s.month,s.year),s.isDate=!0,s.hour=0,s.minute=0,s.second=0,s}startOfYear(){let s=this.clone();return s.day=1,s.month=1,s.isDate=!0,s.hour=0,s.minute=0,s.second=0,s}endOfYear(){let s=this.clone();return s.day=31,s.month=12,s.isDate=!0,s.hour=0,s.minute=0,s.second=0,s}startDoyWeek(s){let n=s||Le.SUNDAY,r=this.dayOfWeek()-n;return r<0&&(r+=7),this.dayOfYear()-r}getDominicalLetter(){return Le.getDominicalLetter(this.year)}nthWeekDay(s,n){let r=Le.daysInMonth(this.month,this.year),a,i=n,o=0,c=this.clone();if(i>=0){c.day=1,i!=0&&i--,o=c.day;let u=c.dayOfWeek(),d=s-u;d<0&&(d+=7),o+=d,o-=s,a=s}else{c.day=r;let u=c.dayOfWeek();i++,a=u-s,a<0&&(a+=7),a=r-a}return a+=i*7,o+a}isNthWeekDay(s,n){let r=this.dayOfWeek();return n===0&&r===s||this.nthWeekDay(s,n)===this.day}weekNumber(s){let n=(this.year<<12)+(this.month<<8)+(this.day<<3)+s;if(n in Le._wnCache)return Le._wnCache[n];let r,a=this.clone();a.isDate=!0;let i=this.year;a.month==12&&a.day>25?(r=Le.weekOneStarts(i+1,s),a.compare(r)<0?r=Le.weekOneStarts(i,s):i++):(r=Le.weekOneStarts(i,s),a.compare(r)<0&&(r=Le.weekOneStarts(--i,s)));let o=a.subtractDate(r).toSeconds()/86400,c=hn(o/7)+1;return Le._wnCache[n]=c,c}addDuration(s){let n=s.isNegative?-1:1,r=this.second,a=this.minute,i=this.hour,o=this.day;r+=n*s.seconds,a+=n*s.minutes,i+=n*s.hours,o+=n*s.days,o+=n*7*s.weeks,this.second=r,this.minute=a,this.hour=i,this.day=o,this._cachedUnixTime=null}subtractDate(s){let n=this.toUnixTime()+this.utcOffset(),r=s.toUnixTime()+s.utcOffset();return Mn.fromSeconds(n-r)}subtractDateTz(s){let n=this.toUnixTime(),r=s.toUnixTime();return Mn.fromSeconds(n-r)}compare(s){if(s instanceof oi)return-1*s.compare(this);{let n=this.toUnixTime(),r=s.toUnixTime();return n>r?1:r>n?-1:0}}compareDateOnlyTz(s,n){let r=this.convertToZone(n),a=s.convertToZone(n),i=0;return(i=Le._cmp_attr(r,a,"year"))!=0||(i=Le._cmp_attr(r,a,"month"))!=0||(i=Le._cmp_attr(r,a,"day"))!=0,i}convertToZone(s){let n=this.clone(),r=this.zone.tzid==s.tzid;return!this.isDate&&!r&&ss.convert_time(n,this.zone,s),n.zone=s,n}utcOffset(){return this.zone==ss.localTimezone||this.zone==ss.utcTimezone?0:this.zone.utcOffset(this)}toICALString(){let s=this.toString();return s.length>10?$s.icalendar.value["date-time"].toICAL(s):$s.icalendar.value.date.toICAL(s)}toString(){let s=this.year+"-"+ir(this.month)+"-"+ir(this.day);return this.isDate||(s+="T"+ir(this.hour)+":"+ir(this.minute)+":"+ir(this.second),this.zone===ss.utcTimezone&&(s+="Z")),s}toJSDate(){return this.zone==ss.localTimezone?this.isDate?new Date(this.year,this.month-1,this.day):new Date(this.year,this.month-1,this.day,this.hour,this.minute,this.second,0):new Date(this.toUnixTime()*1e3)}_normalize(){return this._time.isDate&&(this._time.hour=0,this._time.minute=0,this._time.second=0),this.adjust(0,0,0,0),this}adjust(s,n,r,a,i){let o,c,u=0,d=0,h,p,g,x,y,b=i||this._time;if(b.isDate||(h=b.second+a,b.second=h%60,o=hn(h/60),b.second<0&&(b.second+=60,o--),p=b.minute+r+o,b.minute=p%60,c=hn(p/60),b.minute<0&&(b.minute+=60,c--),g=b.hour+n+c,b.hour=g%24,u=hn(g/24),b.hour<0&&(b.hour+=24,u--)),b.month>12?d=hn((b.month-1)/12):b.month<1&&(d=hn(b.month/12)-1),b.year+=d,b.month-=12*d,x=b.day+s+u,x>0)for(;y=Le.daysInMonth(b.month,b.year),!(x<=y);)b.month++,b.month>12&&(b.year++,b.month=1),x-=y;else for(;x<=0;)b.month==1?(b.year--,b.month=12):b.month--,x+=Le.daysInMonth(b.month,b.year);return b.day=x,this._cachedUnixTime=null,this}fromUnixTime(s){this.zone=ss.utcTimezone;let n=new Date(s*1e3);this.year=n.getUTCFullYear(),this.month=n.getUTCMonth()+1,this.day=n.getUTCDate(),this._time.isDate?(this.hour=0,this.minute=0,this.second=0):(this.hour=n.getUTCHours(),this.minute=n.getUTCMinutes(),this.second=n.getUTCSeconds()),this._cachedUnixTime=null}toUnixTime(){if(this._cachedUnixTime!==null)return this._cachedUnixTime;let s=this.utcOffset(),n=Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second-s);return this._cachedUnixTime=n/1e3,this._cachedUnixTime}toJSON(){let s=["year","month","day","hour","minute","second","isDate"],n=Object.create(null),r=0,a=s.length,i;for(;r<a;r++)i=s[r],n[i]=this[i];return this.zone&&(n.timezone=this.zone.tzid),n}};yl=new WeakMap,he(Le,"_dowCache",{}),he(Le,"_wnCache",{}),he(Le,"fromData",function(n,r){return new Le().fromData(n,r)}),Cu(Le,yl,null),he(Le,"daysInYearPassedMonth",[[0,31,59,90,120,151,181,212,243,273,304,334,365],[0,31,60,91,121,152,182,213,244,274,305,335,366]]),he(Le,"SUNDAY",1),he(Le,"MONDAY",2),he(Le,"TUESDAY",3),he(Le,"WEDNESDAY",4),he(Le,"THURSDAY",5),he(Le,"FRIDAY",6),he(Le,"SATURDAY",7),he(Le,"DEFAULT_WEEK_START",2);let Ye=Le;const gH=/[^ \t]/,bm=":",Yp=";",vH="=",yH="unknown",bH="text",jH={"^'":'"',"^n":`
`,"^^":"^"};function Xt(t){let s={},n=s.component=[];if(s.stack=[n],Xt._eachLine(t,function(r,a){Xt._handleContentLine(a,s)}),s.stack.length>1)throw new Io("invalid ical body. component began but did not end");return s=null,n.length==1?n[0]:n}Xt.property=function(t,s){let n={component:[[],[]],designSet:s||$s.defaultSet};return Xt._handleContentLine(t,n),n.component[1][0]};Xt.component=function(t){return Xt(t)};class Io extends Error{constructor(){super(...arguments);he(this,"name",this.constructor.name)}}Xt.ParserError=Io;Xt._handleContentLine=function(t,s){let n=t.indexOf(bm),r=t.indexOf(Yp),a,i,o,c,u={};r!==-1&&n!==-1&&r>n&&(r=-1);let d;if(r!==-1){if(o=t.slice(0,Math.max(0,r)).toLowerCase(),d=Xt._parseParameters(t.slice(Math.max(0,r)),0,s.designSet),d[2]==-1)throw new Io("Invalid parameters in '"+t+"'");u=d[0];let w;if(typeof d[1]=="string"?w=d[1].length:w=d[1].reduce((N,S)=>N+S.length,0),a=w+d[2]+r,(i=t.slice(Math.max(0,a)).indexOf(bm))!==-1)c=t.slice(Math.max(0,a+i+1));else throw new Io("Missing parameter value in '"+t+"'")}else if(n!==-1){if(o=t.slice(0,Math.max(0,n)).toLowerCase(),c=t.slice(Math.max(0,n+1)),o==="begin"){let w=[c.toLowerCase(),[],[]];s.stack.length===1?s.component.push(w):s.component[2].push(w),s.stack.push(s.component),s.component=w,s.designSet||(s.designSet=$s.getDesignSet(s.component[0]));return}else if(o==="end"){s.component=s.stack.pop();return}}else throw new Io('invalid line (no token ";" or ":") "'+t+'"');let h,p=!1,g=!1,x,y,b;s.designSet.propertyGroups&&o.indexOf(".")!==-1?(y=o.split("."),u.group=y[0],b=y[1]):b=o,b in s.designSet.property&&(x=s.designSet.property[b],"multiValue"in x&&(p=x.multiValue),"structuredValue"in x&&(g=x.structuredValue),c&&"detectType"in x&&(h=x.detectType(c))),h||("value"in u?h=u.value.toLowerCase():x?h=x.defaultType:h=yH),delete u.value;let v;p&&g?(c=Xt._parseMultiValue(c,g,h,[],p,s.designSet,g),v=[b,u,h,c]):p?(v=[b,u,h],Xt._parseMultiValue(c,p,h,v,null,s.designSet,!1)):g?(c=Xt._parseMultiValue(c,g,h,[],null,s.designSet,g),v=[b,u,h,c]):(c=Xt._parseValue(c,h,s.designSet,!1),v=[b,u,h,c]),s.component[0]==="vcard"&&s.component[1].length===0&&!(o==="version"&&c==="4.0")&&(s.designSet=$s.getDesignSet("vcard3")),s.component[1].push(v)};Xt._parseValue=function(t,s,n,r){return s in n.value&&"fromICAL"in n.value[s]?n.value[s].fromICAL(t,r):t};Xt._parseParameters=function(t,s,n){let r=s,a=0,i=vH,o={},c,u,d,h=-1,p,g,x;for(;a!==!1&&(a=t.indexOf(i,a+1))!==-1;){if(c=t.slice(r+1,a),c.length==0)throw new Io("Empty parameter name in '"+t+"'");if(u=c.toLowerCase(),x=!1,g=!1,u in n.param&&n.param[u].valueType?p=n.param[u].valueType:p=bH,u in n.param&&(g=n.param[u].multiValue,n.param[u].multiValueSeparateDQuote&&(x=Xt._rfc6868Escape('"'+g+'"'))),t[a+1]==='"'){if(h=a+2,a=t.indexOf('"',h),g&&a!=-1){let w=!0;for(;w;)t[a+1]==g&&t[a+2]=='"'?a=t.indexOf('"',a+3):w=!1}if(a===-1)throw new Io('invalid line (no matching double quote) "'+t+'"');d=t.slice(h,a),r=t.indexOf(Yp,a);let v=t.indexOf(bm,a);(r===-1||v!==-1&&r>v)&&(a=!1)}else{h=a+1;let v=t.indexOf(Yp,h),w=t.indexOf(bm,h);w!==-1&&v>w?(v=w,a=!1):v===-1?(w===-1?v=t.length:v=w,a=!1):(r=v,a=v),d=t.slice(h,v)}const b=d.length;if(d=Xt._rfc6868Escape(d),h+=b-d.length,g){let v=x||g;d=Xt._parseMultiValue(d,v,p,[],null,n)}else d=Xt._parseValue(d,p,n);g&&u in o?Array.isArray(o[u])?o[u].push(d):o[u]=[o[u],d]:o[u]=d}return[o,d,h]};Xt._rfc6868Escape=function(t){return t.replace(/\^['n^]/g,function(s){return jH[s]})};Xt._parseMultiValue=function(t,s,n,r,a,i,o){let c=0,u=0,d;if(s.length===0)return t;for(;(c=O1(t,s,u))!==-1;)d=t.slice(u,c),a?d=Xt._parseMultiValue(d,a,n,[],null,i,o):d=Xt._parseValue(d,n,i,o),r.push(d),u=c+s.length;return d=t.slice(u),a?d=Xt._parseMultiValue(d,a,n,[],null,i,o):d=Xt._parseValue(d,n,i,o),r.push(d),r.length==1?r[0]:r};Xt._eachLine=function(t,s){let n=t.length,r=t.search(gH),a=r,i,o,c;do a=t.indexOf(`
`,r)+1,a>1&&t[a-2]==="\r"?c=2:c=1,a===0&&(a=n,c=0),o=t[r],o===" "||o==="	"?i+=t.slice(r+1,a-c):(i&&s(null,i),i=t.slice(r,a-c)),r=a;while(a!==n);i=i.trim(),i.length&&s(null,i)};const wH=["tzid","location","tznames","latitude","longitude"];var bl,jl;const Yt=class Yt{constructor(s){he(this,"tzid","");he(this,"location","");he(this,"tznames","");he(this,"latitude",0);he(this,"longitude",0);he(this,"component",null);he(this,"expandedUntilYear",0);he(this,"icalclass","icaltimezone");this.wrappedJSObject=this,this.fromData(s)}static _compare_change_fn(s,n){return s.year<n.year?-1:s.year>n.year?1:s.month<n.month?-1:s.month>n.month?1:s.day<n.day?-1:s.day>n.day?1:s.hour<n.hour?-1:s.hour>n.hour?1:s.minute<n.minute?-1:s.minute>n.minute?1:s.second<n.second?-1:s.second>n.second?1:0}static convert_time(s,n,r){if(s.isDate||n.tzid==r.tzid||n==Yt.localTimezone||r==Yt.localTimezone)return s.zone=r,s;let a=n.utcOffset(s);return s.adjust(0,0,0,-a),a=r.utcOffset(s),s.adjust(0,0,0,a),null}static fromData(s){return new Yt().fromData(s)}static get utcTimezone(){return To(this,bl)||Eu(this,bl,Yt.fromData({tzid:"UTC"})),To(this,bl)}static get localTimezone(){return To(this,jl)||Eu(this,jl,Yt.fromData({tzid:"floating"})),To(this,jl)}static adjust_change(s,n,r,a,i){return Ye.prototype.adjust.call(s,n,r,a,i,s)}fromData(s){if(this.expandedUntilYear=0,this.changes=[],s instanceof yr)this.component=s;else{if(s&&"component"in s)if(typeof s.component=="string"){let n=Xt(s.component);this.component=new yr(n)}else s.component instanceof yr?this.component=s.component:this.component=null;for(let n of wH)s&&n in s&&(this[n]=s[n])}return this.component instanceof yr&&!this.tzid&&(this.tzid=this.component.getFirstPropertyValue("tzid")),this}utcOffset(s){if(this==Yt.utcTimezone||this==Yt.localTimezone||(this._ensureCoverage(s.year),!this.changes.length))return 0;let n={year:s.year,month:s.month,day:s.day,hour:s.hour,minute:s.minute,second:s.second},r=this._findNearbyChange(n),a=-1,i=1;for(;;){let u=Yo(this.changes[r],!0);if(u.utcOffset<u.prevUtcOffset?Yt.adjust_change(u,0,0,0,u.utcOffset):Yt.adjust_change(u,0,0,0,u.prevUtcOffset),Yt._compare_change_fn(n,u)>=0?a=r:i=-1,i==-1&&a!=-1)break;if(r+=i,r<0)return 0;if(r>=this.changes.length)break}let o=this.changes[a];if(o.utcOffset-o.prevUtcOffset<0&&a>0){let u=Yo(o,!0);if(Yt.adjust_change(u,0,0,0,u.prevUtcOffset),Yt._compare_change_fn(n,u)<0){let d=this.changes[a-1],h=!1;o.is_daylight!=h&&d.is_daylight==h&&(o=d)}}return o.utcOffset}_findNearbyChange(s){let n=Lo(this.changes,s,Yt._compare_change_fn);return n>=this.changes.length?this.changes.length-1:n}_ensureCoverage(s){if(Yt._minimumExpansionYear==-1){let r=Ye.now();Yt._minimumExpansionYear=r.year}let n=s;if(n<Yt._minimumExpansionYear&&(n=Yt._minimumExpansionYear),n+=Yt.EXTRA_COVERAGE,!this.changes.length||this.expandedUntilYear<s){let r=this.component.getAllSubcomponents(),a=r.length,i=0;for(;i<a;i++)this._expandComponent(r[i],n,this.changes);this.changes.sort(Yt._compare_change_fn),this.expandedUntilYear=n}}_expandComponent(s,n,r){if(!s.hasProperty("dtstart")||!s.hasProperty("tzoffsetto")||!s.hasProperty("tzoffsetfrom"))return null;let a=s.getFirstProperty("dtstart").getFirstValue(),i;function o(u){return u.factor*(u.hours*3600+u.minutes*60)}function c(){let u={};return u.is_daylight=s.name=="daylight",u.utcOffset=o(s.getFirstProperty("tzoffsetto").getFirstValue()),u.prevUtcOffset=o(s.getFirstProperty("tzoffsetfrom").getFirstValue()),u}if(!s.hasProperty("rrule")&&!s.hasProperty("rdate"))i=c(),i.year=a.year,i.month=a.month,i.day=a.day,i.hour=a.hour,i.minute=a.minute,i.second=a.second,Yt.adjust_change(i,0,0,0,-i.prevUtcOffset),r.push(i);else{let u=s.getAllProperties("rdate");for(let h of u){let p=h.getFirstValue();i=c(),i.year=p.year,i.month=p.month,i.day=p.day,p.isDate?(i.hour=a.hour,i.minute=a.minute,i.second=a.second,a.zone!=Yt.utcTimezone&&Yt.adjust_change(i,0,0,0,-i.prevUtcOffset)):(i.hour=p.hour,i.minute=p.minute,i.second=p.second,p.zone!=Yt.utcTimezone&&Yt.adjust_change(i,0,0,0,-i.prevUtcOffset)),r.push(i)}let d=s.getFirstProperty("rrule");if(d){d=d.getFirstValue(),i=c(),d.until&&d.until.zone==Yt.utcTimezone&&(d.until.adjust(0,0,0,i.prevUtcOffset),d.until.zone=Yt.localTimezone);let h=d.iterator(a),p;for(;(p=h.next())&&(i=c(),!(p.year>n||!p));)i.year=p.year,i.month=p.month,i.day=p.day,i.hour=p.hour,i.minute=p.minute,i.second=p.second,i.isDate=p.isDate,Yt.adjust_change(i,0,0,0,-i.prevUtcOffset),r.push(i)}}return r}toString(){return this.tznames?this.tznames:this.tzid}};bl=new WeakMap,jl=new WeakMap,Cu(Yt,bl,null),Cu(Yt,jl,null),he(Yt,"_minimumExpansionYear",-1),he(Yt,"EXTRA_COVERAGE",5);let ss=Yt,Un=null;const jm={get count(){return Un===null?0:Object.keys(Un).length},reset:function(){Un=Object.create(null);let t=ss.utcTimezone;Un.Z=t,Un.UTC=t,Un.GMT=t},_hard_reset:function(){Un=null},has:function(t){return Un===null?!1:!!Un[t]},get:function(t){return Un===null&&this.reset(),Un[t]},register:function(t,s){if(Un===null&&this.reset(),typeof t=="string"&&s instanceof ss&&([t,s]=[s,t]),s||(t instanceof ss?s=t.tzid:t.name==="vtimezone"&&(t=new ss(t),s=t.tzid)),!s)throw new TypeError("Neither a timezone nor a name was passed");if(t instanceof ss)Un[s]=t;else throw new TypeError("timezone must be ICAL.Timezone or ICAL.Component")},remove:function(t){return Un===null?null:delete Un[t]}};function NH(t){let s,n,r,a,i;if(!t||t.name!=="vcalendar")return t;for(s=t.getAllSubcomponents(),n=[],r={},i=0;i<s.length;i++)if(s[i].name==="vtimezone"){let o=s[i].getFirstProperty("tzid").getFirstValue();r[o]=s[i]}else n=n.concat(s[i].getAllProperties());for(a={},i=0;i<n.length;i++){let o=n[i].getParameter("tzid");o&&(a[o]=!0)}for(let[o,c]of Object.entries(r))a[o]||t.removeSubcomponent(c);for(let o of Object.keys(a))!r[o]&&jm.has(o)&&t.addSubcomponent(jm.get(o).component);return t}function od(t){return typeof t=="number"&&isNaN(t)}function An(t){let s=parseInt(t,10);if(od(s))throw new Error('Could not extract integer from "'+t+'"');return s}function li(t,s){if(!(typeof t>"u"))return t instanceof s?t:new s(t)}function O1(t,s,n){for(;(n=t.indexOf(s,n))!==-1;)if(n>0&&t[n-1]==="\\")n+=1;else return n;return-1}function Lo(t,s,n){if(!t.length)return 0;let r=0,a=t.length-1,i,o;for(;r<=a;)if(i=r+Math.floor((a-r)/2),o=n(s,t[i]),o<0)a=i-1;else if(o>0)r=i+1;else break;return o<0?i:o>0?i+1:i}function Yo(t,s){if(!t||typeof t!="object")return t;if(t instanceof Date)return new Date(t.getTime());if("clone"in t)return t.clone();if(Array.isArray(t)){let n=[];for(let r=0;r<t.length;r++)n.push(s?Yo(t[r],!0):t[r]);return n}else{let n={};for(let[r,a]of Object.entries(t))s?n[r]=Yo(a,!0):n[r]=a;return n}}function P1(t){let s="",n=t||"",r=0,a=0;for(;n.length;){let i=n.codePointAt(r);i<128?++a:i<2048?a+=2:i<65536?a+=3:a+=4,a<gl.foldLength+1?r+=i>65535?2:1:(s+=gl.newLineChar+" "+n.slice(0,Math.max(0,r)),n=n.slice(Math.max(0,r)),r=a=0)}return s.slice(gl.newLineChar.length+1)}function ir(t){switch(typeof t!="string"&&(typeof t=="number"&&(t=parseInt(t)),t=String(t)),t.length){case 0:return"00";case 1:return"0"+t;default:return t}}function hn(t){return t<0?Math.ceil(t):Math.floor(t)}function Jo(t,s){for(let n in t){let r=Object.getOwnPropertyDescriptor(t,n);r&&!Object.getOwnPropertyDescriptor(s,n)&&Object.defineProperty(s,n,r)}return s}var SH=Object.freeze({__proto__:null,binsearchInsert:Lo,clone:Yo,extend:Jo,foldline:P1,formatClassType:li,isStrictlyNaN:od,pad2:ir,strictParseInt:An,trunc:hn,unescapedIndexOf:O1,updateTimezones:NH});class na{constructor(s){he(this,"hours",0);he(this,"minutes",0);he(this,"factor",1);he(this,"icaltype","utc-offset");this.fromData(s)}static fromString(s){let n={};return n.factor=s[0]==="+"?1:-1,n.hours=An(s.slice(1,3)),n.minutes=An(s.slice(4,6)),new na(n)}static fromSeconds(s){let n=new na;return n.fromSeconds(s),n}clone(){return na.fromSeconds(this.toSeconds())}fromData(s){if(s)for(let[n,r]of Object.entries(s))this[n]=r;this._normalize()}fromSeconds(s){let n=Math.abs(s);return this.factor=s<0?-1:1,this.hours=hn(n/3600),n-=this.hours*3600,this.minutes=hn(n/60),this}toSeconds(){return this.factor*(60*this.minutes+3600*this.hours)}compare(s){let n=this.toSeconds(),r=s.toSeconds();return(n>r)-(r>n)}_normalize(){let s=this.toSeconds(),n=this.factor;for(;s<-43200;)s+=97200;for(;s>50400;)s-=97200;this.fromSeconds(s),s==0&&(this.factor=n)}toICALString(){return $s.icalendar.value["utc-offset"].toICAL(this.toString())}toString(){return(this.factor==1?"+":"-")+ir(this.hours)+":"+ir(this.minutes)}}class Zi extends Ye{constructor(n,r,a){super(n,r);he(this,"icalclass","vcardtime");he(this,"icaltype","date-and-or-time");this.icaltype=a||"date-and-or-time"}static fromDateAndOrTimeString(n,r){function a(v,w,N){return v?An(v.slice(w,w+N)):null}let i=n.split("T"),o=i[0],c=i[1],u=c?$s.vcard.value.time._splitZone(c):[],d=u[0],h=u[1],p=o?o.length:0,g=h?h.length:0,x=o&&o[0]=="-"&&o[1]=="-",y=h&&h[0]=="-",b={year:x?null:a(o,0,4),month:x&&(p==4||p==7)?a(o,2,2):p==7||p==10?a(o,5,2):null,day:p==5?a(o,3,2):p==7&&x?a(o,5,2):p==10?a(o,8,2):null,hour:y?null:a(h,0,2),minute:y&&g==3?a(h,1,2):g>4?y?a(h,1,2):a(h,3,2):null,second:g==4?a(h,2,2):g==6?a(h,4,2):g==8?a(h,6,2):null};return d=="Z"?d=ss.utcTimezone:d&&d[3]==":"?d=na.fromString(d):d=null,new Zi(b,d,r)}clone(){return new Zi(this._time,this.zone,this.icaltype)}_normalize(){return this}utcOffset(){return this.zone instanceof na?this.zone.toSeconds():Ye.prototype.utcOffset.apply(this,arguments)}toICALString(){return $s.vcard.value[this.icaltype].toICAL(this.toString())}toString(){let n=this.year,r=this.month,a=this.day,i=this.hour,o=this.minute,c=this.second,u=n!==null,d=r!==null,h=a!==null,p=i!==null,g=o!==null,x=c!==null,y=(u?ir(n)+(d||h?"-":""):d||h?"--":"")+(d?ir(r):"")+(h?"-"+ir(a):""),b=(p?ir(i):"-")+(p&&g?":":"")+(g?ir(o):"")+(!p&&!g?"-":"")+(g&&x?":":"")+(x?ir(c):""),v;switch(this.zone===ss.utcTimezone?v="Z":this.zone instanceof na?v=this.zone.toString():this.zone===ss.localTimezone?v="":this.zone instanceof ss?v=na.fromSeconds(this.zone.utcOffset(this)).toString():v="",this.icaltype){case"time":return b+v;case"date-and-or-time":case"date-time":return y+(b=="--"?"":"T"+b+v);case"date":return y}return null}}const sr=class sr{constructor(s){he(this,"completed",!1);he(this,"rule",null);he(this,"dtstart",null);he(this,"last",null);he(this,"occurrence_number",0);he(this,"by_indices",null);he(this,"initialized",!1);he(this,"by_data",null);he(this,"days",null);he(this,"days_index",0);this.fromData(s)}fromData(s){if(this.rule=li(s.rule,Rn),!this.rule)throw new Error("iterator requires a (ICAL.Recur) rule");if(this.dtstart=li(s.dtstart,Ye),!this.dtstart)throw new Error("iterator requires a (ICAL.Time) dtstart");if(s.by_data?this.by_data=s.by_data:this.by_data=Yo(this.rule.parts,!0),s.occurrence_number&&(this.occurrence_number=s.occurrence_number),this.days=s.days||[],s.last&&(this.last=li(s.last,Ye)),this.by_indices=s.by_indices,this.by_indices||(this.by_indices={BYSECOND:0,BYMINUTE:0,BYHOUR:0,BYDAY:0,BYMONTH:0,BYWEEKNO:0,BYMONTHDAY:0}),this.initialized=s.initialized||!1,!this.initialized)try{this.init()}catch(n){if(n instanceof $u)this.completed=!0;else throw n}}init(){this.initialized=!0,this.last=this.dtstart.clone();let s=this.by_data;if("BYDAY"in s&&this.sort_byday_rules(s.BYDAY),"BYYEARDAY"in s&&("BYMONTH"in s||"BYWEEKNO"in s||"BYMONTHDAY"in s))throw new Error("Invalid BYYEARDAY rule");if("BYWEEKNO"in s&&"BYMONTHDAY"in s)throw new Error("BYWEEKNO does not fit to BYMONTHDAY");if(this.rule.freq=="MONTHLY"&&("BYYEARDAY"in s||"BYWEEKNO"in s))throw new Error("For MONTHLY recurrences neither BYYEARDAY nor BYWEEKNO may appear");if(this.rule.freq=="WEEKLY"&&("BYYEARDAY"in s||"BYMONTHDAY"in s))throw new Error("For WEEKLY recurrences neither BYMONTHDAY nor BYYEARDAY may appear");if(this.rule.freq!="YEARLY"&&"BYYEARDAY"in s)throw new Error("BYYEARDAY may only appear in YEARLY rules");if(this.last.second=this.setup_defaults("BYSECOND","SECONDLY",this.dtstart.second),this.last.minute=this.setup_defaults("BYMINUTE","MINUTELY",this.dtstart.minute),this.last.hour=this.setup_defaults("BYHOUR","HOURLY",this.dtstart.hour),this.last.day=this.setup_defaults("BYMONTHDAY","DAILY",this.dtstart.day),this.last.month=this.setup_defaults("BYMONTH","MONTHLY",this.dtstart.month),this.rule.freq=="WEEKLY")if("BYDAY"in s){let[,n]=this.ruleDayOfWeek(s.BYDAY[0],this.rule.wkst),r=n-this.last.dayOfWeek(this.rule.wkst);(this.last.dayOfWeek(this.rule.wkst)<n&&r>=0||r<0)&&(this.last.day+=r)}else{let n=Rn.numericDayToIcalDay(this.dtstart.dayOfWeek());s.BYDAY=[n]}if(this.rule.freq=="YEARLY"){const n=this.rule.until?this.rule.until.year:2e4;for(;this.last.year<=n&&(this.expand_year_days(this.last.year),!(this.days.length>0));)this.increment_year(this.rule.interval);if(this.days.length==0)throw new $u;if(!this._nextByYearDay()&&!this.next_year()&&!this.next_year()&&!this.next_year())throw new $u}if(this.rule.freq=="MONTHLY"){if(this.has_by_data("BYDAY")){let n=null,r=this.last.clone(),a=Ye.daysInMonth(this.last.month,this.last.year);for(let i of this.by_data.BYDAY){this.last=r.clone();let[o,c]=this.ruleDayOfWeek(i),u=this.last.nthWeekDay(c,o);if(o>=6||o<=-6)throw new Error("Malformed values in BYDAY part");if(u>a||u<=0){if(n&&n.month==r.month)continue;for(;u>a||u<=0;)this.increment_month(),a=Ye.daysInMonth(this.last.month,this.last.year),u=this.last.nthWeekDay(c,o)}this.last.day=u,(!n||this.last.compare(n)<0)&&(n=this.last.clone())}if(this.last=n.clone(),this.has_by_data("BYMONTHDAY")&&this._byDayAndMonthDay(!0),this.last.day>a||this.last.day==0)throw new Error("Malformed values in BYDAY part")}else if(this.has_by_data("BYMONTHDAY")){this.last.day=1;let n=this.normalizeByMonthDayRules(this.last.year,this.last.month,this.rule.parts.BYMONTHDAY).filter(r=>r>=this.last.day);if(n.length)this.last.day=n[0],this.by_data.BYMONTHDAY=n;else if(!this.next_month()&&!this.next_month()&&!this.next_month())throw new $u}}}next(s=!1){let n=this.last?this.last.clone():null;if((this.rule.count&&this.occurrence_number>=this.rule.count||this.rule.until&&this.last.compare(this.rule.until)>0)&&(this.completed=!0),this.completed)return null;if(this.occurrence_number==0&&this.last.compare(this.dtstart)>=0)return this.occurrence_number++,this.last;let r,a=0;do switch(r=1,this.rule.freq){case"SECONDLY":this.next_second();break;case"MINUTELY":this.next_minute();break;case"HOURLY":this.next_hour();break;case"DAILY":this.next_day();break;case"WEEKLY":this.next_week();break;case"MONTHLY":if(r=this.next_month(),r)a=0;else if(++a==336)return this.completed=!0,null;break;case"YEARLY":if(r=this.next_year(),r)a=0;else if(++a==28)return this.completed=!0,null;break;default:return null}while(!this.check_contracting_rules()||this.last.compare(this.dtstart)<0||!r);if(this.last.compare(n)==0){if(s)throw new Error("Same occurrence found twice, protecting you from death by recursion");this.next(!0)}return this.rule.until&&this.last.compare(this.rule.until)>0?(this.completed=!0,null):(this.occurrence_number++,this.last)}next_second(){return this.next_generic("BYSECOND","SECONDLY","second","minute")}increment_second(s){return this.increment_generic(s,"second",60,"minute")}next_minute(){return this.next_generic("BYMINUTE","MINUTELY","minute","hour","next_second")}increment_minute(s){return this.increment_generic(s,"minute",60,"hour")}next_hour(){return this.next_generic("BYHOUR","HOURLY","hour","monthday","next_minute")}increment_hour(s){this.increment_generic(s,"hour",24,"monthday")}next_day(){let s=this.rule.freq=="DAILY";return this.next_hour()==0||(s?this.increment_monthday(this.rule.interval):this.increment_monthday(1)),0}next_week(){let s=0;if(this.next_weekday_by_week()==0)return s;if(this.has_by_data("BYWEEKNO")){this.by_indices.BYWEEKNO++,this.by_indices.BYWEEKNO==this.by_data.BYWEEKNO.length&&(this.by_indices.BYWEEKNO=0,s=1),this.last.month=1,this.last.day=1;let n=this.by_data.BYWEEKNO[this.by_indices.BYWEEKNO];this.last.day+=7*n,s&&this.increment_year(1)}else this.increment_monthday(7*this.rule.interval);return s}normalizeByMonthDayRules(s,n,r){let a=Ye.daysInMonth(n,s),i=[],o=0,c=r.length,u;for(;o<c;o++){if(u=parseInt(r[o],10),isNaN(u))throw new Error("Invalid BYMONTHDAY value");if(!(Math.abs(u)>a)){if(u<0)u=a+(u+1);else if(u===0)continue;i.indexOf(u)===-1&&i.push(u)}}return i.sort(function(d,h){return d-h})}_byDayAndMonthDay(s){let n,r=this.by_data.BYDAY,a,i=0,o,c=r.length,u=0,d,h=this,p=this.last.day;function g(){for(d=Ye.daysInMonth(h.last.month,h.last.year),n=h.normalizeByMonthDayRules(h.last.year,h.last.month,h.by_data.BYMONTHDAY),o=n.length;n[i]<=p&&!(s&&n[i]==p)&&i<o-1;)i++}function x(){p=0,h.increment_month(),i=0,g()}g(),s&&(p-=1);let y=48;for(;!u&&y;){if(y--,a=p+1,a>d){x();continue}let b=n[i++];if(b>=a)p=b;else{x();continue}for(let v=0;v<c;v++){let w=this.ruleDayOfWeek(r[v]),N=w[0],S=w[1];if(this.last.day=p,this.last.isNthWeekDay(S,N)){u=1;break}}if(!u&&i===o){x();continue}}if(y<=0)throw new Error("Malformed values in BYDAY combined with BYMONTHDAY parts");return u}next_month(){let s=1;if(this.next_hour()==0)return s;if(this.has_by_data("BYDAY")&&this.has_by_data("BYMONTHDAY"))s=this._byDayAndMonthDay();else if(this.has_by_data("BYDAY")){let n=Ye.daysInMonth(this.last.month,this.last.year),r=0,a=0;if(this.has_by_data("BYSETPOS")){let o=this.last.day;for(let c=1;c<=n;c++)this.last.day=c,this.is_day_in_byday(this.last)&&(a++,c<=o&&r++);this.last.day=o}s=0;let i;for(i=this.last.day+1;i<=n;i++)if(this.last.day=i,this.is_day_in_byday(this.last)&&(!this.has_by_data("BYSETPOS")||this.check_set_position(++r)||this.check_set_position(r-a-1))){s=1;break}i>n&&(this.last.day=1,this.increment_month(),this.is_day_in_byday(this.last)?(!this.has_by_data("BYSETPOS")||this.check_set_position(1))&&(s=1):s=0)}else if(this.has_by_data("BYMONTHDAY")){if(this.by_indices.BYMONTHDAY++,this.by_indices.BYMONTHDAY>=this.by_data.BYMONTHDAY.length&&(this.by_indices.BYMONTHDAY=0,this.increment_month(),this.by_indices.BYMONTHDAY>=this.by_data.BYMONTHDAY.length))return 0;let n=Ye.daysInMonth(this.last.month,this.last.year),r=this.by_data.BYMONTHDAY[this.by_indices.BYMONTHDAY];r<0&&(r=n+r+1),r>n?(this.last.day=1,s=this.is_day_in_byday(this.last)):this.last.day=r}else{this.increment_month();let n=Ye.daysInMonth(this.last.month,this.last.year);this.by_data.BYMONTHDAY[0]>n?s=0:this.last.day=this.by_data.BYMONTHDAY[0]}return s}next_weekday_by_week(){let s=0;if(this.next_hour()==0)return s;if(!this.has_by_data("BYDAY"))return 1;for(;;){let n=new Ye;this.by_indices.BYDAY++,this.by_indices.BYDAY==Object.keys(this.by_data.BYDAY).length&&(this.by_indices.BYDAY=0,s=1);let r=this.by_data.BYDAY[this.by_indices.BYDAY],i=this.ruleDayOfWeek(r)[1];i-=this.rule.wkst,i<0&&(i+=7),n.year=this.last.year,n.month=this.last.month,n.day=this.last.day;let o=n.startDoyWeek(this.rule.wkst);if(i+o<1&&!s)continue;let c=Ye.fromDayOfYear(o+i,this.last.year);return this.last.year=c.year,this.last.month=c.month,this.last.day=c.day,s}}next_year(){return this.next_hour()==0||(this.days.length==0||++this.days_index==this.days.length)&&(this.days_index=0,this.increment_year(this.rule.interval),this.has_by_data("BYMONTHDAY")&&(this.by_data.BYMONTHDAY=this.normalizeByMonthDayRules(this.last.year,this.last.month,this.rule.parts.BYMONTHDAY)),this.expand_year_days(this.last.year),this.days.length==0)?0:this._nextByYearDay()}_nextByYearDay(){let s=this.days[this.days_index],n=this.last.year;if(Math.abs(s)==366&&!Ye.isLeapYear(this.last.year))return 0;s<1&&(s+=1,n+=1);let r=Ye.fromDayOfYear(s,n);return this.last.day=r.day,this.last.month=r.month,1}ruleDayOfWeek(s,n){let r=s.match(/([+-]?[0-9])?(MO|TU|WE|TH|FR|SA|SU)/);if(r){let a=parseInt(r[1]||0,10);return s=Rn.icalDayToNumericDay(r[2],n),[a,s]}else return[0,0]}next_generic(s,n,r,a,i){let o=s in this.by_data,c=this.rule.freq==n,u=0;if(i&&this[i]()==0)return u;if(o){this.by_indices[s]++;let d=this.by_data[s];this.by_indices[s]==d.length&&(this.by_indices[s]=0,u=1),this.last[r]=d[this.by_indices[s]]}else c&&this["increment_"+r](this.rule.interval);return o&&u&&c&&this["increment_"+a](1),u}increment_monthday(s){for(let n=0;n<s;n++){let r=Ye.daysInMonth(this.last.month,this.last.year);this.last.day++,this.last.day>r&&(this.last.day-=r,this.increment_month())}}increment_month(){if(this.last.day=1,this.has_by_data("BYMONTH"))this.by_indices.BYMONTH++,this.by_indices.BYMONTH==this.by_data.BYMONTH.length&&(this.by_indices.BYMONTH=0,this.increment_year(1)),this.last.month=this.by_data.BYMONTH[this.by_indices.BYMONTH];else{this.rule.freq=="MONTHLY"?this.last.month+=this.rule.interval:this.last.month++,this.last.month--;let s=hn(this.last.month/12);this.last.month%=12,this.last.month++,s!=0&&this.increment_year(s)}this.has_by_data("BYMONTHDAY")&&(this.by_data.BYMONTHDAY=this.normalizeByMonthDayRules(this.last.year,this.last.month,this.rule.parts.BYMONTHDAY))}increment_year(s){this.last.day=1,this.last.year+=s}increment_generic(s,n,r,a){this.last[n]+=s;let i=hn(this.last[n]/r);this.last[n]%=r,i!=0&&this["increment_"+a](i)}has_by_data(s){return s in this.rule.parts}expand_year_days(s){let n=new Ye;this.days=[];let r={},a=["BYDAY","BYWEEKNO","BYMONTHDAY","BYMONTH","BYYEARDAY"];for(let c of a)c in this.rule.parts&&(r[c]=this.rule.parts[c]);if("BYMONTH"in r&&"BYWEEKNO"in r){let c=1,u={};n.year=s,n.isDate=!0;for(let d=0;d<this.by_data.BYMONTH.length;d++){let h=this.by_data.BYMONTH[d];n.month=h,n.day=1;let p=n.weekNumber(this.rule.wkst);n.day=Ye.daysInMonth(h,s);let g=n.weekNumber(this.rule.wkst);for(d=p;d<g;d++)u[d]=1}for(let d=0;d<this.by_data.BYWEEKNO.length&&c;d++)this.by_data.BYWEEKNO[d]<52?c&=u[d]:c=0;c?delete r.BYMONTH:delete r.BYWEEKNO}let i=Object.keys(r).length;if(i==0){let c=this.dtstart.clone();c.year=this.last.year,this.days.push(c.dayOfYear())}else if(i==1&&"BYMONTH"in r)for(let c of this.by_data.BYMONTH){let u=this.dtstart.clone();u.year=s,u.month=c,u.isDate=!0,this.days.push(u.dayOfYear())}else if(i==1&&"BYMONTHDAY"in r)for(let c of this.by_data.BYMONTHDAY){let u=this.dtstart.clone();if(c<0){let d=Ye.daysInMonth(u.month,s);c=c+d+1}u.day=c,u.year=s,u.isDate=!0,this.days.push(u.dayOfYear())}else if(i==2&&"BYMONTHDAY"in r&&"BYMONTH"in r)for(let c of this.by_data.BYMONTH){let u=Ye.daysInMonth(c,s);for(let d of this.by_data.BYMONTHDAY)d<0&&(d=d+u+1),n.day=d,n.month=c,n.year=s,n.isDate=!0,this.days.push(n.dayOfYear())}else if(!(i==1&&"BYWEEKNO"in r)){if(!(i==2&&"BYWEEKNO"in r&&"BYMONTHDAY"in r)){if(i==1&&"BYDAY"in r)this.days=this.days.concat(this.expand_by_day(s));else if(i==2&&"BYDAY"in r&&"BYMONTH"in r){for(let c of this.by_data.BYMONTH){let u=Ye.daysInMonth(c,s);n.year=s,n.month=c,n.day=1,n.isDate=!0;let d=n.dayOfWeek(),h=n.dayOfYear()-1;n.day=u;let p=n.dayOfWeek();if(this.has_by_data("BYSETPOS")){let g=[];for(let x=1;x<=u;x++)n.day=x,this.is_day_in_byday(n)&&g.push(x);for(let x=0;x<g.length;x++)(this.check_set_position(x+1)||this.check_set_position(x-g.length))&&this.days.push(h+g[x])}else for(let g of this.by_data.BYDAY){let x=this.ruleDayOfWeek(g),y=x[0],b=x[1],v,w=(b+7-d)%7+1,N=u-(p+7-b)%7;if(y==0)for(let S=w;S<=u;S+=7)this.days.push(h+S);else y>0?(v=w+(y-1)*7,v<=u&&this.days.push(h+v)):(v=N+(y+1)*7,v>0&&this.days.push(h+v))}}this.days.sort(function(c,u){return c-u})}else if(i==2&&"BYDAY"in r&&"BYMONTHDAY"in r){let c=this.expand_by_day(s);for(let u of c){let d=Ye.fromDayOfYear(u,s);this.by_data.BYMONTHDAY.indexOf(d.day)>=0&&this.days.push(u)}}else if(i==3&&"BYDAY"in r&&"BYMONTHDAY"in r&&"BYMONTH"in r){let c=this.expand_by_day(s);for(let u of c){let d=Ye.fromDayOfYear(u,s);this.by_data.BYMONTH.indexOf(d.month)>=0&&this.by_data.BYMONTHDAY.indexOf(d.day)>=0&&this.days.push(u)}}else if(i==2&&"BYDAY"in r&&"BYWEEKNO"in r){let c=this.expand_by_day(s);for(let u of c){let h=Ye.fromDayOfYear(u,s).weekNumber(this.rule.wkst);this.by_data.BYWEEKNO.indexOf(h)&&this.days.push(u)}}else if(!(i==3&&"BYDAY"in r&&"BYWEEKNO"in r&&"BYMONTHDAY"in r))if(i==1&&"BYYEARDAY"in r)this.days=this.days.concat(this.by_data.BYYEARDAY);else if(i==2&&"BYYEARDAY"in r&&"BYDAY"in r){let c=Ye.isLeapYear(s)?366:365,u=new Set(this.expand_by_day(s));for(let d of this.by_data.BYYEARDAY)d<0&&(d+=c+1),u.has(d)&&this.days.push(d)}else this.days=[]}}let o=Ye.isLeapYear(s)?366:365;return this.days.sort((c,u)=>(c<0&&(c+=o+1),u<0&&(u+=o+1),c-u)),0}expand_by_day(s){let n=[],r=this.last.clone();r.year=s,r.month=1,r.day=1,r.isDate=!0;let a=r.dayOfWeek();r.month=12,r.day=31,r.isDate=!0;let i=r.dayOfWeek(),o=r.dayOfYear();for(let c of this.by_data.BYDAY){let u=this.ruleDayOfWeek(c),d=u[0],h=u[1];if(d==0){let p=(h+7-a)%7+1;for(let g=p;g<=o;g+=7)n.push(g)}else if(d>0){let p;h>=a?p=h-a+1:p=h-a+8,n.push(p+(d-1)*7)}else{let p;d=-d,h<=i?p=o-i+h:p=o-i+h-7,n.push(p-(d-1)*7)}}return n}is_day_in_byday(s){if(this.by_data.BYDAY)for(let n of this.by_data.BYDAY){let r=this.ruleDayOfWeek(n),a=r[0],i=r[1],o=s.dayOfWeek();if(a==0&&i==o||s.nthWeekDay(i,a)==s.day)return 1}return 0}check_set_position(s){return this.has_by_data("BYSETPOS")?this.by_data.BYSETPOS.indexOf(s)!==-1:!1}sort_byday_rules(s){for(let n=0;n<s.length;n++)for(let r=0;r<n;r++){let a=this.ruleDayOfWeek(s[r],this.rule.wkst)[1],i=this.ruleDayOfWeek(s[n],this.rule.wkst)[1];if(a>i){let o=s[n];s[n]=s[r],s[r]=o}}}check_contract_restriction(s,n){let r=sr._indexMap[s],a=sr._expandMap[this.rule.freq][r],i=!1;if(s in this.by_data&&a==sr.CONTRACT){let o=this.by_data[s];for(let c of o)if(c==n){i=!0;break}}else i=!0;return i}check_contracting_rules(){let s=this.last.dayOfWeek(),n=this.last.weekNumber(this.rule.wkst),r=this.last.dayOfYear();return this.check_contract_restriction("BYSECOND",this.last.second)&&this.check_contract_restriction("BYMINUTE",this.last.minute)&&this.check_contract_restriction("BYHOUR",this.last.hour)&&this.check_contract_restriction("BYDAY",Rn.numericDayToIcalDay(s))&&this.check_contract_restriction("BYWEEKNO",n)&&this.check_contract_restriction("BYMONTHDAY",this.last.day)&&this.check_contract_restriction("BYMONTH",this.last.month)&&this.check_contract_restriction("BYYEARDAY",r)}setup_defaults(s,n,r){let a=sr._indexMap[s];return sr._expandMap[this.rule.freq][a]!=sr.CONTRACT&&(s in this.by_data||(this.by_data[s]=[r]),this.rule.freq!=n)?this.by_data[s][0]:r}toJSON(){let s=Object.create(null);return s.initialized=this.initialized,s.rule=this.rule.toJSON(),s.dtstart=this.dtstart.toJSON(),s.by_data=this.by_data,s.days=this.days,s.last=this.last.toJSON(),s.by_indices=this.by_indices,s.occurrence_number=this.occurrence_number,s}};he(sr,"_indexMap",{BYSECOND:0,BYMINUTE:1,BYHOUR:2,BYDAY:3,BYMONTHDAY:4,BYYEARDAY:5,BYWEEKNO:6,BYMONTH:7,BYSETPOS:8}),he(sr,"_expandMap",{SECONDLY:[1,1,1,1,1,1,1,1],MINUTELY:[2,1,1,1,1,1,1,1],HOURLY:[2,2,1,1,1,1,1,1],DAILY:[2,2,2,1,1,1,1,1],WEEKLY:[2,2,2,2,3,3,1,1],MONTHLY:[2,2,2,2,2,3,3,1],YEARLY:[2,2,2,2,2,2,2,2]}),he(sr,"UNKNOWN",0),he(sr,"CONTRACT",1),he(sr,"EXPAND",2),he(sr,"ILLEGAL",3);let ld=sr;class $u extends Error{constructor(){super("Recurrence rule has no valid occurrences")}}const CH=/^(SU|MO|TU|WE|TH|FR|SA)$/,EH=/^([+-])?(5[0-3]|[1-4][0-9]|[1-9])?(SU|MO|TU|WE|TH|FR|SA)$/,M1={SU:Ye.SUNDAY,MO:Ye.MONDAY,TU:Ye.TUESDAY,WE:Ye.WEDNESDAY,TH:Ye.THURSDAY,FR:Ye.FRIDAY,SA:Ye.SATURDAY},TH=Object.fromEntries(Object.entries(M1).map(t=>t.reverse())),Rb=["SECONDLY","MINUTELY","HOURLY","DAILY","WEEKLY","MONTHLY","YEARLY"];class Rn{constructor(s){he(this,"parts",null);he(this,"interval",1);he(this,"wkst",Ye.MONDAY);he(this,"until",null);he(this,"count",null);he(this,"freq",null);he(this,"icalclass","icalrecur");he(this,"icaltype","recur");this.wrappedJSObject=this,this.parts={},s&&typeof s=="object"&&this.fromData(s)}static fromString(s){let n=this._stringToData(s,!1);return new Rn(n)}static fromData(s){return new Rn(s)}static _stringToData(s,n){let r=Object.create(null),a=s.split(";"),i=a.length;for(let o=0;o<i;o++){let c=a[o].split("="),u=c[0].toUpperCase(),d=c[0].toLowerCase(),h=n?d:u,p=c[1];if(u in Zf){let g=p.split(","),x=new Set;for(let y of g)x.add(Zf[u](y));g=[...x],r[h]=g.length==1?g[0]:g}else u in Xf?Xf[u](p,r,n):r[d]=p}return r}static icalDayToNumericDay(s,n){let r=n||Ye.SUNDAY;return(M1[s]-r+7)%7+1}static numericDayToIcalDay(s,n){let r=n||Ye.SUNDAY,a=s+r-Ye.SUNDAY;return a>7&&(a-=7),TH[a]}iterator(s){return new ld({rule:this,dtstart:s})}clone(){return new Rn(this.toJSON())}isFinite(){return!!(this.count||this.until)}isByCount(){return!!(this.count&&!this.until)}addComponent(s,n){let r=s.toUpperCase();r in this.parts?this.parts[r].push(n):this.parts[r]=[n]}setComponent(s,n){this.parts[s.toUpperCase()]=n.slice()}getComponent(s){let n=s.toUpperCase();return n in this.parts?this.parts[n].slice():[]}getNextOccurrence(s,n){let r=this.iterator(s),a;do a=r.next();while(a&&a.compare(n)<=0);return a&&n.zone&&(a.zone=n.zone),a}fromData(s){for(let n in s){let r=n.toUpperCase();r in Zf?Array.isArray(s[n])?this.parts[r]=s[n]:this.parts[r]=[s[n]]:this[n]=s[n]}this.interval&&typeof this.interval!="number"&&Xf.INTERVAL(this.interval,this),this.wkst&&typeof this.wkst!="number"&&(this.wkst=Rn.icalDayToNumericDay(this.wkst)),this.until&&!(this.until instanceof Ye)&&(this.until=Ye.fromString(this.until))}toJSON(){let s=Object.create(null);s.freq=this.freq,this.count&&(s.count=this.count),this.interval>1&&(s.interval=this.interval);for(let[n,r]of Object.entries(this.parts))Array.isArray(r)&&r.length==1?s[n.toLowerCase()]=r[0]:s[n.toLowerCase()]=Yo(r);return this.until&&(s.until=this.until.toString()),"wkst"in this&&this.wkst!==Ye.DEFAULT_WEEK_START&&(s.wkst=Rn.numericDayToIcalDay(this.wkst)),s}toString(){let s="FREQ="+this.freq;this.count&&(s+=";COUNT="+this.count),this.interval>1&&(s+=";INTERVAL="+this.interval);for(let[n,r]of Object.entries(this.parts))s+=";"+n+"="+r;return this.until&&(s+=";UNTIL="+this.until.toICALString()),"wkst"in this&&this.wkst!==Ye.DEFAULT_WEEK_START&&(s+=";WKST="+Rn.numericDayToIcalDay(this.wkst)),s}}function Oi(t,s,n,r){let a=r;if(r[0]==="+"&&(a=r.slice(1)),a=An(a),s!==void 0&&r<s)throw new Error(t+': invalid value "'+r+'" must be > '+s);if(n!==void 0&&r>n)throw new Error(t+': invalid value "'+r+'" must be < '+s);return a}const Xf={FREQ:function(t,s,n){if(Rb.indexOf(t)!==-1)s.freq=t;else throw new Error('invalid frequency "'+t+'" expected: "'+Rb.join(", ")+'"')},COUNT:function(t,s,n){s.count=An(t)},INTERVAL:function(t,s,n){s.interval=An(t),s.interval<1&&(s.interval=1)},UNTIL:function(t,s,n){t.length>10?s.until=$s.icalendar.value["date-time"].fromICAL(t):s.until=$s.icalendar.value.date.fromICAL(t),n||(s.until=Ye.fromString(s.until))},WKST:function(t,s,n){if(CH.test(t))s.wkst=Rn.icalDayToNumericDay(t);else throw new Error('invalid WKST value "'+t+'"')}},Zf={BYSECOND:Oi.bind(void 0,"BYSECOND",0,60),BYMINUTE:Oi.bind(void 0,"BYMINUTE",0,59),BYHOUR:Oi.bind(void 0,"BYHOUR",0,23),BYDAY:function(t){if(EH.test(t))return t;throw new Error('invalid BYDAY value "'+t+'"')},BYMONTHDAY:Oi.bind(void 0,"BYMONTHDAY",-31,31),BYYEARDAY:Oi.bind(void 0,"BYYEARDAY",-366,366),BYWEEKNO:Oi.bind(void 0,"BYWEEKNO",-53,53),BYMONTH:Oi.bind(void 0,"BYMONTH",1,12),BYSETPOS:Oi.bind(void 0,"BYSETPOS",-366,366)},DH=/\\\\|\\;|\\,|\\[Nn]/g,kH=/\\|;|,|\n/g,Ob=/\\\\|\\,|\\[Nn]/g,Pb=/\\|,|\n/g;function Vp(t,s){return{matches:/.*/,fromICAL:function(r,a){return _H(r,t,a)},toICAL:function(r,a){let i=s;return a&&(i=new RegExp(i.source+"|"+a,i.flags)),r.replace(i,function(o){switch(o){case"\\":return"\\\\";case";":return"\\;";case",":return"\\,";case`
`:return"\\n";default:return o}})}}}const Vt={defaultType:"text"},cd={defaultType:"text",multiValue:","},wm={defaultType:"text",structuredValue:";"},zu={defaultType:"integer"},Fu={defaultType:"date-time",allowedTypes:["date-time","date"]},Bu={defaultType:"date-time"},tr={defaultType:"uri"},Mb={defaultType:"utc-offset"},Ib={defaultType:"recur"},Lb={defaultType:"date-and-or-time",allowedTypes:["date-time","date","text"]};function AH(t){switch(t){case"\\\\":return"\\";case"\\;":return";";case"\\,":return",";case"\\n":case"\\N":return`
`;default:return t}}function _H(t,s,n){return t.indexOf("\\")===-1?t:(n&&(s=new RegExp(s.source+"|\\\\"+n,s.flags)),t.replace(s,AH))}let gg={categories:cd,url:tr,version:Vt,uid:Vt},vg={boolean:{values:["TRUE","FALSE"],fromICAL:function(t){switch(t){case"TRUE":return!0;case"FALSE":return!1;default:return!1}},toICAL:function(t){return t?"TRUE":"FALSE"}},float:{matches:/^[+-]?\d+\.\d+$/,fromICAL:function(t){let s=parseFloat(t);return od(s)?0:s},toICAL:function(t){return String(t)}},integer:{fromICAL:function(t){let s=parseInt(t);return od(s)?0:s},toICAL:function(t){return String(t)}},"utc-offset":{toICAL:function(t){return t.length<7?t.slice(0,3)+t.slice(4,6):t.slice(0,3)+t.slice(4,6)+t.slice(7,9)},fromICAL:function(t){return t.length<6?t.slice(0,3)+":"+t.slice(3,5):t.slice(0,3)+":"+t.slice(3,5)+":"+t.slice(5,7)},decorate:function(t){return na.fromString(t)},undecorate:function(t){return t.toString()}}},RH={cutype:{values:["INDIVIDUAL","GROUP","RESOURCE","ROOM","UNKNOWN"],allowXName:!0,allowIanaToken:!0},"delegated-from":{valueType:"cal-address",multiValue:",",multiValueSeparateDQuote:!0},"delegated-to":{valueType:"cal-address",multiValue:",",multiValueSeparateDQuote:!0},encoding:{values:["8BIT","BASE64"]},fbtype:{values:["FREE","BUSY","BUSY-UNAVAILABLE","BUSY-TENTATIVE"],allowXName:!0,allowIanaToken:!0},member:{valueType:"cal-address",multiValue:",",multiValueSeparateDQuote:!0},partstat:{values:["NEEDS-ACTION","ACCEPTED","DECLINED","TENTATIVE","DELEGATED","COMPLETED","IN-PROCESS"],allowXName:!0,allowIanaToken:!0},range:{values:["THISANDFUTURE"]},related:{values:["START","END"]},reltype:{values:["PARENT","CHILD","SIBLING"],allowXName:!0,allowIanaToken:!0},role:{values:["REQ-PARTICIPANT","CHAIR","OPT-PARTICIPANT","NON-PARTICIPANT"],allowXName:!0,allowIanaToken:!0},rsvp:{values:["TRUE","FALSE"]},"sent-by":{valueType:"cal-address"},tzid:{matches:/^\//},value:{values:["binary","boolean","cal-address","date","date-time","duration","float","integer","period","recur","text","time","uri","utc-offset"],allowXName:!0,allowIanaToken:!0}};const Yn=Jo(vg,{text:Vp(DH,kH),uri:{},binary:{decorate:function(t){return ah.fromString(t)},undecorate:function(t){return t.toString()}},"cal-address":{},date:{decorate:function(t,s){return Ye.fromDateString(t,s)},undecorate:function(t){return t.toString()},fromICAL:function(t){return t.slice(0,4)+"-"+t.slice(4,6)+"-"+t.slice(6,8)},toICAL:function(t){let s=t.length;return s==10?t.slice(0,4)+t.slice(5,7)+t.slice(8,10):s>=19?Yn["date-time"].toICAL(t):t}},"date-time":{fromICAL:function(t){{let s=t.slice(0,4)+"-"+t.slice(4,6)+"-"+t.slice(6,8)+"T"+t.slice(9,11)+":"+t.slice(11,13)+":"+t.slice(13,15);return t[15]&&t[15]==="Z"&&(s+="Z"),s}},toICAL:function(t){if(t.length>=19){let n=t.slice(0,4)+t.slice(5,7)+t.slice(8,13)+t.slice(14,16)+t.slice(17,19);return t[19]&&t[19]==="Z"&&(n+="Z"),n}else return t},decorate:function(t,s){return Ye.fromDateTimeString(t,s)},undecorate:function(t){return t.toString()}},duration:{decorate:function(t){return Mn.fromString(t)},undecorate:function(t){return t.toString()}},period:{fromICAL:function(t){let s=t.split("/");return s[0]=Yn["date-time"].fromICAL(s[0]),Mn.isValueString(s[1])||(s[1]=Yn["date-time"].fromICAL(s[1])),s},toICAL:function(t){return t=t.slice(),t[0]=Yn["date-time"].toICAL(t[0]),Mn.isValueString(t[1])||(t[1]=Yn["date-time"].toICAL(t[1])),t.join("/")},decorate:function(t,s){return oi.fromJSON(t,s,!1)},undecorate:function(t){return t.toJSON()}},recur:{fromICAL:function(t){return Rn._stringToData(t,!0)},toICAL:function(t){let s="";for(let[n,r]of Object.entries(t))n=="until"?r.length>10?r=Yn["date-time"].toICAL(r):r=Yn.date.toICAL(r):n=="wkst"?typeof r=="number"&&(r=Rn.numericDayToIcalDay(r)):Array.isArray(r)&&(r=r.join(",")),s+=n.toUpperCase()+"="+r+";";return s.slice(0,Math.max(0,s.length-1))},decorate:function(s){return Rn.fromData(s)},undecorate:function(t){return t.toJSON()}},time:{fromICAL:function(t){if(t.length<6)return t;let s=t.slice(0,2)+":"+t.slice(2,4)+":"+t.slice(4,6);return t[6]==="Z"&&(s+="Z"),s},toICAL:function(t){if(t.length<8)return t;let s=t.slice(0,2)+t.slice(3,5)+t.slice(6,8);return t[8]==="Z"&&(s+="Z"),s}}});let OH=Jo(gg,{action:Vt,attach:{defaultType:"uri"},attendee:{defaultType:"cal-address"},calscale:Vt,class:Vt,comment:Vt,completed:Bu,contact:Vt,created:Bu,description:Vt,dtend:Fu,dtstamp:Bu,dtstart:Fu,due:Fu,duration:{defaultType:"duration"},exdate:{defaultType:"date-time",allowedTypes:["date-time","date"],multiValue:","},exrule:Ib,freebusy:{defaultType:"period",multiValue:","},geo:{defaultType:"float",structuredValue:";"},"last-modified":Bu,location:Vt,method:Vt,organizer:{defaultType:"cal-address"},"percent-complete":zu,priority:zu,prodid:Vt,"related-to":Vt,repeat:zu,rdate:{defaultType:"date-time",allowedTypes:["date-time","date","period"],multiValue:",",detectType:function(t){return t.indexOf("/")!==-1?"period":t.indexOf("T")===-1?"date":"date-time"}},"recurrence-id":Fu,resources:cd,"request-status":wm,rrule:Ib,sequence:zu,status:Vt,summary:Vt,transp:Vt,trigger:{defaultType:"duration",allowedTypes:["duration","date-time"]},tzoffsetfrom:Mb,tzoffsetto:Mb,tzurl:tr,tzid:Vt,tzname:Vt});const gr=Jo(vg,{text:Vp(Ob,Pb),uri:Vp(Ob,Pb),date:{decorate:function(t){return Zi.fromDateAndOrTimeString(t,"date")},undecorate:function(t){return t.toString()},fromICAL:function(t){return t.length==8?Yn.date.fromICAL(t):t[0]=="-"&&t.length==6?t.slice(0,4)+"-"+t.slice(4):t},toICAL:function(t){return t.length==10?Yn.date.toICAL(t):t[0]=="-"&&t.length==7?t.slice(0,4)+t.slice(5):t}},time:{decorate:function(t){return Zi.fromDateAndOrTimeString("T"+t,"time")},undecorate:function(t){return t.toString()},fromICAL:function(t){let s=gr.time._splitZone(t,!0),n=s[0],r=s[1];return r.length==6?r=r.slice(0,2)+":"+r.slice(2,4)+":"+r.slice(4,6):r.length==4&&r[0]!="-"?r=r.slice(0,2)+":"+r.slice(2,4):r.length==5&&(r=r.slice(0,3)+":"+r.slice(3,5)),n.length==5&&(n[0]=="-"||n[0]=="+")&&(n=n.slice(0,3)+":"+n.slice(3)),r+n},toICAL:function(t){let s=gr.time._splitZone(t),n=s[0],r=s[1];return r.length==8?r=r.slice(0,2)+r.slice(3,5)+r.slice(6,8):r.length==5&&r[0]!="-"?r=r.slice(0,2)+r.slice(3,5):r.length==6&&(r=r.slice(0,3)+r.slice(4,6)),n.length==6&&(n[0]=="-"||n[0]=="+")&&(n=n.slice(0,3)+n.slice(4)),r+n},_splitZone:function(t,s){let n=t.length-1,r=t.length-(s?5:6),a=t[r],i,o;return t[n]=="Z"?(i=t[n],o=t.slice(0,Math.max(0,n))):t.length>6&&(a=="-"||a=="+")?(i=t.slice(r),o=t.slice(0,Math.max(0,r))):(i="",o=t),[i,o]}},"date-time":{decorate:function(t){return Zi.fromDateAndOrTimeString(t,"date-time")},undecorate:function(t){return t.toString()},fromICAL:function(t){return gr["date-and-or-time"].fromICAL(t)},toICAL:function(t){return gr["date-and-or-time"].toICAL(t)}},"date-and-or-time":{decorate:function(t){return Zi.fromDateAndOrTimeString(t,"date-and-or-time")},undecorate:function(t){return t.toString()},fromICAL:function(t){let s=t.split("T");return(s[0]?gr.date.fromICAL(s[0]):"")+(s[1]?"T"+gr.time.fromICAL(s[1]):"")},toICAL:function(t){let s=t.split("T");return gr.date.toICAL(s[0])+(s[1]?"T"+gr.time.toICAL(s[1]):"")}},timestamp:Yn["date-time"],"language-tag":{matches:/^[a-zA-Z0-9-]+$/},"phone-number":{fromICAL:function(t){return Array.from(t).filter(function(s){return s==="\\"?void 0:s}).join("")},toICAL:function(t){return Array.from(t).map(function(s){return s===","||s===";"?"\\"+s:s}).join("")}}});let PH={type:{valueType:"text",multiValue:","},value:{values:["text","uri","date","time","date-time","date-and-or-time","timestamp","boolean","integer","float","utc-offset","language-tag"],allowXName:!0,allowIanaToken:!0}},MH=Jo(gg,{adr:{defaultType:"text",structuredValue:";",multiValue:","},anniversary:Lb,bday:Lb,caladruri:tr,caluri:tr,clientpidmap:wm,email:Vt,fburl:tr,fn:Vt,gender:wm,geo:tr,impp:tr,key:tr,kind:Vt,lang:{defaultType:"language-tag"},logo:tr,member:tr,n:{defaultType:"text",structuredValue:";",multiValue:","},nickname:cd,note:Vt,org:{defaultType:"text",structuredValue:";"},photo:tr,related:tr,rev:{defaultType:"timestamp"},role:Vt,sound:tr,source:tr,tel:{defaultType:"uri",allowedTypes:["uri","text"]},title:Vt,tz:{defaultType:"text",allowedTypes:["text","utc-offset","uri"]},xml:Vt}),IH=Jo(vg,{binary:Yn.binary,date:gr.date,"date-time":gr["date-time"],"phone-number":gr["phone-number"],uri:Yn.uri,text:gr.text,time:Yn.time,vcard:Yn.text,"utc-offset":{toICAL:function(t){return t.slice(0,7)},fromICAL:function(t){return t.slice(0,7)},decorate:function(t){return na.fromString(t)},undecorate:function(t){return t.toString()}}}),LH={type:{valueType:"text",multiValue:","},value:{values:["text","uri","date","date-time","phone-number","time","boolean","integer","float","utc-offset","vcard","binary"],allowXName:!0,allowIanaToken:!0}},$H=Jo(gg,{fn:Vt,n:{defaultType:"text",structuredValue:";",multiValue:","},nickname:cd,photo:{defaultType:"binary",allowedTypes:["binary","uri"]},bday:{defaultType:"date-time",allowedTypes:["date-time","date"],detectType:function(t){return t.indexOf("T")===-1?"date":"date-time"}},adr:{defaultType:"text",structuredValue:";",multiValue:","},label:Vt,tel:{defaultType:"phone-number"},email:Vt,mailer:Vt,tz:{defaultType:"utc-offset",allowedTypes:["utc-offset","text"]},geo:{defaultType:"float",structuredValue:";"},title:Vt,role:Vt,logo:{defaultType:"binary",allowedTypes:["binary","uri"]},agent:{defaultType:"vcard",allowedTypes:["vcard","text","uri"]},org:wm,note:cd,prodid:Vt,rev:{defaultType:"date-time",allowedTypes:["date-time","date"],detectType:function(t){return t.indexOf("T")===-1?"date":"date-time"}},"sort-string":Vt,sound:{defaultType:"binary",allowedTypes:["binary","uri"]},class:Vt,key:{defaultType:"binary",allowedTypes:["binary","text"]}}),si={name:"ical",value:Yn,param:RH,property:OH,propertyGroups:!1},$b={name:"vcard4",value:gr,param:PH,property:MH,propertyGroups:!0},zb={name:"vcard3",value:IH,param:LH,property:$H,propertyGroups:!0};const $s={strict:!0,defaultSet:si,defaultType:"unknown",components:{vcard:$b,vcard3:zb,vevent:si,vtodo:si,vjournal:si,valarm:si,vtimezone:si,daylight:si,standard:si},icalendar:si,vcard:$b,vcard3:zb,getDesignSet:function(t){return t&&t in $s.components?$s.components[t]:$s.defaultSet}},Ku=`\r
`,Fb="unknown",zH={'"':"^'","\n":"^n","^":"^^"};function _s(t){typeof t[0]=="string"&&(t=[t]);let s=0,n=t.length,r="";for(;s<n;s++)r+=_s.component(t[s])+Ku;return r}_s.component=function(t,s){let n=t[0].toUpperCase(),r="BEGIN:"+n+Ku,a=t[1],i=0,o=a.length,c=t[0];for(c==="vcard"&&t[1].length>0&&!(t[1][0][0]==="version"&&t[1][0][3]==="4.0")&&(c="vcard3"),s=s||$s.getDesignSet(c);i<o;i++)r+=_s.property(a[i],s)+Ku;let u=t[2]||[],d=0,h=u.length;for(;d<h;d++)r+=_s.component(u[d],s)+Ku;return r+="END:"+n,r};_s.property=function(t,s,n){let r=t[0].toUpperCase(),a=t[0],i=t[1];s||(s=$s.defaultSet);let o=i.group,c;s.propertyGroups&&o?c=o.toUpperCase()+"."+r:c=r;for(let[x,y]of Object.entries(i)){if(s.propertyGroups&&x=="group")continue;let b=s.param[x],v=b&&b.multiValue;v&&Array.isArray(y)?(y=y.map(function(w){return w=_s._rfc6868Unescape(w),w=_s.paramPropertyValue(w,b.multiValueSeparateDQuote),w}),y=_s.multiValue(y,v,"unknown",null,s)):(y=_s._rfc6868Unescape(y),y=_s.paramPropertyValue(y)),c+=";"+x.toUpperCase()+"="+y}if(t.length===3)return c+":";let u=t[2],d,h=!1,p=!1,g=!1;return a in s.property?(d=s.property[a],"multiValue"in d&&(h=d.multiValue),"structuredValue"in d&&Array.isArray(t[3])&&(p=d.structuredValue),"defaultType"in d?u===d.defaultType&&(g=!0):u===Fb&&(g=!0)):u===Fb&&(g=!0),g||(c+=";VALUE="+u.toUpperCase()),c+=":",h&&p?c+=_s.multiValue(t[3],p,u,h,s,p):h?c+=_s.multiValue(t.slice(3),h,u,null,s,!1):p?c+=_s.multiValue(t[3],p,u,null,s,p):c+=_s.value(t[3],u,s,!1),n?c:P1(c)};_s.paramPropertyValue=function(t,s){return!s&&t.indexOf(",")===-1&&t.indexOf(":")===-1&&t.indexOf(";")===-1?t:'"'+t+'"'};_s.multiValue=function(t,s,n,r,a,i){let o="",c=t.length,u=0;for(;u<c;u++)r&&Array.isArray(t[u])?o+=_s.multiValue(t[u],r,n,null,a,i):o+=_s.value(t[u],n,a,i),u!==c-1&&(o+=s);return o};_s.value=function(t,s,n,r){return s in n.value&&"toICAL"in n.value[s]?n.value[s].toICAL(t,r):t};_s._rfc6868Unescape=function(t){return t.replace(/[\n^"]/g,function(s){return zH[s]})};const Bb=0,Hu=1,Uu=2,Pi=3;class $o{static fromString(s,n){return new $o(Xt.property(s,n))}constructor(s,n){this._parent=n||null,typeof s=="string"?(this.jCal=[s,{},$s.defaultType],this.jCal[Uu]=this.getDefaultType()):this.jCal=s,this._updateType()}get type(){return this.jCal[Uu]}get name(){return this.jCal[Bb]}get parent(){return this._parent}set parent(s){let n=!this._parent||s&&s._designSet!=this._parent._designSet;this._parent=s,this.type==$s.defaultType&&n&&(this.jCal[Uu]=this.getDefaultType(),this._updateType())}get _designSet(){return this.parent?this.parent._designSet:$s.defaultSet}_updateType(){let s=this._designSet;this.type in s.value&&("decorate"in s.value[this.type]?this.isDecorated=!0:this.isDecorated=!1,this.name in s.property&&(this.isMultiValue="multiValue"in s.property[this.name],this.isStructuredValue="structuredValue"in s.property[this.name]))}_hydrateValue(s){return this._values&&this._values[s]?this._values[s]:this.jCal.length<=Pi+s?null:this.isDecorated?(this._values||(this._values=[]),this._values[s]=this._decorate(this.jCal[Pi+s])):this.jCal[Pi+s]}_decorate(s){return this._designSet.value[this.type].decorate(s,this)}_undecorate(s){return this._designSet.value[this.type].undecorate(s,this)}_setDecoratedValue(s,n){this._values||(this._values=[]),typeof s=="object"&&"icaltype"in s?(this.jCal[Pi+n]=this._undecorate(s),this._values[n]=s):(this.jCal[Pi+n]=s,this._values[n]=this._decorate(s))}getParameter(s){if(s in this.jCal[Hu])return this.jCal[Hu][s]}getFirstParameter(s){let n=this.getParameter(s);return Array.isArray(n)?n[0]:n}setParameter(s,n){let r=s.toLowerCase();typeof n=="string"&&r in this._designSet.param&&"multiValue"in this._designSet.param[r]&&(n=[n]),this.jCal[Hu][s]=n}removeParameter(s){delete this.jCal[Hu][s]}getDefaultType(){let s=this.jCal[Bb],n=this._designSet;if(s in n.property){let r=n.property[s];if("defaultType"in r)return r.defaultType}return $s.defaultType}resetType(s){this.removeAllValues(),this.jCal[Uu]=s,this._updateType()}getFirstValue(){return this._hydrateValue(0)}getValues(){let s=this.jCal.length-Pi;if(s<1)return[];let n=0,r=[];for(;n<s;n++)r[n]=this._hydrateValue(n);return r}removeAllValues(){this._values&&(this._values.length=0),this.jCal.length=3}setValues(s){if(!this.isMultiValue)throw new Error(this.name+`: does not not support mulitValue.
override isMultiValue`);let n=s.length,r=0;if(this.removeAllValues(),n>0&&typeof s[0]=="object"&&"icaltype"in s[0]&&this.resetType(s[0].icaltype),this.isDecorated)for(;r<n;r++)this._setDecoratedValue(s[r],r);else for(;r<n;r++)this.jCal[Pi+r]=s[r]}setValue(s){this.removeAllValues(),typeof s=="object"&&"icaltype"in s&&this.resetType(s.icaltype),this.isDecorated?this._setDecoratedValue(s,0):this.jCal[Pi]=s}toJSON(){return this.jCal}toICALString(){return _s.property(this.jCal,this._designSet,!0)}}const Mi=0,Ea=1,Ii=2,FH=0,BH=3;class yr{constructor(s,n){he(this,"_hydratedPropertyCount",0);he(this,"_hydratedComponentCount",0);he(this,"_timezoneCache",null);he(this,"_components",null);he(this,"_properties",null);typeof s=="string"&&(s=[s,[],[]]),this.jCal=s,this.parent=n||null,!this.parent&&this.name==="vcalendar"&&(this._timezoneCache=new Map)}static fromString(s){return new yr(Xt.component(s))}get name(){return this.jCal[Mi]}get _designSet(){var n;let s=this.parent&&this.parent._designSet;if(!s&&this.name=="vcard"){let r=(n=this.jCal[Ea])==null?void 0:n[0];if(r&&r[FH]=="version"&&r[BH]=="3.0")return $s.getDesignSet("vcard3")}return s||$s.getDesignSet(this.name)}_hydrateComponent(s){if(this._components||(this._components=[],this._hydratedComponentCount=0),this._components[s])return this._components[s];let n=new yr(this.jCal[Ii][s],this);return this._hydratedComponentCount++,this._components[s]=n}_hydrateProperty(s){if(this._properties||(this._properties=[],this._hydratedPropertyCount=0),this._properties[s])return this._properties[s];let n=new $o(this.jCal[Ea][s],this);return this._hydratedPropertyCount++,this._properties[s]=n}getFirstSubcomponent(s){if(s){let n=0,r=this.jCal[Ii],a=r.length;for(;n<a;n++)if(r[n][Mi]===s)return this._hydrateComponent(n)}else if(this.jCal[Ii].length)return this._hydrateComponent(0);return null}getAllSubcomponents(s){let n=this.jCal[Ii].length,r=0;if(s){let a=this.jCal[Ii],i=[];for(;r<n;r++)s===a[r][Mi]&&i.push(this._hydrateComponent(r));return i}else{if(!this._components||this._hydratedComponentCount!==n)for(;r<n;r++)this._hydrateComponent(r);return this._components||[]}}hasProperty(s){let n=this.jCal[Ea],r=n.length,a=0;for(;a<r;a++)if(n[a][Mi]===s)return!0;return!1}getFirstProperty(s){if(s){let n=0,r=this.jCal[Ea],a=r.length;for(;n<a;n++)if(r[n][Mi]===s)return this._hydrateProperty(n)}else if(this.jCal[Ea].length)return this._hydrateProperty(0);return null}getFirstPropertyValue(s){let n=this.getFirstProperty(s);return n?n.getFirstValue():null}getAllProperties(s){let n=this.jCal[Ea].length,r=0;if(s){let a=this.jCal[Ea],i=[];for(;r<n;r++)s===a[r][Mi]&&i.push(this._hydrateProperty(r));return i}else{if(!this._properties||this._hydratedPropertyCount!==n)for(;r<n;r++)this._hydrateProperty(r);return this._properties||[]}}_removeObjectByIndex(s,n,r){if(n=n||[],n[r]){let a=n[r];"parent"in a&&(a.parent=null)}n.splice(r,1),this.jCal[s].splice(r,1)}_removeObject(s,n,r){let a=0,i=this.jCal[s],o=i.length,c=this[n];if(typeof r=="string"){for(;a<o;a++)if(i[a][Mi]===r)return this._removeObjectByIndex(s,c,a),!0}else if(c){for(;a<o;a++)if(c[a]&&c[a]===r)return this._removeObjectByIndex(s,c,a),!0}return!1}_removeAllObjects(s,n,r){let a=this[n],i=this.jCal[s],o=i.length-1;for(;o>=0;o--)(!r||i[o][Mi]===r)&&this._removeObjectByIndex(s,a,o)}addSubcomponent(s){this._components||(this._components=[],this._hydratedComponentCount=0),s.parent&&s.parent.removeSubcomponent(s);let n=this.jCal[Ii].push(s.jCal);return this._components[n-1]=s,this._hydratedComponentCount++,s.parent=this,s}removeSubcomponent(s){let n=this._removeObject(Ii,"_components",s);return n&&this._hydratedComponentCount--,n}removeAllSubcomponents(s){let n=this._removeAllObjects(Ii,"_components",s);return this._hydratedComponentCount=0,n}addProperty(s){if(!(s instanceof $o))throw new TypeError("must be instance of ICAL.Property");this._properties||(this._properties=[],this._hydratedPropertyCount=0),s.parent&&s.parent.removeProperty(s);let n=this.jCal[Ea].push(s.jCal);return this._properties[n-1]=s,this._hydratedPropertyCount++,s.parent=this,s}addPropertyWithValue(s,n){let r=new $o(s);return r.setValue(n),this.addProperty(r),r}updatePropertyWithValue(s,n){let r=this.getFirstProperty(s);return r?r.setValue(n):r=this.addPropertyWithValue(s,n),r}removeProperty(s){let n=this._removeObject(Ea,"_properties",s);return n&&this._hydratedPropertyCount--,n}removeAllProperties(s){let n=this._removeAllObjects(Ea,"_properties",s);return this._hydratedPropertyCount=0,n}toJSON(){return this.jCal}toString(){return _s.component(this.jCal,this._designSet)}getTimeZoneByID(s){if(this.parent)return this.parent.getTimeZoneByID(s);if(!this._timezoneCache)return null;if(this._timezoneCache.has(s))return this._timezoneCache.get(s);const n=this.getAllSubcomponents("vtimezone");for(const r of n)if(r.getFirstProperty("tzid").getFirstValue()===s){const a=new ss({component:r,tzid:s});return this._timezoneCache.set(s,a),a}return null}}class I1{constructor(s){he(this,"complete",!1);he(this,"ruleIterators",null);he(this,"ruleDates",null);he(this,"exDates",null);he(this,"ruleDateInc",0);he(this,"exDateInc",0);he(this,"exDate",null);he(this,"ruleDate",null);he(this,"dtstart",null);he(this,"last",null);this.ruleDates=[],this.exDates=[],this.fromData(s)}fromData(s){let n=li(s.dtstart,Ye);if(n)this.dtstart=n;else throw new Error(".dtstart (ICAL.Time) must be given");if(s.component)this._init(s.component);else{if(this.last=li(s.last,Ye)||n.clone(),!s.ruleIterators)throw new Error(".ruleIterators or .component must be given");this.ruleIterators=s.ruleIterators.map(function(r){return li(r,ld)}),this.ruleDateInc=s.ruleDateInc,this.exDateInc=s.exDateInc,s.ruleDates&&(this.ruleDates=s.ruleDates.map(r=>li(r,Ye)),this.ruleDate=this.ruleDates[this.ruleDateInc]),s.exDates&&(this.exDates=s.exDates.map(r=>li(r,Ye)),this.exDate=this.exDates[this.exDateInc]),typeof s.complete<"u"&&(this.complete=s.complete)}}_compare_special(s,n){return!s.isDate&&n.isDate?new Ye({year:s.year,month:s.month,day:s.day}).compare(n):s.compare(n)}next(){let s,n,r,a=500,i=0;for(;;){if(i++>a)throw new Error("max tries have occurred, rule may be impossible to fulfill.");if(n=this.ruleDate,s=this._nextRecurrenceIter(this.last),!n&&!s){this.complete=!0;break}if((!n||s&&n.compare(s.last)>0)&&(n=s.last.clone(),s.next()),this.ruleDate===n&&this._nextRuleDay(),this.last=n,this.exDate&&(r=this._compare_special(this.last,this.exDate),r>0&&this._nextExDay(),r===0)){this._nextExDay();continue}return this.last}}toJSON(){function s(r){return r.toJSON()}let n=Object.create(null);return n.ruleIterators=this.ruleIterators.map(s),this.ruleDates&&(n.ruleDates=this.ruleDates.map(s)),this.exDates&&(n.exDates=this.exDates.map(s)),n.ruleDateInc=this.ruleDateInc,n.exDateInc=this.exDateInc,n.last=this.last.toJSON(),n.dtstart=this.dtstart.toJSON(),n.complete=this.complete,n}_extractDates(s,n){let r=[],a=s.getAllProperties(n);for(let i=0,o=a.length;i<o;i++)for(let c of a[i].getValues()){let u=Lo(r,c,(d,h)=>d.compare(h));r.splice(u,0,c)}return r}_init(s){if(this.ruleIterators=[],this.last=this.dtstart.clone(),!s.hasProperty("rdate")&&!s.hasProperty("rrule")&&!s.hasProperty("recurrence-id")){this.ruleDate=this.last.clone(),this.complete=!0;return}if(s.hasProperty("rdate")&&(this.ruleDates=this._extractDates(s,"rdate"),this.ruleDates[0]&&this.ruleDates[0].compare(this.dtstart)<0?(this.ruleDateInc=0,this.last=this.ruleDates[0].clone()):this.ruleDateInc=Lo(this.ruleDates,this.last,(n,r)=>n.compare(r)),this.ruleDate=this.ruleDates[this.ruleDateInc]),s.hasProperty("rrule")){let n=s.getAllProperties("rrule"),r=0,a=n.length,i,o;for(;r<a;r++)i=n[r].getFirstValue(),o=i.iterator(this.dtstart),this.ruleIterators.push(o),o.next()}s.hasProperty("exdate")&&(this.exDates=this._extractDates(s,"exdate"),this.exDateInc=Lo(this.exDates,this.last,this._compare_special),this.exDate=this.exDates[this.exDateInc])}_nextExDay(){this.exDate=this.exDates[++this.exDateInc]}_nextRuleDay(){this.ruleDate=this.ruleDates[++this.ruleDateInc]}_nextRecurrenceIter(){let s=this.ruleIterators;if(s.length===0)return null;let n=s.length,r,a,i=0,o;for(;i<n;i++){if(r=s[i],a=r.last,r.completed){n--,i!==0&&i--,s.splice(i,1);continue}(!o||o.last.compare(a)>0)&&(o=r)}return o}}var eo;let L1=(eo=class{constructor(s,n){he(this,"exceptions",null);he(this,"strictExceptions",!1);s instanceof yr||(n=s,s=null),s?this.component=s:this.component=new yr("vevent"),this._rangeExceptionCache=Object.create(null),this.exceptions=Object.create(null),this.rangeExceptions=[],n&&n.strictExceptions&&(this.strictExceptions=n.strictExceptions),n&&n.exceptions?n.exceptions.forEach(this.relateException,this):this.component.parent&&!this.isRecurrenceException()&&this.component.parent.getAllSubcomponents("vevent").forEach(function(r){r.hasProperty("recurrence-id")&&this.relateException(r)},this)}relateException(s){if(this.isRecurrenceException())throw new Error("cannot relate exception to exceptions");if(s instanceof yr&&(s=new eo(s)),this.strictExceptions&&s.uid!==this.uid)throw new Error("attempted to relate unrelated exception");let n=s.recurrenceId.toString();if(this.exceptions[n]=s,s.modifiesFuture()){let r=[s.recurrenceId.toUnixTime(),n],a=Lo(this.rangeExceptions,r,Hb);this.rangeExceptions.splice(a,0,r)}}modifiesFuture(){return this.component.hasProperty("recurrence-id")?this.component.getFirstProperty("recurrence-id").getParameter("range")===eo.THISANDFUTURE:!1}findRangeException(s){if(!this.rangeExceptions.length)return null;let n=s.toUnixTime(),r=Lo(this.rangeExceptions,[n],Hb);if(r-=1,r<0)return null;let a=this.rangeExceptions[r];return n<a[0]?null:a[1]}getOccurrenceDetails(s){let n=s.toString(),r=s.convertToZone(ss.utcTimezone).toString(),a,i={recurrenceId:s};if(n in this.exceptions)a=i.item=this.exceptions[n],i.startDate=a.startDate,i.endDate=a.endDate,i.item=a;else if(r in this.exceptions)a=this.exceptions[r],i.startDate=a.startDate,i.endDate=a.endDate,i.item=a;else{let o=this.findRangeException(s),c;if(o){let u=this.exceptions[o];i.item=u;let d=this._rangeExceptionCache[o];if(!d){let p=u.recurrenceId.clone(),g=u.startDate.clone();p.zone=g.zone,d=g.subtractDate(p),this._rangeExceptionCache[o]=d}let h=s.clone();h.zone=u.startDate.zone,h.addDuration(d),c=h.clone(),c.addDuration(u.duration),i.startDate=h,i.endDate=c}else c=s.clone(),c.addDuration(this.duration),i.endDate=c,i.startDate=s,i.item=this}return i}iterator(s){return new I1({component:this.component,dtstart:s||this.startDate})}isRecurring(){let s=this.component;return s.hasProperty("rrule")||s.hasProperty("rdate")}isRecurrenceException(){return this.component.hasProperty("recurrence-id")}getRecurrenceTypes(){let s=this.component.getAllProperties("rrule"),n=0,r=s.length,a=Object.create(null);for(;n<r;n++){let i=s[n].getFirstValue();a[i.freq]=!0}return a}get uid(){return this._firstProp("uid")}set uid(s){this._setProp("uid",s)}get startDate(){return this._firstProp("dtstart")}set startDate(s){this._setTime("dtstart",s)}get endDate(){let s=this._firstProp("dtend");if(!s){let n=this._firstProp("duration");s=this.startDate.clone(),n?s.addDuration(n):s.isDate&&(s.day+=1)}return s}set endDate(s){this.component.hasProperty("duration")&&this.component.removeProperty("duration"),this._setTime("dtend",s)}get duration(){let s=this._firstProp("duration");return s||this.endDate.subtractDateTz(this.startDate)}set duration(s){this.component.hasProperty("dtend")&&this.component.removeProperty("dtend"),this._setProp("duration",s)}get location(){return this._firstProp("location")}set location(s){this._setProp("location",s)}get attendees(){return this.component.getAllProperties("attendee")}get summary(){return this._firstProp("summary")}set summary(s){this._setProp("summary",s)}get description(){return this._firstProp("description")}set description(s){this._setProp("description",s)}get color(){return this._firstProp("color")}set color(s){this._setProp("color",s)}get organizer(){return this._firstProp("organizer")}set organizer(s){this._setProp("organizer",s)}get sequence(){return this._firstProp("sequence")}set sequence(s){this._setProp("sequence",s)}get recurrenceId(){return this._firstProp("recurrence-id")}set recurrenceId(s){this._setTime("recurrence-id",s)}_setTime(s,n){let r=this.component.getFirstProperty(s);r||(r=new $o(s),this.component.addProperty(r)),n.zone===ss.localTimezone||n.zone===ss.utcTimezone?r.removeParameter("tzid"):r.setParameter("tzid",n.zone.tzid),r.setValue(n)}_setProp(s,n){this.component.updatePropertyWithValue(s,n)}_firstProp(s){return this.component.getFirstPropertyValue(s)}toString(){return this.component.toString()}},he(eo,"THISANDFUTURE","THISANDFUTURE"),eo);function Hb(t,s){return t[0]>s[0]?1:s[0]>t[0]?-1:0}class HH{constructor(s){he(this,"parseEvent",!0);he(this,"parseTimezone",!0);he(this,"oncomplete",function(){});he(this,"onerror",function(s){});he(this,"ontimezone",function(s){});he(this,"onevent",function(s){});typeof s>"u"&&(s={});for(let[n,r]of Object.entries(s))this[n]=r}process(s){typeof s=="string"&&(s=Xt(s)),s instanceof yr||(s=new yr(s));let n=s.getAllSubcomponents(),r=0,a=n.length,i;for(;r<a;r++)switch(i=n[r],i.name){case"vtimezone":if(this.parseTimezone){let o=i.getFirstPropertyValue("tzid");o&&this.ontimezone(new ss({tzid:o,component:i}))}break;case"vevent":this.parseEvent&&this.onevent(new L1(i));break;default:continue}this.oncomplete()}}var gl={foldLength:75,debug:!1,newLineChar:`\r
`,Binary:ah,Component:yr,ComponentParser:HH,Duration:Mn,Event:L1,Period:oi,Property:$o,Recur:Rn,RecurExpansion:I1,RecurIterator:ld,Time:Ye,Timezone:ss,TimezoneService:jm,UtcOffset:na,VCardTime:Zi,parse:Xt,stringify:_s,design:$s,helpers:SH};function UH(t,s){try{const n=gl.parse(t),a=new gl.Component(n).getAllSubcomponents("vevent"),i=[];for(const o of a){const c=new gl.Event(o),u=c.uid||YH(),d=c.summary||"Ocupado",h=c.description||void 0,p=c.location||void 0,g=c.startDate.toJSDate(),x=c.endDate.toJSDate(),y=!!c.startDate.isDate;i.push({uid:u,calendarId:s,summary:d,description:h,startDate:g,endDate:x,isAllDay:y,location:p})}return i}catch(n){throw console.error("Error parsing iCal data:",n),new Error("No se pudo parsear el calendario. Verifica que la URL sea vlida.")}}async function WH(t,s,n=1e4){try{if(!$1(t))throw new Error("URL invlida. Debe ser una URL pblica de Google Calendar en formato iCal.");const r=new AbortController,a=setTimeout(()=>r.abort(),n),i=await fetch(t,{signal:r.signal,headers:{Accept:"text/calendar"}});if(clearTimeout(a),!i.ok)throw new Error(`Error al descargar el calendario: ${i.status} ${i.statusText}`);const o=await i.text();return UH(o,s)}catch(r){throw r instanceof Error?r.name==="AbortError"?new Error("Tiempo de espera agotado. La URL del calendario no responde."):r:new Error("Error desconocido al sincronizar el calendario.")}}function $1(t){try{const s=new URL(t);if(s.protocol!=="https:")return!1;const n=s.hostname.includes("calendar.google.com"),r=t.endsWith(".ics");return n||r}catch{return!1}}function YH(){return`fallback-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function VH(t,s,n){return t.filter(r=>r.startDate<n&&r.endDate>s)}function GH(t,s){const n=new Date(s);n.setHours(0,0,0,0);const r=new Date(s);return r.setHours(23,59,59,999),VH(t,n,r)}function z1(){const[t,s]=f.useState([]),[n,r]=f.useState([]),[a,i]=f.useState([]),[o,c]=f.useState("idle"),[u,d]=f.useState();f.useEffect(()=>{h()},[]);const h=f.useCallback(()=>{const D=po();s(D.calendars),r(D.events),i(D.hiddenEventIds),d(D.lastGlobalSync)},[]),p=f.useCallback((D,T,R)=>{const O={id:qH(),name:D,url:T,color:R||aH,enabled:!0};return lH(O),s(U=>[...U,O]),O},[]),g=f.useCallback((D,T)=>{Ab(D,T),s(R=>R.map(O=>O.id===D?{...O,...T}:O))},[]),x=f.useCallback(D=>{cH(D),s(T=>T.filter(R=>R.id!==D)),r(T=>T.filter(R=>R.calendarId!==D))},[]),y=f.useCallback(D=>{const T=t.find(R=>R.id===D);T&&g(D,{enabled:!T.enabled})},[t,g]),b=f.useCallback(async D=>{const T=t.find(R=>R.id===D);if(!T)return{calendarId:D,status:"error",error:"Calendario no encontrado"};try{const R=await WH(T.url,D,iH);dH(D,R),r(U=>[...U.filter(I=>I.calendarId!==D),...R]);const O=Date.now();return Ab(D,{lastSyncedAt:O}),s(U=>U.map(I=>I.id===D?{...I,lastSyncedAt:O}:I)),{calendarId:D,status:"success",eventCount:R.length}}catch(R){return console.error(`Error syncing calendar ${D}:`,R),{calendarId:D,status:"error",error:R instanceof Error?R.message:"Error desconocido"}}},[t]),v=f.useCallback(async()=>{c("syncing");const D=t.filter(T=>T.enabled);if(D.length===0)return c("idle"),[];try{const T=await Promise.all(D.map(U=>b(U.id))),R=Date.now();hH(),d(R);const O=T.some(U=>U.status==="error");return c(O?"error":"success"),setTimeout(()=>c("idle"),3e3),T}catch(T){return console.error("Error syncing calendars:",T),c("error"),setTimeout(()=>c("idle"),3e3),[]}},[t,b]),w=f.useCallback(D=>{uH(D),i(T=>[...T,D])},[]),N=f.useCallback(D=>{mH(D),i(T=>T.filter(R=>R!==D))},[]),S=f.useCallback(()=>n.filter(D=>{if(a.includes(D.uid))return!1;const T=t.find(R=>R.id===D.calendarId);return(T==null?void 0:T.enabled)??!1}),[n,a,t]),E=f.useCallback(D=>{const T=S();return GH(T,D)},[S]),k=f.useCallback(D=>a.includes(D),[a]);return{calendars:t,events:n,visibleEvents:S(),hiddenEventIds:a,syncStatus:o,lastSyncTime:u,addCalendar:p,updateCalendar:g,removeCalendar:x,toggleCalendar:y,syncCalendar:b,syncAllCalendars:v,hideEvent:w,showEvent:N,isEventHidden:k,getVisibleEventsForDay:E,loadFromStorage:h}}function qH(){return`cal-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function KH({layout:t,calendar:s,isHidden:n,onToggleVisibility:r}){const[a,i]=f.useState(!1),{event:o}=t,c=Ub(s.color,Lu.opacityBackground),u=Ub(s.color,Lu.opacityBorder),d=nt(o.startDate,"h:mm a",{locale:Zs}),h=nt(o.endDate,"h:mm a",{locale:Zs});return e.jsxs(Dd,{open:a,onOpenChange:i,children:[e.jsx(kd,{asChild:!0,children:e.jsxs("div",{className:"absolute cursor-pointer rounded-md px-2 py-1 text-xs overflow-hidden transition-opacity hover:opacity-90",style:{top:`${t.top}px`,height:`${Math.max(t.height,20)}px`,left:`${t.left}%`,width:`${t.width}%`,zIndex:t.zIndex,backgroundColor:c,borderLeft:`${Lu.borderWidth} ${Lu.borderStyle} ${u}`},children:[e.jsx("div",{className:"font-medium truncate",style:{color:s.color},children:o.summary}),t.height>30&&e.jsx("div",{className:"text-xs opacity-75 truncate",style:{color:s.color},children:d})]})}),e.jsx(Vl,{className:"w-80",side:"right",align:"start",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-start justify-between gap-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-sm",children:o.summary}),e.jsx(Mt,{variant:"outline",className:"mt-1",style:{borderColor:s.color,color:s.color},children:s.name})]})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(en,{className:"w-4 h-4"}),e.jsx("span",{children:nt(o.startDate,"EEEE, d 'de' MMMM",{locale:Zs})})]}),e.jsxs("div",{className:"text-sm text-muted-foreground pl-6",children:[d," - ",h]}),o.location&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(cp,{className:"w-4 h-4"}),e.jsx("span",{children:o.location})]}),o.description&&e.jsx("div",{className:"text-sm text-muted-foreground border-t pt-2",children:e.jsx("p",{className:"whitespace-pre-wrap",children:o.description})}),e.jsxs("div",{className:"border-t pt-2",children:[e.jsx($,{variant:"ghost",size:"sm",className:"w-full justify-start gap-2",onClick:()=>{r(o.uid),i(!1)},children:n?e.jsxs(e.Fragment,{children:[e.jsx(Sl,{className:"w-4 h-4"}),"Mostrar evento"]}):e.jsxs(e.Fragment,{children:[e.jsx(AO,{className:"w-4 h-4"}),"Ocultar evento"]})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2 px-2",children:n?"Este evento est oculto solo en Life Tracker":"Ocultar este evento solo lo esconde en Life Tracker, no lo elimina de Google Calendar"})]})]})})]})}function Ub(t,s){t=t.replace("#","");const n=parseInt(t.substring(0,2),16),r=parseInt(t.substring(2,4),16),a=parseInt(t.substring(4,6),16);return`rgba(${n}, ${r}, ${a}, ${s})`}function F1({onSync:t,syncStatus:s,lastSyncTime:n,variant:r="outline",size:a="default",showText:i=!0}){const o=s==="syncing",c=s==="success",u=s==="error";let d="Sincronizar";o&&(d="Sincronizando..."),c&&(d="Sincronizado"),u&&(d="Error al sincronizar");let h=ao;c&&(h=Fa),u&&(h=ro);const p=n?`ltima sincronizacin: ${Kj(n,{locale:Zs,addSuffix:!0})}`:"Nunca sincronizado";return e.jsxs("div",{className:"flex flex-col items-start gap-1",children:[e.jsxs($,{variant:r,size:a,onClick:t,disabled:o,className:u?"border-destructive text-destructive":"",children:[e.jsx(h,{className:`w-4 h-4 ${o?"animate-spin":""} ${i?"mr-2":""}`}),i&&d]}),i&&n!==void 0&&e.jsx("p",{className:"text-xs text-muted-foreground",children:p})]})}const Gp={startHour:6,pixelsPerHour:60};function JH(t){const s=t.getHours(),n=t.getMinutes(),r=s*60+n,a=Gp.startHour*60;return(r-a)/60*Gp.pixelsPerHour}function XH(t,s){return(s.getTime()-t.getTime())/(1e3*60*60)*Gp.pixelsPerHour}function Wb(t,s){return t.startDate<s.endDate&&t.endDate>s.startDate}function ZH(t){const s=[...t].sort((a,i)=>a.startDate.getTime()-i.startDate.getTime()),n=[],r=[];for(const a of s){let i=!1;for(let o=0;o<r.length;o++){const c=r[o];if(!c.some(d=>Wb(a,d))){c.push(a),i=!0;break}}i||r.push([a])}for(const a of s){let i=0,o=1;for(let p=0;p<r.length;p++)if(r[p].includes(a)){i=p,o=r.filter(x=>x.some(y=>Wb(a,y))).length;break}const c=JH(a.startDate),u=XH(a.startDate,a.endDate),d=100/o,h=i*d;n.push({event:a,top:c,height:u,left:h,width:d,zIndex:oH})}return n}const QH=()=>{const t=[];for(let s=6;s<=22;s++)t.push({hour:s,minute:0,label:`${s.toString().padStart(2,"0")}:00`}),s<22&&t.push({hour:s,minute:30,label:`${s.toString().padStart(2,"0")}:30`});return t},eU=({tasks:t,onDelete:s,onEdit:n,onQuickUpdate:r,onView:a,onMove:i,onToggle:o})=>{const c=new Date,u=f.useMemo(()=>QH(),[]),d=f.useRef(null),{habits:h,updateHabitTime:p,resetHabitTime:g,getHabitTime:x,toggleHabitCompletion:y}=rH(c),{calendars:b,getVisibleEventsForDay:v,hideEvent:w,showEvent:N,isEventHidden:S,syncAllCalendars:E,syncStatus:k,lastSyncTime:D}=z1(),T=f.useMemo(()=>v(c),[v,c]),R=f.useMemo(()=>ZH(T),[T]),O=KF(qF(fg,{activationConstraint:{distance:5}}));f.useEffect(()=>{if(!d.current)return;const Y=new Date,X=Y.getHours(),H=Y.getMinutes()<30?`${X.toString().padStart(2,"0")}:00`:`${X.toString().padStart(2,"0")}:30`,ie=d.current.querySelector(`[data-time="${H}"]`);ie&&setTimeout(()=>{ie.scrollIntoView({behavior:"smooth",block:"center"})},300)},[]);const{tasksWithTime:U,tasksWithoutTime:I}=f.useMemo(()=>{const Y=[],X=[];return t.forEach(se=>{if(!se.startDate||!pn(se.startDate,c))return;const H=se.startDate.getHours(),ie=se.startDate.getMinutes();if(H!==12||ie!==0)Y.push(se);else if(se.endDate){const fe=se.endDate.getHours(),le=se.endDate.getMinutes();fe!==12||le!==0?Y.push(se):X.push(se)}else X.push(se)}),{tasksWithTime:Y,tasksWithoutTime:X}},[t,c]),_=Y=>{const X=Y.getHours(),se=Y.getMinutes();return((X-6)*60+se)/30*50},M=(Y,X)=>{if(!X)return 50;const se=(X.getTime()-Y.getTime())/6e4;return Math.max(50,se/30*50)},W=f.useMemo(()=>{if(U.length===0)return[];const X=[...U].sort((H,ie)=>{const fe=H.startDate.getTime()-ie.startDate.getTime();if(fe!==0)return fe;const le=H.endDate?H.endDate.getTime()-H.startDate.getTime():0;return(ie.endDate?ie.endDate.getTime()-ie.startDate.getTime():0)-le}).map(H=>({...H,top:_(H.startDate),height:M(H.startDate,H.endDate),columnIndex:0,totalColumns:1})),se=[];for(const H of X){const ie=H.top,fe=H.top+H.height;let le=-1;for(let K=0;K<se.length;K++)if(se[K]<=ie){le=K;break}le===-1&&(le=se.length,se.push(0)),H.columnIndex=le,H.totalColumns=1,se[le]=fe}for(let H=0;H<X.length;H++){const ie=X[H],fe=ie.top+ie.height;let le=ie.columnIndex+1;for(let K=0;K<X.length;K++){if(H===K)continue;const de=X[K],je=de.top,ge=de.top+de.height;je<fe&&ge>ie.top&&(le=Math.max(le,de.columnIndex+1))}ie.totalColumns=le}return X},[U]),B=U.length+I.length,P=h.length,z=()=>{},G=Y=>{},ae=Y=>{var ie,fe,le;const{active:X,delta:se}=Y,H=(ie=X.data.current)==null?void 0:ie.type;if(H==="task-move"){if(!((fe=X.data.current)!=null&&fe.task)||!i)return;const K=X.data.current.task;if(!K.startDate)return;const de=_(K.startDate),je=Math.max(0,de+se.y),ge=by(je,K.startDate),Se=jy(ge,15),oe=Se.getHours();if(oe<6||oe>=22)return;const J=nd(K.startDate,K.endDate,Se);if(J&&J.getHours()>22)return;i(K.id,Se)}else if(H==="habit-move"){if(!((le=X.data.current)!=null&&le.habit))return;const K=X.data.current.habit,de=x(K.id,Ie(c)),je=Gw(A1(de,c),6),ge=Math.max(0,je+se.y),Se=by(ge,c,6),oe=jy(Se,15),J=oe.getHours();if(J<6||J>=22)return;const ye=nt(oe,"HH:mm");p(K.id,Ie(c),ye)}};return B===0&&P===0?null:e.jsx(XB,{sensors:O,onDragStart:z,onDragMove:G,onDragEnd:ae,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"sticky top-0 bg-white py-2 z-10",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("h3",{className:"text-sm font-semibold text-blue-600 flex items-center gap-2",children:[e.jsx("span",{children:""}),"Hoy - ",nt(c,"dd/MM/yyyy")," (",B," tareas",P>0&&`, ${P} hbitos pendientes`,")"]}),b.length>0&&e.jsx(F1,{onSync:E,syncStatus:k,lastSyncTime:D,variant:"ghost",size:"sm",showText:!1})]})}),(U.length>0||h.length>0)&&e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 px-3 py-2 border-b",children:e.jsx("h4",{className:"text-xs font-semibold text-gray-700",children:"Franjas Horarias (06:00 - 22:00)"})}),e.jsxs("div",{ref:d,className:"max-h-[600px] overflow-y-auto relative",id:"today-time-grid",children:[e.jsx("div",{className:"divide-y",children:u.map(Y=>{const X=Y.minute===0,se=new Date,H=se.getHours()===Y.hour&&(se.getMinutes()<30?Y.minute===0:Y.minute===30);return e.jsxs("div",{className:ce("flex h-[50px] relative bg-gray-50/50",X&&"border-t-2 border-gray-300"),"data-time":Y.label,children:[H&&e.jsx("div",{className:"absolute inset-x-0 top-0 h-0.5 bg-red-500 z-30",children:e.jsx("div",{className:"absolute left-0 top-0 w-2 h-2 bg-red-500 rounded-full -mt-[3px]"})}),e.jsx("div",{className:ce("w-16 flex-shrink-0 px-2 py-1 border-r bg-gray-50 flex items-center",!X&&"text-gray-400"),children:e.jsx("span",{className:ce("text-[11px] font-medium",X?"text-gray-700":"text-gray-400"),children:Y.label})}),e.jsx("div",{className:"flex-1"})]},`${Y.hour}-${Y.minute}`)})}),e.jsx("div",{className:"absolute top-0 left-16 right-0 pointer-events-none",style:{height:`${u.length*50}px`},children:R.map(Y=>{const X=b.find(H=>H.id===Y.event.calendarId);if(!X)return null;const se=S(Y.event.uid);return e.jsx(KH,{layout:Y,calendar:X,isHidden:se,onToggleVisibility:H=>{se?N(H):w(H)}},Y.event.uid)})}),e.jsx("div",{className:"absolute top-0 left-16 right-0 pointer-events-none",style:{height:`${u.length*50}px`},children:W.map(Y=>{const X=100/Y.totalColumns,se=Y.columnIndex/Y.totalColumns*100;return e.jsx(eH,{task:Y,onDelete:s,onEdit:n,onQuickUpdate:r,onToggle:o,className:"pointer-events-auto",style:{position:"absolute",top:`${Y.top}px`,height:`${Y.height-2}px`,left:`${se}%`,width:`calc(${X}% - 4px)`,marginLeft:"2px"}},Y.id)})}),e.jsx("div",{className:"absolute top-0 left-16 right-0 pointer-events-none",style:{height:`${u.length*50}px`},children:h.map(Y=>e.jsx(tH,{habit:Y,customTime:x(Y.id,Ie(c)),onTimeChange:(X,se)=>p(X,Ie(c),se),onComplete:X=>y(X,Ie(c)),onReset:X=>g(X,Ie(c)),className:"pointer-events-auto",style:{position:"absolute",top:`${Y.top}px`,height:`${Y.height}px`,left:"0",width:"calc(100% - 4px)",marginLeft:"2px",zIndex:5}},`habit-${Y.id}`))})]})]}),I.length>0&&e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-amber-50 px-3 py-2 border-b border-amber-200",children:e.jsxs("h4",{className:"text-xs font-semibold text-amber-800 flex items-center gap-1",children:[e.jsx("span",{children:""}),"Sin Hora Asignada (",I.length,")"]})}),e.jsx("div",{className:"p-2 space-y-2 bg-white",children:I.map(Y=>e.jsx(Ad,{task:Y,onDelete:s,onEdit:n,onView:a,onMove:i,showCategoryLabel:!0},Y.id))})]})]})})},tU=({tasks:t,onDelete:s,onEdit:n,onView:r,onMove:a})=>{const i=new Date,o=ps(i),c=f.useMemo(()=>{const g={};return t.forEach(x=>{if(!x.startDate||!Qu(ps(x.startDate),o)||pn(x.startDate,i))return;const y=nt(x.startDate,"yyyy-MM-dd");g[y]||(g[y]=[]),g[y].push(x)}),Object.keys(g).forEach(x=>{g[x].sort((y,b)=>{if(y.startDate&&b.startDate){const v=y.startDate.getHours()!==12||y.startDate.getMinutes()!==0,w=b.startDate.getHours()!==12||b.startDate.getMinutes()!==0;if(v&&w)return y.startDate.getTime()-b.startDate.getTime();if(v)return-1;if(w)return 1}return 0})}),g},[t,i,o]),u=f.useMemo(()=>Object.keys(c).sort((g,x)=>g.localeCompare(x)),[c]),d=u.reduce((g,x)=>g+c[x].length,0);if(d===0)return null;const h=g=>{if(!g.startDate)return!1;const x=g.startDate.getHours(),y=g.startDate.getMinutes();return x!==12||y!==0},p=g=>{if(!g.startDate||!h(g))return"";const x=nt(g.startDate,"HH:mm");if(g.endDate){const y=nt(g.endDate,"HH:mm");return`${x} - ${y}`}return x};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"sticky top-0 bg-white py-2 z-10",children:e.jsxs("h3",{className:"text-sm font-semibold text-green-600 flex items-center gap-2",children:[e.jsx("span",{children:""}),"Tareas Futuras (",d,")"]})}),e.jsx("div",{className:"space-y-6",children:u.map(g=>{const x=c[g],y=new Date(g+"T12:00:00");return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-1 border-b",children:[e.jsx(ns,{className:"w-4 h-4 text-gray-500"}),e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:nt(y,"EEEE, d 'de' MMMM",{locale:Zs})}),e.jsxs(Mt,{variant:"outline",className:"text-xs",children:[x.length," ",x.length===1?"tarea":"tareas"]})]}),e.jsx("div",{className:"space-y-2 pl-2",children:x.map(b=>{const v=p(b);return e.jsxs("div",{className:"space-y-1",children:[v&&e.jsxs(Mt,{variant:"secondary",className:"text-xs bg-blue-50 text-blue-700 border-blue-200",children:[e.jsx(en,{className:"w-3 h-3 mr-1"}),v]}),e.jsx(Ad,{task:b,onDelete:s,onEdit:n,onView:r,onMove:a,showCategoryLabel:!0})]},b.id)})})]},g)})})]})},sU=({tasks:t,onDelete:s,onEdit:n,onView:r,onMove:a})=>{const i=f.useMemo(()=>t.filter(o=>!o.startDate&&!o.completed).sort((o,c)=>{var p,g;const u={do:1,decide:2,delegate:3,delete:4},d=u[o.priority]||5,h=u[c.priority]||5;return d!==h?d-h:(((p=c.createdAt)==null?void 0:p.seconds)||0)-(((g=o.createdAt)==null?void 0:g.seconds)||0)}),[t]);return i.length===0?null:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"sticky top-0 bg-white py-2 z-10",children:e.jsxs("h3",{className:"text-sm font-semibold text-gray-600 flex items-center gap-2",children:[e.jsx("span",{children:""}),"Sin Fecha (",i.length,")"]})}),e.jsx("div",{className:"space-y-2",children:i.map(o=>e.jsx(Ad,{task:o,onDelete:s,onEdit:n,onView:r,onMove:a,showCategoryLabel:!0},o.id))})]})},nU=({tasks:t,onDelete:s,onEdit:n,onQuickUpdate:r,onView:a,onMove:i,onToggle:o,searchQuery:c,onSearchChange:u,selectedCategories:d,onCategoriesChange:h})=>{const[p,g]=f.useState(""),[x,y]=f.useState([]),b=c!==void 0?c:p,v=u||g,w=d!==void 0?d:x,N=h||y,S=D=>{const T=w.includes(D)?w.filter(R=>R!==D):[...w,D];N(T)},E=D=>{N(w.filter(T=>T!==D))},k=f.useMemo(()=>{const D=new Date,T=new Date(D.getFullYear(),D.getMonth(),D.getDate());let R=0,O=0,U=0,I=0;return t.forEach(_=>{if(!_.startDate){I++;return}const M=new Date(_.startDate),W=new Date(M.getFullYear(),M.getMonth(),M.getDate());W<T?R++:W.getTime()===T.getTime()?O++:U++}),{overdue:R,todayCount:O,future:U,noDate:I}},[t]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"sticky top-0 bg-white z-20 pb-4 space-y-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 items-start sm:items-center",children:[e.jsxs("div",{className:"relative flex-1 max-w-md w-full",children:[e.jsx($l,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(Fe,{placeholder:"Buscar tareas por nombre o descripcin...",value:b,onChange:D=>v(D.target.value),className:"pl-10 pr-10"}),b&&e.jsx($,{variant:"ghost",size:"sm",onClick:()=>v(""),className:"absolute right-1 top-1/2 transform -translate-y-1/2 h-6 w-6 p-0 hover:bg-gray-100",children:e.jsx(Ws,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 sm:w-auto w-full",children:[w.map(D=>e.jsxs(Mt,{variant:"secondary",className:ce("flex items-center gap-1 pr-1 cursor-pointer hover:opacity-80 transition-opacity",Ra[D].bg,Ra[D].text),children:[e.jsx("span",{className:"text-xs",children:Qs[D]}),e.jsx("button",{onClick:()=>E(D),className:"ml-1 hover:bg-black/10 rounded-full p-0.5",title:`Quitar ${Qs[D]}`,children:e.jsx(Ws,{className:"w-3 h-3"})})]},D)),e.jsxs(Dd,{children:[e.jsx(kd,{asChild:!0,children:e.jsxs($,{variant:"outline",size:"sm",className:ce("h-8 gap-1",w.length>0&&"border-blue-500"),children:[e.jsx(xd,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs",children:w.length>0?`Categoras (${w.length})`:"Categoras"})]})}),e.jsx(Vl,{className:"w-56 p-3",align:"end",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm font-medium mb-2 flex items-center gap-2",children:[e.jsx(Cl,{className:"w-4 h-4"}),"Filtrar por categora"]}),Object.entries(Cd).map(([D,T])=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer hover:bg-gray-50 p-1 rounded transition-colors",children:[e.jsx(Rs,{checked:w.includes(T),onCheckedChange:()=>S(T)}),e.jsx("span",{className:"text-sm flex-1",children:Qs[T]}),e.jsx("div",{className:ce("w-3 h-3 rounded",Ra[T].bg),title:Qs[T]})]},D)),w.length>0&&e.jsx($,{variant:"ghost",size:"sm",className:"w-full mt-2 text-xs",onClick:()=>N([]),children:"Limpiar todo"})]})})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3 text-xs",children:[k.overdue>0&&e.jsxs("div",{className:"flex items-center gap-1 text-red-600",children:[e.jsx("span",{className:"font-semibold",children:k.overdue})," vencidas"]}),k.todayCount>0&&e.jsxs("div",{className:"flex items-center gap-1 text-blue-600",children:[e.jsx("span",{className:"font-semibold",children:k.todayCount})," hoy"]}),k.future>0&&e.jsxs("div",{className:"flex items-center gap-1 text-green-600",children:[e.jsx("span",{className:"font-semibold",children:k.future})," futuras"]}),k.noDate>0&&e.jsxs("div",{className:"flex items-center gap-1 text-gray-500",children:[e.jsx("span",{className:"font-semibold",children:k.noDate})," sin fecha"]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 min-w-fit",children:[e.jsx("div",{className:"flex-1 md:min-w-[300px] lg:min-w-[350px]",children:e.jsxs("div",{className:"border rounded-lg p-4 bg-red-50/50 h-full",children:[e.jsx(PF,{tasks:t,onDelete:s,onEdit:n,onView:a,onMove:i}),k.overdue===0&&e.jsx("div",{className:"text-center py-8 text-gray-400 text-sm",children:"No hay tareas vencidas"})]})}),e.jsx("div",{className:"flex-1 md:min-w-[400px] lg:min-w-[500px]",children:e.jsxs("div",{className:"border rounded-lg p-4 bg-blue-50/50 h-full",children:[e.jsx(eU,{tasks:t,onDelete:s,onEdit:n,onQuickUpdate:r,onView:a,onMove:i,onToggle:o}),k.todayCount===0&&e.jsx("div",{className:"text-center py-8 text-gray-400 text-sm",children:"No hay tareas para hoy"})]})}),e.jsx("div",{className:"flex-1 md:min-w-[300px] lg:min-w-[350px]",children:e.jsxs("div",{className:"border rounded-lg p-4 bg-green-50/50 h-full",children:[e.jsx(tU,{tasks:t,onDelete:s,onEdit:n,onView:a,onMove:i}),k.future===0&&e.jsx("div",{className:"text-center py-8 text-gray-400 text-sm",children:"No hay tareas futuras"})]})}),k.noDate>0&&e.jsx("div",{className:"flex-1 md:min-w-[300px] lg:min-w-[350px]",children:e.jsx("div",{className:"border rounded-lg p-4 bg-gray-50/50 h-full",children:e.jsx(sU,{tasks:t,onDelete:s,onEdit:n,onView:a,onMove:i})})})]})}),t.length===0&&e.jsx("div",{className:"text-center py-12 text-gray-500",children:e.jsx("p",{className:"text-sm",children:"No se encontraron tareas con los filtros aplicados"})})]})},rU=()=>{const{tasks:t,status:s,error:n,showRecurrenceModal:r,currentTask:a,modalMode:i,addTask:o,editTask:c,toggleTask:u,deleteTask:d,completeRecurrentTask:h,setShowRecurrenceModal:p,openEditModal:g,openCreateModal:x,resync:y}=qo(),{isOnline:b}=ua(),[v,w]=f.useState(null),[N,S]=f.useState(!1);return rg({openCreateModal:x,isModalOpen:r||N}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs(Ce,{className:"w-full",children:[e.jsxs(Ae,{className:"pt-6 overflow-x-auto",children:[e.jsx(NF,{tasks:t,onDelete:d,onEdit:g,onView:E=>{w(E),S(!0)},onMove:(E,k)=>c(E,{startDate:k??void 0}),onAdd:E=>x(E??void 0),onFilteredTasksChange:()=>{}}),n&&e.jsx("p",{className:"text-sm text-red-500 mt-4",children:n})]}),e.jsxs(In,{className:"justify-center gap-2 text-xs p-2",children:[s==="saving"&&e.jsx("span",{className:"text-blue-500",children:"Guardando..."}),s==="pending"&&e.jsx("span",{className:"text-yellow-600",children:"Pendiente de sincronizar"}),s==="saved"&&e.jsx("span",{className:"text-green-600",children:"Sincronizado"}),s==="error"&&e.jsx("span",{className:"text-red-600",children:"Error de sincronizacin"}),!b&&e.jsx("span",{className:"text-orange-600",children:"Offline"}),e.jsx($,{onClick:y,variant:"link",className:"p-0 h-auto",children:"Reintentar"})]})]}),e.jsx(Gl,{isOpen:r,onClose:()=>p(),onConfirm:E=>{i==="complete"?h(E):i==="edit"?c(a.id,E):o(E)},task:a||{id:"",taskCode:0,title:"",completed:!1,category:"personal",createdAt:{seconds:Date.now()/1e3}},mode:i}),e.jsx(sh,{task:v,isOpen:N,onClose:()=>S(!1),onEdit:E=>{S(!1),g(E)},onToggle:u}),e.jsx(CF,{})]})},aU=({showFloatingButton:t=!1})=>{const{user:s}=Je(),n=qo(),{tasks:r,status:a,error:i,showRecurrenceModal:o,currentTask:c,modalMode:u,addTask:d,editTask:h,toggleTask:p,deleteTask:g,completeRecurrentTask:x,setShowRecurrenceModal:y,openEditModal:b,openCreateModal:v,resync:w,clearCacheAndReload:N}=n,{isOnline:S}=ua(),[E,k]=f.useState(null),[D,T]=f.useState(!1);return rg({openCreateModal:v,isModalOpen:o||D}),s?e.jsxs("div",{className:"space-y-8 relative",children:[e.jsxs(Ce,{children:[e.jsx(Ae,{className:"pt-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(gF,{tasks:r,onDelete:g,onEdit:b,onView:R=>{k(R),T(!0)},onMove:(R,O)=>{const U=r.find(_=>_.id===R);if(!U)return;if(!O){h(R,{startDate:void 0,endDate:void 0});return}const I=nd(U.startDate,U.endDate,O);h(R,{startDate:O,endDate:I})},onAssignTimeOfDay:(R,O)=>h(R,{timeOfDay:O}),status:a,error:i}),i&&e.jsx(ag,{error:i,onRetry:w,showClearCache:!0})]})}),e.jsxs(In,{className:"gap-2 text-xs p-2 border-t",children:[a==="saving"&&e.jsx("span",{className:"text-blue-500",children:"Guardando..."}),a==="pending"&&e.jsx("span",{className:"text-yellow-600",children:"Pendiente de sincronizar"}),a==="saved"&&e.jsx("span",{className:"text-green-600",children:"Sincronizado"}),a==="error"&&e.jsx("span",{className:"text-red-600",children:"Error de sincronizacin"}),!S&&e.jsx("span",{className:"text-orange-600",children:"Offline"}),e.jsx($,{onClick:w,variant:"link",className:"p-0 h-auto",children:"Reintentar"}),(a==="error"||!S)&&e.jsx($,{onClick:N,variant:"link",className:"p-0 h-auto text-red-600",children:"Limpiar Cache"})]})]}),t&&e.jsx("div",{className:"md:hidden fixed bottom-20 right-4 z-50",children:e.jsx($,{onClick:()=>v(),size:"lg",className:"w-14 h-14 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 bg-blue-600 hover:bg-blue-700 active:scale-95 border-0 flex items-center justify-center text-white",children:e.jsx(cs,{className:"w-6 h-6 text-white"})})}),e.jsx(Gl,{isOpen:o,onClose:()=>y(),onConfirm:R=>{u==="complete"?x(R):u==="edit"?h(c.id,R):d(R)},task:c||{id:"",taskCode:0,title:"",completed:!1,category:"personal",createdAt:{seconds:Date.now()/1e3}},mode:u}),e.jsx(sh,{task:E,isOpen:D,onClose:()=>T(!1),onEdit:R=>{T(!1),b(R)},onToggle:p})]}):e.jsxs(Ce,{children:[e.jsx(Ae,{className:"p-8 text-center",children:e.jsx("p",{children:"Inicia sesin para gestionar tus tareas"})}),e.jsxs(In,{className:"gap-2 text-xs p-2",children:[a==="saving"&&e.jsx("span",{className:"text-blue-500",children:"Guardando..."}),a==="pending"&&e.jsx("span",{className:"text-yellow-600",children:"Pendiente de sincronizar"}),a==="saved"&&e.jsx("span",{className:"text-green-600",children:"Sincronizado"}),a==="error"&&e.jsx("span",{className:"text-red-600",children:"Error de sincronizacin"}),!S&&e.jsx("span",{className:"text-orange-600",children:"Offline"}),e.jsx($,{onClick:w,variant:"link",className:"p-0 h-auto",children:"Reintentar"})]})]})},Yi=Lr("journal"),iU=Yi?`https://generativelanguage.googleapis.com/v1beta/models/${Yi.model}:generateContent`:"",oU=({entry:t,open:s,onOpenChange:n,onInsert:r,onReplace:a})=>{const[i,o]=f.useState(!1),c=s!==void 0?s:i,u=n??o,[d,h]=f.useState(""),[p,g]=f.useState(!1),[x,y]=f.useState(""),[b,v]=f.useState(0),w="AIzaSyAW4Ot-z7OH4ZR3OeaN7vcbkEDlWpo1aMY",N=(Yi==null?void 0:Yi.prompt)??"Reescribe el siguiente texto del diario de forma clara y natural:",S=Yi==null?void 0:Yi.params;f.useEffect(()=>{c&&y(`${N}
${t}`)},[c,t]),f.useEffect(()=>{v(zr(x))},[x]);const E=async()=>{var D,T,R,O,U;if(t){g(!0);try{const _=await(await fetch(`${iU}?key=${w}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:x}]}],...S})})).json(),M=(U=(O=(R=(T=(D=_==null?void 0:_.candidates)==null?void 0:D[0])==null?void 0:T.content)==null?void 0:R.parts)==null?void 0:O[0])==null?void 0:U.text;h(M||"No se pudo obtener respuesta")}catch{h("Error al consultar la API")}finally{g(!1)}}},k=()=>{u(!1),h(""),y(""),v(0)};return e.jsxs(kt,{open:c,onOpenChange:D=>D?u(!0):k(),children:[s===void 0&&e.jsxs($,{size:"sm",variant:"outline",onClick:()=>u(!0),className:"flex items-center gap-2",children:[e.jsx(Gs,{className:"w-4 h-4"}),"Mejorar entrada"]}),e.jsxs(wt,{className:"w-[95vw] h-[90vh] max-w-none max-h-none overflow-hidden flex flex-col sm:w-[90vw] sm:h-[85vh]",children:[e.jsxs(At,{className:"flex-shrink-0",children:[e.jsx(_t,{className:"text-xl",children:"Reescribir Diario con IA"}),e.jsx(cn,{children:"Gemini transformar tu texto en un estilo ms natural. Usa el panel izquierdo para editar el prompt y visualiza el resultado en el panel derecho."})]}),e.jsxs("div",{className:"flex-1 flex flex-col sm:flex-row gap-4 min-h-0 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[e.jsxs("div",{className:"flex-1 flex flex-col mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2 flex-shrink-0",children:"Prompt para IA"}),e.jsx(It,{value:x,onChange:D=>y(D.target.value),className:"flex-1 resize-none min-h-0",placeholder:"Escribe o modifica el prompt para la IA..."})]}),e.jsxs("div",{className:"flex flex-col gap-3 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"text-gray-500",children:["Tokens: ",b]}),b>3500&&e.jsx("span",{className:"text-red-500 font-medium",children:"Prompt demasiado largo!"})]}),e.jsxs($,{onClick:E,disabled:p||!w||b>3500,className:"w-full flex items-center justify-center gap-2",size:"lg",children:[p&&e.jsx(fs,{className:"w-4 h-4 animate-spin"}),e.jsx(Gs,{className:"w-4 h-4"}),p?"Consultando IA...":"Generar versin mejorada"]}),p&&e.jsx($a,{className:"mt-2"})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 sm:border-l sm:border-gray-200 sm:pl-4 border-t sm:border-t-0 border-gray-200 pt-4 sm:pt-0",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Resultado"}),d&&e.jsxs($,{type:"button",size:"sm",variant:"outline",onClick:()=>{navigator.clipboard.writeText(d),bt.success("Texto copiado al portapapeles")},className:"flex items-center gap-1",children:[e.jsx(da,{className:"w-4 h-4"}),"Copiar"]})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[e.jsx(It,{readOnly:!0,value:d||(p?"Generando respuesta...":"El resultado aparecer aqu despus de generar"),className:"flex-1 resize-none bg-gray-50 border-gray-200 min-h-0",placeholder:"El resultado aparecer aqu..."}),d&&(r||a)&&e.jsxs("div",{className:"mt-3 flex flex-col sm:flex-row gap-2 flex-shrink-0",children:[r&&e.jsx($,{type:"button",className:"flex-1",onClick:()=>{r(d),bt.success("Texto insertado")},variant:"default",children:" Insertar en entrada"}),a&&e.jsx($,{type:"button",className:"flex-1",onClick:()=>{a(d),bt.success("Texto reemplazado")},variant:"secondary",children:" Reemplazar entrada"})]})]})]})]}),e.jsx("div",{className:"flex-shrink-0 mt-4 pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 text-xs text-gray-500",children:[e.jsx("span",{children:" Tip: Puedes editar el prompt para obtener diferentes estilos de reescritura"}),!w]})})]})]})},Wc=Lr("journal"),lU=Wc?`https://generativelanguage.googleapis.com/v1beta/models/${Wc.model}:generateContent`:"",cU=({entry:t,selectedDate:s,open:n,onOpenChange:r})=>{const{user:a}=Je(),[i,o]=f.useState(!1),c=n!==void 0?n:i,u=r??o,[d,h]=f.useState(""),[p,g]=f.useState(""),[x,y]=f.useState(!1),[b,v]=f.useState(0),w="AIzaSyAW4Ot-z7OH4ZR3OeaN7vcbkEDlWpo1aMY",N="Analiza la siguiente entrada del diario y los estados de nimo del da. Da una breve opinin sobre cmo fue y sugiere mejoras para maana.",S=Wc==null?void 0:Wc.params;f.useEffect(()=>{c?(async()=>{let D="";if(a){const T=Ie(s),R=ke(Bt(xe,"moods"),`${a.uid}_${T}`),O=await ot(R);D=(O.exists()&&Array.isArray(O.data().moods)?O.data().moods:[]).map(I=>`${I.emoji} ${I.text}`).join(", ")}g(`${N}
Moods: ${D}
Diario:
${t}`)})():(g(""),h(""))},[c,t,a,s]),f.useEffect(()=>{v(zr(p))},[p]);const E=async()=>{var D,T,R,O,U;if(p){y(!0);try{const _=await(await fetch(`${lU}?key=${w}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:p}]}],...S})})).json(),M=(U=(O=(R=(T=(D=_==null?void 0:_.candidates)==null?void 0:D[0])==null?void 0:T.content)==null?void 0:R.parts)==null?void 0:O[0])==null?void 0:U.text;h(M||"No se pudo obtener respuesta")}catch{h("Error al consultar la API")}finally{y(!1)}}},k=()=>{u(!1),h(""),g(""),v(0)};return e.jsx(kt,{open:c,onOpenChange:D=>D?u(!0):k(),children:e.jsxs(wt,{className:"w-full sm:max-w-5xl max-h-[90vh] overflow-auto",children:[e.jsxs(At,{children:[e.jsx(_t,{children:"Opinin del da"}),e.jsx(cn,{children:"Resumen y sugerencias para maana."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(It,{value:p,onChange:D=>g(D.target.value),className:"max-h-[500px] overflow-y-auto"}),e.jsxs("p",{className:"text-xs text-right",children:["Tokens: ",b," ",b>3500&&e.jsx("span",{className:"text-red-500",children:"Prompt demasiado largo!"})]}),e.jsxs($,{onClick:E,disabled:x||!w,className:"w-full flex items-center justify-center gap-2",children:[x&&e.jsx(fs,{className:"w-4 h-4 animate-spin"}),x?"Consultando...":"Analizar da"]}),x&&e.jsx($a,{className:"mt-2"}),d&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex justify-end",children:e.jsx($,{type:"button",size:"icon",variant:"ghost",onClick:()=>{navigator.clipboard.writeText(d),bt.success("Texto copiado")},children:e.jsx(da,{className:"w-4 h-4"})})}),e.jsx(It,{readOnly:!0,value:d,className:"max-h-[300px]"})]})]})]})})},dU=({entry:t,selectedDate:s,onInsert:n,onReplace:r})=>{const[a,i]=f.useState(!1),[o,c]=f.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs(oa,{children:[e.jsx(la,{asChild:!0,children:e.jsxs($,{size:"sm",variant:"outline",className:"flex items-center gap-2 text-blue-600",children:[e.jsx(Gs,{className:"w-4 h-4"}),"IA"]})}),e.jsxs(Pr,{align:"end",children:[e.jsx(Ft,{onSelect:()=>i(!0),children:"Reescribir entrada"}),e.jsx(Ft,{onSelect:()=>c(!0),children:"Opinin y consejos"})]})]}),e.jsx(oU,{entry:t,open:a,onOpenChange:i,onInsert:n,onReplace:r}),e.jsx(cU,{entry:t,selectedDate:s,open:o,onOpenChange:c})]})},uU=t=>{const[s,n]=f.useState(""),[r,a]=f.useState("idle"),[i,o]=f.useState(null),[c,u]=f.useState(void 0),{user:d}=Je(),h=f.useCallback(async()=>{if(!d)return;a("saving"),o(null);const x=Ie(t);try{Me.logRead("journal","useJournalData.loadJournalEntry");const y=ke(xe,"journal",`${d.uid}_${x}`),b=await ot(y);if(b.exists()){const v=b.data();if(n(v.text||""),v.lastUpdated){const w=v.lastUpdated.toDate();u(am(w))}a("saved")}else n(""),a("idle"),u(void 0)}catch(y){console.error("Error loading journal entry:",y),o(y instanceof Error?y.message:"Error loading journal entry"),a("error")}},[d,t]);f.useEffect(()=>{h()},[h]);const p=f.useCallback(async x=>{if(!d)return;a("saving"),o(null);const y=s,b=c,v=new Date,w=am(v);n(x),u(w);const N=Ie(t),S=ke(xe,"journal",`${d.uid}_${N}`);try{Me.logWrite("journal","useJournalData.saveEntry"),await Zt(S,{userId:d.uid,text:x,date:N,lastUpdated:ht(),displayTime:v.toLocaleString("es-ES",{hour:"2-digit",minute:"2-digit",day:"2-digit",month:"2-digit"})},{merge:!0}),a("saved")}catch(E){console.error("Error saving journal entry:",E),n(y),u(b),o(E instanceof Error?E.message:"Error al guardar"),a("error")}},[d,t,s,c]),g=Ha("Journal data");return{entry:s,setEntry:n,status:r,error:i,saveEntry:p,lastUpdated:c,loadJournalEntry:h,resync:g}},mU=({selectedDate:t})=>{const{user:s}=Je(),{isUnlocked:n,setUnlocked:r}=qx(),[a,i]=f.useState(!1),{entry:o,setEntry:c,status:u,error:d,saveEntry:h,lastUpdated:p,resync:g}=uU(t),{isOnline:x}=ua(),{entry:y,setEntry:b}=DC();f.useEffect(()=>{b(o)},[o,b]);const v=()=>{r(!1)};return s?n?e.jsxs(e.Fragment,{children:[e.jsxs(Ce,{className:"w-full",children:[e.jsxs(Ae,{className:"p-4",children:[e.jsx(e6,{onLock:v}),e.jsx(t6,{value:y,onChange:w=>{b(w),c(w)}}),d&&e.jsx("p",{className:"mt-2 text-sm text-red-500",children:d})]}),e.jsxs(In,{className:"flex flex-col gap-4 p-2",children:[e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx(_C,{lastUpdated:p}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{onClick:()=>h(y),disabled:u==="saving"||!x,children:u==="saving"?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ry,{className:"w-4 h-4 animate-spin"}),"Guardando..."]}):e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ry,{className:"w-4 h-4"}),"Guardar"]})}),e.jsx(dU,{entry:y,selectedDate:t,onInsert:w=>{b(N=>N+(N?`
`:"")+w),c(N=>N+(N?`
`:"")+w)},onReplace:w=>{b(w),c(w)}}),e.jsx($,{variant:"outline",size:"sm",onClick:()=>i(!0),children:e.jsx(br,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex justify-center items-center gap-2 text-xs",children:[u==="saving"&&e.jsx("span",{className:"text-blue-500",children:"Guardando..."}),u==="pending"&&e.jsx("span",{className:"text-yellow-600",children:"Pendiente de sincronizar"}),u==="saved"&&e.jsx("span",{className:"text-green-600",children:"Sincronizado"}),u==="error"&&e.jsx("span",{className:"text-red-600",children:"Error de sincronizacin"}),!x&&e.jsx("span",{className:"text-orange-600",children:"Offline"}),e.jsx($,{onClick:g,variant:"link",className:"p-0 h-auto text-xs",children:"Reintentar"})]})]})]}),e.jsx(fF,{selectedDate:t}),e.jsx(xF,{open:a,onOpenChange:i})]}):e.jsx(s6,{onUnlock:()=>r(!0),lastUpdated:p}):e.jsx(Ce,{className:"w-full",children:e.jsx(Ae,{className:"p-4 text-center",children:e.jsx("p",{children:"Inicia sesin para usar el diario"})})})},hU=({selectedDate:t})=>e.jsx(Gz,{children:e.jsx(Kz,{children:e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx(mU,{selectedDate:t})}),e.jsxs("div",{className:"md:col-span-1 space-y-4",children:[e.jsx(AC,{selectedDate:t,energyFirst:!0}),e.jsxs(hi,{children:[e.jsx(Om,{className:"h-4 w-4"}),e.jsx(fi,{children:"Registrar tu estado de nimo junto con tus entradas del diario te ayuda a mantener un mejor seguimiento de tus emociones y experiencias."})]})]})]})})})}),Yb={currentWeek:{label:"Semana actual",getValue:t=>({start:Pa(t),end:Rr(t)})},currentMonth:{label:"Mes actual",getValue:t=>({start:ls(t),end:vr(t)})}},fU=({onPeriodChange:t})=>{const s=n=>{const r=new Date,a=Yb[n];if(a){const{start:i,end:o}=a.getValue(r);t(i,o)}};return e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("span",{className:"text-sm font-medium",children:"Mostrar perodo:"}),e.jsxs(Tt,{onValueChange:s,defaultValue:"currentWeek",children:[e.jsx(vt,{className:"w-[180px]",children:e.jsx(Dt,{placeholder:"Seleccionar perodo"})}),e.jsx(yt,{children:Object.entries(Yb).map(([n,{label:r}])=>e.jsx(Pe,{value:n,children:r},n))})]})]})},pU=(t,s)=>{const[n,r]=f.useState(null),[a,i]=f.useState(!0),[o,c]=f.useState(null),{user:u}=Je();return f.useEffect(()=>{(async()=>{if(u){i(!0),c(null);try{const h=[],p=new Date(t),g=new Date(s);for(;p<=g;)h.push(Ie(p)),p.setDate(p.getDate()+1);const x=h.map(T=>{const R=ke(xe,"journal",`${u.uid}_${T}`);return ot(R)}),y=h.map(T=>{const R=ke(xe,"moods",`${u.uid}_${T}`);return ot(R)}),b=await Promise.all(x),v=await Promise.all(y),w=new Map(h.map(T=>[T,{date:T,words:0,characters:0}]));b.forEach(T=>{var R,O;if(T.exists()){const U=T.data();w.set(U.date,{date:U.date,words:((R=U.text)==null?void 0:R.split(/\s+/).filter(Boolean).length)||0,characters:((O=U.text)==null?void 0:O.length)||0})}});const N=Array.from(w.values()).sort((T,R)=>T.date<R.date?1:-1),S={};v.forEach(T=>{if(T.exists()){const R=T.data();Array.isArray(R.moods)&&R.moods.forEach(O=>{S[O.text]=(S[O.text]||0)+1})}});const E=Object.entries(S).map(([T,R])=>({name:T,value:R})).sort((T,R)=>R.value-T.value).slice(0,5),k=N.filter(T=>T.words>0).length,D=k>0?Math.round(N.reduce((T,R)=>T+R.words,0)/k):0;r({entries:N,moodStats:E,totalEntries:k,averageWords:D})}catch(h){console.error("Error al cargar estadsticas del diario:",h),c(h instanceof Error?h.message:"Error al cargar estadsticas")}finally{i(!1)}}})()},[u,t,s]),{stats:n,loading:a,error:o}},Vb=["#8884d8","#82ca9d","#ffc658","#ff8042","#a4de6c"],xU=()=>{const[t,s]=f.useState(new Date),[n,r]=f.useState(Pa(new Date)),[a,i]=f.useState(Rr(new Date)),{user:o}=Je(),{stats:c,loading:u,error:d}=pU(n,a),h=(p,g)=>{r(p),i(g)};return o?e.jsxs(ln,{children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Diario Personal"}),e.jsx("p",{className:"text-gray-500",children:"Escribe y reflexiona sobre tus experiencias diarias"})]}),e.jsx(La,{selectedDate:t,onChange:s}),e.jsxs(ma,{defaultValue:"entry",className:"space-y-4",children:[e.jsxs(ha,{children:[e.jsx(Ds,{value:"entry",children:"Entrada Diaria"}),e.jsx(Ds,{value:"analytics",children:"Anlisis"}),e.jsx(Ds,{value:"settings",children:"Configuracin"})]}),e.jsx(ys,{value:"entry",className:"space-y-4",children:e.jsx(hU,{selectedDate:t})}),e.jsxs(ys,{value:"analytics",className:"space-y-4",children:[e.jsx(fU,{onPeriodChange:h}),u||!c?e.jsx("div",{className:"p-4",children:"Cargando estadsticas..."}):d?e.jsx("div",{className:"p-4 text-red-500",children:"Error al cargar estadsticas"}):e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsx(Ce,{children:e.jsxs(Ae,{className:"pt-6",children:[e.jsx("h3",{className:"font-medium mb-4",children:"Actividad de Escritura"}),e.jsx("div",{className:"h-64",children:e.jsx(On,{width:"100%",height:"100%",children:e.jsxs(Pm,{data:c.entries,children:[e.jsx(Aa,{strokeDasharray:"3 3"}),e.jsx(Qr,{dataKey:"date"}),e.jsx(_r,{}),e.jsx(Pn,{}),e.jsx(ai,{}),e.jsx(Xc,{dataKey:"words",name:"Palabras",fill:"#8884d8"})]})})})]})}),e.jsx(Ce,{children:e.jsxs(Ae,{className:"pt-6",children:[e.jsx("h3",{className:"font-medium mb-4",children:"Estados de nimo Frecuentes"}),e.jsx("div",{className:"h-64",children:e.jsx(On,{width:"100%",height:"100%",children:e.jsxs(hd,{children:[e.jsx(fd,{data:c.moodStats,nameKey:"name",dataKey:"value",cx:"50%",cy:"50%",outerRadius:80,label:!0,children:c.moodStats.map((p,g)=>e.jsx(pd,{fill:Vb[g%Vb.length]},p.name))}),e.jsx(Pn,{}),e.jsx(ai,{})]})})})]})}),e.jsx(Ce,{children:e.jsxs(Ae,{className:"pt-6",children:[e.jsx("h3",{className:"font-medium mb-4",children:"Estadsticas Generales"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total de entradas"}),e.jsx("p",{className:"text-2xl font-bold",children:c.totalEntries})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Promedio de palabras"}),e.jsx("p",{className:"text-2xl font-bold",children:c.averageWords})]})]})]})}),e.jsx(Ce,{children:e.jsxs(Ae,{className:"pt-6",children:[e.jsx("h3",{className:"font-medium mb-4",children:"Sugerencias"}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[e.jsx("p",{children:" Escribe regularmente para mantener un mejor seguimiento de tus emociones"}),e.jsx("p",{children:" Registra tu estado de nimo junto con tus entradas del diario"}),e.jsx("p",{children:" Revisa tus entradas anteriores para identificar patrones"}),e.jsx("p",{children:" Usa las estadsticas para entender mejor tus hbitos de escritura"})]})]})})]})]}),e.jsx(ys,{value:"settings",className:"space-y-4",children:e.jsxs(Ce,{children:[e.jsx(Ae,{className:"pt-6",children:e.jsx("h3",{className:"font-medium mb-4",children:"Configuracin del Diario"})}),"          "]})})]})]}):e.jsx(ln,{children:e.jsx("div",{className:"text-center py-8",children:e.jsx("h2",{className:"text-xl font-semibold",children:"Inicia sesin para acceder a tu diario"})})})},Gb=[{tab:"list",label:"Lista",icon:e.jsx(_O,{className:"h-4 w-4"})},{tab:"kanban",label:"Kanban",icon:e.jsx(RO,{className:"h-4 w-4"})},{tab:"week",label:"Calendario",icon:e.jsx(ns,{className:"h-4 w-4"})},{tab:"analytics",label:"Anlisis",icon:e.jsx(ax,{className:"h-4 w-4"})}],qp=({title:t,actions:s=[],className:n,currentTab:r="list",onTabChange:a})=>{const{shouldShowDesktopNav:i}=vd();return e.jsx("div",{className:ce("",n),children:e.jsx("div",{className:ce(i?"container mx-auto":"mx-auto px-4 w-full"),children:e.jsxs("div",{className:"bg-background/50 flex items-center justify-between gap-2 py-4 backdrop-blur-md lg:mt-4 lg:rounded-2xl lg:border lg:px-4",children:[e.jsx("div",{className:"flex items-center gap-5",children:e.jsxs("div",{className:"flex items-center gap-12",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg shadow-sm",children:e.jsx(rx,{className:"h-4 w-4 text-white"})}),e.jsx("h2",{className:"text-lg font-bold text-foreground",children:t})]}),e.jsx("nav",{className:"hidden lg:flex gap-2 lg:gap-4",children:Gb.map(o=>{const c=r===o.tab;return e.jsxs("button",{onClick:()=>a==null?void 0:a(o.tab),className:ce("flex items-center space-x-3 px-4 py-3 rounded-xl text-sm font-medium transition-all duration-200 group","hover:bg-white/90 hover:shadow-lg",c?"bg-white text-blue-700 shadow-lg border border-blue-200":"text-gray-700 hover:text-gray-900"),children:[e.jsx("span",{className:ce("p-1.5 rounded-lg transition-colors",c?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-600 group-hover:bg-gray-200"),children:o.icon}),e.jsx("span",{className:"whitespace-nowrap",children:o.label})]},o.tab)})})]})}),s.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(Mr,{children:e.jsx("div",{className:"hidden lg:flex items-center gap-2",children:s.map(o=>o.dropdown?e.jsxs(oa,{children:[e.jsxs(Hs,{children:[e.jsx(Us,{asChild:!0,children:e.jsx(la,{asChild:!0,children:e.jsxs($,{variant:"ghost",size:"sm",className:ce(o.showLabel?"h-8 px-3 gap-2":"h-8 w-8 p-0",o.className),children:[o.icon,o.showLabel?e.jsx("span",{className:"text-sm font-medium",children:o.label}):e.jsx("span",{className:"sr-only",children:o.label})]})})}),e.jsx(Ls,{children:e.jsx("p",{children:o.tooltip})})]}),e.jsx(Pr,{align:"end",children:o.dropdown.map((c,u)=>e.jsx(Ft,{onClick:c.onClick,children:c.label},u))})]},o.id):e.jsxs(Hs,{children:[e.jsx(Us,{asChild:!0,children:e.jsxs($,{variant:"ghost",size:"sm",className:ce(o.showLabel?"h-8 px-3 gap-2":"h-8 w-8 p-0",o.className),onClick:o.onClick,children:[o.icon,o.showLabel?e.jsx("span",{className:"text-sm font-medium",children:o.label}):e.jsx("span",{className:"sr-only",children:o.label})]})}),e.jsx(Ls,{children:e.jsx("p",{children:o.tooltip})})]},o.id))})}),e.jsxs(oa,{children:[e.jsx(la,{asChild:!0,children:e.jsxs($,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 lg:hidden",children:[e.jsx(gd,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Opciones"})]})}),e.jsxs(Pr,{align:"end",className:"w-56",children:[Gb.map(o=>e.jsxs(Ft,{onClick:()=>a==null?void 0:a(o.tab),className:ce("flex items-center gap-2",r===o.tab&&"bg-accent font-medium"),children:[o.icon,e.jsx("span",{children:o.label})]},o.tab)),e.jsx(Yl,{}),s.map(o=>o.dropdown?e.jsxs(Hz,{children:[e.jsxs(CC,{children:[o.icon,e.jsx("span",{className:"ml-2",children:o.label})]}),e.jsx(EC,{children:o.dropdown.map((c,u)=>e.jsx(Ft,{onClick:c.onClick,children:c.label},u))})]},o.id):e.jsxs(Ft,{onClick:o.onClick,children:[o.icon,e.jsx("span",{className:"ml-2",children:o.label})]},o.id))]})]})]})]})})})},qb=["#0088FE","#00C49F","#FFBB28","#FF8042"],Kb=()=>{const t=Qt(),s=Ln(),[n,r]=f.useState([]),[a,i]=f.useState([]),[o,c]=f.useState(!1),[u,d]=f.useState(""),[h,p]=f.useState(!1),[g,x]=f.useState(!1),y=f.useMemo(()=>{const Y=s.pathname;return Y.includes("/task/kanban")?"kanban":Y.includes("/task/list")?"list":Y.includes("/task/calendar")?"week":"list"},[s.pathname]),[b,v]=f.useState("list"),w=Y=>{if(Y==="week"){t("/task/calendar");return}if(Y==="kanban"){t("/task/kanban");return}if(Y==="list"){t("/task/list"),v("list");return}if(Y==="analytics"){t("/task/list"),v("analytics");return}},{user:N}=Je(),S=qo(),{tasks:E,showRecurrenceModal:k,currentTask:D,modalMode:T,addTask:R,editTask:O,completeRecurrentTask:U,setShowRecurrenceModal:I,openCreateModal:_}=S;f.useEffect(()=>{N&&M()},[N]);const M=async()=>{if(!N)return;const Y=xn(Bt(xe,"tasks"),Et("userId","==",N.uid),Xj(100)),se=(await gn(Y)).docs.map(le=>le.data()).sort((le,K)=>{var ge,Se,oe,J;const de=((Se=(ge=le.createdAt)==null?void 0:ge.toDate)==null?void 0:Se.call(ge))||new Date(0);return(((J=(oe=K.createdAt)==null?void 0:oe.toDate)==null?void 0:J.call(oe))||new Date(0)).getTime()-de.getTime()}),H=se.reduce((le,K)=>{var je,ge,Se,oe;const de=((oe=(Se=(ge=(je=K.createdAt)==null?void 0:je.toDate)==null?void 0:ge.call(je))==null?void 0:Se.toISOString)==null?void 0:oe.call(Se).split("T")[0])||"unknown";return le[de]||(le[de]={date:de,completed:0,pending:0}),le[de][K.completed?"completed":"pending"]++,le},{});r(Object.values(H));const ie=se.filter(le=>le.completed).length,fe=se.filter(le=>!le.completed).length;i([{name:"Completadas",value:ie},{name:"Pendientes",value:fe}])};if(!N)return e.jsxs("div",{className:"min-h-screen",children:[e.jsx(qp,{title:"Tareas",actions:[],currentTab:y,onTabChange:w}),e.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:e.jsx("div",{className:"text-center py-8",children:e.jsx("h2",{className:"text-xl font-semibold",children:"Inicia sesin para ver tus tareas"})})})]});const W=()=>{_()},B=()=>{c(!0)},P=()=>{try{const Y=JSON.parse(u);if(!Array.isArray(Y)){bt.error("El JSON debe contener un array de tareas");return}let X=0,se=0;Y.forEach(H=>{if(H.title){let ie;if(H.dueDate){const fe=new Date(H.dueDate);isNaN(fe.getTime())?(se++,console.warn(`Fecha invlida para tarea "${H.title}": ${H.dueDate}`)):ie=fe}console.log("Would import task:",{title:H.title,description:H.description||"",dueDate:ie,category:H.category||"personal",priority:H.priority||void 0,isPrivate:!1,isRecurrent:H.isRecurrent||!1,size:H.size||void 0}),X++}}),se>0?bt.warning(`${X} tareas procesadas. ${se} fechas invlidas fueron omitidas.`):bt.success(`${X} tareas procesadas correctamente`),d(""),c(!1)}catch(Y){bt.error("Error al importar las tareas. Verifica el formato JSON."),console.error("Error de importacin:",Y)}},z=()=>{bt.success("Funcionalidad de exportar - ser implementada")},G=()=>{},ae=[{id:"calendar",label:"Calendario",icon:e.jsx(ns,{className:"h-4 w-4"}),onClick:()=>t("/tasks/calendar"),tooltip:"Vista de calendario"},{id:"import",label:"Importar",icon:e.jsx(Bo,{className:"h-4 w-4"}),onClick:B,tooltip:"Importar tareas"},{id:"export",label:"Exportar",icon:e.jsx(br,{className:"h-4 w-4"}),onClick:z,tooltip:"Exportar tareas"},{id:"ai",label:"AI Assistant",icon:e.jsx(dw,{className:"h-4 w-4"}),onClick:G,tooltip:"Asistente IA",dropdown:[{label:"Sugerir tareas",onClick:()=>p(!0)},{label:"Repriorizar visibles",onClick:()=>x(!0)}]},{id:"new",label:"Nuevo",icon:e.jsx(cs,{className:"h-4 w-4"}),onClick:W,tooltip:"Crear nueva tarea",className:"bg-black text-white hover:bg-gray-800",showLabel:!0}];return e.jsxs("div",{className:"min-h-screen relative",children:[e.jsx(qp,{title:"Tareas",actions:ae,currentTab:y,onTabChange:w}),e.jsx($,{onClick:W,className:ce("fixed bottom-20 right-6 h-14 w-14 rounded-full shadow-lg hover:shadow-xl","transition-shadow z-50 lg:hidden bg-black text-white hover:bg-gray-800"),size:"icon",title:"Crear nueva tarea",children:e.jsx(cs,{className:"h-6 w-6"})}),e.jsxs("div",{className:"p-4",children:[S.error&&e.jsx("div",{className:"mb-4",children:e.jsx(ag,{error:S.error,onRetry:S.loadTasks,showClearCache:!0})}),y==="list"&&e.jsxs(ma,{value:b,onValueChange:Y=>w(Y),className:"space-y-4",children:[e.jsx(ys,{value:"list",className:"space-y-4",children:e.jsx(aU,{})}),e.jsx(ys,{value:"analytics",className:"space-y-4",children:e.jsxs("div",{className:"grid md:grid-cols-2 xl:grid-cols-2 gap-4 lg:gap-6 xl:gap-8 desktop-grid-responsive",children:[e.jsx(Ce,{className:"desktop-card-enhanced",children:e.jsxs(Ae,{className:"pt-6",children:[e.jsx("h3",{className:"font-medium mb-4",children:"Progreso de Tareas"}),e.jsx("div",{className:"h-64 lg:h-80",children:e.jsx(On,{width:"100%",height:"100%",children:e.jsxs(Oo,{data:n,children:[e.jsx(Aa,{strokeDasharray:"3 3"}),e.jsx(Qr,{dataKey:"date"}),e.jsx(_r,{}),e.jsx(Pn,{}),e.jsx(ai,{}),e.jsx(Ji,{type:"monotone",dataKey:"completed",name:"Completadas",stroke:"#8884d8"}),e.jsx(Ji,{type:"monotone",dataKey:"pending",name:"Pendientes",stroke:"#82ca9d"})]})})})]})}),e.jsx(Ce,{className:"desktop-card-enhanced",children:e.jsxs(Ae,{className:"pt-6",children:[e.jsx("h3",{className:"font-medium mb-4",children:"Estado General"}),e.jsx("div",{className:"h-64 lg:h-80",children:e.jsx(On,{width:"100%",height:"100%",children:e.jsxs(hd,{children:[e.jsx(fd,{data:a,cx:"50%",cy:"50%",labelLine:!1,outerRadius:80,fill:"#8884d8",dataKey:"value",label:({cx:Y,cy:X,midAngle:se,innerRadius:H,outerRadius:ie,percent:fe,name:le})=>{const K=Math.PI/180,de=25+H+(ie-H),je=Y+de*Math.cos(-se*K),ge=X+de*Math.sin(-se*K);return e.jsx("text",{x:je,y:ge,fill:"#888",textAnchor:je>Y?"start":"end",dominantBaseline:"central",children:`${le} (${(fe*100).toFixed(0)}%)`})},children:a.map(Y=>e.jsx(pd,{fill:qb[Y%qb.length]},`cell-${Y}`))}),e.jsx(Pn,{})]})})})]})})]})})]}),y==="kanban"&&e.jsx("div",{className:"space-y-4",children:e.jsx(rU,{})})]}),e.jsx(c1,{tasks:E,open:h,onOpenChange:p}),e.jsx(d1,{tasks:E,onUpdate:O,open:g,onOpenChange:x}),e.jsx(Gl,{isOpen:k,onClose:()=>I(),onConfirm:Y=>{T==="complete"?U(Y):T==="edit"?O(D.id,Y):R(Y)},task:D||{id:"",taskCode:0,title:"",completed:!1,category:"personal",createdAt:{seconds:Date.now()/1e3}},mode:T}),e.jsx(kt,{open:o,onOpenChange:c,children:e.jsxs(wt,{className:"max-w-4xl",children:[e.jsxs(At,{children:[e.jsx(_t,{children:"Importar Tareas"}),e.jsx(cn,{children:"Pega el JSON con las tareas a importar. Puedes incluir fechas en varios formatos."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(It,{placeholder:`Ejemplo - Importa tareas con fechas en diferentes formatos:
[
  {
    "title": "Completar proyecto importante",
    "description": "Terminar la implementacin",
    "dueDate": "2024-12-31",
    "category": "work",
    "priority": "do",
    "size": "grande"
  },
  {
    "title": "Revisin mdica anual", 
    "description": "Chequeo general de salud",
    "dueDate": "2024-07-15T09:00:00Z",
    "category": "health",
    "priority": "decide"
  },
  {
    "title": "Tarea flexible",
    "description": "Esta tarea no tiene fecha lmite especfica",
    "category": "personal",
    "isRecurrent": true
  }
]

Formatos de fecha soportados:
- "2024-12-31" (solo fecha)
- "2024-06-15T14:30:00Z" (fecha y hora ISO)
- "2024-06-15T14:30:00" (fecha y hora local)
- Sin campo "dueDate" = sin fecha asignada

Campos opcionales:
- description, dueDate, priority, size, isRecurrent`,value:u,onChange:Y=>d(Y.target.value),rows:20,className:"font-mono text-sm"}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx($,{variant:"outline",onClick:()=>c(!1),children:"Cancelar"}),e.jsx($,{onClick:P,disabled:!u.trim(),children:"Importar Tareas"})]})]})]})})]})},gU=()=>{const[t,s]=VP(),n=Qt(),[r,a]=f.useState(!1),[i,o]=f.useState(""),[c,u]=f.useState(!1),[d,h]=f.useState(!1),[p,g]=f.useState(null),[x,y]=f.useState(!1),{user:b}=Je(),v=qo(),{tasks:w,showRecurrenceModal:N,currentTask:S,modalMode:E,addTask:k,editTask:D,deleteTask:T,toggleTask:R,completeRecurrentTask:O,setShowRecurrenceModal:U,openCreateModal:I,openEditModal:_,error:M,resync:W}=v,B=t.get("search")||"",P=ee.useMemo(()=>{const K=t.get("categories");return K?K.split(",").filter(de=>Object.values(Cd).includes(de)):[]},[t]),z=K=>{const de={};K.trim()&&(de.search=K),P.length>0&&(de.categories=P.join(",")),s(Object.keys(de).length>0?de:{})},G=K=>{const de={};B.trim()&&(de.search=B),K.length>0&&(de.categories=K.join(",")),s(Object.keys(de).length>0?de:{})},ae=ee.useMemo(()=>{let K=P.length>0?w.filter(de=>P.includes(de.category)):w;if(B.trim()){const de=B.toLowerCase().trim();K=K.filter(je=>je.title.toLowerCase().includes(de)||je.description&&je.description.toLowerCase().includes(de))}return K},[w,P,B]);if(!b)return e.jsxs("div",{className:"min-h-screen p-4",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs($,{variant:"ghost",size:"sm",onClick:()=>n("/task"),className:"flex items-center gap-2",children:[e.jsx(El,{className:"w-4 h-4"}),"Volver"]}),e.jsx("h1",{className:"text-2xl font-bold",children:"Calendario de Tareas"})]}),e.jsx(Ce,{children:e.jsx(Ae,{className:"p-8 text-center",children:e.jsx("p",{children:"Inicia sesin para ver tu calendario de tareas"})})})]});const Y=()=>{I()},X=()=>{a(!0)},se=()=>{try{const K=JSON.parse(i);if(!Array.isArray(K)){bt.error("El JSON debe contener un array de tareas");return}let de=0,je=0;K.forEach(ge=>{if(typeof ge.title=="string"){let Se,oe;if(ge.startDate||ge.dueDate){const J=ge.startDate||ge.dueDate,ye=new Date(J);isNaN(ye.getTime())?(je++,console.warn(`Fecha invlida para tarea "${ge.title}": ${J}`)):Se=ye}if(ge.endDate){const J=new Date(ge.endDate);isNaN(J.getTime())?(je++,console.warn(`Fecha de fin invlida para tarea "${ge.title}": ${ge.endDate}`)):oe=J}k({title:ge.title,description:ge.description||"",startDate:Se,endDate:oe,category:ge.category||"personal",priority:ge.priority||void 0,isPrivate:!1,isRecurrent:!!ge.isRecurrent||!1,size:ge.size||void 0}),de++}}),je>0?bt.warning(`${de} tareas importadas. ${je} fechas invlidas fueron omitidas.`):bt.success(`${de} tareas importadas correctamente`),o(""),a(!1)}catch(K){bt.error("Error al importar las tareas. Verifica el formato JSON."),console.error("Error de importacin:",K)}},H=()=>{const K=w.map(oe=>{var J,ye;return{title:oe.title,description:oe.description||"",startDate:((J=oe.startDate)==null?void 0:J.toISOString())||null,endDate:((ye=oe.endDate)==null?void 0:ye.toISOString())||null,category:oe.category,priority:oe.priority||null,isRecurrent:oe.isRecurrent||!1,size:oe.size||null,completed:oe.completed}}),de=JSON.stringify(K,null,2),je=new Blob([de],{type:"application/json"}),ge=URL.createObjectURL(je),Se=document.createElement("a");Se.href=ge,Se.download=`tareas_${new Date().toISOString().split("T")[0]}.json`,Se.click(),URL.revokeObjectURL(ge),bt.success("Tareas exportadas correctamente")},ie=[{id:"back",label:"Volver",icon:e.jsx(El,{className:"h-4 w-4"}),onClick:()=>n("/task/list"),tooltip:"Volver a tareas"},{id:"import",label:"Importar",icon:e.jsx(Bo,{className:"h-4 w-4"}),onClick:X,tooltip:"Importar tareas"},{id:"export",label:"Exportar",icon:e.jsx(br,{className:"h-4 w-4"}),onClick:H,tooltip:"Exportar tareas"},{id:"ai",label:"AI Assistant",icon:e.jsx(dw,{className:"h-4 w-4"}),onClick:()=>{},tooltip:"Asistente IA",dropdown:[{label:"Sugerir tareas",onClick:()=>u(!0)},{label:"Repriorizar visibles",onClick:()=>h(!0)}]},{id:"new",label:"Nuevo",icon:e.jsx(cs,{className:"h-4 w-4"}),onClick:Y,tooltip:"Crear nueva tarea",className:"bg-black text-white hover:bg-gray-800",showLabel:!0}],fe=K=>{K==="list"?n("/task/list"):K==="kanban"?n("/task/kanban"):K==="week"?n("/task/calendar"):K==="analytics"&&n("/task/list")},le=()=>{const K=[];if(B&&K.push(`"${B}"`),P.length>0){const de=P.map(je=>Qs[je]).join(", ");K.push(de)}return K.length>0?`Calendario - ${K.join(" | ")}`:"Calendario de Tareas"};return e.jsxs("div",{className:"min-h-screen relative",children:[e.jsx(qp,{title:le(),actions:ie,currentTab:"week",onTabChange:fe}),e.jsx($,{onClick:Y,className:ce("fixed bottom-20 right-6 h-14 w-14 rounded-full shadow-lg hover:shadow-xl","transition-shadow z-50 lg:hidden bg-black text-white hover:bg-gray-800"),size:"icon",title:"Crear nueva tarea",children:e.jsx(cs,{className:"h-6 w-6"})}),e.jsxs("div",{className:"p-4",children:[M&&e.jsx("div",{className:"mb-4",children:e.jsx(ag,{error:M,onRetry:W,showClearCache:!0})}),e.jsx(Ce,{children:e.jsx(Ae,{className:"p-6",children:e.jsx(nU,{tasks:ae,onDelete:T,onEdit:_,onToggle:R,onQuickUpdate:K=>{D(K.id,{endDate:K.endDate})},onView:K=>{g(K),y(!0)},onMove:(K,de)=>{const je=w.find(Se=>Se.id===K);if(!je)return;if(!de){D(K,{startDate:void 0,endDate:void 0});return}const ge=nd(je.startDate,je.endDate,de);D(K,{startDate:de,endDate:ge})},searchQuery:B,onSearchChange:z,selectedCategories:P,onCategoriesChange:G})})})]}),e.jsx(c1,{tasks:w,open:c,onOpenChange:u}),e.jsx(d1,{tasks:w,onUpdate:D,open:d,onOpenChange:h}),e.jsx(Gl,{isOpen:N,onClose:()=>U(),onConfirm:K=>{E==="complete"?O(K):E==="edit"?D(S.id,K):k(K)},task:S||{id:"",taskCode:0,title:"",completed:!1,category:"personal",createdAt:{seconds:Date.now()/1e3}},mode:E}),e.jsx(kt,{open:r,onOpenChange:a,children:e.jsxs(wt,{className:"max-w-4xl",children:[e.jsxs(At,{children:[e.jsx(_t,{children:"Importar Tareas"}),e.jsx(cn,{children:"Pega el JSON con las tareas a importar."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(It,{placeholder:"Pega aqu el JSON con las tareas a importar...",value:i,onChange:K=>o(K.target.value),rows:10,className:"font-mono text-sm"}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx($,{variant:"outline",onClick:()=>a(!1),children:"Cancelar"}),e.jsx($,{onClick:se,disabled:!i.trim(),children:"Importar Tareas"})]})]})]})}),e.jsx(sh,{task:p,isOpen:x,onClose:()=>y(!1),onEdit:K=>{y(!1),_(K)},onToggle:R})]})},vU=({view:t,onViewChange:s})=>e.jsxs("div",{className:"flex gap-2",children:[e.jsxs($,{variant:t==="weekly"?"default":"outline",size:"sm",onClick:()=>s("weekly"),className:"gap-2",children:[e.jsx(ns,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Semanal"})]}),e.jsxs($,{variant:t==="graph"?"default":"outline",size:"sm",onClick:()=>s("graph"),className:"gap-2",children:[e.jsx(uw,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Anual"})]})]}),B1=(t=new Date)=>{const s=new Date(t);let n=s.getDay();n=n===0?6:n-1;const r=[];for(let a=0;a<7;a++){const i=new Date(s);i.setDate(s.getDate()-n+a),r.push({dayName:["L","M","X","J","V","S","D"][a],fullDate:Ie(i)})}return r},Jb={morning:{icon:hw,title:"Maana",defaultOpen:()=>{const t=new Date().getHours();return t>=5&&t<12}},afternoon:{icon:dp,title:"Tarde",defaultOpen:()=>{const t=new Date().getHours();return t>=12&&t<18}},night:{icon:mw,title:"Noche",defaultOpen:()=>{const t=new Date().getHours();return t>=18||t<5}},anytime:{icon:dp,title:"Cualquier momento",defaultOpen:()=>!1}},yU=t=>t>=.9?"Increble! Sigue as! ":t>=.7?"Vas muy bien! No pares! ":t>=.5?"Buen progreso! Sigue adelante! ":t>=.3?"Cada pequeo paso cuenta! ":"Hoy es un buen da para empezar! ",bU=(t,s)=>{const n=new Date;let r=0;for(let a=0;a<30;a++){const i=new Date(n);i.setDate(i.getDate()-a);const o=Ie(i);if(t.every(u=>s[`${u.id}_${o}`]))r++;else if(a<7)break}return r},H1=({children:t,completedHabits:s})=>{const[n,r]=f.useState(()=>Object.entries(Jb).filter(([o,c])=>c.defaultOpen()).map(([o])=>o)),a=ee.useMemo(()=>vn.reduce((o,c)=>(o[c.timeOfDay]||(o[c.timeOfDay]=[]),o[c.timeOfDay].push(c),o),{}),[]),i=o=>{const c=B1(),u=Ie(),d=o.filter(g=>s[`${g.id}_${u}`]).length;let h=0;const p=o.length*c.length;return c.forEach(g=>{o.forEach(x=>{s[`${x.id}_${g.fullDate}`]&&h++})}),{daily:{completed:d,total:o.length},weekly:{completed:h,total:p}}};return e.jsx(Yx,{type:"multiple",value:n,onValueChange:r,className:"w-full space-y-4",children:Object.entries(a).map(([o,c])=>{const u=Jb[o],d=u.icon,h=i(c),p=bU(c,s),g=h.daily.completed/h.daily.total;return e.jsxs(Zm,{value:o,className:"rounded-lg border border-gray-200 overflow-hidden",children:[e.jsx(Qm,{className:"w-full px-6 py-4 flex items-center justify-between text-left hover:bg-muted focus:outline-none focus:ring-2 focus:ring-ring data-[state=closed]:rounded-b-lg data-[state=open]:border-b",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:u.title}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["Hoy: ",h.daily.completed,"/",h.daily.total]}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Semana: ",h.weekly.completed,"/",h.weekly.total]}),p>0&&e.jsxs("div",{className:"flex items-center gap-1 text-amber-500",children:[e.jsx(Zc,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:p})]})]})]})}),e.jsx(eh,{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-6",children:[t(c),e.jsxs("div",{className:"pt-2 space-y-3 border-t border-gray-100",children:[e.jsx(lr,{value:h.daily.completed/h.daily.total*100,className:"h-2"}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:yU(g)}),h.daily.completed===h.daily.total&&e.jsxs("div",{className:"flex items-center gap-1 text-green-500",children:[e.jsx(iw,{className:"w-4 h-4"}),e.jsx("span",{children:"Completado!"})]})]})]})]})})]},o)})})},jU=({completedHabits:t,onToggle:s,disabled:n})=>{const r=B1(new Date),a=i=>e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"min-w-[480px] sm:min-w-[600px]",children:e.jsxs("div",{className:"grid grid-cols-[minmax(80px,140px)_repeat(7,minmax(32px,1fr))] sm:grid-cols-[minmax(120px,180px)_repeat(7,minmax(40px,1fr))] gap-1 sm:gap-2",children:[e.jsx("div",{}),r.map(o=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium text-xs sm:text-sm",children:o.dayName}),e.jsx("div",{className:"text-[9px] sm:text-[10px] text-gray-400",children:o.fullDate.split("-").slice(1).join("/")})]},o.fullDate)),i.map(o=>e.jsxs(ee.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 pr-1",children:[e.jsx("span",{className:"text-sm sm:text-base shrink-0",children:o.icon}),e.jsxs("div",{className:"flex flex-col min-w-0 flex-1",children:[e.jsx("span",{className:"text-xs sm:text-sm font-medium truncate leading-tight",children:o.name}),e.jsx("span",{className:"text-[10px] sm:text-xs text-gray-500 truncate leading-tight",children:o.goal})]})]}),r.map(c=>{const u=t[`${o.id}_${c.fullDate}`];return e.jsx($,{variant:u?"default":"outline",className:`h-8 w-8 sm:h-10 sm:w-10 p-0 aspect-square rounded-lg flex items-center justify-center transition-colors mx-auto my-0.5 sm:my-1
                      ${u?eN[o.id]:"border-gray-300"}`,onClick:()=>s(o.id,c.fullDate),disabled:n,children:u?e.jsx(aa,{className:"w-4 h-4 sm:w-5 sm:h-5 text-white"}):null},`${o.id}_${c.fullDate}`)})]},o.id))]})})});return e.jsx("div",{className:"w-full",children:e.jsx(H1,{completedHabits:t,children:a})})},U1=({year:t,renderCell:s})=>{const n=BI(t);return e.jsxs("div",{className:"inline-block min-w-full",children:[e.jsx("div",{className:"flex gap-1 mb-2 ml-8",children:n.map((r,a)=>e.jsx("div",{className:ce("text-xs text-gray-500 text-center",a===0?"w-8":"w-14"),style:{minWidth:a===0?"32px":`${Math.ceil(r.days/7)*12}px`},children:r.name.slice(0,3)},r.name))}),e.jsxs("div",{className:"flex gap-1",children:[e.jsxs("div",{className:"flex flex-col gap-1 text-xs text-gray-500 pr-2",children:[e.jsx("div",{className:"h-3"}),e.jsx("div",{className:"h-3 flex items-center",children:"L"}),e.jsx("div",{className:"h-3"}),e.jsx("div",{className:"h-3 flex items-center",children:"M"}),e.jsx("div",{className:"h-3"}),e.jsx("div",{className:"h-3 flex items-center",children:"V"}),e.jsx("div",{className:"h-3"})]}),e.jsx("div",{className:"flex gap-1",children:n.map(r=>{const a=String(r.number).padStart(2,"0"),i=new Date(t,r.number-1,1).getDay(),o=i===0?6:i-1,c=o+r.days,u=Math.ceil(c/7);return e.jsx("div",{className:"flex gap-1",children:Array.from({length:u},(d,h)=>e.jsx("div",{className:"flex flex-col gap-1",children:Array.from({length:7},(p,g)=>{const x=h*7+g-o+1;if(x<1||x>r.days)return e.jsx("div",{className:"w-3 h-3"},g);const y=String(x).padStart(2,"0"),b=`${t}-${a}-${y}`;return e.jsx(ee.Fragment,{children:s(b)},b)})},h))},r.name)})})]})]})},wU=({completedHabits:t,onToggle:s})=>{const n=new Date().getFullYear(),r=a=>e.jsx("div",{className:"space-y-8",children:a.map(i=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("span",{className:"text-xl",children:i.icon}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-base",children:i.name}),e.jsxs("span",{className:"text-sm text-gray-600 ml-2",children:["(",i.goal,")"]})]})]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsx(U1,{year:n,renderCell:o=>{const c=t[`${i.id}_${o}`],u=new Date().toISOString().split("T")[0]===o;return e.jsx($,{variant:"ghost",onClick:()=>s(i.id,o),className:ce("w-3 h-3 p-0 rounded-full border transition-all duration-200 hover:scale-110",c?"bg-green-600 border-green-700 hover:bg-green-700":"bg-gray-100 border-gray-200 hover:bg-gray-200 hover:border-gray-300",u&&"ring-2 ring-blue-400 ring-offset-1"),title:`${i.name} - ${new Date(o).toLocaleDateString("es-ES")}${c?" (Completado)":""}`})}}),e.jsxs("div",{className:"flex items-center gap-2 mt-4 text-xs text-gray-600",children:[e.jsx("span",{children:"Menos"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-100 border border-gray-200 rounded-full"}),e.jsx("div",{className:"w-3 h-3 bg-green-200 border border-green-300 rounded-full"}),e.jsx("div",{className:"w-3 h-3 bg-green-400 border border-green-500 rounded-full"}),e.jsx("div",{className:"w-3 h-3 bg-green-600 border border-green-700 rounded-full"})]}),e.jsx("span",{children:"Ms"})]})]})]},i.id))});return e.jsx("div",{className:"w-full",children:e.jsx(H1,{completedHabits:t,children:r})})},NU=()=>{const[t,s]=f.useState({}),[n,r]=f.useState("idle"),[a,i]=f.useState(null),{user:o}=Je(),c=f.useMemo(()=>Object.values(t).reduce((h,p)=>({...h,...p}),{}),[t]);f.useEffect(()=>{if(!o)return;const h=new Date,p=h.getFullYear(),g=h.getMonth()+1,x=`${p}-${String(g).padStart(2,"0")}`;(async()=>{try{Me.logRead("habits","useHabitData.loadCurrentMonth",`${o.uid}_${x}`);const v=ke(xe,"habits",`${o.uid}_${x}`),w=await ot(v);if(w.exists()){const N=w.data();s(S=>({...S,[x]:N.habits||{}})),r("saved")}else s(N=>({...N,[x]:{}})),r("idle")}catch(v){console.error("Error loading current month habits:",v),i(v instanceof Error?v.message:"Error loading habits"),r("error")}})(),(async()=>{const v=SU(h),w=Bt(xe,"habits");for(const N of v)if(N!==x)try{(await gn(xn(w,Et("userId","==",o.uid),Et("yearMonth","==",N)))).forEach(E=>{const k=E.data();s(D=>({...D,[N]:k.habits||{}}))})}catch(S){console.error(`Error fetching month ${N}:`,S)}})()},[o]);const u=async(h,p)=>{if(!o)return;r("saving"),i(null);const[g,x]=p.split("-"),y=`${g}-${x}`,b=`${h}_${p}`,v=t[y]||{},w={...v,[b]:!v[b]},N=ke(xe,"habits",`${o.uid}_${y}`);try{Me.logWrite("habits","useHabitData.toggleHabit",`${o.uid}_${y}`),await Zt(N,{userId:o.uid,yearMonth:y,habits:w,updatedAt:ht()},{merge:!0}),s(S=>({...S,[y]:w})),r("saved")}catch(S){i(S instanceof Error?S.message:"Error al guardar"),r("error")}},d=Ha("Habit data");return{completedHabits:c,status:n,error:a,toggleHabit:u,resync:d}},SU=t=>{const s=t.getFullYear(),n=t.getMonth()+1,r=[];for(let a=1;a<=n;a++){const i=String(a).padStart(2,"0");r.push(`${s}-${i}`)}return r},Jr=Lr("habit"),CU=Jr?`https://generativelanguage.googleapis.com/v1beta/models/${Jr.model}:generateContent`:"";Ht.setOptions({breaks:!0,gfm:!0});const EU=({completedHabits:t,open:s,onOpenChange:n})=>{var T,R;const[r,a]=f.useState(!1),i=s!==void 0?s:r,o=n??a,[c,u]=f.useState(""),[d,h]=f.useState(""),[p,g]=f.useState(!1),[x,y]=f.useState(0),b="AIzaSyAW4Ot-z7OH4ZR3OeaN7vcbkEDlWpo1aMY",v=((T=Jr==null?void 0:Jr.prompts)==null?void 0:T.predict)??"Analiza mis hbitos recientes y predice cules pueden fallar. Dame consejos para cumplirlos.",w=((R=Jr==null?void 0:Jr.prompts)==null?void 0:R.suggest)??"Sugiere nuevos hbitos basados en mis intereses y actividades.",N=Jr==null?void 0:Jr.params;f.useEffect(()=>{if(i){const O=E();h(`${v}
${w}
${O}`)}else h(""),u("")},[i,t]),f.useEffect(()=>{y(zr(d))},[d]);const S=O=>{try{const U=Ht.parse(O);return xi.sanitize(U)}catch(U){return console.error("Error procesando Markdown:",U),xi.sanitize(O.replace(/\n/g,"<br>"))}},E=()=>{const O={};let U=null,I=null;const _=new Set;Object.entries(t).forEach(([P,z])=>{const[G,ae]=P.split("_"),Y=parseInt(G,10);if(_.add(ae),(!U||ae<U)&&(U=ae),(!I||ae>I)&&(I=ae),z){const X=O[Y]||{success:0,fail:0};X.success+=1,O[Y]=X}});const M=Array.from(_).sort();vn.forEach(P=>{const z=O[P.id]||{success:0,fail:0};M.forEach(G=>{const ae=`${P.id}_${G}`;t[ae]||(z.fail+=1)}),O[P.id]=z});const W=U&&I?`Datos del ${U} al ${I}`:"Sin registros",B=vn.map(P=>{const z=O[P.id]||{success:0,fail:0};return`- ${P.name}: completado ${z.success} veces, no ejecutado ${z.fail} veces`}).join(`
`);return`${W}
${B}`},k=async()=>{var O,U,I,_,M;g(!0);try{const B=await(await fetch(`${CU}?key=${b}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:d}]}],...N})})).json(),P=(M=(_=(I=(U=(O=B==null?void 0:B.candidates)==null?void 0:O[0])==null?void 0:U.content)==null?void 0:I.parts)==null?void 0:_[0])==null?void 0:M.text;u(P||"No se pudo obtener sugerencia")}catch{u("Error al consultar la API")}finally{g(!1)}},D=()=>{o(!1),u(""),h(""),y(0)};return e.jsxs(kt,{open:i,onOpenChange:O=>O?o(!0):D(),children:[s===void 0&&e.jsxs($,{size:"sm",variant:"outline",onClick:()=>o(!0),className:"flex items-center gap-2",children:[e.jsx(Gs,{className:"w-4 h-4"}),"Analizar hbitos"]}),e.jsxs(wt,{className:"w-[95vw] h-[90vh] max-w-none max-h-none overflow-hidden flex flex-col sm:w-[90vw] sm:h-[85vh]",children:[e.jsxs(At,{className:"flex-shrink-0",children:[e.jsx(_t,{className:"text-xl",children:"Anlisis de Hbitos con IA"}),e.jsx(cn,{children:"La IA analizar tus hbitos recientes, predecir cules pueden fallar y te dar consejos personalizados. Usa el panel izquierdo para editar el prompt y visualiza el resultado en el panel derecho."})]}),e.jsxs("div",{className:"flex-1 flex flex-col sm:flex-row gap-4 min-h-0 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[e.jsxs("div",{className:"flex-1 flex flex-col mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2 flex-shrink-0",children:"Prompt para IA"}),e.jsx(It,{value:d,onChange:O=>h(O.target.value),className:"flex-1 resize-none min-h-0",placeholder:"Datos de hbitos para analizar..."})]}),e.jsxs("div",{className:"flex flex-col gap-3 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"text-gray-500",children:["Tokens: ",x]}),x>3500&&e.jsx("span",{className:"text-red-500 font-medium",children:"Prompt demasiado largo!"})]}),e.jsxs($,{onClick:k,disabled:p||!b||x>3500,className:"w-full flex items-center justify-center gap-2",size:"lg",children:[p&&e.jsx(fs,{className:"w-4 h-4 animate-spin"}),e.jsx(Gs,{className:"w-4 h-4"}),p?"Consultando IA...":"Obtener anlisis"]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 sm:border-l sm:border-gray-200 sm:pl-4 border-t sm:border-t-0 border-gray-200 pt-4 sm:pt-0",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Anlisis y sugerencias"}),c&&e.jsxs($,{type:"button",size:"sm",variant:"outline",onClick:()=>{navigator.clipboard.writeText(c),bt.success("Anlisis copiado al portapapeles")},className:"flex items-center gap-1",children:[e.jsx(da,{className:"w-4 h-4"}),"Copiar"]})]}),e.jsx("div",{className:"flex-1 flex flex-col min-h-0",children:e.jsx("div",{className:"flex-1 bg-gray-50 border border-gray-200 rounded-md p-4 overflow-auto",children:c?e.jsx("div",{className:`prose prose-sm max-w-none dark:prose-invert
                      prose-headings:text-foreground prose-p:text-foreground 
                      prose-strong:text-foreground prose-ul:text-foreground 
                      prose-ol:text-foreground prose-li:text-foreground
                      prose-code:bg-accent prose-code:px-1 prose-code:py-0.5 prose-code:rounded prose-code:text-foreground
                      prose-pre:bg-accent prose-pre:border prose-pre:text-foreground
                      prose-blockquote:border-l-accent prose-blockquote:text-foreground`,dangerouslySetInnerHTML:{__html:S(c)}}):p?e.jsx("div",{className:"text-sm text-gray-500",children:"Analizando tus hbitos..."}):e.jsx("div",{className:"text-sm text-gray-500",children:"El anlisis de tus hbitos aparecer aqu. La IA te dar predicciones sobre qu hbitos pueden fallar y consejos para cumplirlos mejor."})})})]})]}),e.jsx("div",{className:"flex-shrink-0 mt-4 pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 text-xs text-gray-500",children:[e.jsx("span",{children:" Tip: Mientras ms datos tengas registrados, mejores sern las predicciones"}),!b]})})]})]})},TU=({completedHabits:t})=>{const[s,n]=f.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs(oa,{children:[e.jsx(la,{asChild:!0,children:e.jsxs($,{size:"sm",variant:"outline",className:"flex items-center gap-2 text-blue-600",children:[e.jsx(Gs,{className:"w-4 h-4"}),"IA"]})}),e.jsx(Pr,{align:"end",children:e.jsx(Ft,{onSelect:()=>n(!0),children:"Analizar hbitos"})})]}),e.jsx(EU,{completedHabits:t,open:s,onOpenChange:n})]})},DU=()=>{const[t,s]=f.useState("weekly"),{user:n}=Je(),{completedHabits:r,status:a,error:i,toggleHabit:o,resync:c}=NU(),{isOnline:u}=ua();return n?e.jsxs(Ce,{className:"w-full",children:[e.jsxs(Ae,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"font-medium text-lg",children:"Hbitos"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(TU,{completedHabits:r}),e.jsx(vU,{view:t,onViewChange:s})]})]}),e.jsx("div",{className:"mb-4"}),t==="weekly"?e.jsx(jU,{completedHabits:r,onToggle:o,disabled:a==="saving"||!u}):e.jsx(wU,{completedHabits:r,onToggle:o}),i&&e.jsx("p",{className:"mt-4 text-sm text-red-500",children:i})]}),e.jsxs(In,{className:"justify-center gap-2 text-xs p-2",children:[a==="saving"&&e.jsx("span",{className:"text-blue-500",children:"Guardando..."}),a==="pending"&&e.jsx("span",{className:"text-yellow-600",children:"Pendiente de sincronizar"}),a==="saved"&&e.jsx("span",{className:"text-green-600",children:"Sincronizado"}),a==="error"&&e.jsx("span",{className:"text-red-600",children:"Error de sincronizacin"}),!u&&e.jsx("span",{className:"text-orange-600",children:"Offline"}),e.jsx($,{onClick:c,variant:"link",className:"p-0 h-auto text-xs",children:"Reintentar"})]})]}):e.jsx(Ce,{className:"w-full",children:e.jsx(Ae,{className:"p-4 text-center",children:e.jsx("p",{children:"Inicia sesin para registrar tus hbitos"})})})},kU=()=>{const[t,s]=f.useState(new Date),[n]=f.useState([]);return e.jsxs(ln,{children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Seguimiento de Hbitos"}),e.jsx("p",{className:"text-gray-500",children:"Registra y analiza tus hbitos diarios para mejorar tu estilo de vida"})]}),e.jsx(La,{selectedDate:t,onChange:s}),e.jsxs(ma,{defaultValue:"tracker",children:[e.jsxs(ha,{children:[e.jsx(Ds,{value:"tracker",children:"Registro Diario"}),e.jsx(Ds,{value:"analytics",children:"Anlisis"})]}),e.jsx(ys,{value:"tracker",children:e.jsx("div",{className:"grid grid-cols-1",children:e.jsx(DU,{selectedDate:t})})}),"        ",e.jsx(ys,{value:"analytics",className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-2 gap-4 lg:gap-6 xl:gap-8 desktop-grid-responsive",children:[e.jsx(Ce,{className:"desktop-card-enhanced",children:e.jsxs(Ae,{className:"p-4 lg:p-6",children:[e.jsx("h3",{className:"font-medium mb-4",children:"Tendencias de Hbitos"}),e.jsx("div",{className:"h-64 md:h-80 lg:h-96",children:e.jsx(On,{children:e.jsxs(Oo,{data:n,children:[e.jsx(Aa,{strokeDasharray:"3 3"}),e.jsx(Qr,{dataKey:"date"}),e.jsx(_r,{}),e.jsx(Pn,{}),e.jsx(ai,{}),vn.map(r=>e.jsx(Ji,{type:"monotone",dataKey:r.name,name:`${r.icon} ${r.name}`,stroke:`var(--${r.name.toLowerCase()}-color)`},r.id))]})})})]})}),e.jsx(Ce,{className:"desktop-card-enhanced",children:e.jsx(Ae,{className:"p-4 lg:p-6",children:e.jsx("h3",{className:"font-medium mb-4",children:"Resumen del Mes"})})})]})})]})]})},wn={breakfast:{icon:dp,title:"Desayuno",color:"bg-amber-100",hoverColor:"hover:bg-amber-200",order:1},morningSnack:{icon:hw,title:"Media Maana",color:"bg-orange-100",hoverColor:"hover:bg-orange-200",order:2},lunch:{icon:Qj,title:"Almuerzo",color:"bg-emerald-100",hoverColor:"hover:bg-emerald-200",order:3},afternoonSnack:{icon:OO,title:"Merienda",color:"bg-purple-100",hoverColor:"hover:bg-purple-200",order:4},dinner:{icon:mw,title:"Cena",color:"bg-indigo-100",hoverColor:"hover:bg-indigo-200",order:5}},yg={breakfast:8,morningSnack:11,lunch:14,afternoonSnack:17,dinner:20},AU=(t,s)=>{const[n,r,a]=t.split("-").map(Number);return new Date(n,r-1,a,yg[s]||0,0,0,0).getTime()<Date.now()},_U=(t=new Date)=>{const s=new Date(t);let n=s.getDay();n=n===0?6:n-1;const r=[];for(let a=0;a<7;a++){const i=new Date(s);i.setDate(s.getDate()-n+a),r.push({dayName:["L","M","X","J","V","S","D"][a],fullDate:Ie(i),isCurrentMonth:i.getMonth()===s.getMonth(),date:new Date(i)})}return r},RU=()=>{const t=new Date;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}`},OU=1,PU=1e6;let Qf=0;function MU(){return Qf=(Qf+1)%Number.MAX_SAFE_INTEGER,Qf.toString()}const ep=new Map,Xb=t=>{if(ep.has(t))return;const s=setTimeout(()=>{ep.delete(t),Yc({type:"REMOVE_TOAST",toastId:t})},PU);ep.set(t,s)},IU=(t,s)=>{switch(s.type){case"ADD_TOAST":return{...t,toasts:[s.toast,...t.toasts].slice(0,OU)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(n=>n.id===s.toast.id?{...n,...s.toast}:n)};case"DISMISS_TOAST":{const{toastId:n}=s;return n?Xb(n):t.toasts.forEach(r=>{Xb(r.id)}),{...t,toasts:t.toasts.map(r=>r.id===n||n===void 0?{...r,open:!1}:r)}}case"REMOVE_TOAST":return s.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(n=>n.id!==s.toastId)}}},Ju=[];let Xu={toasts:[]};function Yc(t){Xu=IU(Xu,t),Ju.forEach(s=>{s(Xu)})}function LU({...t}){const s=MU(),n=a=>Yc({type:"UPDATE_TOAST",toast:{...a,id:s}}),r=()=>Yc({type:"DISMISS_TOAST",toastId:s});return Yc({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:a=>{a||r()}}}),{id:s,dismiss:r,update:n}}function ih(){const[t,s]=f.useState(Xu);return f.useEffect(()=>(Ju.push(s),()=>{const n=Ju.indexOf(s);n>-1&&Ju.splice(n,1)}),[t]),{...t,toast:LU,dismiss:n=>Yc({type:"DISMISS_TOAST",toastId:n})}}const $U=(t,s)=>{const n=t[s];return n?Object.values(n).reduce((r,a)=>r+(a.calories||0),0):0},zU=({day:t,mealPlan:s,onOpenModal:n})=>{const r=new Date,a=new Date(t.fullDate),i=a.toDateString()===r.toDateString(),o=a<r&&!i,[c,u]=f.useState(!o),d=Object.keys(s[t.fullDate]||{}).length,h=Object.keys(wn).length,p=$U(s,t.fullDate);return e.jsxs("div",{className:`mx-2 my-3 rounded-xl shadow-sm border transition-all duration-200 ${o?"bg-gray-50 border-gray-200 opacity-75":"bg-white border-gray-100"}`,children:[e.jsxs("div",{className:`flex justify-between items-center p-4 ${o?"cursor-pointer hover:bg-gray-100":""} ${c?"border-b border-gray-100 rounded-t-xl":"rounded-xl"}`,onClick:o?()=>u(!c):void 0,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[o&&e.jsx("div",{className:"text-gray-400",children:c?e.jsx(Gn,{className:"w-4 h-4"}):e.jsx(Ma,{className:"w-4 h-4"})}),e.jsxs("h3",{className:`font-semibold text-base ${o?"text-gray-500":i?"text-blue-600":"text-gray-900"}`,children:[t.dayName,i&&" (Hoy)"]}),o&&!c&&e.jsxs("span",{className:"text-xs text-gray-400 bg-gray-100 px-2 py-1 rounded-md",children:[d,"/",h]})]}),e.jsx("span",{className:`text-sm px-2 py-1 rounded-md ${o?"text-gray-400 bg-gray-100":"text-gray-500 bg-gray-50"}`,children:t.fullDate.split("-").slice(1).join("/")})]}),c&&e.jsxs("div",{className:"p-4 pt-0 space-y-3",children:[Object.entries(wn).sort(([,g],[,x])=>g.order-x.order).map(([g,x])=>{var w;const y=(w=s[t.fullDate])==null?void 0:w[g],{color:b,hoverColor:v}=x;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex flex-col items-center w-12 shrink-0",children:[e.jsx(x.icon,{className:`w-5 h-5 mb-1 ${o?"text-gray-400":"text-gray-600"}`}),e.jsxs("span",{className:`text-xs text-center leading-tight ${o?"text-gray-400":"text-gray-500"}`,children:[yg[g],":00"]})]}),y?e.jsxs("div",{className:`flex-1 p-3 rounded-lg transition-all duration-200 cursor-pointer border active:scale-95 ${o?"bg-gray-100 border-gray-200 hover:bg-gray-150":`${b} ${v} border-gray-200`}`,onClick:()=>n(t.fullDate,g,y),children:[e.jsx("div",{className:`font-medium text-sm mb-1 line-clamp-1 ${o?"text-gray-500":"text-gray-900"}`,children:y.name}),y.calories&&e.jsxs("div",{className:`text-xs mb-1 font-medium ${o?"text-gray-400":"text-blue-600"}`,children:["Caloras aproximadas: ",y.calories," kcal"]}),y.notes&&e.jsx("div",{className:`text-xs line-clamp-2 mb-2 ${o?"text-gray-400":"text-gray-600"}`,children:y.notes}),y.recipe&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${o?"bg-gray-400":"bg-blue-500"}`}),e.jsx("span",{className:`text-xs ${o?"text-gray-400":"text-blue-600"}`,children:"Receta"})]})]}):e.jsxs($,{variant:"outline",disabled:o,className:`flex-1 justify-start border-dashed h-auto py-3 text-sm transition-all ${o?"border-gray-200 text-gray-400 bg-gray-50 cursor-not-allowed":"border-gray-300 text-gray-600 hover:bg-gray-50 active:scale-95"}`,onClick:()=>!o&&n(t.fullDate,g),children:[e.jsx(cs,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"truncate",children:o?"No agregado":`Agregar ${x.title.toLowerCase()}`})]})]},g)}),p>0&&e.jsx("div",{className:"mt-4 pt-3 border-t border-gray-200",children:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:`text-sm font-medium ${o?"text-gray-500":"text-blue-600"}`,children:["Total del da: ",p," kcal"]})})})]})]})},FU=({date:t,type:s,meal:n,disabled:r,onOpenModal:a})=>{const{color:i,hoverColor:o}=wn[s],c=AU(t,s);return n?e.jsxs("div",{className:`h-full p-2 rounded ${i} relative group cursor-pointer transition-all duration-200 ease-in-out hover:shadow-md ${c?"opacity-50 grayscale":""}`,onClick:()=>a(t,s,n),children:[e.jsx("p",{className:"text-sm font-medium line-clamp-2",children:n.name}),n.calories&&e.jsxs("p",{className:"text-xs text-blue-600 mt-1 font-medium",children:["Caloras aproximadas: ",n.calories," kcal"]}),n.notes&&e.jsx("p",{className:"text-xs text-gray-600 mt-1 line-clamp-2",children:n.notes}),n.recipe&&e.jsx("div",{className:"absolute bottom-1 right-1",children:e.jsx("div",{className:"w-2 h-2 bg-sky-500 rounded-full"})}),e.jsx("div",{className:`absolute inset-0 flex items-center justify-center 
        bg-background/75 opacity-0 group-hover:opacity-100 rounded transition-opacity ${o}`,children:e.jsx(Mm,{className:"h-4 w-4 text-gray-700"})})]}):e.jsx($,{variant:"outline",className:`w-full h-full border-dashed ${c?"opacity-50":""}`,onClick:()=>a(t,s),disabled:r,children:e.jsx(cs,{className:"h-4 w-4"})})},BU=(t,s)=>{const n=t[s];return n?Object.values(n).reduce((r,a)=>r+(a.calories||0),0):0},HU=({day:t,mealPlan:s,disabled:n,onOpenModal:r})=>{const a=BU(s,t.fullDate);return e.jsxs("div",{className:`px-2 ${t.isCurrentMonth?"":"bg-muted"}`,children:[e.jsxs("div",{className:"text-center py-2 border-b",children:[e.jsx("div",{className:"font-medium",children:t.dayName}),e.jsx("div",{className:"text-xs text-gray-500",children:t.fullDate.split("-").slice(1).join("/")})]}),Object.entries(wn).sort(([,i],[,o])=>i.order-o.order).map(([i])=>{var o;return e.jsx("div",{className:"h-32 py-2",children:e.jsx(FU,{date:t.fullDate,type:i,meal:(o=s[t.fullDate])==null?void 0:o[i],disabled:n,onOpenModal:r})},i)}),a>0&&e.jsx("div",{className:"text-center py-2 border-t border-gray-200 mt-2",children:e.jsxs("div",{className:"text-sm font-medium text-blue-600",children:["Total: ",a," kcal"]})})]})},Jl=()=>{const{user:t}=Je(),[s,n]=f.useState([]),[r,a]=f.useState("idle"),[i,o]=f.useState(null),c=f.useCallback(async()=>{if(!t){n([]);return}a("loading"),o(null);try{Me.logRead("shopping-list","useShoppingList.loadShoppingList");const g=xn(Bt(xe,"shopping-list"),Et("userId","==",t.uid)),x=await gn(g);if(x.empty){n([]),a("idle");return}const y=x.docs.map(b=>{const v=b.data();return{id:b.id,name:v.name||"",stock:v.stock||0,toBuy:v.toBuy||0,status:v.status||"to-buy",...v.price!==void 0&&{price:v.price},...v.category&&{category:v.category},...v.place&&{place:v.place},...v.consumeBy&&{consumeBy:v.consumeBy},...v.nextPurchase&&{nextPurchase:v.nextPurchase}}});n(y),a("idle")}catch(g){(g==null?void 0:g.code)==="permission-denied"?(o("Error de permisos - Verificar reglas de Firestore"),a("error")):(o(g instanceof Error?g.message:"Error al cargar"),a("error"),n([]))}},[t]);f.useEffect(()=>{c()},[c]);const u=async g=>{if(!t){o("Usuario no autenticado");return}a("saving"),o(null);try{const x=s.find(b=>b.name.toLowerCase()===g.name.toLowerCase());if(x){const b=x.stock+Number(g.stock);x.status==="low-stock"?await d(x.id,{stock:b}):x.status==="to-buy"?await d(x.id,{stock:b,status:"in-stock"}):await d(x.id,{stock:b}),a("idle");return}const y={userId:t.uid,name:g.name,stock:Number(g.stock),toBuy:Number(g.toBuy),status:g.status,createdAt:ht(),updatedAt:ht()};g.price!==void 0&&g.price!==null&&!isNaN(Number(g.price))&&(y.price=Number(g.price)),g.category&&typeof g.category=="string"&&g.category.trim()!==""&&(y.category=g.category.trim()),g.place&&typeof g.place=="string"&&g.place.trim()!==""&&(y.place=g.place.trim()),g.consumeBy&&typeof g.consumeBy=="string"&&g.consumeBy.trim()!==""&&(y.consumeBy=g.consumeBy.trim()),g.nextPurchase&&(y.nextPurchase=!0),Me.logWrite("shopping-list","useShoppingList.addItem"),await wl(Bt(xe,"shopping-list"),y),await c(),a("idle")}catch(x){const y=x instanceof Error?x.message:"Error al guardar";o(y),a("error")}},d=async(g,x)=>{if(!t){o("Usuario no autenticado");return}a("saving"),o(null);try{const y=ke(xe,"shopping-list",g),b={updatedAt:ht()};x.name!==void 0&&(b.name=x.name),x.stock!==void 0&&(b.stock=Number(x.stock)),x.toBuy!==void 0&&(b.toBuy=Number(x.toBuy)),x.status!==void 0&&(b.status=x.status),x.price!==void 0&&x.price!==null&&!isNaN(Number(x.price))&&(b.price=Number(x.price)),x.category!==void 0&&typeof x.category=="string"&&x.category.trim()!==""&&(b.category=x.category.trim()),x.place!==void 0&&typeof x.place=="string"&&x.place.trim()!==""&&(b.place=x.place.trim()),x.consumeBy!==void 0&&typeof x.consumeBy=="string"&&x.consumeBy.trim()!==""&&(b.consumeBy=x.consumeBy.trim()),x.nextPurchase!==void 0&&(b.nextPurchase=x.nextPurchase),Me.logWrite("shopping-list","useShoppingList.updateItem",g),await ar(y,b),await c(),a("idle")}catch(y){const b=y instanceof Error?y.message:"Error al actualizar";o(b),a("error")}};return{items:s,status:r,error:i,addItem:u,updateItem:d,deleteItem:async g=>{if(!t){o("Usuario no autenticado");return}a("saving"),o(null);try{Me.logDelete("shopping-list","useShoppingList.deleteItem",g),await Vo(ke(xe,"shopping-list",g)),await c(),a("idle")}catch(x){const y=x instanceof Error?x.message:"Error al eliminar";o(y),a("error")}},moveItem:(g,x)=>{d(g,{status:x})},loadShoppingList:c}},Xr=Lr("meal"),tp=Xr?`https://generativelanguage.googleapis.com/v1beta/models/${Xr.model}:generateContent`:"",UU=({selectedMeal:t,onFormChange:s,onOverwriteDay:n,mealName:r})=>{var H,ie,fe;const{items:a}=Jl(),[i,o]=f.useState(!1),[c,u]=f.useState(!1),[d,h]=f.useState(!1),[p,g]=f.useState(null),[x,y]=f.useState(""),[b,v]=f.useState(""),[w,N]=f.useState(0),[S,E]=f.useState(!1),[k,D]=f.useState(null),[T,R]=f.useState("meal"),O="AIzaSyAW4Ot-z7OH4ZR3OeaN7vcbkEDlWpo1aMY",U=((H=Xr==null?void 0:Xr.prompts)==null?void 0:H.meal)??"Genera una comida en formato JSON utilizando los ingredientes disponibles.",I=((ie=Xr==null?void 0:Xr.prompts)==null?void 0:ie.day)??"Genera todas las comidas del da en formato JSON.",_=Xr==null?void 0:Xr.params;f.useEffect(()=>{N(zr(x))},[x]);const M=()=>a.filter(K=>{if(K.category){const de=K.category.toLowerCase();if(["aseo","limpieza","cuidado personal","otro"].some(ge=>de.includes(ge)))return!1}return K.status==="in-stock"||K.status==="low-stock"}).map(K=>`${K.name} (${K.stock})`).join(", "),W=le=>{const K=M(),de=b.trim();if(le==="meal"){let je=`${U}
Dia: ${t.date}
Tipo: ${t.type}
Ingredientes: ${K}`;de&&(je+=`
Preferencias: ${de}`),je+=`
Devuelve JSON {"name":"","notes":"","recipe":""}`,y(je)}else{let je=`${I}
Dia completo: ${t.date}
Ingredientes: ${K}`;de&&(je+=`
Preferencias: ${de}`),je+=`
Devuelve JSON con llaves ${Object.keys(wn).join(", ")}.`,y(je)}g(le)},B=()=>{g(null),y(""),N(0),E(!1),D(null)},P=async()=>{p==="meal"?(R("meal"),await z(x)):p==="day"&&(R("day"),await G(x))},z=async le=>{var K,de,je,ge,Se;o(!0),E(!0),D(null);try{const oe=le,ye=await(await fetch(`${tp}?key=${O}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:oe}]}],..._})})).json(),gt=(((Se=(ge=(je=(de=(K=ye==null?void 0:ye.candidates)==null?void 0:K[0])==null?void 0:de.content)==null?void 0:je.parts)==null?void 0:ge[0])==null?void 0:Se.text)||"").match(/\{[\s\S]*\}/);if(gt){const dt=JSON.parse(gt[0]);D({name:dt.name||"",notes:dt.notes||"",recipe:dt.recipe||"",type:t.type})}}catch(oe){console.error("AI meal error",oe),D(null)}finally{o(!1)}},G=async le=>{var K,de,je,ge,Se;u(!0),E(!0),D(null);try{const oe=le,ye=await(await fetch(`${tp}?key=${O}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:oe}]}],..._})})).json(),gt=(((Se=(ge=(je=(de=(K=ye==null?void 0:ye.candidates)==null?void 0:K[0])==null?void 0:de.content)==null?void 0:je.parts)==null?void 0:ge[0])==null?void 0:Se.text)||"").match(/\{[\s\S]*\}/);if(gt){const dt=JSON.parse(gt[0]);D(dt)}}catch(oe){console.error("AI day error",oe),D(null)}finally{u(!1)}},ae=()=>{if(k){if(T==="meal"){const le=(k.name||"").trim();if(!le){console.error("AI generated meal without name");return}s("name",le),s("notes",k.notes||""),s("recipe",k.recipe||"")}else{const le={};Object.keys(wn).forEach(K=>{if(k[K]){const de=(k[K].name||"").trim();de&&(le[K]={type:K,name:de,notes:k[K].notes||"",recipe:k[K].recipe||""})}}),n(le)}B()}},Y=()=>{T==="meal"?z(x):G(x)},X=()=>{E(!1),D(null)},se=async()=>{var le,K,de,je,ge;if(!(!r||!O)){h(!0);try{const Se=`Estima las caloras aproximadas para una porcin normal de: "${r}". Responde solo con el nmero de caloras, sin texto adicional ni explicaciones.`,J=await(await fetch(`${tp}?key=${O}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:Se}]}],..._})})).json(),xt=(((ge=(je=(de=(K=(le=J==null?void 0:J.candidates)==null?void 0:le[0])==null?void 0:K.content)==null?void 0:de.parts)==null?void 0:je[0])==null?void 0:ge.text)||"").match(/(\d+)/);if(xt){const gt=parseInt(xt[1]);s("calories",gt.toString())}}catch(Se){console.error("Error estimating calories:",Se)}finally{h(!1)}}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(It,{placeholder:"Preferencias (opcional)",value:b,onChange:le=>v(le.target.value),className:"h-20"}),e.jsxs($,{type:"button",onClick:()=>W("meal"),disabled:i||!O,variant:"secondary",className:"w-full flex items-center gap-2",children:[i&&e.jsx(fs,{className:"w-4 h-4 animate-spin"}),e.jsx(ii,{className:"w-4 h-4"})," Generar comida"]}),e.jsxs($,{type:"button",onClick:()=>W("day"),disabled:c||!O,variant:"ghost",className:"w-full flex items-center gap-2",children:[c&&e.jsx(fs,{className:"w-4 h-4 animate-spin"}),e.jsx(ao,{className:"w-4 h-4"})," Regenerar da"]}),r&&e.jsxs($,{type:"button",onClick:se,disabled:d||!O||!r.trim(),variant:"outline",className:"w-full flex items-center gap-2",children:[d&&e.jsx(fs,{className:"w-4 h-4 animate-spin"}),e.jsx(ii,{className:"w-4 h-4"})," Estimar caloras"]}),(i||c||d)&&e.jsx($a,{className:"mt-2"})]}),e.jsx(kt,{open:p!==null,onOpenChange:le=>le?null:B(),children:e.jsxs(wt,{className:"w-[95vw] h-[90vh] max-w-none max-h-none overflow-hidden flex flex-col sm:w-[90vw] sm:h-[85vh]",children:[e.jsxs(At,{className:"flex-shrink-0",children:[e.jsx(_t,{className:"text-xl",children:p==="meal"?"Generar Comida con IA":"Regenerar Da Completo con IA"}),e.jsx(cn,{children:p==="meal"?"La IA generar una comida especfica basada en tus ingredientes disponibles y preferencias.":"La IA generar un plan completo del da con todas las comidas basndose en tus ingredientes disponibles."})]}),e.jsxs("div",{className:"flex-1 flex flex-col sm:flex-row gap-4 min-h-0 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[e.jsxs("div",{className:"flex-1 flex flex-col mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2 flex-shrink-0",children:"Prompt para IA"}),e.jsx(It,{value:x,onChange:le=>y(le.target.value),className:"flex-1 resize-none min-h-0",placeholder:"Instrucciones para generar comidas..."})]}),e.jsxs("div",{className:"flex flex-col gap-3 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"text-gray-500",children:["Tokens: ",w]}),w>3500&&e.jsx("span",{className:"text-red-500 font-medium",children:"Prompt demasiado largo!"})]}),!S&&e.jsxs($,{onClick:P,disabled:(p==="meal"?i:c)||!O||w>3500,className:"w-full flex items-center justify-center gap-2",size:"lg",children:[(p==="meal"?i:c)&&e.jsx(fs,{className:"w-4 h-4 animate-spin"}),e.jsx(ii,{className:"w-4 h-4"}),(p==="meal"?i:c)?"Generando...":"Generar comidas"]}),(i||c)&&e.jsx($a,{className:"mt-2"})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 sm:border-l sm:border-gray-200 sm:pl-4 border-t sm:border-t-0 border-gray-200 pt-4 sm:pt-0",children:[e.jsx("div",{className:"mb-3 flex items-center justify-between",children:e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:S?"Previsualizacin":"Informacin del proceso"})}),e.jsx("div",{className:"flex-1 flex flex-col min-h-0",children:S?e.jsxs("div",{className:"flex-1 flex flex-col space-y-4",children:[e.jsx("div",{className:"flex-1 overflow-auto",children:(i||c)&&!k?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full py-12 space-y-4",children:[e.jsx(fs,{className:"w-8 h-8 animate-spin text-blue-500"}),e.jsxs("div",{className:"text-center",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Generando ",T==="meal"?"comida":"plan del da","..."]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["La IA est creando tu ",T==="meal"?"comida personalizada":"plan completo del da"]})]})]}):k?T==="meal"?e.jsxs(Ce,{className:"h-full",children:[e.jsx(Kt,{className:"pb-3",children:e.jsxs(Gt,{className:"text-base flex items-center gap-2",children:[e.jsx(ii,{className:"w-4 h-4 text-blue-500"}),"Comida Generada"]})}),e.jsxs(Ae,{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Nombre:"}),e.jsx("p",{className:"text-sm mt-1",children:k.name||"Sin nombre"})]}),k.notes&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Notas:"}),e.jsx("p",{className:"text-sm mt-1 text-gray-600",children:k.notes})]}),k.recipe&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Receta:"}),e.jsx("div",{className:"text-sm mt-1 text-gray-600 bg-gray-50 p-3 rounded-md max-h-32 overflow-y-auto",children:e.jsx("pre",{className:"whitespace-pre-wrap font-sans",children:k.recipe})})]})]})]}):e.jsx("div",{className:"space-y-3",children:Object.keys(wn).map(le=>{var de;const K=k[le];return K?e.jsxs(Ce,{className:"border border-gray-200",children:[e.jsx(Kt,{className:"pb-2",children:e.jsxs(Gt,{className:"text-sm flex items-center gap-2",children:[e.jsx(ii,{className:"w-3 h-3 text-blue-500"}),(de=wn[le])==null?void 0:de.title]})}),e.jsxs(Ae,{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Nombre:"}),e.jsx("span",{className:"ml-1",children:K.name||"Sin nombre"})]}),K.notes&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Notas:"}),e.jsx("span",{className:"ml-1 text-gray-600",children:K.notes})]}),K.recipe&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Receta:"}),e.jsx("div",{className:"mt-1 text-gray-600 bg-gray-50 p-2 rounded text-xs max-h-16 overflow-y-auto",children:e.jsxs("pre",{className:"whitespace-pre-wrap font-sans",children:[K.recipe.substring(0,100),"..."]})})]})]})]},le):null})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full py-12 space-y-4",children:[e.jsx(Ws,{className:"w-8 h-8 text-red-500"}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Error al generar"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"No se pudo generar el contenido. Intenta nuevamente."})]})]})}),k&&e.jsxs("div",{className:"flex flex-col gap-2 pt-3 border-t",children:[e.jsxs($,{onClick:ae,className:"w-full gap-2",size:"sm",children:[e.jsx(Fa,{className:"w-4 h-4"}),"Insertar"]}),e.jsxs($,{onClick:Y,variant:"secondary",className:"w-full gap-2",size:"sm",disabled:i||c,children:[i||c?e.jsx(fs,{className:"w-4 h-4 animate-spin"}):e.jsx(ao,{className:"w-4 h-4"}),"Regenerar"]}),e.jsxs($,{onClick:X,variant:"outline",className:"w-full gap-2",size:"sm",children:[e.jsx(Ws,{className:"w-4 h-4"}),"Cancelar"]})]}),!k&&e.jsx("div",{className:"flex justify-center pt-3 border-t",children:e.jsxs($,{onClick:X,variant:"outline",className:"gap-2",size:"sm",children:[e.jsx(Ws,{className:"w-4 h-4"}),"Cancelar"]})})]}):e.jsx("div",{className:"flex-1 bg-gray-50 border border-gray-200 rounded-md p-4 overflow-auto",children:e.jsx("div",{className:"text-sm text-gray-700 space-y-3",children:p==="meal"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Tipo de comida:"})," ",(fe=wn[t.type])==null?void 0:fe.title]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Fecha:"})," ",t.date]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Ingredientes disponibles:"})," ",M()||"Ninguno disponible"]}),i||c?e.jsx("div",{className:"text-blue-600",children:" Generando comida personalizada..."}):e.jsx("div",{className:"text-gray-500",children:"La comida se generar y podrs previsualizarla antes de insertarla."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Fecha completa:"})," ",t.date]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Comidas a generar:"})," ",Object.values(wn).map(le=>le.title).join(", ")]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Ingredientes disponibles:"})," ",M()||"Ninguno disponible"]}),i||c?e.jsx("div",{className:"text-blue-600",children:" Generando plan completo del da..."}):e.jsx("div",{className:"text-gray-500",children:"Se generar el plan del da y podrs previsualizarlo antes de insertarlo."})]})})})})]})]}),e.jsxs("div",{className:"flex-shrink-0 mt-4 pt-3 border-t border-gray-200",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 text-xs text-gray-500",children:[e.jsx("span",{children:" Tip: Mantn tu lista de compras actualizada para mejores sugerencias"}),!O]}),e.jsx(Cn,{className:"flex justify-end gap-2 mt-3",children:e.jsx($,{type:"button",variant:"outline",onClick:B,children:"Cancelar"})})]})]})})]})},WU=({show:t,onClose:s,selectedMealInfo:n,formData:r,onFormChange:a,onSubmit:i,onDelete:o,onOverwriteDay:c,weekDays:u})=>{if(!n)return null;const d=async g=>{g.preventDefault();const x=g.currentTarget;if(!x.checkValidity()){x.reportValidity();return}await i()},h=u.find(g=>g.fullDate===n.date),p=!!n.meal;return e.jsx(kt,{open:t,onOpenChange:s,children:e.jsx(wt,{className:"sm:max-w-[700px]",children:e.jsxs("form",{onSubmit:d,children:[e.jsxs(At,{children:[e.jsx(_t,{children:p?"Editar Comida":"Agregar Comida"}),e.jsxs(cn,{children:[h==null?void 0:h.dayName," - ",n.date.split("-").slice(1).join("/")]})]}),e.jsxs("div",{className:"space-y-4 py-4 sm:grid sm:grid-cols-2 sm:gap-4 sm:space-y-0",children:[e.jsxs("div",{className:"space-y-1 sm:col-span-2",children:[e.jsx(ze,{htmlFor:"mealName",children:"Nombre de la Comida *"}),e.jsx(Fe,{id:"mealName",type:"text",value:r.name,onChange:g=>a("name",g.target.value),placeholder:"Ej: Ensalada Csar",required:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ze,{htmlFor:"mealNotes",children:"Notas Adicionales"}),e.jsx(Fe,{id:"mealNotes",type:"text",value:r.notes,onChange:g=>a("notes",g.target.value),placeholder:"Ej: Sin crutones"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ze,{htmlFor:"mealCalories",children:"Caloras Aproximadas"}),e.jsx(Fe,{id:"mealCalories",type:"number",min:"0",max:"9999",value:r.calories||"",onChange:g=>a("calories",g.target.value),placeholder:"450"})]}),e.jsxs("div",{className:"space-y-1 sm:col-span-2",children:[e.jsx(ze,{htmlFor:"mealRecipe",children:"Receta"}),e.jsx(It,{id:"mealRecipe",value:r.recipe,onChange:g=>a("recipe",g.target.value),placeholder:"Ingredientes y preparacin...",className:"h-40 resize-none"})]}),e.jsx("div",{className:"sm:col-span-2",children:e.jsx(UU,{selectedMeal:n,onFormChange:a,onOverwriteDay:g=>c(n.date,g),mealName:r.name})})]}),e.jsxs(Cn,{className:"flex flex-col sm:flex-row sm:justify-between gap-2",children:[e.jsx("div",{className:"flex-grow sm:flex-grow-0",children:p&&e.jsxs(Wa,{children:[e.jsx(yi,{asChild:!0,children:e.jsxs($,{type:"button",variant:"destructive",className:"w-full sm:w-auto",children:[e.jsx(oo,{className:"w-4 h-4 mr-2"}),"Eliminar"]})}),e.jsxs(fa,{children:[e.jsxs(pa,{children:[e.jsx(ga,{children:"Ests seguro?"}),e.jsx(va,{children:"Esta accin no se puede deshacer. Se eliminar permanentemente la comida."})]}),e.jsxs(xa,{children:[e.jsx(ba,{children:"Cancelar"}),e.jsx(ya,{onClick:o,children:"Eliminar"})]})]})]})}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-end justify-end",children:[e.jsxs("div",{children:[e.jsx(ze,{htmlFor:"mealType",className:"sr-only",children:"Tipo"}),e.jsxs(Tt,{value:r.type,onValueChange:g=>a("type",g),name:"mealType",required:!0,children:[e.jsx(vt,{id:"mealType",className:"sm:w-40 w-full",children:e.jsx(Dt,{placeholder:"Selecciona un tipo"})}),e.jsx(yt,{children:Object.entries(wn).sort(([,g],[,x])=>g.order-x.order).map(([g,{title:x}])=>e.jsx(Pe,{value:g,children:x},g))})]})]}),e.jsx($,{type:"button",variant:"outline",onClick:s,children:"Cancelar"}),e.jsx($,{type:"submit",disabled:!r.name,children:p?"Actualizar":"Agregar"})]})]})]})})})},YU=({mealPlan:t,onAddMeal:s,onRemoveMeal:n,disabled:r,selectedDate:a=new Date})=>{const{toast:i}=ih(),o=a,[c,u]=f.useState(!1),[d,h]=f.useState(null),[p,g]=f.useState({type:"breakfast",name:"",notes:"",recipe:"",calories:void 0}),x=_U(o),y=(S,E,k)=>{h({date:S,type:E,meal:k}),g({type:(k==null?void 0:k.type)||E,name:(k==null?void 0:k.name)||"",notes:(k==null?void 0:k.notes)||"",recipe:(k==null?void 0:k.recipe)||"",calories:k!=null&&k.calories?Number(k.calories):void 0}),u(!0)},b=(S,E)=>{g(k=>({...k,[S]:S==="calories"?E&&Number(E)||void 0:E}))},v=async()=>{if(d){if(!p.name||p.name.trim()===""){i({title:"Campo Requerido",description:"El nombre de la comida es obligatorio.",variant:"destructive"});return}try{d.meal&&d.meal.type!==p.type&&await n(d.date,d.meal.type),await s(d.date,p.type,{type:p.type,name:p.name.trim(),notes:p.notes,recipe:p.recipe,calories:p.calories}),u(!1)}catch(S){console.error("Error al guardar:",S),i({title:"Error al Guardar",description:"No se pudo guardar la comida.",variant:"destructive"})}}},w=async()=>{if(d!=null&&d.meal)try{await n(d.date,d.meal.type),u(!1)}catch(S){console.error("Error al eliminar:",S),i({title:"Error al Eliminar",description:"No se pudo eliminar la comida.",variant:"destructive"})}},N=async(S,E)=>{for(const[k,D]of Object.entries(E))await s(S,k,D);if(d){const k=E[d.type];k&&g({type:d.type,name:k.name,notes:k.notes||"",recipe:k.recipe||"",calories:k.calories?Number(k.calories):void 0})}};return e.jsxs("div",{className:"w-full h-full flex flex-col",children:[e.jsx("div",{className:"md:hidden flex-1 overflow-y-auto",children:e.jsxs("div",{className:"pb-20 px-2",children:[" ",x.map(S=>e.jsx(zU,{day:S,mealPlan:t,onOpenModal:y},S.fullDate))]})}),"      ",e.jsx("div",{className:"hidden md:block flex-1 overflow-auto",children:e.jsx("div",{className:"min-h-full p-4 lg:p-6 xl:p-8",children:e.jsxs("div",{className:"grid grid-cols-8 gap-2 lg:gap-4 xl:gap-6 min-w-[900px] lg:min-w-[1200px] xl:min-w-[1400px] h-full",children:[e.jsx("div",{className:"bg-gray-50 rounded-lg p-3 lg:p-4 xl:p-6",children:Object.entries(wn).sort(([,S],[,E])=>S.order-E.order).map(([S,E])=>e.jsx("div",{className:"h-32 lg:h-36 xl:h-40 flex items-center justify-center border-b border-gray-200 last:border-b-0",children:e.jsxs("div",{className:"flex flex-col items-center gap-2 text-center",children:[e.jsx(E.icon,{className:"h-6 w-6 lg:h-7 lg:w-7 xl:h-8 xl:w-8 text-gray-600"}),e.jsx("span",{className:"font-medium text-sm lg:text-base",children:E.title}),e.jsxs("span",{className:"text-xs lg:text-sm text-gray-500",children:[yg[S],":00"]})]})},S))}),x.map(S=>e.jsx(HU,{day:S,mealPlan:t,disabled:r,onOpenModal:y},S.fullDate))]})})}),e.jsx(WU,{show:c,onClose:()=>u(!1),selectedMealInfo:d,formData:p,onFormChange:b,onSubmit:v,onDelete:w,onOverwriteDay:N,weekDays:x})]})},VU=({onImport:t,disabled:s})=>{const{toast:n}=ih(),r=i=>!i||typeof i!="object"?!1:Object.entries(i).every(([o,c])=>!/^\d{4}-\d{2}-\d{2}$/.test(o)||!c||typeof c!="object"?!1:Object.entries(c).every(([d,h])=>!(!Object.keys(wn).includes(d)||!h||typeof h!="object"||typeof h.name!="string"||!h.name||h.notes&&typeof h.notes!="string"||h.recipe&&typeof h.recipe!="string"))),a=i=>{var u;const o=(u=i.target.files)==null?void 0:u[0];if(!o)return;const c=new FileReader;c.onload=async d=>{var h;try{const p=(h=d.target)==null?void 0:h.result,g=JSON.parse(p);if(!r(g))throw new Error("El formato del archivo no es vlido. Revisa la documentacin para ver el formato correcto.");await t(g)}catch(p){console.error("Error importing:",p),n({title:"Error de Importacin",description:p instanceof Error?p.message:"Formato invlido",variant:"destructive"})}},c.readAsText(o)};return e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",title:"Importar Plan",accept:"application/json",onChange:a,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",disabled:s}),e.jsxs($,{variant:"outline",size:"sm",className:"w-full",disabled:s,children:[e.jsx(Bo,{className:"h-4 w-4 mr-2"}),"Importar Plan"]})]})},GU=({onImport:t,disabled:s})=>{const[n,r]=f.useState(!1),[a,i]=f.useState(""),{toast:o}=ih(),c=d=>!d||typeof d!="object"?!1:Object.entries(d).every(([h,p])=>!/^\d{4}-\d{2}-\d{2}$/.test(h)||!p||typeof p!="object"?!1:Object.entries(p).every(([x,y])=>!(!Object.keys(wn).includes(x)||!y||typeof y!="object"||typeof y.name!="string"||!y.name||y.notes&&typeof y.notes!="string"||y.recipe&&typeof y.recipe!="string"))),u=async()=>{try{const d=JSON.parse(a);if(!c(d))throw new Error("El formato del JSON no es vlido. Revisa la documentacin para ver el formato correcto.");await t(d),i(""),r(!1)}catch(d){console.error("Error importing from text:",d),o({title:"Error de Importacin",description:d instanceof Error?d.message:"Formato invlido",variant:"destructive"})}};return e.jsxs(kt,{open:n,onOpenChange:r,children:[e.jsxs($,{variant:"outline",size:"sm",type:"button",onClick:()=>r(!0),disabled:s,children:[e.jsx(PO,{className:"h-4 w-4 mr-2"}),"Pegar JSON"]}),e.jsxs(wt,{children:[e.jsx(At,{children:e.jsx(_t,{children:"Pegar Plan de Comidas"})}),e.jsx(It,{value:a,onChange:d=>i(d.target.value),placeholder:"Pegue aqu el JSON del plan de comidas",className:"mt-4 min-h-[200px]"}),e.jsxs(Cn,{className:"gap-2 sm:gap-0",children:[e.jsx($,{type:"button",variant:"outline",onClick:()=>r(!1),className:"flex-1 sm:flex-none",children:"Cancelar"}),e.jsx($,{type:"button",onClick:u,className:"flex-1 sm:flex-none",disabled:!a.trim(),children:"Importar"})]})]})]})},W1=()=>{const[t,s]=f.useState({}),[n,r]=f.useState("idle"),[a,i]=f.useState(null),{user:o}=Je(),c=Object.values(t).reduce((x,y)=>({...x,...y}),{}),u=f.useCallback(async()=>{if(!o)return;r("loading"),i(null);const x=RU();try{let y={};Me.logRead("meals","useMealPlan.loadCurrentMonth");const b=ke(xe,"meals",`${o.uid}_${x}`),v=await ot(b);if(v.exists()){const S=v.data();y[x]=S.meals||{}}else y[x]={};const w=qU(),N=Bt(xe,"meals");for(const S of w)if(S!==x)try{Me.logRead("meals",`useMealPlan.loadMonth_${S}`);const E=xn(N,Et("userId","==",o.uid),Et("yearMonth","==",S)),k=await gn(E);k.empty?y[S]={}:k.forEach(D=>{const T=D.data();y[S]=T.meals||{}})}catch(E){console.error(`Error fetching month ${S}:`,E)}s(y),r("saved")}catch(y){console.error("Error loading meal plans:",y),i(y instanceof Error?y.message:"Error al cargar el plan"),r("error")}},[o]);f.useEffect(()=>{u()},[u]);const d=f.useCallback(async(x,y,b)=>{if(!o)return;if(!b.name||b.name.trim()==="")throw new Error("El nombre de la comida es obligatorio");r("saving"),i(null);const[v,w]=x.split("-"),N=`${v}-${w}`,S=`${x}_${y}`,E=t[N]||{};try{const k={...E,[x]:{...E[x],[y]:{id:S,...b,calories:b.calories}}};s(T=>({...T,[N]:k}));const D=ke(xe,"meals",`${o.uid}_${N}`);Me.logWrite("meals","useMealPlan.addMeal"),await Zt(D,{userId:o.uid,yearMonth:N,meals:k,updatedAt:ht()},{merge:!0}),r("saved")}catch(k){throw console.error("Error adding meal:",k),s(D=>({...D,[N]:E})),i(k instanceof Error?k.message:"Error al guardar"),r("error"),k}},[o,t]),h=f.useCallback(async(x,y)=>{if(!o)return;r("saving"),i(null);const[b,v]=x.split("-"),w=`${b}-${v}`,N=t[w]||{};try{const S=JSON.parse(JSON.stringify(N));if(S[x]){const k={...S[x]};delete k[y],Object.keys(k).length===0?delete S[x]:S[x]=k}s(k=>({...k,[w]:S}));const E=ke(xe,"meals",`${o.uid}_${w}`);Me.logWrite("meals","useMealPlan.removeMeal"),await Zt(E,{userId:o.uid,yearMonth:w,meals:S,updatedAt:ht()}),r("saved")}catch(S){throw console.error("Error removing meal:",S),s(E=>({...E,[w]:N})),i(S instanceof Error?S.message:"Error al eliminar"),r("error"),S}},[o,t]),p=f.useCallback(async x=>{if(!o)return;r("saving"),i(null);const y=t;try{const b=Object.entries(x).reduce((w,[N,S])=>{const[E,k]=N.split("-"),D=`${E}-${k}`;return w[D]||(w[D]={}),w[D][N]=Object.entries(S).reduce((T,[R,O])=>{if(!O.name||O.name.trim()==="")return console.warn(`Skipping meal without name for ${N} ${R}`),T;const U=`${N}_${R}`;return T[R]={...O,id:U,type:R,name:O.name.trim(),calories:O.calories?Number(O.calories):void 0},T},{}),w},{});s(w=>({...w,...b}));const v=pO(xe);Object.entries(b).forEach(([w,N])=>{const S=ke(xe,"meals",`${o.uid}_${w}`);v.set(S,{userId:o.uid,yearMonth:w,meals:N,updatedAt:ht()},{merge:!0})}),Me.logWrite("meals","useMealPlan.importMealPlan"),await v.commit(),r("saved")}catch(b){throw console.error("Error importing meal plan:",b),s(y),i(b instanceof Error?b.message:"Error al importar"),r("error"),b}},[o,t]),g=Ha("Meal plan");return{mealPlan:c,status:n,error:a,addMeal:d,removeMeal:h,importMealPlan:p,loadMealPlans:u,resync:g}},qU=()=>{const t=new Date,s=t.getFullYear(),n=t.getMonth()+1,r=t.getDate(),a=new Date(s,n,0).getDate(),i=String(n).padStart(2,"0"),o=[`${s}-${i}`];if(a-r<7){let c=n+1,u=s;c>12&&(c=1,u=s+1);const d=String(c).padStart(2,"0");o.push(`${u}-${d}`)}return o},oh=()=>{const{user:t}=Je(),[s,n]=f.useState([]),[r,a]=f.useState("idle"),[i,o]=f.useState(null),c=f.useCallback(async()=>{if(t){a("loading"),o(null);try{Me.logRead("recipes","useRecipes.loadRecipes");const p=xn(Bt(xe,"recipes"),Et("userId","==",t.uid)),x=(await gn(p)).docs.map(y=>{const b=y.data();return{id:y.id,name:b.name,ingredients:b.ingredients||[],instructions:b.instructions||"",nutrition:b.nutrition||{calories:0,protein:0,carbs:0,fat:0},mealType:b.mealType,...b.description&&{description:b.description},...b.difficulty&&{difficulty:b.difficulty},...b.prepTime!==void 0&&{prepTime:b.prepTime},...b.favorite!==void 0&&{favorite:b.favorite}}});n(x),a("idle")}catch(p){console.error("Error loading recipes:",p),o(p instanceof Error?p.message:"Error al cargar recetas"),a("error")}}},[t]);return f.useEffect(()=>{if(!t){n([]);return}c()},[t,c]),{recipes:s,status:r,error:i,addRecipe:async p=>{if(!t){o("Usuario no autenticado");return}a("saving"),o(null);const g={id:`temp-${Date.now()}`,...p};n(x=>[...x,g]);try{const x={name:p.name,ingredients:p.ingredients,instructions:p.instructions,nutrition:p.nutrition,mealType:p.mealType,userId:t.uid,createdAt:ht(),updatedAt:ht()};p.description&&(x.description=p.description),p.difficulty&&(x.difficulty=p.difficulty),p.prepTime!==void 0&&(x.prepTime=p.prepTime),p.favorite!==void 0&&(x.favorite=p.favorite),Me.logWrite("recipes","useRecipes.addRecipe");const y=await wl(Bt(xe,"recipes"),x);n(b=>b.map(v=>v.id===g.id?{...v,id:y.id}:v)),a("idle")}catch(x){console.error("Error adding recipe:",x),n(y=>y.filter(b=>b.id!==g.id)),o(x instanceof Error?x.message:"Error al guardar"),a("error")}},updateRecipe:async(p,g)=>{if(!t){o("Usuario no autenticado");return}a("saving"),o(null);const x=s.find(y=>y.id===p);if(x)try{const y={...x,...g};n(w=>w.map(N=>N.id===p?y:N));const b=ke(xe,"recipes",p),v={updatedAt:ht()};g.name!==void 0&&(v.name=g.name),g.ingredients!==void 0&&(v.ingredients=g.ingredients),g.instructions!==void 0&&(v.instructions=g.instructions),g.nutrition!==void 0&&(v.nutrition=g.nutrition),g.mealType!==void 0&&(v.mealType=g.mealType),g.description!==void 0&&(v.description=g.description),g.difficulty!==void 0&&(v.difficulty=g.difficulty),g.prepTime!==void 0&&(v.prepTime=g.prepTime),g.favorite!==void 0&&(v.favorite=g.favorite),Me.logWrite("recipes","useRecipes.updateRecipe",p),await ar(b,v),a("idle")}catch(y){console.error("Error updating recipe:",y),n(b=>b.map(v=>v.id===p?x:v)),o(y instanceof Error?y.message:"Error al actualizar"),a("error")}},deleteRecipe:async p=>{if(!t){o("Usuario no autenticado");return}a("saving"),o(null);const g=s.find(x=>x.id===p);if(g)try{n(x=>x.filter(y=>y.id!==p)),Me.logDelete("recipes","useRecipes.deleteRecipe",p),await Vo(ke(xe,"recipes",p)),a("idle")}catch(x){console.error("Error deleting recipe:",x),n(y=>[...y,g]),o(x instanceof Error?x.message:"Error al eliminar"),a("error")}},loadRecipes:c}},bg=()=>{const{user:t}=Je(),[s,n]=f.useState([]),[r,a]=f.useState("idle"),[i,o]=f.useState(null),c=f.useCallback(async()=>{if(t){a("loading"),o(null);try{Me.logRead("prepared-meals","usePreparedMeals.loadMeals");const p=xn(Bt(xe,"prepared-meals"),Et("userId","==",t.uid)),x=(await gn(p)).docs.map(y=>{const b=y.data(),v={id:y.id,name:b.name||""};return b.portions!==void 0&&(v.portions=b.portions),v});n(x),a("idle")}catch(p){console.error("Error loading prepared meals:",p),o(p instanceof Error?p.message:"Error al cargar comidas"),a("error")}}},[t]);return f.useEffect(()=>{if(!t){n([]);return}c()},[t,c]),{meals:s,status:r,error:i,addMeal:async p=>{if(!t){o("Usuario no autenticado");return}a("saving"),o(null);const g={id:`temp-${Date.now()}`,...p};n(x=>[...x,g]);try{const x={name:p.name,userId:t.uid,createdAt:ht(),updatedAt:ht()};p.portions!==void 0&&(x.portions=p.portions),Me.logWrite("prepared-meals","usePreparedMeals.addMeal");const y=await wl(Bt(xe,"prepared-meals"),x);n(b=>b.map(v=>v.id===g.id?{...v,id:y.id}:v)),a("idle")}catch(x){console.error("Error adding prepared meal:",x),n(b=>b.filter(v=>v.id!==g.id));const y=x instanceof Error?x.message:"Error al guardar";o(y),a("error")}},updateMeal:async(p,g)=>{if(!t){o("Usuario no autenticado");return}a("saving"),o(null);const x=s.find(y=>y.id===p);if(x)try{const y={...x,...g};n(w=>w.map(N=>N.id===p?y:N));const b=ke(xe,"prepared-meals",p),v={updatedAt:ht()};g.name!==void 0&&(v.name=g.name),g.portions!==void 0&&(v.portions=g.portions),Me.logWrite("prepared-meals","usePreparedMeals.updateMeal",p),await ar(b,v),a("idle")}catch(y){console.error("Error updating prepared meal:",y),n(v=>v.map(w=>w.id===p?x:w));const b=y instanceof Error?y.message:"Error al actualizar";o(b),a("error")}},deleteMeal:async p=>{if(!t){o("Usuario no autenticado");return}a("saving"),o(null);const g=s.find(x=>x.id===p);if(g)try{n(x=>x.filter(y=>y.id!==p)),Me.logDelete("prepared-meals","usePreparedMeals.deleteMeal",p),await Vo(ke(xe,"prepared-meals",p)),a("idle")}catch(x){console.error("Error deleting prepared meal:",x),n(b=>[...b,g]);const y=x instanceof Error?x.message:"Error al eliminar";o(y),a("error")}},loadMeals:c}},KU=[{path:"/meal",label:"Plan de Comidas",icon:e.jsx(ns,{className:"h-4 w-4"})},{path:"/shopping-list",label:"Lista de Compras",icon:e.jsx(Ia,{className:"h-4 w-4"})},{path:"/recipes",label:"Recetas",icon:e.jsx(zl,{className:"h-4 w-4"})},{path:"/prepared-meals",label:"Comidas Preparadas",icon:e.jsx(lo,{className:"h-4 w-4"})}],lh=({title:t,children:s,className:n})=>{const r=Ln();return e.jsx("div",{className:ce("",n),children:e.jsx("div",{className:"container mx-auto",children:e.jsxs("div",{className:"bg-background/50 flex items-center justify-between gap-2 py-4 backdrop-blur-md lg:mt-4 lg:rounded-2xl lg:border lg:px-4",children:[e.jsx("div",{className:"flex items-center gap-5",children:e.jsxs("div",{className:"flex items-center gap-12",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg shadow-sm",children:e.jsx(MO,{className:"h-4 w-4 text-white"})}),e.jsx("h2",{className:"text-lg font-bold text-foreground",children:t})]}),e.jsx("nav",{className:"hidden md:flex gap-2 lg:gap-4",children:KU.map(a=>{const i=r.pathname===a.path;return e.jsxs(Nn,{to:a.path,className:ce("flex items-center space-x-3 px-4 py-3 rounded-xl text-sm font-medium transition-all duration-200 group","hover:bg-white/90 hover:shadow-lg",i?"bg-white text-blue-700 shadow-lg border border-blue-200":"text-gray-700 hover:text-gray-900"),children:[e.jsx("span",{className:ce("p-1.5 rounded-lg transition-colors",i?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-600 group-hover:bg-gray-200"),children:a.icon}),e.jsx("span",{className:"whitespace-nowrap",children:a.label})]},a.path)})})]})}),s&&e.jsx("div",{className:"flex items-center gap-3",children:s})]})})})},jg=({open:t,onOpenChange:s,config:n,customFieldValues:r={},onCustomFieldChange:a})=>{const[i,o]=f.useState(0),[c,u]=f.useState([]),[d,h]=f.useState({}),[p,g]=f.useState(""),[x,y]=f.useState(!1),b=c.map(P=>n.modules.find(z=>z.id===P)).filter(P=>P!==void 0),v=b.filter(P=>P.fields&&P.fields.length>0),w=1+v.length+1,N=P=>{u(z=>z.includes(P)?z.filter(G=>G!==P):[...z,P])},S=(P,z)=>{h(G=>{const ae=G[P]||[],Y=ae.includes(z)?ae.filter(X=>X!==z):[...ae,z];return{...G,[P]:Y}})},E=()=>{i===0?v.length>0?o(1):(D(),o(w-1)):i<w-1&&(i===v.length&&D(),o(i+1))},k=()=>{i>0&&o(i-1)},D=()=>{const P={};b.forEach(z=>{if(z){const G=d[z.id]||[],ae=r[z.id]||{},Y=z.dataGenerator(G,ae);Y&&Object.keys(Y).length>0&&Object.assign(P,Y)}}),g(JSON.stringify(P,null,2))},T=async()=>{try{await navigator.clipboard.writeText(p),y(!0),bt.success("JSON copiado al portapapeles"),setTimeout(()=>y(!1),2e3)}catch{bt.error("Error al copiar al portapapeles")}},R=()=>{o(0),u([]),h({}),g(""),y(!1),s(!1)},O=()=>{var P,z;if(i===0)return c.length>0;if(i>0&&i<=v.length){const G=i-1,ae=v[G];if(!ae||((P=ae.fields)==null?void 0:P.every(H=>H.type==="custom")))return!0;const X=d[ae.id]||[];return((z=ae.fields)==null?void 0:z.some(H=>H.type!=="custom"))?X.length>0:!0}return!0},U=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-4",children:"Selecciona los mdulos que deseas exportar:"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:n.modules.map(P=>e.jsxs("div",{className:"flex items-start space-x-3 p-4 border rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(Rs,{id:P.id,checked:c.includes(P.id),onCheckedChange:()=>N(P.id),className:"mt-1"}),P.icon&&e.jsx("div",{className:"mt-1 text-gray-600",children:P.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:P.id,className:"text-sm font-medium cursor-pointer block",children:P.label}),P.description&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:P.description})]})]},P.id))})]}),I=P=>{const z=v[P];return!z||!z.fields?null:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-sm text-gray-600 mb-4",children:["Configura los campos para ",e.jsx("strong",{children:z.label}),":"]}),e.jsxs(Ce,{children:[e.jsx(Kt,{className:"pb-3",children:e.jsxs(Gt,{className:"text-base flex items-center gap-2",children:[z.icon,z.label]})}),e.jsx(Ae,{className:"space-y-3",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:z.fields.map(G=>{var ae;return e.jsx("div",{children:G.type==="custom"&&G.component?e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx("label",{className:"text-sm font-medium block",children:G.label}),G.description&&e.jsx("p",{className:"text-xs text-gray-500",children:G.description}),G.component]}):e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Rs,{id:`${z.id}-${G.id}`,checked:((ae=d[z.id])==null?void 0:ae.includes(G.id))||!1,onCheckedChange:()=>S(z.id,G.id)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:`${z.id}-${G.id}`,className:"text-sm font-medium cursor-pointer block",children:G.label}),G.description&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:G.description})]})]})},G.id)})})})]})]})},_=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-4",children:"Aqu est tu JSON generado. Puedes copiarlo al portapapeles:"}),e.jsxs("div",{className:"relative",children:[e.jsx("pre",{className:"bg-gray-100 p-4 rounded-lg text-xs overflow-auto max-h-96 border",children:p}),e.jsxs($,{onClick:T,variant:"outline",size:"sm",className:"absolute top-2 right-2 gap-2",disabled:x,children:[x?e.jsx(Fa,{className:"w-4 h-4"}):e.jsx(da,{className:"w-4 h-4"}),x?"Copiado":"Copiar"]})]})]}),M=()=>i===0?U():i<=v.length?I(i-1):_(),W=()=>{if(i===0)return"Seleccionar Mdulos";if(i<=v.length){const P=v[i-1];return`Configurar ${P==null?void 0:P.label}`}else return"Resultado"},B=()=>{const P=[{label:"Mdulos",isCompleted:i>0,isCurrent:i===0}];return v.forEach((z,G)=>{const ae=G+1;z&&P.push({label:z.label,isCompleted:i>ae,isCurrent:i===ae})}),P.push({label:"Resultado",isCompleted:!1,isCurrent:i===w-1}),e.jsxs("div",{className:"bg-gray-50 border-b",children:[e.jsx("div",{className:"flex items-center justify-center space-x-2 py-4 px-6",children:P.map((z,G)=>e.jsxs(ee.Fragment,{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`flex items-center justify-center w-8 h-8 rounded-full text-sm font-medium ${z.isCompleted?"bg-green-500 text-white":z.isCurrent?"bg-blue-500 text-white":"bg-gray-300 text-gray-600"}`,children:z.isCompleted?e.jsx(aa,{className:"w-4 h-4"}):G+1}),e.jsx("span",{className:`ml-2 text-sm font-medium ${z.isCurrent?"text-blue-600":z.isCompleted?"text-green-600":"text-gray-500"}`,children:z.label})]}),G<P.length-1&&e.jsx(Ma,{className:"w-4 h-4 text-gray-400"})]},G))}),i>0&&b.length>0&&e.jsxs("div",{className:"px-6 pb-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Mdulos seleccionados:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:b.map(z=>z&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:[z.icon,z.label]},z.id))})]})]})};return e.jsx(kt,{open:t,onOpenChange:R,children:e.jsxs(wt,{className:"sm:max-w-5xl max-h-[85vh] overflow-y-auto p-0",children:[e.jsx(At,{className:"px-6 pt-6 pb-0",children:e.jsxs(_t,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:n.title}),e.jsx("span",{className:"text-sm font-normal text-gray-500 mt-1",children:W()})]}),e.jsxs("span",{className:"text-sm font-normal text-gray-500",children:["Paso ",i+1," de ",w]})]})}),B(),e.jsx("div",{className:"px-6 pb-6",children:M()}),e.jsxs("div",{className:"flex justify-between px-6 py-4 border-t bg-gray-50",children:[e.jsxs($,{variant:"outline",onClick:k,disabled:i===0,className:"gap-2",children:[e.jsx(ix,{className:"w-4 h-4"}),"Anterior"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{variant:"outline",onClick:R,children:"Cancelar"}),i<w-1?e.jsxs($,{onClick:E,disabled:!O(),className:"gap-2",children:["Siguiente",e.jsx(Ma,{className:"w-4 h-4"})]}):e.jsx($,{onClick:R,children:"Finalizar"})]})]})]})})},JU=({open:t,onOpenChange:s})=>{var h;const{items:n}=Jl(),{recipes:r}=oh(),{meals:a}=bg(),{mealPlan:i}=W1(),[o,c]=f.useState({mealPlan:{dateRange:"today"}}),u=(p,g,x)=>{c(y=>({...y,[p]:{...y[p],[g]:x}}))},d={title:"Exportar Datos de Comidas",modules:[{id:"ingredients",label:"Ingredientes",description:"Lista de ingredientes disponibles con cantidades",icon:e.jsx(lo,{className:"w-4 h-4"}),fields:[{id:"in-stock",label:"En stock",description:"Elementos que ya tienes disponibles"},{id:"low-stock",label:"Stock bajo",description:"Elementos que necesitas reponer pronto"},{id:"to-buy",label:"Pendientes de compra",description:"Elementos que planeas comprar"},{id:"excludeNonFood",label:"Excluir no comestibles",description:"Filtrar elementos de aseo y limpieza"},{id:"withQuantities",label:"Incluir cantidades",description:"Agregar cantidades especficas de cada ingrediente"},{id:"groupByStatus",label:"Agrupar por estado",description:"Organizar por en stock, stock bajo, pendiente"}],dataGenerator:(p,g)=>{const x=["aseo","otro","limpieza"];let y=n;p.includes("excludeNonFood")&&(y=y.filter(N=>{if(!N.category)return!0;const S=N.category.toLowerCase();return!x.some(E=>S.includes(E))}));const b=[];p.includes("in-stock")&&b.push("in-stock"),p.includes("low-stock")&&b.push("low-stock"),p.includes("to-buy")&&b.push("to-buy"),b.length>0&&(y=y.filter(N=>b.includes(N.status)));const v=p.includes("withQuantities");return p.includes("groupByStatus")?{ingredientes:y.reduce((S,E)=>{const D={"in-stock":"en_stock","low-stock":"stock_bajo","to-buy":"pendiente_compra"}[E.status]||E.status;S[D]||(S[D]=[]);const T=v?{name:E.name,quantity:E.stock}:{name:E.name};return S[D].push(T),S},{})}:{ingredientes:y.map(S=>v?{name:S.name,quantity:S.stock,status:S.status}:{name:S.name,status:S.status})}}},{id:"preparedMeals",label:"Comidas Preparadas",description:"Lista de comidas ya preparadas",icon:e.jsx(zl,{className:"w-4 h-4"}),dataGenerator:(p,g)=>({comidasPreparadas:a.map(x=>({name:x.name,...x.portions!==void 0&&{porciones:x.portions}}))})},{id:"mealPlan",label:"Plan de Comidas",description:"Plan de comidas con selector de rango",icon:e.jsx(ns,{className:"w-4 h-4"}),fields:[{id:"dateRange",label:"Rango de fechas",description:"Selecciona qu perodo exportar",type:"custom",component:e.jsxs(Tt,{value:((h=o.mealPlan)==null?void 0:h.dateRange)||"today",onValueChange:p=>u("mealPlan","dateRange",p),children:[e.jsx(vt,{className:"w-full",children:e.jsx(Dt,{placeholder:"Selecciona el rango"})}),e.jsxs(yt,{children:[e.jsxs(Pe,{value:"today",children:["Solo hoy (",nt(new Date,"dd/MM/yyyy",{locale:Zs}),")"]}),e.jsx(Pe,{value:"yesterday-today",children:"Ayer y hoy"}),e.jsx(Pe,{value:"current-week",children:"Semana actual"}),e.jsx(Pe,{value:"all",children:"Todo el plan"})]})]})}],dataGenerator:(p,g)=>{const x=(g==null?void 0:g.dateRange)||"today",y=new Date,b=nt(y,"yyyy-MM-dd");let v={...i};switch(x){case"today":v={[b]:i[b]||{}};break;case"yesterday-today":const w=$c(y,1),N=nt(w,"yyyy-MM-dd");v={[N]:i[N]||{},[b]:i[b]||{}};break;case"current-week":const S=Pa(y,{weekStartsOn:1}),E=Rr(y,{weekStartsOn:1});v={};for(let k=new Date(S);k<=E;k.setDate(k.getDate()+1)){const D=nt(k,"yyyy-MM-dd");i[D]&&(v[D]=i[D])}break;case"all":default:v=i;break}return{planComidas:v,rango:x,fechas:Object.keys(v).sort()}}},{id:"recipes",label:"Recetas",description:"Recetas disponibles con campos personalizables",icon:e.jsx(md,{className:"w-4 h-4"}),fields:[{id:"allRecipes",label:"Todas las recetas",description:"Incluir todas las recetas (por defecto solo favoritas)"},{id:"name",label:"Nombre",description:"Nombre de la receta"},{id:"description",label:"Descripcin",description:"Descripcin de la receta"},{id:"ingredients",label:"Ingredientes",description:"Lista de ingredientes y cantidades"},{id:"instructions",label:"Pasos de preparacin",description:"Instrucciones paso a paso"},{id:"prepTime",label:"Tiempo estimado",description:"Tiempo de preparacin en minutos"},{id:"mealType",label:"Tipo de comida",description:"Categora de la comida"},{id:"difficulty",label:"Dificultad",description:"Nivel de dificultad"},{id:"nutrition",label:"Informacin nutricional",description:"Caloras, protenas, carbohidratos, grasas"}],dataGenerator:(p,g)=>{const x=p.includes("allRecipes"),b=(x?r:r.filter(v=>v.favorite===!0)).map(v=>{const w={};return p.length===0||p.length===1&&p[0]==="allRecipes"?{name:v.name,description:v.description,ingredients:v.ingredients,instructions:v.instructions,mealType:v.mealType,favorite:v.favorite}:(p.includes("name")&&(w.name=v.name),p.includes("description")&&v.description&&(w.description=v.description),p.includes("ingredients")&&(w.ingredients=v.ingredients),p.includes("instructions")&&(w.instructions=v.instructions),p.includes("prepTime")&&v.prepTime&&(w.prepTime=v.prepTime),p.includes("mealType")&&(w.mealType=v.mealType),p.includes("difficulty")&&v.difficulty&&(w.difficulty=v.difficulty),p.includes("nutrition")&&(w.nutrition=v.nutrition),w)});return{recetas:b,total:b.length,tipo:x?"todas":"favoritas"}}}]};return e.jsx(jg,{open:t,onOpenChange:s,config:d,customFieldValues:o,onCustomFieldChange:u})},XU=({selectedDate:t})=>{const{user:s}=Je(),{toast:n}=ih(),r=Ln(),[a,i]=f.useState(!1),[o,c]=f.useState(!1),{mealPlan:u,status:d,error:h,addMeal:p,removeMeal:g,importMealPlan:x,resync:y}=W1(),{isOnline:b}=ua();if(Jl(),oh(),bg(),!s)return e.jsx(Ce,{className:"w-full h-full",children:e.jsx(Ae,{className:"p-4 text-center",children:e.jsx("p",{children:"Inicia sesin para planificar tus comidas"})})});const v=async(...E)=>{try{await p(...E)}catch(k){console.error("Error adding meal:",k),n({title:"Error al Agregar",description:"No se pudo agregar la comida.",variant:"destructive"})}},w=async(...E)=>{try{await g(...E)}catch(k){console.error("Error removing meal:",k),n({title:"Error al Eliminar",description:"No se pudo eliminar la comida.",variant:"destructive"})}},N=async(...E)=>{try{await x(...E),n({title:"Importacin Exitosa",description:"El plan de comidas se ha importado correctamente."}),i(!1)}catch(k){console.error("Error importing meal plan:",k),n({title:"Error al Importar",description:"No se pudo importar el plan de comidas.",variant:"destructive"})}},S=()=>{c(!0)};return e.jsxs("div",{className:"w-full h-full flex flex-col",children:[e.jsxs(lh,{title:"Plan de Comidas",children:[e.jsx(Mr,{children:e.jsxs("div",{className:"hidden md:flex items-center gap-2",children:[e.jsxs(Hs,{children:[e.jsx(Us,{asChild:!0,children:e.jsxs($,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>i(!0),children:[e.jsx(Bo,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Importar Plan"})]})}),e.jsx(Ls,{children:e.jsx("p",{children:"Importar Plan"})})]}),e.jsxs(Hs,{children:[e.jsx(Us,{asChild:!0,children:e.jsxs($,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:S,children:[e.jsx(br,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Exportar"})]})}),e.jsx(Ls,{children:e.jsx("p",{children:"Exportar"})})]})]})}),e.jsxs(oa,{children:[e.jsx(la,{asChild:!0,children:e.jsxs($,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 md:hidden",children:[e.jsx(gd,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Opciones"})]})}),e.jsxs(Pr,{align:"end",children:[e.jsxs(Ft,{onClick:()=>i(!0),children:[e.jsx(Bo,{className:"mr-2 h-4 w-4"}),"Importar Plan"]}),e.jsxs(Ft,{onClick:S,children:[e.jsx(br,{className:"mr-2 h-4 w-4"}),"Exportar"]}),e.jsx(Yl,{}),r.pathname!=="/meal"&&e.jsx(Ft,{asChild:!0,children:e.jsxs(Nn,{to:"/meal",className:"flex items-center",children:[e.jsx(ns,{className:"mr-2 h-4 w-4"}),"Plan de Comidas"]})}),r.pathname!=="/shopping-list"&&e.jsx(Ft,{asChild:!0,children:e.jsxs(Nn,{to:"/shopping-list",className:"flex items-center",children:[e.jsx(Ia,{className:"mr-2 h-4 w-4"}),"Lista de Compras"]})}),r.pathname!=="/recipes"&&e.jsx(Ft,{asChild:!0,children:e.jsxs(Nn,{to:"/recipes",className:"flex items-center",children:[e.jsx(zl,{className:"mr-2 h-4 w-4"}),"Recetas"]})}),r.pathname!=="/prepared-meals"&&e.jsx(Ft,{asChild:!0,children:e.jsxs(Nn,{to:"/prepared-meals",className:"flex items-center",children:[e.jsx(lo,{className:"mr-2 h-4 w-4"}),"Comidas Preparadas"]})})]})]})]}),e.jsxs("div",{className:"flex-1 bg-gray-50 overflow-hidden",children:[e.jsx(YU,{mealPlan:u,onAddMeal:v,onRemoveMeal:w,disabled:d==="saving"||!b,selectedDate:t}),h&&e.jsxs(hi,{variant:"destructive",className:"m-4",children:[e.jsx(ro,{className:"h-4 w-4"}),e.jsx(fi,{className:"text-sm",children:h})]})]}),e.jsx(kt,{open:a,onOpenChange:i,children:e.jsxs(wt,{className:"sm:max-w-md",children:[e.jsx(At,{children:e.jsx(_t,{children:"Importar Plan de Comidas"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Puedes importar un plan de comidas desde un archivo JSON o pegando el contenido directamente."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(VU,{onImport:N,disabled:d==="saving"||!b}),e.jsx(GU,{onImport:N,disabled:d==="saving"||!b})]})]})]})}),e.jsx(JU,{open:o,onOpenChange:c}),e.jsxs("div",{className:"flex justify-center items-center gap-2 text-xs p-2 border-t bg-white",children:[d==="saving"&&e.jsx("span",{className:"text-blue-500",children:"Guardando..."}),d==="pending"&&e.jsx("span",{className:"text-yellow-600",children:"Pendiente de sincronizar"}),d==="saved"&&e.jsx("span",{className:"text-green-600",children:"Sincronizado"}),d==="error"&&e.jsx("span",{className:"text-red-600",children:"Error de sincronizacin"}),!b&&e.jsx("span",{className:"text-orange-600",children:"Offline"}),e.jsx($,{onClick:y,variant:"link",className:"p-0 h-auto",children:"Reintentar"})]})]})},ZU=()=>e.jsx(ln,{noPadding:!0,className:"h-full",children:e.jsx(XU,{selectedDate:new Date})});var Y1="Toggle",wg=f.forwardRef((t,s)=>{const{pressed:n,defaultPressed:r,onPressedChange:a,...i}=t,[o,c]=Oa({prop:n,onChange:a,defaultProp:r??!1,caller:Y1});return e.jsx(jt.button,{type:"button","aria-pressed":o,"data-state":o?"on":"off","data-disabled":t.disabled?"":void 0,...i,ref:s,onClick:it(t.onClick,()=>{t.disabled||c(!o)})})});wg.displayName=Y1;var V1=wg,xo="ToggleGroup",[G1,vY]=za(xo,[Rm]),q1=Rm(),Ng=ee.forwardRef((t,s)=>{const{type:n,...r}=t;if(n==="single"){const a=r;return e.jsx(QU,{...a,ref:s})}if(n==="multiple"){const a=r;return e.jsx(eW,{...a,ref:s})}throw new Error(`Missing prop \`type\` expected on \`${xo}\``)});Ng.displayName=xo;var[K1,J1]=G1(xo),QU=ee.forwardRef((t,s)=>{const{value:n,defaultValue:r,onValueChange:a=()=>{},...i}=t,[o,c]=Oa({prop:n,defaultProp:r??"",onChange:a,caller:xo});return e.jsx(K1,{scope:t.__scopeToggleGroup,type:"single",value:ee.useMemo(()=>o?[o]:[],[o]),onItemActivate:c,onItemDeactivate:ee.useCallback(()=>c(""),[c]),children:e.jsx(X1,{...i,ref:s})})}),eW=ee.forwardRef((t,s)=>{const{value:n,defaultValue:r,onValueChange:a=()=>{},...i}=t,[o,c]=Oa({prop:n,defaultProp:r??[],onChange:a,caller:xo}),u=ee.useCallback(h=>c((p=[])=>[...p,h]),[c]),d=ee.useCallback(h=>c((p=[])=>p.filter(g=>g!==h)),[c]);return e.jsx(K1,{scope:t.__scopeToggleGroup,type:"multiple",value:o,onItemActivate:u,onItemDeactivate:d,children:e.jsx(X1,{...i,ref:s})})});Ng.displayName=xo;var[tW,sW]=G1(xo),X1=ee.forwardRef((t,s)=>{const{__scopeToggleGroup:n,disabled:r=!1,rovingFocus:a=!0,orientation:i,dir:o,loop:c=!0,...u}=t,d=q1(n),h=_m(o),p={role:"group",dir:h,...u};return e.jsx(tW,{scope:n,rovingFocus:a,disabled:r,children:a?e.jsx(Rj,{asChild:!0,...d,orientation:i,dir:h,loop:c,children:e.jsx(jt.div,{...p,ref:s})}):e.jsx(jt.div,{...p,ref:s})})}),Nm="ToggleGroupItem",Z1=ee.forwardRef((t,s)=>{const n=J1(Nm,t.__scopeToggleGroup),r=sW(Nm,t.__scopeToggleGroup),a=q1(t.__scopeToggleGroup),i=n.value.includes(t.value),o=r.disabled||t.disabled,c={...t,pressed:i,disabled:o},u=ee.useRef(null);return r.rovingFocus?e.jsx(Oj,{asChild:!0,...a,focusable:!o,active:i,ref:u,children:e.jsx(Zb,{...c,ref:s})}):e.jsx(Zb,{...c,ref:s})});Z1.displayName=Nm;var Zb=ee.forwardRef((t,s)=>{const{__scopeToggleGroup:n,value:r,...a}=t,i=J1(Nm,n),o={role:"radio","aria-checked":t.pressed,"aria-pressed":void 0},c=i.type==="single"?o:void 0;return e.jsx(wg,{...c,...a,ref:s,onPressedChange:u=>{u?i.onItemActivate(r):i.onItemDeactivate(r)}})}),Q1=Ng,eE=Z1;const tE=Il("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-3",sm:"h-9 px-2.5",lg:"h-11 px-5"}},defaultVariants:{variant:"default",size:"default"}}),nW=f.forwardRef(({className:t,variant:s,size:n,...r},a)=>e.jsx(V1,{ref:a,className:ce(tE({variant:s,size:n,className:t})),...r}));nW.displayName=V1.displayName;const sE=f.createContext({size:"default",variant:"default"}),nE=f.forwardRef(({className:t,variant:s,size:n,children:r,...a},i)=>e.jsx(Q1,{ref:i,className:ce("flex items-center justify-center gap-1",t),...a,children:e.jsx(sE.Provider,{value:{variant:s,size:n},children:r})}));nE.displayName=Q1.displayName;const Kp=f.forwardRef(({className:t,children:s,variant:n,size:r,...a},i)=>{const o=f.useContext(sE);return e.jsx(eE,{ref:i,className:ce(tE({variant:o.variant||n,size:o.size||r}),t),...a,children:s})});Kp.displayName=eE.displayName;const rW=({open:t,onOpenChange:s})=>{const{items:n}=Jl(),r={title:"Exportar Lista de Compras",modules:[{id:"shoppingList",label:"Lista de Compras",description:"Elementos de la lista con opciones de formato",icon:e.jsx(Ia,{className:"w-4 h-4"}),fields:[{id:"in-stock",label:"En stock",description:"Elementos que ya tienes disponibles"},{id:"low-stock",label:"Stock bajo",description:"Elementos que necesitas reponer pronto"},{id:"to-buy",label:"Pendientes de compra",description:"Elementos que planeas comprar"},{id:"nextPurchase",label:"Solo prximas compras",description:"Filtrar solo elementos marcados para prxima compra"},{id:"excludeCategories",label:"Excluir no comestibles",description:"Filtrar elementos de aseo y otros no comestibles"},{id:"withQuantities",label:"Incluir cantidades",description:"Agregar informacin de cantidades"},{id:"withPrices",label:"Incluir precios",description:"Agregar informacin de precios cuando est disponible"},{id:"withDates",label:"Incluir fechas de consumo",description:"Agregar fechas de consumo preferente"},{id:"withPlaces",label:"Incluir lugares de compra",description:"Agregar informacin de dnde comprar"},{id:"byStatus",label:"Agrupar por estado",description:"Organizar elementos por estado (en stock, stock bajo, pendiente)"},{id:"byCategory",label:"Agrupar por categora",description:"Organizar elementos por categoras"}],dataGenerator:(a,i)=>{let o=[...n];if(a.includes("excludeCategories")){const d=["aseo","otro","limpieza"];o=o.filter(h=>{if(!h.category)return!0;const p=h.category.toLowerCase();return!d.some(g=>p.includes(g))})}a.includes("nextPurchase")&&(o=o.filter(d=>d.nextPurchase===!0));const c=[];a.includes("in-stock")&&c.push("in-stock"),a.includes("low-stock")&&c.push("low-stock"),a.includes("to-buy")&&c.push("to-buy"),c.length>0&&(o=o.filter(d=>c.includes(d.status)));const u=d=>{const h={name:d.name};return a.includes("withQuantities")&&(h.quantity=d.stock),a.includes("withPrices")&&d.price&&(h.price=d.price),a.includes("withDates")&&d.consumeBy&&(h.consumeBy=d.consumeBy),a.includes("withPlaces")&&d.place&&(h.place=d.place),h};if(a.includes("byStatus")&&a.includes("byCategory"))return{listaCompras:o.reduce((h,p)=>{const x={"in-stock":"en_stock","low-stock":"stock_bajo","to-buy":"pendiente_compra"}[p.status]||p.status,y=p.category||"sin_categoria";return h[x]||(h[x]={}),h[x][y]||(h[x][y]=[]),h[x][y].push(u(p)),h},{})};if(a.includes("byStatus")){const d={"in-stock":"en_stock","low-stock":"stock_bajo","to-buy":"pendiente_compra"};return{listaCompras:o.reduce((p,g)=>{const x=d[g.status]||g.status;return p[x]||(p[x]=[]),p[x].push(u(g)),p},{})}}else return a.includes("byCategory")?{listaCompras:o.reduce((h,p)=>{const g=p.category||"sin_categoria";return h[g]||(h[g]=[]),h[g].push(u(p)),h},{})}:{listaCompras:o.map(u),total:o.length}}}]};return e.jsx(jg,{open:t,onOpenChange:s,config:r})},rE=[{value:"Aseo y Limpieza",emoji:""},{value:"Bebidas",emoji:""},{value:"Carnes y Pescados",emoji:""},{value:"Cereales y Granos",emoji:""},{value:"Condimentos y Especias",emoji:""},{value:"Congelados",emoji:""},{value:"Cuidado Personal",emoji:""},{value:"Enlatados y Conservas",emoji:""},{value:"Frutas y Verduras",emoji:""},{value:"Lcteos y Huevos",emoji:""},{value:"Panadera",emoji:""},{value:"Snacks y Dulces",emoji:""},{value:"Mascotas",emoji:""},{value:"Otro",emoji:""}],aW=rE.reduce((t,s)=>(t[s.value]=s.emoji,t),{}),iW=rE.map(t=>t.value),dd=t=>{if(!t)return"";const s=aW[t];return s?`${s} ${t}`:t},oW=["xito","D1","Ara","Dollarcity","Olimpica (SAO)","Jumbo","Plaza de mercado","Panadera","Droguera","Otro"],lW=({open:t,onOpenChange:s,onSave:n,onDelete:r,item:a})=>{const[i,o]=f.useState(""),[c,u]=f.useState(1),[d,h]=f.useState(0),[p,g]=f.useState(""),[x,y]=f.useState(""),[b,v]=f.useState(""),[w,N]=f.useState(""),[S,E]=f.useState("to-buy");f.useEffect(()=>{a?(o(a.name),u(a.stock),h(a.toBuy),g(a.price?String(a.price):""),y(a.category||""),v(a.place||""),N(a.consumeBy||""),E(a.status)):(o(""),u(1),h(0),g(""),y(""),v(""),N(""),E("to-buy"))},[a,t]),f.useEffect(()=>{S==="to-buy"&&N("")},[S]);const k=()=>{const D={stock:Number(c),toBuy:Number(d),status:S};p&&p.trim()!==""&&(D.price=Number(p)),x&&x.trim()!==""&&(D.category=x),b&&b.trim()!==""&&(D.place=b),S!=="to-buy"&&w&&w.trim()!==""&&(D.consumeBy=w),a?n({...D,name:i},a.id):i.split(`
`).map(R=>R.trim()).filter(Boolean).forEach(R=>n({...D,name:R})),s(!1)};return e.jsx(kt,{open:t,onOpenChange:s,children:e.jsxs(wt,{className:"sm:max-w-md",children:[e.jsx(At,{children:e.jsxs(_t,{children:[a?"Editar":"Agregar"," tem"]})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(ze,{htmlFor:"names",children:["Nombre",a?"":"s"]}),a?e.jsx(Fe,{id:"names",value:i,onChange:D=>o(D.target.value)}):e.jsx(It,{id:"names",value:i,onChange:D=>o(D.target.value),placeholder:"Un producto por lnea",className:"min-h-[120px]"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(ze,{htmlFor:"stock",children:"Stock"}),e.jsx(Fe,{id:"stock",type:"number",value:c,onChange:D=>u(Number(D.target.value))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ze,{htmlFor:"toBuy",children:"A Comprar"}),e.jsx(Fe,{id:"toBuy",type:"number",value:d,onChange:D=>h(Number(D.target.value))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ze,{htmlFor:"price",children:"Precio"}),e.jsx(Fe,{id:"price",type:"number",value:p,onChange:D=>g(D.target.value)})]})]}),"          ",e.jsxs("div",{className:"space-y-1",children:[e.jsx(ze,{htmlFor:"category",children:"Categora"}),e.jsxs(Tt,{value:x,onValueChange:y,children:[e.jsx(vt,{id:"category",children:e.jsx(Dt,{placeholder:"Seleccionar categora"})}),e.jsx(yt,{children:iW.map(D=>e.jsx(Pe,{value:D,children:dd(D)},D))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ze,{htmlFor:"place",children:"Lugar de compra"}),e.jsxs(Tt,{value:b,onValueChange:v,children:[e.jsx(vt,{id:"place",children:e.jsx(Dt,{placeholder:"Seleccionar lugar"})}),e.jsx(yt,{children:oW.map(D=>e.jsx(Pe,{value:D,children:D},D))})]})]}),S!=="to-buy"&&e.jsxs("div",{className:"space-y-1",children:[e.jsx(ze,{htmlFor:"consumeBy",children:"Consumir antes de"}),e.jsx(Fe,{id:"consumeBy",type:"date",value:w,onChange:D=>N(D.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ze,{htmlFor:"status",children:"Estado"}),e.jsxs(Tt,{value:S,onValueChange:D=>E(D),children:[e.jsx(vt,{id:"status",children:e.jsx(Dt,{})}),e.jsxs(yt,{children:[e.jsx(Pe,{value:"in-stock",children:"En Stock"}),e.jsx(Pe,{value:"to-buy",children:"Por Comprar"}),e.jsx(Pe,{value:"low-stock",children:"Poco Stock"})]})]})]})]}),e.jsxs(Cn,{className:"flex justify-between",children:[a&&r?e.jsx($,{variant:"destructive",onClick:()=>{r(a.id),s(!1)},children:"Eliminar"}):e.jsx("span",{}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{variant:"outline",onClick:()=>s(!1),children:"Cancelar"}),e.jsx($,{onClick:k,children:"Guardar"})]})]})]})})},cW=zR,dW=FR,uW=BR,aE=({query:t,onQueryChange:s,sort:n,onSortChange:r,placeFilter:a,onPlaceFilterChange:i,statusFilter:o,onStatusFilterChange:c,categoryFilter:u,onCategoryFilterChange:d,onlyToBuy:h,onOnlyToBuyChange:p,nextOnly:g,onNextOnlyChange:x,expireSoonOnly:y,onExpireSoonOnlyChange:b,noPriceOnly:v=!1,onNoPriceOnlyChange:w,places:N,categories:S,filtersOpen:E,setFiltersOpen:k,isMobile:D})=>e.jsxs(cW,{open:!D||E,onOpenChange:k,children:[e.jsxs("div",{className:"flex gap-2 items-start",children:[e.jsx(Fe,{placeholder:"Buscar",value:t,onChange:T=>s(T.target.value),className:"flex-1 sm:w-60"}),D&&e.jsx(dW,{asChild:!0,children:e.jsx($,{variant:"outline",size:"icon",children:e.jsx(xd,{className:"w-4 h-4"})})})]}),e.jsx(uW,{className:"mt-2",children:e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsxs(Tt,{value:n,onValueChange:T=>r(T),children:[e.jsx(vt,{className:"w-36",children:e.jsx(Dt,{placeholder:"Ordenar"})}),e.jsxs(yt,{children:[e.jsx(Pe,{value:"az",children:"Nombre A-Z"}),e.jsx(Pe,{value:"za",children:"Nombre Z-A"}),e.jsx(Pe,{value:"category",children:"Categora"})]})]}),e.jsxs(Tt,{value:a||"all",onValueChange:T=>i(T==="all"?"":T),children:[e.jsx(vt,{className:"w-36",children:e.jsx(Dt,{placeholder:"Lugar"})}),e.jsxs(yt,{children:[e.jsx(Pe,{value:"all",children:"Todos los lugares"}),N.map(T=>e.jsx(Pe,{value:T,children:T},T))]})]}),e.jsxs(Tt,{value:o||"all",onValueChange:T=>c(T==="all"?"":T),children:[e.jsx(vt,{className:"w-36",children:e.jsx(Dt,{placeholder:"Estado"})}),e.jsxs(yt,{children:[e.jsx(Pe,{value:"all",children:"Todos"}),e.jsx(Pe,{value:"to-buy",children:"Por Comprar"}),e.jsx(Pe,{value:"in-stock",children:"En Stock"}),e.jsx(Pe,{value:"low-stock",children:"Poco Stock"})]})]}),e.jsxs(Tt,{value:u||"all",onValueChange:T=>d(T==="all"?"":T),children:[e.jsx(vt,{className:"w-44",children:e.jsx(Dt,{placeholder:"Categora"})}),e.jsxs(yt,{children:[e.jsx(Pe,{value:"all",children:"Todas"}),w&&e.jsx(Pe,{value:"__empty",children:"Sin categora"}),S.map(T=>e.jsx(Pe,{value:T,children:dd(T)},T))]})]}),w&&e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Rs,{checked:v,onCheckedChange:T=>w(!!T)}),"Sin precio"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Rs,{checked:h,onCheckedChange:T=>p(!!T)}),e.jsx(Ia,{className:"w-4 h-4"}),"Lista activa"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Rs,{checked:g,onCheckedChange:T=>x(!!T)}),"Prxima compra"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Rs,{checked:y,onCheckedChange:T=>b(!!T)}),"Prximos a vencer"]})]})})]}),Qb=[{key:"to-buy",title:"Por Comprar"},{key:"low-stock",title:"Poco Stock"},{key:"in-stock",title:"En Stock"}],ej={"to-buy":Ia,"low-stock":lw,"in-stock":Fa},mW=({items:t,onMove:s,onView:n,onToggleNext:r,onUpdateQuantity:a})=>{const[i,o]=f.useState(""),[c,u]=f.useState("az"),[d,h]=f.useState(""),[p,g]=f.useState(""),[x,y]=f.useState(""),[b,v]=f.useState(!1),[w,N]=f.useState(!1),[S,E]=f.useState(!1),[k,D]=f.useState(!1),{isMobile:T}=vd(),R=f.useMemo(()=>Array.from(new Set(t.map(W=>W.place).filter(Boolean))),[t]),O=f.useMemo(()=>Array.from(new Set(t.map(W=>W.category).filter(Boolean))),[t]),U=f.useMemo(()=>{let W=t.filter(P=>P.name.toLowerCase().includes(i.toLowerCase()));if(d&&(W=W.filter(P=>P.place===d)),p&&(W=W.filter(P=>P.status===p)),x&&(W=W.filter(P=>P.category===x)),b&&(W=W.filter(P=>P.status==="to-buy")),S&&(W=W.filter(P=>P.nextPurchase)),w){const P=os(new Date,3);W=W.filter(z=>{if(!z.consumeBy)return!1;const G=new Date(z.consumeBy);return Is(G,P)})}let B=[...W];switch(c){case"az":B.sort((P,z)=>P.name.localeCompare(z.name));break;case"za":B.sort((P,z)=>z.name.localeCompare(P.name));break;case"category":B.sort((P,z)=>(P.category||"").localeCompare(z.category||""));break}return B},[t,i,d,p,x,b,S,w,c]),I=f.useMemo(()=>{const W={"to-buy":0,"low-stock":0,"in-stock":0};return U.forEach(B=>{B.price!==void 0&&(W[B.status]+=B.price*B.toBuy)}),W},[U]),_=f.useMemo(()=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP"}),[]),M=({stockValue:W,toBuyValue:B,onStockIncrease:P,onStockDecrease:z,onToBuyIncrease:G,onToBuyDecrease:ae})=>e.jsx("div",{className:"flex items-center justify-between text-xs",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-gray-600",children:"Stock:"}),e.jsx($,{variant:"ghost",size:"sm",className:"h-4 w-4 p-0 text-gray-500 hover:text-gray-700",onClick:Y=>{Y.stopPropagation(),z()},children:e.jsx(Gn,{className:"h-2.5 w-2.5"})}),e.jsx("span",{className:"font-medium min-w-[1rem] text-center",children:W}),e.jsx($,{variant:"ghost",size:"sm",className:"h-4 w-4 p-0 text-gray-500 hover:text-gray-700",onClick:Y=>{Y.stopPropagation(),P()},children:e.jsx(Fo,{className:"h-2.5 w-2.5"})})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-gray-600",children:"Comprar:"}),e.jsx($,{variant:"ghost",size:"sm",className:"h-4 w-4 p-0 text-gray-500 hover:text-gray-700",onClick:Y=>{Y.stopPropagation(),ae()},children:e.jsx(Gn,{className:"h-2.5 w-2.5"})}),e.jsx("span",{className:"font-medium min-w-[1rem] text-center",children:B}),e.jsx($,{variant:"ghost",size:"sm",className:"h-4 w-4 p-0 text-gray-500 hover:text-gray-700",onClick:Y=>{Y.stopPropagation(),G()},children:e.jsx(Fo,{className:"h-2.5 w-2.5"})})]})]})});return e.jsx(Mr,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-white p-4 rounded-lg border shadow-sm",children:e.jsx(aE,{query:i,onQueryChange:o,sort:c,onSortChange:u,placeFilter:d,onPlaceFilterChange:h,statusFilter:p,onStatusFilterChange:g,categoryFilter:x,onCategoryFilterChange:y,onlyToBuy:b,onOnlyToBuyChange:v,nextOnly:S,onNextOnlyChange:E,expireSoonOnly:w,onExpireSoonOnlyChange:N,places:R,categories:O,filtersOpen:k,setFiltersOpen:D,isMobile:T})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 lg:gap-8",children:Qb.map(W=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"font-semibold text-base text-gray-700 flex items-center gap-2",children:[ee.createElement(ej[W.key],{className:"w-4 h-4"}),W.title]}),e.jsx("span",{className:"text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded-full",children:U.filter(B=>B.status===W.key).length})]}),e.jsx("div",{className:"text-sm text-gray-600 font-medium",children:_.format(I[W.key])}),e.jsxs("div",{className:"space-y-2 h-full max-h-[calc(100vh-300px)] overflow-y-auto",children:[U.filter(B=>B.status===W.key).map(B=>{const P=os(new Date,3),z=B.consumeBy?new Date(B.consumeBy):null,G=z?Is(z,new Date):!1,ae=z?Is(z,P):!1;return e.jsxs(Ce,{className:`cursor-pointer transition-all duration-200 hover:shadow-md border-l-4 ${W.key==="in-stock"?"border-l-green-500 hover:border-l-green-600":W.key==="low-stock"?"border-l-yellow-500 hover:border-l-yellow-600":"border-l-blue-500 hover:border-l-blue-600"} ${ae||G?"border-red-500 bg-red-50/30":""} ${G?"bg-red-50/50":""}`,onClick:()=>n(B),children:[e.jsxs(Ae,{className:"p-2 pb-1 md:p-2 md:pb-1",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[e.jsx("span",{className:"font-medium text-sm leading-tight",children:B.name}),B.category&&e.jsx("span",{className:"bg-gray-100 text-gray-700 px-1 py-0.5 rounded text-xs whitespace-nowrap",children:dd(B.category)})]}),e.jsx("div",{className:"mb-2",children:e.jsx(M,{stockValue:B.stock,toBuyValue:B.toBuy,onStockIncrease:()=>a(B.id,"stock",B.stock+1),onStockDecrease:()=>a(B.id,"stock",Math.max(0,B.stock-1)),onToBuyIncrease:()=>a(B.id,"toBuy",B.toBuy+1),onToBuyDecrease:()=>a(B.id,"toBuy",Math.max(0,B.toBuy-1))})}),B.consumeBy&&e.jsxs("div",{className:`text-xs mt-1 text-center ${G?"text-red-600 font-medium":ae?"text-orange-600":"text-gray-500"}`,children:[G?" Vencido":ae?" Por vencer":"Hasta"," ",B.consumeBy]})]}),e.jsx(In,{className:"bg-gray-50/70 border-t border-gray-100 p-0 md:p-0",children:e.jsxs("div",{className:"flex justify-center gap-1 w-full px-2 py-2",children:[Qb.filter(Y=>Y.key!==W.key).map(Y=>{const X=ej[Y.key],se=Y.key==="in-stock"?"text-green-600 hover:bg-green-50":Y.key==="low-stock"?"text-yellow-600 hover:bg-yellow-50":"text-blue-600 hover:bg-blue-50";return e.jsxs(Hs,{children:[e.jsx(Us,{asChild:!0,children:e.jsx($,{variant:"ghost",size:"sm",className:`h-8 w-8 p-0 ${se}`,onClick:H=>{H.stopPropagation(),s(B.id,Y.key)},children:e.jsx(X,{className:"w-4 h-4"})})}),e.jsxs(Ls,{children:["Mover a ",Y.title]})]},Y.key)}),e.jsxs(Hs,{children:[e.jsx(Us,{asChild:!0,children:e.jsx($,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-gray-600 hover:bg-gray-50",onClick:Y=>{Y.stopPropagation(),n(B)},children:e.jsx(Sl,{className:"w-4 h-4"})})}),e.jsx(Ls,{children:"Ver detalles"})]}),e.jsxs(Hs,{children:[e.jsx(Us,{asChild:!0,children:e.jsx($,{variant:"ghost",size:"sm",className:`h-8 w-8 p-0 ${B.nextPurchase?"text-yellow-600 hover:bg-yellow-50":"text-gray-600 hover:bg-gray-50"}`,onClick:Y=>{Y.stopPropagation(),r(B)},children:e.jsx(fw,{className:"w-4 h-4",...B.nextPurchase&&{fill:"currentColor"}})})}),e.jsx(Ls,{children:B.nextPurchase?"Quitar de prxima compra":"Marcar prxima compra"})]})]})})]},B.id)}),U.filter(B=>B.status===W.key).length===0&&e.jsx("div",{className:"text-center py-8 text-gray-400 border-2 border-dashed border-gray-200 rounded-lg",children:e.jsx("div",{className:"text-sm",children:"Sin elementos"})})]})]},W.key))})]})})},hW=({items:t,onEdit:s,onDelete:n,onUpdate:r})=>{const[a,i]=f.useState(""),[o,c]=f.useState("az"),[u,d]=f.useState(""),[h,p]=f.useState(""),[g,x]=f.useState(""),[y,b]=f.useState(!1),[v,w]=f.useState(!1),[N,S]=f.useState(!1),[E,k]=f.useState(!1),[D,T]=f.useState(!1),{isMobile:R}=vd(),O=f.useMemo(()=>Array.from(new Set(t.map(P=>P.place).filter(Boolean))),[t]),U=f.useMemo(()=>Array.from(new Set(t.map(P=>P.category).filter(Boolean))),[t]),I=f.useMemo(()=>{let P=t.filter(G=>G.name.toLowerCase().includes(a.toLowerCase()));if(u&&(P=P.filter(G=>G.place===u)),h&&(P=P.filter(G=>G.status===h)),g&&(g==="__empty"?P=P.filter(G=>!G.category):P=P.filter(G=>G.category===g)),N&&(P=P.filter(G=>G.price===void 0)),y&&(P=P.filter(G=>G.status==="to-buy")),v&&(P=P.filter(G=>G.nextPurchase)),E){const G=os(new Date,3);P=P.filter(ae=>{if(!ae.consumeBy)return!1;const Y=new Date(ae.consumeBy);return Is(Y,G)})}let z=[...P];switch(o){case"az":z.sort((G,ae)=>G.name.localeCompare(ae.name));break;case"za":z.sort((G,ae)=>ae.name.localeCompare(G.name));break;case"category":z.sort((G,ae)=>(G.category||"").localeCompare(ae.category||""));break}return z},[t,a,u,h,g,N,y,v,E,o]),_=f.useMemo(()=>I.reduce((P,z)=>z.status==="to-buy"&&z.price!==void 0?P+z.price*z.stock:P,0),[I]),M=P=>{switch(P){case"in-stock":return"default";case"low-stock":return"secondary";case"to-buy":return"destructive";default:return"outline"}},W=P=>{switch(P){case"in-stock":return"En Stock";case"low-stock":return"Poco Stock";case"to-buy":return"Por Comprar";default:return P}},B=P=>{const z=P.stock-1;z===0?r(P.id,{stock:1,status:"to-buy"}):z>0&&r(P.id,{stock:z})};return e.jsxs("div",{className:"space-y-4",children:[e.jsx(aE,{query:a,onQueryChange:i,sort:o,onSortChange:c,placeFilter:u,onPlaceFilterChange:d,statusFilter:h,onStatusFilterChange:p,categoryFilter:g,onCategoryFilterChange:x,onlyToBuy:y,onOnlyToBuyChange:b,nextOnly:v,onNextOnlyChange:w,expireSoonOnly:E,onExpireSoonOnlyChange:k,noPriceOnly:N,onNoPriceOnlyChange:S,places:O,categories:U,filtersOpen:D,setFiltersOpen:T,isMobile:R}),e.jsxs("div",{className:"text-right font-medium",children:["Total pendiente: ",new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP"}).format(_)]}),I.length===0?e.jsx(Ce,{className:"p-6 text-center",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx(lo,{className:"h-12 w-12 text-gray-400"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-600",children:"No hay productos"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"No se encontraron productos con los filtros aplicados"})]})]})}):e.jsx(Ce,{children:e.jsxs(Ae,{className:"p-0",children:[e.jsxs("div",{className:"hidden md:grid grid-cols-12 gap-4 p-4 bg-gray-50 border-b text-sm font-medium text-gray-700",children:[e.jsx("div",{className:"col-span-3",children:"Producto"}),e.jsx("div",{className:"col-span-2 text-center",children:"Categora"}),e.jsx("div",{className:"col-span-2 text-center",children:"Estado"}),e.jsx("div",{className:"col-span-2 text-center",children:"Cantidad"}),e.jsx("div",{className:"col-span-2 text-center",children:"Precio"}),e.jsx("div",{className:"col-span-1 text-center",children:"Acciones"})]}),e.jsx("div",{className:"divide-y divide-gray-100",children:I.map((P,z)=>e.jsxs("div",{className:`hover:bg-gray-50 transition-colors ${z%2===0?"bg-white":"bg-gray-50/50"}`,children:[e.jsx("div",{className:"md:hidden p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:P.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(Mt,{variant:M(P.status),className:"text-xs",children:W(P.status)}),P.category&&e.jsx(Mt,{variant:"outline",className:"text-xs",children:dd(P.category)})]})]}),e.jsx("div",{className:"text-sm font-medium text-gray-900",children:P.price!==void 0&&e.jsx("span",{className:"text-green-600",children:new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP"}).format(P.price)})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(lo,{className:"h-3 w-3"}),P.stock]}),P.place&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(cp,{className:"h-3 w-3"}),P.place]}),P.consumeBy&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ns,{className:"h-3 w-3"}),P.consumeBy]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx($,{variant:"ghost",size:"sm",onClick:()=>r(P.id,{stock:P.stock+1}),className:"h-6 w-6 p-0",children:e.jsx(Fo,{className:"h-3 w-3"})}),e.jsx("span",{className:"text-xs min-w-[1.5rem] text-center",children:P.stock}),e.jsx($,{variant:"ghost",size:"sm",onClick:()=>B(P),className:"h-6 w-6 p-0",children:e.jsx(Gn,{className:"h-3 w-3"})}),e.jsx($,{variant:"ghost",size:"sm",onClick:()=>s(P),className:"h-6 w-6 p-0 text-blue-600 ml-1",children:e.jsx(jr,{className:"h-3 w-3"})}),e.jsx($,{variant:"ghost",size:"sm",onClick:()=>n(P.id),className:"h-6 w-6 p-0 text-red-600",children:e.jsx(oo,{className:"h-3 w-3"})})]})]})]})}),e.jsxs("div",{className:"hidden md:grid grid-cols-12 gap-4 p-4",children:[e.jsx("div",{className:"col-span-3",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:P.name}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[P.place&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(cp,{className:"h-3 w-3"}),P.place]}),P.consumeBy&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ns,{className:"h-3 w-3"}),P.consumeBy]})]})]})}),e.jsx("div",{className:"col-span-2 flex justify-center items-center",children:P.category?e.jsx(Mt,{variant:"outline",className:"text-xs",children:dd(P.category)}):e.jsx("span",{className:"text-xs text-gray-400",children:"Sin categora"})}),e.jsx("div",{className:"col-span-2 flex justify-center items-center",children:e.jsx(Mt,{variant:M(P.status),className:"text-xs",children:W(P.status)})}),e.jsx("div",{className:"col-span-2 flex justify-center items-center",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{variant:"ghost",size:"sm",onClick:()=>B(P),className:"h-6 w-6 p-0",children:e.jsx(Gn,{className:"h-3 w-3"})}),e.jsx("span",{className:"text-sm font-medium min-w-[2rem] text-center",children:P.stock}),e.jsx($,{variant:"ghost",size:"sm",onClick:()=>r(P.id,{stock:P.stock+1}),className:"h-6 w-6 p-0",children:e.jsx(Fo,{className:"h-3 w-3"})})]})}),e.jsx("div",{className:"col-span-2 flex justify-center items-center",children:P.price!==void 0?e.jsx("span",{className:"text-sm font-medium text-green-600",children:new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP"}).format(P.price)}):e.jsx("span",{className:"text-xs text-gray-400",children:"Sin precio"})}),e.jsxs("div",{className:"col-span-1 flex justify-center items-center gap-1",children:[e.jsx($,{variant:"ghost",size:"sm",onClick:()=>s(P),className:"h-7 w-7 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",title:"Editar producto",children:e.jsx(jr,{className:"h-3 w-3"})}),e.jsx($,{variant:"ghost",size:"sm",onClick:()=>n(P.id),className:"h-7 w-7 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",title:"Eliminar producto",children:e.jsx(oo,{className:"h-3 w-3"})})]})]})]},P.id))})]})})]})},fW=()=>{const{items:t,addItem:s,updateItem:n,deleteItem:r,moveItem:a}=Jl(),[i,o]=f.useState(!1),c=Ln(),u=Qt(),[d,h]=f.useState(null),[p,g]=f.useState("kanban"),[x,y]=f.useState(!1),b=(v,w)=>{w?n(w,v):s(v)};return e.jsxs("div",{className:"w-full h-full flex flex-col",children:[e.jsxs(lh,{title:"Lista de Compras",children:[e.jsx(Mr,{children:e.jsxs("div",{className:"hidden md:flex items-center gap-2",children:[e.jsxs(nE,{type:"single",value:p,onValueChange:v=>v&&g(v),children:[e.jsxs(Hs,{children:[e.jsx(Us,{asChild:!0,children:e.jsx(Kp,{value:"kanban","aria-label":"Kanban",children:e.jsx(ew,{className:"w-4 h-4"})})}),e.jsx(Ls,{children:e.jsx("p",{children:"Vista Kanban"})})]}),e.jsxs(Hs,{children:[e.jsx(Us,{asChild:!0,children:e.jsx(Kp,{value:"list","aria-label":"Lista",children:e.jsx(IO,{className:"w-4 h-4"})})}),e.jsx(Ls,{children:e.jsx("p",{children:"Vista Lista"})})]})]}),e.jsxs(Hs,{children:[e.jsx(Us,{asChild:!0,children:e.jsxs($,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>o(!0),children:[e.jsx(cs,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Agregar"})]})}),e.jsx(Ls,{children:e.jsx("p",{children:"Agregar"})})]}),e.jsxs(Hs,{children:[e.jsx(Us,{asChild:!0,children:e.jsxs($,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>y(!0),children:[e.jsx(br,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Exportar"})]})}),e.jsx(Ls,{children:e.jsx("p",{children:"Exportar"})})]}),e.jsxs(Hs,{children:[e.jsx(Us,{asChild:!0,children:e.jsxs($,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>u("/shopping/run"),children:[e.jsx(Sn,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Ir de compras"})]})}),e.jsx(Ls,{children:e.jsx("p",{children:"Ir de compras"})})]})]})}),e.jsxs(oa,{children:[e.jsx(la,{asChild:!0,children:e.jsxs($,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 md:hidden",children:[e.jsx(gd,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Opciones"})]})}),e.jsxs(Pr,{align:"end",children:[e.jsxs(Ft,{onClick:()=>o(!0),children:[e.jsx(cs,{className:"mr-2 h-4 w-4"}),"Agregar"]}),e.jsxs(Ft,{onClick:()=>y(!0),children:[e.jsx(br,{className:"mr-2 h-4 w-4"}),"Exportar ingredientes"]}),e.jsxs(Ft,{onClick:()=>u("/shopping/run"),children:[e.jsx(Sn,{className:"mr-2 h-4 w-4"}),"Ir de compras"]}),e.jsx(Yl,{}),c.pathname!=="/meal"&&e.jsx(Ft,{asChild:!0,children:e.jsxs(Nn,{to:"/meal",className:"flex items-center",children:[e.jsx(ns,{className:"mr-2 h-4 w-4"}),"Plan de Comidas"]})}),c.pathname!=="/shopping-list"&&e.jsx(Ft,{asChild:!0,children:e.jsxs(Nn,{to:"/shopping-list",className:"flex items-center",children:[e.jsx(Ia,{className:"mr-2 h-4 w-4"}),"Lista de Compras"]})}),c.pathname!=="/recipes"&&e.jsx(Ft,{asChild:!0,children:e.jsxs(Nn,{to:"/recipes",className:"flex items-center",children:[e.jsx(zl,{className:"mr-2 h-4 w-4"}),"Recetas"]})}),c.pathname!=="/prepared-meals"&&e.jsx(Ft,{asChild:!0,children:e.jsxs(Nn,{to:"/prepared-meals",className:"flex items-center",children:[e.jsx(lo,{className:"mr-2 h-4 w-4"}),"Comidas Preparadas"]})})]})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4 space-y-4",children:t.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("p",{className:"text-lg",children:"No hay elementos en tu lista"}),e.jsx("p",{className:"text-sm",children:'Haz clic en "Agregar" para comenzar'})]}):p==="kanban"?e.jsx(mW,{items:t,onMove:a,onView:h,onToggleNext:v=>n(v.id,{nextPurchase:!v.nextPurchase}),onUpdateQuantity:(v,w,N)=>{n(v,{[w]:N})}}):e.jsx(hW,{items:t,onEdit:h,onDelete:r,onUpdate:n})}),e.jsx(lW,{open:i||!!d,onOpenChange:()=>{o(!1),h(null)},onSave:b,onDelete:v=>r(v),item:d||void 0}),e.jsx(rW,{open:x,onOpenChange:y})]})},pW=()=>e.jsx(ln,{noPadding:!0,className:"h-full",children:e.jsx(fW,{})}),xW=({open:t,onOpenChange:s,onSave:n,recipe:r})=>{const[a,i]=f.useState(""),[o,c]=f.useState(""),[u,d]=f.useState(""),[h,p]=f.useState(""),[g,x]=f.useState("fcil"),[y,b]=f.useState(""),[v,w]=f.useState(""),[N,S]=f.useState(""),[E,k]=f.useState(""),[D,T]=f.useState(""),[R,O]=f.useState("breakfast");f.useEffect(()=>{r?(i(r.name),c(r.description||""),d(r.ingredients.map(I=>`${I.quantity} ${I.name}`).join(`
`)),p(r.instructions),x(r.difficulty||"fcil"),b(r.prepTime!==void 0?String(r.prepTime):""),w(String(r.nutrition.calories)),S(String(r.nutrition.protein)),k(String(r.nutrition.carbs)),T(String(r.nutrition.fat)),O(r.mealType)):(i(""),c(""),d(""),p(""),x("fcil"),b(""),w(""),S(""),k(""),T(""),O("breakfast"))},[r,t]);const U=()=>{const I=u.split(`
`).map(M=>M.trim()).filter(Boolean).map(M=>{const[W,...B]=M.split(" ");return{quantity:W,name:B.join(" ")}}),_={name:a,ingredients:I,description:o.trim()||void 0,difficulty:g,prepTime:y?Number(y):void 0,instructions:h,nutrition:{calories:Number(v)||0,protein:Number(N)||0,carbs:Number(E)||0,fat:Number(D)||0},mealType:R};r?n(_,r.id):n(_),s(!1)};return e.jsx(kt,{open:t,onOpenChange:s,children:e.jsxs(wt,{className:"sm:max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsx(At,{children:e.jsxs(_t,{children:[r?"Editar":"Agregar"," Receta"]})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(ze,{htmlFor:"name",children:"Nombre"}),e.jsx(Fe,{id:"name",value:a,onChange:I=>i(I.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ze,{htmlFor:"description",children:"Descripcin (opcional)"}),e.jsx(It,{id:"description",value:o,onChange:I=>c(I.target.value),className:"min-h-[80px]"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(ze,{htmlFor:"difficulty",children:"Dificultad"}),e.jsxs(Tt,{value:g,onValueChange:I=>x(I),children:[e.jsx(vt,{id:"difficulty",children:e.jsx(Dt,{})}),e.jsxs(yt,{children:[e.jsx(Pe,{value:"fcil",children:"Fcil"}),e.jsx(Pe,{value:"media",children:"Media"}),e.jsx(Pe,{value:"difcil",children:"Difcil"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ze,{htmlFor:"prepTime",children:"Tiempo (min)"}),e.jsx(Fe,{id:"prepTime",type:"number",value:y,onChange:I=>b(I.target.value)})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ze,{htmlFor:"ingredients",children:"Ingredientes (uno por lnea)"}),e.jsx(It,{id:"ingredients",value:u,onChange:I=>d(I.target.value),className:"min-h-[120px]"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ze,{htmlFor:"instructions",children:"Instrucciones"}),e.jsx(It,{id:"instructions",value:h,onChange:I=>p(I.target.value),className:"min-h-[120px]"})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(ze,{htmlFor:"calories",children:"Caloras"}),e.jsx(Fe,{id:"calories",type:"number",value:v,onChange:I=>w(I.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ze,{htmlFor:"protein",children:"Protena (g)"}),e.jsx(Fe,{id:"protein",type:"number",value:N,onChange:I=>S(I.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ze,{htmlFor:"carbs",children:"Carbs (g)"}),e.jsx(Fe,{id:"carbs",type:"number",value:E,onChange:I=>k(I.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ze,{htmlFor:"fat",children:"Grasa (g)"}),e.jsx(Fe,{id:"fat",type:"number",value:D,onChange:I=>T(I.target.value)})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ze,{htmlFor:"mealType",children:"Tipo de comida"}),e.jsxs(Tt,{value:R,onValueChange:I=>O(I),children:[e.jsx(vt,{id:"mealType",children:e.jsx(Dt,{})}),e.jsx(yt,{children:Object.entries(wn).map(([I,_])=>e.jsx(Pe,{value:I,children:_.title},I))})]})]})]}),e.jsx(Cn,{children:e.jsx($,{onClick:U,children:"Guardar"})})]})})},gW=({open:t,onOpenChange:s})=>{const{recipes:n}=oh(),r={title:"Exportar Recetas",modules:[{id:"recipes",label:"Recetas",description:"Recetas con campos y opciones personalizables",icon:e.jsx(md,{className:"w-4 h-4"}),fields:[{id:"allRecipes",label:"Todas las recetas",description:"Incluir todas las recetas (por defecto solo favoritas)"},{id:"groupByMealType",label:"Agrupar por tipo de comida",description:"Organizar por desayuno, almuerzo, cena, etc."},{id:"groupByDifficulty",label:"Agrupar por dificultad",description:"Organizar por nivel de dificultad"},{id:"name",label:"Nombre",description:"Nombre de la receta"},{id:"description",label:"Descripcin",description:"Descripcin de la receta"},{id:"difficulty",label:"Dificultad",description:"Nivel de dificultad (fcil, media, difcil)"},{id:"prepTime",label:"Tiempo de preparacin",description:"Tiempo estimado en minutos"},{id:"ingredients",label:"Ingredientes",description:"Lista de ingredientes con cantidades"},{id:"instructions",label:"Pasos de preparacin",description:"Instrucciones detalladas"},{id:"nutrition",label:"Informacin nutricional",description:"Caloras, protenas, carbohidratos, grasas"},{id:"mealType",label:"Tipo de comida",description:"Categora de la comida"},{id:"favorite",label:"Estado favorito",description:"Si la receta est marcada como favorita"}],dataGenerator:(a,i)=>{const o=a.includes("allRecipes"),c=o?n:n.filter(d=>d.favorite===!0),u=d=>{const h={};return a.filter(g=>g!=="allRecipes"&&g!=="groupByMealType"&&g!=="groupByDifficulty").length===0?{name:d.name,description:d.description,difficulty:d.difficulty,prepTime:d.prepTime,ingredients:d.ingredients,instructions:d.instructions,nutrition:d.nutrition,mealType:d.mealType,favorite:d.favorite}:(a.includes("name")&&(h.name=d.name),a.includes("description")&&d.description&&(h.description=d.description),a.includes("difficulty")&&d.difficulty&&(h.difficulty=d.difficulty),a.includes("prepTime")&&d.prepTime&&(h.prepTime=d.prepTime),a.includes("ingredients")&&(h.ingredients=d.ingredients),a.includes("instructions")&&(h.instructions=d.instructions),a.includes("nutrition")&&(h.nutrition=d.nutrition),a.includes("mealType")&&(h.mealType=d.mealType),a.includes("favorite")&&(h.favorite=d.favorite),h)};return a.includes("groupByMealType")&&a.includes("groupByDifficulty")?{recetas:c.reduce((h,p)=>{const g=p.mealType,x=p.difficulty||"sin_especificar";return h[g]||(h[g]={}),h[g][x]||(h[g][x]=[]),h[g][x].push(u(p)),h},{})}:a.includes("groupByMealType")?{recetas:c.reduce((h,p)=>{const g=p.mealType;return h[g]||(h[g]=[]),h[g].push(u(p)),h},{})}:a.includes("groupByDifficulty")?{recetas:c.reduce((h,p)=>{const g=p.difficulty||"sin_especificar";return h[g]||(h[g]=[]),h[g].push(u(p)),h},{})}:{recetas:c.map(u),total:c.length,tipo:o?"todas":"favoritas",exportedAt:new Date().toISOString()}}}]};return e.jsx(jg,{open:t,onOpenChange:s,config:r})},tj=({recipes:t,iconOnly:s=!1,className:n})=>{const[r,a]=f.useState(!1),i=()=>{a(!0)};return e.jsxs(e.Fragment,{children:[s?e.jsxs($,{variant:"ghost",size:"sm",className:`h-8 w-8 p-0 ${n}`,onClick:i,children:[e.jsx(br,{className:"w-4 h-4"}),e.jsx("span",{className:"sr-only",children:"Exportar"})]}):e.jsxs($,{variant:"outline",size:"sm",onClick:i,className:`flex items-center gap-2 ${n}`,children:[e.jsx(br,{className:"w-4 h-4"}),"Exportar"]}),e.jsx(gW,{open:r,onOpenChange:a})]})},vW=()=>{const{recipes:t,addRecipe:s,updateRecipe:n}=oh(),[r,a]=f.useState(!1),i=Ln(),[o,c]=f.useState(null),[u,d]=f.useState(""),[h,p]=f.useState(""),[g,x]=f.useState("az"),y=f.useMemo(()=>{let v=t.filter(N=>N.name.toLowerCase().includes(u.toLowerCase()));h&&(v=v.filter(N=>N.mealType===h));const w=[...v];return w.sort((N,S)=>g==="az"?N.name.localeCompare(S.name):S.name.localeCompare(N.name)),w},[t,u,h,g]),b=(v,w)=>{w?n(w,v):s(v)};return e.jsxs("div",{className:"w-full h-full flex flex-col",children:[e.jsxs(lh,{title:"Recetas",children:[e.jsx(Mr,{children:e.jsxs("div",{className:"hidden md:flex items-center gap-2",children:[e.jsxs(Hs,{children:[e.jsx(Us,{asChild:!0,children:e.jsxs($,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>a(!0),children:[e.jsx(cs,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Agregar"})]})}),e.jsx(Ls,{children:e.jsx("p",{children:"Agregar"})})]}),e.jsxs(Hs,{children:[e.jsx(Us,{asChild:!0,children:e.jsx(tj,{recipes:t,iconOnly:!0})}),e.jsx(Ls,{children:e.jsx("p",{children:"Exportar"})})]})]})}),e.jsxs(oa,{children:[e.jsx(la,{asChild:!0,children:e.jsxs($,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 md:hidden",children:[e.jsx(gd,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Opciones"})]})}),e.jsxs(Pr,{align:"end",children:[e.jsxs(Ft,{onClick:()=>a(!0),children:[e.jsx(cs,{className:"mr-2 h-4 w-4"}),"Agregar"]}),e.jsx(Ft,{asChild:!0,children:e.jsx(tj,{recipes:t})}),e.jsx(Yl,{}),i.pathname!=="/meal"&&e.jsx(Ft,{asChild:!0,children:e.jsxs(Nn,{to:"/meal",className:"flex items-center",children:[e.jsx(ns,{className:"mr-2 h-4 w-4"}),"Plan de Comidas"]})}),i.pathname!=="/shopping-list"&&e.jsx(Ft,{asChild:!0,children:e.jsxs(Nn,{to:"/shopping-list",className:"flex items-center",children:[e.jsx(Ia,{className:"mr-2 h-4 w-4"}),"Lista de Compras"]})}),i.pathname!=="/recipes"&&e.jsx(Ft,{asChild:!0,children:e.jsxs(Nn,{to:"/recipes",className:"flex items-center",children:[e.jsx(zl,{className:"mr-2 h-4 w-4"}),"Recetas"]})}),i.pathname!=="/prepared-meals"&&e.jsx(Ft,{asChild:!0,children:e.jsxs(Nn,{to:"/prepared-meals",className:"flex items-center",children:[e.jsx(lo,{className:"mr-2 h-4 w-4"}),"Comidas Preparadas"]})})]})]})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsxs("div",{className:"p-4 space-y-4 h-full overflow-y-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start",children:[e.jsx(Fe,{placeholder:"Buscar",value:u,onChange:v=>d(v.target.value),className:"sm:w-60"}),e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsxs(Tt,{value:g,onValueChange:v=>x(v),children:[e.jsx(vt,{className:"w-32",children:e.jsx(Dt,{placeholder:"Ordenar"})}),e.jsxs(yt,{children:[e.jsx(Pe,{value:"az",children:"Nombre A-Z"}),e.jsx(Pe,{value:"za",children:"Nombre Z-A"})]})]}),e.jsxs(Tt,{value:h||"all",onValueChange:v=>p(v==="all"?"":v),children:[e.jsx(vt,{className:"w-40",children:e.jsx(Dt,{placeholder:"Tipo"})}),e.jsxs(yt,{children:[e.jsx(Pe,{value:"all",children:"Todos"}),Object.entries(wn).map(([v,w])=>e.jsx(Pe,{value:v,children:w.title},v))]})]})]})]}),y.length===0?e.jsx("p",{className:"text-center text-gray-500",children:"No hay recetas guardadas"}):e.jsx("div",{className:"space-y-4",children:y.map(v=>e.jsxs(Ce,{children:[e.jsxs(Kt,{className:"flex flex-row items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(Gt,{className:"text-base",children:v.name}),e.jsx(Gi,{children:wn[v.mealType].title})]}),e.jsx($,{variant:"ghost",size:"sm",onClick:()=>{c(v),a(!0)},children:"Editar"})]}),e.jsxs(Ae,{className:"space-y-2",children:[v.description&&e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:v.description}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Dificultad:"})," ",v.difficulty||"N/A"," |"," ",e.jsx("span",{className:"font-medium",children:"Tiempo:"})," ",v.prepTime?`${v.prepTime} min`:"N/A"]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Ingredientes:"}),e.jsx("ul",{className:"list-disc pl-4 text-sm",children:v.ingredients.map((w,N)=>e.jsxs("li",{children:[w.quantity," ",w.name]},N))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Instrucciones:"}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:v.instructions})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Informacin Nutricional:"}),e.jsxs("p",{className:"text-sm",children:[v.nutrition.calories," kcal |"," ",v.nutrition.protein,"g P |"," ",v.nutrition.carbs,"g C |"," ",v.nutrition.fat,"g G"]})]})]})]},v.id))})]})}),e.jsx(xW,{open:r,onOpenChange:v=>{v||c(null),a(v)},onSave:b,recipe:o||void 0})]})},yW=()=>e.jsx(ln,{noPadding:!0,className:"h-full",children:e.jsx(vW,{})}),bW=({open:t,onOpenChange:s,onSave:n,meal:r})=>{const[a,i]=f.useState(""),[o,c]=f.useState("");f.useEffect(()=>{r?(i(r.name),c(r.portions!==void 0?String(r.portions):"")):(i(""),c(""))},[r,t]);const u=()=>{const d={name:a};o&&(d.portions=Number(o)),n(d,r==null?void 0:r.id),s(!1)};return e.jsx(kt,{open:t,onOpenChange:s,children:e.jsxs(wt,{className:"sm:max-w-md",children:[e.jsx(At,{children:e.jsxs(_t,{children:[r?"Editar":"Agregar"," Comida Preparada"]})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(ze,{htmlFor:"pm-name",children:"Nombre"}),e.jsx(Fe,{id:"pm-name",value:a,onChange:d=>i(d.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(ze,{htmlFor:"pm-portions",children:"Cantidad/Porciones (opcional)"}),e.jsx(Fe,{id:"pm-portions",type:"number",value:o,onChange:d=>c(d.target.value)})]})]}),e.jsx(Cn,{children:e.jsx($,{onClick:u,children:"Guardar"})})]})})},jW=()=>{const{meals:t,addMeal:s,updateMeal:n,deleteMeal:r}=bg(),[a,i]=f.useState(!1),o=Ln(),[c,u]=f.useState(null),d=(h,p)=>{p?n(p,h):s(h)};return e.jsxs("div",{className:"w-full h-full flex flex-col",children:[e.jsxs(lh,{title:"Comidas Preparadas",children:[e.jsx(Mr,{children:e.jsx("div",{className:"hidden md:flex items-center gap-2",children:e.jsxs(Hs,{children:[e.jsx(Us,{asChild:!0,children:e.jsxs($,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>i(!0),children:[e.jsx(cs,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Agregar"})]})}),e.jsx(Ls,{children:e.jsx("p",{children:"Agregar"})})]})})}),e.jsxs(oa,{children:[e.jsx(la,{asChild:!0,children:e.jsxs($,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 md:hidden",children:[e.jsx(gd,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Opciones"})]})}),e.jsxs(Pr,{align:"end",children:[e.jsxs(Ft,{onClick:()=>i(!0),children:[e.jsx(cs,{className:"mr-2 h-4 w-4"}),"Agregar"]}),e.jsx(Yl,{}),o.pathname!=="/meal"&&e.jsx(Ft,{asChild:!0,children:e.jsxs(Nn,{to:"/meal",className:"flex items-center",children:[e.jsx(ns,{className:"mr-2 h-4 w-4"}),"Plan de Comidas"]})}),o.pathname!=="/shopping-list"&&e.jsx(Ft,{asChild:!0,children:e.jsxs(Nn,{to:"/shopping-list",className:"flex items-center",children:[e.jsx(Ia,{className:"mr-2 h-4 w-4"}),"Lista de Compras"]})}),o.pathname!=="/recipes"&&e.jsx(Ft,{asChild:!0,children:e.jsxs(Nn,{to:"/recipes",className:"flex items-center",children:[e.jsx(zl,{className:"mr-2 h-4 w-4"}),"Recetas"]})}),o.pathname!=="/prepared-meals"&&e.jsx(Ft,{asChild:!0,children:e.jsxs(Nn,{to:"/prepared-meals",className:"flex items-center",children:[e.jsx(lo,{className:"mr-2 h-4 w-4"}),"Comidas Preparadas"]})})]})]})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx("div",{className:"p-4 space-y-4 h-full overflow-y-auto",children:t.length===0?e.jsx("p",{className:"text-center text-gray-500",children:"No hay comidas guardadas"}):e.jsx("div",{className:"space-y-2",children:t.map(h=>e.jsxs("div",{className:"flex justify-between items-center border p-2 rounded",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:h.name}),h.portions!==void 0&&e.jsxs("p",{className:"text-sm text-gray-500",children:["Porciones: ",h.portions]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{variant:"ghost",size:"sm",onClick:()=>{u(h),i(!0)},children:"Editar"}),e.jsx($,{variant:"ghost",size:"sm",onClick:()=>r(h.id),children:"Eliminar"})]})]},h.id))})})}),e.jsx(bW,{open:a||!!c,onOpenChange:h=>{h||u(null),i(h)},onSave:d,meal:c||void 0})]})},wW=()=>e.jsx(ln,{noPadding:!0,className:"h-full",children:e.jsx(jW,{})}),NW=t=>{const[s,n]=f.useState(null),[r,a]=f.useState("idle"),[i,o]=f.useState(null),{user:c}=Je(),u=y=>y.reduce((b,v)=>{const w=so.find(S=>S.id===v.exerciseId);if(!w)return b;b.totalCalories+=v.calories||0,b.totalSteps+=v.steps||0,b.totalDuration+=v.duration||0,b.totalDistance+=v.distance||0;const N=b.categoryStats[w.category];return N.count+=1,N.duration+=v.duration||0,N.calories+=v.calories||0,b},{totalCalories:0,totalSteps:0,totalDuration:0,totalDistance:0,categoryStats:{cardio:{count:0,duration:0,calories:0},strength:{count:0,duration:0,calories:0},flexibility:{count:0,duration:0,calories:0}}}),d=f.useCallback(async()=>{if(c){a("loading"),o(null);try{const y=Ie(t);Me.logRead("exercises","useExerciseData.loadData",`${c.uid}_${y}`);const b=ke(xe,"exercises",`${c.uid}_${y}`),v=await ot(b);v.exists()?n(v.data()):n(null),a("saved")}catch(y){o(y instanceof Error?y.message:"Error al cargar ejercicios"),a("error")}}},[c,t]);f.useEffect(()=>{d()},[d]);const h=async y=>{if(!c)return;a("saving"),o(null);const b=Ie(t),v=ke(xe,"exercises",`${c.uid}_${b}`),w=(s==null?void 0:s.exercises)||[];w.push(y);const N=u(w),S={userId:c.uid,date:b,exercises:w,summary:N,createdAt:(s==null?void 0:s.createdAt)||ht(),updatedAt:ht()};n(S),a("saved");try{Me.logWrite("exercises","useExerciseData.logExercise",`${c.uid}_${b}`),await Zt(v,S)}catch(E){n(s),o(E instanceof Error?E.message:"Error al guardar ejercicio"),a("error")}},p=async(y,b)=>{if(!c||!s)return;a("saving"),o(null);const v=s,w=[...s.exercises];w[y]={...w[y],...b};const N=u(w),S={...s,exercises:w,summary:N,updatedAt:ht()};n(S),a("saved");try{const E=Ie(t),k=ke(xe,"exercises",`${c.uid}_${E}`);Me.logWrite("exercises","useExerciseData.updateExerciseLog",`${c.uid}_${E}`),await Zt(k,S)}catch(E){n(v),o(E instanceof Error?E.message:"Error al actualizar ejercicio"),a("error")}},g=async y=>{if(!c||!s)return;a("saving"),o(null);const b=s,v=s.exercises.filter((w,N)=>N!==y);if(v.length===0)n(null);else{const w=u(v),N={...s,exercises:v,summary:w,updatedAt:ht()};n(N)}a("saved");try{const w=Ie(t),N=ke(xe,"exercises",`${c.uid}_${w}`);if(v.length===0)Me.logDelete("exercises","useExerciseData.deleteExerciseLog.delete",`${c.uid}_${w}`),await Vo(N);else{const S=u(v),E={...s,exercises:v,summary:S,updatedAt:ht()};Me.logWrite("exercises","useExerciseData.deleteExerciseLog.update",`${c.uid}_${w}`),await Zt(N,E)}}catch(w){n(b),o(w instanceof Error?w.message:"Error al eliminar ejercicio"),a("error")}},x=Ha("Exercise data");return{exerciseLogs:(s==null?void 0:s.exercises)||[],summary:s==null?void 0:s.summary,status:r,error:i,logExercise:h,updateExerciseLog:p,deleteExerciseLog:g,loadExerciseData:d,resync:x}},SW=({exerciseLogs:t,onUpdate:s,onDelete:n,isLoading:r})=>{if(r)return e.jsx("div",{className:"text-center py-8",children:"Cargando ejercicios..."});if(t.length===0)return e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No hay ejercicios registrados para este da"});const a=c=>{if(!so.find(h=>h.id===c.exerciseId))return"";const d=[];return c.sets&&c.reps&&d.push(`${c.sets} series x ${c.reps} repeticiones`),c.duration&&d.push(`${c.duration} minutos`),c.distance&&d.push(`${(c.distance/1e3).toFixed(2)} km`),c.steps&&d.push(`${c.steps.toLocaleString()} pasos`),c.weight&&d.push(`${c.weight}kg`),d.join("  ")},i=c=>{const u=so.find(d=>d.id===c.exerciseId);return u?u.defaultDuration&&c.duration?c.duration/u.defaultDuration*100:u.defaultDistance&&c.distance?c.distance/u.defaultDistance*100:u.defaultSets&&u.defaultReps&&c.sets&&c.reps?c.sets*c.reps/(u.defaultSets*u.defaultReps)*100:100:0},o=()=>{const c=t.reduce((h,p)=>h+(p.calories||0),0),u=t.reduce((h,p)=>h+(p.steps||0),0),d=t.reduce((h,p)=>h+(p.duration||0),0);return c===0&&u===0?null:e.jsx(Ce,{className:"mb-6",children:e.jsxs(Ae,{className:"p-4",children:[e.jsx("h3",{className:"text-sm font-medium mb-3",children:"Resumen del da"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[c>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Zc,{className:"w-4 h-4 text-orange-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:c}),e.jsx("p",{className:"text-xs text-gray-500",children:"caloras"})]})]}),u>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pw,{className:"w-4 h-4 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:u.toLocaleString()}),e.jsx("p",{className:"text-xs text-gray-500",children:"pasos"})]})]}),d>0&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:d}),e.jsx("p",{className:"text-xs text-gray-500",children:"minutos"})]})})]})]})})};return e.jsxs("div",{className:"space-y-4",children:[o(),t.map((c,u)=>{const d=so.find(h=>h.id===c.exerciseId);return d?e.jsx(Ce,{children:e.jsxs(Ae,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:d.icon}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:d.name}),e.jsx("p",{className:"text-sm text-gray-500",children:a(c)})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{variant:"ghost",size:"icon",onClick:()=>s(u),children:e.jsx(LO,{className:"w-4 h-4"})}),e.jsx($,{variant:"ghost",size:"icon",onClick:()=>n(u),children:e.jsx(oo,{className:"w-4 h-4 text-red-500"})})]})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("div",{className:"flex justify-between text-sm",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("span",{className:`px-2 py-1 rounded-full ${X5[d.category]} text-white`,children:d.category}),c.calories&&e.jsxs("span",{className:"flex items-center gap-1 text-orange-500",children:[e.jsx(Zc,{className:"w-4 h-4"}),c.calories," kcal"]})]})}),e.jsx(lr,{value:i(c),className:"h-2"}),c.notes&&e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:c.notes})]})]})},u):null})]})},sj=({isOpen:t,onClose:s,onSubmit:n,initialData:r})=>{var x,y,b,v,w,N,S;const[a,i]=ee.useState(r?so.find(E=>E.id===r.exerciseId):null),[o,c]=ee.useState({sets:((x=r==null?void 0:r.sets)==null?void 0:x.toString())||"",reps:((y=r==null?void 0:r.reps)==null?void 0:y.toString())||"",weight:((b=r==null?void 0:r.weight)==null?void 0:b.toString())||"",duration:((v=r==null?void 0:r.duration)==null?void 0:v.toString())||"",distance:((w=r==null?void 0:r.distance)==null?void 0:w.toString())||"",steps:((N=r==null?void 0:r.steps)==null?void 0:N.toString())||"",calories:((S=r==null?void 0:r.calories)==null?void 0:S.toString())||"",notes:(r==null?void 0:r.notes)||""}),[u,d]=ee.useState(0),h=f.useCallback(()=>{if(!(a!=null&&a.caloriesPerHour))return;let E=parseInt(o.duration)||0;!E&&o.sets&&o.reps&&(E=parseInt(o.sets)*parseInt(o.reps)*3/60);let k=a.caloriesPerHour*E/60;if(o.weight&&a.category==="strength"){const T=parseInt(o.weight)/5;k*=1+T*.1}const D=Math.round(k);d(D),c(T=>({...T,calories:D.toString()}))},[a,o.duration,o.sets,o.reps,o.weight,c]);f.useEffect(()=>{if(h(),a!=null&&a.stepsPerKm&&o.distance){const E=parseFloat(o.distance),k=Math.round(E*a.stepsPerKm);c(D=>({...D,steps:k.toString()}))}},[h,o.distance,o.duration,o.weight,a]);const p=E=>{var k,D,T;i(E),c({sets:((k=E.defaultSets)==null?void 0:k.toString())||"",reps:((D=E.defaultReps)==null?void 0:D.toString())||"",weight:"",duration:((T=E.defaultDuration)==null?void 0:T.toString())||"",distance:E.defaultDistance?(E.defaultDistance/1e3).toString():"",steps:"",calories:"",notes:""})},g=E=>{if(E.preventDefault(),!a)return;const k={exerciseId:a.id,calories:o.calories?parseInt(o.calories):u,...o.sets&&{sets:parseInt(o.sets)},...o.reps&&{reps:parseInt(o.reps)},...o.weight&&{weight:parseFloat(o.weight)},...o.duration&&{duration:parseInt(o.duration)},...o.distance&&{distance:parseFloat(o.distance)*1e3},...o.steps&&{steps:parseInt(o.steps)},...o.notes&&{notes:o.notes}};n(k),s()};return e.jsx(kt,{open:t,onOpenChange:s,children:e.jsxs(wt,{className:"sm:max-w-[700px] max-h-[90vh] sm:h-auto overflow-y-auto",children:[e.jsx(At,{className:"sticky top-0 bg-background z-10 pb-4 mb-4 border-b",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs(_t,{className:"flex items-center gap-2 text-xl",children:[a&&!r&&e.jsx($,{type:"button",variant:"ghost",size:"icon",onClick:()=>i(null),className:"h-8 w-8",children:e.jsx(El,{className:"h-5 w-5"})}),r?"Editar ejercicio":"Agregar ejercicio"]})})}),e.jsx("form",{onSubmit:g,className:"space-y-6 pt-2",children:a?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("span",{className:"text-3xl",children:a.icon}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-lg",children:a.name}),e.jsx("p",{className:"text-sm text-gray-500",children:a.description})]})]}),a.category==="strength"&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ze,{htmlFor:"sets",children:"Series"}),e.jsx(Fe,{id:"sets",type:"number",min:"1",value:o.sets,onChange:E=>c(k=>({...k,sets:E.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ze,{htmlFor:"reps",children:"Repeticiones"}),e.jsx(Fe,{id:"reps",type:"number",min:"1",value:o.reps,onChange:E=>c(k=>({...k,reps:E.target.value}))})]}),a.name==="Pesas de mano"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(ze,{htmlFor:"weight",children:"Peso (kg)"}),e.jsx(Fe,{id:"weight",type:"number",min:"0",step:"0.5",value:o.weight,onChange:E=>c(k=>({...k,weight:E.target.value}))})]})]}),(a.category==="cardio"||a.category==="flexibility")&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ze,{htmlFor:"duration",children:"Duracin (min)"}),e.jsx(Fe,{id:"duration",type:"number",min:"1",value:o.duration,onChange:E=>c(k=>({...k,duration:E.target.value}))})]}),a.category==="cardio"&&a.name!=="Natacin"&&a.name!=="Tenis"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(ze,{htmlFor:"distance",children:"Distancia (km)"}),e.jsx(Fe,{id:"distance",type:"number",min:"0",step:"0.1",value:o.distance,onChange:E=>c(k=>({...k,distance:E.target.value}))})]})]}),a.stepsPerKm&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(ze,{htmlFor:"steps",children:["Pasos ",o.steps&&`(calculado: ${o.steps})`]}),e.jsx(Fe,{id:"steps",type:"number",min:"0",value:o.steps,onChange:E=>c(k=>({...k,steps:E.target.value})),placeholder:"Nmero de pasos"})]}),u>0&&e.jsx("div",{className:"p-4 bg-muted rounded-md",children:e.jsxs("p",{className:"text-sm font-medium text-muted-foreground",children:["Caloras estimadas: ",u," kcal"]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ze,{htmlFor:"calories",children:"Caloras"}),e.jsx(Fe,{id:"calories",type:"number",min:"0",value:o.calories,onChange:E=>c(k=>({...k,calories:E.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ze,{htmlFor:"notes",children:"Notas"}),e.jsx(It,{id:"notes",value:o.notes,onChange:E=>c(k=>({...k,notes:E.target.value})),placeholder:"Aade notas sobre el ejercicio..."})]}),e.jsxs(Cn,{className:"gap-3 sm:gap-0",children:[e.jsx($,{type:"button",variant:"outline",className:"flex-1 sm:flex-none",onClick:s,children:"Cancelar"}),e.jsx($,{type:"submit",className:"flex-1 sm:flex-none",children:r?"Actualizar":"Guardar"})]})]}):e.jsxs(ma,{defaultValue:"cardio",className:"w-full",children:[e.jsx(ha,{className:"w-full h-12 grid grid-cols-3 mb-4",children:Object.entries(Ap).map(([E,k])=>e.jsxs(Ds,{value:E,className:"flex items-center gap-2 text-base p-3",children:[e.jsx("span",{className:"text-xl",children:k.icon}),e.jsx("span",{children:k.name})]},E))}),Object.entries(Ap).map(([E])=>e.jsx(ys,{value:E,className:"mt-4",children:e.jsx("div",{className:"grid grid-cols-2 gap-3",children:so.filter(k=>k.category===E).map(k=>e.jsxs($,{type:"button",variant:"outline",className:"flex flex-col items-center p-6 h-auto gap-3",onClick:()=>p(k),children:[e.jsx("span",{className:"text-3xl",children:k.icon}),e.jsx("span",{className:"text-sm font-normal text-center",children:k.name})]},k.id))})},E))]})})]})})},CW=({exerciseLogs:t,summary:s})=>{const n=ee.useMemo(()=>s||{totalCalories:t.reduce((o,c)=>o+(c.calories||0),0),totalSteps:t.reduce((o,c)=>o+(c.steps||0),0),totalDuration:t.reduce((o,c)=>o+(c.duration||0),0),totalDistance:t.reduce((o,c)=>o+(c.distance||0),0),categoryStats:t.reduce((o,c)=>{const u=so.find(d=>d.id===c.exerciseId);return u&&(o[u.category]||(o[u.category]={count:0,duration:0,calories:0}),o[u.category].count+=1,o[u.category].duration+=c.duration||0,o[u.category].calories+=c.calories||0),o},{})},[t,s]),r=o=>new Date(o).toLocaleDateString("es-ES",{month:"short",day:"numeric"}),a=(o,c)=>typeof o=="string"?new Date(o).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):[o.toLocaleString(),c],i=ee.useMemo(()=>{const o=new Date,c=[];for(let u=6;u>=0;u--){const d=new Date(o);d.setDate(d.getDate()-u);const h=Ie(d);c.push({date:h,calories:0,steps:0,duration:0,distance:0})}return t.forEach(u=>{const d=c.find(h=>h.date===Ie(new Date));d&&(d.calories+=u.calories||0,d.steps+=u.steps||0,d.duration+=u.duration||0,d.distance+=(u.distance||0)/1e3)}),c},[t]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Ce,{children:e.jsxs(Ae,{className:"p-6 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-muted rounded-lg",children:e.jsx(Zc,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Caloras"}),e.jsx("h4",{className:"text-2xl font-bold",children:n.totalCalories})]})]})}),e.jsx(Ce,{children:e.jsxs(Ae,{className:"p-6 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-muted rounded-lg",children:e.jsx(pw,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Pasos"}),e.jsx("h4",{className:"text-2xl font-bold",children:n.totalSteps.toLocaleString()})]})]})}),e.jsx(Ce,{children:e.jsxs(Ae,{className:"p-6 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-muted rounded-lg",children:e.jsx(zo,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Tiempo"}),e.jsxs("h4",{className:"text-2xl font-bold",children:[n.totalDuration," min"]})]})]})}),e.jsx(Ce,{children:e.jsxs(Ae,{className:"p-6 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-muted rounded-lg",children:e.jsx($O,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Distancia"}),e.jsxs("h4",{className:"text-2xl font-bold",children:[(n.totalDistance/1e3).toFixed(1)," km"]})]})]})})]}),e.jsxs(Ce,{children:[e.jsx(Kt,{children:e.jsx(Gt,{children:"Progreso"})}),e.jsx(Ae,{children:e.jsxs(ma,{defaultValue:"calories",children:[e.jsxs(ha,{className:"grid grid-cols-4 h-12",children:[e.jsx(Ds,{value:"calories",className:"text-base",children:"Caloras"}),e.jsx(Ds,{value:"steps",className:"text-base",children:"Pasos"}),e.jsx(Ds,{value:"duration",className:"text-base",children:"Tiempo"}),e.jsx(Ds,{value:"distance",className:"text-base",children:"Distancia"})]}),e.jsx(ys,{value:"calories",className:"h-[300px] pt-4",children:e.jsx(On,{width:"100%",height:"100%",children:e.jsxs(Oo,{data:i,children:[e.jsx(Aa,{strokeDasharray:"3 3"}),e.jsx(Qr,{dataKey:"date",tickFormatter:r}),e.jsx(_r,{}),e.jsx(Pn,{formatter:a,labelFormatter:r}),e.jsx(ai,{}),e.jsx(Ji,{type:"monotone",dataKey:"calories",stroke:"#f97316",name:"Caloras",dot:!0})]})})}),e.jsx(ys,{value:"steps",className:"h-[300px] pt-4",children:e.jsx(On,{width:"100%",height:"100%",children:e.jsxs(Oo,{data:i,children:[e.jsx(Aa,{strokeDasharray:"3 3"}),e.jsx(Qr,{dataKey:"date",tickFormatter:r}),e.jsx(_r,{}),e.jsx(Pn,{formatter:a,labelFormatter:r}),e.jsx(ai,{}),e.jsx(Ji,{type:"monotone",dataKey:"steps",stroke:"#3b82f6",name:"Pasos",dot:!0})]})})}),e.jsx(ys,{value:"duration",className:"h-[300px] pt-4",children:e.jsx(On,{width:"100%",height:"100%",children:e.jsxs(Oo,{data:i,children:[e.jsx(Aa,{strokeDasharray:"3 3"}),e.jsx(Qr,{dataKey:"date",tickFormatter:r}),e.jsx(_r,{}),e.jsx(Pn,{formatter:a,labelFormatter:r}),e.jsx(ai,{}),e.jsx(Ji,{type:"monotone",dataKey:"duration",stroke:"#22c55e",name:"Minutos",dot:!0})]})})}),e.jsx(ys,{value:"distance",className:"h-[300px] pt-4",children:e.jsx(On,{width:"100%",height:"100%",children:e.jsxs(Oo,{data:i,children:[e.jsx(Aa,{strokeDasharray:"3 3"}),e.jsx(Qr,{dataKey:"date",tickFormatter:r}),e.jsx(_r,{}),e.jsx(Pn,{formatter:a,labelFormatter:r}),e.jsx(ai,{}),e.jsx(Ji,{type:"monotone",dataKey:"distance",stroke:"#a855f7",name:"Kilmetros",dot:!0})]})})})]})})]}),e.jsxs(Ce,{children:[e.jsx(Kt,{children:e.jsx(Gt,{children:"Resumen por categora"})}),e.jsx(Ae,{children:e.jsx("div",{className:"h-[300px]",children:e.jsx(On,{width:"100%",height:"100%",children:e.jsxs(Pm,{data:Object.entries(Ap).map(([o,c])=>{const u=n.categoryStats[o]||{duration:0,calories:0};return{category:c.name,minutos:u.duration,calorias:u.calories}}),children:[e.jsx(Aa,{strokeDasharray:"3 3"}),e.jsx(Qr,{dataKey:"category"}),e.jsx(_r,{yAxisId:"left",orientation:"left",stroke:"#f97316"}),e.jsx(_r,{yAxisId:"right",orientation:"right",stroke:"#22c55e"}),e.jsx(Pn,{}),e.jsx(ai,{}),e.jsx(Xc,{yAxisId:"left",dataKey:"calorias",fill:"#f97316",name:"Caloras"}),e.jsx(Xc,{yAxisId:"right",dataKey:"minutos",fill:"#22c55e",name:"Minutos"})]})})})})]})]})},EW=(t,s)=>{const[n,r]=f.useState(null),[a,i]=f.useState(!0),[o,c]=f.useState(null),{user:u}=Je();return f.useEffect(()=>{(async()=>{if(r(null),!!u){i(!0),c(null);try{const h=[],p=new Date(t);for(;p<=s;)h.push(Ie(p)),p.setDate(p.getDate()+1);const x=(await Promise.all(h.map(y=>ot(ke(xe,"exercises",`${u.uid}_${y}`))))).map((y,b)=>{var v;return{date:h[b],calories:y.exists()&&((v=y.data().summary)==null?void 0:v.totalCalories)||0}});r({dailyStats:x})}catch(h){console.error("Error al cargar estadsticas:",h),c(h instanceof Error?h.message:"Error al cargar estadsticas")}finally{i(!1)}}})()},[u,t,s]),{stats:n,loading:a,error:o}},TW=({selectedDate:t,goal:s=500})=>{const[n,r]=f.useState(ls(t));f.useEffect(()=>{r(ls(t))},[t]);const a=f.useMemo(()=>ls(n),[n]),i=f.useMemo(()=>vr(n),[n]),{stats:o,loading:c}=EW(a,i),u=f.useMemo(()=>{const h={};return o==null||o.dailyStats.forEach(({date:p,calories:g})=>{h[p]=g}),h},[o]),d=h=>{const p=Ie(h.date),g=u[p]||0,x=Math.min(g/s,1),y=28,b=3,v=(y-b)/2,w=2*Math.PI*v,N=w-x*w,S=g>=s;return e.jsxs("div",{className:"relative flex items-center justify-center w-7 h-7",children:[e.jsxs("svg",{width:y,height:y,className:"absolute",children:[e.jsx("circle",{cx:y/2,cy:y/2,r:v,stroke:S?"#fed7aa":"#e5e7eb",strokeWidth:b,fill:"none"}),e.jsx("circle",{cx:y/2,cy:y/2,r:v,stroke:S?"#f97316":"#9ca3af",strokeWidth:b,fill:"none",strokeDasharray:w,strokeDashoffset:N,strokeLinecap:"round",style:{transform:"rotate(-90deg)",transformOrigin:"50% 50%"}})]}),e.jsx("span",{className:"text-[10px] font-medium z-10",children:h.date.getDate()})]})};return e.jsxs(Ce,{className:"w-full",children:[e.jsxs(Kt,{className:"flex flex-col items-center gap-2",children:[e.jsx(Zc,{className:"w-5 h-5 text-orange-600"}),e.jsx(Gt,{className:"text-center",children:"Historial Mensual"})]}),e.jsxs(Ae,{className:"relative p-4",children:[c&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/50 z-10",children:e.jsx(fs,{className:"w-6 h-6 animate-spin"})}),e.jsx(Sd,{month:n,onMonthChange:r,showOutsideDays:!0,components:{DayContent:d},className:"p-0 w-full"})]})]})},iE=f.forwardRef(({selectedDate:t},s)=>{const{user:n}=Je(),{exerciseLogs:r,summary:a,status:i,error:o,logExercise:c,updateExerciseLog:u,deleteExerciseLog:d,resync:h}=NW(t),{isOnline:p}=ua(),[g,x]=f.useState(!1),[y,b]=f.useState(null);return f.useImperativeHandle(s,()=>({openAddExercise:()=>x(!0)})),n?e.jsxs(Ce,{className:"w-full",children:[e.jsxs(Ae,{className:"p-6",children:[e.jsxs(ma,{defaultValue:"list",className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(ha,{children:[e.jsx(Ds,{value:"list",children:"Lista"}),e.jsxs(Ds,{value:"stats",className:"gap-2",children:[e.jsx(ax,{className:"w-4 h-4"}),"Estadsticas"]})]}),e.jsxs($,{onClick:()=>x(!0),className:"gap-2 hidden sm:flex",disabled:i==="saving"||!p,children:[e.jsx(cs,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Agregar"})]})]}),e.jsx(ys,{value:"list",className:"m-0",children:e.jsx(SW,{exerciseLogs:r,onUpdate:b,onDelete:d,isLoading:i==="loading"})}),e.jsx(ys,{value:"stats",className:"m-0",children:e.jsx(CW,{exerciseLogs:r,summary:a})})]}),o&&e.jsx("p",{className:"mt-4 text-sm text-red-500",children:o}),e.jsx(sj,{isOpen:g,onClose:()=>x(!1),onSubmit:c,selectedDate:t}),y!==null&&e.jsx(sj,{isOpen:!0,onClose:()=>b(null),onSubmit:v=>{u(y,v),b(null)},initialData:r[y],selectedDate:t})]}),e.jsxs(In,{className:"justify-center gap-2 text-xs p-2",children:[i==="saving"&&e.jsx("span",{className:"text-blue-500",children:"Guardando..."}),i==="pending"&&e.jsx("span",{className:"text-yellow-600",children:"Pendiente de sincronizar"}),i==="saved"&&e.jsx("span",{className:"text-green-600",children:"Sincronizado"}),i==="error"&&e.jsx("span",{className:"text-red-600",children:"Error de sincronizacin"}),!p&&e.jsx("span",{className:"text-orange-600",children:"Offline"}),e.jsx($,{onClick:h,variant:"link",className:"p-0 h-auto",children:"Reintentar"})]})]}):e.jsx(Ce,{className:"w-full",children:e.jsx(Ae,{className:"p-4 text-center",children:e.jsx("p",{children:"Inicia sesin para registrar tus ejercicios"})})})});iE.displayName="Exercise";const DW=()=>{const[t,s]=f.useState(new Date),{user:n}=Je(),r=f.useRef(null),a=f.useMemo(()=>({dailyCalories:500}),[]),{settings:i,saveSettings:o}=JS("exercise",a),[c,u]=f.useState(i.dailyCalories);f.useEffect(()=>{u(i.dailyCalories)},[i.dailyCalories]);const d=()=>{var h;(h=r.current)==null||h.openAddExercise()};return n?e.jsxs(ln,{showFloatingButton:!0,onFloatingButtonClick:d,floatingButtonLabel:"Agregar ejercicio",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Registro de Ejercicio"}),e.jsx("p",{className:"text-gray-500",children:"Registra y monitorea tus actividades fsicas diarias"})]}),e.jsxs(ma,{defaultValue:"daily",className:"w-full",children:[e.jsxs(ha,{className:"mb-6",children:[e.jsx(Ds,{value:"daily",children:"Registro Diario"}),e.jsx(Ds,{value:"settings",children:"Configuracin"})]}),e.jsxs(ys,{value:"daily",children:[e.jsx(La,{selectedDate:t,onChange:s}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-[1fr_300px] mt-4",children:[e.jsx(iE,{ref:r,selectedDate:t}),e.jsx(TW,{selectedDate:t,goal:i.dailyCalories})]})]}),e.jsx(ys,{value:"settings",className:"space-y-4",children:e.jsx(Ce,{children:e.jsxs(Ae,{className:"pt-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx(ze,{htmlFor:"calGoal",children:"Caloras diarias objetivo"}),e.jsx(Fe,{id:"calGoal",type:"number",value:c,onChange:h=>u(Number(h.target.value))})]}),e.jsx($,{onClick:()=>o({dailyCalories:c}),children:"Guardar"})]})})})]})]}):e.jsx("div",{className:"container max-w-4xl mx-auto py-6",children:e.jsx(Ce,{children:e.jsxs(Ae,{className:"p-8 text-center",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Inicia sesin"}),e.jsx("p",{className:"text-gray-500",children:"Necesitas iniciar sesin para registrar y ver tus ejercicios"})]})})})},Sg=(t,s)=>ke(xe,"negative-habits",`${t}_${s}`),kW=async(t,s,n,r,a,i)=>{const o={habitId:r,timestamp:new Date().getTime(),...i?{note:i}:{}},u={...a[n]||{},[r]:o},d={userId:t,yearMonth:s,habits:{...a,[n]:u},updatedAt:ht()},h=Sg(t,s);await Zt(h,d,{merge:!0})},AW=async(t,s,n,r,a)=>{const i={...a[n]||{}};delete i[r];const o={userId:t,yearMonth:s,habits:{...a,[n]:i},updatedAt:ht()},c=Sg(t,s);await Zt(c,o,{merge:!0})},_W=async(t,s)=>{const n={},r=Bt(xe,"negative-habits");for(const a of s)try{(await gn(xn(r,Et("userId","==",t),Et("yearMonth","==",a)))).forEach(o=>{const c=o.data();n[a]=c.habits||{}})}catch(i){console.error(`Error fetching month ${a}:`,i)}return n},Cg=t=>{const s={totalCount:0,byHabitId:{},byDate:{}};return Object.entries(t).forEach(([n])=>{const[r,a]=n.split("_"),i=parseInt(r);s.totalCount++,s.byHabitId[i]=(s.byHabitId[i]||0)+1,s.byDate[a]=(s.byDate[a]||0)+1}),s},RW=(t,s=5)=>{const n=Cg(t);return Object.entries(n.byHabitId).sort(([,r],[,a])=>a-r).slice(0,s).map(([r,a])=>({habitId:parseInt(r),count:a}))},OW=(t,s=3)=>{const n=Cg(t);return Object.entries(n.byDate).sort(([,r],[,a])=>a-r).slice(0,s).map(([r,a])=>({date:r,count:a}))},PW=t=>{const s=[],n=new Date(t),r=n.getDay(),a=r===0?-6:1-r;n.setDate(n.getDate()+a);for(let i=0;i<7;i++){const o=new Date(n);o.setDate(n.getDate()+i),s.push({dayName:o.toLocaleDateString("es-ES",{weekday:"short"}),fullDate:Ie(o)})}return s},MW=t=>{const s=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0");return`${s}-${n}`},IW=t=>{const s=t.getFullYear(),n=t.getMonth()+1,r=[];for(let a=1;a<=n;a++){const i=String(a).padStart(2,"0");r.push(`${s}-${i}`)}return r},LW=()=>{const[t,s]=f.useState({}),[n,r]=f.useState("idle"),[a,i]=f.useState(null),{user:o}=Je(),c=f.useMemo(()=>{const x={};return Object.values(t).forEach(y=>{Object.entries(y).forEach(([b,v])=>{Object.entries(v).forEach(([w,N])=>{x[`${w}_${b}`]=N})})}),x},[t]),u=f.useMemo(()=>({...Cg(c),topHabits:RW(c),frequentDays:OW(c)}),[c,t]),d=f.useCallback(async()=>{if(!o)return;r("loading"),i(null);const x=new Date,y=MW(x);try{Me.logRead("negative-habits","useNegativeHabitData.loadCurrentMonth");const b=await ot(Sg(o.uid,y));let v={};if(b.exists()){const S=b.data();v[y]=S.habits||{}}const w=IW(x),N=await _W(o.uid,w);v={...v,...N},s(v),r("saved")}catch(b){console.error("Error loading negative habit data:",b),i(b instanceof Error?b.message:"Error al cargar los datos"),r("error")}},[o]);f.useEffect(()=>{d()},[d]);const h=f.useCallback(async(x,y,b)=>{if(!o)return;r("saving"),i(null);const[v,w]=y.split("-"),N=`${v}-${w}`,S=t[N]||{},E={timestamp:Date.now(),habitId:x,...b?{note:b}:{}},k={...S,[y]:{...S[y],[x]:E}};s(D=>({...D,[N]:k}));try{await kW(o.uid,N,y,x,S,b),r("saved")}catch(D){console.error("Error logging negative habit:",D),s(T=>({...T,[N]:S})),i(D instanceof Error?D.message:"Error al guardar"),r("error")}},[o,t]),p=f.useCallback(async(x,y)=>{if(!o)return;r("saving"),i(null);const[b,v]=y.split("-"),w=`${b}-${v}`,N=t[w]||{},S={...N};if(S[y]){const E={...S[y]};delete E[x],Object.keys(E).length===0?delete S[y]:S[y]=E}s(E=>({...E,[w]:S}));try{await AW(o.uid,w,y,x,N),r("saved")}catch(E){console.error("Error removing negative habit:",E),s(k=>({...k,[w]:N})),i(E instanceof Error?E.message:"Error al eliminar"),r("error")}},[o,t]),g=Ha("Negative habit data");return{habits:c,status:n,error:a,stats:u,logHabit:h,removeLog:p,loadNegativeHabitData:d,resync:g}},$W=({view:t,onViewChange:s})=>e.jsxs("div",{className:"flex gap-2",children:[e.jsxs($,{variant:t==="weekly"?"default":"outline",size:"sm",onClick:()=>s("weekly"),className:"gap-2",children:[e.jsx(ns,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Semanal"})]}),e.jsxs($,{variant:t==="yearly"?"default":"outline",size:"sm",onClick:()=>s("yearly"),className:"gap-2",children:[e.jsx(uw,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Anual"})]})]}),nj=({habits:t,completedHabits:s,weekDays:n,onLogHabit:r,onRemoveLog:a,disabled:i})=>e.jsx(Mr,{children:e.jsxs("div",{className:"grid grid-cols-[minmax(100px,1fr)_repeat(7,minmax(32px,1fr))] gap-1",children:[e.jsx("div",{}),n.map(o=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium",children:o.dayName}),e.jsx("div",{className:"text-[10px] text-gray-400",children:o.fullDate.split("-").slice(1).join("/")})]},o.fullDate)),t.map(o=>e.jsxs(ee.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:o.icon}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm",children:o.name}),e.jsx("span",{className:"text-xs text-gray-500",children:o.category})]})]}),n.map(c=>{const u=`${o.id}_${c.fullDate}`,d=s[u];return e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs(Hs,{children:[e.jsx(Us,{asChild:!0,children:e.jsx($,{variant:d?"destructive":"outline",size:"icon",className:"w-8 h-8 p-0",onClick:()=>d?a(o.id,c.fullDate):r(o.id,c.fullDate),disabled:i,children:d?e.jsx(Ws,{className:"w-4 h-4 text-white"}):e.jsx(ro,{className:"w-4 h-4 text-muted-foreground"})})}),e.jsx(Ls,{children:d?"Eliminar registro":"Registrar hbito"})]})},u)})]},o.id))]})}),vl={health:{icon:"",label:"Salud",description:"Hbitos que afectan tu salud fsica"},productivity:{icon:"",label:"Productividad",description:"Hbitos que reducen tu eficiencia"},social:{icon:"",label:"Social",description:"Hbitos que afectan tus relaciones"},emotional:{icon:"",label:"Emocional",description:"Hbitos que afectan tu bienestar emocional"},finance:{icon:"",label:"Finanzas",description:"Hbitos que impactan tus finanzas"},digital:{icon:"",label:"Digital",description:"Hbitos digitales nocivos"},environment:{icon:"",label:"Ambiente",description:"Hbitos que impactan al medio ambiente"}},Qi=[{id:1,name:"Saltarse comidas",icon:"",category:"health"},{id:2,name:"Dormir poco",icon:"",category:"health"},{id:3,name:"No hacer ejercicio",icon:"",category:"health"},{id:4,name:"Comer en exceso",icon:"",category:"health"},{id:25,name:"Comida chatarra",icon:"",category:"health"},{id:26,name:"Exceso de azcar",icon:"",category:"health"},{id:27,name:"Masturbacin",icon:"",category:"health"},{id:5,name:"Procrastinar",icon:"",category:"productivity"},{id:6,name:"Distracciones",icon:"",category:"productivity"},{id:7,name:"Multitarea",icon:"",category:"productivity"},{id:8,name:"Desorganizacin",icon:"",category:"productivity"},{id:24,name:"Exceso de trabajo (Workaholic)",icon:"",category:"productivity"},{id:9,name:"Aislamiento",icon:"",category:"social"},{id:10,name:"Conflictos",icon:"",category:"social"},{id:11,name:"No escuchar",icon:"",category:"social"},{id:29,name:"Dejar en visto",icon:"",category:"social"},{id:15,name:"Sobrepensar cosas",icon:"",category:"emotional"},{id:16,name:"Negatividad / Pesimismo",icon:"",category:"emotional"},{id:17,name:"Ser grosero/estresarme",icon:"",category:"emotional"},{id:28,name:"Celos compulsivos",icon:"",category:"emotional"},{id:12,name:"Gastos impulsivos",icon:"",category:"finance"},{id:13,name:"No ahorrar",icon:"",category:"finance"},{id:14,name:"Ms Deudas",icon:"",category:"finance"},{id:18,name:"Exceso de Redes sociales",icon:"",category:"digital"},{id:19,name:"Exceso de Videojuegos",icon:"",category:"digital"},{id:20,name:"Exceso de Netflix",icon:"",category:"digital"},{id:21,name:"Desperdiciar agua",icon:"",category:"environment"},{id:22,name:"No reciclar",icon:"",category:"environment"},{id:23,name:"Consumo excesivo",icon:"",category:"environment"}],zW=({habits:t,onLogHabit:s,onRemoveLog:n,disabled:r})=>{const a=PW(new Date),[i,o]=f.useState(""),[c,u]=f.useState(["health"]),[d,h]=f.useState(!1),p=f.useMemo(()=>{const b={};return Qi.forEach(v=>{b[v.category]||(b[v.category]=[]),!(i&&!v.name.toLowerCase().includes(i.toLowerCase()))&&b[v.category].push(v)}),b},[i]),g=f.useMemo(()=>{const b=Qi.length,v=Object.values(p).reduce((S,E)=>S+E.length,0),w={},N=new Date().toISOString().split("T")[0];return Object.entries(t).forEach(([S])=>{const[E,k]=S.split("_");if(k===N){const D=Qi.find(T=>T.id===Number(E));D&&(w[D.category]=(w[D.category]||0)+1)}}),{totalHabits:b,filteredHabits:v,loggedByCategory:w,isFiltered:i.length>0}},[p,t,i]),x=f.useMemo(()=>{const b=new Map;return Object.entries(t).forEach(([v])=>{const[w]=v.split("_"),N=b.get(Number(w))||0;b.set(Number(w),N+1)}),Qi.filter(v=>b.has(v.id)).sort((v,w)=>(b.get(w.id)||0)-(b.get(v.id)||0)).slice(0,5)},[t]),y=b=>{u(v=>v.includes(b)?v.filter(w=>w!==b):[...v,b])};return e.jsxs("div",{className:"space-y-4",children:["      ",e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsxs("div",{className:"relative w-full sm:w-64",children:[e.jsx($l,{className:"absolute left-2 top-2.5 h-4 w-4 text-gray-500"}),e.jsx(Fe,{placeholder:"Buscar hbito...",value:i,onChange:b=>o(b.target.value),className:"pl-8 pr-16"}),g.isFiltered&&e.jsxs("div",{className:"absolute right-2 top-2 bg-blue-100 text-blue-800 px-2 py-0.5 rounded-md text-xs font-medium",children:[g.filteredHabits,"/",g.totalHabits]})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsx($,{variant:"outline",onClick:()=>h(!d),className:"flex-1 sm:flex-none",children:d?"Mostrar ms frecuentes":"Mostrar todos"}),Object.keys(g.loggedByCategory).length>0&&e.jsxs("div",{className:"bg-green-100 text-green-800 px-3 py-1.5 rounded-md text-sm font-medium",children:[Object.values(g.loggedByCategory).reduce((b,v)=>b+v,0)," hoy"]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"sm:min-w-[640px]",children:d?e.jsx("div",{className:"space-y-6",children:Object.entries(p).map(([b,v])=>{if(v.length===0)return null;const w=c.includes(b),N=vl[b];return e.jsxs("div",{className:"space-y-2",children:[e.jsxs($,{variant:"ghost",onClick:()=>y(b),className:"w-full flex items-center justify-between p-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:N.icon}),e.jsx("span",{className:"font-medium",children:N.label}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",v.length,")"]}),g.loggedByCategory[b]&&e.jsxs("span",{className:"bg-red-100 text-red-800 px-2 py-0.5 rounded-full text-xs font-medium ml-1",children:[g.loggedByCategory[b]," hoy"]})]}),w?e.jsx(Gn,{size:20}):e.jsx(Ma,{size:20})]}),w&&e.jsx(nj,{habits:v,completedHabits:t,weekDays:a,onLogHabit:s,onRemoveLog:n,disabled:r})]},b)})}):e.jsx(nj,{habits:x,completedHabits:t,weekDays:a,onLogHabit:s,onRemoveLog:n,disabled:r})})}),"      ",e.jsxs(hi,{variant:"destructive",children:[" ",e.jsx(fi,{children:d?`Visualizacin completa de hbitos agrupados por categora${g.isFiltered?` (${g.filteredHabits} de ${g.totalHabits} hbitos mostrados)`:""}. Usa el buscador para encontrar hbitos especficos.`:`Mostrando solo tus ${x.length} hbitos ms frecuentes. Haz clic en "Mostrar todos" para ver la lista completa.`})]})]})},rj=({habits:t,completedHabits:s,onLogHabit:n,onRemoveLog:r})=>{const a=new Date().getFullYear();return e.jsx(Mr,{children:e.jsx("div",{className:"space-y-6",children:t.map(i=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 sticky top-0 bg-white z-10 py-2",children:[e.jsx("span",{className:"text-xl",children:i.icon}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:i.name}),e.jsx("p",{className:"text-sm text-gray-500",children:i.category})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx(U1,{year:a,renderCell:o=>{const c=`${i.id}_${o}`,u=s[c],d=new Date().toISOString().split("T")[0]===o;return e.jsxs(Hs,{children:[e.jsx(Us,{asChild:!0,children:e.jsx($,{variant:u?"destructive":"ghost",onClick:()=>u?r(i.id,o):n(i.id,o),className:ce("w-1 h-1 p-0 rounded-full border transition-all duration-200 hover:scale-110",u?"bg-red-600 border-red-700 hover:bg-red-700":"bg-gray-100 border-gray-200 hover:bg-gray-200 hover:border-gray-300",d&&"ring-2 ring-blue-400 ring-offset-1"),"aria-label":u?"Eliminar registro":"Registrar hbito"})}),e.jsx(Ls,{children:e.jsx("p",{className:"text-sm",children:new Date(o).toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})})]},o)}})})]},i.id))})})},FW=({habits:t,onLogHabit:s,onRemoveLog:n})=>{const[r,a]=f.useState(""),[i,o]=f.useState("all"),[c,u]=f.useState(["health"]),[d,h]=f.useState(!1),p=f.useMemo(()=>{const y=new Map;return Object.entries(t).forEach(([b])=>{const[v]=b.split("_"),w=y.get(Number(v))||0;y.set(Number(v),w+1)}),Qi.filter(b=>y.has(b.id)).sort((b,v)=>(y.get(v.id)||0)-(y.get(b.id)||0)).slice(0,5)},[t]),g=f.useMemo(()=>{const y={};return Qi.forEach(b=>{r&&!b.name.toLowerCase().includes(r.toLowerCase())||i!=="all"&&b.category!==i||(y[b.category]||(y[b.category]=[]),y[b.category].push(b))}),y},[r,i]),x=y=>{u(b=>b.includes(y)?b.filter(v=>v!==y):[...b,y])};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx($l,{className:"absolute left-2 top-2.5 h-4 w-4 text-gray-500"}),e.jsx(Fe,{placeholder:"Buscar hbito...",value:r,onChange:y=>a(y.target.value),className:"pl-8"})]}),e.jsxs(Tt,{value:i,onValueChange:o,children:[e.jsx(vt,{className:"w-full sm:w-[180px]",children:e.jsx(Dt,{placeholder:"Categora"})}),e.jsxs(yt,{children:[e.jsx(Pe,{value:"all",children:"Todas las categoras"}),Object.keys(vl).map(y=>e.jsx(Pe,{value:y,children:vl[y].label},y))]})]}),e.jsx($,{variant:"outline",onClick:()=>h(!d),className:"whitespace-nowrap",children:d?"Ver frecuentes":"Ver todos"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"sm:min-w-[800px] pb-4",children:d?e.jsx("div",{className:"space-y-8",children:Object.entries(g).map(([y,b])=>{if(b.length===0)return null;const v=c.includes(y),w=vl[y];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs($,{variant:"ghost",onClick:()=>x(y),className:"w-full flex items-center justify-between p-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:w.icon}),e.jsx("span",{className:"font-medium",children:w.label}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",b.length,")"]})]}),v?e.jsx(Gn,{size:20}):e.jsx(Ma,{size:20})]}),v&&e.jsx(rj,{habits:b,completedHabits:t,onLogHabit:s,onRemoveLog:n})]},y)})}):e.jsx(rj,{habits:p,completedHabits:t,onLogHabit:s,onRemoveLog:n})})}),e.jsxs(hi,{variant:"destructive",children:[" ",e.jsx(fi,{children:d?"Vista completa de hbitos por categora. Usa los filtros para encontrar hbitos especficos.":'Mostrando tus hbitos ms frecuentes. Cambia a "Ver todos" para la lista completa.'})]})]})},BW=({category:t,habits:s,onSelectHabit:n})=>{const r=vl[t];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:r.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:r.label}),e.jsx("p",{className:"text-sm text-gray-500",children:r.description})]})]}),e.jsx(Km,{className:"h-[300px] pr-4",children:e.jsx("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-3",children:s.map(a=>e.jsxs($,{variant:"outline",className:"h-auto py-3 px-2 flex flex-col items-center gap-2 group",onClick:()=>n(a.id),children:[e.jsx("span",{className:"text-2xl group-hover:scale-110 transition-transform",children:a.icon}),e.jsx("span",{className:"text-xs text-center line-clamp-2",children:a.name})]},a.id))})})]})},HW=({onSelectHabit:t})=>{const[s,n]=f.useState("health"),r=Qi.reduce((a,i)=>(a[i.category]||(a[i.category]=[]),a[i.category].push(i),a),{});return e.jsx("div",{className:"w-full",children:e.jsxs(ma,{defaultValue:s,onValueChange:a=>n(a),className:"w-full",children:[e.jsx(ha,{className:"grid grid-cols-4 gap-2 h-auto sm:grid-cols-7",children:Object.entries(vl).map(([a,{icon:i,label:o}])=>e.jsxs(Ds,{value:a,className:"text-sm flex flex-col gap-1 py-2 h-auto",children:[e.jsx("span",{className:"text-xl",children:i}),e.jsx("span",{className:"hidden sm:inline text-xs",children:o})]},a))}),Object.entries(r).map(([a,i])=>e.jsx(ys,{value:a,className:"mt-4",children:e.jsx(BW,{category:a,habits:i,onSelectHabit:t})},a))]})})},UW=({isOpen:t,onClose:s,onLogHabit:n,selectedDate:r})=>e.jsx(kt,{open:t,onOpenChange:s,children:e.jsxs(wt,{className:"sm:max-w-[600px] max-h-[90vh] flex flex-col",children:[e.jsxs(At,{children:[e.jsx(_t,{children:"Registrar Hbito Negativo"}),e.jsx("p",{className:"text-sm text-gray-500",children:am(r)})]}),e.jsx("div",{className:"flex-1 overflow-hidden py-4",children:e.jsx(HW,{onSelectHabit:n})})]})}),Zr=Lr("negativeHabit"),WW=Zr?`https://generativelanguage.googleapis.com/v1beta/models/${Zr.model}:generateContent`:"",YW=({habits:t,open:s,onOpenChange:n})=>{var D,T;const[r,a]=f.useState(!1),i=s!==void 0?s:r,o=n??a,[c,u]=f.useState(""),[d,h]=f.useState(""),[p,g]=f.useState(!1),[x,y]=f.useState(0),b="AIzaSyAW4Ot-z7OH4ZR3OeaN7vcbkEDlWpo1aMY",v=((D=Zr==null?void 0:Zr.prompts)==null?void 0:D.impact)??"Explica el impacto de mis hbitos negativos de acuerdo con mis registros.",w=((T=Zr==null?void 0:Zr.prompts)==null?void 0:T.action)??"Recomienda acciones para reducirlos cada vez que los registro.",N=Zr==null?void 0:Zr.params;f.useEffect(()=>{if(i){const R=S();h(`${v}
${w}
${R}`)}else h(""),u("")},[i,t]),f.useEffect(()=>{y(zr(d))},[d]);const S=()=>{const R={};let O=null,U=null;Object.keys(t).forEach(M=>{const[W,B]=M.split("_"),P=parseInt(W,10);R[P]=(R[P]||0)+1,(!O||B<O)&&(O=B),(!U||B>U)&&(U=B)});const I=O&&U?`Datos del ${O} al ${U}`:"Sin registros",_=Qi.map(M=>`- ${M.name}: ${R[M.id]||0}`).join(`
`);return`${I}
${_}`},E=async()=>{var R,O,U,I,_;g(!0);try{const W=await(await fetch(`${WW}?key=${b}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:d}]}],...N})})).json(),B=(_=(I=(U=(O=(R=W==null?void 0:W.candidates)==null?void 0:R[0])==null?void 0:O.content)==null?void 0:U.parts)==null?void 0:I[0])==null?void 0:_.text;u(B||"No se pudo obtener sugerencia")}catch{u("Error al consultar la API")}finally{g(!1)}},k=()=>{o(!1),u(""),h(""),y(0)};return e.jsxs(kt,{open:i,onOpenChange:R=>R?o(!0):k(),children:[s===void 0&&e.jsxs($,{size:"sm",variant:"outline",onClick:()=>o(!0),className:"flex items-center gap-2",children:[e.jsx(Gs,{className:"w-4 h-4"}),"Analizar hbitos"]}),e.jsxs(wt,{className:"w-[95vw] h-[90vh] max-w-none max-h-none overflow-hidden flex flex-col sm:w-[90vw] sm:h-[85vh]",children:[e.jsxs(At,{className:"flex-shrink-0",children:[e.jsx(_t,{className:"text-xl",children:"Anlisis de Hbitos Negativos con IA"}),e.jsx(cn,{children:"La IA analizar el impacto de tus hbitos negativos y te recomendar acciones especficas para reducirlos. Usa el panel izquierdo para editar el prompt y visualiza el resultado en el panel derecho."})]}),e.jsxs("div",{className:"flex-1 flex flex-col sm:flex-row gap-4 min-h-0 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[e.jsxs("div",{className:"flex-1 flex flex-col mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2 flex-shrink-0",children:"Prompt para IA"}),e.jsx(It,{value:d,onChange:R=>h(R.target.value),className:"flex-1 resize-none min-h-0",placeholder:"Datos de hbitos negativos para analizar..."})]}),e.jsxs("div",{className:"flex flex-col gap-3 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"text-gray-500",children:["Tokens: ",x]}),x>3500&&e.jsx("span",{className:"text-red-500 font-medium",children:"Prompt demasiado largo!"})]}),e.jsxs($,{onClick:E,disabled:p||!b||x>3500,className:"w-full flex items-center justify-center gap-2",size:"lg",children:[p&&e.jsx(fs,{className:"w-4 h-4 animate-spin"}),e.jsx(Gs,{className:"w-4 h-4"}),p?"Consultando IA...":"Obtener anlisis"]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 sm:border-l sm:border-gray-200 sm:pl-4 border-t sm:border-t-0 border-gray-200 pt-4 sm:pt-0",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Impacto y recomendaciones"}),c&&e.jsxs($,{type:"button",size:"sm",variant:"outline",onClick:()=>{navigator.clipboard.writeText(c),bt.success("Anlisis copiado al portapapeles")},className:"flex items-center gap-1",children:[e.jsx(da,{className:"w-4 h-4"}),"Copiar"]})]}),e.jsx("div",{className:"flex-1 flex flex-col min-h-0",children:e.jsx("div",{className:"flex-1 bg-gray-50 border border-gray-200 rounded-md p-4 overflow-auto",children:c?e.jsx("div",{className:"prose prose-sm max-w-none text-gray-700",dangerouslySetInnerHTML:{__html:xi.sanitize(c.replace(/\n/g,"<br>"))}}):p?e.jsx("div",{className:"text-sm text-gray-500",children:"Analizando impacto de hbitos negativos..."}):e.jsx("div",{className:"text-sm text-gray-500",children:"El anlisis del impacto de tus hbitos negativos aparecer aqu. La IA te dar recomendaciones especficas para reducir cada hbito."})})})]})]}),e.jsx("div",{className:"flex-shrink-0 mt-4 pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 text-xs text-gray-500",children:[e.jsx("span",{children:" Tip: S honesto con tus registros para obtener mejores recomendaciones"}),!b]})})]})]})},VW=({habits:t})=>{const[s,n]=f.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs(oa,{children:[e.jsx(la,{asChild:!0,children:e.jsxs($,{size:"sm",variant:"outline",className:"flex items-center gap-2 text-blue-600",children:[e.jsx(Gs,{className:"w-4 h-4"}),"IA"]})}),e.jsx(Pr,{align:"end",children:e.jsx(Ft,{onSelect:()=>n(!0),children:"Analizar hbitos"})})]}),e.jsx(YW,{habits:t,open:s,onOpenChange:n})]})},GW=()=>{const[t,s]=f.useState("weekly"),[n,r]=f.useState(new Date),[a,i]=f.useState(!1),{user:o}=Je(),{habits:c,status:u,error:d,logHabit:h,removeLog:p,resync:g}=LW(),{isOnline:x}=ua(),y=async(b,v)=>{await h(b,Ie(n),v),i(!1)};return o?e.jsxs(ln,{children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Hbitos Negativos"}),e.jsx("p",{className:"text-gray-500",children:"Identifica y reduce comportamientos que quieres cambiar"})]}),e.jsx(La,{selectedDate:n,onChange:r}),e.jsxs(Ce,{className:"w-full",children:[e.jsxs(Ae,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"font-medium text-lg",children:"Registro de Hbitos"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Identifica y registra los hbitos que deseas cambiar"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(VW,{habits:c}),e.jsx($W,{view:t,onViewChange:s})]})]}),t==="weekly"?e.jsx(zW,{habits:c,onLogHabit:h,onRemoveLog:p,disabled:u==="saving"||!x}):e.jsx(FW,{habits:c,onLogHabit:h,onRemoveLog:p}),d&&e.jsx("p",{className:"mt-4 text-sm text-red-500",children:d})]}),e.jsxs(In,{className:"justify-center gap-2 text-xs p-2",children:[u==="saving"&&e.jsx("span",{className:"text-blue-500",children:"Guardando..."}),u==="pending"&&e.jsx("span",{className:"text-yellow-600",children:"Pendiente de sincronizar"}),u==="saved"&&e.jsx("span",{className:"text-green-600",children:"Sincronizado"}),u==="error"&&e.jsx("span",{className:"text-red-600",children:"Error de sincronizacin"}),!x&&e.jsx("span",{className:"text-orange-600",children:"Offline"}),e.jsx($,{onClick:g,variant:"link",className:"p-0 h-auto",children:"Reintentar"})]})]}),e.jsx(UW,{isOpen:a,onClose:()=>i(!1),onLogHabit:y,selectedDate:n})]}):e.jsx(ln,{children:e.jsx(Ce,{className:"w-full",children:e.jsx(Ae,{className:"p-4 text-center",children:e.jsx("p",{children:"Inicia sesin para registrar tus hbitos negativos"})})})})},aj={journal:{words:0},mood:{count:0,average:0,highest:0,lowest:0},habits:{completed:0,total:18,incompletedByTimeOfDay:[]},negativeHabits:{count:0},exercise:{minutes:0,calories:0},tasks:{completed:0,activeAndOverdue:0,todayPending:0,overdue:0},pomodoro:{count:0,expectedMinutes:0,workMinutes:0,completionRate:0,averageSessionLength:0},water:{intake:0,drinkDetails:[]}},qW=t=>{const{user:s}=Je(),[n,r]=f.useState({daily:[],totals:{...aj}}),[a,i]=f.useState(!0),[o,c]=f.useState(null),u=f.useCallback(async()=>{if(!s){i(!1);return}i(!0),c(null);try{const h=[];for(let v=0;v<7;v++){const w=new Date(t);w.setDate(t.getDate()+v),h.push(w)}const p=h.map(v=>vN(s.uid,v)),g=await Promise.all(p),x=[],y={...aj};h.forEach((v,w)=>{const N=Ie(v),S=g[w];x.push({date:N,summary:S}),y.journal.words+=S.journal.words,y.mood.count+=S.mood.count,y.habits.completed+=S.habits.completed,y.negativeHabits.count+=S.negativeHabits.count,y.exercise.minutes+=S.exercise.minutes,y.exercise.calories+=S.exercise.calories,y.water.intake+=S.water.intake,y.tasks.completed+=S.tasks.completed,y.tasks.activeAndOverdue+=S.tasks.activeAndOverdue,y.tasks.todayPending+=S.tasks.todayPending,y.tasks.overdue+=S.tasks.overdue,y.pomodoro.count+=S.pomodoro.count,y.pomodoro.workMinutes+=S.pomodoro.workMinutes});const b=300*7;y.pomodoro.expectedMinutes=b,y.pomodoro.completionRate=b>0?Math.min(100,y.pomodoro.workMinutes/b*100):0,y.pomodoro.averageSessionLength=y.pomodoro.count>0?y.pomodoro.workMinutes/y.pomodoro.count:0,y.pomodoro.completionRate=parseFloat(y.pomodoro.completionRate.toFixed(1)),y.pomodoro.averageSessionLength=parseFloat(y.pomodoro.averageSessionLength.toFixed(1)),r({daily:x,totals:y}),i(!1)}catch(h){console.error("Error loading weekly summary:",h),c(h instanceof Error?h.message:"Error loading weekly summary"),i(!1)}},[s,t]);f.useEffect(()=>{u()},[u]);const d=f.useCallback(()=>{u()},[u]);return{summary:n,loading:a,error:o,refetch:d}},KW=f.lazy(()=>Hl(()=>import("../chunks/DailySummary-BMy34lEc.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(t=>({default:t.DailySummary}))),JW=f.lazy(()=>Hl(()=>import("../chunks/WeeklySummary-BxvxpQ8z.js"),__vite__mapDeps([8,1,2,3,7,5,6])).then(t=>({default:t.WeeklySummary}))),ij=f.lazy(()=>Hl(()=>import("../chunks/AiInsightCard-BNWGylJB.js"),__vite__mapDeps([9,1,2,3,5,6])).then(t=>({default:t.AiInsightCard}))),XW=f.lazy(()=>Hl(()=>import("../chunks/DailyDashboard-DFGd6eFI.js"),__vite__mapDeps([10,1,2,3,4,5,6])).then(t=>({default:t.DailyDashboard}))),ZW=f.lazy(()=>Hl(()=>import("../chunks/WeeklyDashboard-BYzlkyRr.js"),__vite__mapDeps([11,1,2,3,4,5,6])).then(t=>({default:t.WeeklyDashboard}))),oj=t=>nt(t,"PP",{locale:Zs}),QW=()=>{const[t,s]=f.useState(new Date),[n,r]=f.useState(()=>{const i=new Date;return i.setDate(i.getDate()-i.getDay()),i}),{summary:a}=qW(n);return e.jsxs(ln,{children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Estadsticas"})}),e.jsxs(ma,{defaultValue:"daily",className:"space-y-4",children:[e.jsxs(ha,{children:[e.jsx(Ds,{value:"daily",children:"Diario"}),e.jsx(Ds,{value:"weekly",children:"Semanal"})]}),e.jsxs(ys,{value:"daily",className:"space-y-4",children:[e.jsx(La,{selectedDate:t,onChange:s}),e.jsx(f.Suspense,{fallback:e.jsx("div",{className:"h-24"}),children:e.jsx(XW,{date:t})}),e.jsx(f.Suspense,{fallback:e.jsx("div",{className:"h-24"}),children:e.jsx(KW,{date:t})}),e.jsx(f.Suspense,{fallback:e.jsx("div",{className:"h-24"}),children:e.jsx(ij,{date:oj(t),dayDate:t})})]}),e.jsxs(ys,{value:"weekly",className:"space-y-4",children:[e.jsx(La,{selectedDate:n,onChange:r}),e.jsx(f.Suspense,{fallback:e.jsx("div",{className:"h-24"}),children:e.jsx(ZW,{startDate:n})}),e.jsx(f.Suspense,{fallback:e.jsx("div",{className:"h-24"}),children:e.jsx(JW,{startDate:n})}),e.jsx(f.Suspense,{fallback:e.jsx("div",{className:"h-24"}),children:e.jsx(ij,{data:a,date:`Semana del ${oj(n)}`})})]})]})]})};var Pd=t=>t.type==="checkbox",Mo=t=>t instanceof Date,Wn=t=>t==null;const oE=t=>typeof t=="object";var Vs=t=>!Wn(t)&&!Array.isArray(t)&&oE(t)&&!Mo(t),e8=t=>Vs(t)&&t.target?Pd(t.target)?t.target.checked:t.target.value:t,t8=t=>t.substring(0,t.search(/\.\d+(\.|$)/))||t,s8=(t,s)=>t.has(t8(s)),n8=t=>{const s=t.constructor&&t.constructor.prototype;return Vs(s)&&s.hasOwnProperty("isPrototypeOf")},Eg=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function mn(t){let s;const n=Array.isArray(t),r=typeof FileList<"u"?t instanceof FileList:!1;if(t instanceof Date)s=new Date(t);else if(!(Eg&&(t instanceof Blob||r))&&(n||Vs(t)))if(s=n?[]:{},!n&&!n8(t))s=t;else for(const a in t)t.hasOwnProperty(a)&&(s[a]=mn(t[a]));else return t;return s}var ch=t=>/^\w*$/.test(t),Xs=t=>t===void 0,Tg=t=>Array.isArray(t)?t.filter(Boolean):[],Dg=t=>Tg(t.replace(/["|']|\]/g,"").split(/\.|\[/)),Ue=(t,s,n)=>{if(!s||!Vs(t))return n;const r=(ch(s)?[s]:Dg(s)).reduce((a,i)=>Wn(a)?a:a[i],t);return Xs(r)||r===t?Xs(t[s])?n:t[s]:r},Da=t=>typeof t=="boolean",Ts=(t,s,n)=>{let r=-1;const a=ch(s)?[s]:Dg(s),i=a.length,o=i-1;for(;++r<i;){const c=a[r];let u=n;if(r!==o){const d=t[c];u=Vs(d)||Array.isArray(d)?d:isNaN(+a[r+1])?{}:[]}if(c==="__proto__"||c==="constructor"||c==="prototype")return;t[c]=u,t=t[c]}};const lj={BLUR:"blur",FOCUS_OUT:"focusout"},ta={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},ni={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},r8=ee.createContext(null);r8.displayName="HookFormContext";var a8=(t,s,n,r=!0)=>{const a={defaultValues:s._defaultValues};for(const i in t)Object.defineProperty(a,i,{get:()=>{const o=i;return s._proxyFormState[o]!==ta.all&&(s._proxyFormState[o]=!r||ta.all),t[o]}});return a};const i8=typeof window<"u"?f.useLayoutEffect:f.useEffect;var _a=t=>typeof t=="string",o8=(t,s,n,r,a)=>_a(t)?(r&&s.watch.add(t),Ue(n,t,a)):Array.isArray(t)?t.map(i=>(r&&s.watch.add(i),Ue(n,i))):(r&&(s.watchAll=!0),n),l8=(t,s,n,r,a)=>s?{...n[t],types:{...n[t]&&n[t].types?n[t].types:{},[r]:a||!0}}:{},Vc=t=>Array.isArray(t)?t:[t],cj=()=>{let t=[];return{get observers(){return t},next:a=>{for(const i of t)i.next&&i.next(a)},subscribe:a=>(t.push(a),{unsubscribe:()=>{t=t.filter(i=>i!==a)}}),unsubscribe:()=>{t=[]}}},Jp=t=>Wn(t)||!oE(t);function qi(t,s,n=new WeakSet){if(Jp(t)||Jp(s))return t===s;if(Mo(t)&&Mo(s))return t.getTime()===s.getTime();const r=Object.keys(t),a=Object.keys(s);if(r.length!==a.length)return!1;if(n.has(t)||n.has(s))return!0;n.add(t),n.add(s);for(const i of r){const o=t[i];if(!a.includes(i))return!1;if(i!=="ref"){const c=s[i];if(Mo(o)&&Mo(c)||Vs(o)&&Vs(c)||Array.isArray(o)&&Array.isArray(c)?!qi(o,c,n):o!==c)return!1}}return!0}var nr=t=>Vs(t)&&!Object.keys(t).length,kg=t=>t.type==="file",sa=t=>typeof t=="function",Sm=t=>{if(!Eg)return!1;const s=t?t.ownerDocument:0;return t instanceof(s&&s.defaultView?s.defaultView.HTMLElement:HTMLElement)},lE=t=>t.type==="select-multiple",Ag=t=>t.type==="radio",c8=t=>Ag(t)||Pd(t),sp=t=>Sm(t)&&t.isConnected;function d8(t,s){const n=s.slice(0,-1).length;let r=0;for(;r<n;)t=Xs(t)?r++:t[s[r++]];return t}function u8(t){for(const s in t)if(t.hasOwnProperty(s)&&!Xs(t[s]))return!1;return!0}function Js(t,s){const n=Array.isArray(s)?s:ch(s)?[s]:Dg(s),r=n.length===1?t:d8(t,n),a=n.length-1,i=n[a];return r&&delete r[i],a!==0&&(Vs(r)&&nr(r)||Array.isArray(r)&&u8(r))&&Js(t,n.slice(0,-1)),t}var cE=t=>{for(const s in t)if(sa(t[s]))return!0;return!1};function Cm(t,s={}){const n=Array.isArray(t);if(Vs(t)||n)for(const r in t)Array.isArray(t[r])||Vs(t[r])&&!cE(t[r])?(s[r]=Array.isArray(t[r])?[]:{},Cm(t[r],s[r])):Wn(t[r])||(s[r]=!0);return s}function dE(t,s,n){const r=Array.isArray(t);if(Vs(t)||r)for(const a in t)Array.isArray(t[a])||Vs(t[a])&&!cE(t[a])?Xs(s)||Jp(n[a])?n[a]=Array.isArray(t[a])?Cm(t[a],[]):{...Cm(t[a])}:dE(t[a],Wn(s)?{}:s[a],n[a]):n[a]=!qi(t[a],s[a]);return n}var Oc=(t,s)=>dE(t,s,Cm(s));const dj={value:!1,isValid:!1},uj={value:!0,isValid:!0};var uE=t=>{if(Array.isArray(t)){if(t.length>1){const s=t.filter(n=>n&&n.checked&&!n.disabled).map(n=>n.value);return{value:s,isValid:!!s.length}}return t[0].checked&&!t[0].disabled?t[0].attributes&&!Xs(t[0].attributes.value)?Xs(t[0].value)||t[0].value===""?uj:{value:t[0].value,isValid:!0}:uj:dj}return dj},mE=(t,{valueAsNumber:s,valueAsDate:n,setValueAs:r})=>Xs(t)?t:s?t===""?NaN:t&&+t:n&&_a(t)?new Date(t):r?r(t):t;const mj={isValid:!1,value:null};var hE=t=>Array.isArray(t)?t.reduce((s,n)=>n&&n.checked&&!n.disabled?{isValid:!0,value:n.value}:s,mj):mj;function hj(t){const s=t.ref;return kg(s)?s.files:Ag(s)?hE(t.refs).value:lE(s)?[...s.selectedOptions].map(({value:n})=>n):Pd(s)?uE(t.refs).value:mE(Xs(s.value)?t.ref.value:s.value,t)}var m8=(t,s,n,r)=>{const a={};for(const i of t){const o=Ue(s,i);o&&Ts(a,i,o._f)}return{criteriaMode:n,names:[...t],fields:a,shouldUseNativeValidation:r}},Em=t=>t instanceof RegExp,Pc=t=>Xs(t)?t:Em(t)?t.source:Vs(t)?Em(t.value)?t.value.source:t.value:t,fj=t=>({isOnSubmit:!t||t===ta.onSubmit,isOnBlur:t===ta.onBlur,isOnChange:t===ta.onChange,isOnAll:t===ta.all,isOnTouch:t===ta.onTouched});const pj="AsyncFunction";var h8=t=>!!t&&!!t.validate&&!!(sa(t.validate)&&t.validate.constructor.name===pj||Vs(t.validate)&&Object.values(t.validate).find(s=>s.constructor.name===pj)),f8=t=>t.mount&&(t.required||t.min||t.max||t.maxLength||t.minLength||t.pattern||t.validate),xj=(t,s,n)=>!n&&(s.watchAll||s.watch.has(t)||[...s.watch].some(r=>t.startsWith(r)&&/^\.\w+/.test(t.slice(r.length))));const Gc=(t,s,n,r)=>{for(const a of n||Object.keys(t)){const i=Ue(t,a);if(i){const{_f:o,...c}=i;if(o){if(o.refs&&o.refs[0]&&s(o.refs[0],a)&&!r)return!0;if(o.ref&&s(o.ref,o.name)&&!r)return!0;if(Gc(c,s))break}else if(Vs(c)&&Gc(c,s))break}}};function gj(t,s,n){const r=Ue(t,n);if(r||ch(n))return{error:r,name:n};const a=n.split(".");for(;a.length;){const i=a.join("."),o=Ue(s,i),c=Ue(t,i);if(o&&!Array.isArray(o)&&n!==i)return{name:n};if(c&&c.type)return{name:i,error:c};if(c&&c.root&&c.root.type)return{name:`${i}.root`,error:c.root};a.pop()}return{name:n}}var p8=(t,s,n,r)=>{n(t);const{name:a,...i}=t;return nr(i)||Object.keys(i).length>=Object.keys(s).length||Object.keys(i).find(o=>s[o]===(!r||ta.all))},x8=(t,s,n)=>!t||!s||t===s||Vc(t).some(r=>r&&(n?r===s:r.startsWith(s)||s.startsWith(r))),g8=(t,s,n,r,a)=>a.isOnAll?!1:!n&&a.isOnTouch?!(s||t):(n?r.isOnBlur:a.isOnBlur)?!t:(n?r.isOnChange:a.isOnChange)?t:!0,v8=(t,s)=>!Tg(Ue(t,s)).length&&Js(t,s),y8=(t,s,n)=>{const r=Vc(Ue(t,n));return Ts(r,"root",s[n]),Ts(t,n,r),t},Zu=t=>_a(t);function vj(t,s,n="validate"){if(Zu(t)||Array.isArray(t)&&t.every(Zu)||Da(t)&&!t)return{type:n,message:Zu(t)?t:"",ref:s}}var ml=t=>Vs(t)&&!Em(t)?t:{value:t,message:""},yj=async(t,s,n,r,a,i)=>{const{ref:o,refs:c,required:u,maxLength:d,minLength:h,min:p,max:g,pattern:x,validate:y,name:b,valueAsNumber:v,mount:w}=t._f,N=Ue(n,b);if(!w||s.has(b))return{};const S=c?c[0]:o,E=_=>{a&&S.reportValidity&&(S.setCustomValidity(Da(_)?"":_||""),S.reportValidity())},k={},D=Ag(o),T=Pd(o),R=D||T,O=(v||kg(o))&&Xs(o.value)&&Xs(N)||Sm(o)&&o.value===""||N===""||Array.isArray(N)&&!N.length,U=l8.bind(null,b,r,k),I=(_,M,W,B=ni.maxLength,P=ni.minLength)=>{const z=_?M:W;k[b]={type:_?B:P,message:z,ref:o,...U(_?B:P,z)}};if(i?!Array.isArray(N)||!N.length:u&&(!R&&(O||Wn(N))||Da(N)&&!N||T&&!uE(c).isValid||D&&!hE(c).isValid)){const{value:_,message:M}=Zu(u)?{value:!!u,message:u}:ml(u);if(_&&(k[b]={type:ni.required,message:M,ref:S,...U(ni.required,M)},!r))return E(M),k}if(!O&&(!Wn(p)||!Wn(g))){let _,M;const W=ml(g),B=ml(p);if(!Wn(N)&&!isNaN(N)){const P=o.valueAsNumber||N&&+N;Wn(W.value)||(_=P>W.value),Wn(B.value)||(M=P<B.value)}else{const P=o.valueAsDate||new Date(N),z=Y=>new Date(new Date().toDateString()+" "+Y),G=o.type=="time",ae=o.type=="week";_a(W.value)&&N&&(_=G?z(N)>z(W.value):ae?N>W.value:P>new Date(W.value)),_a(B.value)&&N&&(M=G?z(N)<z(B.value):ae?N<B.value:P<new Date(B.value))}if((_||M)&&(I(!!_,W.message,B.message,ni.max,ni.min),!r))return E(k[b].message),k}if((d||h)&&!O&&(_a(N)||i&&Array.isArray(N))){const _=ml(d),M=ml(h),W=!Wn(_.value)&&N.length>+_.value,B=!Wn(M.value)&&N.length<+M.value;if((W||B)&&(I(W,_.message,M.message),!r))return E(k[b].message),k}if(x&&!O&&_a(N)){const{value:_,message:M}=ml(x);if(Em(_)&&!N.match(_)&&(k[b]={type:ni.pattern,message:M,ref:o,...U(ni.pattern,M)},!r))return E(M),k}if(y){if(sa(y)){const _=await y(N,n),M=vj(_,S);if(M&&(k[b]={...M,...U(ni.validate,M.message)},!r))return E(M.message),k}else if(Vs(y)){let _={};for(const M in y){if(!nr(_)&&!r)break;const W=vj(await y[M](N,n),S,M);W&&(_={...W,...U(M,W.message)},E(W.message),r&&(k[b]=_))}if(!nr(_)&&(k[b]={ref:S,..._},!r))return k}}return E(!0),k};const b8={mode:ta.onSubmit,reValidateMode:ta.onChange,shouldFocusError:!0};function j8(t={}){let s={...b8,...t},n={submitCount:0,isDirty:!1,isReady:!1,isLoading:sa(s.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:s.errors||{},disabled:s.disabled||!1},r={},a=Vs(s.defaultValues)||Vs(s.values)?mn(s.defaultValues||s.values)||{}:{},i=s.shouldUnregister?{}:mn(a),o={action:!1,mount:!1,watch:!1},c={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},u,d=0;const h={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let p={...h};const g={array:cj(),state:cj()},x=s.criteriaMode===ta.all,y=q=>ne=>{clearTimeout(d),d=setTimeout(q,ne)},b=async q=>{if(!s.disabled&&(h.isValid||p.isValid||q)){const ne=s.resolver?nr((await T()).errors):await O(r,!0);ne!==n.isValid&&g.state.next({isValid:ne})}},v=(q,ne)=>{!s.disabled&&(h.isValidating||h.validatingFields||p.isValidating||p.validatingFields)&&((q||Array.from(c.mount)).forEach(me=>{me&&(ne?Ts(n.validatingFields,me,ne):Js(n.validatingFields,me))}),g.state.next({validatingFields:n.validatingFields,isValidating:!nr(n.validatingFields)}))},w=(q,ne=[],me,Te,Ee=!0,Ne=!0)=>{if(Te&&me&&!s.disabled){if(o.action=!0,Ne&&Array.isArray(Ue(r,q))){const Re=me(Ue(r,q),Te.argA,Te.argB);Ee&&Ts(r,q,Re)}if(Ne&&Array.isArray(Ue(n.errors,q))){const Re=me(Ue(n.errors,q),Te.argA,Te.argB);Ee&&Ts(n.errors,q,Re),v8(n.errors,q)}if((h.touchedFields||p.touchedFields)&&Ne&&Array.isArray(Ue(n.touchedFields,q))){const Re=me(Ue(n.touchedFields,q),Te.argA,Te.argB);Ee&&Ts(n.touchedFields,q,Re)}(h.dirtyFields||p.dirtyFields)&&(n.dirtyFields=Oc(a,i)),g.state.next({name:q,isDirty:I(q,ne),dirtyFields:n.dirtyFields,errors:n.errors,isValid:n.isValid})}else Ts(i,q,ne)},N=(q,ne)=>{Ts(n.errors,q,ne),g.state.next({errors:n.errors})},S=q=>{n.errors=q,g.state.next({errors:n.errors,isValid:!1})},E=(q,ne,me,Te)=>{const Ee=Ue(r,q);if(Ee){const Ne=Ue(i,q,Xs(me)?Ue(a,q):me);Xs(Ne)||Te&&Te.defaultChecked||ne?Ts(i,q,ne?Ne:hj(Ee._f)):W(q,Ne),o.mount&&b()}},k=(q,ne,me,Te,Ee)=>{let Ne=!1,Re=!1;const qe={name:q};if(!s.disabled){if(!me||Te){(h.isDirty||p.isDirty)&&(Re=n.isDirty,n.isDirty=qe.isDirty=I(),Ne=Re!==qe.isDirty);const st=qi(Ue(a,q),ne);Re=!!Ue(n.dirtyFields,q),st?Js(n.dirtyFields,q):Ts(n.dirtyFields,q,!0),qe.dirtyFields=n.dirtyFields,Ne=Ne||(h.dirtyFields||p.dirtyFields)&&Re!==!st}if(me){const st=Ue(n.touchedFields,q);st||(Ts(n.touchedFields,q,me),qe.touchedFields=n.touchedFields,Ne=Ne||(h.touchedFields||p.touchedFields)&&st!==me)}Ne&&Ee&&g.state.next(qe)}return Ne?qe:{}},D=(q,ne,me,Te)=>{const Ee=Ue(n.errors,q),Ne=(h.isValid||p.isValid)&&Da(ne)&&n.isValid!==ne;if(s.delayError&&me?(u=y(()=>N(q,me)),u(s.delayError)):(clearTimeout(d),u=null,me?Ts(n.errors,q,me):Js(n.errors,q)),(me?!qi(Ee,me):Ee)||!nr(Te)||Ne){const Re={...Te,...Ne&&Da(ne)?{isValid:ne}:{},errors:n.errors,name:q};n={...n,...Re},g.state.next(Re)}},T=async q=>{v(q,!0);const ne=await s.resolver(i,s.context,m8(q||c.mount,r,s.criteriaMode,s.shouldUseNativeValidation));return v(q),ne},R=async q=>{const{errors:ne}=await T(q);if(q)for(const me of q){const Te=Ue(ne,me);Te?Ts(n.errors,me,Te):Js(n.errors,me)}else n.errors=ne;return ne},O=async(q,ne,me={valid:!0})=>{for(const Te in q){const Ee=q[Te];if(Ee){const{_f:Ne,...Re}=Ee;if(Ne){const qe=c.array.has(Ne.name),st=Ee._f&&h8(Ee._f);st&&h.validatingFields&&v([Te],!0);const es=await yj(Ee,c.disabled,i,x,s.shouldUseNativeValidation&&!ne,qe);if(st&&h.validatingFields&&v([Te]),es[Ne.name]&&(me.valid=!1,ne))break;!ne&&(Ue(es,Ne.name)?qe?y8(n.errors,es,Ne.name):Ts(n.errors,Ne.name,es[Ne.name]):Js(n.errors,Ne.name))}!nr(Re)&&await O(Re,ne,me)}}return me.valid},U=()=>{for(const q of c.unMount){const ne=Ue(r,q);ne&&(ne._f.refs?ne._f.refs.every(me=>!sp(me)):!sp(ne._f.ref))&&K(q)}c.unMount=new Set},I=(q,ne)=>!s.disabled&&(q&&ne&&Ts(i,q,ne),!qi(Y(),a)),_=(q,ne,me)=>o8(q,c,{...o.mount?i:Xs(ne)?a:_a(q)?{[q]:ne}:ne},me,ne),M=q=>Tg(Ue(o.mount?i:a,q,s.shouldUnregister?Ue(a,q,[]):[])),W=(q,ne,me={})=>{const Te=Ue(r,q);let Ee=ne;if(Te){const Ne=Te._f;Ne&&(!Ne.disabled&&Ts(i,q,mE(ne,Ne)),Ee=Sm(Ne.ref)&&Wn(ne)?"":ne,lE(Ne.ref)?[...Ne.ref.options].forEach(Re=>Re.selected=Ee.includes(Re.value)):Ne.refs?Pd(Ne.ref)?Ne.refs.forEach(Re=>{(!Re.defaultChecked||!Re.disabled)&&(Array.isArray(Ee)?Re.checked=!!Ee.find(qe=>qe===Re.value):Re.checked=Ee===Re.value||!!Ee)}):Ne.refs.forEach(Re=>Re.checked=Re.value===Ee):kg(Ne.ref)?Ne.ref.value="":(Ne.ref.value=Ee,Ne.ref.type||g.state.next({name:q,values:mn(i)})))}(me.shouldDirty||me.shouldTouch)&&k(q,Ee,me.shouldTouch,me.shouldDirty,!0),me.shouldValidate&&ae(q)},B=(q,ne,me)=>{for(const Te in ne){if(!ne.hasOwnProperty(Te))return;const Ee=ne[Te],Ne=q+"."+Te,Re=Ue(r,Ne);(c.array.has(q)||Vs(Ee)||Re&&!Re._f)&&!Mo(Ee)?B(Ne,Ee,me):W(Ne,Ee,me)}},P=(q,ne,me={})=>{const Te=Ue(r,q),Ee=c.array.has(q),Ne=mn(ne);Ts(i,q,Ne),Ee?(g.array.next({name:q,values:mn(i)}),(h.isDirty||h.dirtyFields||p.isDirty||p.dirtyFields)&&me.shouldDirty&&g.state.next({name:q,dirtyFields:Oc(a,i),isDirty:I(q,Ne)})):Te&&!Te._f&&!Wn(Ne)?B(q,Ne,me):W(q,Ne,me),xj(q,c)&&g.state.next({...n}),g.state.next({name:o.mount?q:void 0,values:mn(i)})},z=async q=>{o.mount=!0;const ne=q.target;let me=ne.name,Te=!0;const Ee=Ue(r,me),Ne=st=>{Te=Number.isNaN(st)||Mo(st)&&isNaN(st.getTime())||qi(st,Ue(i,me,st))},Re=fj(s.mode),qe=fj(s.reValidateMode);if(Ee){let st,es;const Os=ne.type?hj(Ee._f):e8(q),qt=q.type===lj.BLUR||q.type===lj.FOCUS_OUT,tn=!f8(Ee._f)&&!s.resolver&&!Ue(n.errors,me)&&!Ee._f.deps||g8(qt,Ue(n.touchedFields,me),n.isSubmitted,qe,Re),Ks=xj(me,c,qt);Ts(i,me,Os),qt?(Ee._f.onBlur&&Ee._f.onBlur(q),u&&u(0)):Ee._f.onChange&&Ee._f.onChange(q);const ds=k(me,Os,qt),zs=!nr(ds)||Ks;if(!qt&&g.state.next({name:me,type:q.type,values:mn(i)}),tn)return(h.isValid||p.isValid)&&(s.mode==="onBlur"?qt&&b():qt||b()),zs&&g.state.next({name:me,...Ks?{}:ds});if(!qt&&Ks&&g.state.next({...n}),s.resolver){const{errors:Ps}=await T([me]);if(Ne(Os),Te){const $n=gj(n.errors,r,me),Ve=gj(Ps,r,$n.name||me);st=Ve.error,me=Ve.name,es=nr(Ps)}}else v([me],!0),st=(await yj(Ee,c.disabled,i,x,s.shouldUseNativeValidation))[me],v([me]),Ne(Os),Te&&(st?es=!1:(h.isValid||p.isValid)&&(es=await O(r,!0)));Te&&(Ee._f.deps&&ae(Ee._f.deps),D(me,es,st,ds))}},G=(q,ne)=>{if(Ue(n.errors,ne)&&q.focus)return q.focus(),1},ae=async(q,ne={})=>{let me,Te;const Ee=Vc(q);if(s.resolver){const Ne=await R(Xs(q)?q:Ee);me=nr(Ne),Te=q?!Ee.some(Re=>Ue(Ne,Re)):me}else q?(Te=(await Promise.all(Ee.map(async Ne=>{const Re=Ue(r,Ne);return await O(Re&&Re._f?{[Ne]:Re}:Re)}))).every(Boolean),!(!Te&&!n.isValid)&&b()):Te=me=await O(r);return g.state.next({...!_a(q)||(h.isValid||p.isValid)&&me!==n.isValid?{}:{name:q},...s.resolver||!q?{isValid:me}:{},errors:n.errors}),ne.shouldFocus&&!Te&&Gc(r,G,q?Ee:c.mount),Te},Y=q=>{const ne={...o.mount?i:a};return Xs(q)?ne:_a(q)?Ue(ne,q):q.map(me=>Ue(ne,me))},X=(q,ne)=>({invalid:!!Ue((ne||n).errors,q),isDirty:!!Ue((ne||n).dirtyFields,q),error:Ue((ne||n).errors,q),isValidating:!!Ue(n.validatingFields,q),isTouched:!!Ue((ne||n).touchedFields,q)}),se=q=>{q&&Vc(q).forEach(ne=>Js(n.errors,ne)),g.state.next({errors:q?n.errors:{}})},H=(q,ne,me)=>{const Te=(Ue(r,q,{_f:{}})._f||{}).ref,Ee=Ue(n.errors,q)||{},{ref:Ne,message:Re,type:qe,...st}=Ee;Ts(n.errors,q,{...st,...ne,ref:Te}),g.state.next({name:q,errors:n.errors,isValid:!1}),me&&me.shouldFocus&&Te&&Te.focus&&Te.focus()},ie=(q,ne)=>sa(q)?g.state.subscribe({next:me=>q(_(void 0,ne),me)}):_(q,ne,!0),fe=q=>g.state.subscribe({next:ne=>{x8(q.name,ne.name,q.exact)&&p8(ne,q.formState||h,dt,q.reRenderRoot)&&q.callback({values:{...i},...n,...ne})}}).unsubscribe,le=q=>(o.mount=!0,p={...p,...q.formState},fe({...q,formState:p})),K=(q,ne={})=>{for(const me of q?Vc(q):c.mount)c.mount.delete(me),c.array.delete(me),ne.keepValue||(Js(r,me),Js(i,me)),!ne.keepError&&Js(n.errors,me),!ne.keepDirty&&Js(n.dirtyFields,me),!ne.keepTouched&&Js(n.touchedFields,me),!ne.keepIsValidating&&Js(n.validatingFields,me),!s.shouldUnregister&&!ne.keepDefaultValue&&Js(a,me);g.state.next({values:mn(i)}),g.state.next({...n,...ne.keepDirty?{isDirty:I()}:{}}),!ne.keepIsValid&&b()},de=({disabled:q,name:ne})=>{(Da(q)&&o.mount||q||c.disabled.has(ne))&&(q?c.disabled.add(ne):c.disabled.delete(ne))},je=(q,ne={})=>{let me=Ue(r,q);const Te=Da(ne.disabled)||Da(s.disabled);return Ts(r,q,{...me||{},_f:{...me&&me._f?me._f:{ref:{name:q}},name:q,mount:!0,...ne}}),c.mount.add(q),me?de({disabled:Da(ne.disabled)?ne.disabled:s.disabled,name:q}):E(q,!0,ne.value),{...Te?{disabled:ne.disabled||s.disabled}:{},...s.progressive?{required:!!ne.required,min:Pc(ne.min),max:Pc(ne.max),minLength:Pc(ne.minLength),maxLength:Pc(ne.maxLength),pattern:Pc(ne.pattern)}:{},name:q,onChange:z,onBlur:z,ref:Ee=>{if(Ee){je(q,ne),me=Ue(r,q);const Ne=Xs(Ee.value)&&Ee.querySelectorAll&&Ee.querySelectorAll("input,select,textarea")[0]||Ee,Re=c8(Ne),qe=me._f.refs||[];if(Re?qe.find(st=>st===Ne):Ne===me._f.ref)return;Ts(r,q,{_f:{...me._f,...Re?{refs:[...qe.filter(sp),Ne,...Array.isArray(Ue(a,q))?[{}]:[]],ref:{type:Ne.type,name:q}}:{ref:Ne}}}),E(q,!1,void 0,Ne)}else me=Ue(r,q,{}),me._f&&(me._f.mount=!1),(s.shouldUnregister||ne.shouldUnregister)&&!(s8(c.array,q)&&o.action)&&c.unMount.add(q)}}},ge=()=>s.shouldFocusError&&Gc(r,G,c.mount),Se=q=>{Da(q)&&(g.state.next({disabled:q}),Gc(r,(ne,me)=>{const Te=Ue(r,me);Te&&(ne.disabled=Te._f.disabled||q,Array.isArray(Te._f.refs)&&Te._f.refs.forEach(Ee=>{Ee.disabled=Te._f.disabled||q}))},0,!1))},oe=(q,ne)=>async me=>{let Te;me&&(me.preventDefault&&me.preventDefault(),me.persist&&me.persist());let Ee=mn(i);if(g.state.next({isSubmitting:!0}),s.resolver){const{errors:Ne,values:Re}=await T();n.errors=Ne,Ee=mn(Re)}else await O(r);if(c.disabled.size)for(const Ne of c.disabled)Js(Ee,Ne);if(Js(n.errors,"root"),nr(n.errors)){g.state.next({errors:{}});try{await q(Ee,me)}catch(Ne){Te=Ne}}else ne&&await ne({...n.errors},me),ge(),setTimeout(ge);if(g.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:nr(n.errors)&&!Te,submitCount:n.submitCount+1,errors:n.errors}),Te)throw Te},J=(q,ne={})=>{Ue(r,q)&&(Xs(ne.defaultValue)?P(q,mn(Ue(a,q))):(P(q,ne.defaultValue),Ts(a,q,mn(ne.defaultValue))),ne.keepTouched||Js(n.touchedFields,q),ne.keepDirty||(Js(n.dirtyFields,q),n.isDirty=ne.defaultValue?I(q,mn(Ue(a,q))):I()),ne.keepError||(Js(n.errors,q),h.isValid&&b()),g.state.next({...n}))},ye=(q,ne={})=>{const me=q?mn(q):a,Te=mn(me),Ee=nr(q),Ne=Ee?a:Te;if(ne.keepDefaultValues||(a=me),!ne.keepValues){if(ne.keepDirtyValues){const Re=new Set([...c.mount,...Object.keys(Oc(a,i))]);for(const qe of Array.from(Re))Ue(n.dirtyFields,qe)?Ts(Ne,qe,Ue(i,qe)):P(qe,Ue(Ne,qe))}else{if(Eg&&Xs(q))for(const Re of c.mount){const qe=Ue(r,Re);if(qe&&qe._f){const st=Array.isArray(qe._f.refs)?qe._f.refs[0]:qe._f.ref;if(Sm(st)){const es=st.closest("form");if(es){es.reset();break}}}}if(ne.keepFieldsRef)for(const Re of c.mount)P(Re,Ue(Ne,Re));else r={}}i=s.shouldUnregister?ne.keepDefaultValues?mn(a):{}:mn(Ne),g.array.next({values:{...Ne}}),g.state.next({values:{...Ne}})}c={mount:ne.keepDirtyValues?c.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},o.mount=!h.isValid||!!ne.keepIsValid||!!ne.keepDirtyValues,o.watch=!!s.shouldUnregister,g.state.next({submitCount:ne.keepSubmitCount?n.submitCount:0,isDirty:Ee?!1:ne.keepDirty?n.isDirty:!!(ne.keepDefaultValues&&!qi(q,a)),isSubmitted:ne.keepIsSubmitted?n.isSubmitted:!1,dirtyFields:Ee?{}:ne.keepDirtyValues?ne.keepDefaultValues&&i?Oc(a,i):n.dirtyFields:ne.keepDefaultValues&&q?Oc(a,q):ne.keepDirty?n.dirtyFields:{},touchedFields:ne.keepTouched?n.touchedFields:{},errors:ne.keepErrors?n.errors:{},isSubmitSuccessful:ne.keepIsSubmitSuccessful?n.isSubmitSuccessful:!1,isSubmitting:!1})},xt=(q,ne)=>ye(sa(q)?q(i):q,ne),gt=(q,ne={})=>{const me=Ue(r,q),Te=me&&me._f;if(Te){const Ee=Te.refs?Te.refs[0]:Te.ref;Ee.focus&&(Ee.focus(),ne.shouldSelect&&sa(Ee.select)&&Ee.select())}},dt=q=>{n={...n,...q}},Ss={control:{register:je,unregister:K,getFieldState:X,handleSubmit:oe,setError:H,_subscribe:fe,_runSchema:T,_focusError:ge,_getWatch:_,_getDirty:I,_setValid:b,_setFieldArray:w,_setDisabledField:de,_setErrors:S,_getFieldArray:M,_reset:ye,_resetDefaultValues:()=>sa(s.defaultValues)&&s.defaultValues().then(q=>{xt(q,s.resetOptions),g.state.next({isLoading:!1})}),_removeUnmounted:U,_disableForm:Se,_subjects:g,_proxyFormState:h,get _fields(){return r},get _formValues(){return i},get _state(){return o},set _state(q){o=q},get _defaultValues(){return a},get _names(){return c},set _names(q){c=q},get _formState(){return n},get _options(){return s},set _options(q){s={...s,...q}}},subscribe:le,trigger:ae,register:je,handleSubmit:oe,watch:ie,setValue:P,getValues:Y,reset:xt,resetField:J,clearErrors:se,unregister:K,setError:H,setFocus:gt,getFieldState:X};return{...Ss,formControl:Ss}}function w8(t={}){const s=ee.useRef(void 0),n=ee.useRef(void 0),[r,a]=ee.useState({isDirty:!1,isValidating:!1,isLoading:sa(t.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1,isReady:!1,defaultValues:sa(t.defaultValues)?void 0:t.defaultValues});if(!s.current)if(t.formControl)s.current={...t.formControl,formState:r},t.defaultValues&&!sa(t.defaultValues)&&t.formControl.reset(t.defaultValues,t.resetOptions);else{const{formControl:o,...c}=j8(t);s.current={...c,formState:r}}const i=s.current.control;return i._options=t,i8(()=>{const o=i._subscribe({formState:i._proxyFormState,callback:()=>a({...i._formState}),reRenderRoot:!0});return a(c=>({...c,isReady:!0})),i._formState.isReady=!0,o},[i]),ee.useEffect(()=>i._disableForm(t.disabled),[i,t.disabled]),ee.useEffect(()=>{t.mode&&(i._options.mode=t.mode),t.reValidateMode&&(i._options.reValidateMode=t.reValidateMode)},[i,t.mode,t.reValidateMode]),ee.useEffect(()=>{t.errors&&(i._setErrors(t.errors),i._focusError())},[i,t.errors]),ee.useEffect(()=>{t.shouldUnregister&&i._subjects.state.next({values:i._getWatch()})},[i,t.shouldUnregister]),ee.useEffect(()=>{if(i._proxyFormState.isDirty){const o=i._getDirty();o!==r.isDirty&&i._subjects.state.next({isDirty:o})}},[i,r.isDirty]),ee.useEffect(()=>{t.values&&!qi(t.values,n.current)?(i._reset(t.values,{keepFieldsRef:!0,...i._options.resetOptions}),n.current=t.values,a(o=>({...o}))):i._resetDefaultValues()},[i,t.values]),ee.useEffect(()=>{i._state.mount||(i._setValid(),i._state.mount=!0),i._state.watch&&(i._state.watch=!1,i._subjects.state.next({...i._formState})),i._removeUnmounted()}),s.current.formState=a8(r,i),s.current}const N8={"--background":"0 0% 100%","--foreground":"222.2 84% 4.9%","--card":"0 0% 100%","--card-foreground":"222.2 84% 4.9%","--popover":"0 0% 100%","--popover-foreground":"222.2 84% 4.9%","--primary":"262.1 83.3% 57.8%","--primary-foreground":"210 40% 98%","--secondary":"220 14.3% 95.9%","--secondary-foreground":"222.2 47.4% 11.2%","--muted":"220 14.3% 95.9%","--muted-foreground":"220 8.9% 46.1%","--accent":"220 14.3% 95.9%","--accent-foreground":"222.2 47.4% 11.2%","--destructive":"0 84.2% 60.2%","--destructive-foreground":"210 40% 98%","--border":"220 13% 91%","--input":"220 13% 91%","--ring":"262.1 83.3% 57.8%","--radius":"0.75rem","--chart-1":"262.1 83.3% 57.8%","--chart-2":"173 58% 39%","--chart-3":"197 37% 24%","--chart-4":"43 74% 66%","--chart-5":"27 87% 67%","--desktop-nav-width":"64px","--font-family":"system-ui, sans-serif"},S8={"--background":"0 0% 100%","--foreground":"222.2 84% 4.9%","--primary":"212 100% 50%","--primary-foreground":"210 40% 98%","--secondary":"220 14% 95%","--secondary-foreground":"222.2 47.4% 11.2%","--muted":"220 14.3% 95.9%","--muted-foreground":"220 8.9% 46.1%","--accent":"212 100% 50%","--accent-foreground":"210 40% 98%","--border":"220 13% 91%","--input":"220 13% 91%","--ring":"212 100% 60%","--font-family":"'Menlo', 'Courier New', monospace"},bj={default:N8,programmer:S8},fE=f.createContext(null),C8=()=>{const t=f.useContext(fE);if(!t)throw new Error("useTheme must be used within ThemeProvider");return t},E8=({children:t,defaultTheme:s="default"})=>{const{user:n}=Je(),[r,a]=f.useState(s),i=f.useCallback(async()=>{if(n)try{const c=ke(xe,"settings",n.uid);Me.logRead("settings","ThemeProvider.loadTheme",n.uid);const u=await ot(c);if(u.exists()){const d=u.data();a((d==null?void 0:d.theme)||s)}else a(s)}catch(c){console.error("Error loading theme:",c),a(s)}},[n,s]);f.useEffect(()=>{i()},[i]),f.useEffect(()=>{const c=bj[r]||bj[s];Object.entries(c).forEach(([u,d])=>{document.documentElement.style.setProperty(u,d)})},[r,s]);const o=f.useCallback(async c=>{if(a(c),n)try{const u=ke(xe,"settings",n.uid);Me.logWrite("settings","ThemeProvider.updateTheme",n.uid),await Zt(u,{userId:n.uid,theme:c},{merge:!0})}catch(u){console.error("Error saving theme:",u)}},[n]);return e.jsx(fE.Provider,{value:{theme:r,setTheme:o},children:t})};function T8(){const{user:t}=Je(),[s,n]=f.useState(null),[r,a]=f.useState(!0),[i,o]=f.useState(null),c=f.useCallback(async()=>{if(!t){a(!1);return}a(!0),o(null);try{const d=ke(xe,"settings",t.uid);Me.logRead("settings","useUserSettings.loadSettings",t.uid);const h=await ot(d);n(h.exists()?h.data():null),a(!1)}catch(d){o(d instanceof Error?d.message:"Error loading settings"),a(!1)}},[t]);return f.useEffect(()=>{c()},[c]),{settings:s,loading:r,error:i,saveSettings:async d=>{if(!t)return;const h=s;try{const p={...s,...d};n(p);const g=ke(xe,"settings",t.uid);Me.logWrite("settings","useUserSettings.saveSettings",t.uid),await Zt(g,{userId:t.uid,...d},{merge:!0})}catch(p){throw n(h),o(p instanceof Error?p.message:"Error saving settings"),p}},refetch:c}}function jj({onAdd:t,trigger:s}){const[n,r]=f.useState(!1),[a,i]=f.useState(""),[o,c]=f.useState(""),[u,d]=f.useState(Jf[0]),[h,p]=f.useState(null),g=y=>{if(y.preventDefault(),p(null),!a.trim()){p("El nombre del calendario es obligatorio");return}if(!o.trim()){p("La URL del calendario es obligatoria");return}if(!$1(o)){p("La URL debe ser una URL pblica de Google Calendar en formato iCal (HTTPS)");return}t(a.trim(),o.trim(),u),i(""),c(""),d(Jf[0]),r(!1)},x=y=>{r(y),y||p(null)};return e.jsxs(kt,{open:n,onOpenChange:x,children:[e.jsx(Dx,{asChild:!0,children:s||e.jsxs($,{children:[e.jsx(cs,{className:"w-4 h-4 mr-2"}),"Agregar Calendario"]})}),e.jsx(wt,{className:"sm:max-w-[500px]",children:e.jsxs("form",{onSubmit:g,children:[e.jsxs(At,{children:[e.jsx(_t,{children:"Agregar Calendario Externo"}),e.jsx(cn,{children:"Agrega un calendario de Google Calendar mediante su URL pblica en formato iCal."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ze,{htmlFor:"calendar-name",children:"Nombre del Calendario"}),e.jsx(Fe,{id:"calendar-name",placeholder:"Ej: Calendario Laboral",value:a,onChange:y=>i(y.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ze,{htmlFor:"calendar-url",children:"URL Pblica (iCal)"}),e.jsx(Fe,{id:"calendar-url",type:"url",placeholder:"https://calendar.google.com/calendar/ical/...",value:o,onChange:y=>c(y.target.value),required:!0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Debe ser una URL HTTPS que termine en .ics"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ze,{children:"Color"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:Jf.map(y=>e.jsx("button",{type:"button",className:"w-8 h-8 rounded-full border-2 transition-all hover:scale-110",style:{backgroundColor:y,borderColor:u===y?"#000":"transparent"},onClick:()=>d(y),"aria-label":`Select color ${y}`},y))})]}),e.jsxs(hi,{children:[e.jsx(zO,{className:"h-4 w-4"}),e.jsxs(fi,{className:"text-xs",children:[e.jsx("strong",{children:"Cmo obtener la URL?"}),e.jsxs("ol",{className:"list-decimal list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"Abre Google Calendar en tu navegador"}),e.jsx("li",{children:"Ve a Configuracin  Configuracin del calendario"}),e.jsx("li",{children:"Selecciona el calendario que deseas agregar"}),e.jsx("li",{children:'En "Integrar calendario", copia la "Direccin secreta en formato iCal"'})]})]})]}),e.jsxs(hi,{variant:"destructive",children:[e.jsx(ro,{className:"h-4 w-4"}),e.jsxs(fi,{className:"text-xs",children:[e.jsx("strong",{children:"Advertencia de Privacidad:"})," Al usar calendarios pblicos, cualquier persona con la URL puede ver tus eventos. Solo usa esta opcin con calendarios que no contengan informacin sensible, o crea un calendario separado para sincronizar."]})]}),h&&e.jsxs(hi,{variant:"destructive",children:[e.jsx(ro,{className:"h-4 w-4"}),e.jsx(fi,{children:h})]})]}),e.jsxs(Cn,{children:[e.jsx($,{type:"button",variant:"outline",onClick:()=>r(!1),children:"Cancelar"}),e.jsx($,{type:"submit",children:"Agregar"})]})]})})]})}var dh="Switch",[D8,yY]=za(dh),[k8,A8]=D8(dh),pE=f.forwardRef((t,s)=>{const{__scopeSwitch:n,name:r,checked:a,defaultChecked:i,required:o,disabled:c,value:u="on",onCheckedChange:d,form:h,...p}=t,[g,x]=f.useState(null),y=bs(s,S=>x(S)),b=f.useRef(!1),v=g?h||!!g.closest("form"):!0,[w,N]=Oa({prop:a,defaultProp:i??!1,onChange:d,caller:dh});return e.jsxs(k8,{scope:n,checked:w,disabled:c,children:[e.jsx(jt.button,{type:"button",role:"switch","aria-checked":w,"aria-required":o,"data-state":yE(w),"data-disabled":c?"":void 0,disabled:c,value:u,...p,ref:y,onClick:it(t.onClick,S=>{N(E=>!E),v&&(b.current=S.isPropagationStopped(),b.current||S.stopPropagation())})}),v&&e.jsx(vE,{control:g,bubbles:!b.current,name:r,value:u,checked:w,required:o,disabled:c,form:h,style:{transform:"translateX(-100%)"}})]})});pE.displayName=dh;var xE="SwitchThumb",gE=f.forwardRef((t,s)=>{const{__scopeSwitch:n,...r}=t,a=A8(xE,n);return e.jsx(jt.span,{"data-state":yE(a.checked),"data-disabled":a.disabled?"":void 0,...r,ref:s})});gE.displayName=xE;var _8="SwitchBubbleInput",vE=f.forwardRef(({__scopeSwitch:t,control:s,checked:n,bubbles:r=!0,...a},i)=>{const o=f.useRef(null),c=bs(o,i),u=kx(n),d=Ij(s);return f.useEffect(()=>{const h=o.current;if(!h)return;const p=window.HTMLInputElement.prototype,x=Object.getOwnPropertyDescriptor(p,"checked").set;if(u!==n&&x){const y=new Event("click",{bubbles:r});x.call(h,n),h.dispatchEvent(y)}},[u,n,r]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:n,...a,tabIndex:-1,ref:c,style:{...a.style,...d,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});vE.displayName=_8;function yE(t){return t?"checked":"unchecked"}var bE=pE,R8=gE;const jE=f.forwardRef(({className:t,...s},n)=>e.jsx(bE,{className:ce("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...s,ref:n,children:e.jsx(R8,{className:ce("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));jE.displayName=bE.displayName;function O8({calendar:t,onToggle:s,onRemove:n,onSync:r,isSyncing:a=!1}){const i=t.lastSyncedAt?`Sincronizado ${Kj(t.lastSyncedAt,{locale:Zs,addSuffix:!0})}`:"Nunca sincronizado";return e.jsxs("div",{className:"flex items-center gap-4 p-4 border rounded-lg",children:[e.jsx("div",{className:"w-4 h-4 rounded-full flex-shrink-0",style:{backgroundColor:t.color}}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"font-medium truncate",children:t.name}),!t.enabled&&e.jsx(Mt,{variant:"secondary",className:"text-xs",children:"Deshabilitado"})]}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:t.url}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:i})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx($,{variant:"ghost",size:"sm",onClick:()=>r(t.id),disabled:a,children:e.jsx(ao,{className:`w-4 h-4 ${a?"animate-spin":""}`})}),e.jsx(jE,{checked:t.enabled,onCheckedChange:()=>s(t.id)}),e.jsxs(Wa,{children:[e.jsx(yi,{asChild:!0,children:e.jsx($,{variant:"ghost",size:"sm",children:e.jsx(oo,{className:"w-4 h-4 text-destructive"})})}),e.jsxs(fa,{children:[e.jsxs(pa,{children:[e.jsx(ga,{children:"Eliminar calendario?"}),e.jsxs(va,{children:['Se eliminar "',t.name,'" y todos sus eventos de Life Tracker. Esta accin no afecta tu calendario en Google Calendar.']})]}),e.jsxs(xa,{children:[e.jsx(ba,{children:"Cancelar"}),e.jsx(ya,{onClick:()=>n(t.id),children:"Eliminar"})]})]})]})]})]})}const P8=()=>{const{settings:t,saveSettings:s}=T8(),{setTheme:n}=C8(),{user:r,signOut:a}=Je(),i=Qt(),{register:o,handleSubmit:c,reset:u}=w8(),{calendars:d,addCalendar:h,toggleCalendar:p,removeCalendar:g,syncCalendar:x,syncAllCalendars:y,syncStatus:b,lastSyncTime:v}=z1();f.useEffect(()=>{t&&u(t)},[t,u]);const w=async E=>{await s(E),E.theme&&n(E.theme)},N=async()=>{try{await a(),i("/login")}catch(E){console.error("Error al cerrar sesin:",E)}},S=E=>E?E.split(" ").map(k=>k.charAt(0)).join("").toUpperCase().slice(0,2):"U";return e.jsx(ln,{children:e.jsxs("div",{className:"space-y-6 max-w-md",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Perfil y Configuracin"}),e.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-white rounded-lg shadow-sm border",children:[e.jsxs("div",{className:"relative",children:[r!=null&&r.photoURL?e.jsx("img",{src:r.photoURL,alt:"Profile",className:"w-16 h-16 rounded-full border-2 border-gray-200",onError:E=>{var k;E.currentTarget.style.display="none",(k=E.currentTarget.nextElementSibling)==null||k.classList.remove("hidden")}}):null,e.jsx("div",{className:`w-16 h-16 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold text-xl border-2 border-gray-200 ${r!=null&&r.photoURL?"hidden":""}`,children:S((r==null?void 0:r.displayName)||(r==null?void 0:r.email)||null)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:(r==null?void 0:r.displayName)||"Usuario"}),e.jsx("p",{className:"text-sm text-gray-600",children:r==null?void 0:r.email})]})]}),e.jsxs("form",{onSubmit:c(w),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ze,{htmlFor:"name",children:"Nombre"}),e.jsx(Fe,{id:"name",...o("name")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ze,{htmlFor:"birthDate",children:"Fecha de nacimiento"}),e.jsx(Fe,{id:"birthDate",type:"date",...o("birthDate")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ze,{htmlFor:"theme",children:"Tema"}),e.jsxs("select",{id:"theme",className:"border rounded-md p-2",...o("theme"),children:[e.jsx("option",{value:"default",children:"Default"}),e.jsx("option",{value:"programmer",children:"Programador Claro"})]})]}),e.jsx($,{type:"submit",children:"Guardar"})]}),e.jsxs("div",{className:"space-y-4 pt-6 border-t",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Calendarios Externos"}),e.jsx(F1,{onSync:y,syncStatus:b,lastSyncTime:v,variant:"outline",size:"sm"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Sincroniza eventos de Google Calendar mediante URLs pblicas en formato iCal."}),d.length===0?e.jsxs("div",{className:"text-center py-8 border-2 border-dashed rounded-lg",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"No hay calendarios configurados"}),e.jsx(jj,{onAdd:h})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2",children:d.map(E=>e.jsx(O8,{calendar:E,onToggle:p,onRemove:g,onSync:x,isSyncing:b==="syncing"},E.id))}),e.jsx(jj,{onAdd:h})]})]}),e.jsx("div",{className:"pt-4 border-t",children:e.jsxs($,{variant:"destructive",onClick:N,className:"w-full",children:[e.jsx(FO,{className:"w-4 h-4 mr-2"}),"Cerrar Sesin"]})})]})})},M8=({taskId:t,onComplete:s})=>{const[n,r]=f.useState(0),[a,i]=f.useState(!1),[o,c]=f.useState(!1),[u,d]=f.useState(null),[h,p]=f.useState(0),[g,x]=f.useState(null),y=f.useRef(),b=f.useRef(),v=f.useRef(!1),w=f.useCallback(()=>{y.current&&(clearInterval(y.current),y.current=void 0),b.current&&(clearInterval(b.current),b.current=void 0)},[]),N=f.useCallback(()=>{if(!a||o||!u)return h;const O=Date.now(),U=Math.floor((O-u)/1e3);return h+U},[a,o,u,h]);f.useEffect(()=>{if(!a||o){w();return}return y.current=setInterval(()=>{r(N())},1e3),w},[a,o,N,w]),f.useEffect(()=>((async()=>{try{Me.logRead("tasks","useTaskTimer.loadTaskData",t);const U=ke(xe,"tasks",t),I=await ot(U);if(!I.exists())return;const _=I.data();if(i(_.timerActive||!1),c(_.timerPaused||!1),p(_.elapsedSeconds||0),x({title:_.title||"",description:_.description||""}),_.timerActive&&!_.timerPaused&&_.timerStartTime){const M=Date.now(),W=Math.floor((M-_.timerStartTime.timestamp)/1e3);d(M-W*1e3),r(_.elapsedSeconds||0)}else d(null),r(_.elapsedSeconds||0)}catch(U){console.error("Error loading task data:",U)}})(),w),[t,w]),f.useEffect(()=>{if(!a||o||v.current){b.current&&(clearInterval(b.current),b.current=void 0);return}return b.current=setInterval(async()=>{try{const O=N();O-h>30&&(Me.logWrite("tasks","useTaskTimer.autoSave",t),await ar(ke(xe,"tasks",t),{elapsedSeconds:O}),p(O))}catch(O){console.error("Error saving timer progress:",O)}},3e5),()=>{b.current&&(clearInterval(b.current),b.current=void 0)}},[a,o,t,N,h]);const S=f.useCallback(async()=>{if(!(a||v.current)){v.current=!0;try{const O=Date.now(),U=new Date,I=jn(U,U.getHours(),U.getMinutes());i(!0),c(!1),d(O),Me.logWrite("tasks","useTaskTimer.startTimer",t),await ar(ke(xe,"tasks",t),{timerStartTime:I,timerActive:!0,timerPaused:!1,pausedDuration:0})}catch(O){console.error("Error starting timer:",O),i(!1),d(null)}finally{v.current=!1}}},[a,t]),E=f.useCallback(async()=>{if(!(!a||o||v.current)){v.current=!0;try{const O=N();c(!0),p(O),Me.logWrite("tasks","useTaskTimer.pauseTimer",t),await ar(ke(xe,"tasks",t),{elapsedSeconds:O,timerPaused:!0})}catch(O){console.error("Error pausing timer:",O),c(!1)}finally{v.current=!1}}},[a,o,t,N]),k=f.useCallback(async()=>{if(!(!a||!o||v.current)){v.current=!0;try{const O=Date.now(),U=new Date,I=jn(U,U.getHours(),U.getMinutes());c(!1),d(O),Me.logWrite("tasks","useTaskTimer.resumeTimer",t),await ar(ke(xe,"tasks",t),{timerStartTime:I,timerPaused:!1})}catch(O){console.error("Error resuming timer:",O),c(!0)}finally{v.current=!1}}},[a,o,t]),D=f.useCallback(async()=>{if(!(!a||v.current)){v.current=!0;try{const O=N();i(!1),c(!1),d(null),p(O),r(O),Me.logWrite("tasks","useTaskTimer.stopTimer",t),await ar(ke(xe,"tasks",t),{elapsedSeconds:O,timerActive:!1,timerPaused:!1,timerStartTime:null})}catch(O){console.error("Error stopping timer:",O),i(!0)}finally{v.current=!1}}},[a,t,N]),T=f.useCallback(async()=>{if(!v.current){v.current=!0;try{const O=N();i(!1),c(!1),d(null),p(O),r(O),Me.logWrite("tasks","useTaskTimer.completeTask",t),await ar(ke(xe,"tasks",t),{completed:!0,elapsedSeconds:O,timerActive:!1,timerPaused:!1,timerStartTime:null,progress:100}),s(O)}catch(O){console.error("Error completing task:",O)}finally{v.current=!1}}},[t,N,s]);return{time:n,isActive:a,isPaused:o,formattedTime:(O=>{const U=Math.floor(O/3600),I=Math.floor(O%3600/60),_=O%60;return[U,I,_].map(W=>String(W).padStart(2,"0")).join(":")})(n),taskData:g,startTimer:S,pauseTimer:E,resumeTimer:k,stopTimer:D,completeTask:T}},I8=t=>{const[s,n]=f.useState(null),[r,a]=f.useState(!0),[i,o]=f.useState(null),{user:c}=Je(),u=f.useCallback(async()=>{var h,p,g,x,y;if(!c||!t){n(null),a(!1);return}const d=typeof t=="string"?parseInt(t,10):t;if(isNaN(d)||d<1e4||d>99999){o("Cdigo de tarea invlido. Debe ser un nmero de 5 dgitos."),a(!1);return}a(!0),o(null);try{Me.logRead("tasks",`useTaskByCode.fetchTaskByCode - taskCode: ${d}`);const b=Bt(xe,"tasks"),v=xn(b,Et("userId","==",c.uid),Et("taskCode","==",d),Xj(1)),w=await gn(v);if(w.empty){o("Tarea no encontrada"),n(null),a(!1);return}const N=w.docs[0],S=N.data(),E={id:N.id,taskCode:S.taskCode||0,title:S.title,description:S.description||"",completed:S.completed,createdAt:S.createdAt,updatedAt:(h=S.updatedAt)==null?void 0:h.toDate(),startDate:((p=S.startDate)==null?void 0:p.toDate())||((g=S.dueDate)==null?void 0:g.toDate()),endDate:(x=S.endDate)==null?void 0:x.toDate(),isRecurrent:S.isRecurrent||!1,isPrivate:S.isPrivate||!1,category:S.category||"other",priority:S.priority||"delete",size:S.size||"pequea",estimatedTime:S.estimatedTime,timeOfDay:S.timeOfDay,elapsedSeconds:S.elapsedSeconds||0,progress:typeof S.progress=="number"?S.progress:Li(S.description||""),timerStartTime:S.timerStartTime,timerPaused:S.timerPaused||!1,pausedDuration:S.pausedDuration||0,timerActive:S.timerActive||!1,recurrence:S.recurrence?{frequency:S.recurrence.frequency,pattern:S.recurrence.pattern,customDays:S.recurrence.customDays,nextDate:(y=S.recurrence.nextDate)==null?void 0:y.toDate()}:void 0};n(E),a(!1)}catch(b){console.error("Error fetching task by code:",b),o(b instanceof Error?b.message:"Error al cargar la tarea"),n(null),a(!1)}},[c,t]);return f.useEffect(()=>{u()},[u]),{task:s,loading:r,error:i,refetch:u}},L8=t=>{const s=t.split(`
`),n=[],r=[];for(const a of s){const i=a.match(/^\s*- \[( |x|X)\] ?(.*)/);i?r.push({text:i[2],checked:i[1].toLowerCase()==="x"}):n.push(a)}return{body:n.join(`
`),checklist:r}},$8=(t,s)=>{const n=t?t.split(`
`):[],r=s.map(a=>`- [${a.checked?"x":" "}] ${a.text}`);return[...n,...r].join(`
`).trim()},z8=t=>{const s=["bg-gradient-to-br from-slate-800 via-slate-900 to-black","bg-gradient-to-br from-blue-900 via-blue-950 to-slate-900","bg-gradient-to-br from-indigo-900 via-purple-900 to-slate-900","bg-gradient-to-br from-emerald-900 via-teal-900 to-slate-900","bg-gradient-to-br from-purple-900 via-indigo-900 to-slate-900","bg-gradient-to-br from-teal-900 via-cyan-900 to-slate-900","bg-gradient-to-br from-gray-900 via-slate-900 to-zinc-900","bg-gradient-to-br from-neutral-900 via-gray-900 to-black","bg-gradient-to-br from-stone-900 via-neutral-900 to-slate-900","bg-gradient-to-br from-zinc-900 via-gray-900 to-black"],n=t%s.length;return s[n]};function F8(){const{taskCode:t}=px(),s=Qt(),{task:n,loading:r,error:a,refetch:i}=I8(t||""),{showRecurrenceModal:o,currentTask:c,modalMode:u,addTask:d,editTask:h,completeRecurrentTask:p,setShowRecurrenceModal:g,openEditModal:x}=qo(),{formattedTime:y,isActive:b,isPaused:v,startTimer:w,pauseTimer:N,resumeTimer:S,stopTimer:E,completeTask:k}=M8({taskId:(n==null?void 0:n.id)||"",onComplete:()=>s(-1)}),D=n,{body:T,checklist:R}=f.useMemo(()=>L8((D==null?void 0:D.description)||""),[D==null?void 0:D.description]),[O,U]=f.useState([]);f.useEffect(()=>{U(R)},[R]);const I=f.useMemo(()=>z8((D==null?void 0:D.taskCode)||0),[D==null?void 0:D.taskCode]),_=async M=>{if(!(D!=null&&D.id))return;const W=O.map((P,z)=>z===M?{...P,checked:!P.checked}:P);U(W);const B=$8(T,W);await ar(ke(xe,"tasks",D.id),{description:B,progress:Li(B)})};return r?e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-slate-900 text-white p-6",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white mb-4"}),e.jsx("p",{className:"text-xl",children:"Cargando tarea..."})]}):a||!D?e.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-slate-900 text-white p-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Tarea no encontrada"}),e.jsx("p",{className:"text-xl text-gray-300",children:a||"No se pudo encontrar la tarea solicitada"}),e.jsx($,{variant:"outline",className:"text-white border-white hover:bg-white/20",onClick:()=>s(-1),children:" Volver"})]})}):e.jsx("div",{className:`min-h-screen flex flex-col items-center ${I} text-white p-6`,children:e.jsxs("div",{className:"w-full max-w-4xl space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx($,{variant:"ghost",className:"text-white hover:bg-white/20 text-lg font-semibold drop-shadow-lg px-6 py-3",onClick:()=>s(-1),children:" Volver"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-lg font-mono font-semibold drop-shadow-lg bg-black/30 px-4 py-2 rounded-lg backdrop-blur-sm border border-white/20",children:["#",D.taskCode]}),e.jsx("div",{className:"text-4xl font-mono font-bold drop-shadow-xl bg-black/30 px-6 py-2 rounded-lg backdrop-blur-sm border border-white/20",children:y})]})]}),e.jsx("h1",{className:"text-5xl font-bold break-words drop-shadow-xl text-center leading-tight",children:(D==null?void 0:D.title)||""}),T&&e.jsx("div",{className:"prose prose-xl max-w-none text-white drop-shadow-md prose-headings:drop-shadow-lg prose-headings:text-white prose-p:text-white prose-strong:text-white prose-em:text-white",dangerouslySetInnerHTML:{__html:gN(T)}}),O.length>0&&e.jsx("div",{className:"space-y-6",children:O.map((M,W)=>e.jsxs("label",{className:"flex items-center space-x-4 text-2xl bg-black/20 p-4 rounded-lg backdrop-blur-sm",children:[e.jsx(Rs,{checked:M.checked,onCheckedChange:()=>_(W),className:"scale-125"}),e.jsx("span",{className:"select-none drop-shadow-md font-medium",children:M.text})]},W))}),e.jsxs("div",{className:"flex flex-col gap-6 mt-12",children:[e.jsx("div",{className:"flex gap-4 justify-center",children:b?e.jsxs(e.Fragment,{children:[v?e.jsxs($,{onClick:S,className:"bg-green-700 hover:bg-green-800 text-white px-8 py-4 text-xl font-semibold shadow-xl drop-shadow-lg border border-green-600",children:[e.jsx(Sn,{className:"w-6 h-6 mr-3"}),"Reanudar"]}):e.jsxs($,{onClick:N,className:"bg-amber-600 hover:bg-amber-700 text-white px-8 py-4 text-xl font-semibold shadow-xl drop-shadow-lg border border-amber-500",children:[e.jsx(dx,{className:"w-6 h-6 mr-3"}),"Pausar"]}),e.jsxs($,{onClick:E,className:"bg-red-700 hover:bg-red-800 text-white px-8 py-4 text-xl font-semibold shadow-xl drop-shadow-lg border border-red-600",children:[e.jsx(lx,{className:"w-6 h-6 mr-3"}),"Detener"]})]}):e.jsxs($,{onClick:w,className:"bg-green-700 hover:bg-green-800 text-white px-8 py-4 text-xl font-semibold shadow-xl drop-shadow-lg border border-green-600",children:[e.jsx(Sn,{className:"w-6 h-6 mr-3"}),"Iniciar"]})}),e.jsxs(Wa,{children:[e.jsx(yi,{asChild:!0,children:e.jsxs($,{className:"bg-blue-700 hover:bg-blue-800 text-white px-8 py-4 text-xl font-semibold w-full shadow-xl drop-shadow-lg border border-blue-600",children:[e.jsx(aa,{className:"w-6 h-6 mr-3"}),"Completar Tarea"]})}),e.jsxs(fa,{children:[e.jsxs(pa,{children:[e.jsx(ga,{children:"Completar Tarea"}),e.jsx(va,{children:"Ests seguro de que quieres completar esta tarea? El timer se detendr automticamente y la tarea ser marcada como completada."})]}),e.jsxs(xa,{children:[e.jsx(ba,{children:"Cancelar"}),e.jsx(ya,{onClick:k,className:"bg-blue-600 hover:bg-blue-700",children:"S, completar"})]})]})]}),e.jsxs($,{onClick:()=>x(D),className:"bg-gray-700 hover:bg-gray-800 text-white px-8 py-4 text-xl font-semibold w-full shadow-xl drop-shadow-lg border border-gray-600",children:[e.jsx(jr,{className:"w-6 h-6 mr-3"}),"Editar"]})]}),e.jsx(Gl,{isOpen:o,onClose:()=>g(),onConfirm:async M=>{u==="complete"?await p(M):u==="edit"?(await h(c.id,M),i()):await d(M)},task:c||D||{id:"",taskCode:0,title:"",completed:!1,category:"personal",createdAt:{seconds:Date.now()/1e3}},mode:u})]})})}const B8=({autoStart:t=!0}={})=>{const[s,n]=f.useState(0),[r,a]=f.useState(!1),[i,o]=f.useState(!1),[c,u]=f.useState(null),[d,h]=f.useState(0),p=f.useRef(null),g=f.useCallback(N=>{const S=Math.floor(N/3600),E=Math.floor(N%3600/60),k=N%60;return[S,E,k].map(T=>String(T).padStart(2,"0")).join(":")},[]),x=f.useCallback(()=>{a(!0),o(!1),u(Date.now())},[]),y=f.useCallback(()=>{if(r&&!i&&c){o(!0);const N=Date.now(),S=Math.floor((N-c)/1e3);h(E=>E+S)}},[r,i,c]),b=f.useCallback(()=>{r&&i&&(o(!1),u(Date.now()))},[r,i]),v=f.useCallback(()=>{p.current&&(clearInterval(p.current),p.current=null),a(!1),o(!1),h(0),u(null),n(0)},[]),w=f.useCallback(()=>{v(),t&&setTimeout(()=>x(),50)},[t,x,v]);return f.useEffect(()=>(r&&!i&&c?p.current=window.setInterval(()=>{const N=Date.now(),S=Math.floor((N-c)/1e3);n(d+S)},1e3):p.current&&(window.clearInterval(p.current),p.current=null),()=>{p.current&&(window.clearInterval(p.current),p.current=null)}),[r,i,c,d]),f.useEffect(()=>{t&&x()},[t,x]),f.useEffect(()=>()=>{p.current&&(window.clearInterval(p.current),p.current=null)},[]),{time:s,isActive:r,isPaused:i,formattedTime:g(s),startTimer:x,pauseTimer:y,resumeTimer:b,stopTimer:v,resetTimer:w}},H8=t=>{const s=["bg-gradient-to-br from-blue-900 via-blue-950 to-slate-900","bg-gradient-to-br from-emerald-900 via-teal-900 to-slate-900","bg-gradient-to-br from-purple-900 via-indigo-900 to-slate-900","bg-gradient-to-br from-amber-900 via-orange-900 to-slate-900","bg-gradient-to-br from-rose-900 via-pink-900 to-slate-900","bg-gradient-to-br from-cyan-900 via-blue-900 to-slate-900","bg-gradient-to-br from-violet-900 via-purple-900 to-slate-900","bg-gradient-to-br from-teal-900 via-emerald-900 to-slate-900","bg-gradient-to-br from-indigo-900 via-blue-900 to-slate-900","bg-gradient-to-br from-green-900 via-emerald-900 to-slate-900"];return s[t%s.length]};function U8(){var I;const{habitId:t}=px(),s=Qt(),n=Ln(),r=new Date(((I=n.state)==null?void 0:I.date)||new Date),{completedHabits:a,toggleHabit:i}=Fm(r),[o,c]=f.useState([]),{formattedTime:u,isActive:d,isPaused:h,startTimer:p,pauseTimer:g,resumeTimer:x,stopTimer:y}=B8(),b=vn.find(_=>_.id===Number(t)),v=Ie(r),w=`${t}_${v}`,N=a[w]||!1,S=f.useMemo(()=>H8(Number(t)),[t]),E=(b==null?void 0:b.steps)||[],k=E.length;if(f.useEffect(()=>{o.length===0&&k>0&&c(new Array(k).fill(!1))},[o.length,k]),!b)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-900 text-white",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Hbito no encontrado"}),e.jsx($,{onClick:()=>s(-1),variant:"outline",className:"text-white border-white hover:bg-white hover:text-gray-900",children:"Volver"})]})});const D=_=>{const M=[...o];M[_]=!M[_],c(M)},T=()=>{d?h?x():g():p()},R=async()=>{try{y(),await i(Number(t),v),s(-1)}catch(_){console.error("Error completing habit:",_)}},O=o.filter(Boolean).length,U=k>0?O/k*100:0;return e.jsx("div",{className:`min-h-screen flex flex-col ${S} text-white`,children:e.jsxs("div",{className:"flex-1 flex flex-col p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs($,{variant:"ghost",className:"text-white hover:bg-white/20 text-lg font-semibold drop-shadow-lg px-6 py-3",onClick:()=>s(-1),children:[e.jsx(El,{className:"w-5 h-5 mr-2"}),"Volver"]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-6xl font-mono font-bold drop-shadow-xl bg-black/30 px-6 py-3 rounded-lg backdrop-blur-sm border border-white/20",children:u}),e.jsx("div",{className:"mt-2",children:e.jsx($,{onClick:T,className:"bg-white/20 hover:bg-white/30 text-white px-4 py-2 text-sm font-semibold backdrop-blur-sm",children:d?h?e.jsxs(e.Fragment,{children:[e.jsx(Sn,{className:"w-4 h-4 mr-2"}),"Reanudar"]}):e.jsxs(e.Fragment,{children:[e.jsx(dx,{className:"w-4 h-4 mr-2"}),"Pausar"]}):e.jsxs(e.Fragment,{children:[e.jsx(Sn,{className:"w-4 h-4 mr-2"}),"Iniciar"]})})})]})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"text-8xl mb-4",children:b.icon}),e.jsx("h1",{className:"text-4xl font-bold drop-shadow-xl mb-2",children:b.name}),e.jsx("p",{className:"text-xl text-white/80 drop-shadow-lg",children:b.goal})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"w-full bg-black/20 rounded-full h-3 backdrop-blur-sm",children:e.jsx("div",{className:"bg-white h-3 rounded-full transition-all duration-300",style:{width:`${U}%`}})}),e.jsxs("div",{className:"text-center mt-2 text-white/80",children:[U.toFixed(0),"% completado"]})]}),k>0&&e.jsx("div",{className:"flex-1 mb-8",children:e.jsxs("div",{className:"bg-black/20 backdrop-blur-sm rounded-2xl p-6 mx-auto max-w-3xl",children:[e.jsx("h2",{className:"text-2xl font-semibold drop-shadow-lg mb-6 text-center",children:"Pasos a seguir"}),e.jsx("div",{className:"space-y-4",children:E.map((_,M)=>e.jsxs("div",{className:`flex items-center gap-4 p-4 rounded-lg transition-all duration-200 ${o[M]?"bg-green-500/20 border border-green-400/30":"bg-white/10 border border-white/20 hover:bg-white/20"}`,children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Rs,{checked:o[M]||!1,onCheckedChange:()=>D(M),className:"scale-125"})}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm font-medium text-white/60 min-w-[60px]",children:["Paso ",M+1]}),e.jsx("p",{className:`text-lg font-medium drop-shadow-lg ${o[M]?"line-through text-white/70":"text-white"}`,children:_})]})})]},M))})]})}),e.jsx("div",{className:"mt-auto",children:e.jsxs(Wa,{children:[e.jsx(yi,{asChild:!0,children:e.jsxs($,{className:"w-full bg-green-600 hover:bg-green-700 text-white px-8 py-4 text-xl font-semibold shadow-xl drop-shadow-lg border border-green-500",children:[e.jsx(aa,{className:"w-6 h-6 mr-3"}),N?"Hbito Completado":"Completar Hbito"]})}),e.jsxs(fa,{children:[e.jsxs(pa,{children:[e.jsx(ga,{children:N?"Desmarcar Hbito":"Completar Hbito"}),e.jsx(va,{children:N?"Ests seguro de que quieres desmarcar este hbito como completado?":"Ests seguro de que quieres marcar este hbito como completado?"})]}),e.jsxs(xa,{children:[e.jsx(ba,{children:"Cancelar"}),e.jsx(ya,{onClick:R,className:"bg-green-600 hover:bg-green-700",children:N?"S, desmarcar":"S, completar"})]})]})]})})]})})}const W8=({onComplete:t}={})=>{const[s,n]=f.useState(null),[r,a]=f.useState(0),[i,o]=f.useState(!1),[c,u]=f.useState(!1),d=f.useRef(null);f.useEffect(()=>(i&&!c&&s?d.current=window.setInterval(()=>{a(Date.now()-s)},1e3):d.current&&(window.clearInterval(d.current),d.current=null),()=>{d.current&&window.clearInterval(d.current)}),[i,c,s]);const h=v=>{const w=Math.floor(v/1e3),N=Math.floor(w/3600),S=Math.floor(w%3600/60),E=w%60;return N>0?`${N.toString().padStart(2,"0")}:${S.toString().padStart(2,"0")}:${E.toString().padStart(2,"0")}`:`${S.toString().padStart(2,"0")}:${E.toString().padStart(2,"0")}`},p=()=>{const v=Date.now();n(v),a(0),o(!0),u(!1)},g=()=>{u(!0)},x=()=>{if(s){const v=Date.now();n(v-r),u(!1)}},y=()=>{o(!1),u(!1),n(null),a(0)},b=()=>{y(),t==null||t()};return{formattedTime:h(r),elapsedTime:r,isActive:i,isPaused:c,startTimer:p,pauseTimer:g,resumeTimer:x,stopTimer:y,completeSession:b}},Y8=["xito","D1","Ara","Dollarcity","Olimpica (SAO)","Jumbo","Plaza de mercado","Panadera","Droguera","Otro"],V8=t=>{const s=["bg-gradient-to-br from-slate-800 via-slate-900 to-black","bg-gradient-to-br from-blue-900 via-blue-950 to-slate-900","bg-gradient-to-br from-indigo-900 via-purple-900 to-slate-900","bg-gradient-to-br from-emerald-900 via-teal-900 to-slate-900","bg-gradient-to-br from-purple-900 via-indigo-900 to-slate-900","bg-gradient-to-br from-teal-900 via-cyan-900 to-slate-900","bg-gradient-to-br from-gray-900 via-slate-900 to-zinc-900","bg-gradient-to-br from-orange-900 via-red-900 to-slate-900"],r=t.split("").reduce((a,i)=>a+i.charCodeAt(0),0)%s.length;return s[r]};function G8(){const t=Qt(),{items:s}=Jl(),[n,r]=f.useState(""),[a,i]=f.useState(!0),[o,c]=f.useState([]),{formattedTime:u,isActive:d,isPaused:h,startTimer:p,pauseTimer:g,resumeTimer:x,stopTimer:y,completeSession:b}=W8({onComplete:()=>t(-1)}),v=f.useMemo(()=>n?s.filter(T=>T.place===n&&T.toBuy>0).map(T=>({...T,purchased:!1})):[],[s,n]);f.useEffect(()=>{c(v)},[v]);const w=f.useMemo(()=>{const T=o.reduce((U,I)=>I.price?U+I.price*I.toBuy:U,0),R=o.reduce((U,I)=>I.purchased&&I.price?U+I.price*I.toBuy:U,0),O=o.reduce((U,I)=>!I.purchased&&I.price?U+I.price*I.toBuy:U,0);return{totalEstimated:T,totalPurchased:R,totalRemaining:O}},[o]),N=f.useMemo(()=>V8(n),[n]),S=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP"}),E=T=>{r(T),i(!1),p()},k=T=>{c(R=>R.map(O=>O.id===T?{...O,purchased:!O.purchased}:O))},D=()=>{b()};return a?e.jsx(kt,{open:a,onOpenChange:i,children:e.jsxs(wt,{className:"sm:max-w-md",children:[e.jsx(At,{children:e.jsx(_t,{children:"En qu tienda vas a comprar?"})}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs(Tt,{onValueChange:E,children:[e.jsx(vt,{children:e.jsx(Dt,{placeholder:"Selecciona una tienda"})}),e.jsx(yt,{children:Y8.map(T=>e.jsx(Pe,{value:T,children:T},T))})]})}),e.jsx(Cn,{children:e.jsx($,{variant:"outline",onClick:()=>t(-1),children:"Cancelar"})})]})}):o.length===0?e.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-slate-900 text-white p-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(Ia,{className:"w-16 h-16 mx-auto text-gray-400"}),e.jsx("h1",{className:"text-3xl font-bold",children:"No hay productos para comprar"}),e.jsxs("p",{className:"text-xl text-gray-300",children:["No tienes productos marcados para comprar en ",n]}),e.jsx($,{variant:"outline",className:"text-white border-white hover:bg-white/20",onClick:()=>t(-1),children:" Volver"})]})}):e.jsxs("div",{className:`min-h-screen flex flex-col ${N} text-white`,children:[e.jsxs("div",{className:"flex justify-between items-center p-4 bg-black/20 backdrop-blur-sm",children:[e.jsxs($,{variant:"ghost",className:"text-white hover:bg-white/20 text-lg font-semibold",onClick:()=>t(-1),children:[e.jsx(El,{className:"w-5 h-5 mr-2"}),"Volver"]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-white/80 mb-1",children:n}),e.jsx("div",{className:"text-3xl font-mono font-bold bg-black/30 px-4 py-2 rounded-lg backdrop-blur-sm border border-white/20",children:u})]}),e.jsx("div",{className:"w-20"})," "]}),e.jsx("div",{className:"flex gap-2 justify-center p-4 bg-black/10",children:d?e.jsxs(e.Fragment,{children:[h?e.jsxs($,{onClick:x,className:"bg-green-700 hover:bg-green-800 text-white px-6 py-2 font-semibold",children:[e.jsx(Sn,{className:"w-4 h-4 mr-2"}),"Reanudar"]}):e.jsxs($,{onClick:g,className:"bg-amber-600 hover:bg-amber-700 text-white px-6 py-2 font-semibold",children:[e.jsx(dx,{className:"w-4 h-4 mr-2"}),"Pausar"]}),e.jsxs($,{onClick:y,className:"bg-red-700 hover:bg-red-800 text-white px-6 py-2 font-semibold",children:[e.jsx(lx,{className:"w-4 h-4 mr-2"}),"Detener"]})]}):e.jsxs($,{onClick:p,className:"bg-green-700 hover:bg-green-800 text-white px-6 py-2 font-semibold",children:[e.jsx(Sn,{className:"w-4 h-4 mr-2"}),"Iniciar"]})}),e.jsx("div",{className:"flex-1 overflow-auto p-4 space-y-3",children:o.map(T=>e.jsx("div",{className:`bg-black/20 backdrop-blur-sm border border-white/20 rounded-lg p-4 transition-all duration-300 ${T.purchased?"opacity-60 bg-green-900/20":""}`,children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(Rs,{checked:T.purchased,onCheckedChange:()=>k(T.id),className:"scale-125"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:`text-lg font-medium ${T.purchased?"line-through text-white/70":""}`,children:T.name}),e.jsxs("div",{className:"text-sm text-white/80",children:["Cantidad: ",T.toBuy,T.price&&e.jsxs("span",{className:"ml-4",children:["Precio unitario: ",S.format(T.price)]})]})]}),T.price&&e.jsx("div",{className:`text-right ${T.purchased?"line-through text-white/70":""}`,children:e.jsx("div",{className:"text-lg font-bold",children:S.format(T.price*T.toBuy)})})]})},T.id))}),e.jsxs("div",{className:"bg-black/30 backdrop-blur-sm border-t border-white/20 p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm text-white/80",children:[e.jsx("span",{children:"Total estimado:"}),e.jsx("span",{children:S.format(w.totalEstimated)})]}),e.jsxs("div",{className:"flex justify-between text-sm text-green-400",children:[e.jsx("span",{children:"Ya comprado:"}),e.jsx("span",{children:S.format(w.totalPurchased)})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold border-t border-white/20 pt-3",children:[e.jsx("span",{children:"Falta por comprar:"}),e.jsx("span",{children:S.format(w.totalRemaining)})]}),e.jsxs(Wa,{children:[e.jsx(yi,{asChild:!0,children:e.jsxs($,{className:"w-full bg-blue-700 hover:bg-blue-800 text-white py-3 text-lg font-semibold mt-4",children:[e.jsx(Ia,{className:"w-5 h-5 mr-2"}),"Terminar Compras"]})}),e.jsxs(fa,{children:[e.jsxs(pa,{children:[e.jsx(ga,{children:"Terminar Compras"}),e.jsx(va,{children:"Ests seguro de que quieres terminar la sesin de compras? El cronmetro se detendr y volvers a la vista anterior."})]}),e.jsxs(xa,{children:[e.jsx(ba,{children:"Continuar comprando"}),e.jsx(ya,{onClick:D,className:"bg-blue-600 hover:bg-blue-700",children:"S, terminar"})]})]})]})]})]})}const q8=()=>{const{user:t}=Je(),[s,n]=f.useState([]),[r,a]=f.useState("idle"),[i,o]=f.useState(null),c=f.useCallback(async()=>{if(t){a("loading"),o(null);try{Me.logRead("goals","useGoals.loadGoals");const v=xn(Bt(xe,"goals"),Et("userId","==",t.uid)),N=(await gn(v)).docs.map(S=>{const E=S.data();return{id:S.id,userId:E.userId,title:E.title,description:E.description,status:E.status,startDate:E.startDate||null,dueDate:E.dueDate||null,tasks:E.tasks||[],entries:E.entries||[],positiveCount:E.positiveCount||0,negativeCount:E.negativeCount||0,numericGoal:E.numericGoal||void 0,numericEntries:E.numericEntries||[],createdAt:E.createdAt,updatedAt:E.updatedAt}});n(N),a("idle")}catch(v){o(v instanceof Error?v.message:"Error al cargar"),a("error")}}},[t]);f.useEffect(()=>{if(!t){n([]);return}c()},[t,c]);const u=async v=>{if(t){a("saving"),o(null);try{const w={...v,userId:t.uid,positiveCount:0,negativeCount:0,numericEntries:[],createdAt:ht(),updatedAt:ht()};Me.logWrite("goals","useGoals.addGoal");const N=await wl(Bt(xe,"goals"),w);n(S=>[...S,{...v,id:N.id,userId:t.uid,positiveCount:0,negativeCount:0,numericEntries:[],createdAt:"",updatedAt:""}]),a("idle")}catch(w){o(w instanceof Error?w.message:"Error al guardar"),a("error")}}},d=async(v,w)=>{if(!t)return;a("saving"),o(null);const N=s.find(E=>E.id===v);if(!N)return;const S={...N,...w};n(E=>E.map(k=>k.id===v?S:k));try{const E=ke(xe,"goals",v),k={...w,updatedAt:ht()};Me.logWrite("goals","useGoals.updateGoal",v),await ar(E,k),a("idle")}catch(E){n(k=>k.map(D=>D.id===v?N:D)),o(E instanceof Error?E.message:"Error al actualizar"),a("error")}};return{goals:s,status:r,error:i,addGoal:u,updateGoal:d,addTask:async(v,w)=>{const N=s.find(k=>k.id===v);if(!N||!t)return;const S={title:w,done:!1,createdAt:new Date().toISOString()},E=[...N.tasks,S];await d(v,{tasks:E})},toggleTask:async(v,w)=>{const N=s.find(k=>k.id===v);if(!N||!t)return;const S=[...N.tasks],E=S[w];E&&(S[w]={...E,done:!E.done,completedAt:E.done?null:new Date().toISOString()},await d(v,{tasks:S}))},addEntry:async(v,w)=>{const N=s.find(k=>k.id===v);if(!N||!t)return;const S={text:w.text,date:w.date||new Date().toISOString(),isMilestone:w.isMilestone},E=[...N.entries,S].sort((k,D)=>k.date.localeCompare(D.date));await d(v,{entries:E})},incrementPositiveCount:async v=>{const w=s.find(S=>S.id===v);if(!w||!t)return;const N=(w.positiveCount||0)+1;await d(v,{positiveCount:N})},incrementNegativeCount:async v=>{const w=s.find(S=>S.id===v);if(!w||!t)return;const N=(w.negativeCount||0)+1;await d(v,{negativeCount:N})},addNumericEntry:async(v,w)=>{const N=s.find(D=>D.id===v);if(!N||!t)return;const S={value:w.value,date:w.date||new Date().toISOString(),note:w.note},E=[...N.numericEntries||[],S].sort((D,T)=>D.date.localeCompare(T.date)),k=N.numericGoal?{...N.numericGoal,currentValue:w.value}:void 0;await d(v,{numericEntries:E,numericGoal:k})},loadGoals:c}},K8=({goals:t,onSelect:s,onIncrementPositive:n,onIncrementNegative:r,onEdit:a})=>{if(t.length===0)return e.jsx(Ce,{className:"p-6 text-center",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx(Ll,{className:"h-12 w-12 text-gray-400"}),e.jsxs("div",{children:[e.jsx(Gt,{className:"text-lg text-gray-600",children:"No hay objetivos"}),e.jsx(Gi,{className:"mt-2",children:"Comienza creando tu primer objetivo para alcanzar tus metas"})]})]})});const i=(d,h)=>{if(d===h)return 100;if(d>h){const g=h===0?0:(d-h)/d*100;return Math.max(0,Math.min(100,100-g))}else{const g=h===0?0:d/h*100;return Math.max(0,Math.min(100,g))}},o=d=>{switch(d){case"completed":return"default";case"active":return"secondary";case"abandoned":return"destructive";default:return"outline"}},c=d=>{switch(d){case"completed":return e.jsx(aa,{className:"h-3 w-3"});case"active":return e.jsx(en,{className:"h-3 w-3"});case"abandoned":return e.jsx(tw,{className:"h-3 w-3"});default:return null}},u=d=>{switch(d){case"completed":return"Completado";case"active":return"Activo";case"abandoned":return"Abandonado";default:return d}};return e.jsx(Ce,{children:e.jsxs(Ae,{className:"p-0",children:[e.jsxs("div",{className:"hidden md:grid grid-cols-12 gap-4 p-4 bg-gray-50 border-b text-sm font-medium text-gray-700",children:[e.jsx("div",{className:"col-span-4",children:"Objetivo"}),e.jsx("div",{className:"col-span-2 text-center",children:"Estado"}),e.jsx("div",{className:"col-span-2 text-center",children:"Progreso"}),e.jsx("div",{className:"col-span-2 text-center",children:"Fecha Lmite"}),e.jsx("div",{className:"col-span-2 text-center",children:"Acciones"})]}),e.jsx("div",{className:"divide-y divide-gray-100",children:t.map((d,h)=>{var w;const p=d.tasks.filter(N=>N.done).length,g=d.tasks.length,x=g>0?p/g*100:0,y=(w=d.numericGoal)==null?void 0:w.enabled,b=y?i(d.numericGoal.currentValue,d.numericGoal.targetValue):0,v=y?b:x;return e.jsxs("div",{className:`p-4 hover:bg-gray-50 transition-colors cursor-pointer ${h%2===0?"bg-white":"bg-gray-50/50"}`,onClick:()=>s(d.id),children:[e.jsxs("div",{className:"md:hidden space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-2 flex-1",children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:c(d.status)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 truncate",children:d.title}),d.description&&e.jsx("p",{className:"text-xs text-gray-500 mt-1 line-clamp-1",children:d.description})]})]}),e.jsx(Mt,{variant:o(d.status),className:"text-xs",children:e.jsx("span",{children:u(d.status)})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:y?"Meta":"Tareas"}),e.jsx("span",{className:"font-medium",children:y?`${Math.round(b)}%`:`${p}/${g}`})]}),e.jsx(lr,{value:v,className:"h-2"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500",children:[e.jsxs("span",{children:[g," tareas"]}),d.entries.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:""}),e.jsxs("span",{children:[d.entries.length," avances"]})]}),d.dueDate&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:""}),e.jsx("span",{children:new Date(d.dueDate).toLocaleDateString()})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx($,{variant:"ghost",size:"sm",onClick:N=>{N.stopPropagation(),n(d.id)},className:"h-6 w-6 p-0 text-green-600",children:e.jsx(up,{className:"h-3 w-3"})}),e.jsx("span",{className:"text-xs text-green-600",children:d.positiveCount||0}),e.jsx($,{variant:"ghost",size:"sm",onClick:N=>{N.stopPropagation(),r(d.id)},className:"h-6 w-6 p-0 text-red-600",children:e.jsx(em,{className:"h-3 w-3"})}),e.jsx("span",{className:"text-xs text-red-600",children:d.negativeCount||0}),e.jsx($,{variant:"ghost",size:"sm",onClick:N=>{N.stopPropagation(),a(d)},className:"h-6 w-6 p-0 text-blue-600 ml-1",children:e.jsx(jr,{className:"h-3 w-3"})})]})]})]}),e.jsxs("div",{className:"hidden md:grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:c(d.status)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 truncate",children:d.title}),d.description&&e.jsx("p",{className:"text-xs text-gray-500 mt-1 line-clamp-1",children:d.description}),e.jsx("div",{className:"flex items-center gap-3 mt-1",children:e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsxs("span",{children:[g," tareas"]}),d.entries.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:""}),e.jsxs("span",{children:[d.entries.length," avances"]})]})]})})]})]})}),e.jsx("div",{className:"col-span-2 flex justify-center",children:e.jsx(Mt,{variant:o(d.status),className:"text-xs",children:e.jsx("span",{children:u(d.status)})})}),e.jsx("div",{className:"col-span-2",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:y?"Meta":"Tareas"}),e.jsx("span",{className:"font-medium",children:y?`${Math.round(b)}%`:`${p}/${g}`})]}),e.jsx(lr,{value:v,className:"h-2"})]})}),e.jsx("div",{className:"col-span-2 flex justify-center items-center",children:d.dueDate?e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-600",children:[e.jsx(ns,{className:"h-3 w-3"}),e.jsx("span",{children:new Date(d.dueDate).toLocaleDateString()})]}):e.jsx("span",{className:"text-xs text-gray-400",children:"Sin fecha"})}),e.jsxs("div",{className:"col-span-2 flex justify-center items-center gap-1",children:[e.jsx($,{variant:"ghost",size:"sm",onClick:N=>{N.stopPropagation(),n(d.id)},className:"h-7 w-7 p-0 text-green-600 hover:text-green-700 hover:bg-green-50",title:"Voto positivo",children:e.jsx(up,{className:"h-3 w-3"})}),e.jsx("span",{className:"text-xs text-green-600 min-w-[1rem] text-center",children:d.positiveCount||0}),e.jsx($,{variant:"ghost",size:"sm",onClick:N=>{N.stopPropagation(),r(d.id)},className:"h-7 w-7 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",title:"Voto negativo",children:e.jsx(em,{className:"h-3 w-3"})}),e.jsx("span",{className:"text-xs text-red-600 min-w-[1rem] text-center",children:d.negativeCount||0}),e.jsx($,{variant:"ghost",size:"sm",onClick:N=>{N.stopPropagation(),a(d)},className:"h-7 w-7 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50 ml-1",title:"Editar objetivo",children:e.jsx(jr,{className:"h-3 w-3"})}),e.jsx($,{variant:"ghost",size:"sm",onClick:N=>{N.stopPropagation(),s(d.id)},className:"h-7 w-7 p-0 text-gray-600 hover:text-gray-700 hover:bg-gray-100",title:"Ver detalles",children:e.jsx(Sl,{className:"h-3 w-3"})})]})]})]},d.id)})})]})})};var J8="Separator",wj="horizontal",X8=["horizontal","vertical"],wE=f.forwardRef((t,s)=>{const{decorative:n,orientation:r=wj,...a}=t,i=Z8(r)?r:wj,c=n?{role:"none"}:{"aria-orientation":i==="vertical"?i:void 0,role:"separator"};return e.jsx(jt.div,{"data-orientation":i,...c,...a,ref:s})});wE.displayName=J8;function Z8(t){return X8.includes(t)}var NE=wE;const qc=f.forwardRef(({className:t,orientation:s="horizontal",decorative:n=!0,...r},a)=>e.jsx(NE,{ref:a,decorative:n,orientation:s,className:ce("shrink-0 bg-border",s==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",t),...r}));qc.displayName=NE.displayName;const Q8=({goal:t,isOpen:s,onClose:n})=>{var b;const[r,a]=f.useState(""),[i,o]=f.useState(""),[c,u]=f.useState(!1),[d,h]=f.useState(null),[p,g]=f.useState(0);f.useEffect(()=>{var v;if(s){const w=t.tasks.filter(R=>R.done).length,N=t.tasks.length,S=N>0?Math.round(w/N*100):0,E=(v=t.numericGoal)!=null&&v.enabled?`
Meta numrica: ${t.numericGoal.currentValue.toLocaleString()} / ${t.numericGoal.targetValue.toLocaleString()} ${t.numericGoal.unit} (${Math.round(t.numericGoal.currentValue/t.numericGoal.targetValue*100)}% completado)`:"",k=t.tasks.length>0?`
Tareas actuales:
${t.tasks.map((R,O)=>`${O+1}. ${R.title} ${R.done?"":""}`).join(`
`)}`:`
No hay tareas definidas an.`,D=t.entries.length>0?`
Avances registrados:
${t.entries.slice(-5).map((R,O)=>`${O+1}. ${R.text} ${R.isMilestone?"":""} (${new Date(R.date).toLocaleDateString()})`).join(`
`)}`:`
No hay avances registrados an.`,T=`OBJETIVO: ${t.title}
${t.description?`DESCRIPCIN: ${t.description}`:""}
ESTADO: ${t.status}
PROGRESO DE TAREAS: ${S}% (${w}/${N} completadas)${E}
FECHA LMITE: ${t.dueDate?new Date(t.dueDate).toLocaleDateString():"No definida"}
${k}
${D}

Por favor, sugiere tareas especficas y accionables que me ayuden a avanzar hacia este objetivo. Considera el progreso actual y las tareas existentes para evitar duplicados.`;o(T)}else o(""),a(""),h(null)},[s,t]),f.useEffect(()=>{g(zr(i))},[i]);const x=async()=>{var v,w,N;if(i){u(!0),h(null);try{const S={...Ic.goals,prompt:(v=Ic.goals.prompts)==null?void 0:v.taskSuggestions},E=await bN(i,S,{temperature:(w=Ic.goals.params)==null?void 0:w.temperature,topP:(N=Ic.goals.params)==null?void 0:N.top_p});a(E)}catch(S){h(S instanceof Error?S.message:"Error al generar sugerencias"),console.error("Error generating AI suggestions:",S)}finally{u(!1)}}},y=()=>{a(""),o(""),h(null),g(0),n()};return e.jsx(kt,{open:s,onOpenChange:v=>v?n():y(),children:e.jsxs(wt,{className:"w-[95vw] h-[90vh] max-w-none max-h-none overflow-hidden flex flex-col sm:w-[90vw] sm:h-[85vh]",children:[e.jsxs(At,{className:"flex-shrink-0",children:[e.jsxs(_t,{className:"flex items-center gap-2",children:[e.jsx(ii,{className:"h-5 w-5 text-purple-600"}),'Sugerencias de IA para "',t.title,'"']}),e.jsx(cn,{children:"Obtn ideas inteligentes para tareas que te ayuden a completar tu objetivo"})]}),e.jsx(Ce,{className:"flex-shrink-0",children:e.jsx(Ae,{className:"p-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-medium",children:"Resumen del objetivo"}),e.jsxs(Mt,{variant:"secondary",children:[t.tasks.filter(v=>v.done).length,"/",t.tasks.length," tareas"]})]}),t.description&&e.jsx("p",{className:"text-sm text-gray-600",children:t.description}),((b=t.numericGoal)==null?void 0:b.enabled)&&e.jsxs("p",{className:"text-sm text-blue-600",children:["Meta: ",t.numericGoal.currentValue.toLocaleString()," / ",t.numericGoal.targetValue.toLocaleString()," ",t.numericGoal.unit]})]})})}),e.jsxs("div",{className:"flex-1 flex flex-col sm:flex-row gap-4 min-h-0 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[e.jsxs("div",{className:"flex-1 flex flex-col mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2 flex-shrink-0",children:"Prompt para IA"}),e.jsx(It,{value:i,onChange:v=>o(v.target.value),className:"flex-1 resize-none min-h-0",placeholder:"Contexto del objetivo..."})]}),e.jsxs("div",{className:"flex-shrink-0 space-y-3",children:[e.jsxs("p",{className:"text-xs text-right",children:["Tokens: ",p," ",p>3500&&e.jsx("span",{className:"text-red-500",children:"Prompt demasiado largo!"})]}),e.jsxs($,{onClick:x,disabled:c||!1||p>3500,className:"w-full flex items-center justify-center gap-2 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700",children:[c&&e.jsx(fs,{className:"w-4 h-4 animate-spin"}),e.jsx(ii,{className:"h-4 w-4"}),c?"Generando sugerencias...":"Generar sugerencias con IA"]}),c&&e.jsx($a,{className:"mt-2"})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 sm:border-l sm:border-gray-200 sm:pl-4 border-t sm:border-t-0 border-gray-200 pt-4 sm:pt-0",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between flex-shrink-0",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(ii,{className:"h-4 w-4 text-purple-600"}),"Sugerencias de tareas"]}),r&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx($,{type:"button",size:"icon",variant:"ghost",onClick:()=>{navigator.clipboard.writeText(r),bt.success("Sugerencias copiadas")},children:e.jsx(da,{className:"w-4 h-4"})}),e.jsxs($,{variant:"outline",size:"sm",onClick:x,disabled:c,children:[e.jsx(ao,{className:"h-3 w-3 mr-1"}),"Regenerar"]})]})]}),e.jsx("div",{className:"flex-1 flex flex-col min-h-0",children:d?e.jsx(Ce,{className:"border-red-200 bg-red-50",children:e.jsxs(Ae,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[e.jsx("span",{className:"font-medium",children:"Error:"}),e.jsx("span",{className:"text-sm",children:d})]}),e.jsxs($,{variant:"outline",size:"sm",onClick:x,className:"mt-2",children:[e.jsx(ao,{className:"h-3 w-3 mr-1"}),"Reintentar"]})]})}):r?e.jsx(It,{readOnly:!0,value:r,className:"flex-1 resize-none bg-gray-50 border-gray-200 min-h-0 whitespace-pre-wrap"}):e.jsx("div",{className:"flex-1 flex items-center justify-center text-gray-500 text-sm",children:"Las sugerencias aparecern aqu una vez generadas"})})]})]}),e.jsx("div",{className:"flex justify-end space-x-2 pt-4 flex-shrink-0",children:e.jsx($,{variant:"outline",onClick:y,children:"Cerrar"})})]})})},eY=({goal:t,onAddTask:s,onToggleTask:n,onAddEntry:r,onIncrementPositive:a,onIncrementNegative:i,onAddNumericEntry:o,onEdit:c})=>{var G,ae;const u=(Y,X)=>{if(Y===X)return 100;if(Y>X){const H=X===0?0:(Y-X)/Y*100;return Math.max(0,Math.min(100,100-H))}else{const H=X===0?0:Y/X*100;return Math.max(0,Math.min(100,H))}},[d,h]=f.useState(""),[p,g]=f.useState(""),[x,y]=f.useState(new Date().toISOString().split("T")[0]),[b,v]=f.useState(!1),[w,N]=f.useState(""),[S,E]=f.useState(""),[k,D]=f.useState(new Date().toISOString().split("T")[0]),[T,R]=f.useState(!1),O=t.tasks.filter(Y=>Y.done).length,U=t.tasks.length,I=U>0?O/U*100:0,_=Y=>{switch(Y){case"completed":return"default";case"active":return"secondary";case"abandoned":return"destructive";default:return"outline"}},M=Y=>{switch(Y){case"completed":return e.jsx(ay,{className:"h-4 w-4"});case"active":return e.jsx(en,{className:"h-4 w-4"});case"abandoned":return e.jsx(Ll,{className:"h-4 w-4"});default:return null}},W=Y=>{switch(Y){case"completed":return"Completado";case"active":return"Activo";case"abandoned":return"Abandonado";default:return Y}},B=()=>{d.trim()&&(s(d.trim()),h(""))},P=()=>{p.trim()&&(r(p.trim(),x,b),g(""),y(new Date().toISOString().split("T")[0]),v(!1))},z=()=>{const Y=parseFloat(w);!isNaN(Y)&&Y>=0&&(o(Y,S.trim()||void 0,k),N(""),E(""),D(new Date().toISOString().split("T")[0]))};return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(Ce,{children:e.jsx(Kt,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(Gt,{className:"text-xl",children:t.title}),t.description&&e.jsx(Gi,{className:"mt-2",children:t.description})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Mt,{variant:_(t.status),children:e.jsxs("div",{className:"flex items-center gap-1",children:[M(t.status),e.jsx("span",{children:W(t.status)})]})}),e.jsx($,{variant:"outline",size:"sm",onClick:c,children:e.jsx(jr,{className:"h-4 w-4"})})]})]})})}),e.jsxs(Ce,{children:[e.jsx(Kt,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(Gt,{className:"flex items-center gap-2",children:[e.jsx(tm,{className:"h-5 w-5"}),"Tareas"]}),e.jsxs(Gi,{children:[O," de ",U," tareas completadas"]})]}),e.jsxs($,{variant:"outline",size:"sm",onClick:()=>R(!0),className:"bg-gradient-to-r from-purple-50 to-blue-50 hover:from-purple-100 hover:to-blue-100 border-purple-200",children:[e.jsx(ii,{className:"h-4 w-4 mr-2 text-purple-600"}),e.jsx("span",{className:"text-purple-700",children:"Ideas con IA"})]})]})}),e.jsxs(Ae,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(lr,{value:I,className:"h-2"}),e.jsxs("p",{className:"text-sm text-gray-600 text-center",children:[Math.round(I),"% completado"]})]}),e.jsx("div",{className:"space-y-2",children:t.tasks.length>0?t.tasks.map((Y,X)=>e.jsxs("div",{className:"flex items-center space-x-2 p-2 rounded hover:bg-gray-50",children:[e.jsx(Rs,{id:`task-${X}`,checked:Y.done,onCheckedChange:()=>n(X)}),e.jsx(ze,{htmlFor:`task-${X}`,className:`flex-1 cursor-pointer ${Y.done?"line-through text-gray-500":""}`,children:Y.title}),Y.done&&e.jsx(ay,{className:"h-4 w-4 text-green-500"})]},X)):e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No hay tareas an. Agrega la primera tarea para empezar."})}),e.jsx(qc,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ze,{htmlFor:"new-task",children:"Nueva tarea"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Fe,{id:"new-task",value:d,onChange:Y=>h(Y.target.value),placeholder:"Escribe una nueva tarea...",onKeyPress:Y=>Y.key==="Enter"&&B()}),e.jsx($,{onClick:B,disabled:!d.trim(),children:e.jsx(cs,{className:"h-4 w-4"})})]})]})]})]}),((G=t.numericGoal)==null?void 0:G.enabled)&&e.jsxs(Ce,{children:[e.jsxs(Kt,{children:[e.jsxs(Gt,{className:"flex items-center gap-2",children:[e.jsx(iy,{className:"h-5 w-5"}),"Meta Numrica"]}),e.jsxs(Gi,{children:["Progreso hacia ",t.numericGoal.targetValue.toLocaleString()," ",t.numericGoal.unit]})]}),e.jsxs(Ae,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Progreso"}),e.jsxs("span",{className:"font-medium",children:[t.numericGoal.currentValue.toLocaleString()," / ",t.numericGoal.targetValue.toLocaleString()," ",t.numericGoal.unit]})]}),e.jsx(lr,{value:u(t.numericGoal.currentValue,t.numericGoal.targetValue),className:"h-3"}),e.jsxs("p",{className:"text-sm text-gray-600 text-center",children:[Math.round(u(t.numericGoal.currentValue,t.numericGoal.targetValue)),"% completado"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(ze,{className:"text-sm font-medium",children:"Historial de valores"}),e.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:t.numericEntries&&t.numericEntries.length>0?t.numericEntries.sort((Y,X)=>new Date(X.date).getTime()-new Date(Y.date).getTime()).map((Y,X)=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg border bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-medium",children:[Y.value.toLocaleString()," ",t.numericGoal.unit]}),Y.note&&e.jsxs("span",{className:"text-xs text-gray-500",children:["- ",Y.note]})]}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(Y.date).toLocaleDateString()})]},X)):e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No hay registros numricos an"})})]}),e.jsx(qc,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(ze,{htmlFor:"numeric-value",children:"Actualizar valor"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(Fe,{id:"numeric-value",type:"number",min:"0",step:"0.01",value:w,onChange:Y=>N(Y.target.value),placeholder:`Valor en ${t.numericGoal.unit}`}),e.jsx(Fe,{type:"date",value:k,onChange:Y=>D(Y.target.value)})]}),e.jsx(Fe,{value:S,onChange:Y=>E(Y.target.value),placeholder:"Nota opcional..."}),e.jsxs($,{onClick:z,disabled:!w||isNaN(parseFloat(w)),className:"w-full",children:[e.jsx(cs,{className:"h-4 w-4 mr-2"}),"Registrar valor"]})]})]})]}),e.jsxs(Ce,{children:[e.jsxs(Kt,{children:[e.jsxs(Gt,{className:"flex items-center gap-2",children:[e.jsx(Nl,{className:"h-5 w-5"}),"Historial de Avances"]}),e.jsx(Gi,{children:"Registra tu progreso y logros importantes"})]}),e.jsxs(Ae,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-3",children:t.entries.length>0?t.entries.sort((Y,X)=>new Date(X.date).getTime()-new Date(Y.date).getTime()).map((Y,X)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg border bg-gray-50",children:[e.jsx("div",{className:"flex-shrink-0",children:Y.isMilestone?e.jsx(fw,{className:"h-4 w-4 text-yellow-500 mt-1"}):e.jsx(ns,{className:"h-4 w-4 text-gray-400 mt-1"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm",children:Y.text}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:new Date(Y.date).toLocaleDateString()})]}),Y.isMilestone&&e.jsx(Mt,{variant:"secondary",className:"text-xs",children:"Hito"})]},X)):e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No hay avances registrados. Comparte tu progreso aqu."})}),e.jsx(qc,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(ze,{htmlFor:"new-entry",children:"Nuevo avance"}),e.jsx(It,{id:"new-entry",value:p,onChange:Y=>g(Y.target.value),placeholder:"Describe tu progreso...",className:"min-h-[60px]"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ze,{htmlFor:"entry-date",className:"text-sm",children:"Fecha:"}),e.jsx(Fe,{id:"entry-date",type:"date",value:x,onChange:Y=>y(Y.target.value),className:"w-auto"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Rs,{id:"milestone",checked:b,onCheckedChange:Y=>v(Y)}),e.jsx(ze,{htmlFor:"milestone",className:"text-sm",children:"Marcar como hito"})]})]}),e.jsxs($,{onClick:P,disabled:!p.trim(),children:[e.jsx(cs,{className:"h-4 w-4 mr-2"}),"Registrar avance"]})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(Ce,{children:[e.jsx(Kt,{children:e.jsx(Gt,{className:"text-lg",children:"Estadsticas"})}),e.jsxs(Ae,{className:"space-y-4",children:[(t.startDate||t.dueDate)&&e.jsxs("div",{className:"space-y-2",children:[t.startDate&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ns,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:"Inicio:"}),e.jsx("span",{children:new Date(t.startDate).toLocaleDateString()})]}),t.dueDate&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ns,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:"Lmite:"}),e.jsx("span",{children:new Date(t.dueDate).toLocaleDateString()})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(tm,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:"Tareas:"}),e.jsxs("span",{children:[O,"/",U]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Nl,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:"Avances:"}),e.jsx("span",{children:t.entries.length})]}),((ae=t.numericGoal)==null?void 0:ae.enabled)&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(iy,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:"Progreso:"}),e.jsxs("span",{children:[Math.round(u(t.numericGoal.currentValue,t.numericGoal.targetValue)),"%"]})]})]})]})]}),e.jsxs(Ce,{children:[e.jsxs(Kt,{children:[e.jsx(Gt,{className:"text-lg",children:"Motivacin"}),e.jsx(Gi,{children:"Registra tu estado de nimo hacia este objetivo"})]}),e.jsx(Ae,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs($,{variant:"outline",className:"flex-1",onClick:a,children:[e.jsx(up,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:t.positiveCount||0})]}),e.jsxs($,{variant:"outline",className:"flex-1",onClick:i,children:[e.jsx(em,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:t.negativeCount||0})]})]})})]})]}),e.jsx(Q8,{goal:t,isOpen:T,onClose:()=>R(!1)})]})},Nj=({goal:t,isOpen:s,onClose:n,onSave:r})=>{var w,N,S,E,k;const[a,i]=f.useState({title:(t==null?void 0:t.title)||"",description:(t==null?void 0:t.description)||"",status:(t==null?void 0:t.status)||"active",startDate:(t==null?void 0:t.startDate)||"",dueDate:(t==null?void 0:t.dueDate)||""}),[o,c]=f.useState({enabled:((w=t==null?void 0:t.numericGoal)==null?void 0:w.enabled)||!1,targetValue:((N=t==null?void 0:t.numericGoal)==null?void 0:N.targetValue)||0,currentValue:((S=t==null?void 0:t.numericGoal)==null?void 0:S.currentValue)||0,unit:((E=t==null?void 0:t.numericGoal)==null?void 0:E.unit)||"",unitType:((k=t==null?void 0:t.numericGoal)==null?void 0:k.unitType)||"quantity"}),[u,d]=f.useState(!1),[h,p]=f.useState({});f.useEffect(()=>{var D,T,R,O,U;i({title:(t==null?void 0:t.title)||"",description:(t==null?void 0:t.description)||"",status:(t==null?void 0:t.status)||"active",startDate:(t==null?void 0:t.startDate)||"",dueDate:(t==null?void 0:t.dueDate)||""}),c({enabled:((D=t==null?void 0:t.numericGoal)==null?void 0:D.enabled)||!1,targetValue:((T=t==null?void 0:t.numericGoal)==null?void 0:T.targetValue)||0,currentValue:((R=t==null?void 0:t.numericGoal)==null?void 0:R.currentValue)||0,unit:((O=t==null?void 0:t.numericGoal)==null?void 0:O.unit)||"",unitType:((U=t==null?void 0:t.numericGoal)==null?void 0:U.unitType)||"quantity"}),p({})},[t]);const g=()=>{const D={};if(a.title.trim()||(D.title="El ttulo es requerido"),a.startDate&&a.dueDate){const T=new Date(a.startDate),R=new Date(a.dueDate);T>R&&(D.dueDate="La fecha lmite debe ser posterior a la fecha de inicio")}return o.enabled&&(o.targetValue<=0&&(D.targetValue="El valor objetivo debe ser mayor a 0"),o.unit.trim()||(D.unit="La unidad es requerida para metas numricas"),o.currentValue<0&&(D.currentValue="El valor actual no puede ser negativo")),p(D),Object.keys(D).length===0},x=async D=>{if(D.preventDefault(),!!g()){d(!0);try{await r({...a,description:a.description.trim()||void 0,startDate:a.startDate||null,dueDate:a.dueDate||null,numericGoal:o.enabled?o:void 0,numericEntries:(t==null?void 0:t.numericEntries)||[]}),n()}catch(T){console.error("Error saving goal:",T)}finally{d(!1)}}},y=()=>{const D=a.title.trim().length>0,T=!o.enabled||o.targetValue>0&&o.unit.trim().length>0;return D&&T&&Object.keys(h).length===0},b=()=>{var D,T,R,O,U;i({title:(t==null?void 0:t.title)||"",description:(t==null?void 0:t.description)||"",status:(t==null?void 0:t.status)||"active",startDate:(t==null?void 0:t.startDate)||"",dueDate:(t==null?void 0:t.dueDate)||""}),c({enabled:((D=t==null?void 0:t.numericGoal)==null?void 0:D.enabled)||!1,targetValue:((T=t==null?void 0:t.numericGoal)==null?void 0:T.targetValue)||0,currentValue:((R=t==null?void 0:t.numericGoal)==null?void 0:R.currentValue)||0,unit:((O=t==null?void 0:t.numericGoal)==null?void 0:O.unit)||"",unitType:((U=t==null?void 0:t.numericGoal)==null?void 0:U.unitType)||"quantity"}),p({}),n()},v=D=>{switch(D){case"currency":return"Ej: COP, USD, EUR";case"weight":return"Ej: kg, lb, g";case"quantity":return"Ej: unidades, piezas";case"percentage":return"%";case"custom":return"Ej: horas, das";default:return"Unidad"}};return e.jsx(kt,{open:s,onOpenChange:b,children:e.jsxs(wt,{className:"sm:max-w-[900px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(At,{children:[e.jsxs(_t,{className:"flex items-center gap-2",children:[e.jsx(Ll,{className:"h-5 w-5"}),t?"Editar objetivo":"Crear nuevo objetivo"]}),e.jsx(cn,{children:t?"Modifica los detalles de tu objetivo":"Define un nuevo objetivo para alcanzar tus metas"})]}),e.jsxs("form",{onSubmit:x,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ze,{htmlFor:"title",children:"Ttulo *"}),e.jsx(Fe,{id:"title",value:a.title,onChange:D=>{i({...a,title:D.target.value}),h.title&&D.target.value.trim()&&p({...h,title:""})},placeholder:"Ej. Aprender React avanzado",className:h.title?"border-destructive":"",required:!0}),h.title&&e.jsx("p",{className:"text-sm text-destructive",children:h.title})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ze,{htmlFor:"description",children:"Descripcin"}),e.jsx(It,{id:"description",value:a.description,onChange:D=>i({...a,description:D.target.value}),placeholder:"Describe tu objetivo con ms detalle...",className:"min-h-[80px]"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ze,{htmlFor:"status",children:"Estado"}),e.jsxs(Tt,{value:a.status,onValueChange:D=>i({...a,status:D}),children:[e.jsx(vt,{children:e.jsx(Dt,{})}),e.jsxs(yt,{children:[e.jsx(Pe,{value:"active",children:"Activo"}),e.jsx(Pe,{value:"completed",children:"Completado"}),e.jsx(Pe,{value:"abandoned",children:"Abandonado"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ze,{htmlFor:"startDate",children:"Fecha de inicio"}),e.jsx(Fe,{id:"startDate",type:"date",value:a.startDate,onChange:D=>i({...a,startDate:D.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ze,{htmlFor:"dueDate",children:"Fecha lmite"}),e.jsx(Fe,{id:"dueDate",type:"date",value:a.dueDate,onChange:D=>i({...a,dueDate:D.target.value}),className:h.dueDate?"border-destructive":""}),h.dueDate&&e.jsx("p",{className:"text-sm text-destructive",children:h.dueDate})]})]}),e.jsx(qc,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Rs,{id:"numericGoal",checked:o.enabled,onCheckedChange:D=>c({...o,enabled:D})}),e.jsxs(ze,{htmlFor:"numericGoal",className:"flex items-center gap-2",children:[e.jsx(Nl,{className:"h-4 w-4"}),"Agregar meta numrica"]})]}),o.enabled&&e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg bg-gray-50",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ze,{htmlFor:"targetValue",children:"Valor objetivo *"}),e.jsx(Fe,{id:"targetValue",type:"number",min:"0",step:"0.01",value:o.targetValue,onChange:D=>{const T=parseFloat(D.target.value)||0;c({...o,targetValue:T}),h.targetValue&&T>0&&p({...h,targetValue:""})},placeholder:"Ej: 2000000",className:h.targetValue?"border-destructive":"",required:o.enabled}),h.targetValue&&e.jsx("p",{className:"text-sm text-destructive",children:h.targetValue})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ze,{htmlFor:"currentValue",children:"Valor actual"}),e.jsx(Fe,{id:"currentValue",type:"number",min:"0",step:"0.01",value:o.currentValue,onChange:D=>c({...o,currentValue:parseFloat(D.target.value)||0}),placeholder:"Ej: 500000",className:h.currentValue?"border-destructive":""}),h.currentValue&&e.jsx("p",{className:"text-sm text-destructive",children:h.currentValue})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ze,{htmlFor:"unitType",children:"Tipo de unidad"}),e.jsxs(Tt,{value:o.unitType,onValueChange:D=>c({...o,unitType:D,unit:""}),children:[e.jsx(vt,{children:e.jsx(Dt,{})}),e.jsxs(yt,{children:[e.jsx(Pe,{value:"currency",children:"Moneda"}),e.jsx(Pe,{value:"weight",children:"Peso"}),e.jsx(Pe,{value:"quantity",children:"Cantidad"}),e.jsx(Pe,{value:"percentage",children:"Porcentaje"}),e.jsx(Pe,{value:"custom",children:"Personalizada"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ze,{htmlFor:"unit",children:"Unidad *"}),e.jsx(Fe,{id:"unit",value:o.unit,onChange:D=>{c({...o,unit:D.target.value}),h.unit&&D.target.value.trim()&&p({...h,unit:""})},placeholder:v(o.unitType),className:h.unit?"border-destructive":"",required:o.enabled}),h.unit&&e.jsx("p",{className:"text-sm text-destructive",children:h.unit})]})]}),e.jsxs("div",{className:"text-sm text-gray-600 bg-white p-3 rounded-md",children:[e.jsx("p",{className:"font-medium mb-1",children:"Ejemplos:"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-1 text-xs",children:[e.jsx("span",{children:" Comprar colchn: 2,000,000 COP"}),e.jsx("span",{children:" Bajar peso: 3 kg"}),e.jsx("span",{children:" Ahorrar dinero: 500,000 COP"}),e.jsx("span",{children:" Completar curso: 100 %"})]})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx($,{type:"button",variant:"outline",onClick:b,disabled:u,children:"Cancelar"}),e.jsx($,{type:"submit",disabled:u||!y(),children:u?"Guardando...":t?"Actualizar":"Crear"})]})]})]})})},tY=()=>{const{goalId:t}=px(),s=Qt(),{goals:n,status:r,error:a,addGoal:i,updateGoal:o,addTask:c,toggleTask:u,addEntry:d,incrementPositiveCount:h,incrementNegativeCount:p,addNumericEntry:g}=q8(),[x,y]=f.useState(t||null),[b,v]=f.useState(!1),[w,N]=f.useState(void 0),[S,E]=f.useState(""),[k,D]=f.useState("all"),T=n.find(B=>B.id===x)||null;f.useEffect(()=>{t&&t!==x&&y(t)},[t,x]),f.useEffect(()=>{t&&n.length>0&&!n.find(B=>B.id===t)&&s("/goals")},[t,n,s]);const R=n.filter(B=>{var G;const P=B.title.toLowerCase().includes(S.toLowerCase())||((G=B.description)==null?void 0:G.toLowerCase().includes(S.toLowerCase())),z=k==="all"||B.status===k;return P&&z}),O=async B=>{await i({title:B.title||"",description:B.description,status:B.status||"active",startDate:B.startDate,dueDate:B.dueDate,tasks:[],entries:[]})},U=async B=>{w&&await o(w.id,B)},I=B=>{N(B),v(!0)},_=()=>{v(!1),N(void 0)},M=()=>{y(null),s("/goals")},W=B=>{y(B),s(`/goals/${B}`)};return T?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs($,{variant:"outline",size:"sm",onClick:M,className:"flex items-center gap-2",children:[e.jsx(El,{className:"h-4 w-4"}),"Volver a objetivos"]})}),e.jsx(eY,{goal:T,onAddTask:B=>c(T.id,B),onToggleTask:B=>u(T.id,B),onAddEntry:(B,P,z)=>d(T.id,{text:B,date:P,isMilestone:z}),onIncrementPositive:()=>h(T.id),onIncrementNegative:()=>p(T.id),onAddNumericEntry:(B,P,z)=>g(T.id,{value:B,note:P,date:z}),onEdit:()=>I(T)}),e.jsx(Nj,{goal:w,isOpen:b,onClose:_,onSave:w?U:O})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ce,{children:e.jsx(Kt,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsxs(Gt,{className:"flex items-center gap-2",children:[e.jsx(Ll,{className:"h-5 w-5"}),"Objetivos"]})}),e.jsxs($,{onClick:()=>v(!0),children:[e.jsx(cs,{className:"h-4 w-4 mr-2"}),"Nuevo objetivo"]})]})})}),e.jsx(Ce,{children:e.jsx(Ae,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx($l,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(Fe,{placeholder:"Buscar objetivos...",value:S,onChange:B=>E(B.target.value),className:"pl-9"})]})}),e.jsxs("div",{className:"flex items-center gap-2 sm:w-48",children:[e.jsx(xd,{className:"h-4 w-4 text-gray-400"}),e.jsxs(Tt,{value:k,onValueChange:D,children:[e.jsx(vt,{children:e.jsx(Dt,{})}),e.jsxs(yt,{children:[e.jsx(Pe,{value:"all",children:"Todos"}),e.jsx(Pe,{value:"active",children:"Activos"}),e.jsx(Pe,{value:"completed",children:"Completados"}),e.jsx(Pe,{value:"abandoned",children:"Abandonados"})]})]})]})]})})}),e.jsxs("div",{children:[r==="loading"&&e.jsx(Ce,{className:"p-6 text-center",children:e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Cargando objetivos..."})]})}),a&&e.jsx(Ce,{className:"p-6 text-center",children:e.jsxs("div",{className:"text-red-600",children:[e.jsx("p",{className:"font-medium",children:"Error al cargar objetivos"}),e.jsx("p",{className:"text-sm mt-1",children:a})]})}),r!=="loading"&&!a&&e.jsx(K8,{goals:R,onSelect:W,onIncrementPositive:h,onIncrementNegative:p,onEdit:I})]}),S||k!=="all"?e.jsx(Ce,{children:e.jsx(Ae,{className:"p-4",children:e.jsx("p",{className:"text-sm text-gray-600",children:R.length===0?"No se encontraron objetivos que coincidan con los filtros":`Mostrando ${R.length} de ${n.length} objetivos`})})}):null]}),e.jsx(Nj,{goal:w,isOpen:b,onClose:_,onSave:w?U:O})]})},Sj=()=>e.jsx(ln,{children:e.jsx(tY,{})});function sY(){return e.jsxs(PP,{children:[e.jsxs(ms,{path:"/",element:e.jsx(S4,{}),children:[e.jsx(ms,{index:!0,element:e.jsx(aL,{})}),e.jsx(ms,{path:"habit",element:e.jsx(kU,{})}),e.jsx(ms,{path:"task",element:e.jsx(Ef,{to:"/task/list",replace:!0})}),e.jsx(ms,{path:"task/list",element:e.jsx(Kb,{})}),e.jsx(ms,{path:"task/kanban",element:e.jsx(Kb,{})}),e.jsx(ms,{path:"task/calendar",element:e.jsx(gU,{})}),e.jsx(ms,{path:"tasks/calendar",element:e.jsx(Ef,{to:"/task/calendar",replace:!0})}),e.jsx(ms,{path:"kanban",element:e.jsx(Ef,{to:"/task/kanban",replace:!0})}),e.jsx(ms,{path:"journal",element:e.jsx(xU,{})}),e.jsx(ms,{path:"mood",element:e.jsx(Qz,{})}),e.jsx(ms,{path:"water",element:e.jsx(Z$,{})}),e.jsx(ms,{path:"pomodoro",element:e.jsx(Az,{})}),e.jsx(ms,{path:"exercise",element:e.jsx(DW,{})}),e.jsx(ms,{path:"negative",element:e.jsx(GW,{})}),e.jsx(ms,{path:"stats",element:e.jsx(QW,{})}),e.jsx(ms,{path:"meal",element:e.jsx(ZU,{})}),e.jsx(ms,{path:"shopping-list",element:e.jsx(pW,{})}),e.jsx(ms,{path:"recipes",element:e.jsx(yW,{})}),e.jsx(ms,{path:"prepared-meals",element:e.jsx(wW,{})}),e.jsx(ms,{path:"settings",element:e.jsx(P8,{})}),e.jsx(ms,{path:"goals",element:e.jsx(Sj,{})}),e.jsx(ms,{path:"goals/:goalId",element:e.jsx(Sj,{})})]}),e.jsx(ms,{path:"task/:taskCode/run",element:e.jsx(F8,{})}),e.jsx(ms,{path:"habit/:habitId/run",element:e.jsx(U8,{})}),e.jsx(ms,{path:"shopping/run",element:e.jsx(G8,{})})]})}class hl{static startDiagnostic(){var s,n,r,a,i,o;typeof window>"u"||(console.log(" Iniciando diagnstico de escrituras Firestore..."),(n=(s=window.firebase)==null?void 0:s.firestore)!=null&&n.setDoc&&!this.originalSetDoc&&(this.originalSetDoc=window.firebase.firestore.setDoc,window.firebase.firestore.setDoc=this.wrapWriteFunction("setDoc",this.originalSetDoc)),(a=(r=window.firebase)==null?void 0:r.firestore)!=null&&a.updateDoc&&!this.originalUpdateDoc&&(this.originalUpdateDoc=window.firebase.firestore.updateDoc,window.firebase.firestore.updateDoc=this.wrapWriteFunction("updateDoc",this.originalUpdateDoc)),(o=(i=window.firebase)==null?void 0:i.firestore)!=null&&o.addDoc&&!this.originalAddDoc&&(this.originalAddDoc=window.firebase.firestore.addDoc,window.firebase.firestore.addDoc=this.wrapWriteFunction("addDoc",this.originalAddDoc)),setInterval(()=>{this.reportCurrentStats()},3e4),console.log(" Diagnstico iniciado. Usa FirestoreWriteDiagnostic.getReport() para ver estadsticas."))}static wrapWriteFunction(s,n){return(...r)=>{var d;this.writeCount++;const a=r[0],i=((d=a==null?void 0:a.path)==null?void 0:d.split("/")[0])||"unknown",o=a==null?void 0:a.id,c=new Error().stack||"";this.writeLog.push({timestamp:new Date,collection:i,docId:o,operation:s,stack:this.extractRelevantStack(c)}),this.writeLog.length>100&&(this.writeLog=this.writeLog.slice(-100));const u=this.writeLog.filter(h=>h.timestamp>new Date(Date.now()-6e4));return u.length>20&&(console.warn(` ALERTA: ${u.length} escrituras en el ltimo minuto!`),this.analyzeRecentWrites(u)),n.apply(this,r)}}static extractRelevantStack(s){return s.split(`
`).find(a=>!a.includes("wrapWriteFunction")&&!a.includes("firebase")&&a.includes("at "))||"unknown"}static analyzeRecentWrites(s){const n=this.groupBy(s,"collection");console.warn(" Escrituras por coleccin (ltimo minuto):"),Object.entries(n).forEach(([i,o])=>{console.warn(`  ${i}: ${o.length} escrituras`)});const r=this.groupBy(s,"stack");console.warn(" Fuentes ms activas:"),Object.entries(r).sort(([,i],[,o])=>o.length-i.length).slice(0,5).forEach(([i,o])=>{console.warn(`  ${o.length}x: ${i.substring(0,100)}...`)});const a=new Map;s.forEach(i=>{const o=`${i.collection}/${i.docId}`;a.has(o)||a.set(o,[]),a.get(o).push(i)}),a.forEach((i,o)=>{i.length>5&&console.warn(` ${i.length} escrituras al documento ${o}`)})}static groupBy(s,n){return s.reduce((r,a)=>{const i=String(a[n]);return r[i]=r[i]||[],r[i].push(a),r},{})}static reportCurrentStats(){const s=new Date,n=this.writeLog.filter(a=>a.timestamp>new Date(s.getTime()-5*60*1e3)),r=this.writeLog.filter(a=>a.timestamp>new Date(s.getTime()-60*1e3));n.length>0&&(console.log(" Estadsticas de escrituras:"),console.log(`  ltimos 5 min: ${n.length} escrituras (${(n.length/5).toFixed(1)}/min)`),console.log(`  ltimo minuto: ${r.length} escrituras`),console.log(`  Total desde inicio: ${this.writeCount} escrituras`))}static getReport(){const s=new Date,n=this.writeLog.filter(i=>i.timestamp>new Date(s.getTime()-5*60*1e3)),r=this.writeLog.filter(i=>i.timestamp>new Date(s.getTime()-60*1e3)),a={totalWrites:this.writeCount,last5Minutes:n.length,lastMinute:r.length,ratePerMinute:n.length/5,byCollection:this.groupBy(n,"collection"),byOperation:this.groupBy(n,"operation"),topSources:Object.entries(this.groupBy(n,"stack")).sort(([,i],[,o])=>o.length-i.length).slice(0,10).map(([i,o])=>({source:i.substring(0,100),count:o.length}))};return console.group(" Reporte de Escrituras Firestore"),console.log("Total de escrituras desde inicio:",a.totalWrites),console.log("ltimos 5 minutos:",a.last5Minutes),console.log("ltimo minuto:",a.lastMinute),console.log("Tasa actual:",a.ratePerMinute.toFixed(1),"escrituras/minuto"),a.ratePerMinute>10&&console.warn(" Tasa de escrituras muy alta (>10/min)"),console.log("Por coleccin:",a.byCollection),console.log("Por operacin:",a.byOperation),console.log("Fuentes ms activas:",a.topSources),console.groupEnd(),a}static stopDiagnostic(){var s,n,r;this.originalSetDoc&&((s=window.firebase)!=null&&s.firestore)&&(window.firebase.firestore.setDoc=this.originalSetDoc),this.originalUpdateDoc&&((n=window.firebase)!=null&&n.firestore)&&(window.firebase.firestore.updateDoc=this.originalUpdateDoc),this.originalAddDoc&&((r=window.firebase)!=null&&r.firestore)&&(window.firebase.firestore.addDoc=this.originalAddDoc),console.log(" Diagnstico de escrituras detenido")}static clearLog(){this.writeLog=[],this.writeCount=0,console.log(" Log de escrituras limpiado")}}he(hl,"originalSetDoc"),he(hl,"originalUpdateDoc"),he(hl,"originalAddDoc"),he(hl,"writeCount",0),he(hl,"writeLog",[]);typeof window<"u"&&(window.FirestoreWriteDiagnostic=hl);"serviceWorker"in navigator&&KP({onNeedRefresh(){window.dispatchEvent(new CustomEvent("sw-update-available"))},onOfflineReady(){console.log("La aplicacin est lista para usar sin conexin"),window.dispatchEvent(new CustomEvent("sw-offline-ready"))},onRegisterError(t){console.warn("Error al registrar el service worker:",t)},immediate:!0});mp.createRoot(document.getElementById("root")).render(e.jsx(ee.StrictMode,{children:e.jsx(HP,{basename:"/life-tracker",children:e.jsx(E8,{children:e.jsx(sY,{})})})}));export{$ as B,Ce as C,or as D,lr as P,Kt as a,Gt as b,Ae as c,qW as d,ce as e,Lr as g,bd as u};
