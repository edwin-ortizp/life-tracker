const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["chunks/DailySummary-rbKYXQn_.js","chunks/ui-vendor-DsUuK6wp.js","chunks/react-vendor-Cob1R1W1.js","chunks/firebase-DYY3nxBM.js","chunks/MoodChart-Dz0iyBHC.js","chunks/chart-vendor-CZi6XvGn.js","chunks/utils-vendor-BIvfKBFf.js","chunks/skeleton-D0-qqJbD.js","chunks/WeeklySummary-CyIkJVNt.js","chunks/AiInsightCard-BYL9F76a.js","chunks/DailyDashboard-Cj8t_bBz.js","chunks/WeeklyDashboard-DZGnH1G0.js"])))=>i.map(i=>d[i]);
var jA=Object.defineProperty;var wA=(t,s,n)=>s in t?jA(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n;var ht=(t,s,n)=>wA(t,typeof s!="symbol"?s+"":s,n);import{j as e,S as NA,P as At,c as Br,a as Hr,b as Lo,D as _f,C as Pf,d as Fy,u as ws,e as $o,f as $r,R as Mf,A as xu,g as nt,h as If,O as zo,i as gu,k as Fo,l as gc,T as Bo,m as Ho,n as vu,o as yu,p as SA,q as zr,r as By,s as hi,t as Hy,v as Wy,w as Uy,x as Vy,F as Gy,y as bu,z as ju,B as qy,I as Yy,E as CA,H as EA,G as Ky,J as Jy,K as TA,L as DA,M as Xy,W as kA,N as Zy,Q as Qy,U as AA,V as eb,X as tb,Y as sb,Z as nb,_ as ab,$ as rb,a0 as ib,a1 as RA,a2 as _A,a3 as PA,a4 as MA,a5 as IA,a6 as OA}from"../chunks/ui-vendor-DsUuK6wp.js";import{a as xi,r as f,R as LA,c as Z,b as $A,d as wl}from"../chunks/react-vendor-Cob1R1W1.js";import{c as zA,a as Wo,b as ch,d as Nl,e as Sl,f as FA,g as at,s as cs,h as es,i as $a,j as sc,k as Mr,l as P0,m as Bh,n as ea,o as ts,p as M0,q as Hl,r as BA,t as nc,u as Of,v as Ds,w as sn,x as Vl,y as Ir,z as HA,A as WA,B as Gd,C as UA,D as VA,E as GA,F as qA,G as dh,H as I0,I as ob,J as ha,K as Lf,L as ar,M as YA,N as KA,O as lb,P as JA,Q as XA,R as Gi}from"../chunks/utils-vendor-BIvfKBFf.js";import{i as ZA,g as QA,c as eR,e as tR,d as sR,f as nR,h as cb,o as aR,s as rR,G as iR,j as oR,w as lR,k as Te,l as st,m as dt,n as qt,p as $t,q as ao,r as nn,t as wt,u as an,T as tr,v as Ao,x as Hn,y as cR,z as db,A as dR}from"../chunks/firebase-DYY3nxBM.js";import{L as uR,D as $f,a as ub,S as zf,b as wu,B as vc,T as Ji,U as mb,C as mR,K as hb,F as fb,c as Ff,d as qd,e as rr,X as Ws,f as _n,g as pb,h as za,i as Yd,j as Ro,k as ta,W as Hh,l as yc,m as hR,V as fR,n as pR,o as $d,p as Wh,q as Bf,r as ns,P as as,s as ls,t as Hf,u as yn,v as sa,w as Uh,x as Vh,y as xb,z as gb,A as vb,E as xR,G as Js,H as Dd,I as ac,R as _o,J as Xi,M as ro,N as gn,O as qi,Q as sr,Y as Ma,Z as ma,_ as vn,$ as gi,a0 as bc,a1 as jc,a2 as wc,a3 as Ni,a4 as Nu,a5 as rc,a6 as Su,a7 as Zi,a8 as gR,a9 as Wf,aa as yb,ab as Uo,ac as Qi,ad as $s,ae as vR,af as bb,ag as yR,ah as ic,ai as Uf,aj as bR,ak as jR,al as Ua,am as wR,an as NR,ao as Vo,ap as Cu,aq as jb,ar as SR,as as O0,at as _r,au as Nc,av as CR,aw as ER,ax as wb,ay as Po,az as Nb,aA as Gh,aB as Sb,aC as Cb,aD as oc,aE as TR,aF as Pr,aG as DR,aH as kR,aI as ir,aJ as Go,aK as Si,aL as Eb,aM as L0,aN as AR,aO as RR,aP as Tb,aQ as _R,aR as PR,aS as Vf,aT as qh,aU as $0,aV as z0}from"../chunks/chart-vendor-CZi6XvGn.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();var Yh={},F0=xi;Yh.createRoot=F0.createRoot,Yh.hydrateRoot=F0.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function lc(){return lc=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var n=arguments[s];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t},lc.apply(this,arguments)}var vi;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(vi||(vi={}));const B0="popstate";function MR(t){t===void 0&&(t={});function s(a,r){let{pathname:o,search:l,hash:c}=a.location;return Kh("",{pathname:o,search:l,hash:c},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function n(a,r){return typeof r=="string"?r:Kd(r)}return OR(s,n,null,t)}function Os(t,s){if(t===!1||t===null||typeof t>"u")throw new Error(s)}function Db(t,s){if(!t){typeof console<"u"&&console.warn(s);try{throw new Error(s)}catch{}}}function IR(){return Math.random().toString(36).substr(2,8)}function H0(t,s){return{usr:t.state,key:t.key,idx:s}}function Kh(t,s,n,a){return n===void 0&&(n=null),lc({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof s=="string"?qo(s):s,{state:n,key:s&&s.key||a||IR()})}function Kd(t){let{pathname:s="/",search:n="",hash:a=""}=t;return n&&n!=="?"&&(s+=n.charAt(0)==="?"?n:"?"+n),a&&a!=="#"&&(s+=a.charAt(0)==="#"?a:"#"+a),s}function qo(t){let s={};if(t){let n=t.indexOf("#");n>=0&&(s.hash=t.substr(n),t=t.substr(0,n));let a=t.indexOf("?");a>=0&&(s.search=t.substr(a),t=t.substr(0,a)),t&&(s.pathname=t)}return s}function OR(t,s,n,a){a===void 0&&(a={});let{window:r=document.defaultView,v5Compat:o=!1}=a,l=r.history,c=vi.Pop,m=null,u=h();u==null&&(u=0,l.replaceState(lc({},l.state,{idx:u}),""));function h(){return(l.state||{idx:null}).idx}function p(){c=vi.Pop;let v=h(),w=v==null?null:v-u;u=v,m&&m({action:c,location:j.location,delta:w})}function g(v,w){c=vi.Push;let N=Kh(j.location,v,w);u=h()+1;let S=H0(N,u),E=j.createHref(N);try{l.pushState(S,"",E)}catch(T){if(T instanceof DOMException&&T.name==="DataCloneError")throw T;r.location.assign(E)}o&&m&&m({action:c,location:j.location,delta:1})}function x(v,w){c=vi.Replace;let N=Kh(j.location,v,w);u=h();let S=H0(N,u),E=j.createHref(N);l.replaceState(S,"",E),o&&m&&m({action:c,location:j.location,delta:0})}function b(v){let w=r.location.origin!=="null"?r.location.origin:r.location.href,N=typeof v=="string"?v:Kd(v);return N=N.replace(/ $/,"%20"),Os(w,"No window.location.(origin|href) available to create URL for href: "+N),new URL(N,w)}let j={get action(){return c},get location(){return t(r,l)},listen(v){if(m)throw new Error("A history only accepts one active listener");return r.addEventListener(B0,p),m=v,()=>{r.removeEventListener(B0,p),m=null}},createHref(v){return s(r,v)},createURL:b,encodeLocation(v){let w=b(v);return{pathname:w.pathname,search:w.search,hash:w.hash}},push:g,replace:x,go(v){return l.go(v)}};return j}var W0;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(W0||(W0={}));function LR(t,s,n){return n===void 0&&(n="/"),$R(t,s,n)}function $R(t,s,n,a){let r=typeof s=="string"?qo(s):s,o=Gf(r.pathname||"/",n);if(o==null)return null;let l=kb(t);zR(l);let c=null;for(let m=0;c==null&&m<l.length;++m){let u=XR(o);c=YR(l[m],u)}return c}function kb(t,s,n,a){s===void 0&&(s=[]),n===void 0&&(n=[]),a===void 0&&(a="");let r=(o,l,c)=>{let m={relativePath:c===void 0?o.path||"":c,caseSensitive:o.caseSensitive===!0,childrenIndex:l,route:o};m.relativePath.startsWith("/")&&(Os(m.relativePath.startsWith(a),'Absolute route path "'+m.relativePath+'" nested under path '+('"'+a+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),m.relativePath=m.relativePath.slice(a.length));let u=bi([a,m.relativePath]),h=n.concat(m);o.children&&o.children.length>0&&(Os(o.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+u+'".')),kb(o.children,s,h,u)),!(o.path==null&&!o.index)&&s.push({path:u,score:GR(u,o.index),routesMeta:h})};return t.forEach((o,l)=>{var c;if(o.path===""||!((c=o.path)!=null&&c.includes("?")))r(o,l);else for(let m of Ab(o.path))r(o,l,m)}),s}function Ab(t){let s=t.split("/");if(s.length===0)return[];let[n,...a]=s,r=n.endsWith("?"),o=n.replace(/\?$/,"");if(a.length===0)return r?[o,""]:[o];let l=Ab(a.join("/")),c=[];return c.push(...l.map(m=>m===""?o:[o,m].join("/"))),r&&c.push(...l),c.map(m=>t.startsWith("/")&&m===""?"/":m)}function zR(t){t.sort((s,n)=>s.score!==n.score?n.score-s.score:qR(s.routesMeta.map(a=>a.childrenIndex),n.routesMeta.map(a=>a.childrenIndex)))}const FR=/^:[\w-]+$/,BR=3,HR=2,WR=1,UR=10,VR=-2,U0=t=>t==="*";function GR(t,s){let n=t.split("/"),a=n.length;return n.some(U0)&&(a+=VR),s&&(a+=HR),n.filter(r=>!U0(r)).reduce((r,o)=>r+(FR.test(o)?BR:o===""?WR:UR),a)}function qR(t,s){return t.length===s.length&&t.slice(0,-1).every((a,r)=>a===s[r])?t[t.length-1]-s[s.length-1]:0}function YR(t,s,n){let{routesMeta:a}=t,r={},o="/",l=[];for(let c=0;c<a.length;++c){let m=a[c],u=c===a.length-1,h=o==="/"?s:s.slice(o.length)||"/",p=KR({path:m.relativePath,caseSensitive:m.caseSensitive,end:u},h),g=m.route;if(!p)return null;Object.assign(r,p.params),l.push({params:r,pathname:bi([o,p.pathname]),pathnameBase:t_(bi([o,p.pathnameBase])),route:g}),p.pathnameBase!=="/"&&(o=bi([o,p.pathnameBase]))}return l}function KR(t,s){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,a]=JR(t.path,t.caseSensitive,t.end),r=s.match(n);if(!r)return null;let o=r[0],l=o.replace(/(.)\/+$/,"$1"),c=r.slice(1);return{params:a.reduce((u,h,p)=>{let{paramName:g,isOptional:x}=h;if(g==="*"){let j=c[p]||"";l=o.slice(0,o.length-j.length).replace(/(.)\/+$/,"$1")}const b=c[p];return x&&!b?u[g]=void 0:u[g]=(b||"").replace(/%2F/g,"/"),u},{}),pathname:o,pathnameBase:l,pattern:t}}function JR(t,s,n){s===void 0&&(s=!1),n===void 0&&(n=!0),Db(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let a=[],r="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(l,c,m)=>(a.push({paramName:c,isOptional:m!=null}),m?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(a.push({paramName:"*"}),r+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?r+="\\/*$":t!==""&&t!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,s?void 0:"i"),a]}function XR(t){try{return t.split("/").map(s=>decodeURIComponent(s).replace(/\//g,"%2F")).join("/")}catch(s){return Db(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+s+").")),t}}function Gf(t,s){if(s==="/")return t;if(!t.toLowerCase().startsWith(s.toLowerCase()))return null;let n=s.endsWith("/")?s.length-1:s.length,a=t.charAt(n);return a&&a!=="/"?null:t.slice(n)||"/"}function ZR(t,s){s===void 0&&(s="/");let{pathname:n,search:a="",hash:r=""}=typeof t=="string"?qo(t):t;return{pathname:n?n.startsWith("/")?n:QR(n,s):s,search:s_(a),hash:n_(r)}}function QR(t,s){let n=s.replace(/\/+$/,"").split("/");return t.split("/").forEach(r=>{r===".."?n.length>1&&n.pop():r!=="."&&n.push(r)}),n.length>1?n.join("/"):"/"}function uh(t,s,n,a){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+s+"` field ["+JSON.stringify(a)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function e_(t){return t.filter((s,n)=>n===0||s.route.path&&s.route.path.length>0)}function qf(t,s){let n=e_(t);return s?n.map((a,r)=>r===n.length-1?a.pathname:a.pathnameBase):n.map(a=>a.pathnameBase)}function Yf(t,s,n,a){a===void 0&&(a=!1);let r;typeof t=="string"?r=qo(t):(r=lc({},t),Os(!r.pathname||!r.pathname.includes("?"),uh("?","pathname","search",r)),Os(!r.pathname||!r.pathname.includes("#"),uh("#","pathname","hash",r)),Os(!r.search||!r.search.includes("#"),uh("#","search","hash",r)));let o=t===""||r.pathname==="",l=o?"/":r.pathname,c;if(l==null)c=n;else{let p=s.length-1;if(!a&&l.startsWith("..")){let g=l.split("/");for(;g[0]==="..";)g.shift(),p-=1;r.pathname=g.join("/")}c=p>=0?s[p]:"/"}let m=ZR(r,c),u=l&&l!=="/"&&l.endsWith("/"),h=(o||l===".")&&n.endsWith("/");return!m.pathname.endsWith("/")&&(u||h)&&(m.pathname+="/"),m}const bi=t=>t.join("/").replace(/\/\/+/g,"/"),t_=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),s_=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,n_=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function a_(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const Rb=["post","put","patch","delete"];new Set(Rb);const r_=["get",...Rb];new Set(r_);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function cc(){return cc=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var n=arguments[s];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t},cc.apply(this,arguments)}const Kf=f.createContext(null),i_=f.createContext(null),Ei=f.createContext(null),Eu=f.createContext(null),cr=f.createContext({outlet:null,matches:[],isDataRoute:!1}),_b=f.createContext(null);function o_(t,s){let{relative:n}=s===void 0?{}:s;Yo()||Os(!1);let{basename:a,navigator:r}=f.useContext(Ei),{hash:o,pathname:l,search:c}=Mb(t,{relative:n}),m=l;return a!=="/"&&(m=l==="/"?a:bi([a,l])),r.createHref({pathname:m,search:c,hash:o})}function Yo(){return f.useContext(Eu)!=null}function jn(){return Yo()||Os(!1),f.useContext(Eu).location}function Pb(t){f.useContext(Ei).static||f.useLayoutEffect(t)}function Xt(){let{isDataRoute:t}=f.useContext(cr);return t?w_():l_()}function l_(){Yo()||Os(!1);let t=f.useContext(Kf),{basename:s,future:n,navigator:a}=f.useContext(Ei),{matches:r}=f.useContext(cr),{pathname:o}=jn(),l=JSON.stringify(qf(r,n.v7_relativeSplatPath)),c=f.useRef(!1);return Pb(()=>{c.current=!0}),f.useCallback(function(u,h){if(h===void 0&&(h={}),!c.current)return;if(typeof u=="number"){a.go(u);return}let p=Yf(u,JSON.parse(l),o,h.relative==="path");t==null&&s!=="/"&&(p.pathname=p.pathname==="/"?s:bi([s,p.pathname])),(h.replace?a.replace:a.push)(p,h.state,h)},[s,a,l,o,t])}const c_=f.createContext(null);function d_(t){let s=f.useContext(cr).outlet;return s&&f.createElement(c_.Provider,{value:t},s)}function Jf(){let{matches:t}=f.useContext(cr),s=t[t.length-1];return s?s.params:{}}function Mb(t,s){let{relative:n}=s===void 0?{}:s,{future:a}=f.useContext(Ei),{matches:r}=f.useContext(cr),{pathname:o}=jn(),l=JSON.stringify(qf(r,a.v7_relativeSplatPath));return f.useMemo(()=>Yf(t,JSON.parse(l),o,n==="path"),[t,l,o,n])}function u_(t,s){return m_(t,s)}function m_(t,s,n,a){Yo()||Os(!1);let{navigator:r}=f.useContext(Ei),{matches:o}=f.useContext(cr),l=o[o.length-1],c=l?l.params:{};l&&l.pathname;let m=l?l.pathnameBase:"/";l&&l.route;let u=jn(),h;if(s){var p;let v=typeof s=="string"?qo(s):s;m==="/"||(p=v.pathname)!=null&&p.startsWith(m)||Os(!1),h=v}else h=u;let g=h.pathname||"/",x=g;if(m!=="/"){let v=m.replace(/^\//,"").split("/");x="/"+g.replace(/^\//,"").split("/").slice(v.length).join("/")}let b=LR(t,{pathname:x}),j=g_(b&&b.map(v=>Object.assign({},v,{params:Object.assign({},c,v.params),pathname:bi([m,r.encodeLocation?r.encodeLocation(v.pathname).pathname:v.pathname]),pathnameBase:v.pathnameBase==="/"?m:bi([m,r.encodeLocation?r.encodeLocation(v.pathnameBase).pathname:v.pathnameBase])})),o,n,a);return s&&j?f.createElement(Eu.Provider,{value:{location:cc({pathname:"/",search:"",hash:"",state:null,key:"default"},h),navigationType:vi.Pop}},j):j}function h_(){let t=j_(),s=a_(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return f.createElement(f.Fragment,null,f.createElement("h2",null,"Unexpected Application Error!"),f.createElement("h3",{style:{fontStyle:"italic"}},s),n?f.createElement("pre",{style:r},n):null,null)}const f_=f.createElement(h_,null);class p_ extends f.Component{constructor(s){super(s),this.state={location:s.location,revalidation:s.revalidation,error:s.error}}static getDerivedStateFromError(s){return{error:s}}static getDerivedStateFromProps(s,n){return n.location!==s.location||n.revalidation!=="idle"&&s.revalidation==="idle"?{error:s.error,location:s.location,revalidation:s.revalidation}:{error:s.error!==void 0?s.error:n.error,location:n.location,revalidation:s.revalidation||n.revalidation}}componentDidCatch(s,n){console.error("React Router caught the following error during render",s,n)}render(){return this.state.error!==void 0?f.createElement(cr.Provider,{value:this.props.routeContext},f.createElement(_b.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function x_(t){let{routeContext:s,match:n,children:a}=t,r=f.useContext(Kf);return r&&r.static&&r.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=n.route.id),f.createElement(cr.Provider,{value:s},a)}function g_(t,s,n,a){var r;if(s===void 0&&(s=[]),n===void 0&&(n=null),a===void 0&&(a=null),t==null){var o;if(!n)return null;if(n.errors)t=n.matches;else if((o=a)!=null&&o.v7_partialHydration&&s.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let l=t,c=(r=n)==null?void 0:r.errors;if(c!=null){let h=l.findIndex(p=>p.route.id&&(c==null?void 0:c[p.route.id])!==void 0);h>=0||Os(!1),l=l.slice(0,Math.min(l.length,h+1))}let m=!1,u=-1;if(n&&a&&a.v7_partialHydration)for(let h=0;h<l.length;h++){let p=l[h];if((p.route.HydrateFallback||p.route.hydrateFallbackElement)&&(u=h),p.route.id){let{loaderData:g,errors:x}=n,b=p.route.loader&&g[p.route.id]===void 0&&(!x||x[p.route.id]===void 0);if(p.route.lazy||b){m=!0,u>=0?l=l.slice(0,u+1):l=[l[0]];break}}}return l.reduceRight((h,p,g)=>{let x,b=!1,j=null,v=null;n&&(x=c&&p.route.id?c[p.route.id]:void 0,j=p.route.errorElement||f_,m&&(u<0&&g===0?(N_("route-fallback"),b=!0,v=null):u===g&&(b=!0,v=p.route.hydrateFallbackElement||null)));let w=s.concat(l.slice(0,g+1)),N=()=>{let S;return x?S=j:b?S=v:p.route.Component?S=f.createElement(p.route.Component,null):p.route.element?S=p.route.element:S=h,f.createElement(x_,{match:p,routeContext:{outlet:h,matches:w,isDataRoute:n!=null},children:S})};return n&&(p.route.ErrorBoundary||p.route.errorElement||g===0)?f.createElement(p_,{location:n.location,revalidation:n.revalidation,component:j,error:x,children:N(),routeContext:{outlet:null,matches:w,isDataRoute:!0}}):N()},null)}var Ib=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(Ib||{}),Ob=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(Ob||{});function v_(t){let s=f.useContext(Kf);return s||Os(!1),s}function y_(t){let s=f.useContext(i_);return s||Os(!1),s}function b_(t){let s=f.useContext(cr);return s||Os(!1),s}function Lb(t){let s=b_(),n=s.matches[s.matches.length-1];return n.route.id||Os(!1),n.route.id}function j_(){var t;let s=f.useContext(_b),n=y_(),a=Lb();return s!==void 0?s:(t=n.errors)==null?void 0:t[a]}function w_(){let{router:t}=v_(Ib.UseNavigateStable),s=Lb(Ob.UseNavigateStable),n=f.useRef(!1);return Pb(()=>{n.current=!0}),f.useCallback(function(r,o){o===void 0&&(o={}),n.current&&(typeof r=="number"?t.navigate(r):t.navigate(r,cc({fromRouteId:s},o)))},[t,s])}const V0={};function N_(t,s,n){V0[t]||(V0[t]=!0)}function S_(t,s){t==null||t.v7_startTransition,t==null||t.v7_relativeSplatPath}function mh(t){let{to:s,replace:n,state:a,relative:r}=t;Yo()||Os(!1);let{future:o,static:l}=f.useContext(Ei),{matches:c}=f.useContext(cr),{pathname:m}=jn(),u=Xt(),h=Yf(s,qf(c,o.v7_relativeSplatPath),m,r==="path"),p=JSON.stringify(h);return f.useEffect(()=>u(JSON.parse(p),{replace:n,state:a,relative:r}),[u,p,r,n,a]),null}function C_(t){return d_(t.context)}function is(t){Os(!1)}function E_(t){let{basename:s="/",children:n=null,location:a,navigationType:r=vi.Pop,navigator:o,static:l=!1,future:c}=t;Yo()&&Os(!1);let m=s.replace(/^\/*/,"/"),u=f.useMemo(()=>({basename:m,navigator:o,static:l,future:cc({v7_relativeSplatPath:!1},c)}),[m,c,o,l]);typeof a=="string"&&(a=qo(a));let{pathname:h="/",search:p="",hash:g="",state:x=null,key:b="default"}=a,j=f.useMemo(()=>{let v=Gf(h,m);return v==null?null:{location:{pathname:v,search:p,hash:g,state:x,key:b},navigationType:r}},[m,h,p,g,x,b,r]);return j==null?null:f.createElement(Ei.Provider,{value:u},f.createElement(Eu.Provider,{children:n,value:j}))}function T_(t){let{children:s,location:n}=t;return u_(Jh(s),n)}new Promise(()=>{});function Jh(t,s){s===void 0&&(s=[]);let n=[];return f.Children.forEach(t,(a,r)=>{if(!f.isValidElement(a))return;let o=[...s,r];if(a.type===f.Fragment){n.push.apply(n,Jh(a.props.children,o));return}a.type!==is&&Os(!1),!a.props.index||!a.props.children||Os(!1);let l={id:a.props.id||o.join("-"),caseSensitive:a.props.caseSensitive,element:a.props.element,Component:a.props.Component,index:a.props.index,path:a.props.path,loader:a.props.loader,action:a.props.action,errorElement:a.props.errorElement,ErrorBoundary:a.props.ErrorBoundary,hasErrorBoundary:a.props.ErrorBoundary!=null||a.props.errorElement!=null,shouldRevalidate:a.props.shouldRevalidate,handle:a.props.handle,lazy:a.props.lazy};a.props.children&&(l.children=Jh(a.props.children,o)),n.push(l)}),n}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Xh(){return Xh=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var n=arguments[s];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t},Xh.apply(this,arguments)}function D_(t,s){if(t==null)return{};var n={},a=Object.keys(t),r,o;for(o=0;o<a.length;o++)r=a[o],!(s.indexOf(r)>=0)&&(n[r]=t[r]);return n}function k_(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function A_(t,s){return t.button===0&&(!s||s==="_self")&&!k_(t)}function Zh(t){return t===void 0&&(t=""),new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((s,n)=>{let a=t[n];return s.concat(Array.isArray(a)?a.map(r=>[n,r]):[[n,a]])},[]))}function R_(t,s){let n=Zh(t);return s&&s.forEach((a,r)=>{n.has(r)||s.getAll(r).forEach(o=>{n.append(r,o)})}),n}const __=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],P_="6";try{window.__reactRouterVersion=P_}catch{}const M_="startTransition",G0=LA[M_];function I_(t){let{basename:s,children:n,future:a,window:r}=t,o=f.useRef();o.current==null&&(o.current=MR({window:r,v5Compat:!0}));let l=o.current,[c,m]=f.useState({action:l.action,location:l.location}),{v7_startTransition:u}=a||{},h=f.useCallback(p=>{u&&G0?G0(()=>m(p)):m(p)},[m,u]);return f.useLayoutEffect(()=>l.listen(h),[l,h]),f.useEffect(()=>S_(a),[a]),f.createElement(E_,{basename:s,children:n,location:c.location,navigationType:c.action,navigator:l,future:a})}const O_=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",L_=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,un=f.forwardRef(function(s,n){let{onClick:a,relative:r,reloadDocument:o,replace:l,state:c,target:m,to:u,preventScrollReset:h,viewTransition:p}=s,g=D_(s,__),{basename:x}=f.useContext(Ei),b,j=!1;if(typeof u=="string"&&L_.test(u)&&(b=u,O_))try{let S=new URL(window.location.href),E=u.startsWith("//")?new URL(S.protocol+u):new URL(u),T=Gf(E.pathname,x);E.origin===S.origin&&T!=null?u=T+E.search+E.hash:j=!0}catch{}let v=o_(u,{relative:r}),w=$_(u,{replace:l,state:c,target:m,preventScrollReset:h,relative:r,viewTransition:p});function N(S){a&&a(S),S.defaultPrevented||w(S)}return f.createElement("a",Xh({},g,{href:b||v,onClick:j||o?a:N,ref:n,target:m}))});var q0;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(q0||(q0={}));var Y0;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(Y0||(Y0={}));function $_(t,s){let{target:n,replace:a,state:r,preventScrollReset:o,relative:l,viewTransition:c}=s===void 0?{}:s,m=Xt(),u=jn(),h=Mb(t,{relative:l});return f.useCallback(p=>{if(A_(p,n)){p.preventDefault();let g=a!==void 0?a:Kd(u)===Kd(h);m(t,{replace:g,state:r,preventScrollReset:o,relative:l,viewTransition:c})}},[u,m,h,a,r,n,t,o,l,c])}function z_(t){let s=f.useRef(Zh(t)),n=f.useRef(!1),a=jn(),r=f.useMemo(()=>R_(a.search,n.current?null:s.current),[a.search]),o=Xt(),l=f.useCallback((c,m)=>{const u=Zh(typeof c=="function"?c(r):c);n.current=!0,o("?"+u,m)},[o,r]);return[r,l]}const F_="modulepreload",B_=function(t){return"/life-tracker/"+t},K0={},Ko=function(s,n,a){let r=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),c=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));r=Promise.allSettled(n.map(m=>{if(m=B_(m),m in K0)return;K0[m]=!0;const u=m.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${h}`))return;const p=document.createElement("link");if(p.rel=u?"stylesheet":F_,u||(p.as="script"),p.crossOrigin="",p.href=m,c&&p.setAttribute("nonce",c),document.head.appendChild(p),u)return new Promise((g,x)=>{p.addEventListener("load",g),p.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${m}`)))})}))}function o(l){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=l,window.dispatchEvent(c),!c.defaultPrevented)throw l}return r.then(l=>{for(const c of l||[])c.status==="rejected"&&o(c.reason);return s().catch(o)})};function H_(t={}){const{immediate:s=!1,onNeedRefresh:n,onOfflineReady:a,onRegistered:r,onRegisteredSW:o,onRegisterError:l}=t;let c,m;const u=async(p=!0)=>{await m};async function h(){if("serviceWorker"in navigator){if(c=await Ko(async()=>{const{Workbox:p}=await import("../chunks/workbox-window.prod.es5-B9K5rw8f.js");return{Workbox:p}},[]).then(({Workbox:p})=>new p("/life-tracker/service-worker.js",{scope:"/life-tracker/",type:"classic"})).catch(p=>{l==null||l(p)}),!c)return;c.addEventListener("activated",p=>{(p.isUpdate||p.isExternal)&&window.location.reload()}),c.addEventListener("installed",p=>{p.isUpdate||a==null||a()}),c.register({immediate:s}).then(p=>{o?o("/life-tracker/service-worker.js",p):r==null||r(p)}).catch(p=>{l==null||l(p)})}}return m=h(),u}const Sc=()=>{const[t,s]=f.useState(()=>{if(typeof window>"u")return{deviceType:"desktop",orientation:"landscape",isMobile:!1,isTablet:!1,isDesktop:!0,screenWidth:1920,screenHeight:1080,shouldShowDesktopNav:!0};const n=window.innerWidth,a=window.innerHeight,r=n<768,o=n>=768&&n<1024,l=n>=1024,c=n>=768;return{deviceType:n<768?"mobile":n<1024?"tablet":"desktop",orientation:n<a?"portrait":"landscape",isMobile:r,isTablet:o,isDesktop:l,screenWidth:n,screenHeight:a,shouldShowDesktopNav:c}});return f.useEffect(()=>{const n=()=>{const r=window.innerWidth,o=window.innerHeight,l=r<768,c=r>=768&&r<1024,m=r>=1024,u=r>=768;s({deviceType:r<768?"mobile":r<1024?"tablet":"desktop",orientation:r<o?"portrait":"landscape",isMobile:l,isTablet:c,isDesktop:m,screenWidth:r,screenHeight:o,shouldShowDesktopNav:u})},a=()=>{setTimeout(n,100)};return window.addEventListener("resize",n),window.addEventListener("orientationchange",a),()=>{window.removeEventListener("resize",n),window.removeEventListener("orientationchange",a)}},[]),t},W_=()=>{const[t,s]=f.useState(!1),[n,a]=f.useState(!1),[r,o]=f.useState(null);return f.useEffect(()=>{const c=window.matchMedia("(display-mode: standalone)").matches,m=window.navigator.standalone===!0;s(c||m);const u=h=>{h.preventDefault(),o(h),a(!0)};return window.addEventListener("beforeinstallprompt",u),()=>{window.removeEventListener("beforeinstallprompt",u)}},[]),{isInstalled:t,canInstall:n,promptInstall:async()=>{if(!r)return!1;r.prompt();const{outcome:c}=await r.userChoice;return c==="accepted"?(a(!1),o(null),!0):!1}}},Xf="-",U_=t=>{const s=G_(t),{conflictingClassGroups:n,conflictingClassGroupModifiers:a}=t;return{getClassGroupId:l=>{const c=l.split(Xf);return c[0]===""&&c.length!==1&&c.shift(),$b(c,s)||V_(l)},getConflictingClassGroupIds:(l,c)=>{const m=n[l]||[];return c&&a[l]?[...m,...a[l]]:m}}},$b=(t,s)=>{var l;if(t.length===0)return s.classGroupId;const n=t[0],a=s.nextPart.get(n),r=a?$b(t.slice(1),a):void 0;if(r)return r;if(s.validators.length===0)return;const o=t.join(Xf);return(l=s.validators.find(({validator:c})=>c(o)))==null?void 0:l.classGroupId},J0=/^\[(.+)\]$/,V_=t=>{if(J0.test(t)){const s=J0.exec(t)[1],n=s==null?void 0:s.substring(0,s.indexOf(":"));if(n)return"arbitrary.."+n}},G_=t=>{const{theme:s,prefix:n}=t,a={nextPart:new Map,validators:[]};return Y_(Object.entries(t.classGroups),n).forEach(([o,l])=>{Qh(l,a,o,s)}),a},Qh=(t,s,n,a)=>{t.forEach(r=>{if(typeof r=="string"){const o=r===""?s:X0(s,r);o.classGroupId=n;return}if(typeof r=="function"){if(q_(r)){Qh(r(a),s,n,a);return}s.validators.push({validator:r,classGroupId:n});return}Object.entries(r).forEach(([o,l])=>{Qh(l,X0(s,o),n,a)})})},X0=(t,s)=>{let n=t;return s.split(Xf).forEach(a=>{n.nextPart.has(a)||n.nextPart.set(a,{nextPart:new Map,validators:[]}),n=n.nextPart.get(a)}),n},q_=t=>t.isThemeGetter,Y_=(t,s)=>s?t.map(([n,a])=>{const r=a.map(o=>typeof o=="string"?s+o:typeof o=="object"?Object.fromEntries(Object.entries(o).map(([l,c])=>[s+l,c])):o);return[n,r]}):t,K_=t=>{if(t<1)return{get:()=>{},set:()=>{}};let s=0,n=new Map,a=new Map;const r=(o,l)=>{n.set(o,l),s++,s>t&&(s=0,a=n,n=new Map)};return{get(o){let l=n.get(o);if(l!==void 0)return l;if((l=a.get(o))!==void 0)return r(o,l),l},set(o,l){n.has(o)?n.set(o,l):r(o,l)}}},zb="!",J_=t=>{const{separator:s,experimentalParseClassName:n}=t,a=s.length===1,r=s[0],o=s.length,l=c=>{const m=[];let u=0,h=0,p;for(let v=0;v<c.length;v++){let w=c[v];if(u===0){if(w===r&&(a||c.slice(v,v+o)===s)){m.push(c.slice(h,v)),h=v+o;continue}if(w==="/"){p=v;continue}}w==="["?u++:w==="]"&&u--}const g=m.length===0?c:c.substring(h),x=g.startsWith(zb),b=x?g.substring(1):g,j=p&&p>h?p-h:void 0;return{modifiers:m,hasImportantModifier:x,baseClassName:b,maybePostfixModifierPosition:j}};return n?c=>n({className:c,parseClassName:l}):l},X_=t=>{if(t.length<=1)return t;const s=[];let n=[];return t.forEach(a=>{a[0]==="["?(s.push(...n.sort(),a),n=[]):n.push(a)}),s.push(...n.sort()),s},Z_=t=>({cache:K_(t.cacheSize),parseClassName:J_(t),...U_(t)}),Q_=/\s+/,eP=(t,s)=>{const{parseClassName:n,getClassGroupId:a,getConflictingClassGroupIds:r}=s,o=[],l=t.trim().split(Q_);let c="";for(let m=l.length-1;m>=0;m-=1){const u=l[m],{modifiers:h,hasImportantModifier:p,baseClassName:g,maybePostfixModifierPosition:x}=n(u);let b=!!x,j=a(b?g.substring(0,x):g);if(!j){if(!b){c=u+(c.length>0?" "+c:c);continue}if(j=a(g),!j){c=u+(c.length>0?" "+c:c);continue}b=!1}const v=X_(h).join(":"),w=p?v+zb:v,N=w+j;if(o.includes(N))continue;o.push(N);const S=r(j,b);for(let E=0;E<S.length;++E){const T=S[E];o.push(w+T)}c=u+(c.length>0?" "+c:c)}return c};function tP(){let t=0,s,n,a="";for(;t<arguments.length;)(s=arguments[t++])&&(n=Fb(s))&&(a&&(a+=" "),a+=n);return a}const Fb=t=>{if(typeof t=="string")return t;let s,n="";for(let a=0;a<t.length;a++)t[a]&&(s=Fb(t[a]))&&(n&&(n+=" "),n+=s);return n};function sP(t,...s){let n,a,r,o=l;function l(m){const u=s.reduce((h,p)=>p(h),t());return n=Z_(u),a=n.cache.get,r=n.cache.set,o=c,c(m)}function c(m){const u=a(m);if(u)return u;const h=eP(m,n);return r(m,h),h}return function(){return o(tP.apply(null,arguments))}}const xs=t=>{const s=n=>n[t]||[];return s.isThemeGetter=!0,s},Bb=/^\[(?:([a-z-]+):)?(.+)\]$/i,nP=/^\d+\/\d+$/,aP=new Set(["px","full","screen"]),rP=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,iP=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,oP=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,lP=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,cP=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Dr=t=>Eo(t)||aP.has(t)||nP.test(t),ti=t=>Jo(t,"length",gP),Eo=t=>!!t&&!Number.isNaN(Number(t)),hh=t=>Jo(t,"number",Eo),Cl=t=>!!t&&Number.isInteger(Number(t)),dP=t=>t.endsWith("%")&&Eo(t.slice(0,-1)),it=t=>Bb.test(t),si=t=>rP.test(t),uP=new Set(["length","size","percentage"]),mP=t=>Jo(t,uP,Hb),hP=t=>Jo(t,"position",Hb),fP=new Set(["image","url"]),pP=t=>Jo(t,fP,yP),xP=t=>Jo(t,"",vP),El=()=>!0,Jo=(t,s,n)=>{const a=Bb.exec(t);return a?a[1]?typeof s=="string"?a[1]===s:s.has(a[1]):n(a[2]):!1},gP=t=>iP.test(t)&&!oP.test(t),Hb=()=>!1,vP=t=>lP.test(t),yP=t=>cP.test(t),bP=()=>{const t=xs("colors"),s=xs("spacing"),n=xs("blur"),a=xs("brightness"),r=xs("borderColor"),o=xs("borderRadius"),l=xs("borderSpacing"),c=xs("borderWidth"),m=xs("contrast"),u=xs("grayscale"),h=xs("hueRotate"),p=xs("invert"),g=xs("gap"),x=xs("gradientColorStops"),b=xs("gradientColorStopPositions"),j=xs("inset"),v=xs("margin"),w=xs("opacity"),N=xs("padding"),S=xs("saturate"),E=xs("scale"),T=xs("sepia"),k=xs("skew"),D=xs("space"),P=xs("translate"),_=()=>["auto","contain","none"],B=()=>["auto","hidden","clip","visible","scroll"],I=()=>["auto",it,s],R=()=>[it,s],M=()=>["",Dr,ti],W=()=>["auto",Eo,it],H=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],L=()=>["solid","dashed","dotted","double","none"],$=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],q=()=>["start","end","center","between","around","evenly","stretch"],re=()=>["","0",it],Y=()=>["auto","avoid","all","avoid-page","page","left","right","column"],se=()=>[Eo,it];return{cacheSize:500,separator:":",theme:{colors:[El],spacing:[Dr,ti],blur:["none","",si,it],brightness:se(),borderColor:[t],borderRadius:["none","","full",si,it],borderSpacing:R(),borderWidth:M(),contrast:se(),grayscale:re(),hueRotate:se(),invert:re(),gap:R(),gradientColorStops:[t],gradientColorStopPositions:[dP,ti],inset:I(),margin:I(),opacity:se(),padding:R(),saturate:se(),scale:se(),sepia:re(),skew:se(),space:R(),translate:R()},classGroups:{aspect:[{aspect:["auto","square","video",it]}],container:["container"],columns:[{columns:[si]}],"break-after":[{"break-after":Y()}],"break-before":[{"break-before":Y()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...H(),it]}],overflow:[{overflow:B()}],"overflow-x":[{"overflow-x":B()}],"overflow-y":[{"overflow-y":B()}],overscroll:[{overscroll:_()}],"overscroll-x":[{"overscroll-x":_()}],"overscroll-y":[{"overscroll-y":_()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[j]}],"inset-x":[{"inset-x":[j]}],"inset-y":[{"inset-y":[j]}],start:[{start:[j]}],end:[{end:[j]}],top:[{top:[j]}],right:[{right:[j]}],bottom:[{bottom:[j]}],left:[{left:[j]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Cl,it]}],basis:[{basis:I()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",it]}],grow:[{grow:re()}],shrink:[{shrink:re()}],order:[{order:["first","last","none",Cl,it]}],"grid-cols":[{"grid-cols":[El]}],"col-start-end":[{col:["auto",{span:["full",Cl,it]},it]}],"col-start":[{"col-start":W()}],"col-end":[{"col-end":W()}],"grid-rows":[{"grid-rows":[El]}],"row-start-end":[{row:["auto",{span:[Cl,it]},it]}],"row-start":[{"row-start":W()}],"row-end":[{"row-end":W()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",it]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",it]}],gap:[{gap:[g]}],"gap-x":[{"gap-x":[g]}],"gap-y":[{"gap-y":[g]}],"justify-content":[{justify:["normal",...q()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...q(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...q(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[N]}],px:[{px:[N]}],py:[{py:[N]}],ps:[{ps:[N]}],pe:[{pe:[N]}],pt:[{pt:[N]}],pr:[{pr:[N]}],pb:[{pb:[N]}],pl:[{pl:[N]}],m:[{m:[v]}],mx:[{mx:[v]}],my:[{my:[v]}],ms:[{ms:[v]}],me:[{me:[v]}],mt:[{mt:[v]}],mr:[{mr:[v]}],mb:[{mb:[v]}],ml:[{ml:[v]}],"space-x":[{"space-x":[D]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[D]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",it,s]}],"min-w":[{"min-w":[it,s,"min","max","fit"]}],"max-w":[{"max-w":[it,s,"none","full","min","max","fit","prose",{screen:[si]},si]}],h:[{h:[it,s,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[it,s,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[it,s,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[it,s,"auto","min","max","fit"]}],"font-size":[{text:["base",si,ti]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",hh]}],"font-family":[{font:[El]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",it]}],"line-clamp":[{"line-clamp":["none",Eo,hh]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Dr,it]}],"list-image":[{"list-image":["none",it]}],"list-style-type":[{list:["none","disc","decimal",it]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[t]}],"placeholder-opacity":[{"placeholder-opacity":[w]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[t]}],"text-opacity":[{"text-opacity":[w]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...L(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Dr,ti]}],"underline-offset":[{"underline-offset":["auto",Dr,it]}],"text-decoration-color":[{decoration:[t]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:R()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",it]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",it]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[w]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...H(),hP]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",mP]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},pP]}],"bg-color":[{bg:[t]}],"gradient-from-pos":[{from:[b]}],"gradient-via-pos":[{via:[b]}],"gradient-to-pos":[{to:[b]}],"gradient-from":[{from:[x]}],"gradient-via":[{via:[x]}],"gradient-to":[{to:[x]}],rounded:[{rounded:[o]}],"rounded-s":[{"rounded-s":[o]}],"rounded-e":[{"rounded-e":[o]}],"rounded-t":[{"rounded-t":[o]}],"rounded-r":[{"rounded-r":[o]}],"rounded-b":[{"rounded-b":[o]}],"rounded-l":[{"rounded-l":[o]}],"rounded-ss":[{"rounded-ss":[o]}],"rounded-se":[{"rounded-se":[o]}],"rounded-ee":[{"rounded-ee":[o]}],"rounded-es":[{"rounded-es":[o]}],"rounded-tl":[{"rounded-tl":[o]}],"rounded-tr":[{"rounded-tr":[o]}],"rounded-br":[{"rounded-br":[o]}],"rounded-bl":[{"rounded-bl":[o]}],"border-w":[{border:[c]}],"border-w-x":[{"border-x":[c]}],"border-w-y":[{"border-y":[c]}],"border-w-s":[{"border-s":[c]}],"border-w-e":[{"border-e":[c]}],"border-w-t":[{"border-t":[c]}],"border-w-r":[{"border-r":[c]}],"border-w-b":[{"border-b":[c]}],"border-w-l":[{"border-l":[c]}],"border-opacity":[{"border-opacity":[w]}],"border-style":[{border:[...L(),"hidden"]}],"divide-x":[{"divide-x":[c]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[c]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[w]}],"divide-style":[{divide:L()}],"border-color":[{border:[r]}],"border-color-x":[{"border-x":[r]}],"border-color-y":[{"border-y":[r]}],"border-color-s":[{"border-s":[r]}],"border-color-e":[{"border-e":[r]}],"border-color-t":[{"border-t":[r]}],"border-color-r":[{"border-r":[r]}],"border-color-b":[{"border-b":[r]}],"border-color-l":[{"border-l":[r]}],"divide-color":[{divide:[r]}],"outline-style":[{outline:["",...L()]}],"outline-offset":[{"outline-offset":[Dr,it]}],"outline-w":[{outline:[Dr,ti]}],"outline-color":[{outline:[t]}],"ring-w":[{ring:M()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[t]}],"ring-opacity":[{"ring-opacity":[w]}],"ring-offset-w":[{"ring-offset":[Dr,ti]}],"ring-offset-color":[{"ring-offset":[t]}],shadow:[{shadow:["","inner","none",si,xP]}],"shadow-color":[{shadow:[El]}],opacity:[{opacity:[w]}],"mix-blend":[{"mix-blend":[...$(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":$()}],filter:[{filter:["","none"]}],blur:[{blur:[n]}],brightness:[{brightness:[a]}],contrast:[{contrast:[m]}],"drop-shadow":[{"drop-shadow":["","none",si,it]}],grayscale:[{grayscale:[u]}],"hue-rotate":[{"hue-rotate":[h]}],invert:[{invert:[p]}],saturate:[{saturate:[S]}],sepia:[{sepia:[T]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[n]}],"backdrop-brightness":[{"backdrop-brightness":[a]}],"backdrop-contrast":[{"backdrop-contrast":[m]}],"backdrop-grayscale":[{"backdrop-grayscale":[u]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[h]}],"backdrop-invert":[{"backdrop-invert":[p]}],"backdrop-opacity":[{"backdrop-opacity":[w]}],"backdrop-saturate":[{"backdrop-saturate":[S]}],"backdrop-sepia":[{"backdrop-sepia":[T]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[l]}],"border-spacing-x":[{"border-spacing-x":[l]}],"border-spacing-y":[{"border-spacing-y":[l]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",it]}],duration:[{duration:se()}],ease:[{ease:["linear","in","out","in-out",it]}],delay:[{delay:se()}],animate:[{animate:["none","spin","ping","pulse","bounce",it]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[E]}],"scale-x":[{"scale-x":[E]}],"scale-y":[{"scale-y":[E]}],rotate:[{rotate:[Cl,it]}],"translate-x":[{"translate-x":[P]}],"translate-y":[{"translate-y":[P]}],"skew-x":[{"skew-x":[k]}],"skew-y":[{"skew-y":[k]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",it]}],accent:[{accent:["auto",t]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",it]}],"caret-color":[{caret:[t]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":R()}],"scroll-mx":[{"scroll-mx":R()}],"scroll-my":[{"scroll-my":R()}],"scroll-ms":[{"scroll-ms":R()}],"scroll-me":[{"scroll-me":R()}],"scroll-mt":[{"scroll-mt":R()}],"scroll-mr":[{"scroll-mr":R()}],"scroll-mb":[{"scroll-mb":R()}],"scroll-ml":[{"scroll-ml":R()}],"scroll-p":[{"scroll-p":R()}],"scroll-px":[{"scroll-px":R()}],"scroll-py":[{"scroll-py":R()}],"scroll-ps":[{"scroll-ps":R()}],"scroll-pe":[{"scroll-pe":R()}],"scroll-pt":[{"scroll-pt":R()}],"scroll-pr":[{"scroll-pr":R()}],"scroll-pb":[{"scroll-pb":R()}],"scroll-pl":[{"scroll-pl":R()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",it]}],fill:[{fill:[t,"none"]}],"stroke-w":[{stroke:[Dr,ti,hh]}],stroke:[{stroke:[t,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},jP=sP(bP);function ce(...t){return jP(zA(t))}const dc=Wo("inline-flex items-center justify-center whitespace-nowrap rounded-lg text-sm font-medium ring-offset-background transition-all duration-150 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 touch-manipulation active:scale-95",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-md",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90 shadow-md",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 shadow-sm",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline",gradient:"gradient-bg-primary text-white shadow-lg border-0 hover:opacity-90",glass:"glass-card text-gray-700 hover:bg-white/30 backdrop-blur-sm border border-white/20"},size:{default:"h-10 md:h-11 px-4 py-2",sm:"h-8 md:h-9 rounded-md px-3 text-xs md:text-sm",lg:"h-12 md:h-13 rounded-md px-8 text-sm md:text-base",icon:"h-10 w-10 md:h-11 md:w-11",touch:"h-11 md:h-12 px-6 py-3 text-base md:text-lg min-w-[44px]"}},defaultVariants:{variant:"default",size:"default"}}),z=f.forwardRef(({className:t,variant:s,size:n,asChild:a=!1,...r},o)=>{const l=a?NA:"button";return e.jsx(l,{className:ce(dc({variant:s,size:n,className:t})),ref:o,...r})});z.displayName="Button";var Wb=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),wP="VisuallyHidden",Ub=f.forwardRef((t,s)=>e.jsx(At.span,{...t,ref:s,style:{...Wb,...t.style}}));Ub.displayName=wP;var NP=Ub,[Tu,QH]=Br("Tooltip",[Lo]),Du=Lo(),Vb="TooltipProvider",SP=700,ef="tooltip.open",[CP,Zf]=Tu(Vb),Gb=t=>{const{__scopeTooltip:s,delayDuration:n=SP,skipDelayDuration:a=300,disableHoverableContent:r=!1,children:o}=t,l=f.useRef(!0),c=f.useRef(!1),m=f.useRef(0);return f.useEffect(()=>{const u=m.current;return()=>window.clearTimeout(u)},[]),e.jsx(CP,{scope:s,isOpenDelayedRef:l,delayDuration:n,onOpen:f.useCallback(()=>{window.clearTimeout(m.current),l.current=!1},[]),onClose:f.useCallback(()=>{window.clearTimeout(m.current),m.current=window.setTimeout(()=>l.current=!0,a)},[a]),isPointerInTransitRef:c,onPointerInTransitChange:f.useCallback(u=>{c.current=u},[]),disableHoverableContent:r,children:o})};Gb.displayName=Vb;var uc="Tooltip",[EP,ku]=Tu(uc),qb=t=>{const{__scopeTooltip:s,children:n,open:a,defaultOpen:r,onOpenChange:o,disableHoverableContent:l,delayDuration:c}=t,m=Zf(uc,t.__scopeTooltip),u=Du(s),[h,p]=f.useState(null),g=$o(),x=f.useRef(0),b=l??m.disableHoverableContent,j=c??m.delayDuration,v=f.useRef(!1),[w,N]=$r({prop:a,defaultProp:r??!1,onChange:D=>{D?(m.onOpen(),document.dispatchEvent(new CustomEvent(ef))):m.onClose(),o==null||o(D)},caller:uc}),S=f.useMemo(()=>w?v.current?"delayed-open":"instant-open":"closed",[w]),E=f.useCallback(()=>{window.clearTimeout(x.current),x.current=0,v.current=!1,N(!0)},[N]),T=f.useCallback(()=>{window.clearTimeout(x.current),x.current=0,N(!1)},[N]),k=f.useCallback(()=>{window.clearTimeout(x.current),x.current=window.setTimeout(()=>{v.current=!0,N(!0),x.current=0},j)},[j,N]);return f.useEffect(()=>()=>{x.current&&(window.clearTimeout(x.current),x.current=0)},[]),e.jsx(Mf,{...u,children:e.jsx(EP,{scope:s,contentId:g,open:w,stateAttribute:S,trigger:h,onTriggerChange:p,onTriggerEnter:f.useCallback(()=>{m.isOpenDelayedRef.current?k():E()},[m.isOpenDelayedRef,k,E]),onTriggerLeave:f.useCallback(()=>{b?T():(window.clearTimeout(x.current),x.current=0)},[T,b]),onOpen:E,onClose:T,disableHoverableContent:b,children:n})})};qb.displayName=uc;var tf="TooltipTrigger",Yb=f.forwardRef((t,s)=>{const{__scopeTooltip:n,...a}=t,r=ku(tf,n),o=Zf(tf,n),l=Du(n),c=f.useRef(null),m=ws(s,c,r.onTriggerChange),u=f.useRef(!1),h=f.useRef(!1),p=f.useCallback(()=>u.current=!1,[]);return f.useEffect(()=>()=>document.removeEventListener("pointerup",p),[p]),e.jsx(xu,{asChild:!0,...l,children:e.jsx(At.button,{"aria-describedby":r.open?r.contentId:void 0,"data-state":r.stateAttribute,...a,ref:m,onPointerMove:nt(t.onPointerMove,g=>{g.pointerType!=="touch"&&!h.current&&!o.isPointerInTransitRef.current&&(r.onTriggerEnter(),h.current=!0)}),onPointerLeave:nt(t.onPointerLeave,()=>{r.onTriggerLeave(),h.current=!1}),onPointerDown:nt(t.onPointerDown,()=>{r.open&&r.onClose(),u.current=!0,document.addEventListener("pointerup",p,{once:!0})}),onFocus:nt(t.onFocus,()=>{u.current||r.onOpen()}),onBlur:nt(t.onBlur,r.onClose),onClick:nt(t.onClick,r.onClose)})})});Yb.displayName=tf;var TP="TooltipPortal",[eW,DP]=Tu(TP,{forceMount:void 0}),Mo="TooltipContent",Kb=f.forwardRef((t,s)=>{const n=DP(Mo,t.__scopeTooltip),{forceMount:a=n.forceMount,side:r="top",...o}=t,l=ku(Mo,t.__scopeTooltip);return e.jsx(Hr,{present:a||l.open,children:l.disableHoverableContent?e.jsx(Jb,{side:r,...o,ref:s}):e.jsx(kP,{side:r,...o,ref:s})})}),kP=f.forwardRef((t,s)=>{const n=ku(Mo,t.__scopeTooltip),a=Zf(Mo,t.__scopeTooltip),r=f.useRef(null),o=ws(s,r),[l,c]=f.useState(null),{trigger:m,onClose:u}=n,h=r.current,{onPointerInTransitChange:p}=a,g=f.useCallback(()=>{c(null),p(!1)},[p]),x=f.useCallback((b,j)=>{const v=b.currentTarget,w={x:b.clientX,y:b.clientY},N=MP(w,v.getBoundingClientRect()),S=IP(w,N),E=OP(j.getBoundingClientRect()),T=$P([...S,...E]);c(T),p(!0)},[p]);return f.useEffect(()=>()=>g(),[g]),f.useEffect(()=>{if(m&&h){const b=v=>x(v,h),j=v=>x(v,m);return m.addEventListener("pointerleave",b),h.addEventListener("pointerleave",j),()=>{m.removeEventListener("pointerleave",b),h.removeEventListener("pointerleave",j)}}},[m,h,x,g]),f.useEffect(()=>{if(l){const b=j=>{const v=j.target,w={x:j.clientX,y:j.clientY},N=(m==null?void 0:m.contains(v))||(h==null?void 0:h.contains(v)),S=!LP(w,l);N?g():S&&(g(),u())};return document.addEventListener("pointermove",b),()=>document.removeEventListener("pointermove",b)}},[m,h,l,u,g]),e.jsx(Jb,{...t,ref:o})}),[AP,RP]=Tu(uc,{isInside:!1}),_P=Fy("TooltipContent"),Jb=f.forwardRef((t,s)=>{const{__scopeTooltip:n,children:a,"aria-label":r,onEscapeKeyDown:o,onPointerDownOutside:l,...c}=t,m=ku(Mo,n),u=Du(n),{onClose:h}=m;return f.useEffect(()=>(document.addEventListener(ef,h),()=>document.removeEventListener(ef,h)),[h]),f.useEffect(()=>{if(m.trigger){const p=g=>{const x=g.target;x!=null&&x.contains(m.trigger)&&h()};return window.addEventListener("scroll",p,{capture:!0}),()=>window.removeEventListener("scroll",p,{capture:!0})}},[m.trigger,h]),e.jsx(_f,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:o,onPointerDownOutside:l,onFocusOutside:p=>p.preventDefault(),onDismiss:h,children:e.jsxs(Pf,{"data-state":m.stateAttribute,...u,...c,ref:s,style:{...c.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[e.jsx(_P,{children:a}),e.jsx(AP,{scope:n,isInside:!0,children:e.jsx(NP,{id:m.contentId,role:"tooltip",children:r||a})})]})})});Kb.displayName=Mo;var Xb="TooltipArrow",PP=f.forwardRef((t,s)=>{const{__scopeTooltip:n,...a}=t,r=Du(n);return RP(Xb,n).isInside?null:e.jsx(If,{...r,...a,ref:s})});PP.displayName=Xb;function MP(t,s){const n=Math.abs(s.top-t.y),a=Math.abs(s.bottom-t.y),r=Math.abs(s.right-t.x),o=Math.abs(s.left-t.x);switch(Math.min(n,a,r,o)){case o:return"left";case r:return"right";case n:return"top";case a:return"bottom";default:throw new Error("unreachable")}}function IP(t,s,n=5){const a=[];switch(s){case"top":a.push({x:t.x-n,y:t.y+n},{x:t.x+n,y:t.y+n});break;case"bottom":a.push({x:t.x-n,y:t.y-n},{x:t.x+n,y:t.y-n});break;case"left":a.push({x:t.x+n,y:t.y-n},{x:t.x+n,y:t.y+n});break;case"right":a.push({x:t.x-n,y:t.y-n},{x:t.x-n,y:t.y+n});break}return a}function OP(t){const{top:s,right:n,bottom:a,left:r}=t;return[{x:r,y:s},{x:n,y:s},{x:n,y:a},{x:r,y:a}]}function LP(t,s){const{x:n,y:a}=t;let r=!1;for(let o=0,l=s.length-1;o<s.length;l=o++){const c=s[o],m=s[l],u=c.x,h=c.y,p=m.x,g=m.y;h>a!=g>a&&n<(p-u)*(a-h)/(g-h)+u&&(r=!r)}return r}function $P(t){const s=t.slice();return s.sort((n,a)=>n.x<a.x?-1:n.x>a.x?1:n.y<a.y?-1:n.y>a.y?1:0),zP(s)}function zP(t){if(t.length<=1)return t.slice();const s=[];for(let a=0;a<t.length;a++){const r=t[a];for(;s.length>=2;){const o=s[s.length-1],l=s[s.length-2];if((o.x-l.x)*(r.y-l.y)>=(o.y-l.y)*(r.x-l.x))s.pop();else break}s.push(r)}s.pop();const n=[];for(let a=t.length-1;a>=0;a--){const r=t[a];for(;n.length>=2;){const o=n[n.length-1],l=n[n.length-2];if((o.x-l.x)*(r.y-l.y)>=(o.y-l.y)*(r.x-l.x))n.pop();else break}n.push(r)}return n.pop(),s.length===1&&n.length===1&&s[0].x===n[0].x&&s[0].y===n[0].y?s:s.concat(n)}var FP=Gb,BP=qb,HP=Yb,Zb=Kb;const xa=FP,Ms=BP,Is=HP,ks=f.forwardRef(({className:t,sideOffset:s=4,...n},a)=>e.jsx(Zb,{ref:a,sideOffset:s,className:ce("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...n}));ks.displayName=Zb.displayName;const WP={apiKey:"AIzaSyA1UeSwJ_gjygFI5SL4ZANSDHWTnuOxD_o",authDomain:"lifetracker-9e171.firebaseapp.com",projectId:"lifetracker-9e171",storageBucket:"lifetracker-9e171.firebasestorage.app",messagingSenderId:"160072327627",appId:"1:160072327627:web:664a48e910b6eedd59964e"},Qb=ZA(WP),fh=QA(Qb),fe=eR(Qb);let Z0=!1;const Jd=async()=>{try{console.log("Clearing Firestore offline cache..."),await sR(fe),await nR(fe),await cb(fe),console.log("Firestore offline cache cleared successfully"),typeof window<"u"&&window.location.reload()}catch(t){throw console.error("Error clearing Firestore offline cache:",t),t}},Xd=t=>{var s,n;return((s=t==null?void 0:t.message)==null?void 0:s.includes("INTERNAL ASSERTION FAILED"))||((n=t==null?void 0:t.message)==null?void 0:n.includes("Unexpected state"))||(t==null?void 0:t.code)==="internal"};typeof window<"u"&&!Z0&&(Z0=!0,tR(fe,{forceOwnership:!0}).catch(t=>{t.code==="failed-precondition"?console.warn("Firestore persistence failed: Multiple tabs open"):t.code==="unimplemented"?console.warn("Firestore persistence not available in this browser"):console.error("Firestore persistence error",t)}));function qe(){const[t,s]=f.useState(null),[n,a]=f.useState(!0);return f.useEffect(()=>aR(fh,c=>{s(c),a(!1)}),[]),{user:t,loading:n,signIn:async()=>{const l=new iR;try{await oR(fh,l)}catch(c){console.error("Error al iniciar sesión:",c)}},signOut:async()=>{try{await rR(fh)}catch(l){console.error("Error al cerrar sesión:",l)}}}}const sf=[{icon:uR,label:"Inicio",path:"/"},{icon:$f,label:"Hidratación",path:"/water"},{icon:ub,label:"Ejercicio",path:"/exercise"},{icon:zf,label:"Hábitos",path:"/habit"},{icon:wu,label:"Estado",path:"/mood"},{icon:vc,label:"Diario",path:"/journal"},{icon:Ji,label:"Pomodoro",path:"/pomodoro"},{icon:mb,label:"Comidas",path:"/meal"},{icon:mR,label:"Tareas",path:"/task"},{icon:hb,label:"Kanban",path:"/kanban"},{icon:fb,label:"Objetivos",path:"/goals"},{icon:Ff,label:"Estadísticas",path:"/stats"},{icon:qd,label:"Hábitos Negativos",path:"/negative"}],UP=({isExpanded:t,navigate:s})=>{const{user:n}=qe(),a=c=>c?c.split(" ").map(m=>m.charAt(0)).join("").toUpperCase().slice(0,2):"U",r=t?"w-10 h-10":"w-8 h-8",o=t?"text-sm":"text-xs",l=e.jsxs("div",{className:"flex items-center space-x-3 w-full",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[n!=null&&n.photoURL?e.jsx("img",{src:n.photoURL,alt:"Profile",className:`${r} rounded-full border-2 border-white/20 object-cover`,onError:c=>{var m;c.currentTarget.style.display="none",(m=c.currentTarget.nextElementSibling)==null||m.classList.remove("hidden")}}):null,e.jsx("div",{className:`${r} rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-semibold ${o} border-2 border-white/20 ${n!=null&&n.photoURL?"hidden":""}`,children:a((n==null?void 0:n.displayName)||(n==null?void 0:n.email))})]}),t&&e.jsxs("div",{className:"flex flex-col min-w-0 flex-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 truncate",children:(n==null?void 0:n.displayName)||"Usuario"}),e.jsx("span",{className:"text-xs text-gray-500 truncate",children:n==null?void 0:n.email})]})]});return t?e.jsx(z,{variant:"ghost",className:"w-full h-auto p-4 hover:bg-white/20 rounded-xl transition-colors duration-150 flex items-center justify-start",onClick:()=>s("/settings"),children:l}):e.jsx(xa,{children:e.jsxs(Ms,{delayDuration:0,children:[e.jsx(Is,{asChild:!0,children:e.jsx(z,{variant:"ghost",className:"w-full h-auto p-1.5 hover:bg-white/20 rounded-xl transition-colors duration-150 flex items-center justify-center",onClick:()=>s("/settings"),children:l})}),e.jsx(ks,{side:"right",className:"bg-black text-white border-gray-700",children:e.jsx("p",{children:"Perfil y configuración"})})]})})},VP=()=>{const t=jn(),s=Xt(),[n,a]=f.useState(()=>localStorage.getItem("desktop-nav-expanded")==="true");f.useEffect(()=>{localStorage.setItem("desktop-nav-expanded",JSON.stringify(n)),document.documentElement.style.setProperty("--desktop-nav-width",n?"256px":"64px")},[n]);const r=({icon:o,label:l,path:c,onClick:m})=>{const u=t.pathname===c,h=e.jsxs(e.Fragment,{children:[e.jsx(o,{className:`w-5 h-5 flex-shrink-0 ${u?"text-white":"text-gray-600"}`}),n&&e.jsx("span",{className:`ml-3 font-medium truncate ${u?"text-white":"text-gray-700"}`,children:l})]}),p=`
      w-full flex items-center justify-start rounded-xl transition-colors duration-150
      ${n?"px-4 py-3":"p-3"} 
      ${u?"gradient-bg-primary text-white shadow-lg":"hover:bg-white/20"}
    `;return n?e.jsx(z,{variant:"ghost",className:p,onClick:()=>m?m():s(c),children:h}):e.jsx(xa,{children:e.jsxs(Ms,{delayDuration:0,children:[e.jsx(Is,{asChild:!0,children:e.jsx(z,{variant:"ghost",className:p,onClick:()=>m?m():s(c),children:h})}),e.jsx(ks,{side:"right",className:"bg-black text-white border-gray-700",children:e.jsx("p",{children:l})})]})})};return e.jsxs("aside",{className:`hidden md:flex flex-col h-screen fixed top-0 left-0 transition-all duration-300 glass-card z-50 border-r-0
      ${n?"w-64":"w-16"}`,children:[e.jsx("div",{className:`border-b border-white/20 ${n?"p-4":"p-1.5"}`,children:e.jsx(UP,{isExpanded:n,navigate:s})}),e.jsx("nav",{className:"flex-1 p-3 overflow-y-auto",children:e.jsx("div",{className:"space-y-1",children:sf.map(o=>e.jsx(r,{icon:o.icon,label:o.label,path:o.path},o.path))})}),e.jsx("div",{className:"p-3 border-t border-white/20",children:e.jsx(z,{variant:"ghost",size:"icon",title:"Expand/Collapse Menu",onClick:()=>a(!n),className:"w-full p-2 hover:bg-white/20 rounded-lg",children:e.jsx(rr,{className:`w-4 h-4 transform transition-transform duration-200 
            ${n?"rotate-180":""}`})})})]})},GP=vu,qP=yu,YP=gu,ej=f.forwardRef(({className:t,...s},n)=>e.jsx(zo,{className:ce("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s,ref:n}));ej.displayName=zo.displayName;const KP=Wo("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),tj=f.forwardRef(({side:t="right",className:s,children:n,...a},r)=>e.jsxs(YP,{children:[e.jsx(ej,{}),e.jsxs(Fo,{ref:r,className:ce(KP({side:t}),s),...a,children:[n,e.jsxs(gc,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[e.jsx(Ws,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));tj.displayName=Fo.displayName;const sj=({className:t,...s})=>e.jsx("div",{className:ce("flex flex-col space-y-2 text-center sm:text-left",t),...s});sj.displayName="SheetHeader";const nj=f.forwardRef(({className:t,...s},n)=>e.jsx(Bo,{ref:n,className:ce("text-lg font-semibold text-foreground",t),...s}));nj.displayName=Bo.displayName;const JP=f.forwardRef(({className:t,...s},n)=>e.jsx(Ho,{ref:n,className:ce("text-sm text-muted-foreground",t),...s}));JP.displayName=Ho.displayName;const XP=()=>{const t=jn(),s=Xt(),{signOut:n}=qe(),[a,r]=f.useState(!1),o=async()=>{try{r(!1),await n(),s("/login")}catch(h){console.error("Error al cerrar sesión:",h)}},l=sf.slice(0,4),c=sf.slice(4),m=[{icon:pb,label:"Agua +250ml",path:"/water",action:"quick-water"},{icon:wu,label:"Registrar Ánimo",path:"/mood",action:"quick-mood"},{icon:za,label:"Marcar Hábito",path:"/habit",action:"quick-habit"},{icon:Yd,label:"Nueva Tarea",path:"/task",action:"quick-task"},{icon:Ro,label:"Resumen Hoy",path:"/stats",action:"quick-stats"}],u=({icon:h,label:p,path:g,onClick:x})=>{const b=t.pathname===g;return e.jsxs(z,{variant:"ghost",className:`flex flex-col items-center justify-center h-auto px-2 py-2 text-xs rounded-xl transition-all duration-300 active:scale-95 touch-manipulation
          ${b?"text-blue-600 bg-blue-50 shadow-sm scale-105":"text-gray-600 hover:text-blue-600 hover:bg-blue-50/50 hover:scale-105"}`,onClick:()=>{x?x():s(g),r(!1)},children:[e.jsx(h,{className:`w-5 h-5 sm:w-6 sm:h-6 ${b?"animate-pulse":""}`}),e.jsx("span",{className:"mt-1 font-medium leading-tight",children:p})]})};return e.jsx("div",{className:"md:hidden",children:e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-md border-t border-gray-200 z-30 shadow-lg",children:e.jsxs("nav",{className:"flex justify-around items-center px-1 py-1 max-w-screen-sm mx-auto",children:[l.map(h=>e.jsx(u,{icon:h.icon,label:h.label,path:h.path},h.path)),e.jsxs(GP,{open:a,onOpenChange:r,children:[e.jsx(qP,{asChild:!0,children:e.jsxs(z,{variant:"ghost",className:`flex flex-col items-center justify-center h-auto px-2 py-2 text-xs rounded-xl transition-all duration-300 active:scale-95 touch-manipulation
                  ${a?"text-blue-600 bg-blue-50 scale-105":"text-gray-600 hover:bg-blue-50/50 hover:scale-105"}`,children:[e.jsx(_n,{className:`w-5 h-5 sm:w-6 sm:h-6 transform transition-transform duration-300
                  ${a?"rotate-180":""}`}),e.jsx("span",{className:"mt-1 font-medium leading-tight",children:"Más"})]})}),e.jsxs(tj,{side:"bottom",className:"rounded-t-2xl bg-white/95 backdrop-blur-md border-t border-gray-200 max-w-screen-sm mx-auto",children:[e.jsx(sj,{className:"mb-4",children:e.jsx(nj,{className:"text-center text-lg font-semibold text-gray-800",children:"Más opciones"})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-3 px-2",children:"Acceso Rápido"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 px-2",children:m.map(h=>e.jsxs(z,{variant:"outline",className:"flex items-center gap-2 h-auto p-3 text-left justify-start bg-gradient-to-r from-blue-50 to-purple-50 hover:from-blue-100 hover:to-purple-100 border-blue-200",onClick:()=>{s(h.path),r(!1)},children:[e.jsx(h.icon,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:h.label})]},h.action))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-3 px-2",children:"Todas las Opciones"}),e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-3 p-2",children:c.map(h=>e.jsx(u,{icon:h.icon,label:h.label,path:h.path,onClick:h.path==="/logout"?o:void 0},h.path))})]})]})]})]})})})},ZP=()=>{const{shouldShowDesktopNav:t}=Sc(),s=!t;return e.jsx(e.Fragment,{children:s?e.jsx(XP,{}):e.jsx(VP,{})})},QP=()=>{const{canInstall:t,promptInstall:s,isInstalled:n}=W_(),[a,r]=f.useState(!1),[o,l]=f.useState(!1);f.useEffect(()=>{if(t&&!n&&!o){const u=setTimeout(()=>{r(!0)},1e4);return()=>clearTimeout(u)}},[t,n,o]);const c=async()=>{await s()&&r(!1)},m=()=>{r(!1),l(!0),sessionStorage.setItem("pwa-install-dismissed","true")};return n||!t||!a||sessionStorage.getItem("pwa-install-dismissed")?null:e.jsx("div",{className:"fixed bottom-20 left-4 right-4 md:left-auto md:right-4 md:w-80 bg-white rounded-lg shadow-lg border border-gray-200 p-4 z-50 animate-in slide-in-from-bottom-5",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(ta,{className:"w-5 h-5 text-blue-600"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-sm",children:"Instalar Life Tracker"}),e.jsx("p",{className:"text-gray-600 text-xs mt-1",children:"Instala la app para un acceso más rápido y funciones offline."}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx(z,{size:"sm",onClick:c,className:"text-xs px-3 py-1 h-auto",children:"Instalar"}),e.jsx(z,{variant:"ghost",size:"sm",onClick:m,className:"text-xs px-3 py-1 h-auto",children:"Ahora no"})]})]}),e.jsx(z,{variant:"ghost",size:"sm",onClick:m,className:"flex-shrink-0 p-1 h-auto w-auto",children:e.jsx(Ws,{className:"w-4 h-4"})})]})})},eM=()=>{const[t,s]=f.useState(navigator.onLine),[n,a]=f.useState(!1),[r,o]=f.useState(!1);f.useEffect(()=>{const c=()=>{s(!0),a(!1)},m=()=>{s(!1),a(!0),setTimeout(()=>a(!1),5e3)},u=()=>{o(!0)};return window.addEventListener("online",c),window.addEventListener("offline",m),"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",h=>{h.data&&h.data.type==="SKIP_WAITING"&&u()}),()=>{window.removeEventListener("online",c),window.removeEventListener("offline",m)}},[]);const l=()=>{"serviceWorker"in navigator&&navigator.serviceWorker.getRegistration().then(c=>{c&&c.waiting&&(c.waiting.postMessage({type:"SKIP_WAITING"}),window.location.reload())})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed top-4 right-4 z-50",children:!t&&e.jsxs("div",{className:"flex items-center gap-1 bg-orange-100 text-orange-800 px-2 py-1 rounded-full text-xs",children:[e.jsx(Hh,{className:"w-3 h-3"}),e.jsx("span",{children:"Offline"})]})}),n&&e.jsxs("div",{className:"fixed top-16 left-4 right-4 md:left-auto md:right-4 md:w-80 bg-orange-50 border border-orange-200 rounded-lg p-3 z-50 animate-in slide-in-from-top-5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Hh,{className:"w-4 h-4 text-orange-600"}),e.jsx("span",{className:"text-orange-800 text-sm font-medium",children:"Sin conexión"})]}),e.jsx("p",{className:"text-orange-700 text-xs mt-1",children:"Trabajando en modo offline. Los datos se sincronizarán cuando vuelvas a conectarte."})]}),r&&e.jsxs("div",{className:"fixed top-16 left-4 right-4 md:left-auto md:right-4 md:w-80 bg-blue-50 border border-blue-200 rounded-lg p-3 z-50 animate-in slide-in-from-top-5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(yc,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-blue-800 text-sm font-medium",children:"Actualización disponible"})]}),e.jsx("p",{className:"text-blue-700 text-xs mt-1",children:"Hay una nueva versión disponible."}),e.jsx(z,{size:"sm",onClick:l,className:"mt-2 text-xs px-3 py-1 h-auto",children:"Actualizar"})]})]})},tM=({children:t})=>{const{isMobile:s}=Sc(),[n,a]=f.useState(0),[r,o]=f.useState(!1);return f.useEffect(()=>{if(!s)return;let l=0,c=0,m=!0;const u=g=>{l=g.touches[0].clientY,m=window.scrollY===0},h=g=>{if(!m)return;c=g.touches[0].clientY;const x=c-l;x>0&&x<150&&(o(!0),a(x),g.preventDefault())},p=()=>{r&&n>100&&window.location.reload(),o(!1),a(0)};return document.addEventListener("touchstart",u,{passive:!1}),document.addEventListener("touchmove",h,{passive:!1}),document.addEventListener("touchend",p),()=>{document.removeEventListener("touchstart",u),document.removeEventListener("touchmove",h),document.removeEventListener("touchend",p)}},[s,r,n]),s?e.jsxs("div",{className:"relative",children:[r&&e.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 bg-blue-500 text-white text-center py-2 text-sm transition-transform duration-200",style:{transform:`translateY(${Math.min(n-50,0)}px)`,opacity:n/100},children:n>100?"¡Suelta para actualizar!":"Tira hacia abajo para actualizar"}),t]}):e.jsx(e.Fragment,{children:t})},Va=()=>{const[t,s]=f.useState(typeof navigator<"u"?navigator.onLine:!0);return f.useEffect(()=>{const n=()=>s(!0),a=()=>s(!1);return window.addEventListener("online",n),window.addEventListener("offline",a),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",a)}},[]),{isOnline:t}},dr=t=>f.useCallback(async()=>{await cb(fe),await lR(fe)},[t]),Ui=class Ui{constructor(){ht(this,"writes",[]);ht(this,"alertThreshold",50);ht(this,"monitoringWindow",5*60*1e3);this.startMonitoring()}static getInstance(){return Ui.instance||(Ui.instance=new Ui),Ui.instance}logWrite(s,n,a,r){}checkForExcessiveWrites(){const s=this.writes.filter(n=>n.timestamp>new Date(Date.now()-this.monitoringWindow));if(s.length>this.alertThreshold){console.warn(`🚨 ALERTA: ${s.length} escrituras en los últimos 5 minutos`);const n=this.groupBy(s,"source");console.warn("📊 Escrituras por fuente:",Object.entries(n).map(([r,o])=>({source:r,count:o.length})).sort((r,o)=>o.count-r.count));const a=this.groupBy(s,"collection");console.warn("📊 Escrituras por colección:",Object.entries(a).map(([r,o])=>({collection:r,count:o.length})).sort((r,o)=>o.count-r.count)),this.detectPatterns(s)}}detectPatterns(s){const n=new Map;s.forEach(a=>{const r=`${a.collection}/${a.documentId||"unknown"}`;n.has(r)||n.set(r,[]),n.get(r).push(a)}),n.forEach((a,r)=>{if(a.length>10){console.warn(`🔥 PATRÓN SOSPECHOSO: ${a.length} escrituras a ${r}:`);const o=this.groupBy(a,"source");Object.entries(o).forEach(([l,c])=>{if(c.length>5){console.warn(`  - ${l}: ${c.length} escrituras`);const m=c.map(h=>h.timestamp.getTime()).sort(),u=[];for(let h=1;h<m.length;h++)u.push(m[h]-m[h-1]);if(u.length>0){const h=u.reduce((p,g)=>p+g,0)/u.length;console.warn(`    Intervalo promedio: ${Math.round(h/1e3)}s`),h<6e4&&console.error(`    ⚠️ ESCRITURAS MUY FRECUENTES: cada ${Math.round(h/1e3)}s`)}}})}})}groupBy(s,n){return s.reduce((a,r)=>{const o=String(r[n]);return a[o]=a[o]||[],a[o].push(r),a},{})}startMonitoring(){}generateReport(){if(this.writes.length===0)return;console.group("📈 Reporte de Escrituras Firestore (últimos 5 min)");const s=this.writes.filter(n=>n.timestamp>new Date(Date.now()-this.monitoringWindow));if(console.log(`Total de escrituras: ${s.length}`),s.length>0){const n=s.length/5;console.log(`Tasa: ${n.toFixed(1)} escrituras/minuto`),n>10&&console.warn("🚨 Tasa de escrituras muy alta")}console.groupEnd()}getStats(){const s=this.writes.filter(n=>n.timestamp>new Date(Date.now()-this.monitoringWindow));return{totalWrites:s.length,ratePerMinute:s.length/5,bySource:this.groupBy(s,"source"),byCollection:this.groupBy(s,"collection")}}clear(){this.writes=[]}};ht(Ui,"instance");let nf=Ui;nf.getInstance();const Vi=class Vi{constructor(){ht(this,"operations",[]);ht(this,"isEnabled");this.isEnabled=!1}static getInstance(){return Vi.instance||(Vi.instance=new Vi),Vi.instance}logRead(s,n,a){if(!this.isEnabled)return;const r={type:"read",collection:s,documentId:a,timestamp:new Date,source:n};this.operations.push(r),console.log(`🔍 [Firestore Read] ${s}${a?`/${a}`:""} from ${n}`,r)}logWrite(s,n,a){if(!this.isEnabled)return;const r={type:"write",collection:s,documentId:a,timestamp:new Date,source:n};this.operations.push(r),console.log(`✏️ [Firestore Write] ${s}${a?`/${a}`:""} from ${n}`,r)}logDelete(s,n,a){if(!this.isEnabled)return;const r={type:"delete",collection:s,documentId:a,timestamp:new Date,source:n};this.operations.push(r),console.log(`🗑️ [Firestore Delete] ${s}${a?`/${a}`:""} from ${n}`,r)}getOperations(){return[...this.operations]}getOperationsBySource(s){return this.operations.filter(n=>n.source===s)}getOperationsByCollection(s){return this.operations.filter(n=>n.collection===s)}getOperationsSummary(){const s={};return this.operations.forEach(n=>{const a=`${n.type}-${n.collection}`;s[a]=(s[a]||0)+1}),s}logSummary(){if(!this.isEnabled)return;const s=this.getOperationsSummary();console.group("📊 Firestore Operations Summary"),Object.entries(s).forEach(([n,a])=>{console.log(`${n}: ${a} operations`)}),console.groupEnd()}clear(){this.operations=[]}};ht(Vi,"instance");let af=Vi;const Me=af.getInstance(),sM={lessThanXSeconds:{one:"menos de un segundo",other:"menos de {{count}} segundos"},xSeconds:{one:"1 segundo",other:"{{count}} segundos"},halfAMinute:"medio minuto",lessThanXMinutes:{one:"menos de un minuto",other:"menos de {{count}} minutos"},xMinutes:{one:"1 minuto",other:"{{count}} minutos"},aboutXHours:{one:"alrededor de 1 hora",other:"alrededor de {{count}} horas"},xHours:{one:"1 hora",other:"{{count}} horas"},xDays:{one:"1 día",other:"{{count}} días"},aboutXWeeks:{one:"alrededor de 1 semana",other:"alrededor de {{count}} semanas"},xWeeks:{one:"1 semana",other:"{{count}} semanas"},aboutXMonths:{one:"alrededor de 1 mes",other:"alrededor de {{count}} meses"},xMonths:{one:"1 mes",other:"{{count}} meses"},aboutXYears:{one:"alrededor de 1 año",other:"alrededor de {{count}} años"},xYears:{one:"1 año",other:"{{count}} años"},overXYears:{one:"más de 1 año",other:"más de {{count}} años"},almostXYears:{one:"casi 1 año",other:"casi {{count}} años"}},nM=(t,s,n)=>{let a;const r=sM[t];return typeof r=="string"?a=r:s===1?a=r.one:a=r.other.replace("{{count}}",s.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"en "+a:"hace "+a:a},aM={full:"EEEE, d 'de' MMMM 'de' y",long:"d 'de' MMMM 'de' y",medium:"d MMM y",short:"dd/MM/y"},rM={full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},iM={full:"{{date}} 'a las' {{time}}",long:"{{date}} 'a las' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},oM={date:ch({formats:aM,defaultWidth:"full"}),time:ch({formats:rM,defaultWidth:"full"}),dateTime:ch({formats:iM,defaultWidth:"full"})},lM={lastWeek:"'el' eeee 'pasado a la' p",yesterday:"'ayer a la' p",today:"'hoy a la' p",tomorrow:"'mañana a la' p",nextWeek:"eeee 'a la' p",other:"P"},cM={lastWeek:"'el' eeee 'pasado a las' p",yesterday:"'ayer a las' p",today:"'hoy a las' p",tomorrow:"'mañana a las' p",nextWeek:"eeee 'a las' p",other:"P"},dM=(t,s,n,a)=>s.getHours()!==1?cM[t]:lM[t],uM={narrow:["AC","DC"],abbreviated:["AC","DC"],wide:["antes de cristo","después de cristo"]},mM={narrow:["1","2","3","4"],abbreviated:["T1","T2","T3","T4"],wide:["1º trimestre","2º trimestre","3º trimestre","4º trimestre"]},hM={narrow:["e","f","m","a","m","j","j","a","s","o","n","d"],abbreviated:["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"],wide:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"]},fM={narrow:["d","l","m","m","j","v","s"],short:["do","lu","ma","mi","ju","vi","sá"],abbreviated:["dom","lun","mar","mié","jue","vie","sáb"],wide:["domingo","lunes","martes","miércoles","jueves","viernes","sábado"]},pM={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"mañana",afternoon:"tarde",evening:"tarde",night:"noche"},abbreviated:{am:"AM",pm:"PM",midnight:"medianoche",noon:"mediodia",morning:"mañana",afternoon:"tarde",evening:"tarde",night:"noche"},wide:{am:"a.m.",pm:"p.m.",midnight:"medianoche",noon:"mediodia",morning:"mañana",afternoon:"tarde",evening:"tarde",night:"noche"}},xM={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"de la mañana",afternoon:"de la tarde",evening:"de la tarde",night:"de la noche"},abbreviated:{am:"AM",pm:"PM",midnight:"medianoche",noon:"mediodia",morning:"de la mañana",afternoon:"de la tarde",evening:"de la tarde",night:"de la noche"},wide:{am:"a.m.",pm:"p.m.",midnight:"medianoche",noon:"mediodia",morning:"de la mañana",afternoon:"de la tarde",evening:"de la tarde",night:"de la noche"}},gM=(t,s)=>Number(t)+"º",vM={ordinalNumber:gM,era:Nl({values:uM,defaultWidth:"wide"}),quarter:Nl({values:mM,defaultWidth:"wide",argumentCallback:t=>Number(t)-1}),month:Nl({values:hM,defaultWidth:"wide"}),day:Nl({values:fM,defaultWidth:"wide"}),dayPeriod:Nl({values:pM,defaultWidth:"wide",formattingValues:xM,defaultFormattingWidth:"wide"})},yM=/^(\d+)(º)?/i,bM=/\d+/i,jM={narrow:/^(ac|dc|a|d)/i,abbreviated:/^(a\.?\s?c\.?|a\.?\s?e\.?\s?c\.?|d\.?\s?c\.?|e\.?\s?c\.?)/i,wide:/^(antes de cristo|antes de la era com[uú]n|despu[eé]s de cristo|era com[uú]n)/i},wM={any:[/^ac/i,/^dc/i],wide:[/^(antes de cristo|antes de la era com[uú]n)/i,/^(despu[eé]s de cristo|era com[uú]n)/i]},NM={narrow:/^[1234]/i,abbreviated:/^T[1234]/i,wide:/^[1234](º)? trimestre/i},SM={any:[/1/i,/2/i,/3/i,/4/i]},CM={narrow:/^[efmajsond]/i,abbreviated:/^(ene|feb|mar|abr|may|jun|jul|ago|sep|oct|nov|dic)/i,wide:/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre)/i},EM={narrow:[/^e/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^en/i,/^feb/i,/^mar/i,/^abr/i,/^may/i,/^jun/i,/^jul/i,/^ago/i,/^sep/i,/^oct/i,/^nov/i,/^dic/i]},TM={narrow:/^[dlmjvs]/i,short:/^(do|lu|ma|mi|ju|vi|s[áa])/i,abbreviated:/^(dom|lun|mar|mi[ée]|jue|vie|s[áa]b)/i,wide:/^(domingo|lunes|martes|mi[ée]rcoles|jueves|viernes|s[áa]bado)/i},DM={narrow:[/^d/i,/^l/i,/^m/i,/^m/i,/^j/i,/^v/i,/^s/i],any:[/^do/i,/^lu/i,/^ma/i,/^mi/i,/^ju/i,/^vi/i,/^sa/i]},kM={narrow:/^(a|p|mn|md|(de la|a las) (mañana|tarde|noche))/i,any:/^([ap]\.?\s?m\.?|medianoche|mediodia|(de la|a las) (mañana|tarde|noche))/i},AM={any:{am:/^a/i,pm:/^p/i,midnight:/^mn/i,noon:/^md/i,morning:/mañana/i,afternoon:/tarde/i,evening:/tarde/i,night:/noche/i}},RM={ordinalNumber:FA({matchPattern:yM,parsePattern:bM,valueCallback:function(t){return parseInt(t,10)}}),era:Sl({matchPatterns:jM,defaultMatchWidth:"wide",parsePatterns:wM,defaultParseWidth:"any"}),quarter:Sl({matchPatterns:NM,defaultMatchWidth:"wide",parsePatterns:SM,defaultParseWidth:"any",valueCallback:t=>t+1}),month:Sl({matchPatterns:CM,defaultMatchWidth:"wide",parsePatterns:EM,defaultParseWidth:"any"}),day:Sl({matchPatterns:TM,defaultMatchWidth:"wide",parsePatterns:DM,defaultParseWidth:"any"}),dayPeriod:Sl({matchPatterns:kM,defaultMatchWidth:"any",parsePatterns:AM,defaultParseWidth:"any"})},kn={code:"es",formatDistance:nM,formatLong:oM,formatRelative:dM,localize:vM,match:RM,options:{weekStartsOn:1,firstWeekContainsDate:1}},$e=(t=new Date)=>{const s=new Date(t.getTime());return s.setHours(0,0,0,0),s.toISOString().split("T")[0]},Ia=t=>{const s=new Date(t);return s.setHours(12,0,0,0),s},Zd=t=>{const s=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],n=t.getDate(),a=s[t.getMonth()],r=t.getFullYear();let o=t.getHours();const l=t.getMinutes().toString().padStart(2,"0"),c=t.getSeconds().toString().padStart(2,"0"),m=o>=12?"p.m.":"a.m.";o=o%12,o=o||12;const u=-t.getTimezoneOffset(),h=Math.abs(Math.floor(u/60)),p=u>=0?"+":"-";return`${n} de ${a} de ${r}, ${o}:${l}:${c} ${m} UTC${p}${h}`},cn=(t,s,n)=>{const a=new Date(t);return a.setHours(s,n,0,0),{timestamp:a.getTime(),utcOffset:-a.getTimezoneOffset(),formatted:Zd(a)}},_M=(t=new Date,s="daily",n=1)=>{const a=cs(t);switch(s){case"daily":return es(a,1);case"weekly":return sc(a,1);case"monthly":return $a(a,1);case"custom":return es(a,n);default:return a}},aj=(t,s,n)=>{const a=at(t,"'próximo' EEEE",{locale:kn});switch(s){case"daily":return`Diariamente (${a})`;case"weekly":return`Semanalmente (${a})`;case"monthly":return`Mensualmente (${at(t,"'próximo' d 'de' MMMM",{locale:kn})})`;case"custom":return`Cada ${n} día${n!==1?"s":""} (${a})`;default:return""}},rf=t=>{const s=t.getTimezoneOffset();return new Date(t.getTime()-s*60*1e3).toISOString().split("T")[0]},PM=t=>at(t,"EEEE, d 'de' MMMM 'de' yyyy",{locale:kn}),MM=t=>Array.from({length:12},(s,n)=>({name:new Date(t,n).toLocaleString("es",{month:"short"}),days:new Date(t,n+1,0).getDate(),number:n+1})),IM=(t,s)=>{const n=new Date(t);return n.setDate(n.getDate()-s),n},mc=(t,s,n)=>{if(!s)return;if(!t){const o=new Date(n);return o.setHours(o.getHours()+1),o}const a=s.getTime()-t.getTime();if(a<=0){const o=new Date(n);return o.setHours(o.getHours()+1),o}const r=new Date(n.getTime()+a);return r.getTime()<=n.getTime()&&r.setMinutes(r.getMinutes()+30),r},OM=(t,s=50,n=30)=>t/s*n,LM=(t,s=new Date,n=6)=>{const a=OM(t),r=new Date(s);return r.setHours(n,0,0,0),r.setMinutes(a),r},$M=(t,s=15)=>{const n=t.getMinutes(),a=Math.round(n/s)*s,r=new Date(t);return r.setMinutes(a,0,0),r},rj=t=>{const[s,n]=f.useState(null),[a,r]=f.useState("idle"),[o,l]=f.useState(null),{user:c}=qe(),m=$e(t||new Date),u=async()=>{if(c)try{Me.logRead("pomodoro","usePomodoroData.loadData",`${c.uid}_${m}`);const j=Te(fe,"pomodoro",`${c.uid}_${m}`),v=await st(j);if(v.exists()){const w=v.data(),N=Array.isArray(w.sessions)?w.sessions:[],S=N.filter(E=>E.completed).length;n({...w,sessions:N,count:S}),r("saved")}else n({userId:c.uid,date:m,count:0,sessions:[],updatedAt:null}),r("idle")}catch(j){console.error("Pomodoro - Error loading data:",j),l(j instanceof Error?j.message:"Error loading pomodoro data"),r("error")}};f.useEffect(()=>{u()},[c,m]);const h=async(j={})=>{var v;if(!(!c||!s)){r("saving"),l(null);try{const w=t||new Date,N=new Date,S=cn(w,N.getHours(),N.getMinutes()),E=new Date(N.getTime()-30*60*1e3),T=cn(w,E.getHours(),E.getMinutes()),k={startTime:{timestamp:T.timestamp,utcOffset:T.utcOffset,formatted:T.formatted},endTime:{timestamp:S.timestamp,utcOffset:S.utcOffset,formatted:S.formatted},duration:30*60,completed:!0};(v=j.description)!=null&&v.trim()&&(k.description=j.description.trim());const D=[...s.sessions,k].sort((R,M)=>M.startTime.timestamp-R.startTime.timestamp),{activePomodoro:P,..._}=s,B={..._,count:D.filter(R=>R.completed).length,sessions:D,updatedAt:dt()},I=Te(fe,"pomodoro",`${c.uid}_${m}`);Me.logWrite("pomodoro","usePomodoroData.addManualSession",`${c.uid}_${m}`),await qt(I,B),await u()}catch(w){console.error("Pomodoro - Error al agregar sesión manual:",w),l(w instanceof Error?w.message:"Error al guardar"),r("error")}}},p=async(j,v,w={})=>{var N;if(!(!c||!s)){r("saving"),l(null);try{const S=t||new Date,E=new Date,T=cn(S,E.getHours(),E.getMinutes()),k=new Date(E.getTime()-j*1e3),D=cn(S,k.getHours(),k.getMinutes()),P={startTime:{timestamp:D.timestamp,utcOffset:D.utcOffset,formatted:D.formatted},endTime:{timestamp:T.timestamp,utcOffset:T.utcOffset,formatted:T.formatted},duration:j,completed:v};(N=w.description)!=null&&N.trim()&&(P.description=w.description.trim());const _=[...s.sessions,P],B=_.filter(H=>H.completed).length,{activePomodoro:I,...R}=s,M={...R,count:B,sessions:_,updatedAt:dt()},W=Te(fe,"pomodoro",`${c.uid}_${m}`);Me.logWrite("pomodoro","usePomodoroData.saveSession",`${c.uid}_${m}`),await qt(W,M),await u()}catch(S){console.error("Pomodoro - Error al guardar:",S),l(S instanceof Error?S.message:"Error al guardar"),r("error")}}},g=async j=>{if(!(!c||!s)){r("saving"),l(null);try{const v=s.sessions.filter(T=>T.startTime.timestamp!==j.startTime.timestamp),{activePomodoro:w,...N}=s,S={...N,count:v.filter(T=>T.completed).length,sessions:v,updatedAt:dt()},E=Te(fe,"pomodoro",`${c.uid}_${m}`);await qt(E,S)}catch(v){console.error("Pomodoro - Error al eliminar sesión:",v),l(v instanceof Error?v.message:"Error al eliminar"),r("error")}}},x=async(j,v)=>{if(!(!c||!s)){r("saving"),l(null);try{const w=new Date(j.startTime.timestamp);let N=j.startTime,S=j.endTime;if(v.startTime){const P=new Date(v.startTime.timestamp),_=cn(w,P.getHours(),P.getMinutes());N={timestamp:_.timestamp,utcOffset:_.utcOffset,formatted:_.formatted}}if(v.endTime){const P=new Date(v.endTime.timestamp),_=cn(w,P.getHours(),P.getMinutes());S={timestamp:_.timestamp,utcOffset:_.utcOffset,formatted:_.formatted}}const E=(S.timestamp-N.timestamp)/1e3,T=s.sessions.map(P=>{var _;return P.startTime.timestamp===j.startTime.timestamp?{...P,startTime:N,endTime:S,duration:E,completed:v.completed??P.completed,...(_=v.description)!=null&&_.trim()?{description:v.description.trim()}:{}}:P}),k={...s,count:T.filter(P=>P.completed).length,sessions:T,updatedAt:dt()},D=Te(fe,"pomodoro",`${c.uid}_${m}`);await qt(D,k),await u()}catch(w){console.error("Pomodoro - Error al editar sesión:",w),l(w instanceof Error?w.message:"Error al editar"),r("error")}}},b=dr("Pomodoro data");return{count:(s==null?void 0:s.count)??0,sessions:(s==null?void 0:s.sessions)??[],status:a,error:o,saveSession:p,deleteSession:g,editSession:x,addManualSession:h,loadPomodoroData:u,resync:b}},Qf=()=>{const[t,s]=f.useState("default"),[n,a]=f.useState({enabled:!1,sound:!0,vibration:!0}),r=f.useRef(null),o=f.useRef(),l=f.useCallback(()=>"Notification"in window,[]),c=f.useCallback(async()=>{if(!l())return!1;try{const x=await Notification.requestPermission();return s(x),x==="granted"}catch(x){return console.error("Error requesting notification permission:",x),!1}},[]),m=f.useCallback(async(x,b)=>{if(!(!l()||t!=="granted"))try{if("serviceWorker"in navigator){const v=await navigator.serviceWorker.getRegistration();if(v){await v.showNotification(x,{icon:"/icon-192x192.png",silent:!n.sound,...b});return}}const j=new Notification(x,{icon:"/icon-192x192.png",silent:!n.sound,...b});j.onclick=()=>{window.focus(),j.close()}}catch(j){console.error("Error sending notification:",j)}},[t,n,l]),u=f.useCallback(async(x,b)=>{var j;if(!(!l()||t!=="granted"))try{if("serviceWorker"in navigator){const w=await navigator.serviceWorker.getRegistration();if(w){await w.showNotification(x,{body:b,icon:"/icon-192x192.png",silent:!n.sound,requireInteraction:!0,tag:"pomodoro-active"});return}}(j=r.current)==null||j.close();const v=new Notification(x,{body:b,icon:"/icon-192x192.png",silent:!n.sound,requireInteraction:!0,tag:"pomodoro-active"});v.onclick=()=>{window.focus(),v.close()},r.current=v}catch(v){console.error("Error sending persistent notification:",v)}},[t,n,l]),h=f.useCallback((x,b,j=6e4)=>{u(x,b()),o.current&&clearInterval(o.current),o.current=window.setInterval(()=>{u(x,b())},j)},[u]),p=f.useCallback(async()=>{if(o.current&&(clearInterval(o.current),o.current=void 0),r.current&&(r.current.close(),r.current=null),"serviceWorker"in navigator)try{const x=await navigator.serviceWorker.getRegistration();x&&(await x.getNotifications({tag:"pomodoro-active"})).forEach(j=>j.close())}catch(x){console.error("Error closing persistent notification:",x)}},[]);f.useEffect(()=>{const x=localStorage.getItem("pomodoroNotificationPrefs");if(x)try{a(JSON.parse(x))}catch{console.warn("Invalid pomodoro prefs in storage")}l()&&s(Notification.permission)},[]);const g=f.useCallback(x=>{a(b=>{const j={...b,...x};return localStorage.setItem("pomodoroNotificationPrefs",JSON.stringify(j)),j})},[]);return{supported:l(),permission:t,preferences:n,requestPermission:c,sendNotification:m,updatePreferences:g,startPersistentNotification:h,stopPersistentNotification:p}},Q0=30*60,Hi="active-pomodoro-timer",ij=()=>{const[t,s]=f.useState(0),[n,a]=f.useState(!1),r=f.useRef(),o=f.useRef(!1),l=f.useRef(null),{preferences:c,permission:m,sendNotification:u}=Qf(),h=()=>{try{const N=localStorage.getItem(Hi);if(!N)return null;const S=JSON.parse(N);return(Date.now()-S.startTime)/1e3>=S.duration?(localStorage.removeItem(Hi),null):S}catch(N){return console.error("Error reading pomodoro timer from localStorage:",N),localStorage.removeItem(Hi),null}},p=N=>Math.floor((Date.now()-N)/1e3),g=N=>{const S=Math.floor(N/60),E=Math.floor(N%60);return`${S<10?"0":""}${S}:${E<10?"0":""}${E}`},x=()=>{if(c.sound)try{const N=new(window.AudioContext||window.webkitAudioContext),S=N.createOscillator(),E=N.createGain();S.connect(E),E.connect(N.destination),S.frequency.setValueAtTime(880,N.currentTime),S.frequency.setValueAtTime(660,N.currentTime+.1),S.frequency.setValueAtTime(523,N.currentTime+.2),E.gain.setValueAtTime(.3,N.currentTime),E.gain.exponentialRampToValueAtTime(.01,N.currentTime+.8),S.start(N.currentTime),S.stop(N.currentTime+.8),setTimeout(()=>{N.close()},1e3)}catch(N){console.warn("No se pudo reproducir el sonido de finalización:",N)}},b=()=>{o.current||(o.current=!0,l.current&&(console.log("Notificando completación a usePomodoroTimer..."),l.current(Q0)),x(),c.enabled&&m==="granted"&&u("¡Pomodoro completado! 🎉",{body:"Has completado exitosamente tu sesión de concentración",requireInteraction:!0}),setTimeout(()=>{localStorage.removeItem(Hi),a(!1),s(0),o.current=!1},500))};f.useEffect(()=>{const N=h();N&&(a(!0),s(p(N.startTime)))},[]),f.useEffect(()=>(n?r.current=setInterval(()=>{const N=h();if(N){const S=p(N.startTime);s(S),S>=N.duration&&b()}else a(!1),s(0)},1e3):r.current&&clearInterval(r.current),()=>{r.current&&clearInterval(r.current)}),[n]);const j=N=>{l.current=N},v=()=>{const N={startTime:Date.now(),duration:Q0,isActive:!0};localStorage.setItem(Hi,JSON.stringify(N)),a(!0),s(0),o.current=!1},w=()=>{localStorage.removeItem(Hi),a(!1),s(0),o.current=!1};return f.useEffect(()=>{const N=S=>{if(S.key===Hi){const E=h();E?(a(!0),s(p(E.startTime))):(a(!1),s(0))}};return window.addEventListener("storage",N),()=>window.removeEventListener("storage",N)},[]),{time:t,isActive:n,formattedTime:g(t),startTimer:v,stopTimer:w,setOnCompletion:j}},zM=()=>{const t=jn(),s=Xt(),{isOnline:n}=Va(),r=rj().status,{isActive:o,formattedTime:l}=ij(),{supported:c,permission:m,preferences:u,requestPermission:h,sendNotification:p,updatePreferences:g}=Qf(),x=T=>({"/":"Inicio","/water":"Hidratación","/exercise":"Ejercicio","/habit":"Hábitos","/mood":"Estado de Ánimo","/journal":"Diario","/pomodoro":"Pomodoro","/meal":"Comidas","/task":"Tareas","/kanban":"Kanban","/stats":"Estadísticas","/negative":"Hábitos Negativos","/settings":"Configuración"})[T]||"Life Tracker",b=o,j=()=>({idle:"Inactivo",saving:"Guardando...",pending:"Pendiente",saved:"Sincronizado",error:"Error"})[r]||"Sincronizado",v=()=>{switch(r){case"saving":case"pending":return e.jsx("div",{className:"w-3 h-3 border border-white border-t-transparent rounded-full animate-spin"});case"error":return e.jsx(yc,{className:"w-3 h-3"});default:return e.jsx(za,{className:"w-3 h-3"})}},w=async()=>{c&&(m==="default"?await h()&&(g({enabled:!0}),p("🔔 Notificaciones activadas",{body:"Recibirás notificaciones cuando terminen los Pomodoros",requireInteraction:!1})):m==="granted"&&p("🧪 Prueba de notificación",{body:"Las notificaciones están funcionando correctamente",requireInteraction:!1}))},N=()=>{g({sound:!u.sound})},E=c?m==="denied"?{icon:$d,tooltip:"Notificaciones bloqueadas",color:"text-red-400"}:m==="default"?{icon:Wh,tooltip:"Click para activar notificaciones",color:"text-yellow-400"}:u.enabled?{icon:Wh,tooltip:"Notificaciones activadas",color:"text-green-400"}:{icon:$d,tooltip:"Notificaciones desactivadas",color:"text-gray-400"}:{icon:$d,tooltip:"Notificaciones no soportadas",color:"text-gray-500"};return e.jsxs("footer",{className:"hidden md:flex w-full h-6 bg-[#007ACC] text-white text-xs items-center justify-between px-4 border-t border-[#005a9e] select-none",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"flex items-center space-x-1",children:n?e.jsxs(e.Fragment,{children:[e.jsx(hR,{className:"w-3 h-3"}),e.jsx("span",{children:"En línea"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Hh,{className:"w-3 h-3"}),e.jsx("span",{children:"Sin conexión"})]})}),e.jsxs("div",{className:"flex items-center space-x-1",children:[v(),e.jsx("span",{children:j()})]})]}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsx("div",{className:"flex items-center space-x-1",children:e.jsx("span",{className:"font-medium",children:x(t.pathname)})})}),e.jsxs("div",{className:"flex items-center space-x-4",children:[b&&e.jsxs("button",{type:"button",onClick:()=>s("/pomodoro"),className:"flex items-center space-x-2 bg-[#005a9e] px-2 py-1 rounded hover:bg-[#007ACC] transition-colors",children:[e.jsx(Ji,{className:"w-3 h-3"}),e.jsx("span",{className:"font-mono",children:l}),e.jsx("span",{className:"text-xs",children:"Transcurrido"})]}),!b&&e.jsxs("button",{type:"button",onClick:()=>s("/pomodoro"),className:"flex items-center space-x-1 hover:bg-[#005a9e] px-2 py-1 rounded transition-colors",children:[e.jsx(Ji,{className:"w-3 h-3"}),e.jsx("span",{children:"Pomodoro"})]}),c&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("button",{type:"button",onClick:w,className:"flex items-center space-x-1 hover:bg-[#005a9e] px-1 py-0.5 rounded transition-colors group",title:E.tooltip,children:e.jsx(E.icon,{className:`w-3 h-3 ${E.color}`})}),m==="granted"&&e.jsx("button",{type:"button",onClick:N,className:"flex items-center hover:bg-[#005a9e] px-1 py-0.5 rounded transition-colors",title:u.sound?"Sonido activado":"Sonido desactivado",children:u.sound?e.jsx(fR,{className:"w-3 h-3 text-green-400"}):e.jsx(pR,{className:"w-3 h-3 text-gray-400"})})]}),e.jsx("div",{className:"flex items-center space-x-1",children:e.jsx("span",{className:"text-[#87CEEB]",children:"Life Tracker v1.0"})})]})]})};var ev=["light","dark"],FM="(prefers-color-scheme: dark)",BM=f.createContext(void 0),HM={setTheme:t=>{},themes:[]},WM=()=>{var t;return(t=f.useContext(BM))!=null?t:HM};f.memo(({forcedTheme:t,storageKey:s,attribute:n,enableSystem:a,enableColorScheme:r,defaultTheme:o,value:l,attrs:c,nonce:m})=>{let u=o==="system",h=n==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${c.map(b=>`'${b}'`).join(",")})`};`:`var d=document.documentElement,n='${n}',s='setAttribute';`,p=r?ev.includes(o)&&o?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${o}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",g=(b,j=!1,v=!0)=>{let w=l?l[b]:b,N=j?b+"|| ''":`'${w}'`,S="";return r&&v&&!j&&ev.includes(b)&&(S+=`d.style.colorScheme = '${b}';`),n==="class"?j||w?S+=`c.add(${N})`:S+="null":w&&(S+=`d[s](n,${N})`),S},x=t?`!function(){${h}${g(t)}}()`:a?`!function(){try{${h}var e=localStorage.getItem('${s}');if('system'===e||(!e&&${u})){var t='${FM}',m=window.matchMedia(t);if(m.media!==t||m.matches){${g("dark")}}else{${g("light")}}}else if(e){${l?`var x=${JSON.stringify(l)};`:""}${g(l?"x[e]":"e",!0)}}${u?"":"else{"+g(o,!1,!1)+"}"}${p}}catch(e){}}()`:`!function(){try{${h}var e=localStorage.getItem('${s}');if(e){${l?`var x=${JSON.stringify(l)};`:""}${g(l?"x[e]":"e",!0)}}else{${g(o,!1,!1)};}${p}}catch(t){}}();`;return f.createElement("script",{nonce:m,dangerouslySetInnerHTML:{__html:x}})});var UM=t=>{switch(t){case"success":return qM;case"info":return KM;case"warning":return YM;case"error":return JM;default:return null}},VM=Array(12).fill(0),GM=({visible:t,className:s})=>Z.createElement("div",{className:["sonner-loading-wrapper",s].filter(Boolean).join(" "),"data-visible":t},Z.createElement("div",{className:"sonner-spinner"},VM.map((n,a)=>Z.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${a}`})))),qM=Z.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Z.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),YM=Z.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},Z.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),KM=Z.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Z.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),JM=Z.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},Z.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),XM=Z.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},Z.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),Z.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),ZM=()=>{let[t,s]=Z.useState(document.hidden);return Z.useEffect(()=>{let n=()=>{s(document.hidden)};return document.addEventListener("visibilitychange",n),()=>window.removeEventListener("visibilitychange",n)},[]),t},of=1,QM=class{constructor(){this.subscribe=t=>(this.subscribers.push(t),()=>{let s=this.subscribers.indexOf(t);this.subscribers.splice(s,1)}),this.publish=t=>{this.subscribers.forEach(s=>s(t))},this.addToast=t=>{this.publish(t),this.toasts=[...this.toasts,t]},this.create=t=>{var s;let{message:n,...a}=t,r=typeof(t==null?void 0:t.id)=="number"||((s=t.id)==null?void 0:s.length)>0?t.id:of++,o=this.toasts.find(c=>c.id===r),l=t.dismissible===void 0?!0:t.dismissible;return this.dismissedToasts.has(r)&&this.dismissedToasts.delete(r),o?this.toasts=this.toasts.map(c=>c.id===r?(this.publish({...c,...t,id:r,title:n}),{...c,...t,id:r,dismissible:l,title:n}):c):this.addToast({title:n,...a,dismissible:l,id:r}),r},this.dismiss=t=>(this.dismissedToasts.add(t),t||this.toasts.forEach(s=>{this.subscribers.forEach(n=>n({id:s.id,dismiss:!0}))}),this.subscribers.forEach(s=>s({id:t,dismiss:!0})),t),this.message=(t,s)=>this.create({...s,message:t}),this.error=(t,s)=>this.create({...s,message:t,type:"error"}),this.success=(t,s)=>this.create({...s,type:"success",message:t}),this.info=(t,s)=>this.create({...s,type:"info",message:t}),this.warning=(t,s)=>this.create({...s,type:"warning",message:t}),this.loading=(t,s)=>this.create({...s,type:"loading",message:t}),this.promise=(t,s)=>{if(!s)return;let n;s.loading!==void 0&&(n=this.create({...s,promise:t,type:"loading",message:s.loading,description:typeof s.description!="function"?s.description:void 0}));let a=t instanceof Promise?t:t(),r=n!==void 0,o,l=a.then(async m=>{if(o=["resolve",m],Z.isValidElement(m))r=!1,this.create({id:n,type:"default",message:m});else if(tI(m)&&!m.ok){r=!1;let u=typeof s.error=="function"?await s.error(`HTTP error! status: ${m.status}`):s.error,h=typeof s.description=="function"?await s.description(`HTTP error! status: ${m.status}`):s.description;this.create({id:n,type:"error",message:u,description:h})}else if(s.success!==void 0){r=!1;let u=typeof s.success=="function"?await s.success(m):s.success,h=typeof s.description=="function"?await s.description(m):s.description;this.create({id:n,type:"success",message:u,description:h})}}).catch(async m=>{if(o=["reject",m],s.error!==void 0){r=!1;let u=typeof s.error=="function"?await s.error(m):s.error,h=typeof s.description=="function"?await s.description(m):s.description;this.create({id:n,type:"error",message:u,description:h})}}).finally(()=>{var m;r&&(this.dismiss(n),n=void 0),(m=s.finally)==null||m.call(s)}),c=()=>new Promise((m,u)=>l.then(()=>o[0]==="reject"?u(o[1]):m(o[1])).catch(u));return typeof n!="string"&&typeof n!="number"?{unwrap:c}:Object.assign(n,{unwrap:c})},this.custom=(t,s)=>{let n=(s==null?void 0:s.id)||of++;return this.create({jsx:t(n),id:n,...s}),n},this.getActiveToasts=()=>this.toasts.filter(t=>!this.dismissedToasts.has(t.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},Bn=new QM,eI=(t,s)=>{let n=(s==null?void 0:s.id)||of++;return Bn.addToast({title:t,...s,id:n}),n},tI=t=>t&&typeof t=="object"&&"ok"in t&&typeof t.ok=="boolean"&&"status"in t&&typeof t.status=="number",sI=eI,nI=()=>Bn.toasts,aI=()=>Bn.getActiveToasts(),vt=Object.assign(sI,{success:Bn.success,info:Bn.info,warning:Bn.warning,error:Bn.error,custom:Bn.custom,message:Bn.message,promise:Bn.promise,dismiss:Bn.dismiss,loading:Bn.loading},{getHistory:nI,getToasts:aI});function rI(t,{insertAt:s}={}){if(typeof document>"u")return;let n=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css",s==="top"&&n.firstChild?n.insertBefore(a,n.firstChild):n.appendChild(a),a.styleSheet?a.styleSheet.cssText=t:a.appendChild(document.createTextNode(t))}rI(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function kd(t){return t.label!==void 0}var iI=3,oI="32px",lI="16px",tv=4e3,cI=356,dI=14,uI=20,mI=200;function Da(...t){return t.filter(Boolean).join(" ")}function hI(t){let[s,n]=t.split("-"),a=[];return s&&a.push(s),n&&a.push(n),a}var fI=t=>{var s,n,a,r,o,l,c,m,u,h,p;let{invert:g,toast:x,unstyled:b,interacting:j,setHeights:v,visibleToasts:w,heights:N,index:S,toasts:E,expanded:T,removeToast:k,defaultRichColors:D,closeButton:P,style:_,cancelButtonStyle:B,actionButtonStyle:I,className:R="",descriptionClassName:M="",duration:W,position:H,gap:L,loadingIcon:$,expandByDefault:q,classNames:re,icons:Y,closeButtonAriaLabel:se="Close toast",pauseWhenPageIsHidden:ie}=t,[U,ee]=Z.useState(null),[me,ue]=Z.useState(null),[ae,ge]=Z.useState(!1),[je,we]=Z.useState(!1),[ke,de]=Z.useState(!1),[J,ve]=Z.useState(!1),[ft,pt]=Z.useState(!1),[ot,zs]=Z.useState(0),[gs,G]=Z.useState(0),te=Z.useRef(x.duration||W||tv),le=Z.useRef(null),Ce=Z.useRef(null),Se=S===0,be=S+1<=w,Re=x.type,Ve=x.dismissible!==!1,Qe=x.className||"",Yt=x.descriptionClassName||"",Cs=Z.useMemo(()=>N.findIndex(Ae=>Ae.toastId===x.id)||0,[N,x.id]),Ut=Z.useMemo(()=>{var Ae;return(Ae=x.closeButton)!=null?Ae:P},[x.closeButton,P]),Us=Z.useMemo(()=>x.duration||W||tv,[x.duration,W]),Fs=Z.useRef(0),ss=Z.useRef(0),Rs=Z.useRef(0),Es=Z.useRef(null),[Nn,We]=H.split("-"),lt=Z.useMemo(()=>N.reduce((Ae,Oe,Ye)=>Ye>=Cs?Ae:Ae+Oe.height,0),[N,Cs]),yt=ZM(),Ft=x.invert||g,Ue=Re==="loading";ss.current=Z.useMemo(()=>Cs*L+lt,[Cs,lt]),Z.useEffect(()=>{te.current=Us},[Us]),Z.useEffect(()=>{ge(!0)},[]),Z.useEffect(()=>{let Ae=Ce.current;if(Ae){let Oe=Ae.getBoundingClientRect().height;return G(Oe),v(Ye=>[{toastId:x.id,height:Oe,position:x.position},...Ye]),()=>v(Ye=>Ye.filter(Et=>Et.toastId!==x.id))}},[v,x.id]),Z.useLayoutEffect(()=>{if(!ae)return;let Ae=Ce.current,Oe=Ae.style.height;Ae.style.height="auto";let Ye=Ae.getBoundingClientRect().height;Ae.style.height=Oe,G(Ye),v(Et=>Et.find(It=>It.toastId===x.id)?Et.map(It=>It.toastId===x.id?{...It,height:Ye}:It):[{toastId:x.id,height:Ye,position:x.position},...Et])},[ae,x.title,x.description,v,x.id]);let ut=Z.useCallback(()=>{we(!0),zs(ss.current),v(Ae=>Ae.filter(Oe=>Oe.toastId!==x.id)),setTimeout(()=>{k(x)},mI)},[x,k,v,ss]);Z.useEffect(()=>{if(x.promise&&Re==="loading"||x.duration===1/0||x.type==="loading")return;let Ae;return T||j||ie&&yt?(()=>{if(Rs.current<Fs.current){let Oe=new Date().getTime()-Fs.current;te.current=te.current-Oe}Rs.current=new Date().getTime()})():te.current!==1/0&&(Fs.current=new Date().getTime(),Ae=setTimeout(()=>{var Oe;(Oe=x.onAutoClose)==null||Oe.call(x,x),ut()},te.current)),()=>clearTimeout(Ae)},[T,j,x,Re,ie,yt,ut]),Z.useEffect(()=>{x.delete&&ut()},[ut,x.delete]);function Mt(){var Ae,Oe,Ye;return Y!=null&&Y.loading?Z.createElement("div",{className:Da(re==null?void 0:re.loader,(Ae=x==null?void 0:x.classNames)==null?void 0:Ae.loader,"sonner-loader"),"data-visible":Re==="loading"},Y.loading):$?Z.createElement("div",{className:Da(re==null?void 0:re.loader,(Oe=x==null?void 0:x.classNames)==null?void 0:Oe.loader,"sonner-loader"),"data-visible":Re==="loading"},$):Z.createElement(GM,{className:Da(re==null?void 0:re.loader,(Ye=x==null?void 0:x.classNames)==null?void 0:Ye.loader),visible:Re==="loading"})}return Z.createElement("li",{tabIndex:0,ref:Ce,className:Da(R,Qe,re==null?void 0:re.toast,(s=x==null?void 0:x.classNames)==null?void 0:s.toast,re==null?void 0:re.default,re==null?void 0:re[Re],(n=x==null?void 0:x.classNames)==null?void 0:n[Re]),"data-sonner-toast":"","data-rich-colors":(a=x.richColors)!=null?a:D,"data-styled":!(x.jsx||x.unstyled||b),"data-mounted":ae,"data-promise":!!x.promise,"data-swiped":ft,"data-removed":je,"data-visible":be,"data-y-position":Nn,"data-x-position":We,"data-index":S,"data-front":Se,"data-swiping":ke,"data-dismissible":Ve,"data-type":Re,"data-invert":Ft,"data-swipe-out":J,"data-swipe-direction":me,"data-expanded":!!(T||q&&ae),style:{"--index":S,"--toasts-before":S,"--z-index":E.length-S,"--offset":`${je?ot:ss.current}px`,"--initial-height":q?"auto":`${gs}px`,..._,...x.style},onDragEnd:()=>{de(!1),ee(null),Es.current=null},onPointerDown:Ae=>{Ue||!Ve||(le.current=new Date,zs(ss.current),Ae.target.setPointerCapture(Ae.pointerId),Ae.target.tagName!=="BUTTON"&&(de(!0),Es.current={x:Ae.clientX,y:Ae.clientY}))},onPointerUp:()=>{var Ae,Oe,Ye,Et;if(J||!Ve)return;Es.current=null;let It=Number(((Ae=Ce.current)==null?void 0:Ae.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),Tt=Number(((Oe=Ce.current)==null?void 0:Oe.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),ds=new Date().getTime()-((Ye=le.current)==null?void 0:Ye.getTime()),us=U==="x"?It:Tt,Bt=Math.abs(us)/ds;if(Math.abs(us)>=uI||Bt>.11){zs(ss.current),(Et=x.onDismiss)==null||Et.call(x,x),ue(U==="x"?It>0?"right":"left":Tt>0?"down":"up"),ut(),ve(!0),pt(!1);return}de(!1),ee(null)},onPointerMove:Ae=>{var Oe,Ye,Et,It;if(!Es.current||!Ve||((Oe=window.getSelection())==null?void 0:Oe.toString().length)>0)return;let Tt=Ae.clientY-Es.current.y,ds=Ae.clientX-Es.current.x,us=(Ye=t.swipeDirections)!=null?Ye:hI(H);!U&&(Math.abs(ds)>1||Math.abs(Tt)>1)&&ee(Math.abs(ds)>Math.abs(Tt)?"x":"y");let Bt={x:0,y:0};U==="y"?(us.includes("top")||us.includes("bottom"))&&(us.includes("top")&&Tt<0||us.includes("bottom")&&Tt>0)&&(Bt.y=Tt):U==="x"&&(us.includes("left")||us.includes("right"))&&(us.includes("left")&&ds<0||us.includes("right")&&ds>0)&&(Bt.x=ds),(Math.abs(Bt.x)>0||Math.abs(Bt.y)>0)&&pt(!0),(Et=Ce.current)==null||Et.style.setProperty("--swipe-amount-x",`${Bt.x}px`),(It=Ce.current)==null||It.style.setProperty("--swipe-amount-y",`${Bt.y}px`)}},Ut&&!x.jsx?Z.createElement("button",{"aria-label":se,"data-disabled":Ue,"data-close-button":!0,onClick:Ue||!Ve?()=>{}:()=>{var Ae;ut(),(Ae=x.onDismiss)==null||Ae.call(x,x)},className:Da(re==null?void 0:re.closeButton,(r=x==null?void 0:x.classNames)==null?void 0:r.closeButton)},(o=Y==null?void 0:Y.close)!=null?o:XM):null,x.jsx||f.isValidElement(x.title)?x.jsx?x.jsx:typeof x.title=="function"?x.title():x.title:Z.createElement(Z.Fragment,null,Re||x.icon||x.promise?Z.createElement("div",{"data-icon":"",className:Da(re==null?void 0:re.icon,(l=x==null?void 0:x.classNames)==null?void 0:l.icon)},x.promise||x.type==="loading"&&!x.icon?x.icon||Mt():null,x.type!=="loading"?x.icon||(Y==null?void 0:Y[Re])||UM(Re):null):null,Z.createElement("div",{"data-content":"",className:Da(re==null?void 0:re.content,(c=x==null?void 0:x.classNames)==null?void 0:c.content)},Z.createElement("div",{"data-title":"",className:Da(re==null?void 0:re.title,(m=x==null?void 0:x.classNames)==null?void 0:m.title)},typeof x.title=="function"?x.title():x.title),x.description?Z.createElement("div",{"data-description":"",className:Da(M,Yt,re==null?void 0:re.description,(u=x==null?void 0:x.classNames)==null?void 0:u.description)},typeof x.description=="function"?x.description():x.description):null),f.isValidElement(x.cancel)?x.cancel:x.cancel&&kd(x.cancel)?Z.createElement("button",{"data-button":!0,"data-cancel":!0,style:x.cancelButtonStyle||B,onClick:Ae=>{var Oe,Ye;kd(x.cancel)&&Ve&&((Ye=(Oe=x.cancel).onClick)==null||Ye.call(Oe,Ae),ut())},className:Da(re==null?void 0:re.cancelButton,(h=x==null?void 0:x.classNames)==null?void 0:h.cancelButton)},x.cancel.label):null,f.isValidElement(x.action)?x.action:x.action&&kd(x.action)?Z.createElement("button",{"data-button":!0,"data-action":!0,style:x.actionButtonStyle||I,onClick:Ae=>{var Oe,Ye;kd(x.action)&&((Ye=(Oe=x.action).onClick)==null||Ye.call(Oe,Ae),!Ae.defaultPrevented&&ut())},className:Da(re==null?void 0:re.actionButton,(p=x==null?void 0:x.classNames)==null?void 0:p.actionButton)},x.action.label):null))};function sv(){if(typeof window>"u"||typeof document>"u")return"ltr";let t=document.documentElement.getAttribute("dir");return t==="auto"||!t?window.getComputedStyle(document.documentElement).direction:t}function pI(t,s){let n={};return[t,s].forEach((a,r)=>{let o=r===1,l=o?"--mobile-offset":"--offset",c=o?lI:oI;function m(u){["top","right","bottom","left"].forEach(h=>{n[`${l}-${h}`]=typeof u=="number"?`${u}px`:u})}typeof a=="number"||typeof a=="string"?m(a):typeof a=="object"?["top","right","bottom","left"].forEach(u=>{a[u]===void 0?n[`${l}-${u}`]=c:n[`${l}-${u}`]=typeof a[u]=="number"?`${a[u]}px`:a[u]}):m(c)}),n}var xI=f.forwardRef(function(t,s){let{invert:n,position:a="bottom-right",hotkey:r=["altKey","KeyT"],expand:o,closeButton:l,className:c,offset:m,mobileOffset:u,theme:h="light",richColors:p,duration:g,style:x,visibleToasts:b=iI,toastOptions:j,dir:v=sv(),gap:w=dI,loadingIcon:N,icons:S,containerAriaLabel:E="Notifications",pauseWhenPageIsHidden:T}=t,[k,D]=Z.useState([]),P=Z.useMemo(()=>Array.from(new Set([a].concat(k.filter(ie=>ie.position).map(ie=>ie.position)))),[k,a]),[_,B]=Z.useState([]),[I,R]=Z.useState(!1),[M,W]=Z.useState(!1),[H,L]=Z.useState(h!=="system"?h:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),$=Z.useRef(null),q=r.join("+").replace(/Key/g,"").replace(/Digit/g,""),re=Z.useRef(null),Y=Z.useRef(!1),se=Z.useCallback(ie=>{D(U=>{var ee;return(ee=U.find(me=>me.id===ie.id))!=null&&ee.delete||Bn.dismiss(ie.id),U.filter(({id:me})=>me!==ie.id)})},[]);return Z.useEffect(()=>Bn.subscribe(ie=>{if(ie.dismiss){D(U=>U.map(ee=>ee.id===ie.id?{...ee,delete:!0}:ee));return}setTimeout(()=>{$A.flushSync(()=>{D(U=>{let ee=U.findIndex(me=>me.id===ie.id);return ee!==-1?[...U.slice(0,ee),{...U[ee],...ie},...U.slice(ee+1)]:[ie,...U]})})})}),[]),Z.useEffect(()=>{if(h!=="system"){L(h);return}if(h==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?L("dark"):L("light")),typeof window>"u")return;let ie=window.matchMedia("(prefers-color-scheme: dark)");try{ie.addEventListener("change",({matches:U})=>{L(U?"dark":"light")})}catch{ie.addListener(({matches:ee})=>{try{L(ee?"dark":"light")}catch(me){console.error(me)}})}},[h]),Z.useEffect(()=>{k.length<=1&&R(!1)},[k]),Z.useEffect(()=>{let ie=U=>{var ee,me;r.every(ue=>U[ue]||U.code===ue)&&(R(!0),(ee=$.current)==null||ee.focus()),U.code==="Escape"&&(document.activeElement===$.current||(me=$.current)!=null&&me.contains(document.activeElement))&&R(!1)};return document.addEventListener("keydown",ie),()=>document.removeEventListener("keydown",ie)},[r]),Z.useEffect(()=>{if($.current)return()=>{re.current&&(re.current.focus({preventScroll:!0}),re.current=null,Y.current=!1)}},[$.current]),Z.createElement("section",{ref:s,"aria-label":`${E} ${q}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},P.map((ie,U)=>{var ee;let[me,ue]=ie.split("-");return k.length?Z.createElement("ol",{key:ie,dir:v==="auto"?sv():v,tabIndex:-1,ref:$,className:c,"data-sonner-toaster":!0,"data-theme":H,"data-y-position":me,"data-lifted":I&&k.length>1&&!o,"data-x-position":ue,style:{"--front-toast-height":`${((ee=_[0])==null?void 0:ee.height)||0}px`,"--width":`${cI}px`,"--gap":`${w}px`,...x,...pI(m,u)},onBlur:ae=>{Y.current&&!ae.currentTarget.contains(ae.relatedTarget)&&(Y.current=!1,re.current&&(re.current.focus({preventScroll:!0}),re.current=null))},onFocus:ae=>{ae.target instanceof HTMLElement&&ae.target.dataset.dismissible==="false"||Y.current||(Y.current=!0,re.current=ae.relatedTarget)},onMouseEnter:()=>R(!0),onMouseMove:()=>R(!0),onMouseLeave:()=>{M||R(!1)},onDragEnd:()=>R(!1),onPointerDown:ae=>{ae.target instanceof HTMLElement&&ae.target.dataset.dismissible==="false"||W(!0)},onPointerUp:()=>W(!1)},k.filter(ae=>!ae.position&&U===0||ae.position===ie).map((ae,ge)=>{var je,we;return Z.createElement(fI,{key:ae.id,icons:S,index:ge,toast:ae,defaultRichColors:p,duration:(je=j==null?void 0:j.duration)!=null?je:g,className:j==null?void 0:j.className,descriptionClassName:j==null?void 0:j.descriptionClassName,invert:n,visibleToasts:b,closeButton:(we=j==null?void 0:j.closeButton)!=null?we:l,interacting:M,position:ie,style:j==null?void 0:j.style,unstyled:j==null?void 0:j.unstyled,classNames:j==null?void 0:j.classNames,cancelButtonStyle:j==null?void 0:j.cancelButtonStyle,actionButtonStyle:j==null?void 0:j.actionButtonStyle,removeToast:se,toasts:k.filter(ke=>ke.position==ae.position),heights:_.filter(ke=>ke.position==ae.position),setHeights:B,expandByDefault:o,gap:w,loadingIcon:N,expanded:I,pauseWhenPageIsHidden:T,swipeDirections:t.swipeDirections})})):null}))});const gI=({...t})=>{const{theme:s="system"}=WM();return e.jsx(xI,{theme:s,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...t})},vI=()=>e.jsx(tM,{children:e.jsxs("div",{className:"flex h-screen bg-gray-50 overflow-hidden",children:[e.jsx(ZP,{}),e.jsxs("div",{className:"flex-1 flex flex-col main-content-adaptive overflow-hidden",children:[e.jsx("div",{className:"pt-0 flex-1 flex flex-col overflow-hidden",children:e.jsx("main",{className:"flex-1 overflow-auto scroll-container",children:e.jsx(C_,{})})}),e.jsx(zM,{}),e.jsx("div",{className:"pb-16 md:pb-0"})]}),e.jsx(eM,{}),e.jsx(QP,{}),e.jsx(gI,{})]})}),yI=()=>{const{user:t,signIn:s,signOut:n}=qe();return e.jsx("div",{className:"flex items-center gap-4",children:t?e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-sm",children:t.email}),e.jsx(z,{variant:"outline",onClick:n,children:"Cerrar sesión"})]}):e.jsx(z,{onClick:s,children:"Iniciar sesión con Google"})})},or=({selectedDate:t,onChange:s})=>{const[n,a]=f.useState(!1);f.useEffect(()=>{const u=()=>{a(window.innerWidth<768)};return u(),window.addEventListener("resize",u),()=>window.removeEventListener("resize",u)},[]);const r=()=>{const u=new Date(t);u.setDate(u.getDate()-1),s(u)},o=()=>{const u=new Date(t);u.setDate(u.getDate()+1),s(u)},l=()=>{s(new Date)},c=u=>n?u.toLocaleDateString("es-ES",{weekday:"short",month:"short",day:"numeric"}):u.toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),m=u=>{const h=new Date;return u.toDateString()===h.toDateString()};return e.jsx("div",{className:"bg-white/95 backdrop-blur-sm border border-gray-200 rounded-2xl p-4 mb-6 shadow-sm md:p-6 md:mb-8",children:e.jsxs("div",{className:"flex items-center justify-between gap-2 md:gap-4",children:[e.jsx(z,{variant:"outline",size:"icon",onClick:r,className:"rounded-full border-2 bg-white/80 w-8 h-8 md:w-10 md:h-10 touch-manipulation active:scale-95 transition-transform",children:e.jsx(Bf,{className:"w-3 h-3 md:w-4 md:h-4"})}),e.jsxs("div",{className:"flex-1 text-center",children:[e.jsx("h2",{className:"text-sm md:text-xl font-semibold bg-gradient-to-r from-gray-700 to-gray-900 bg-clip-text text-transparent capitalize",children:c(t)}),!m(t)&&e.jsxs(z,{variant:"ghost",className:"text-xs md:text-sm mt-1 md:mt-2 rounded-full h-6 md:h-auto px-2 md:px-4 touch-manipulation active:scale-95 transition-transform",onClick:l,children:[e.jsx(ns,{className:"w-3 h-3 md:w-4 md:h-4 mr-1 md:mr-2"}),e.jsx("span",{className:"hidden md:inline",children:"Ir a hoy"}),e.jsx("span",{className:"md:hidden",children:"Hoy"})]}),m(t)&&e.jsx("div",{className:"inline-flex items-center px-2 md:px-3 py-1 mt-1 md:mt-2 rounded-full bg-green-100 text-green-800 text-xs font-medium",children:"Hoy"})]}),e.jsx(z,{variant:"outline",size:"icon",onClick:o,className:"rounded-full border-2 bg-white/80 w-8 h-8 md:w-10 md:h-10 touch-manipulation active:scale-95 transition-transform",children:e.jsx(rr,{className:"w-3 h-3 md:w-4 md:h-4"})})]})})},Xs=({children:t,className:s,fullHeight:n=!1,noPadding:a=!1,showFloatingButton:r=!1,onFloatingButtonClick:o,floatingButtonLabel:l="Agregar"})=>a?e.jsxs("div",{className:ce("h-full",s),children:[t,r&&e.jsx(z,{onClick:o,className:"fixed bottom-20 right-6 h-14 w-14 rounded-full shadow-lg hover:shadow-xl transition-shadow z-50 md:hidden",size:"icon",title:l,children:e.jsx(as,{className:"h-6 w-6"})})]}):e.jsxs("div",{className:ce(n?"h-full flex flex-col":"min-h-full","px-3 sm:px-4 md:px-6 lg:px-8 xl:px-12 2xl:px-16","pt-4 md:pt-6 lg:pt-8","pb-4 md:pb-6 lg:pb-8",s),children:[e.jsx("div",{className:ce(n?"flex-1 flex flex-col":"","space-y-4 sm:space-y-6 md:space-y-8 lg:space-y-10","max-w-screen-2xl mx-auto w-full","container-wide"),children:t}),r&&e.jsx(z,{onClick:o,className:"fixed bottom-20 right-6 h-14 w-14 rounded-full shadow-lg hover:shadow-xl transition-shadow z-50 md:hidden",size:"icon",title:l,children:e.jsx(as,{className:"h-6 w-6"})})]}),bI=()=>(f.useEffect(()=>{const s=n=>{Xd(n.reason)&&(console.error("Unhandled Firestore internal error:",n.reason),vt.error("Error de sincronización detectado",{description:"Hay un problema con la sincronización offline. Puedes intentar limpiar el cache.",action:{label:"Limpiar Cache",onClick:async()=>{try{await Jd(),vt.success("Cache limpiado correctamente")}catch(a){console.error("Error clearing cache:",a),vt.error("Error al limpiar el cache. Recarga la página manualmente.")}}},duration:1e4}),n.preventDefault())};return window.addEventListener("unhandledrejection",s),()=>{window.removeEventListener("unhandledrejection",s)}},[]),{handleFirestoreError:(s,n="Error de sincronización")=>Xd(s)?{isInternalError:!0,message:"Error de sincronización detectado. La operación puede haberse completado pero hay problemas con el cache local.",shouldShowClearCache:!0}:{isInternalError:!1,message:s instanceof Error?s.message:n,shouldShowClearCache:!1},clearOfflineCache:Jd}),oj=f.forwardRef(({className:t,variant:s="default",...n},a)=>{const r={default:"bg-card text-card-foreground border shadow-sm",glass:"glass-card text-card-foreground",gradient:"gradient-bg-primary text-white border-0 shadow-lg",elevated:"bg-card text-card-foreground border-0 shadow-lg hover:shadow-xl transition-shadow duration-300"};return e.jsx("div",{ref:a,className:ce("rounded-xl transition-all duration-300",r[s],t),...n})});oj.displayName="ModernCard";const jI=f.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:ce("flex flex-col space-y-1.5 p-6",t),...s}));jI.displayName="ModernCardHeader";const wI=f.forwardRef(({className:t,gradient:s,...n},a)=>e.jsx("h3",{ref:a,className:ce("text-2xl font-semibold leading-none tracking-tight",s&&"bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent",t),...n}));wI.displayName="ModernCardTitle";const NI=f.forwardRef(({className:t,...s},n)=>e.jsx("p",{ref:n,className:ce("text-sm text-muted-foreground",t),...s}));NI.displayName="ModernCardDescription";const SI=f.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:ce("p-6 pt-0",t),...s}));SI.displayName="ModernCardContent";const CI=f.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:ce("flex items-center p-6 pt-0",t),...s}));CI.displayName="ModernCardFooter";const ga=({title:t,icon:s,variant:n="compact",children:a,className:r,onClick:o,loading:l=!1,error:c})=>{const m=ce("transition-all duration-200",o&&"cursor-pointer hover:shadow-md hover:scale-[1.02]",r),u=ce("flex items-center gap-2 mb-2",n==="compact"&&"mb-1"),h=ce("space-y-2",n==="compact"&&"space-y-1",n==="chart"&&"space-y-3"),p={compact:"p-3",detailed:"p-4",chart:"p-4"};return e.jsx(oj,{className:m,variant:"default",onClick:o,children:e.jsxs("div",{className:p[n],children:[e.jsxs("div",{className:u,children:[e.jsx(s,{className:ce("text-blue-600",n==="compact"?"w-4 h-4":"w-5 h-5")}),e.jsx("h3",{className:ce("font-medium text-gray-800",n==="compact"?"text-sm":"text-base"),children:t})]}),l&&e.jsxs("div",{className:"animate-pulse space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]}),c&&e.jsxs("div",{className:"text-red-500 text-sm",children:["Error: ",c]}),!l&&!c&&e.jsx("div",{className:h,children:a})]})})},hc={water:"Agua",dairy:"Lácteos",caffeine:"Cafeína",hydration:"Hidratación",soda:"Gaseosas",alcohol:"Alcohol",other:"Otros"},Wn={water:{name:"Agua",icon:"Droplet",hydrationFactor:1,color:"text-blue-500",amounts:[100,200,300],category:"water"},sparklingWater:{name:"Agua con gas",icon:"Waves",hydrationFactor:1,color:"text-blue-400",amounts:[100,200,300],category:"water"},flavoredWater:{name:"Agua saborizada",icon:"Droplets",hydrationFactor:.95,color:"text-blue-300",amounts:[100,200,300],category:"water"},milk:{name:"Leche",icon:"Milk",hydrationFactor:.9,color:"text-blue-500",amounts:[100,200,300],category:"dairy"},chocolate:{name:"Chocolate",icon:"Milk",hydrationFactor:.8,color:"text-brown-500",amounts:[100,200,300],category:"dairy"},colagranulada:{name:"Cola Granulada",icon:"Milk",hydrationFactor:.9,color:"text-red-500",amounts:[100,200,300],category:"dairy"},ensure:{name:"Ensure / Pediasure",icon:"Milk",hydrationFactor:.9,color:"text-red-500",amounts:[100,200,300],category:"dairy"},yogurt:{name:"Yogurt",icon:"Milk",hydrationFactor:.6,color:"text-amber-600",amounts:[100,200,300],category:"dairy"},coffee:{name:"Café",icon:"Coffee",hydrationFactor:.8,color:"text-amber-800",amounts:[100,200,300],category:"caffeine"},energyDrink:{name:"Energizante",icon:"Zap",hydrationFactor:.6,color:"text-yellow-500",amounts:[100,250,500],category:"caffeine"},juice:{name:"Jugo",icon:"Cherry",hydrationFactor:.85,color:"text-orange-500",amounts:[100,200,300],category:"hydration"},sportsdrink:{name:"Bebida deportiva",icon:"Dumbbell",hydrationFactor:.9,color:"text-green-500",amounts:[250,500,750],category:"hydration"},soup:{name:"Sopa",icon:"Soup",hydrationFactor:.6,color:"text-orange-500",amounts:[200,400,600],category:"other"},soda:{name:"Gaseosa",icon:"CircleDot",hydrationFactor:.6,color:"text-purple-500",amounts:[200,350,500],category:"soda"},beer:{name:"Cerveza",icon:"Beer",hydrationFactor:.8,color:"text-yellow-600",amounts:[330,500,750],category:"alcohol"},aguardiente:{name:"Aguardiente",icon:"Beer",hydrationFactor:.2,color:"text-yellow-600",amounts:[50,100,200],category:"alcohol"},wine:{name:"Vino",icon:"Wine",hydrationFactor:.1,color:"text-red-600",amounts:[150,250,750],category:"alcohol"},aromatica:{name:"Aromática",icon:"Coffee",hydrationFactor:.95,color:"text-green-600",amounts:[100,200,300],category:"other"},iceCream:{name:"Helado",icon:"Cookie",hydrationFactor:.4,color:"text-cyan-400",amounts:[50,100,150],category:"other"},granizado:{name:"Granizado",icon:"Cookie",hydrationFactor:.8,color:"text-blue-300",amounts:[150,250,350],category:"hydration"},tea:{name:"Té",icon:"Coffee",hydrationFactor:.9,color:"text-green-500",amounts:[100,200,300],category:"caffeine"}},lj=t=>{const[s,n]=f.useState(0),[a,r]=f.useState([]),[o,l]=f.useState("idle"),[c,m]=f.useState(null),{user:u}=qe(),h=v=>v.reduce((w,N)=>w+N.hydration,0),p=async()=>{if(u){m(null);try{const v=$e(t);Me.logRead("water","useWaterData.loadData",`${u.uid}_${v}`);const w=Te(fe,"water",`${u.uid}_${v}`),N=await st(w);if(N.exists()){const E=N.data().drinks||[],T=h(E);n(T),r(E),l("saved")}else n(0),r([]),l("idle")}catch(v){console.error("Error loading water data:",v),m(v instanceof Error?v.message:"Error al cargar datos de hidratación"),l("error")}}};f.useEffect(()=>{p()},[u,t]);const g=async(v,w)=>{if(!u)return;l("saving"),m(null);const N=new Date,S=cn(t,N.getHours(),N.getMinutes()),E=w*Wn[v].hydrationFactor,T={type:v,amount:w,hydration:E,timestamp:S.timestamp.toString(),time:N.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit",hour12:!1})},k=[...a,T],D=h(k);r(k),n(D);try{const P=$e(t),_=Te(fe,"water",`${u.uid}_${P}`);Me.logWrite("water","useWaterData.addDrink",`${u.uid}_${P}`),await qt(_,{userId:u.uid,date:P,drinks:k,totalWater:D,updatedAt:dt()},{merge:!0}),l("saved")}catch(P){console.error("Error adding drink:",P),r(a),n(s),m(P instanceof Error?P.message:"Error al guardar"),l("error")}},x=async(v,w)=>{if(u){l("saving"),m(null);try{const N=$e(t),S=Te(fe,"water",`${u.uid}_${N}`),[E,T]=w.time.split(":").map(Number),k=cn(t,E,T),D={...w,timestamp:k.timestamp.toString(),hydration:w.amount*Wn[w.type].hydrationFactor},P=[...a];P[v]=D;const _=h(P);r(P),n(_),Me.logWrite("water","useWaterData.editDrink",`${u.uid}_${N}`),await qt(S,{userId:u.uid,date:N,drinks:P,totalWater:_,updatedAt:dt()},{merge:!0}),l("saved")}catch(N){console.error("Error editing drink:",N),r(a),n(s),m(N instanceof Error?N.message:"Error al editar"),l("error")}}},b=async v=>{if(!u)return;l("saving"),m(null);const w=a[v];try{const N=$e(t),S=Te(fe,"water",`${u.uid}_${N}`),E=a.filter((k,D)=>D!==v),T=h(E);r(E),n(T),Me.logWrite("water","useWaterData.deleteDrink",`${u.uid}_${N}`),await qt(S,{userId:u.uid,date:N,drinks:E,totalWater:T,updatedAt:dt()},{merge:!0}),l("saved")}catch(N){console.error("Error deleting drink:",N);const S=[...a];S.splice(v,0,w),r(S),n(h(S)),m(N instanceof Error?N.message:"Error al eliminar"),l("error")}},j=dr("Water data");return{intake:s,drinks:a,status:o,error:c,addDrink:g,editDrink:x,deleteDrink:b,loadWaterData:p,resync:j}},EI=({date:t,variant:s="compact"})=>{const n=Xt(),{intake:a,status:r,addDrink:o}=lj(t),l=r==="saving"||r==="pending",c=async x=>{x.stopPropagation(),await o("water",100)},m=async x=>{x.stopPropagation(),await o("water",300)},u=async x=>{x.stopPropagation(),await o("water",600)},h=a||0,p=2e3,g=Math.min(h/p*100,100);return e.jsx(ga,{title:"Hidratación",icon:pb,variant:s,loading:l,onClick:()=>n("/water"),children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-lg font-bold text-blue-600",children:[h,"ml"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["de ",p,"ml (",g.toFixed(0),"%)"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-1 min-w-0",children:[e.jsx(z,{size:"sm",variant:"outline",onClick:c,className:"px-1 py-1 text-xs bg-blue-50 hover:bg-blue-100 border-blue-200 min-w-0 flex-shrink-0",disabled:l,children:s==="detailed"?"100ml":"100"}),e.jsx(z,{size:"sm",variant:"outline",onClick:m,className:"px-1 py-1 text-xs bg-blue-50 hover:bg-blue-100 border-blue-200 min-w-0 flex-shrink-0",disabled:l,children:s==="detailed"?"300ml":"300"}),e.jsx(z,{size:"sm",variant:"outline",onClick:u,className:"px-1 py-1 text-xs bg-blue-50 hover:bg-blue-100 border-blue-200 min-w-0 flex-shrink-0",disabled:l,children:s==="detailed"?"600ml":"600"})]})]}),s==="detailed"&&e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${g}%`}})})]})})},Qd=t=>{const s=Yi.find(n=>n.text===t);return(s==null?void 0:s.value)??5},cj=t=>{if(t.length===0)return 0;const s=t.reduce((n,a)=>n+(a.value??Qd(a.text)),0);return Math.round(s/t.length*10)/10},Yi=[{emoji:"😍",text:"Enamorado",value:10},{emoji:"😊",text:"Feliz",value:10},{emoji:"🌟",text:"Energético",value:10},{emoji:"🧠",text:"Productivo",value:10},{emoji:"😎",text:"Confiado",value:9},{emoji:"😌",text:"Tranquilo",value:8},{emoji:"🤔",text:"Pensativo",value:6},{emoji:"🥱",text:"Aburrido",value:5},{emoji:"😴",text:"Pereza",value:4},{emoji:"😕",text:"Confundido",value:5},{emoji:"😬",text:"Nervioso",value:3},{emoji:"🤯",text:"Abrumado",value:3},{emoji:"😤",text:"Frustración",value:3},{emoji:"😰",text:"Ansioso",value:2},{emoji:"😪",text:"Cansado",value:2},{emoji:"😢",text:"Triste",value:1},{emoji:"😡",text:"Enojado",value:1},{emoji:"🤒",text:"Enfermo",value:1}],dj=t=>{const[s,n]=f.useState(null),[a,r]=f.useState("idle"),[o,l]=f.useState(null),{user:c}=qe(),m=async()=>{if(c)try{const x=$e(t);Me.logRead("moods","useMoodData.loadData",`${c.uid}_${x}`);const b=Te($t(fe,"moods"),`${c.uid}_${x}`),j=await st(b);if(j.exists()){const v=j.data();v&&Array.isArray(v.moods)?n(v):n({id:`${c.uid}_${x}`,userId:c.uid,date:x,moods:[]})}else n(null);r("saved")}catch(x){console.error("Error loading mood data:",x),l(x instanceof Error?x.message:"Error al cargar estado de ánimo"),r("error")}};f.useEffect(()=>{m()},[c,t]);const u=async x=>{if(!c)return;r("saving"),l(null);const b=$e(t),j=`${c.uid}_${b}`,v=Te($t(fe,"moods"),j),w=s;try{const N=new Date,S=cn(t,N.getHours(),N.getMinutes()),E={emoji:x.emoji,text:x.text,timestamp:S.timestamp,time:N.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}),value:Qd(x.text)},k=[...(s==null?void 0:s.moods)||[],E],D={id:j,userId:c.uid,date:b,moods:k};n(D),r("saved"),s?(Me.logWrite("moods","useMoodData.addMood.update",j),await qt(v,D)):(Me.logWrite("moods","useMoodData.addMood.create",j),await qt(v,D))}catch(N){n(w),console.error("Mood - Error al guardar:",N),l(N instanceof Error?N.message:"Error al guardar"),r("error")}},h=async(x,b)=>{if(!c||!s)return;r("saving"),l(null);const j=Te($t(fe,"moods"),s.id),v=s;try{const w=s.moods.map(S=>S.timestamp===x?b:S),N={...s,moods:w};n(N),r("saved"),Me.logWrite("moods","useMoodData.updateMood",s.id),await qt(j,N)}catch(w){n(v),console.error("Mood - Error al actualizar:",w),l(w instanceof Error?w.message:"Error al actualizar"),r("error")}},p=async x=>{if(!c||!s)return;r("saving"),l(null);const b=Te($t(fe,"moods"),s.id),j=s;try{const v=s.moods.filter(w=>w.timestamp!==x);if(v.length===0)n(null),r("saved"),Me.logDelete("moods","useMoodData.deleteMood.deleteDoc",s.id),await ao(b);else{const w={...s,moods:v};n(w),r("saved"),Me.logWrite("moods","useMoodData.deleteMood.update",s.id),await qt(b,w)}}catch(v){n(j),console.error("Mood - Error al eliminar:",v),l(v instanceof Error?v.message:"Error al eliminar"),r("error")}},g=dr("Mood data");return{moodHistory:(s==null?void 0:s.moods)||[],status:a,error:o,addMood:u,updateMood:h,deleteMood:p,loadMoodData:m,resync:g}},TI=({date:t,variant:s="compact"})=>{const n=Xt(),{moodHistory:a,status:r}=dj(t),o=r==="saving"||r==="pending",l=a||[],c=l.length,m=l.length>0?cj(l):0,u=l[l.length-1],h=p=>p>=8?"😊":p>=6?"🙂":p>=4?"😐":p>=2?"😔":"😢";return e.jsx(ga,{title:"Estado de Ánimo",icon:wu,variant:s,loading:o,onClick:()=>n("/mood"),children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:c>0?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:(u==null?void 0:u.emoji)||h(m)}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium",children:[m.toFixed(1),"/10"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[c," registro",c>1?"s":""]})]})]})}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"😐"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Sin registros"})]})}),e.jsxs(z,{size:"sm",variant:"outline",onClick:p=>{p.stopPropagation(),n("/mood")},className:"flex items-center gap-1",children:[e.jsx(as,{className:"w-3 h-3"}),s==="detailed"&&"Registrar"]})]}),s==="detailed"&&u&&e.jsxs("div",{className:"text-xs text-gray-600 p-2 bg-gray-50 rounded",children:[e.jsx("p",{className:"font-medium",children:"Último registro:"}),e.jsxs("p",{children:['"',u.text,'" - ',u.time]})]})]})})},ep=t=>{const{user:s}=qe(),[n,a]=f.useState({}),[r,o]=f.useState("idle"),[l,c]=f.useState(null),m=$e(t),[u,h]=m.split("-"),p=`${u}-${h}`;return f.useEffect(()=>{if(!s)return;(async()=>{try{o("pending"),c(null);const b=Te(fe,"habits",`${s.uid}_${p}`);Me.logRead("habits","useHabitDataDaily.loadDayData",`${s.uid}_${p}`);const j=await st(b);if(j.exists()){const v=j.data();a(v.habits||{}),o("saved")}else a({}),o("idle")}catch(b){console.error("Error loading daily habit data:",b),c(b instanceof Error?b.message:"Error loading habits"),o("error")}})()},[s,p]),{completedHabits:n,status:r,error:l,toggleHabit:async(x,b)=>{if(s){o("saving"),c(null);try{const[j,v]=b.split("-"),w=`${j}-${v}`,N=`${x}_${b}`,S=!n[N];a(T=>({...T,[N]:S}));const E=Te(fe,"habits",`${s.uid}_${w}`);await qt(E,{habits:{...n,[N]:S},updatedAt:dt()},{merge:!0}),Me.logWrite("habits","useHabitDataDaily.toggleHabit",`${s.uid}_${w}`),o("saved")}catch(j){console.error("Error toggling habit:",j),c(j instanceof Error?j.message:"Error updating habit"),o("error");const v=`${x}_${b}`;a(w=>({...w,[v]:!w[v]}))}}}}},Rn=[{id:1,name:"Tomar Agua (mañana)",icon:"💧",timeOfDay:"morning",goal:"5 min",steps:["Llenar un vaso con agua","Beber lentamente"]},{id:2,name:"Ejercicio",icon:"🎾",timeOfDay:"morning",goal:"40 min",steps:["Preparar el equipo","Hacer calentamiento","Realizar ejercicio principal","Hacer enfriamiento","Estirar músculos"]},{id:3,name:"Ducha fria",icon:"🚿",timeOfDay:"morning",goal:"10 min",steps:["Preparar toalla","Graduar temperatura del agua","Entrar lentamente","Respirar profundamente","Secar completamente"]},{id:4,name:"Desayuno",icon:"🍳",timeOfDay:"morning",goal:"30 min",steps:["Preparar ingredientes","Cocinar alimentos","Servir en plato","Comer sin distracciones","Lavar los platos"]},{id:5,name:"Lavarme los dientes",icon:"🪥",timeOfDay:"morning",goal:"2 min",steps:["Preparar cepillo y pasta","Cepillar durante 2 minutos","Enjuagar boca","Limpiar cepillo"]},{id:6,name:"Seda Dental",icon:"🦷",timeOfDay:"morning",goal:"2 min",steps:["Tomar hilo dental","Limpiar entre cada diente","Enjuagar boca","Guardar hilo dental"]},{id:7,name:"Tender la cama",icon:"🛏️",timeOfDay:"morning",goal:"3 min",steps:["Estirar sábanas","Acomodar almohadas","Doblar cobijas","Verificar que esté ordenada"]},{id:8,name:"Almuerzo",icon:"🍽️",timeOfDay:"afternoon",goal:"60 min",steps:["Planificar el menú","Preparar ingredientes","Cocinar platos","Servir comida","Comer tranquilamente","Lavar platos"]},{id:9,name:"Siesta",icon:"🛌",timeOfDay:"afternoon",goal:"15 min",steps:["Encontrar lugar cómodo","Cerrar ojos","Respirar profundamente","Relajarse completamente"]},{id:10,name:"Lavarme los dientes",icon:"🪥",timeOfDay:"afternoon",goal:"2 min",steps:["Preparar cepillo y pasta","Cepillar durante 2 minutos","Enjuagar boca","Limpiar cepillo"]},{id:11,name:"Seda Dental",icon:"🦷",timeOfDay:"afternoon",goal:"2 min",steps:["Tomar hilo dental","Limpiar entre cada diente","Enjuagar boca","Guardar hilo dental"]},{id:12,name:"Cena",icon:"🍽️",timeOfDay:"night",goal:"30 min",steps:["Elegir alimentos ligeros","Cocinar sin prisa","Cenar temprano","Lavar platos"]},{id:13,name:"Lavarme los dientes",icon:"🪥",timeOfDay:"night",goal:"2 min",steps:["Preparar cepillo y pasta","Cepillar durante 2 minutos","Enjuagar boca","Limpiar cepillo"]},{id:14,name:"Seda Dental",icon:"🦷",timeOfDay:"night",goal:"2 min",steps:["Tomar hilo dental","Limpiar entre cada diente","Enjuagar boca","Guardar hilo dental"]},{id:15,name:"Llevar el diario",icon:"📓",timeOfDay:"night",goal:"10 min",steps:["Abrir el diario","Reflexionar sobre el día","Escribir pensamientos","Cerrar y guardar"]},{id:16,name:"Botar algo que no sirva",icon:"🗑️",timeOfDay:"night",goal:"10 min",steps:["Buscar objetos innecesarios","Evaluar si sirven","Desechar responsablemente","Limpiar el área"]},{id:17,name:"Organizar la cocina",icon:"🍴",timeOfDay:"night",goal:"15 min",steps:["Lavar platos pendientes","Guardar utensilios","Limpiar superficies","Organizar despensa"]},{id:18,name:"Lectura",icon:"📚",timeOfDay:"night",goal:"5 min",steps:["Elegir libro","Encontrar lugar cómodo","Leer sin distracciones","Marcar página"]},{id:19,name:"Tomar agua (tarde)",icon:"💧",timeOfDay:"afternoon",goal:"5 min",steps:["Llenar un vaso con agua","Beber lentamente"]},{id:20,name:"Lavar loza del desayuno",icon:"🧽",timeOfDay:"morning",goal:"10 min",steps:["Fregar los platos","Enjuagar y secar"]},{id:21,name:"Lista de pendientes",icon:"📝",timeOfDay:"night",goal:"15 min",steps:["Revisar tareas pendientes","Priorizar actividades","Anotar nuevas tareas"]}],DI={1:"bg-blue-500",2:"bg-green-500",3:"bg-yellow-500",4:"bg-orange-500",5:"bg-purple-500",6:"bg-pink-500",7:"bg-red-500",8:"bg-teal-500",9:"bg-indigo-500",10:"bg-gray-500",11:"bg-lime-500",12:"bg-amber-500",13:"bg-cyan-500",14:"bg-fuchsia-500",15:"bg-rose-500",16:"bg-violet-500",17:"bg-sky-500",18:"bg-emerald-500",19:"bg-indigo-500"},kI=({date:t,variant:s="compact"})=>{const n=Xt(),{completedHabits:a,status:r,toggleHabit:o}=ep(t),l=r==="saving"||r==="pending",[c,m]=f.useState(!1),u=$e(t),h=Rn.length,p=Object.entries(a).filter(([v,w])=>v.endsWith(`_${u}`)&&w).length,g=h>0?p/h*100:0,b=Rn.find(v=>{const w=`${v.id}_${u}`;return!a[w]}),j=async()=>{if(b&&!c){m(!0);try{await o(b.id,u)}catch(v){console.error("Error toggling habit:",v)}finally{m(!1)}}};return e.jsx(ga,{title:"Hábitos",icon:za,variant:s,loading:l,onClick:()=>n("/habit"),children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-lg font-bold text-green-600",children:[p,"/",h]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[g.toFixed(0),"% completado"]})]}),b&&e.jsxs("button",{onClick:v=>{v.stopPropagation(),j()},disabled:c,className:"flex items-center gap-1 text-xs px-2 py-1 bg-green-50 hover:bg-green-100 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[c?e.jsx(ls,{className:"w-3 h-3 animate-spin"}):e.jsx(Hf,{className:"w-3 h-3"}),s==="detailed"?b.name:b.icon]})]}),s==="detailed"&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-300",style:{width:`${g}%`}})}),b&&e.jsxs("p",{className:"text-xs text-gray-600",children:["Siguiente: ",b.name]})]})]})})};/*! @license DOMPurify 3.2.6 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.6/LICENSE */const{entries:uj,setPrototypeOf:nv,isFrozen:AI,getPrototypeOf:RI,getOwnPropertyDescriptor:_I}=Object;let{freeze:Pn,seal:fa,create:mj}=Object,{apply:lf,construct:cf}=typeof Reflect<"u"&&Reflect;Pn||(Pn=function(s){return s});fa||(fa=function(s){return s});lf||(lf=function(s,n,a){return s.apply(n,a)});cf||(cf=function(s,n){return new s(...n)});const Ad=Mn(Array.prototype.forEach),PI=Mn(Array.prototype.lastIndexOf),av=Mn(Array.prototype.pop),Tl=Mn(Array.prototype.push),MI=Mn(Array.prototype.splice),zd=Mn(String.prototype.toLowerCase),ph=Mn(String.prototype.toString),rv=Mn(String.prototype.match),Dl=Mn(String.prototype.replace),II=Mn(String.prototype.indexOf),OI=Mn(String.prototype.trim),ka=Mn(Object.prototype.hasOwnProperty),Tn=Mn(RegExp.prototype.test),kl=LI(TypeError);function Mn(t){return function(s){s instanceof RegExp&&(s.lastIndex=0);for(var n=arguments.length,a=new Array(n>1?n-1:0),r=1;r<n;r++)a[r-1]=arguments[r];return lf(t,s,a)}}function LI(t){return function(){for(var s=arguments.length,n=new Array(s),a=0;a<s;a++)n[a]=arguments[a];return cf(t,n)}}function jt(t,s){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:zd;nv&&nv(t,null);let a=s.length;for(;a--;){let r=s[a];if(typeof r=="string"){const o=n(r);o!==r&&(AI(s)||(s[a]=o),r=o)}t[r]=!0}return t}function $I(t){for(let s=0;s<t.length;s++)ka(t,s)||(t[s]=null);return t}function Rr(t){const s=mj(null);for(const[n,a]of uj(t))ka(t,n)&&(Array.isArray(a)?s[n]=$I(a):a&&typeof a=="object"&&a.constructor===Object?s[n]=Rr(a):s[n]=a);return s}function Al(t,s){for(;t!==null;){const a=_I(t,s);if(a){if(a.get)return Mn(a.get);if(typeof a.value=="function")return Mn(a.value)}t=RI(t)}function n(){return null}return n}const iv=Pn(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),xh=Pn(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),gh=Pn(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),zI=Pn(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),vh=Pn(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),FI=Pn(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),ov=Pn(["#text"]),lv=Pn(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),yh=Pn(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),cv=Pn(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Rd=Pn(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),BI=fa(/\{\{[\w\W]*|[\w\W]*\}\}/gm),HI=fa(/<%[\w\W]*|[\w\W]*%>/gm),WI=fa(/\$\{[\w\W]*/gm),UI=fa(/^data-[\-\w.\u00B7-\uFFFF]+$/),VI=fa(/^aria-[\-\w]+$/),hj=fa(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),GI=fa(/^(?:\w+script|data):/i),qI=fa(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),fj=fa(/^html$/i),YI=fa(/^[a-z][.\w]*(-[.\w]+)+$/i);var dv=Object.freeze({__proto__:null,ARIA_ATTR:VI,ATTR_WHITESPACE:qI,CUSTOM_ELEMENT:YI,DATA_ATTR:UI,DOCTYPE_NAME:fj,ERB_EXPR:HI,IS_ALLOWED_URI:hj,IS_SCRIPT_OR_DATA:GI,MUSTACHE_EXPR:BI,TMPLIT_EXPR:WI});const Rl={element:1,text:3,progressingInstruction:7,comment:8,document:9},KI=function(){return typeof window>"u"?null:window},JI=function(s,n){if(typeof s!="object"||typeof s.createPolicy!="function")return null;let a=null;const r="data-tt-policy-suffix";n&&n.hasAttribute(r)&&(a=n.getAttribute(r));const o="dompurify"+(a?"#"+a:"");try{return s.createPolicy(o,{createHTML(l){return l},createScriptURL(l){return l}})}catch{return console.warn("TrustedTypes policy "+o+" could not be created."),null}},uv=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function pj(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:KI();const s=Ge=>pj(Ge);if(s.version="3.2.6",s.removed=[],!t||!t.document||t.document.nodeType!==Rl.document||!t.Element)return s.isSupported=!1,s;let{document:n}=t;const a=n,r=a.currentScript,{DocumentFragment:o,HTMLTemplateElement:l,Node:c,Element:m,NodeFilter:u,NamedNodeMap:h=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:p,DOMParser:g,trustedTypes:x}=t,b=m.prototype,j=Al(b,"cloneNode"),v=Al(b,"remove"),w=Al(b,"nextSibling"),N=Al(b,"childNodes"),S=Al(b,"parentNode");if(typeof l=="function"){const Ge=n.createElement("template");Ge.content&&Ge.content.ownerDocument&&(n=Ge.content.ownerDocument)}let E,T="";const{implementation:k,createNodeIterator:D,createDocumentFragment:P,getElementsByTagName:_}=n,{importNode:B}=a;let I=uv();s.isSupported=typeof uj=="function"&&typeof S=="function"&&k&&k.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:R,ERB_EXPR:M,TMPLIT_EXPR:W,DATA_ATTR:H,ARIA_ATTR:L,IS_SCRIPT_OR_DATA:$,ATTR_WHITESPACE:q,CUSTOM_ELEMENT:re}=dv;let{IS_ALLOWED_URI:Y}=dv,se=null;const ie=jt({},[...iv,...xh,...gh,...vh,...ov]);let U=null;const ee=jt({},[...lv,...yh,...cv,...Rd]);let me=Object.seal(mj(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),ue=null,ae=null,ge=!0,je=!0,we=!1,ke=!0,de=!1,J=!0,ve=!1,ft=!1,pt=!1,ot=!1,zs=!1,gs=!1,G=!0,te=!1;const le="user-content-";let Ce=!0,Se=!1,be={},Re=null;const Ve=jt({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Qe=null;const Yt=jt({},["audio","video","img","source","image","track"]);let Cs=null;const Ut=jt({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Us="http://www.w3.org/1998/Math/MathML",Fs="http://www.w3.org/2000/svg",ss="http://www.w3.org/1999/xhtml";let Rs=ss,Es=!1,Nn=null;const We=jt({},[Us,Fs,ss],ph);let lt=jt({},["mi","mo","mn","ms","mtext"]),yt=jt({},["annotation-xml"]);const Ft=jt({},["title","style","font","a","script"]);let Ue=null;const ut=["application/xhtml+xml","text/html"],Mt="text/html";let Ae=null,Oe=null;const Ye=n.createElement("form"),Et=function(X){return X instanceof RegExp||X instanceof Function},It=function(){let X=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Oe&&Oe===X)){if((!X||typeof X!="object")&&(X={}),X=Rr(X),Ue=ut.indexOf(X.PARSER_MEDIA_TYPE)===-1?Mt:X.PARSER_MEDIA_TYPE,Ae=Ue==="application/xhtml+xml"?ph:zd,se=ka(X,"ALLOWED_TAGS")?jt({},X.ALLOWED_TAGS,Ae):ie,U=ka(X,"ALLOWED_ATTR")?jt({},X.ALLOWED_ATTR,Ae):ee,Nn=ka(X,"ALLOWED_NAMESPACES")?jt({},X.ALLOWED_NAMESPACES,ph):We,Cs=ka(X,"ADD_URI_SAFE_ATTR")?jt(Rr(Ut),X.ADD_URI_SAFE_ATTR,Ae):Ut,Qe=ka(X,"ADD_DATA_URI_TAGS")?jt(Rr(Yt),X.ADD_DATA_URI_TAGS,Ae):Yt,Re=ka(X,"FORBID_CONTENTS")?jt({},X.FORBID_CONTENTS,Ae):Ve,ue=ka(X,"FORBID_TAGS")?jt({},X.FORBID_TAGS,Ae):Rr({}),ae=ka(X,"FORBID_ATTR")?jt({},X.FORBID_ATTR,Ae):Rr({}),be=ka(X,"USE_PROFILES")?X.USE_PROFILES:!1,ge=X.ALLOW_ARIA_ATTR!==!1,je=X.ALLOW_DATA_ATTR!==!1,we=X.ALLOW_UNKNOWN_PROTOCOLS||!1,ke=X.ALLOW_SELF_CLOSE_IN_ATTR!==!1,de=X.SAFE_FOR_TEMPLATES||!1,J=X.SAFE_FOR_XML!==!1,ve=X.WHOLE_DOCUMENT||!1,ot=X.RETURN_DOM||!1,zs=X.RETURN_DOM_FRAGMENT||!1,gs=X.RETURN_TRUSTED_TYPE||!1,pt=X.FORCE_BODY||!1,G=X.SANITIZE_DOM!==!1,te=X.SANITIZE_NAMED_PROPS||!1,Ce=X.KEEP_CONTENT!==!1,Se=X.IN_PLACE||!1,Y=X.ALLOWED_URI_REGEXP||hj,Rs=X.NAMESPACE||ss,lt=X.MATHML_TEXT_INTEGRATION_POINTS||lt,yt=X.HTML_INTEGRATION_POINTS||yt,me=X.CUSTOM_ELEMENT_HANDLING||{},X.CUSTOM_ELEMENT_HANDLING&&Et(X.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(me.tagNameCheck=X.CUSTOM_ELEMENT_HANDLING.tagNameCheck),X.CUSTOM_ELEMENT_HANDLING&&Et(X.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(me.attributeNameCheck=X.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),X.CUSTOM_ELEMENT_HANDLING&&typeof X.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(me.allowCustomizedBuiltInElements=X.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),de&&(je=!1),zs&&(ot=!0),be&&(se=jt({},ov),U=[],be.html===!0&&(jt(se,iv),jt(U,lv)),be.svg===!0&&(jt(se,xh),jt(U,yh),jt(U,Rd)),be.svgFilters===!0&&(jt(se,gh),jt(U,yh),jt(U,Rd)),be.mathMl===!0&&(jt(se,vh),jt(U,cv),jt(U,Rd))),X.ADD_TAGS&&(se===ie&&(se=Rr(se)),jt(se,X.ADD_TAGS,Ae)),X.ADD_ATTR&&(U===ee&&(U=Rr(U)),jt(U,X.ADD_ATTR,Ae)),X.ADD_URI_SAFE_ATTR&&jt(Cs,X.ADD_URI_SAFE_ATTR,Ae),X.FORBID_CONTENTS&&(Re===Ve&&(Re=Rr(Re)),jt(Re,X.FORBID_CONTENTS,Ae)),Ce&&(se["#text"]=!0),ve&&jt(se,["html","head","body"]),se.table&&(jt(se,["tbody"]),delete ue.tbody),X.TRUSTED_TYPES_POLICY){if(typeof X.TRUSTED_TYPES_POLICY.createHTML!="function")throw kl('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof X.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw kl('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');E=X.TRUSTED_TYPES_POLICY,T=E.createHTML("")}else E===void 0&&(E=JI(x,r)),E!==null&&typeof T=="string"&&(T=E.createHTML(""));Pn&&Pn(X),Oe=X}},Tt=jt({},[...xh,...gh,...zI]),ds=jt({},[...vh,...FI]),us=function(X){let Ee=S(X);(!Ee||!Ee.tagName)&&(Ee={namespaceURI:Rs,tagName:"template"});const Le=zd(X.tagName),Zt=zd(Ee.tagName);return Nn[X.namespaceURI]?X.namespaceURI===Fs?Ee.namespaceURI===ss?Le==="svg":Ee.namespaceURI===Us?Le==="svg"&&(Zt==="annotation-xml"||lt[Zt]):!!Tt[Le]:X.namespaceURI===Us?Ee.namespaceURI===ss?Le==="math":Ee.namespaceURI===Fs?Le==="math"&&yt[Zt]:!!ds[Le]:X.namespaceURI===ss?Ee.namespaceURI===Fs&&!yt[Zt]||Ee.namespaceURI===Us&&!lt[Zt]?!1:!ds[Le]&&(Ft[Le]||!Tt[Le]):!!(Ue==="application/xhtml+xml"&&Nn[X.namespaceURI]):!1},Bt=function(X){Tl(s.removed,{element:X});try{S(X).removeChild(X)}catch{v(X)}},In=function(X,Ee){try{Tl(s.removed,{attribute:Ee.getAttributeNode(X),from:Ee})}catch{Tl(s.removed,{attribute:null,from:Ee})}if(Ee.removeAttribute(X),X==="is")if(ot||zs)try{Bt(Ee)}catch{}else try{Ee.setAttribute(X,"")}catch{}},Ka=function(X){let Ee=null,Le=null;if(pt)X="<remove></remove>"+X;else{const vs=rv(X,/^[\r\n\t ]+/);Le=vs&&vs[0]}Ue==="application/xhtml+xml"&&Rs===ss&&(X='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+X+"</body></html>");const Zt=E?E.createHTML(X):X;if(Rs===ss)try{Ee=new g().parseFromString(Zt,Ue)}catch{}if(!Ee||!Ee.documentElement){Ee=k.createDocument(Rs,"template",null);try{Ee.documentElement.innerHTML=Es?T:Zt}catch{}}const Zs=Ee.body||Ee.documentElement;return X&&Le&&Zs.insertBefore(n.createTextNode(Le),Zs.childNodes[0]||null),Rs===ss?_.call(Ee,ve?"html":"body")[0]:ve?Ee.documentElement:Zs},qn=function(X){return D.call(X.ownerDocument||X,X,u.SHOW_ELEMENT|u.SHOW_COMMENT|u.SHOW_TEXT|u.SHOW_PROCESSING_INSTRUCTION|u.SHOW_CDATA_SECTION,null)},ja=function(X){return X instanceof p&&(typeof X.nodeName!="string"||typeof X.textContent!="string"||typeof X.removeChild!="function"||!(X.attributes instanceof h)||typeof X.removeAttribute!="function"||typeof X.setAttribute!="function"||typeof X.namespaceURI!="string"||typeof X.insertBefore!="function"||typeof X.hasChildNodes!="function")},Vr=function(X){return typeof c=="function"&&X instanceof c};function wa(Ge,X,Ee){Ad(Ge,Le=>{Le.call(s,X,Ee,Oe)})}const $c=function(X){let Ee=null;if(wa(I.beforeSanitizeElements,X,null),ja(X))return Bt(X),!0;const Le=Ae(X.nodeName);if(wa(I.uponSanitizeElement,X,{tagName:Le,allowedTags:se}),J&&X.hasChildNodes()&&!Vr(X.firstElementChild)&&Tn(/<[/\w!]/g,X.innerHTML)&&Tn(/<[/\w!]/g,X.textContent)||X.nodeType===Rl.progressingInstruction||J&&X.nodeType===Rl.comment&&Tn(/<[/\w]/g,X.data))return Bt(X),!0;if(!se[Le]||ue[Le]){if(!ue[Le]&&rl(Le)&&(me.tagNameCheck instanceof RegExp&&Tn(me.tagNameCheck,Le)||me.tagNameCheck instanceof Function&&me.tagNameCheck(Le)))return!1;if(Ce&&!Re[Le]){const Zt=S(X)||X.parentNode,Zs=N(X)||X.childNodes;if(Zs&&Zt){const vs=Zs.length;for(let mn=vs-1;mn>=0;--mn){const Na=j(Zs[mn],!0);Na.__removalCount=(X.__removalCount||0)+1,Zt.insertBefore(Na,w(X))}}}return Bt(X),!0}return X instanceof m&&!us(X)||(Le==="noscript"||Le==="noembed"||Le==="noframes")&&Tn(/<\/no(script|embed|frames)/i,X.innerHTML)?(Bt(X),!0):(de&&X.nodeType===Rl.text&&(Ee=X.textContent,Ad([R,M,W],Zt=>{Ee=Dl(Ee,Zt," ")}),X.textContent!==Ee&&(Tl(s.removed,{element:X.cloneNode()}),X.textContent=Ee)),wa(I.afterSanitizeElements,X,null),!1)},zc=function(X,Ee,Le){if(G&&(Ee==="id"||Ee==="name")&&(Le in n||Le in Ye))return!1;if(!(je&&!ae[Ee]&&Tn(H,Ee))){if(!(ge&&Tn(L,Ee))){if(!U[Ee]||ae[Ee]){if(!(rl(X)&&(me.tagNameCheck instanceof RegExp&&Tn(me.tagNameCheck,X)||me.tagNameCheck instanceof Function&&me.tagNameCheck(X))&&(me.attributeNameCheck instanceof RegExp&&Tn(me.attributeNameCheck,Ee)||me.attributeNameCheck instanceof Function&&me.attributeNameCheck(Ee))||Ee==="is"&&me.allowCustomizedBuiltInElements&&(me.tagNameCheck instanceof RegExp&&Tn(me.tagNameCheck,Le)||me.tagNameCheck instanceof Function&&me.tagNameCheck(Le))))return!1}else if(!Cs[Ee]){if(!Tn(Y,Dl(Le,q,""))){if(!((Ee==="src"||Ee==="xlink:href"||Ee==="href")&&X!=="script"&&II(Le,"data:")===0&&Qe[X])){if(!(we&&!Tn($,Dl(Le,q,"")))){if(Le)return!1}}}}}}return!0},rl=function(X){return X!=="annotation-xml"&&rv(X,re)},Fc=function(X){wa(I.beforeSanitizeAttributes,X,null);const{attributes:Ee}=X;if(!Ee||ja(X))return;const Le={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:U,forceKeepAttr:void 0};let Zt=Ee.length;for(;Zt--;){const Zs=Ee[Zt],{name:vs,namespaceURI:mn,value:Na}=Zs,_i=Ae(vs),lo=Na;let Vs=vs==="value"?lo:OI(lo);if(Le.attrName=_i,Le.attrValue=Vs,Le.keepAttr=!0,Le.forceKeepAttr=void 0,wa(I.uponSanitizeAttribute,X,Le),Vs=Le.attrValue,te&&(_i==="id"||_i==="name")&&(In(vs,X),Vs=le+Vs),J&&Tn(/((--!?|])>)|<\/(style|title)/i,Vs)){In(vs,X);continue}if(Le.forceKeepAttr)continue;if(!Le.keepAttr){In(vs,X);continue}if(!ke&&Tn(/\/>/i,Vs)){In(vs,X);continue}de&&Ad([R,M,W],Bc=>{Vs=Dl(Vs,Bc," ")});const il=Ae(X.nodeName);if(!zc(il,_i,Vs)){In(vs,X);continue}if(E&&typeof x=="object"&&typeof x.getAttributeType=="function"&&!mn)switch(x.getAttributeType(il,_i)){case"TrustedHTML":{Vs=E.createHTML(Vs);break}case"TrustedScriptURL":{Vs=E.createScriptURL(Vs);break}}if(Vs!==lo)try{mn?X.setAttributeNS(mn,vs,Vs):X.setAttribute(vs,Vs),ja(X)?Bt(X):av(s.removed)}catch{In(vs,X)}}wa(I.afterSanitizeAttributes,X,null)},Zu=function Ge(X){let Ee=null;const Le=qn(X);for(wa(I.beforeSanitizeShadowDOM,X,null);Ee=Le.nextNode();)wa(I.uponSanitizeShadowNode,Ee,null),$c(Ee),Fc(Ee),Ee.content instanceof o&&Ge(Ee.content);wa(I.afterSanitizeShadowDOM,X,null)};return s.sanitize=function(Ge){let X=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},Ee=null,Le=null,Zt=null,Zs=null;if(Es=!Ge,Es&&(Ge="<!-->"),typeof Ge!="string"&&!Vr(Ge))if(typeof Ge.toString=="function"){if(Ge=Ge.toString(),typeof Ge!="string")throw kl("dirty is not a string, aborting")}else throw kl("toString is not a function");if(!s.isSupported)return Ge;if(ft||It(X),s.removed=[],typeof Ge=="string"&&(Se=!1),Se){if(Ge.nodeName){const Na=Ae(Ge.nodeName);if(!se[Na]||ue[Na])throw kl("root node is forbidden and cannot be sanitized in-place")}}else if(Ge instanceof c)Ee=Ka("<!---->"),Le=Ee.ownerDocument.importNode(Ge,!0),Le.nodeType===Rl.element&&Le.nodeName==="BODY"||Le.nodeName==="HTML"?Ee=Le:Ee.appendChild(Le);else{if(!ot&&!de&&!ve&&Ge.indexOf("<")===-1)return E&&gs?E.createHTML(Ge):Ge;if(Ee=Ka(Ge),!Ee)return ot?null:gs?T:""}Ee&&pt&&Bt(Ee.firstChild);const vs=qn(Se?Ge:Ee);for(;Zt=vs.nextNode();)$c(Zt),Fc(Zt),Zt.content instanceof o&&Zu(Zt.content);if(Se)return Ge;if(ot){if(zs)for(Zs=P.call(Ee.ownerDocument);Ee.firstChild;)Zs.appendChild(Ee.firstChild);else Zs=Ee;return(U.shadowroot||U.shadowrootmode)&&(Zs=B.call(a,Zs,!0)),Zs}let mn=ve?Ee.outerHTML:Ee.innerHTML;return ve&&se["!doctype"]&&Ee.ownerDocument&&Ee.ownerDocument.doctype&&Ee.ownerDocument.doctype.name&&Tn(fj,Ee.ownerDocument.doctype.name)&&(mn="<!DOCTYPE "+Ee.ownerDocument.doctype.name+`>
`+mn),de&&Ad([R,M,W],Na=>{mn=Dl(mn,Na," ")}),E&&gs?E.createHTML(mn):mn},s.setConfig=function(){let Ge=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};It(Ge),ft=!0},s.clearConfig=function(){Oe=null,ft=!1},s.isValidAttribute=function(Ge,X,Ee){Oe||It({});const Le=Ae(Ge),Zt=Ae(X);return zc(Le,Zt,Ee)},s.addHook=function(Ge,X){typeof X=="function"&&Tl(I[Ge],X)},s.removeHook=function(Ge,X){if(X!==void 0){const Ee=PI(I[Ge],X);return Ee===-1?void 0:MI(I[Ge],Ee,1)[0]}return av(I[Ge])},s.removeHooks=function(Ge){I[Ge]=[]},s.removeAllHooks=function(){I=uv()},s}var Fr=pj();function tp(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var io=tp();function xj(t){io=t}var Gl={exec:()=>null};function Jt(t,s=""){let n=typeof t=="string"?t:t.source;const a={replace:(r,o)=>{let l=typeof o=="string"?o:o.source;return l=l.replace(An.caret,"$1"),n=n.replace(r,l),a},getRegex:()=>new RegExp(n,s)};return a}var An={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:t=>new RegExp(`^( {0,3}${t})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}#`),htmlBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}<(?:[a-z].*>|!--)`,"i")},XI=/^(?:[ \t]*(?:\n|$))+/,ZI=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,QI=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Cc=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,eO=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,sp=/(?:[*+-]|\d{1,9}[.)])/,gj=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,vj=Jt(gj).replace(/bull/g,sp).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),tO=Jt(gj).replace(/bull/g,sp).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),np=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,sO=/^[^\n]+/,ap=/(?!\s*\])(?:\\.|[^\[\]\\])+/,nO=Jt(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",ap).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),aO=Jt(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,sp).getRegex(),Au="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",rp=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,rO=Jt("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",rp).replace("tag",Au).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),yj=Jt(np).replace("hr",Cc).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Au).getRegex(),iO=Jt(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",yj).getRegex(),ip={blockquote:iO,code:ZI,def:nO,fences:QI,heading:eO,hr:Cc,html:rO,lheading:vj,list:aO,newline:XI,paragraph:yj,table:Gl,text:sO},mv=Jt("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Cc).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Au).getRegex(),oO={...ip,lheading:tO,table:mv,paragraph:Jt(np).replace("hr",Cc).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",mv).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Au).getRegex()},lO={...ip,html:Jt(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",rp).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Gl,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:Jt(np).replace("hr",Cc).replace("heading",` *#{1,6} *[^
]`).replace("lheading",vj).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},cO=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,dO=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,bj=/^( {2,}|\\)\n(?!\s*$)/,uO=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Ru=/[\p{P}\p{S}]/u,op=/[\s\p{P}\p{S}]/u,jj=/[^\s\p{P}\p{S}]/u,mO=Jt(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,op).getRegex(),wj=/(?!~)[\p{P}\p{S}]/u,hO=/(?!~)[\s\p{P}\p{S}]/u,fO=/(?:[^\s\p{P}\p{S}]|~)/u,pO=/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,Nj=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,xO=Jt(Nj,"u").replace(/punct/g,Ru).getRegex(),gO=Jt(Nj,"u").replace(/punct/g,wj).getRegex(),Sj="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",vO=Jt(Sj,"gu").replace(/notPunctSpace/g,jj).replace(/punctSpace/g,op).replace(/punct/g,Ru).getRegex(),yO=Jt(Sj,"gu").replace(/notPunctSpace/g,fO).replace(/punctSpace/g,hO).replace(/punct/g,wj).getRegex(),bO=Jt("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,jj).replace(/punctSpace/g,op).replace(/punct/g,Ru).getRegex(),jO=Jt(/\\(punct)/,"gu").replace(/punct/g,Ru).getRegex(),wO=Jt(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),NO=Jt(rp).replace("(?:-->|$)","-->").getRegex(),SO=Jt("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",NO).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),eu=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,CO=Jt(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",eu).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Cj=Jt(/^!?\[(label)\]\[(ref)\]/).replace("label",eu).replace("ref",ap).getRegex(),Ej=Jt(/^!?\[(ref)\](?:\[\])?/).replace("ref",ap).getRegex(),EO=Jt("reflink|nolink(?!\\()","g").replace("reflink",Cj).replace("nolink",Ej).getRegex(),lp={_backpedal:Gl,anyPunctuation:jO,autolink:wO,blockSkip:pO,br:bj,code:dO,del:Gl,emStrongLDelim:xO,emStrongRDelimAst:vO,emStrongRDelimUnd:bO,escape:cO,link:CO,nolink:Ej,punctuation:mO,reflink:Cj,reflinkSearch:EO,tag:SO,text:uO,url:Gl},TO={...lp,link:Jt(/^!?\[(label)\]\((.*?)\)/).replace("label",eu).getRegex(),reflink:Jt(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",eu).getRegex()},df={...lp,emStrongRDelimAst:yO,emStrongLDelim:gO,url:Jt(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},DO={...df,br:Jt(bj).replace("{2,}","*").getRegex(),text:Jt(df.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},_d={normal:ip,gfm:oO,pedantic:lO},_l={normal:lp,gfm:df,breaks:DO,pedantic:TO},kO={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},hv=t=>kO[t];function Qa(t,s){if(s){if(An.escapeTest.test(t))return t.replace(An.escapeReplace,hv)}else if(An.escapeTestNoEncode.test(t))return t.replace(An.escapeReplaceNoEncode,hv);return t}function fv(t){try{t=encodeURI(t).replace(An.percentDecode,"%")}catch{return null}return t}function pv(t,s){var o;const n=t.replace(An.findPipe,(l,c,m)=>{let u=!1,h=c;for(;--h>=0&&m[h]==="\\";)u=!u;return u?"|":" |"}),a=n.split(An.splitPipe);let r=0;if(a[0].trim()||a.shift(),a.length>0&&!((o=a.at(-1))!=null&&o.trim())&&a.pop(),s)if(a.length>s)a.splice(s);else for(;a.length<s;)a.push("");for(;r<a.length;r++)a[r]=a[r].trim().replace(An.slashPipe,"|");return a}function Pl(t,s,n){const a=t.length;if(a===0)return"";let r=0;for(;r<a&&t.charAt(a-r-1)===s;)r++;return t.slice(0,a-r)}function AO(t,s){if(t.indexOf(s[1])===-1)return-1;let n=0;for(let a=0;a<t.length;a++)if(t[a]==="\\")a++;else if(t[a]===s[0])n++;else if(t[a]===s[1]&&(n--,n<0))return a;return n>0?-2:-1}function xv(t,s,n,a,r){const o=s.href,l=s.title||null,c=t[1].replace(r.other.outputLinkReplace,"$1");a.state.inLink=!0;const m={type:t[0].charAt(0)==="!"?"image":"link",raw:n,href:o,title:l,text:c,tokens:a.inlineTokens(c)};return a.state.inLink=!1,m}function RO(t,s,n){const a=t.match(n.other.indentCodeCompensation);if(a===null)return s;const r=a[1];return s.split(`
`).map(o=>{const l=o.match(n.other.beginningSpace);if(l===null)return o;const[c]=l;return c.length>=r.length?o.slice(r.length):o}).join(`
`)}var tu=class{constructor(t){ht(this,"options");ht(this,"rules");ht(this,"lexer");this.options=t||io}space(t){const s=this.rules.block.newline.exec(t);if(s&&s[0].length>0)return{type:"space",raw:s[0]}}code(t){const s=this.rules.block.code.exec(t);if(s){const n=s[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:s[0],codeBlockStyle:"indented",text:this.options.pedantic?n:Pl(n,`
`)}}}fences(t){const s=this.rules.block.fences.exec(t);if(s){const n=s[0],a=RO(n,s[3]||"",this.rules);return{type:"code",raw:n,lang:s[2]?s[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):s[2],text:a}}}heading(t){const s=this.rules.block.heading.exec(t);if(s){let n=s[2].trim();if(this.rules.other.endingHash.test(n)){const a=Pl(n,"#");(this.options.pedantic||!a||this.rules.other.endingSpaceChar.test(a))&&(n=a.trim())}return{type:"heading",raw:s[0],depth:s[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(t){const s=this.rules.block.hr.exec(t);if(s)return{type:"hr",raw:Pl(s[0],`
`)}}blockquote(t){const s=this.rules.block.blockquote.exec(t);if(s){let n=Pl(s[0],`
`).split(`
`),a="",r="";const o=[];for(;n.length>0;){let l=!1;const c=[];let m;for(m=0;m<n.length;m++)if(this.rules.other.blockquoteStart.test(n[m]))c.push(n[m]),l=!0;else if(!l)c.push(n[m]);else break;n=n.slice(m);const u=c.join(`
`),h=u.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");a=a?`${a}
${u}`:u,r=r?`${r}
${h}`:h;const p=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(h,o,!0),this.lexer.state.top=p,n.length===0)break;const g=o.at(-1);if((g==null?void 0:g.type)==="code")break;if((g==null?void 0:g.type)==="blockquote"){const x=g,b=x.raw+`
`+n.join(`
`),j=this.blockquote(b);o[o.length-1]=j,a=a.substring(0,a.length-x.raw.length)+j.raw,r=r.substring(0,r.length-x.text.length)+j.text;break}else if((g==null?void 0:g.type)==="list"){const x=g,b=x.raw+`
`+n.join(`
`),j=this.list(b);o[o.length-1]=j,a=a.substring(0,a.length-g.raw.length)+j.raw,r=r.substring(0,r.length-x.raw.length)+j.raw,n=b.substring(o.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:a,tokens:o,text:r}}}list(t){let s=this.rules.block.list.exec(t);if(s){let n=s[1].trim();const a=n.length>1,r={type:"list",raw:"",ordered:a,start:a?+n.slice(0,-1):"",loose:!1,items:[]};n=a?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=a?n:"[*+-]");const o=this.rules.other.listItemRegex(n);let l=!1;for(;t;){let m=!1,u="",h="";if(!(s=o.exec(t))||this.rules.block.hr.test(t))break;u=s[0],t=t.substring(u.length);let p=s[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,w=>" ".repeat(3*w.length)),g=t.split(`
`,1)[0],x=!p.trim(),b=0;if(this.options.pedantic?(b=2,h=p.trimStart()):x?b=s[1].length+1:(b=s[2].search(this.rules.other.nonSpaceChar),b=b>4?1:b,h=p.slice(b),b+=s[1].length),x&&this.rules.other.blankLine.test(g)&&(u+=g+`
`,t=t.substring(g.length+1),m=!0),!m){const w=this.rules.other.nextBulletRegex(b),N=this.rules.other.hrRegex(b),S=this.rules.other.fencesBeginRegex(b),E=this.rules.other.headingBeginRegex(b),T=this.rules.other.htmlBeginRegex(b);for(;t;){const k=t.split(`
`,1)[0];let D;if(g=k,this.options.pedantic?(g=g.replace(this.rules.other.listReplaceNesting,"  "),D=g):D=g.replace(this.rules.other.tabCharGlobal,"    "),S.test(g)||E.test(g)||T.test(g)||w.test(g)||N.test(g))break;if(D.search(this.rules.other.nonSpaceChar)>=b||!g.trim())h+=`
`+D.slice(b);else{if(x||p.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||S.test(p)||E.test(p)||N.test(p))break;h+=`
`+g}!x&&!g.trim()&&(x=!0),u+=k+`
`,t=t.substring(k.length+1),p=D.slice(b)}}r.loose||(l?r.loose=!0:this.rules.other.doubleBlankLine.test(u)&&(l=!0));let j=null,v;this.options.gfm&&(j=this.rules.other.listIsTask.exec(h),j&&(v=j[0]!=="[ ] ",h=h.replace(this.rules.other.listReplaceTask,""))),r.items.push({type:"list_item",raw:u,task:!!j,checked:v,loose:!1,text:h,tokens:[]}),r.raw+=u}const c=r.items.at(-1);if(c)c.raw=c.raw.trimEnd(),c.text=c.text.trimEnd();else return;r.raw=r.raw.trimEnd();for(let m=0;m<r.items.length;m++)if(this.lexer.state.top=!1,r.items[m].tokens=this.lexer.blockTokens(r.items[m].text,[]),!r.loose){const u=r.items[m].tokens.filter(p=>p.type==="space"),h=u.length>0&&u.some(p=>this.rules.other.anyLine.test(p.raw));r.loose=h}if(r.loose)for(let m=0;m<r.items.length;m++)r.items[m].loose=!0;return r}}html(t){const s=this.rules.block.html.exec(t);if(s)return{type:"html",block:!0,raw:s[0],pre:s[1]==="pre"||s[1]==="script"||s[1]==="style",text:s[0]}}def(t){const s=this.rules.block.def.exec(t);if(s){const n=s[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),a=s[2]?s[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",r=s[3]?s[3].substring(1,s[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):s[3];return{type:"def",tag:n,raw:s[0],href:a,title:r}}}table(t){var l;const s=this.rules.block.table.exec(t);if(!s||!this.rules.other.tableDelimiter.test(s[2]))return;const n=pv(s[1]),a=s[2].replace(this.rules.other.tableAlignChars,"").split("|"),r=(l=s[3])!=null&&l.trim()?s[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],o={type:"table",raw:s[0],header:[],align:[],rows:[]};if(n.length===a.length){for(const c of a)this.rules.other.tableAlignRight.test(c)?o.align.push("right"):this.rules.other.tableAlignCenter.test(c)?o.align.push("center"):this.rules.other.tableAlignLeft.test(c)?o.align.push("left"):o.align.push(null);for(let c=0;c<n.length;c++)o.header.push({text:n[c],tokens:this.lexer.inline(n[c]),header:!0,align:o.align[c]});for(const c of r)o.rows.push(pv(c,o.header.length).map((m,u)=>({text:m,tokens:this.lexer.inline(m),header:!1,align:o.align[u]})));return o}}lheading(t){const s=this.rules.block.lheading.exec(t);if(s)return{type:"heading",raw:s[0],depth:s[2].charAt(0)==="="?1:2,text:s[1],tokens:this.lexer.inline(s[1])}}paragraph(t){const s=this.rules.block.paragraph.exec(t);if(s){const n=s[1].charAt(s[1].length-1)===`
`?s[1].slice(0,-1):s[1];return{type:"paragraph",raw:s[0],text:n,tokens:this.lexer.inline(n)}}}text(t){const s=this.rules.block.text.exec(t);if(s)return{type:"text",raw:s[0],text:s[0],tokens:this.lexer.inline(s[0])}}escape(t){const s=this.rules.inline.escape.exec(t);if(s)return{type:"escape",raw:s[0],text:s[1]}}tag(t){const s=this.rules.inline.tag.exec(t);if(s)return!this.lexer.state.inLink&&this.rules.other.startATag.test(s[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(s[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(s[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(s[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:s[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:s[0]}}link(t){const s=this.rules.inline.link.exec(t);if(s){const n=s[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;const o=Pl(n.slice(0,-1),"\\");if((n.length-o.length)%2===0)return}else{const o=AO(s[2],"()");if(o===-2)return;if(o>-1){const c=(s[0].indexOf("!")===0?5:4)+s[1].length+o;s[2]=s[2].substring(0,o),s[0]=s[0].substring(0,c).trim(),s[3]=""}}let a=s[2],r="";if(this.options.pedantic){const o=this.rules.other.pedanticHrefTitle.exec(a);o&&(a=o[1],r=o[3])}else r=s[3]?s[3].slice(1,-1):"";return a=a.trim(),this.rules.other.startAngleBracket.test(a)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?a=a.slice(1):a=a.slice(1,-1)),xv(s,{href:a&&a.replace(this.rules.inline.anyPunctuation,"$1"),title:r&&r.replace(this.rules.inline.anyPunctuation,"$1")},s[0],this.lexer,this.rules)}}reflink(t,s){let n;if((n=this.rules.inline.reflink.exec(t))||(n=this.rules.inline.nolink.exec(t))){const a=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),r=s[a.toLowerCase()];if(!r){const o=n[0].charAt(0);return{type:"text",raw:o,text:o}}return xv(n,r,n[0],this.lexer,this.rules)}}emStrong(t,s,n=""){let a=this.rules.inline.emStrongLDelim.exec(t);if(!a||a[3]&&n.match(this.rules.other.unicodeAlphaNumeric))return;if(!(a[1]||a[2]||"")||!n||this.rules.inline.punctuation.exec(n)){const o=[...a[0]].length-1;let l,c,m=o,u=0;const h=a[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(h.lastIndex=0,s=s.slice(-1*t.length+o);(a=h.exec(s))!=null;){if(l=a[1]||a[2]||a[3]||a[4]||a[5]||a[6],!l)continue;if(c=[...l].length,a[3]||a[4]){m+=c;continue}else if((a[5]||a[6])&&o%3&&!((o+c)%3)){u+=c;continue}if(m-=c,m>0)continue;c=Math.min(c,c+m+u);const p=[...a[0]][0].length,g=t.slice(0,o+a.index+p+c);if(Math.min(o,c)%2){const b=g.slice(1,-1);return{type:"em",raw:g,text:b,tokens:this.lexer.inlineTokens(b)}}const x=g.slice(2,-2);return{type:"strong",raw:g,text:x,tokens:this.lexer.inlineTokens(x)}}}}codespan(t){const s=this.rules.inline.code.exec(t);if(s){let n=s[2].replace(this.rules.other.newLineCharGlobal," ");const a=this.rules.other.nonSpaceChar.test(n),r=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return a&&r&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:s[0],text:n}}}br(t){const s=this.rules.inline.br.exec(t);if(s)return{type:"br",raw:s[0]}}del(t){const s=this.rules.inline.del.exec(t);if(s)return{type:"del",raw:s[0],text:s[2],tokens:this.lexer.inlineTokens(s[2])}}autolink(t){const s=this.rules.inline.autolink.exec(t);if(s){let n,a;return s[2]==="@"?(n=s[1],a="mailto:"+n):(n=s[1],a=n),{type:"link",raw:s[0],text:n,href:a,tokens:[{type:"text",raw:n,text:n}]}}}url(t){var n;let s;if(s=this.rules.inline.url.exec(t)){let a,r;if(s[2]==="@")a=s[0],r="mailto:"+a;else{let o;do o=s[0],s[0]=((n=this.rules.inline._backpedal.exec(s[0]))==null?void 0:n[0])??"";while(o!==s[0]);a=s[0],s[1]==="www."?r="http://"+s[0]:r=s[0]}return{type:"link",raw:s[0],text:a,href:r,tokens:[{type:"text",raw:a,text:a}]}}}inlineText(t){const s=this.rules.inline.text.exec(t);if(s){const n=this.lexer.state.inRawBlock;return{type:"text",raw:s[0],text:s[0],escaped:n}}}},Or=class uf{constructor(s){ht(this,"tokens");ht(this,"options");ht(this,"state");ht(this,"tokenizer");ht(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=s||io,this.options.tokenizer=this.options.tokenizer||new tu,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const n={other:An,block:_d.normal,inline:_l.normal};this.options.pedantic?(n.block=_d.pedantic,n.inline=_l.pedantic):this.options.gfm&&(n.block=_d.gfm,this.options.breaks?n.inline=_l.breaks:n.inline=_l.gfm),this.tokenizer.rules=n}static get rules(){return{block:_d,inline:_l}}static lex(s,n){return new uf(n).lex(s)}static lexInline(s,n){return new uf(n).inlineTokens(s)}lex(s){s=s.replace(An.carriageReturn,`
`),this.blockTokens(s,this.tokens);for(let n=0;n<this.inlineQueue.length;n++){const a=this.inlineQueue[n];this.inlineTokens(a.src,a.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(s,n=[],a=!1){var r,o,l;for(this.options.pedantic&&(s=s.replace(An.tabCharGlobal,"    ").replace(An.spaceLine,""));s;){let c;if((o=(r=this.options.extensions)==null?void 0:r.block)!=null&&o.some(u=>(c=u.call({lexer:this},s,n))?(s=s.substring(c.raw.length),n.push(c),!0):!1))continue;if(c=this.tokenizer.space(s)){s=s.substring(c.raw.length);const u=n.at(-1);c.raw.length===1&&u!==void 0?u.raw+=`
`:n.push(c);continue}if(c=this.tokenizer.code(s)){s=s.substring(c.raw.length);const u=n.at(-1);(u==null?void 0:u.type)==="paragraph"||(u==null?void 0:u.type)==="text"?(u.raw+=`
`+c.raw,u.text+=`
`+c.text,this.inlineQueue.at(-1).src=u.text):n.push(c);continue}if(c=this.tokenizer.fences(s)){s=s.substring(c.raw.length),n.push(c);continue}if(c=this.tokenizer.heading(s)){s=s.substring(c.raw.length),n.push(c);continue}if(c=this.tokenizer.hr(s)){s=s.substring(c.raw.length),n.push(c);continue}if(c=this.tokenizer.blockquote(s)){s=s.substring(c.raw.length),n.push(c);continue}if(c=this.tokenizer.list(s)){s=s.substring(c.raw.length),n.push(c);continue}if(c=this.tokenizer.html(s)){s=s.substring(c.raw.length),n.push(c);continue}if(c=this.tokenizer.def(s)){s=s.substring(c.raw.length);const u=n.at(-1);(u==null?void 0:u.type)==="paragraph"||(u==null?void 0:u.type)==="text"?(u.raw+=`
`+c.raw,u.text+=`
`+c.raw,this.inlineQueue.at(-1).src=u.text):this.tokens.links[c.tag]||(this.tokens.links[c.tag]={href:c.href,title:c.title});continue}if(c=this.tokenizer.table(s)){s=s.substring(c.raw.length),n.push(c);continue}if(c=this.tokenizer.lheading(s)){s=s.substring(c.raw.length),n.push(c);continue}let m=s;if((l=this.options.extensions)!=null&&l.startBlock){let u=1/0;const h=s.slice(1);let p;this.options.extensions.startBlock.forEach(g=>{p=g.call({lexer:this},h),typeof p=="number"&&p>=0&&(u=Math.min(u,p))}),u<1/0&&u>=0&&(m=s.substring(0,u+1))}if(this.state.top&&(c=this.tokenizer.paragraph(m))){const u=n.at(-1);a&&(u==null?void 0:u.type)==="paragraph"?(u.raw+=`
`+c.raw,u.text+=`
`+c.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=u.text):n.push(c),a=m.length!==s.length,s=s.substring(c.raw.length);continue}if(c=this.tokenizer.text(s)){s=s.substring(c.raw.length);const u=n.at(-1);(u==null?void 0:u.type)==="text"?(u.raw+=`
`+c.raw,u.text+=`
`+c.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=u.text):n.push(c);continue}if(s){const u="Infinite loop on byte: "+s.charCodeAt(0);if(this.options.silent){console.error(u);break}else throw new Error(u)}}return this.state.top=!0,n}inline(s,n=[]){return this.inlineQueue.push({src:s,tokens:n}),n}inlineTokens(s,n=[]){var c,m,u;let a=s,r=null;if(this.tokens.links){const h=Object.keys(this.tokens.links);if(h.length>0)for(;(r=this.tokenizer.rules.inline.reflinkSearch.exec(a))!=null;)h.includes(r[0].slice(r[0].lastIndexOf("[")+1,-1))&&(a=a.slice(0,r.index)+"["+"a".repeat(r[0].length-2)+"]"+a.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(r=this.tokenizer.rules.inline.anyPunctuation.exec(a))!=null;)a=a.slice(0,r.index)+"++"+a.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(r=this.tokenizer.rules.inline.blockSkip.exec(a))!=null;)a=a.slice(0,r.index)+"["+"a".repeat(r[0].length-2)+"]"+a.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);let o=!1,l="";for(;s;){o||(l=""),o=!1;let h;if((m=(c=this.options.extensions)==null?void 0:c.inline)!=null&&m.some(g=>(h=g.call({lexer:this},s,n))?(s=s.substring(h.raw.length),n.push(h),!0):!1))continue;if(h=this.tokenizer.escape(s)){s=s.substring(h.raw.length),n.push(h);continue}if(h=this.tokenizer.tag(s)){s=s.substring(h.raw.length),n.push(h);continue}if(h=this.tokenizer.link(s)){s=s.substring(h.raw.length),n.push(h);continue}if(h=this.tokenizer.reflink(s,this.tokens.links)){s=s.substring(h.raw.length);const g=n.at(-1);h.type==="text"&&(g==null?void 0:g.type)==="text"?(g.raw+=h.raw,g.text+=h.text):n.push(h);continue}if(h=this.tokenizer.emStrong(s,a,l)){s=s.substring(h.raw.length),n.push(h);continue}if(h=this.tokenizer.codespan(s)){s=s.substring(h.raw.length),n.push(h);continue}if(h=this.tokenizer.br(s)){s=s.substring(h.raw.length),n.push(h);continue}if(h=this.tokenizer.del(s)){s=s.substring(h.raw.length),n.push(h);continue}if(h=this.tokenizer.autolink(s)){s=s.substring(h.raw.length),n.push(h);continue}if(!this.state.inLink&&(h=this.tokenizer.url(s))){s=s.substring(h.raw.length),n.push(h);continue}let p=s;if((u=this.options.extensions)!=null&&u.startInline){let g=1/0;const x=s.slice(1);let b;this.options.extensions.startInline.forEach(j=>{b=j.call({lexer:this},x),typeof b=="number"&&b>=0&&(g=Math.min(g,b))}),g<1/0&&g>=0&&(p=s.substring(0,g+1))}if(h=this.tokenizer.inlineText(p)){s=s.substring(h.raw.length),h.raw.slice(-1)!=="_"&&(l=h.raw.slice(-1)),o=!0;const g=n.at(-1);(g==null?void 0:g.type)==="text"?(g.raw+=h.raw,g.text+=h.text):n.push(h);continue}if(s){const g="Infinite loop on byte: "+s.charCodeAt(0);if(this.options.silent){console.error(g);break}else throw new Error(g)}}return n}},su=class{constructor(t){ht(this,"options");ht(this,"parser");this.options=t||io}space(t){return""}code({text:t,lang:s,escaped:n}){var o;const a=(o=(s||"").match(An.notSpaceStart))==null?void 0:o[0],r=t.replace(An.endingNewline,"")+`
`;return a?'<pre><code class="language-'+Qa(a)+'">'+(n?r:Qa(r,!0))+`</code></pre>
`:"<pre><code>"+(n?r:Qa(r,!0))+`</code></pre>
`}blockquote({tokens:t}){return`<blockquote>
${this.parser.parse(t)}</blockquote>
`}html({text:t}){return t}heading({tokens:t,depth:s}){return`<h${s}>${this.parser.parseInline(t)}</h${s}>
`}hr(t){return`<hr>
`}list(t){const s=t.ordered,n=t.start;let a="";for(let l=0;l<t.items.length;l++){const c=t.items[l];a+=this.listitem(c)}const r=s?"ol":"ul",o=s&&n!==1?' start="'+n+'"':"";return"<"+r+o+`>
`+a+"</"+r+`>
`}listitem(t){var n;let s="";if(t.task){const a=this.checkbox({checked:!!t.checked});t.loose?((n=t.tokens[0])==null?void 0:n.type)==="paragraph"?(t.tokens[0].text=a+" "+t.tokens[0].text,t.tokens[0].tokens&&t.tokens[0].tokens.length>0&&t.tokens[0].tokens[0].type==="text"&&(t.tokens[0].tokens[0].text=a+" "+Qa(t.tokens[0].tokens[0].text),t.tokens[0].tokens[0].escaped=!0)):t.tokens.unshift({type:"text",raw:a+" ",text:a+" ",escaped:!0}):s+=a+" "}return s+=this.parser.parse(t.tokens,!!t.loose),`<li>${s}</li>
`}checkbox({checked:t}){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:t}){return`<p>${this.parser.parseInline(t)}</p>
`}table(t){let s="",n="";for(let r=0;r<t.header.length;r++)n+=this.tablecell(t.header[r]);s+=this.tablerow({text:n});let a="";for(let r=0;r<t.rows.length;r++){const o=t.rows[r];n="";for(let l=0;l<o.length;l++)n+=this.tablecell(o[l]);a+=this.tablerow({text:n})}return a&&(a=`<tbody>${a}</tbody>`),`<table>
<thead>
`+s+`</thead>
`+a+`</table>
`}tablerow({text:t}){return`<tr>
${t}</tr>
`}tablecell(t){const s=this.parser.parseInline(t.tokens),n=t.header?"th":"td";return(t.align?`<${n} align="${t.align}">`:`<${n}>`)+s+`</${n}>
`}strong({tokens:t}){return`<strong>${this.parser.parseInline(t)}</strong>`}em({tokens:t}){return`<em>${this.parser.parseInline(t)}</em>`}codespan({text:t}){return`<code>${Qa(t,!0)}</code>`}br(t){return"<br>"}del({tokens:t}){return`<del>${this.parser.parseInline(t)}</del>`}link({href:t,title:s,tokens:n}){const a=this.parser.parseInline(n),r=fv(t);if(r===null)return a;t=r;let o='<a href="'+t+'"';return s&&(o+=' title="'+Qa(s)+'"'),o+=">"+a+"</a>",o}image({href:t,title:s,text:n,tokens:a}){a&&(n=this.parser.parseInline(a,this.parser.textRenderer));const r=fv(t);if(r===null)return Qa(n);t=r;let o=`<img src="${t}" alt="${n}"`;return s&&(o+=` title="${Qa(s)}"`),o+=">",o}text(t){return"tokens"in t&&t.tokens?this.parser.parseInline(t.tokens):"escaped"in t&&t.escaped?t.text:Qa(t.text)}},cp=class{strong({text:t}){return t}em({text:t}){return t}codespan({text:t}){return t}del({text:t}){return t}html({text:t}){return t}text({text:t}){return t}link({text:t}){return""+t}image({text:t}){return""+t}br(){return""}},Lr=class mf{constructor(s){ht(this,"options");ht(this,"renderer");ht(this,"textRenderer");this.options=s||io,this.options.renderer=this.options.renderer||new su,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new cp}static parse(s,n){return new mf(n).parse(s)}static parseInline(s,n){return new mf(n).parseInline(s)}parse(s,n=!0){var r,o;let a="";for(let l=0;l<s.length;l++){const c=s[l];if((o=(r=this.options.extensions)==null?void 0:r.renderers)!=null&&o[c.type]){const u=c,h=this.options.extensions.renderers[u.type].call({parser:this},u);if(h!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(u.type)){a+=h||"";continue}}const m=c;switch(m.type){case"space":{a+=this.renderer.space(m);continue}case"hr":{a+=this.renderer.hr(m);continue}case"heading":{a+=this.renderer.heading(m);continue}case"code":{a+=this.renderer.code(m);continue}case"table":{a+=this.renderer.table(m);continue}case"blockquote":{a+=this.renderer.blockquote(m);continue}case"list":{a+=this.renderer.list(m);continue}case"html":{a+=this.renderer.html(m);continue}case"paragraph":{a+=this.renderer.paragraph(m);continue}case"text":{let u=m,h=this.renderer.text(u);for(;l+1<s.length&&s[l+1].type==="text";)u=s[++l],h+=`
`+this.renderer.text(u);n?a+=this.renderer.paragraph({type:"paragraph",raw:h,text:h,tokens:[{type:"text",raw:h,text:h,escaped:!0}]}):a+=h;continue}default:{const u='Token with "'+m.type+'" type was not found.';if(this.options.silent)return console.error(u),"";throw new Error(u)}}}return a}parseInline(s,n=this.renderer){var r,o;let a="";for(let l=0;l<s.length;l++){const c=s[l];if((o=(r=this.options.extensions)==null?void 0:r.renderers)!=null&&o[c.type]){const u=this.options.extensions.renderers[c.type].call({parser:this},c);if(u!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(c.type)){a+=u||"";continue}}const m=c;switch(m.type){case"escape":{a+=n.text(m);break}case"html":{a+=n.html(m);break}case"link":{a+=n.link(m);break}case"image":{a+=n.image(m);break}case"strong":{a+=n.strong(m);break}case"em":{a+=n.em(m);break}case"codespan":{a+=n.codespan(m);break}case"br":{a+=n.br(m);break}case"del":{a+=n.del(m);break}case"text":{a+=n.text(m);break}default:{const u='Token with "'+m.type+'" type was not found.';if(this.options.silent)return console.error(u),"";throw new Error(u)}}}return a}},Fh,Fd=(Fh=class{constructor(t){ht(this,"options");ht(this,"block");this.options=t||io}preprocess(t){return t}postprocess(t){return t}processAllTokens(t){return t}provideLexer(){return this.block?Or.lex:Or.lexInline}provideParser(){return this.block?Lr.parse:Lr.parseInline}},ht(Fh,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"])),Fh),_O=class{constructor(...t){ht(this,"defaults",tp());ht(this,"options",this.setOptions);ht(this,"parse",this.parseMarkdown(!0));ht(this,"parseInline",this.parseMarkdown(!1));ht(this,"Parser",Lr);ht(this,"Renderer",su);ht(this,"TextRenderer",cp);ht(this,"Lexer",Or);ht(this,"Tokenizer",tu);ht(this,"Hooks",Fd);this.use(...t)}walkTokens(t,s){var a,r;let n=[];for(const o of t)switch(n=n.concat(s.call(this,o)),o.type){case"table":{const l=o;for(const c of l.header)n=n.concat(this.walkTokens(c.tokens,s));for(const c of l.rows)for(const m of c)n=n.concat(this.walkTokens(m.tokens,s));break}case"list":{const l=o;n=n.concat(this.walkTokens(l.items,s));break}default:{const l=o;(r=(a=this.defaults.extensions)==null?void 0:a.childTokens)!=null&&r[l.type]?this.defaults.extensions.childTokens[l.type].forEach(c=>{const m=l[c].flat(1/0);n=n.concat(this.walkTokens(m,s))}):l.tokens&&(n=n.concat(this.walkTokens(l.tokens,s)))}}return n}use(...t){const s=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach(n=>{const a={...n};if(a.async=this.defaults.async||a.async||!1,n.extensions&&(n.extensions.forEach(r=>{if(!r.name)throw new Error("extension name required");if("renderer"in r){const o=s.renderers[r.name];o?s.renderers[r.name]=function(...l){let c=r.renderer.apply(this,l);return c===!1&&(c=o.apply(this,l)),c}:s.renderers[r.name]=r.renderer}if("tokenizer"in r){if(!r.level||r.level!=="block"&&r.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");const o=s[r.level];o?o.unshift(r.tokenizer):s[r.level]=[r.tokenizer],r.start&&(r.level==="block"?s.startBlock?s.startBlock.push(r.start):s.startBlock=[r.start]:r.level==="inline"&&(s.startInline?s.startInline.push(r.start):s.startInline=[r.start]))}"childTokens"in r&&r.childTokens&&(s.childTokens[r.name]=r.childTokens)}),a.extensions=s),n.renderer){const r=this.defaults.renderer||new su(this.defaults);for(const o in n.renderer){if(!(o in r))throw new Error(`renderer '${o}' does not exist`);if(["options","parser"].includes(o))continue;const l=o,c=n.renderer[l],m=r[l];r[l]=(...u)=>{let h=c.apply(r,u);return h===!1&&(h=m.apply(r,u)),h||""}}a.renderer=r}if(n.tokenizer){const r=this.defaults.tokenizer||new tu(this.defaults);for(const o in n.tokenizer){if(!(o in r))throw new Error(`tokenizer '${o}' does not exist`);if(["options","rules","lexer"].includes(o))continue;const l=o,c=n.tokenizer[l],m=r[l];r[l]=(...u)=>{let h=c.apply(r,u);return h===!1&&(h=m.apply(r,u)),h}}a.tokenizer=r}if(n.hooks){const r=this.defaults.hooks||new Fd;for(const o in n.hooks){if(!(o in r))throw new Error(`hook '${o}' does not exist`);if(["options","block"].includes(o))continue;const l=o,c=n.hooks[l],m=r[l];Fd.passThroughHooks.has(o)?r[l]=u=>{if(this.defaults.async)return Promise.resolve(c.call(r,u)).then(p=>m.call(r,p));const h=c.call(r,u);return m.call(r,h)}:r[l]=(...u)=>{let h=c.apply(r,u);return h===!1&&(h=m.apply(r,u)),h}}a.hooks=r}if(n.walkTokens){const r=this.defaults.walkTokens,o=n.walkTokens;a.walkTokens=function(l){let c=[];return c.push(o.call(this,l)),r&&(c=c.concat(r.call(this,l))),c}}this.defaults={...this.defaults,...a}}),this}setOptions(t){return this.defaults={...this.defaults,...t},this}lexer(t,s){return Or.lex(t,s??this.defaults)}parser(t,s){return Lr.parse(t,s??this.defaults)}parseMarkdown(t){return(n,a)=>{const r={...a},o={...this.defaults,...r},l=this.onError(!!o.silent,!!o.async);if(this.defaults.async===!0&&r.async===!1)return l(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof n>"u"||n===null)return l(new Error("marked(): input parameter is undefined or null"));if(typeof n!="string")return l(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(n)+", string expected"));o.hooks&&(o.hooks.options=o,o.hooks.block=t);const c=o.hooks?o.hooks.provideLexer():t?Or.lex:Or.lexInline,m=o.hooks?o.hooks.provideParser():t?Lr.parse:Lr.parseInline;if(o.async)return Promise.resolve(o.hooks?o.hooks.preprocess(n):n).then(u=>c(u,o)).then(u=>o.hooks?o.hooks.processAllTokens(u):u).then(u=>o.walkTokens?Promise.all(this.walkTokens(u,o.walkTokens)).then(()=>u):u).then(u=>m(u,o)).then(u=>o.hooks?o.hooks.postprocess(u):u).catch(l);try{o.hooks&&(n=o.hooks.preprocess(n));let u=c(n,o);o.hooks&&(u=o.hooks.processAllTokens(u)),o.walkTokens&&this.walkTokens(u,o.walkTokens);let h=m(u,o);return o.hooks&&(h=o.hooks.postprocess(h)),h}catch(u){return l(u)}}}onError(t,s){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,t){const a="<p>An error occurred:</p><pre>"+Qa(n.message+"",!0)+"</pre>";return s?Promise.resolve(a):a}if(s)return Promise.reject(n);throw n}}},eo=new _O;function zt(t,s){return eo.parse(t,s)}zt.options=zt.setOptions=function(t){return eo.setOptions(t),zt.defaults=eo.defaults,xj(zt.defaults),zt};zt.getDefaults=tp;zt.defaults=io;zt.use=function(...t){return eo.use(...t),zt.defaults=eo.defaults,xj(zt.defaults),zt};zt.walkTokens=function(t,s){return eo.walkTokens(t,s)};zt.parseInline=eo.parseInline;zt.Parser=Lr;zt.parser=Lr.parse;zt.Renderer=su;zt.TextRenderer=cp;zt.Lexer=Or;zt.lexer=Or.lex;zt.Tokenizer=tu;zt.Hooks=Fd;zt.parse=zt;zt.options;zt.setOptions;zt.use;zt.walkTokens;zt.parseInline;Lr.parse;Or.lex;zt.setOptions({breaks:!0,gfm:!0});const Tj=t=>{try{const s=zt.parse(t);return Fr.sanitize(s)}catch{return Fr.sanitize(t.replace(/\n/g,"<br>"))}},_u=t=>{const s=t.match(/^\s*- \[(?: |x|X)\]/gm);if(!s||s.length===0)return{total:0,checked:0};const n=s.filter(a=>a.toLowerCase().startsWith("- [x]")).length;return{total:s.length,checked:n}},ai=t=>{const{total:s,checked:n}=_u(t);return s?n/s*100:0};async function gv(t){const a=$t(fe,"tasks"),r=nn(a,wt("userId","==",t));try{const o=await an(r),l=new Set;if(o.forEach(u=>{const h=u.data();h.taskCode&&typeof h.taskCode=="number"&&l.add(h.taskCode)}),l.size===0)return 1e4;const c=Array.from(l).sort((u,h)=>u-h);for(let u=0;u<c.length-1;u++)if(c[u+1]-c[u]>1)return c[u]+1;const m=Math.max(...c);return m<99999?m+1:await vv(t,l)}catch(o){return console.error("Error generating task code:",o),await vv(t,new Set)}}async function vv(t,s){for(let o=0;o<10;o++){const l=Math.floor(Math.random()*9e4)+1e4;if(!s.has(l)&&await PO(t,l))return l}throw new Error("Unable to generate unique task code after multiple attempts")}async function PO(t,s){try{const n=$t(fe,"tasks"),a=nn(n,wt("userId","==",t),wt("taskCode","==",s));return(await an(a)).empty}catch(n){return console.error("Error checking task code uniqueness:",n),!1}}const oo=()=>{const[t,s]=f.useState([]),[n,a]=f.useState([]),[r,o]=f.useState("idle"),[l,c]=f.useState(null),[m,u]=f.useState(!1),[h,p]=f.useState(null),[g,x]=f.useState("create"),{user:b}=qe(),j=f.useCallback(()=>t.filter(R=>!R.isPrivate),[t]),v=f.useCallback(()=>{u(!1),p(null),o("idle"),c(null),x("create")},[]),w=f.useCallback(async()=>{if(b){o("loading"),c(null);try{Me.logRead("tasks","useTaskData.loadTasks");const R=nn($t(fe,"tasks"),wt("userId","==",b.uid)),W=(await an(R)).docs.map(L=>{var q,re,Y,se,ie;const $=L.data();return{id:L.id,taskCode:$.taskCode||0,title:$.title,description:$.description||"",completed:$.completed,createdAt:$.createdAt,updatedAt:(q=$.updatedAt)==null?void 0:q.toDate(),startDate:((re=$.startDate)==null?void 0:re.toDate())||((Y=$.startDate)==null?void 0:Y.toDate()),endDate:(se=$.endDate)==null?void 0:se.toDate(),isRecurrent:$.isRecurrent||!1,isPrivate:$.isPrivate||!1,category:$.category||"other",priority:$.priority||"delete",size:$.size||"pequeña",estimatedTime:$.estimatedTime,timeOfDay:$.timeOfDay,elapsedSeconds:$.elapsedSeconds||0,progress:typeof $.progress=="number"?$.progress:ai($.description||""),recurrence:$.recurrence?{frequency:$.recurrence.frequency,pattern:$.recurrence.pattern,customDays:$.recurrence.customDays,nextDate:(ie=$.recurrence.nextDate)==null?void 0:ie.toDate()}:void 0}});a(W);const H=W.filter(L=>!L.completed).sort((L,$)=>{var q,re;return L.startDate&&$.startDate?L.startDate.getTime()-$.startDate.getTime():L.startDate?-1:$.startDate?1:(((q=$.createdAt)==null?void 0:q.seconds)||0)-(((re=L.createdAt)==null?void 0:re.seconds)||0)});s(H),o("saved")}catch(R){console.error("Error loading tasks:",R),Xd(R)?(console.warn("Firestore internal error detected. This may require cache clearing."),c("Error de sincronización detectado. Puedes intentar limpiar el cache offline si el problema persiste.")):c(R instanceof Error?R.message:"Error loading tasks"),o("error")}}},[b]);f.useEffect(()=>{w()},[w]);const N=f.useCallback(async R=>{var M,W;if(!(!R.title.trim()||!b)){o("saving"),c(null);try{if(R.startDate&&R.endDate&&R.endDate<R.startDate){c("La fecha de fin debe ser posterior a la fecha de inicio"),o("error");return}const H=await gv(b.uid),L={id:`temp-${Date.now()}`,taskCode:H,title:R.title.trim(),description:((M=R.description)==null?void 0:M.trim())||"",completed:!1,createdAt:{seconds:Date.now()/1e3},startDate:R.startDate||void 0,endDate:R.endDate||void 0,category:R.category||"other",priority:R.priority||"delete",size:R.size||"pequeña",elapsedSeconds:0,progress:ai(R.description||""),isRecurrent:R.isRecurrent||!1,isPrivate:R.isPrivate||!1,...R.timeOfDay&&{timeOfDay:R.timeOfDay},...R.estimatedTime!==void 0&&{estimatedTime:R.estimatedTime},...R.recurrence&&{recurrence:R.recurrence}};s(re=>[...re,L].sort((Y,se)=>{var ie,U;return Y.startDate&&se.startDate?Y.startDate.getTime()-se.startDate.getTime():Y.startDate?-1:se.startDate?1:(((ie=se.createdAt)==null?void 0:ie.seconds)||0)-(((U=Y.createdAt)==null?void 0:U.seconds)||0)}));const $={userId:b.uid,taskCode:H,title:R.title.trim(),completed:!1,createdAt:dt(),category:R.category||"other",priority:R.priority||"delete",size:R.size||"pequeña",elapsedSeconds:0,...R.timeOfDay&&{timeOfDay:R.timeOfDay},...R.estimatedTime!==void 0&&{estimatedTime:R.estimatedTime}};$.progress=ai(R.description||""),(W=R.description)!=null&&W.trim()&&($.description=R.description.trim()),R.startDate&&($.startDate=tr.fromDate(R.startDate)),R.endDate&&($.endDate=tr.fromDate(R.endDate)),R.isPrivate&&($.isPrivate=!0),R.isRecurrent&&R.recurrence&&($.isRecurrent=!0,$.recurrence={frequency:R.recurrence.frequency,pattern:R.recurrence.pattern},R.recurrence.pattern==="custom"&&R.recurrence.customDays&&($.recurrence.customDays=R.recurrence.customDays)),Me.logWrite("tasks","useTaskData.addTask");const q=await Ao($t(fe,"tasks"),$);s(re=>re.map(Y=>Y.id===L.id?{...Y,id:q.id}:Y)),o("saved")}catch(H){console.error("Error al guardar tarea:",H),Xd(H)?(console.warn("Firestore internal error detected during task creation."),c("Error de sincronización. La tarea puede haberse guardado pero hay un problema con el cache local."),setTimeout(()=>{w()},2e3)):H instanceof Error&&H.message.includes("taskCode")?c("Error al generar código de tarea único"):(s(L=>L.filter($=>$.id.startsWith("temp-"))),c(H instanceof Error?H.message:"Error al guardar")),o("error")}}},[b]),S=f.useCallback(async(R,M)=>{var H,L;if(!b)return;o("saving");const W=t.find($=>$.id===R);if(W)try{const $=M.startDate!==void 0?M.startDate:W.startDate,q=M.endDate!==void 0?M.endDate:W.endDate;if($&&q&&q<$){c("La fecha de fin debe ser posterior a la fecha de inicio"),o("error");return}const re={...W,...((H=M.title)==null?void 0:H.trim())&&{title:M.title.trim()},...typeof M.description=="string"&&{description:M.description.trim()},...M.startDate!==void 0&&{startDate:M.startDate||void 0},...M.endDate!==void 0&&{endDate:M.endDate||void 0},...M.category&&{category:M.category},...M.priority&&{priority:M.priority},...M.size&&{size:M.size},...M.estimatedTime!==void 0&&{estimatedTime:M.estimatedTime},...M.timeOfDay&&{timeOfDay:M.timeOfDay},...M.isPrivate!==void 0&&{isPrivate:M.isPrivate},...M.isRecurrent!==void 0&&{isRecurrent:M.isRecurrent},...M.recurrence&&{recurrence:M.recurrence}};re.progress=ai(typeof M.description=="string"?M.description:W.description||""),s(ie=>ie.map(U=>U.id===R?re:U).sort((U,ee)=>{var me,ue;return U.startDate&&ee.startDate?U.startDate.getTime()-ee.startDate.getTime():U.startDate?-1:ee.startDate?1:(((me=ee.createdAt)==null?void 0:me.seconds)||0)-(((ue=U.createdAt)==null?void 0:ue.seconds)||0)}));const Y=Te(fe,"tasks",R),se={updatedAt:dt()};(L=M.title)!=null&&L.trim()&&(se.title=M.title.trim()),typeof M.description=="string"&&(se.description=M.description.trim()||null),M.startDate!==void 0&&(se.startDate=M.startDate?tr.fromDate(M.startDate):null),M.endDate!==void 0&&(se.endDate=M.endDate?tr.fromDate(M.endDate):null),M.category&&(se.category=M.category),M.priority&&(se.priority=M.priority),M.size&&(se.size=M.size),M.estimatedTime!==void 0&&(se.estimatedTime=M.estimatedTime),M.timeOfDay&&(se.timeOfDay=M.timeOfDay),M.isPrivate!==void 0&&(se.isPrivate=M.isPrivate),M.isRecurrent!==void 0&&(se.isRecurrent=M.isRecurrent,M.isRecurrent||(se.recurrence=null)),M.recurrence&&(se.recurrence={frequency:M.recurrence.frequency,pattern:M.recurrence.pattern},M.recurrence.pattern==="custom"&&M.recurrence.customDays&&(se.recurrence.customDays=M.recurrence.customDays)),se.progress=re.progress,Me.logWrite("tasks","useTaskData.editTask",R),await Hn(Y,se),o("saved"),v()}catch($){console.error("Error al actualizar:",$),s(q=>q.map(re=>re.id===R?W:re)),c($ instanceof Error?$.message:"Error al actualizar"),o("error")}},[b,t,v]),E=f.useCallback(async(R,M)=>{if(b){o("saving");try{const W=t.find(H=>H.id===R);if(!W)throw new Error("Tarea no encontrada");if(!W.isRecurrent){M&&s(L=>L.filter($=>$.id!==R));const H=Te(fe,"tasks",R);Me.logWrite("tasks","useTaskData.toggleTask",R),await Hn(H,{completed:M,updatedAt:dt()}),o("saved");return}p(W),x("complete"),u(!0)}catch(W){if(console.error("Error al actualizar estado:",W),M){const H=t.find(L=>L.id===R);H&&s(L=>[...L,H])}c(W instanceof Error?W.message:"Error al actualizar"),o("error")}}},[b,t]),T=f.useCallback(async R=>{if(!b)return;o("saving");const M=t.find(W=>W.id===R);if(M)try{s(W=>W.filter(H=>H.id!==R)),Me.logDelete("tasks","useTaskData.deleteTask",R),await ao(Te(fe,"tasks",R)),o("saved")}catch(W){console.error("Error al eliminar:",W),s(H=>[...H,M].sort((L,$)=>{var q,re;return L.startDate&&$.startDate?L.startDate.getTime()-$.startDate.getTime():L.startDate?-1:$.startDate?1:(((q=$.createdAt)==null?void 0:q.seconds)||0)-(((re=L.createdAt)==null?void 0:re.seconds)||0)})),c(W instanceof Error?W.message:"Error al eliminar"),o("error")}},[b,t]),k=f.useCallback(async R=>{var M,W,H,L,$,q,re,Y,se,ie;if(!(!h||!b)){o("saving");try{const U=await gv(b.uid),ee={id:`temp-${Date.now()}`,taskCode:U,title:h.title,description:((M=R.description)==null?void 0:M.trim())||h.description||"",completed:!1,createdAt:{seconds:Date.now()/1e3},startDate:R.startDate||void 0,endDate:R.endDate||void 0,isRecurrent:!0,category:h.category,priority:h.priority||"delete",size:h.size||"pequeña",elapsedSeconds:0,progress:ai(((W=R.description)==null?void 0:W.trim())||h.description||""),isPrivate:h.isPrivate||!1,...R.timeOfDay&&{timeOfDay:R.timeOfDay},recurrence:{pattern:((H=h.recurrence)==null?void 0:H.pattern)||"daily",frequency:((L=h.recurrence)==null?void 0:L.frequency)||1,...(($=h.recurrence)==null?void 0:$.pattern)==="custom"&&{customDays:h.recurrence.customDays}}};s(ge=>[...ge.filter(we=>we.id!==h.id),ee].sort((we,ke)=>{var de,J;return we.startDate&&ke.startDate?we.startDate.getTime()-ke.startDate.getTime():we.startDate?-1:ke.startDate?1:(((de=ke.createdAt)==null?void 0:de.seconds)||0)-(((J=we.createdAt)==null?void 0:J.seconds)||0)}));const me=Te(fe,"tasks",h.id);Me.logWrite("tasks","useTaskData.completeRecurrentTask",h.id),await Hn(me,{completed:!0,updatedAt:dt()});const ue={userId:b.uid,taskCode:U,title:h.title,completed:!1,createdAt:dt(),elapsedSeconds:0,startDate:R.startDate?tr.fromDate(R.startDate):null,endDate:R.endDate?tr.fromDate(R.endDate):null,isRecurrent:!0,category:h.category,priority:h.priority||"delete",size:h.size||"pequeña",...R.timeOfDay&&{timeOfDay:R.timeOfDay},recurrence:{pattern:((q=h.recurrence)==null?void 0:q.pattern)||"daily",frequency:((re=h.recurrence)==null?void 0:re.frequency)||1,...((Y=h.recurrence)==null?void 0:Y.pattern)==="custom"&&{customDays:h.recurrence.customDays}}};((se=R.description)!=null&&se.trim()||h.description)&&(ue.description=((ie=R.description)==null?void 0:ie.trim())||h.description),ue.progress=ai(ue.description||""),Me.logWrite("tasks","useTaskData.completeRecurrentTask.next");const ae=await Ao($t(fe,"tasks"),ue);s(ge=>ge.map(je=>je.id===ee.id?{...je,id:ae.id}:je)),o("saved"),v()}catch(U){console.error("Error al procesar tarea recurrente:",U),U instanceof Error&&U.message.includes("taskCode")?c("Error al generar código de tarea recurrente"):(s(ee=>[...ee.filter(ue=>!ue.id.startsWith("temp-")),h].sort((ue,ae)=>{var ge,je;return ue.startDate&&ae.startDate?ue.startDate.getTime()-ae.startDate.getTime():ue.startDate?-1:ae.startDate?1:(((ge=ae.createdAt)==null?void 0:ge.seconds)||0)-(((je=ue.createdAt)==null?void 0:je.seconds)||0)})),c(U instanceof Error?U.message:"Error al actualizar tarea recurrente")),o("error")}}},[h,b,v]),D=f.useCallback((R,M)=>{x("create"),p({id:"",taskCode:0,title:"",completed:!1,category:"personal",priority:"delete",size:"pequeña",createdAt:{seconds:Date.now()/1e3},...R?{startDate:R}:{},...M?{isPrivate:!0}:{},timeOfDay:void 0,progress:0}),u(!0)},[]),P=f.useCallback(R=>{p(R),x("edit"),u(!0),o("idle")},[]),_=dr("Task data"),B=f.useCallback(async()=>{try{o("loading"),c(null),await Jd()}catch(R){console.error("Error clearing cache:",R),c("Error al limpiar el cache. Intenta recargar la página manualmente."),o("error")}},[]),I=f.useMemo(()=>t.filter(R=>!R.isPrivate),[t]);return f.useMemo(()=>({tasks:I,allTasks:n,status:r,error:l,showRecurrenceModal:m,currentTask:h,modalMode:g,addTask:N,editTask:S,toggleTask:E,deleteTask:T,completeRecurrentTask:k,setShowRecurrenceModal:v,openEditModal:P,openCreateModal:D,getPublicTasks:j,loadTasks:w,resync:_,clearCacheAndReload:B}),[I,t,n,r,l,m,h,g,N,S,E,T,k,v,D,j,w,_,B])},MO=({date:t,variant:s="compact"})=>{const n=Xt(),{allTasks:a,status:r}=oo(),o=r==="loading",l=cs(t),c=Mr(t),m=a.filter(x=>{if(!x.completed||!x.updatedAt)return!1;const b=x.updatedAt;return b>=l&&b<=c}).length,u=a.filter(x=>x.completed||!x.startDate?!1:x.startDate<=c).length,h=a.filter(x=>{if(x.completed||!x.startDate)return!1;const b=x.startDate;return b>=l&&b<=c}).length,p=a.filter(x=>x.completed||!x.startDate?!1:x.startDate<l).length,g=()=>{n("/task/list")};return e.jsx(ga,{title:"Tareas",icon:Yd,variant:s,loading:o,onClick:()=>n("/task/list"),children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-lg font-bold text-purple-600",children:[m,"/",u]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[h," hoy",p>0&&e.jsxs("span",{className:"text-red-500 ml-1",children:["• ",p," vencidas"]})]})]}),e.jsxs(z,{size:"sm",variant:"outline",onClick:x=>{x.stopPropagation(),g()},className:"flex items-center gap-1",children:[e.jsx(as,{className:"w-3 h-3"}),s==="detailed"&&"Nueva"]})]}),s==="detailed"&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-purple-500 h-2 rounded-full transition-all duration-300",style:{width:`${u>0?m/u*100:0}%`}})}),e.jsx("p",{className:"text-xs text-gray-600",children:u>0?`${(m/u*100).toFixed(0)}% progreso diario`:"Sin tareas pendientes"})]})]})})},IO=(t,s)=>{const n=Rn.length,a=t!=null&&t.habits?Object.entries(t.habits).filter(([c,m])=>c.endsWith(`_${s}`)&&m).map(([c])=>{const m=parseInt(c.split("_")[0]);return Rn.find(u=>u.id===m)}).filter(Boolean):[],r=a.length,o=Rn.filter(c=>!a.some(m=>(m==null?void 0:m.id)===c.id)),l=["morning","afternoon","night","anytime"].map(c=>{const m=o.filter(u=>u.timeOfDay===c);return{timeOfDay:c,habits:m.map(u=>({id:u.id,name:u.name,icon:u.icon,goal:u.goal}))}}).filter(c=>c.habits.length>0);return{completed:r,total:n,incompletedByTimeOfDay:l}},OO=t=>{if(!(t!=null&&t.drinks)||!Array.isArray(t.drinks))return[];const s=new Map;return t.drinks.forEach(n=>{const a=n.type,r=n.amount||0;if(s.has(a)){const o=s.get(a);s.set(a,{amount:o.amount+r,count:o.count+1})}else s.set(a,{amount:r,count:1})}),Array.from(s.entries()).map(([n,a])=>({type:n,amount:a.amount,count:a.count})).sort((n,a)=>a.amount-n.amount)},LO=t=>{if(!(t!=null&&t.moods)||!Array.isArray(t.moods))return{count:0,average:0,highest:0,lowest:0,details:[]};const s=t.moods,n=s.length;if(n===0)return{count:0,average:0,highest:0,lowest:0,details:[]};const a=cj(s),r=s.map(m=>m.value??Qd(m.text)),o=Math.max(...r),l=Math.min(...r),c=s.map(m=>({emoji:m.emoji,text:m.text,value:m.value??Qd(m.text),time:m.time}));return{count:n,average:a,highest:o,lowest:l,details:c}},Dj=async(t,s)=>{var c;const n=$e(s),[a,r]=n.split("-"),o=tr.fromDate(cs(s)),l=tr.fromDate(Mr(s));try{const m=await st(Te(fe,"journal",`${t}_${n}`)),u=await st(Te(fe,"moods",`${t}_${n}`)),h=await st(Te(fe,"water",`${t}_${n}`)),p=await st(Te(fe,"exercises",`${t}_${n}`)),g=await st(Te(fe,"pomodoro",`${t}_${n}`)),x=await st(Te(fe,"habits",`${t}_${a}-${r}`)),b=await st(Te(fe,"negative-habits",`${t}_${a}-${r}`)),j=nn($t(fe,"tasks"),wt("userId","==",t),wt("completed","==",!0),wt("updatedAt",">=",o),wt("updatedAt","<=",l)),w=(await an(j)).size,N=nn($t(fe,"tasks"),wt("userId","==",t),wt("completed","==",!1),wt("dueDate","<=",l)),E=(await an(N)).size,T=nn($t(fe,"tasks"),wt("userId","==",t),wt("completed","==",!1),wt("dueDate",">=",o),wt("dueDate","<=",l)),D=(await an(T)).size,P=nn($t(fe,"tasks"),wt("userId","==",t),wt("completed","==",!1),wt("dueDate","<",o)),B=(await an(P)).size;return{journal:{words:m.exists()?(m.data().text||"").split(/\s+/).filter(Boolean).length:0},mood:LO(u.exists()?u.data():null),water:{intake:h.exists()&&h.data().totalWater||0,drinkDetails:h.exists()?OO(h.data()):[]},exercise:(()=>{var H,L;const R=p.exists()?p.data():null;console.log("🏃 fetchDailySummary - Exercise data for",n,":",R),console.log("🏃 fetchDailySummary - Exercise summary:",R==null?void 0:R.summary);const M=((H=R==null?void 0:R.summary)==null?void 0:H.totalDuration)||0,W=((L=R==null?void 0:R.summary)==null?void 0:L.totalCalories)||0;return console.log("🏃 fetchDailySummary - extracted minutes:",M,"calories:",W),{minutes:M,calories:W}})(),pomodoro:(()=>{var q;const R=g.exists()?g.data():null;console.log("🍅 fetchDailySummary - Pomodoro data for",n,":",R);const M=(R==null?void 0:R.count)||0;let W=0;R!=null&&R.sessions&&Array.isArray(R.sessions)&&(W=R.sessions.reduce((re,Y)=>{const se=Y.duration?Math.round(Y.duration/60):0;return re+se},0)),console.log("🍅 fetchDailySummary - extracted count:",M,"workMinutes:",W),console.log("🍅 fetchDailySummary - sessions found:",((q=R==null?void 0:R.sessions)==null?void 0:q.length)||0),console.log("🍅 fetchDailySummary - available keys:",R?Object.keys(R):"no data");const H=300,L=H>0?Math.min(100,W/H*100):0,$=M>0?W/M:0;return{count:M,expectedMinutes:H,workMinutes:W,completionRate:parseFloat(L.toFixed(1)),averageSessionLength:parseFloat($.toFixed(1))}})(),habits:IO(x.exists()?x.data():null,n),negativeHabits:{count:b.exists()?Object.keys(((c=b.data().habits)==null?void 0:c[n])||{}).length:0},tasks:{completed:w,activeAndOverdue:E,todayPending:D,overdue:B}}}catch(m){throw console.error("❌ fetchDailySummary - Error in try block:",m),m}},$O={journal:{words:0},mood:{count:0,average:0,highest:0,lowest:0,details:[]},habits:{completed:0,total:Rn.length,incompletedByTimeOfDay:[]},negativeHabits:{count:0},exercise:{minutes:0,calories:0},tasks:{completed:0,activeAndOverdue:0,todayPending:0,overdue:0},pomodoro:{count:0,expectedMinutes:0,workMinutes:0,completionRate:0,averageSessionLength:0},water:{intake:0,drinkDetails:[]}},Pd=new Map,Ec=t=>{const{user:s}=qe(),[n,a]=f.useState($O),[r,o]=f.useState(!0),[l,c]=f.useState(null),m=f.useCallback(async()=>{if(!s){o(!1);return}const h=`${s.uid}_${$e(t)}`;if(Pd.has(h)){const p=Pd.get(h);a(p.summary),o(!1);return}o(!0),c(null);try{console.log("📊 Loading daily summary for:",$e(t));const p=await Dj(s.uid,t);Pd.set(h,{summary:p,loading:!1,subscribers:new Set,unsubscribes:[]}),a(p),o(!1)}catch(p){console.error("Error loading daily summary:",p),c(p instanceof Error?p.message:"Error loading summary"),o(!1)}},[s,t]);f.useEffect(()=>{m()},[m]);const u=f.useCallback(()=>{if(!s)return;const h=`${s.uid}_${$e(t)}`;Pd.delete(h),m()},[s,t,m]);return{summary:n,loading:r,error:l,refetch:u}},zO=({date:t,variant:s="compact"})=>{const n=Xt(),{summary:a,loading:r}=Ec(t),l=a.pomodoro.workMinutes,m=Math.min(l/300*100,100),u=Math.floor(l/60),h=l%60,p=u>0?`${u}h ${h}min`:`${h}min`,g=x=>{x.stopPropagation(),n("/pomodoro")};return e.jsx(ga,{title:"Pomodoro",icon:Ji,variant:s,loading:r,onClick:()=>n("/pomodoro"),children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-bold text-red-600",children:p}),e.jsxs("p",{className:"text-xs text-gray-500",children:["de 5h (",m.toFixed(0),"%)"]})]}),e.jsxs(z,{size:"sm",variant:"outline",onClick:g,className:"flex items-center gap-1 bg-red-50 hover:bg-red-100 border-red-200",children:[e.jsx(yn,{className:"w-3 h-3"}),s==="detailed"&&"Iniciar"]})]}),s==="detailed"&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{children:"Progreso diario"}),e.jsxs("span",{children:[m.toFixed(0),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-red-500 h-2 rounded-full transition-all duration-300",style:{width:`${Math.min(m,100)}%`}})})]})]})})},FO=({date:t,variant:s="compact"})=>{const n=Xt(),{summary:a,loading:r}=Ec(t),o=a.exercise.calories,l=a.exercise.minutes,c=500,m=Math.min(o/c*100,100),u=h=>{h.stopPropagation(),n("/exercise")};return e.jsx(ga,{title:"Ejercicio",icon:ub,variant:s,loading:r,onClick:()=>n("/exercise"),children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-lg font-bold text-green-600",children:[o," cal"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["de ",c," cal (",m.toFixed(0),"%) - ",l,"min"]})]}),e.jsxs(z,{size:"sm",variant:"outline",onClick:u,className:"flex items-center gap-1 bg-green-50 hover:bg-green-100 border-green-200",children:[e.jsx(as,{className:"w-3 h-3"}),s==="detailed"&&"Registrar"]})]}),s==="detailed"&&e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-300",style:{width:`${m}%`}})})]})})},BO=({date:t,variant:s="compact"})=>{const n=Xt(),{summary:a,loading:r}=Ec(t),o=a.journal.words,l=o>0,c=m=>{m.stopPropagation(),n("/journal")};return e.jsx(ga,{title:"Diario",icon:vc,variant:s,loading:r,onClick:()=>n("/journal"),children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:l?e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-lg font-bold text-indigo-600",children:[o," palabras"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Entrada registrada"})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Sin entrada"}),e.jsx("p",{className:"text-xs text-gray-400",children:"Escribe tus pensamientos"})]})}),e.jsxs(z,{size:"sm",variant:"outline",onClick:c,className:"flex items-center gap-1 bg-indigo-50 hover:bg-indigo-100 border-indigo-200",children:[e.jsx(sa,{className:"w-3 h-3"}),s==="detailed"&&(l?"Editar":"Escribir")]})]}),s==="detailed"&&l&&e.jsx("div",{className:"text-xs text-gray-600 p-2 bg-gray-50 rounded",children:e.jsxs("p",{children:["📝 Tienes una entrada de ",o," palabras para hoy"]})})]})})},kj=t=>{const[s,n]=f.useState(null),[a,r]=f.useState("idle"),[o,l]=f.useState(null),{user:c}=qe(),m=f.useCallback(async()=>{if(!c)return;r("saving"),l(null);const x=$e(t);try{Me.logRead("energy","useEnergyData.loadEnergyData");const b=Te($t(fe,"energy"),`${c.uid}_${x}`),j=await st(b);if(j.exists()){const v=j.data();v&&Array.isArray(v.entries)?n(v):n({id:`${c.uid}_${x}`,userId:c.uid,date:x,entries:[]})}else n(null);r("saved")}catch(b){console.error("Error loading energy data:",b),l(b instanceof Error?b.message:"Error loading energy data"),r("error")}},[c,t]);f.useEffect(()=>{m()},[m]);const u=f.useCallback(async(x,b)=>{if(!c)return;r("saving"),l(null);const j=$e(t),v=`${c.uid}_${j}`,w=new Date,N=cn(t,w.getHours(),w.getMinutes()),S={level:x,comment:b,timestamp:N.timestamp,time:w.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})},E=(s==null?void 0:s.entries)||[],T={id:v,userId:c.uid,date:j,entries:[...E,S]};n(T);try{const k=Te($t(fe,"energy"),v);Me.logWrite("energy","useEnergyData.addEntry"),await qt(k,T),r("saved")}catch(k){console.error("Energy - Error al guardar:",k),n(s),l(k instanceof Error?k.message:"Error al guardar"),r("error")}},[c,t,s]),h=f.useCallback(async(x,b)=>{if(!c||!s)return;r("saving"),l(null);const j=s;try{const v=s.entries.map(S=>S.timestamp===x?b:S),w={...s,entries:v};n(w);const N=Te($t(fe,"energy"),s.id);Me.logWrite("energy","useEnergyData.updateEntry",s.id),await qt(N,w),r("saved")}catch(v){console.error("Energy - Error al actualizar:",v),n(j),l(v instanceof Error?v.message:"Error al actualizar"),r("error")}},[c,s]),p=f.useCallback(async x=>{if(!c||!s)return;r("saving"),l(null);const b=s;try{const j=s.entries.filter(w=>w.timestamp!==x),v=Te($t(fe,"energy"),s.id);if(j.length===0)n(null),Me.logDelete("energy","useEnergyData.deleteEntry",s.id),await ao(v);else{const w={...s,entries:j};n(w),Me.logWrite("energy","useEnergyData.deleteEntry",s.id),await qt(v,w)}r("saved")}catch(j){console.error("Energy - Error al eliminar:",j),n(b),l(j instanceof Error?j.message:"Error al eliminar"),r("error")}},[c,s]),g=dr("Energy data");return{energyHistory:(s==null?void 0:s.entries)||[],status:a,error:o,addEntry:u,updateEntry:h,deleteEntry:p,loadEnergyData:m,resync:g}},HO=({date:t,variant:s="compact"})=>{const n=Xt(),{energyHistory:a,status:r}=kj(t),o=r==="saving"||r==="pending",l=a||[],c=l.length,m=l.length>0?l.reduce((x,b)=>x+b.level,0)/l.length:0,u=l[l.length-1],h=x=>x>=4.5?xb:x>=3.5?Uh:x>=2.5?Vh:x>=1.5?gb:vb,p=x=>x>=4.5?"text-green-600":x>=3.5?"text-lime-500":x>=2.5?"text-yellow-500":x>=1.5?"text-orange-500":"text-red-500",g=h(m);return e.jsx(ga,{title:"Nivel de Energía",icon:Uh,variant:s,loading:o,onClick:()=>n("/mood"),children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:c>0?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{className:`w-6 h-6 ${p(m)}`}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium",children:[m.toFixed(1),"/5"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[c," registro",c>1?"s":""]})]})]})}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Vh,{className:"w-6 h-6 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Sin registros"})]})}),e.jsxs(z,{size:"sm",variant:"outline",onClick:x=>{x.stopPropagation(),n("/mood")},className:"flex items-center gap-1",children:[e.jsx(as,{className:"w-3 h-3"}),s==="detailed"&&"Registrar"]})]}),s==="detailed"&&u&&e.jsxs("div",{className:"text-xs text-gray-600 p-2 bg-gray-50 rounded",children:[e.jsx("p",{className:"font-medium",children:"Último registro:"}),e.jsxs("p",{children:["Nivel ",u.level,"/5 - ",u.time,u.comment&&` - "${u.comment}"`]})]})]})})},WO=({date:t,variant:s="compact"})=>{const n=Xt(),{summary:a,loading:r,error:o}=Ec(t),l=at(t,"EEEE, d MMMM",{locale:kn}),c=[{label:"Hábitos",value:`${a.habits.completed}/${a.habits.total}`,progress:a.habits.total>0?a.habits.completed/a.habits.total*100:0,color:"bg-green-500"},{label:"Agua",value:`${a.water.intake}ml`,progress:Math.min(a.water.intake/2500*100,100),color:"bg-blue-500"},{label:"Tareas",value:`${a.tasks.completed}/${a.tasks.activeAndOverdue}`,progress:a.tasks.activeAndOverdue>0?a.tasks.completed/a.tasks.activeAndOverdue*100:0,color:"bg-purple-500"},{label:"Tiempo Trabajado",value:a.pomodoro.workMinutes>0?`${Math.floor(a.pomodoro.workMinutes/60)}h ${a.pomodoro.workMinutes%60}min`:"Sin datos",progress:Math.min(a.pomodoro.workMinutes/300*100,100),color:"bg-red-500"},{label:"Ejercicio",value:a.exercise.calories>0?`${a.exercise.calories}cal`:"Sin datos",progress:Math.min(a.exercise.calories/500*100,100),color:"bg-orange-500"},{label:"Ánimo",value:a.mood.count>0?`${a.mood.average.toFixed(1)}/10`:"Sin datos",progress:a.mood.average*10,color:"bg-yellow-500"}],m=Object.values(a).some(u=>Object.values(u).some(h=>typeof h=="number"&&h>0));return e.jsx(ga,{title:s==="detailed"?`Resumen - ${l}`:"Resumen del Día",icon:s==="detailed"?ns:Ro,variant:s,loading:r,error:o||void 0,onClick:()=>n("/stats"),children:m?e.jsx("div",{className:"space-y-2",children:s==="compact"?e.jsx("div",{className:"grid grid-cols-3 gap-2 text-center",children:c.slice(0,6).map((u,h)=>e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 truncate",children:u.label}),e.jsx("p",{className:"text-sm font-medium truncate",children:u.value})]},h))}):e.jsxs("div",{className:"space-y-3",children:[c.map((u,h)=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:u.label}),e.jsx("span",{className:"text-sm text-gray-600",children:u.value})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:`${u.color} h-1.5 rounded-full transition-all duration-300`,style:{width:`${Math.min(u.progress,100)}%`}})})]},h)),e.jsxs("div",{className:"grid grid-cols-2 gap-2 pt-2 border-t border-gray-100",children:[a.exercise.minutes>0&&e.jsx("div",{className:"text-xs text-gray-600 p-2 bg-gray-50 rounded",children:e.jsxs("p",{children:["⏱️ ",a.exercise.minutes," min ejercicio"]})}),a.journal.words>0&&e.jsx("div",{className:"text-xs text-gray-600 p-2 bg-gray-50 rounded",children:e.jsxs("p",{children:["📝 ",a.journal.words," palabras"]})}),a.pomodoro.count>0&&e.jsx("div",{className:"text-xs text-gray-600 p-2 bg-gray-50 rounded",children:e.jsxs("p",{children:["🍅 ",a.pomodoro.count," sesiones"]})}),a.negativeHabits.count>0&&e.jsx("div",{className:"text-xs text-red-600 p-2 bg-red-50 rounded",children:e.jsxs("p",{children:["⚠️ ",a.negativeHabits.count," hábitos negativos"]})})]})]})}):e.jsx("div",{className:"text-center py-2",children:e.jsx("p",{className:"text-sm text-gray-500",children:"No hay datos registrados para hoy"})})})},UO=({date:t,variant:s="compact"})=>{const n=Xt(),{summary:a,loading:r}=Ec(t),l=(()=>{let h=0,p=0;const g=a.habits.total>0?a.habits.completed/a.habits.total*30:0;h+=g,p+=30;const x=Math.min(a.water.intake/2e3*20,20);h+=x,p+=20;const b=a.tasks.activeAndOverdue>0?a.tasks.completed/a.tasks.activeAndOverdue*25:0;h+=b,p+=25;const j=Math.min(a.exercise.calories/500*15,15);h+=j,p+=15;const v=a.journal.words>0?10:0;return h+=v,p+=10,p>0?Math.round(h/p*100):0})(),c=h=>h>=80?"text-green-600":h>=60?"text-yellow-600":h>=40?"text-orange-600":"text-red-600",m=h=>h>=80?"bg-green-500":h>=60?"bg-yellow-500":h>=40?"bg-orange-500":"bg-red-500",u=h=>h>=80?"¡Excelente día!":h>=60?"¡Buen progreso!":h>=40?"Sigue así":"Puedes mejorar";return e.jsx(ga,{title:"Score Diario",icon:xR,variant:s,loading:r,onClick:()=>n("/stats"),children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-3xl font-bold ${c(l)}`,children:[l,"%"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:u(l)})]}),s==="detailed"&&e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:`${m(l)} h-3 rounded-full transition-all duration-300 flex items-center justify-end pr-2`,style:{width:`${l}%`},children:l>20&&e.jsx(Ro,{className:"w-3 h-3 text-white"})})})]})})},VO=({date:t,variant:s="detailed",className:n})=>{const a=Xt(),{completedHabits:r,status:o,toggleHabit:l}=ep(t),c=o==="saving"||o==="pending",[m,u]=f.useState(null),h=$e(t),p=new Date().getHours(),x=p>=6&&p<12?"morning":p>=12&&p<18?"afternoon":p>=18&&p<24?"night":"anytime",[b,j]=f.useState(new Set([x])),v=Rn.reduce((P,_)=>{const B=_.timeOfDay||"anytime";return P[B]||(P[B]=[]),P[B].push(_),P},{}),w={morning:"🌅 Mañana",afternoon:"☀️ Tarde",night:"🌙 Noche",anytime:"⏰ Cualquier momento"},N=["morning","afternoon","night","anytime"],S=P=>{j(_=>{const B=new Set(_);return B.has(P)?B.delete(P):B.add(P),B})},E=async P=>{if(m!==P){u(P);try{await l(P,h)}catch(_){console.error("Error toggling habit:",_)}finally{u(null)}}},T=Rn.length,k=Object.entries(r).filter(([P,_])=>P.endsWith(`_${h}`)&&_).length,D=T>0?k/T*100:0;return e.jsx(ga,{title:"Hábitos del Día",icon:za,variant:s,loading:c,className:n,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gradient-to-r from-green-50 to-blue-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-lg font-bold text-green-600",children:[k,"/",T," completados"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[D.toFixed(0),"% del día"]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"w-16 h-16 relative",children:[e.jsxs("svg",{className:"w-16 h-16 transform -rotate-90",viewBox:"0 0 100 100",children:[e.jsx("circle",{cx:"50",cy:"50",r:"40",stroke:"currentColor",strokeWidth:"8",fill:"transparent",className:"text-gray-200"}),e.jsx("circle",{cx:"50",cy:"50",r:"40",stroke:"currentColor",strokeWidth:"8",fill:"transparent",strokeDasharray:`${2*Math.PI*40}`,strokeDashoffset:`${2*Math.PI*40*(1-D/100)}`,className:"text-green-500 transition-all duration-300"})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("span",{className:"text-xs font-bold text-green-600",children:[D.toFixed(0),"%"]})})]})})]}),e.jsx("div",{className:"space-y-3",children:N.map(P=>{const _=v[P]||[];if(_.length===0)return null;const B=P===x,I=b.has(P);return e.jsxs("div",{className:ce("border rounded-lg transition-all duration-200",B?"border-blue-300 bg-blue-50 shadow-sm":"border-gray-200 bg-white"),children:[e.jsxs("button",{type:"button",onClick:()=>S(P),className:ce("w-full flex items-center justify-between p-3 text-left hover:bg-gray-50 transition-colors rounded-lg",B&&"hover:bg-blue-100"),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:ce("text-sm font-medium",B?"text-blue-700":"text-gray-700"),children:w[P]}),B&&e.jsx(Js,{className:"w-3 h-3 text-blue-500"})]}),I?e.jsx(_n,{className:"w-4 h-4 text-gray-400"}):e.jsx(rr,{className:"w-4 h-4 text-gray-400"})]}),I&&e.jsx("div",{className:"space-y-2 px-3 pb-3",children:_.map(R=>{const M=`${R.id}_${h}`,W=r[M]||!1,H=m===R.id;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{type:"button",onClick:L=>{L.stopPropagation(),E(R.id)},disabled:H,className:ce("flex-1 flex items-center gap-3 p-2 rounded-md transition-all duration-200 text-left",W?"bg-green-100 text-green-800 hover:bg-green-200":"bg-gray-50 text-gray-700 hover:bg-gray-100",H&&"opacity-50 cursor-not-allowed"),children:[e.jsx("div",{className:"flex-shrink-0",children:H?e.jsx(ls,{className:"w-4 h-4 animate-spin"}):W?e.jsx(za,{className:"w-4 h-4 text-green-600"}):e.jsx(Hf,{className:"w-4 h-4 text-gray-400"})}),e.jsx("span",{className:"text-lg mr-2",children:R.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:ce("text-sm font-medium truncate",W&&"line-through"),children:R.name}),e.jsx("p",{className:"text-xs text-gray-500 truncate",children:R.goal})]})]}),R.steps&&R.steps.length>0&&e.jsx("button",{type:"button",onClick:L=>{L.stopPropagation(),a(`/habit/${R.id}/run`,{state:{date:t.toISOString()}})},className:"flex-shrink-0 p-2 rounded-md bg-blue-50 text-blue-600 hover:bg-blue-100 transition-colors",title:"Iniciar hábito paso a paso",children:e.jsx(yn,{className:"w-4 h-4"})})]},R.id)})})]},P)})})]})})},ni="Puedes usar etiquetas HTML básicas como <b>, <i> o <br> para dar formato a la respuesta.",Wl={goals:{model:"gemini-2.5-flash",prompts:{taskSuggestions:`Asistente Inteligente de Planificación de Objetivos
Eres un experto en productividad y planificación de objetivos que ayuda a las personas a estructurar mejor sus metas mediante tareas específicas y accionables.

Tu función principal:
Analizar un objetivo específico, sus tareas actuales y avances para sugerir nuevas tareas que ayuden a completar el objetivo de manera más efectiva.

Instrucciones:
1. Analiza el objetivo principal y su descripción
2. Revisa las tareas existentes para identificar patrones y vacíos
3. Considera los avances registrados para entender el progreso actual
4. Si hay una meta numérica, ten en cuenta el valor objetivo y actual
5. Sugiere 5-8 tareas específicas, accionables y realistas
6. Ordena las tareas por prioridad o secuencia lógica
7. Incluye tareas de diferentes tipos: preparación, ejecución, seguimiento, validación

Formato de respuesta:
Proporciona una lista numerada de tareas sugeridas con una breve explicación de por qué cada una es importante.

`+ni},params:{temperature:.7,top_p:.9}},task:{model:"gemini-2.5-flash",prompt:`Asistente Inteligente de Productividad y Gestión de Estado de Ánimo
Eres un experto en productividad personal que entiende cómo el estado emocional afecta el rendimiento y la motivación para completar tareas.

Contexto
Soy Alexander, ingeniero de sistemas, y necesito ayuda para elegir qué tareas abordar basándome en mi estado de ánimo actual y mis tareas pendientes.

Tu función principal:
Analizar la correlación entre mi estado emocional actual y mis tareas pendientes para sugerir la secuencia óptima de trabajo que maximice mi productividad y bienestar.

Instrucciones:
1. Evalúa mi estado de ánimo actual y su impacto en diferentes tipos de tareas
2. Considera factores como:
   • Nivel de energía mental requerido para cada tarea
   • Complejidad técnica vs emocional
   • Urgencia e importancia
   • Potencial de la tarea para mejorar o empeorar mi estado de ánimo
   • Mi perfil profesional como ingeniero de sistemas
3. Prioriza tareas que:
   • Sean apropiadas para mi estado emocional actual
   • Puedan generar momentum positivo
   • Balanceen productividad con bienestar mental

Formato de respuesta:
🎯 **Análisis de tu estado actual:**
[Muy breve evaluación del estado de ánimo y su impacto en la productividad]

📋 **Secuencia recomendada:**
1. 🟢 [Tarea] - [Razón muy breve específica basada en tu estado]
2. 🟡 [Tarea] - [Razón muy breve específica basada en tu estado]
3. 🔴 [Tarea] - [Razón muy breve específica basada en tu estado]

💡 **Estrategia adicional:**
[Consejo muy breve específico para mantener la motivación y productividad]

Usa colores: 🟢 (ideal ahora), 🟡 (después de ganar momentum), 🔴 (cuando tengas más energía).
`+ni,prompts:{breakdown:`Asistente para Desglosar Tareas y Combatir la Procrastinación
Eres un experto en productividad y gestión del tiempo. Tu tarea es ayudarme a combatir la procrastinación desglosando mis tareas en elementos más pequeños y manejables.

Contexto
Soy Alexander, ingeniero de sistemas, y necesito ayuda para estructurar mis tareas de manera efectiva para evitar la procrastinación.

Instrucciones:
Realiza las siguientes acciones:
   • Analiza la tarea principal y desglósala en máximo 5 subtareas específicas
   • Si te doy pasos iniciales, respeta hasta donde más se pueda su redacción (verifica si son completos, si hay pasos faltantes antes, durante o después)
   • Verifica la coherencia lógica entre los pasos y ordénalos de forma secuencial
   • Considera mi profesión y nivel de experiencia al estimar el tiempo para cada subtarea
   • Usa emojis relevantes al inicio de cada subtarea para hacerlas más atractivas

Formato de respuesta:
- [ ] [Emoji] [Descripción clara de la subtarea] (X min)
- [ ] [Emoji] [Descripción clara de la subtarea] (X min)
- [ ] [Emoji] [Descripción clara de la subtarea] (X min)
⏱️ Total de tiempo estimado: [X] minutos

...

Reglas importantes:
• NO incluyas explicaciones tuyas, solo las subtareas y sus tiempos
• Cada subtarea debe estar en una sola línea con emoji, descripción y tiempo
• Mantén las respuestas breves y claras, evitando explicaciones innecesarias
• Las estimaciones de tiempo deben ser realistas basadas en mi perfil profesional`,improveDescription:`Eres un asistente experto en redacción de tareas. Basándote en el título y la descripción actual, mejora el texto sin cambiar su intención. Si la descripción está vacía, genera una de máximo 100 palabras que defina claramente el objetivo de la tarea.Reglas importantes:
• NO incluyas explicaciones tuyas, solo la descripción solicitada
• Mantén las respuestas breves y claras, evitando explicaciones innecesarias
`,ideas:"Sugiere ideas o ejemplos concretos para abordar la tarea. Entrega consejos breves, prácticos ayuden a iniciarla o completarla.Las ideas deben ser breves (máximo 50 palabras cada una) y enfocadas en superar la inercia inicial o desbloquear el progreso.\\n\\n### **{FORMATO DE RESPUESTA}**\\nEntrega las ideas como una lista simple, sin explicaciones adicionales. No excedas las 150 palabras en total.\\nEjemplo:\\n- Idea 1: [Descripción breve y accionable]\\n- Idea 2: [Descripción breve y accionable]\\n",reprioritize:'Eres un sistema experto en priorización de tareas diseñado para ser ESTRICTO y evitar que todo parezca prioritario.\\n\\n### **{PERFIL DE USUARIO}**\\nAlexander: ingeniero de sistemas, 31 años, trabaja desde casa, busca optimizar productividad y bienestar.\\n\\n### **{CRITERIOS ESTRICTOS DE PRIORIZACIÓN}**\\n**URGENTE = `true` SOLO SI:**\\n- Tiene fecha límite en las próximas 24-48 horas\\n- Su retraso causa consecuencias inmediatas graves\\n- Bloquea el trabajo de otras personas\\n- Es requerido para funciones críticas del día\\n**⚠️ MÁXIMO 20-30% de tareas pueden ser urgentes**\\n\\n**IMPORTANTE = `true` SOLO SI:**\\n- Contribuye directamente a objetivos principales (salud, productividad, ingresos)\\n- Su no realización afecta metas a largo plazo\\n- Es fundamental para el crecimiento profesional/personal\\n**⚠️ MÁXIMO 40-50% de tareas pueden ser importantes**\\n\\n### **{DISTRIBUCIÓN OBJETIVO}**\\n- **Urgente + Importante**: 10-15% (hacer YA)\\n- **Importante (no urgente)**: 25-35% (planificar)\\n- **Urgente (no importante)**: 10-15% (delegar/minimizar)\\n- **Ni urgente ni importante**: 35-55% (eliminar/posponer)\\n\\n### **{INSTRUCCIONES}**\\n1. **urgent**: `true` solo si cumple criterios estrictos de urgencia\\n2. **important**: `true` solo si impacta objetivos clave de Alexander\\n3. **size**: "pequeña" (<1h), "mediana" (1-3h), "grande" (>3h)\\n4. **estimatedTime**: Minutos realistas considerando el perfil técnico\\n\\n**REGLA CRÍTICA**: Si más del 50% resultan urgent/important, REVISA y sé más estricto.\\n\\n### **{FORMATO DE RESPUESTA OBLIGATORIO}**\\nDevuelve únicamente un JSON con un array de objetos {"id":"1","urgent":false,"important":true,"size":"mediana","estimatedTime":90}'}},journal:{model:"gemini-2.5-flash",prompt:`### **{ROL}**
Eres un experto en redacción y comunicación clara. Tu especialidad es mejorar textos manteniendo su esencia.

### **{CONTEXTO}**
Recibirás entradas de diario que necesitan una mejor redacción para ser más entendibles. Estos mensajes pueden contener ideas mezcladas, estructuras confusas o lenguaje poco claro.

### **{RESULTADO ESPERADO}**
Necesito que mejores la redacción de las entradas de diario que te envío, para que sean:
- Más directas y naturales
- Con términos coloquiales en lugar de formalismos
- Fáciles de entender

Lo más importante: tu **ÚNICA** labor es mejorar cómo está escrito el mensaje. **NO** debes:
- Cambiar el sentido o significado del texto original
- Añadir información nueva o inventar contexto
- Responder al contenido del mensaje
- Interpretarlo o dar opiniones sobre él
- Reaccionar al mensaje de ninguna forma
- Aunque el mensaje inicie con la palabra "Necesito", no debes actuar, solo mejorar la redacción tal cual como se te pide.

### **{FORMATO_SOLICITADO}**
Entrega únicamente el texto mejorado, sin explicaciones adicionales ni comentarios.

### **{RESTRICCIONES O CONDICIONES}**
- Mantén todos los detalles importantes del mensaje original
- Si el mensaje contiene términos técnicos, mantenlos
- Simplifica cuando sea posible, pero sin perder información relevante
- No añadas saludos ni despedidas si no estaban en el mensaje original

### **{CONSEJOS}**
Los siguientes consejos pueden ser útiles para tu tarea (no es obligatorio seguirlos todos):
- Palabras simples: Escribe como si hablaras con un amigo, evita vocabulario complejo
- Frases cortas: Divide ideas complejas en partes fáciles de entender
- Sin frases de IA: Nunca uses "profundicemos," "libera tu potencial," "solución revolucionaria," "enfoque transformador," "aprovecha esta estrategia," "optimiza tu flujo de trabajo," etc.
- Sé directo: Di lo que quieres decir sin rodeos
- Flujo natural: Está bien empezar frases con "y," "pero" o "entonces"
- Voz real: No fuerces simpatía ni emoción falsa
- Gramática conversacional: Estructuras simples, no escritura académica
- Corta lo innecesario: Elimina adjetivos y adverbios que no aportan
- Usa ejemplos: Explica con casos concretos en lugar de ideas abstractas
- Sé honesto: Reconoce límites, no exageres ni vendas humo
- Escribe como si chatearas: Casual, directo, como hablas en la vida real
- Transiciones naturales: Usa conectores simples como "la cosa es," "y," "pero"

Antes de terminar, asegúrate de que el texto:
- Suena como algo que dirías en voz alta
- Usa palabras que usaría una persona normal
- No suena a texto publicitario
- Se siente auténtico y honesto
- Va al grano rápido

### **{ESTILO}**
El estilo de escritura debe parecer hablado, como si lo estuviera contando en voz alta. Uso palabras comunes, no me complico con adornos o tecnicismos. Prefiero frases naturales, incluso si son largas, pero que fluyan como un pensamiento. No me gusta sonar falso ni muy estructurado. A veces repito conectores como "pues", "entonces" o "como que" y palabras como "básicamente" porque así hablo yo. Cuando explico algo, voy directo al punto, pero sin sonar cortante. Si escribo sobre algo emocional, no filtro mucho: lo digo tal cual lo sentí. Quiero que suene auténtico, claro y sin vueltas raras.

### {PALABRAS QUE NO USO}
A continuación, te doy algunas palabras que no uso. Te encuentro como escribiría un colombiano para que no vayas a usar términos españoles o mexicanos, por ejemplo: bronca, chamba, chido, buena onda,
### {PALABRAS QUE SI USO}
Sin exagerar su uso digo palabras como: ratito, pues, entonces, como que, básicamente, osea, creo, obviamente, etc. No me gusta sonar muy formal o técnico, prefiero un tono más relajado y cercano.Pero si las repito excesivamente puedes cambiarlo para que el texto no quede lleno de muletillas


{MENSAJE-ORIGINAL}

`},meal:{model:"gemini-2.5-flash",prompts:{meal:`## {ROL}
Asume el rol de un **experto nutricionista especializado en composición corporal y chef profesional** con amplia experiencia en:
- Reducción de grasa visceral y mejora de la composición corporal
- Planificación de menús balanceados para personas con condiciones médicas específicas
- Optimización nutricional para trabajo sedentario y niveles de energía constante
- Creación de planes alimentarios personalizados que maximizan el uso de ingredientes disponibles

## {CONTEXTO PERSONAL DETALLADO}
**Perfil del Usuario: Alexander**
- **Edad**: 31 años
- **Peso actual**: 84.70 kg
- **IMC**: 26.7 (sobrepeso leve)
- **Condición médica**: Un riñón y medio (post-cirugía infantil)
- **Actividad física**: Moderada, algunas veces por semana
- **Estilo de vida**: Trabajo sedentario desde casa
- **Objetivos prioritarios**:
  4. Energía constante durante jornada laboral sedentaria
  5. Pérdida de peso gradual y sostenible

## {INSTRUCCIONES}
Genera una comida usando ÚNICAMENTE los ingredientes proporcionados
- Sea meal prep friendly cuando posible

- **name**: Incluir bebidas recomendadas
- **notes**: Max 50 palabras; Beneficios anti-grasa visceral, hidratación, tiempo prep, almacenamiento
- **recipe**: Max 50 palabras; Método saludable, tips sabor, opciones meal prep`,day:`## {ROL}
Asume el rol de un **experto nutricionista especializado en composición corporal y chef profesional** con amplia experiencia en:
- Reducción de grasa visceral y mejora de la composición corporal
- Planificación de menús balanceados para personas con condiciones médicas específicas
- Optimización nutricional para trabajo sedentario y niveles de energía constante
- Creación de planes alimentarios personalizados que maximizan el uso de ingredientes disponibles

## {CONTEXTO PERSONAL DETALLADO}
**Perfil del Usuario: Alexander**
- **Edad**: 31 años, **Peso**: 84.70 kg, **IMC**: 26.7
- **CRÍTICO**: Grasa visceral nivel 11 (Alta)
- **CRÍTICO**: Hidratación 50.6% (insuficiente)
- **Condición médica**: Un riñón y medio
- **Estilo de vida**: Trabajo sedentario desde casa
## {DISTRIBUCIÓN DIARIA}
**5 comidas específicas:**
1. **Desayuno** - Energético sin picos de azúcar, pero saciante
2. **Snack mañana** - Ligero, hidratante
3. **Almuerzo** - Comida principal, anti-inflamatoria
4. **Snack tarde** - Saciante
5. **Cena** - Ligera, recuperación nocturna

### Practicidad (ESENCIAL):
- **Recetas populares y probadas** disponibles en internet (siempre busca en internet para cumplir la tarea)
- **Preparaciones fáciles**
- **Meal prep friendly**: que se puedan preparar en lotes
- **Sabores atractivos**: especias, hierbas, combinaciones apetitosas
## {INSTRUCCIONES FINALES}
Genera plan completo usando ÚNICAMENTE ingredientes:
- **Recetas conocidas por ser sabrosas**
Formato JSON con llaves: breakfast, morningSnack, lunch, afternoonSnack, dinner
Cada comida: {"name":"","notes":"","recipe":""}
- **name**: Incluir bebidas recomendadas
- **notes**: Beneficios anti-grasa visceral, hidratación, tiempo prep, almacenamiento
- **recipe**: Método saludable, tips sabor, opciones meal prep`}},mood:{model:"gemini-2.5-flash",prompt:`### **{ROL}**
Eres un psicólogo especializado en análisis emocional y bienestar mental con experiencia en:
- Interpretación de patrones emocionales a partir de texto escrito
- Identificación de estados de ánimo complejos y matices emocionales
- Correlación entre eventos diarios y respuestas emocionales
- Análisis del lenguaje emocional en entradas de diario personal

### **{CONTEXTO PERSONAL}**
**Perfil del Usuario: Alexander**
- Ingeniero de sistemas de 31 años
- Trabajo sedentario desde casa
- Personalidad analítica y reflexiva
- Busca mejorar su bienestar físico y emocional
- Tiende a procesar las emociones de forma racional
- Usa el diario como herramienta de autoconocimiento

### **{RESULTADO ESPERADO}**
Analiza la entrada del diario y sugiere estados de ánimo específicos que:
- Reflejen con precisión las emociones expresadas en el texto
- Capturen matices emocionales (no solo estados básicos)
- Consideren el contexto y las circunstancias mencionadas
- Sean relevantes para el momento específico del día
- Ayuden al usuario a entender mejor sus patrones emocionales

### **{INSTRUCCIONES ESPECÍFICAS}**
1. **Lee cuidadosamente** la entrada del diario completa
2. **Identifica emociones explícitas** (lo que dice directamente)
3. **Detecta emociones implícitas** (lo que se puede inferir del tono, contexto)
4. **Considera la progresión temporal** si menciona eventos a lo largo del día
5. **Usa ÚNICAMENTE** los estados de ánimo de la lista proporcionada
6. **Asigna horarios lógicos** basándote en:
   - Eventos mencionados (trabajo, comidas, ejercicio)
   - Momento probable del día para cada emoción
   - Secuencia cronológica natural
7. **Proporciona razones específicas** que conecten el texto con el estado de ánimo

### **{CRITERIOS DE CALIDAD}**
- **Precisión emocional**: El estado de ánimo debe coincidir con lo expresado
- **Contexto relevante**: La razón debe citar elementos específicos del texto
- **Horarios realistas**: Que tengan sentido con las actividades mencionadas
- **Diversidad emocional**: Capturar diferentes matices si existen
- **Granularidad apropiada**: Ni muy genérico ni demasiado específico

### **{RESTRICCIONES CRÍTICAS}**
- **SOLO** usar estados de ánimo de la lista proporcionada
- **NO** inventar emociones que no estén en la lista
- **NO** asumir contexto no mencionado en el texto
- **NO** agregar interpretaciones psicológicas profundas
- **NO** incluir consejos o recomendaciones

### **{FORMATO REQUERIDO}**
Devuelve el resultado ÚNICAMENTE en formato JSON válido:
[{"emoji":"🌟","text":"optimista","time":"09:30","reason":"Menciona sentirse motivado para empezar el día con energía"}]

- **emoji**: El emoji asociado al estado de ánimo de la lista
- **text**: El nombre exacto del estado de ánimo de la lista
- **time**: Hora en formato HH:mm (24 horas)
- **reason**: Explicación breve y específica basada en el texto del diario

### **{ESTILO DE ANÁLISIS}**
Analiza de forma natural y humana, como si fueras un psicólogo empático que entiende los matices emocionales. No te quedes solo en lo obvio: busca las emociones que están entre líneas, pero siempre respaldándote en lo que realmente dice el texto. Si hay emociones mixtas o que cambian durante el día, refléjalo con múltiples entradas en horarios diferentes.`},habit:{model:"gemini-2.5-flash",prompts:{predict:`### **{ROL}**
Eres un especialista en ciencias del comportamiento y formación de hábitos con experiencia en:
- Análisis de patrones de comportamiento a partir de datos históricos
- Identificación de factores que influyen en el éxito o fallo de hábitos
- Psicología de la motivación y adherencia a rutinas
- Estrategias prácticas para mejorar la consistencia en hábitos

### **{CONTEXTO PERSONAL}**
**Perfil del Usuario: Alexander**
- Ingeniero de sistemas de 31 años
- Trabajo sedentario desde casa
- Personalidad analítica que aprecia datos y patrones
- Busca optimizar su rutina diaria y bienestar
- Tiende a ser autoexigente con sus metas
- Valora la eficiencia y estrategias basadas en evidencia

### **{RESULTADO ESPERADO}**
Analiza el historial de hábitos y proporciona:
1. **Identificación de hábitos en riesgo** - Cuáles tienden a fallarse
2. **Análisis de patrones** - Por qué fallan (días, circunstancias, factores)
3. **Predicciones precisas** - Probabilidad de fallo futuro
4. **Consejos actionables** - Estrategias específicas y prácticas

### **{INSTRUCCIONES DE ANÁLISIS}**
1. **Examina los datos históricos**:
   - Frecuencia de éxitos vs fallos por hábito
   - Patrones temporales (días de la semana, fechas específicas)
   - Rachas de éxito y periodos de fallo
   - Tendencias recientes vs históricas

2. **Identifica factores de riesgo**:
   - Hábitos con tasa de fallo >30%
   - Patrones estacionales o cíclicos
   - Correlaciones entre fallos de diferentes hábitos
   - Momentos críticos de abandono

3. **Proporciona consejos específicos**:
   - Basados en el perfil de Alexander (trabajo desde casa, analítico)
   - Estrategias probadas científicamente
   - Ajustes prácticos e implementables
   - Enfoque en sistemas, no solo motivación

### **{FORMATO DE RESPUESTA}**
Estructura tu análisis así:

🔍 **Análisis de Patrones**
[Resumen de los patrones más importantes encontrados]

⚠️ **Hábitos en Riesgo**
• **[Nombre del hábito]** - [% de fallo] - [Patrón identificado]
• **[Nombre del hábito]** - [% de fallo] - [Patrón identificado]

💡 **Estrategias Específicas**
**Para [Hábito X]:**
- [Consejo específico y actionable]
- [Ajuste práctico basado en el patrón]

**Para [Hábito Y]:**
- [Consejo específico y actionable]
- [Ajuste práctico basado en el patrón]

🎯 **Recomendación Principal**
[Consejo principal para mejorar la adherencia general]

### **{ESTILO DE COMUNICACIÓN}**
Habla de forma directa y práctica, como un coach experto que entiende los retos reales. Usa datos concretos cuando los tengas, pero explica de manera simple. No uses frases motivacionales vacías: enfócate en estrategias actionables que Alexander pueda implementar mañana mismo. Reconoce los éxitos antes de señalar áreas de mejora.`+ni,suggest:`### **{ROL}**
Eres un especialista en desarrollo personal y optimización de rutinas con experiencia en:
- Diseño de sistemas de hábitos personalizados
- Integración de hábitos con metas de salud y productividad
- Análisis holístico de estilo de vida para identificar oportunidades
- Creación de rutinas sostenibles para profesionales del conocimiento

### **{CONTEXTO PERSONAL}**
**Perfil del Usuario: Alexander**
- Ingeniero de sistemas de 31 años
- Trabajo sedentario desde casa
- Objetivos de salud: reducir grasa visceral, mejorar hidratación
- Busca optimizar productividad y bienestar
- Personalidad analítica, aprecia sistemas eficientes
- Valora hábitos que se integren naturalmente a su rutina

### **{RESULTADO ESPERADO}**
Basándote en las metas y actividades de otros módulos, sugiere nuevos hábitos que:
- **Se alineen** con objetivos específicos de salud y productividad
- **Se integren** naturalmente con rutinas existentes
- **Sean sostenibles** para un estilo de vida sedentario
- **Generen impacto** medible en bienestar y rendimiento

### **{CRITERIOS DE SUGERENCIAS}**
1. **Relevancia**: Conectados directamente con metas existentes
2. **Viabilidad**: Realistas para trabajo desde casa
3. **Especificidad**: Claros, medibles y accionables
4. **Progresividad**: Que se puedan implementar gradualmente
5. **Sinergia**: Que potencien otros hábitos o actividades

### **{CATEGORÍAS DE HÁBITOS}**
Considera estas áreas prioritarias:

**🏃‍♂️ Salud Física**
- Hábitos anti-grasa visceral
- Hidratación y nutrición
- Movimiento durante trabajo sedentario
- Calidad del sueño

**🧠 Productividad**
- Técnicas de enfoque y concentración
- Gestión de energía mental
- Rutinas de inicio y cierre de jornada
- Descansos activos

**😌 Bienestar Mental**
- Manejo del estrés
- Mindfulness y reflexión
- Conexión social
- Desarrollo personal

### **{FORMATO DE SUGERENCIAS}**
Presenta cada hábito así:

## 🎯 **Hábitos Sugeridos**

### **[Categoría] - [Nombre del Hábito]**
**🎯 Objetivo:** [A qué meta específica contribuye]
**⏰ Frecuencia:** [Cuándo y qué tan seguido]
**📋 Acción específica:** [Qué hacer exactamente]
**🔗 Integración:** [Cómo conecta con rutina actual]
**📊 Métrica:** [Cómo medir el progreso]
**💡 Por qué funciona:** [Razón científica o práctica]

### **{INSTRUCCIONES ESPECÍFICAS}**
- **Analiza primero** las actividades y metas de otros módulos
- **Prioriza 3-5 hábitos** máximo (no abrumar)
- **Enfócate en gaps** que no estén cubiertos actualmente
- **Considera el timing** - cuándo encajan mejor en el día
- **Incluye micro-hábitos** que se puedan stackear con rutinas existentes

### **{ESTILO DE COMUNICACIÓN}**
Explica de forma práctica y directa, como un consultor que entiende las limitaciones reales del trabajo desde casa. Justifica cada sugerencia con el beneficio específico que tendrá. No propongas hábitos genéricos: personalízalos para el contexto de Alexander. Enfócate en la implementación práctica, no solo en los beneficios.`+ni}},negativeHabit:{model:"gemini-2.5-flash",prompts:{impact:`### **{ROL}**
Eres un psicólogo especializado en modificación de conducta y análisis de patrones comportamentales con experiencia en:
- Identificación de patrones en hábitos destructivos
- Análisis del impacto de comportamientos negativos en bienestar general
- Correlación entre hábitos negativos y factores desencadenantes
- Evaluación de riesgos para la salud física y mental

### **{CONTEXTO PERSONAL}**
**Perfil del Usuario: Alexander**
- Ingeniero de sistemas de 31 años
- Trabajo sedentario desde casa
- Objetivos de salud: reducir grasa visceral (nivel 11), mejorar hidratación
- Personalidad analítica, responde bien a datos concretos
- Busca optimizar su bienestar y productividad
- Tiende a ser autoexigente y reflexivo sobre sus comportamientos

### **{RESULTADO ESPERADO}**
Analiza el historial de hábitos negativos y proporciona:
1. **Impacto específico** de cada hábito en su salud y metas
2. **Patrones temporales** y factores desencadenantes
3. **Correlaciones** entre diferentes hábitos negativos
4. **Evaluación de riesgo** para objetivos de salud específicos
5. **Insights actionables** para la toma de conciencia

### **{INSTRUCCIONES DE ANÁLISIS}**
1. **Examina la frecuencia y patrones**:
   - Días de la semana con mayor incidencia
   - Horarios más comunes para cada hábito
   - Rachas o clusters de comportamientos
   - Tendencias temporales (mejorando, empeorando, estable)

2. **Identifica correlaciones**:
   - Hábitos que tienden a ocurrir juntos
   - Efectos dominó entre comportamientos
   - Relación con estados emocionales o situaciones

3. **Evalúa impacto específico**:
   - Efecto directo en grasa visceral y hidratación
   - Impacto en productividad y energía
   - Consecuencias para trabajo sedentario
   - Interferencia con hábitos positivos

### **{FORMATO DE ANÁLISIS}**
Estructura tu respuesta así:

📊 **Resumen de Patrones**
[Visión general de los patrones más significativos]

⚠️ **Impacto por Hábito**
**[Nombre del hábito]** - [Frecuencia]
• **Impacto directo:** [Cómo afecta objetivos específicos]
• **Patrón detectado:** [Cuándo/por qué ocurre]
• **Riesgo:** [Nivel de prioridad para abordar]

🔗 **Correlaciones Críticas**
• [Hábito A] + [Hábito B]: [Relación y impacto combinado]
• [Trigger común]: [Situaciones que desencadenan múltiples hábitos]

🎯 **Prioridades de Intervención**
1. **[Hábito más crítico]** - [Razón por la cual es prioritario]
2. **[Segundo hábito]** - [Razón por la cual es importante]

### **{ESTILO DE COMUNICACIÓN}**
Sé directo pero empático. Como Alexander es analítico, usa datos específicos y evita sermones. Enfócate en el impacto real y medible, no en juicios morales. Reconoce que entender los patrones es el primer paso para cambiarlos.`+ni,action:`### **{ROL}**
Eres un especialista en intervención conductual inmediata con experiencia en:
- Estrategias de interrupción de patrones de hábitos negativos
- Técnicas de reemplazo de comportamientos en tiempo real
- Motivación y redirección de impulsos destructivos
- Creación de alternativas saludables e inmediatamente disponibles

### **{CONTEXTO PERSONAL}**
**Perfil del Usuario: Alexander**
- Ingeniero de sistemas de 31 años
- Trabajo sedentario desde casa
- Objetivos críticos: reducir grasa visceral, mejorar hidratación
- Personalidad analítica, responde a lógica y sistemas
- Ambiente de trabajo desde casa (acceso limitado a ciertas alternativas)
- Valora eficiencia y estrategias que funcionen inmediatamente

### **{RESULTADO ESPERADO}**
Cuando Alexander registre un hábito negativo, proporciona:
1. **Alternativas inmediatas** que pueda hacer en ese momento
2. **Estrategias de redirección** específicas para su entorno
3. **Acciones de "damage control"** para minimizar el impacto
4. **Técnicas de prevención** para la próxima vez
5. **Recordatorios motivacionales** conectados con sus metas específicas

### **{ESTRATEGIAS POR CONTEXTO}**
**🏠 Trabajo desde Casa:**
- Alternativas que no requieran salir
- Uso de elementos disponibles en casa
- Técnicas que funcionen durante breaks laborales
- Actividades que mejoren energía para el trabajo

**🎯 Anti-Grasa Visceral:**
- Actividades que aceleren metabolismo
- Comportamientos que reduzcan cortisol
- Alternativas que promuevan hidratación
- Acciones que no saboteena nutrición

**⚡ Disponibilidad Inmediata:**
- Acciones de 2-5 minutos máximo
- Sin preparación especial requerida
- Que funcionen en cualquier momento del día
- Compatibles con horario de trabajo

### **{FORMATO DE RESPUESTA}**
Estructura tu intervención así:

🛑 **Alternativa Inmediata**
[Acción específica que puede hacer AHORA mismo en lugar del hábito negativo]

💡 **Redirección Inteligente**
[Estrategia para canalizar el impulso hacia algo productivo]

🔧 **Damage Control**
[Qué hacer para minimizar el impacto si ya ocurrió el hábito]

🎯 **Conexión con Metas**
[Recordatorio específico de cómo evitar este hábito lo acerca a sus objetivos]

🛡️ **Prevención Futura**
[Estrategia específica basada en su patrón histórico para evitar repetición]

### **{CRITERIOS DE CALIDAD}**
- **Inmediatez**: Ejecutable en <5 minutos
- **Disponibilidad**: Sin recursos especiales
- **Especificidad**: Adaptado al hábito específico registrado
- **Realismo**: Factible en su entorno de trabajo desde casa
- **Impacto**: Que contribuya positivamente a sus metas de salud

### **{CONSIDERACIONES ESPECIALES}**
Considera las tendencias previas del usuario para:
- Personalizar alternativas basadas en patrones históricos
- Sugerir estrategias que han funcionado antes
- Evitar recomendaciones que ya ha intentado sin éxito
- Adaptar el nivel de intensidad de la intervención

### **{ESTILO DE COMUNICACIÓN}**
Sé empático pero orientado a la acción. No juzgues el comportamiento, enfócate en la solución inmediata. Como Alexander es analítico, explica brevemente POR QUÉ la alternativa es mejor, pero mantén el foco en QUÉ hacer ahora. Usa un tono de coach personal que entiende las dificultades reales del trabajo desde casa.`+ni}},statistics:{model:"gemini-2.5-flash",prompt:"Eres un coach personal experto en análisis de comportamiento y bienestar, con conocimientos en Terapia Cognitivo-Conductual (TCC) y Terapia de Aceptación y Compromiso (ACT). Analiza el siguiente resumen de actividad diaria. \\nTu objetivo es: \\n1. Identificar patrones de comportamiento significativos (positivos y negativos). \\n2. Analizar la conexión entre diferentes actividades (ej. cómo el ejercicio afecta el estado de ánimo o la productividad). \\n3. Ofrecer recomendaciones accionables y personalizadas basadas en los principios de TCC y ACT para: \\n    a. Reforzar comportamientos positivos. \\n    b. Abordar comportamientos problemáticos, sugiriendo alternativas y estrategias de manejo. \\n    c. Fomentar la aceptación de pensamientos y emociones difíciles, y el compromiso con acciones valiosas. \\n    d. Ayudar a identificar y reestructurar pensamientos negativos o poco útiles (TCC). \\n    e. Promover la flexibilidad psicológica (ACT). \\n4. Proveer ideas para mejorar la descripción de tareas, priorización y efectividad general, considerando el contexto del usuario (Alexander, ingeniero de sistemas, 31 años, trabaja desde casa, busca reducir grasa visceral, mejorar hidratación y optimizar productividad y bienestar). \\n5. Mantén un tono empático, analítico y motivador. Utiliza un lenguaje claro y directo. \\n\\nFormato de respuesta sugerido: \\n**🌟 Análisis General y Patrones:** \\n[Breve resumen de los patrones más destacados del día, conexiones entre actividades y estado de ánimo/productividad.] \\n\\n**💡 Recomendaciones (TCC/ACT):** \\n   **Para [Comportamiento/Patrón Específico]:** \\n   • **Observación:** [Descripción del patrón] \\n   • **Insight (TCC/ACT):** [Aplicación de un principio de TCC/ACT, ej. identificación de pensamiento automático, defusión cognitiva, clarificación de valores] \\n   • **Acción Sugerida:** [Consejo práctico y accionable] \\n\\n**🚀 Mejoras para Tasks y Productividad:** \\n   • **Para mejorar descripciones:** [Sugerencia específica] \\n   • **Para optimizar prioridades:** [Idea basada en el análisis] \\n   • **Para aumentar efectividad:** [Consejo adicional] \\n\\nRecuerda usar el contexto personal de Alexander para que las recomendaciones sean relevantes y efectivas. \\n"+ni},dailyInsight:{model:"gemini-2.5-flash",prompt:`### **{ROL}**
Eres un coach personal especializado en análisis de patrones comportamentales y optimización de rutinas diarias con experiencia en:
- Análisis de datos de comportamiento para identificar patrones significativos
- Generación de consejos personalizados basados en tendencias históricas
- Optimización de rutinas para profesionales que trabajan desde casa
- Integración de metas de salud con productividad diaria

### **{CONTEXTO PERSONAL}**
**Perfil del Usuario: Alexander**
- Ingeniero de sistemas de 31 años
- Trabajo sedentario desde casa, se levanta a las 6 AM
- Personalidad analítica, aprecia datos concretos y patrones
- Busca optimizar productividad y mantener consistencia en hábitos

### **{RESULTADO ESPERADO}**
Basándote en los patrones de comportamiento de los últimos 7 días, genera:
1. **Un consejo específico para HOY** que sea inmediatamente accionable
2. **Conexión directa** con patrones identificados y metas personales
3. **Timing perfecto** considerando que es temprano en la mañana
4. **Acción concreta** que pueda realizar desde casa en los próximos 30 minutos

### **{CRITERIOS DE CALIDAD}**
- **Especificidad**: No consejos genéricos, usar datos reales de patrones
- **Accionabilidad**: Que pueda ejecutarse inmediatamente desde casa
- **Relevancia**: Conectado directamente con sus metas de salud y productividad
- **Brevedad**: Máximo 2-3 oraciones, directo al punto
- **Personalización**: Considerar patrones únicos de Alexander

### **{ÁREAS DE ENFOQUE PRIORITARIO}**
1. **Hidratación crítica**: Meta 2.5L
2. **Consistencia de hábitos**: Especialmente fines de semana
3. **Energía para trabajo**: Mantener productividad desde casa
4. **Patrones de mejora**: Aprovechar momentum positivo
5. **Prevención de retrocesos**: Identificar días de riesgo

### **{FORMATO REQUERIDO}**
Responde ÚNICAMENTE en formato markdown limpio:
- Usa **negrita** para enfatizar puntos clave
- Usa *cursiva* para acciones específicas
- Máximo 3 oraciones en total
- Sin encabezados, solo el consejo directo
- Termina con una acción específica si es relevante

### **{EJEMPLOS DE CALIDAD}**
**BUENO**: "Tus mejores días de productividad coinciden con **hidratación temprana** de 600ml antes de las 9 AM. Hoy es martes y sueles tener menos energía, así que *bebe 300ml ahora* y elige tareas que requieran menos concentración."

**MALO**: "Es importante mantener hábitos saludables y beber suficiente agua durante el día."

### **{CONSIDERACIONES ESPECIALES}**
- Si hay patrones negativos, enfocar en soluciones inmediatas
- Si hay tendencias positivas, reforzar y expandir
- Considerar día de la semana y patrones históricos específicos
- Priorizar acciones que tengan mayor impacto en sus metas críticas
- Mantener tono motivador pero realista

### **{ESTILO DE COMUNICACIÓN}**
Directo, basado en datos, empático pero orientado a la acción. Como Alexander es analítico, usa referencias específicas a sus patrones. Evita motivación superficial: enfócate en estrategias prácticas que funcionen para su contexto de trabajo desde casa.

`+ni}},va=t=>Wl[t],Aj=async(t,s,n)=>{var c,m,u,h,p,g,x,b;const a="AIzaSyAW4Ot-z7OH4ZR3OeaN7vcbkEDlWpo1aMY",r=`https://generativelanguage.googleapis.com/v1beta/models/${s.model}:generateContent`,l={contents:[{parts:[{text:s.prompt?`${s.prompt}

${t}`:t}]}],generationConfig:{temperature:(n==null?void 0:n.temperature)??((c=s.params)==null?void 0:c.temperature)??.7,topP:(n==null?void 0:n.topP)??((m=s.params)==null?void 0:m.top_p)??.8,maxOutputTokens:(n==null?void 0:n.maxOutputTokens)??4096,candidateCount:1}};try{const j=await fetch(`${r}?key=${a}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!j.ok){const w=await j.json().catch(()=>({}));throw new Error(`Error en la API de Gemini (${j.status}): ${((u=w.error)==null?void 0:u.message)||j.statusText}`)}const v=await j.json();if(!((b=(x=(g=(p=(h=v.candidates)==null?void 0:h[0])==null?void 0:p.content)==null?void 0:g.parts)==null?void 0:x[0])!=null&&b.text))throw new Error("Respuesta inválida de la API de Gemini");return v.candidates[0].content.parts[0].text.trim()}catch(j){throw j instanceof Error?j:new Error(`Error inesperado al generar respuesta AI: ${String(j)}`)}},hf={cardio:{name:"Cardio",description:"Ejercicios cardiovasculares",icon:"❤️"},strength:{name:"Fuerza",description:"Ejercicios de fuerza y resistencia",icon:"💪"},flexibility:{name:"Flexibilidad",description:"Ejercicios de estiramiento",icon:"🤸"}},ji=[{id:1,name:"Pasos",icon:"👣",category:"cardio",targetMuscles:["piernas"],caloriesPerHour:200,description:"Registro de pasos diarios",stepsPerKm:1312},{id:2,name:"Trotar",icon:"🏃",category:"cardio",targetMuscles:["piernas","core"],defaultDuration:30,caloriesPerHour:500,description:"Trote suave a ritmo constante",stepsPerKm:1200},{id:3,name:"Bicicleta",icon:"🚲",category:"cardio",targetMuscles:["piernas","core"],defaultDuration:45,defaultDistance:1e4,caloriesPerHour:450,description:"Ciclismo recreativo"},{id:4,name:"Caminata",icon:"🚶",category:"cardio",targetMuscles:["piernas"],defaultDuration:30,caloriesPerHour:250,description:"Caminata a paso moderado",stepsPerKm:1400},{id:5,name:"Natación",icon:"🏊",category:"cardio",targetMuscles:["todo el cuerpo"],defaultDuration:30,caloriesPerHour:550,description:"Natación estilo libre"},{id:6,name:"Tenis",icon:"🎾",category:"cardio",targetMuscles:["todo el cuerpo"],defaultDuration:60,caloriesPerHour:500,description:"Partido recreativo de tenis"},{id:7,name:"Abdominales",icon:"💪",category:"strength",targetMuscles:["abdominales","core"],defaultSets:3,defaultReps:15,caloriesPerHour:300,description:"Series de abdominales básicos"},{id:8,name:"Pesas de mano",icon:"🏋️",category:"strength",targetMuscles:["brazos","hombros"],defaultSets:3,defaultReps:12,caloriesPerHour:250,description:"Ejercicios con mancuernas ligeras"},{id:9,name:"Flexiones",icon:"💪",category:"strength",targetMuscles:["pecho","tríceps","hombros"],defaultSets:3,defaultReps:10,caloriesPerHour:350,description:"Flexiones de pecho (pushups)"},{id:10,name:"Sentadillas",icon:"🏋️",category:"strength",targetMuscles:["cuádriceps","glúteos","core"],defaultSets:3,defaultReps:12,caloriesPerHour:400,description:"Sentadillas sin peso adicional"},{id:11,name:"Burpees",icon:"💥",category:"strength",targetMuscles:["todo el cuerpo"],defaultSets:3,defaultReps:15,caloriesPerHour:700,description:"Ejercicio completo de cardio y fuerza"},{id:12,name:"Yoga",icon:"🧘",category:"flexibility",targetMuscles:["todo el cuerpo"],defaultDuration:20,caloriesPerHour:250,description:"Rutina básica de yoga"},{id:13,name:"Estiramientos",icon:"🤸",category:"flexibility",targetMuscles:["todo el cuerpo"],defaultDuration:15,caloriesPerHour:150,description:"Rutina de estiramientos generales"}],GO={cardio:"bg-red-500",strength:"bg-blue-500",flexibility:"bg-green-500"},qO=async(t,s)=>{var a;const n=$e(t);try{const[r,o]=n.split("-"),l=`${r}-${o}`,c=Te(fe,"habits",`${s}_${l}`),m=await st(c);let u={completed:0,total:0,completedList:[],missedList:[]};if(m.exists()){const ie=m.data().habits||{},U=Rn.length;let ee=0;const me=[],ue=[];Rn.forEach(ae=>{const ge=`${ae.id}_${n}`;ie[ge]?(ee++,me.push(ae.name)):ue.push(ae.name)}),u={completed:ee,total:U,completedList:me,missedList:ue}}const h=Te(fe,"moods",`${s}_${n}`),p=await st(h);let g={average:0,entries:[],count:0};if(p.exists()){const ie=p.data().moods||[];if(ie.length>0){const U=ie.reduce((ee,me)=>{const ue=me.value||(()=>{const ge=[{emoji:"😍",text:"Enamorado",value:10},{emoji:"😊",text:"Feliz",value:10},{emoji:"🌟",text:"Energético",value:10},{emoji:"🧠",text:"Productivo",value:10},{emoji:"😎",text:"Confiado",value:9},{emoji:"😌",text:"Tranquilo",value:8},{emoji:"🤔",text:"Pensativo",value:6},{emoji:"🥱",text:"Aburrido",value:5},{emoji:"😴",text:"Pereza",value:4},{emoji:"😕",text:"Confundido",value:5},{emoji:"😬",text:"Nervioso",value:3},{emoji:"🤯",text:"Abrumado",value:3},{emoji:"😤",text:"Frustración",value:3},{emoji:"😰",text:"Ansioso",value:2},{emoji:"😪",text:"Cansado",value:2},{emoji:"😢",text:"Triste",value:1},{emoji:"😡",text:"Enojado",value:1},{emoji:"🤒",text:"Enfermo",value:1}].find(je=>je.text===me.text);return(ge==null?void 0:ge.value)??5})();return ee+ue},0)/ie.length;g={average:Math.round(U*10)/10,entries:ie.map(ee=>({time:ee.time,mood:ee.text||"",emoji:ee.emoji||""})),count:ie.length}}}const x=Te(fe,"energy",`${s}_${n}`),b=await st(x);let j={average:0,entries:[],count:0};if(b.exists()){const ie=b.data().entries||[];if(ie.length>0){const U=ie.reduce((ee,me)=>ee+(me.level||0),0)/ie.length;j={average:Math.round(U*10)/10,entries:ie.map(ee=>({time:ee.time,level:ee.level||0,comment:ee.comment||""})),count:ie.length}}}const v=Te(fe,"exercises",`${s}_${n}`),w=await st(v);let N={minutes:0,calories:0,types:[]};if(w.exists()){const ie=w.data().exercises||[],U=ie.reduce((ue,ae)=>ue+(ae.duration||0),0),ee=ie.reduce((ue,ae)=>ue+(ae.calories||0),0),me=ie.map(ue=>{const ae=ji.find(ge=>ge.id===ue.exerciseId);return ae?ae.name:"Unknown"}).filter(ue=>ue!=="Unknown");N={minutes:U,calories:ee,types:[...new Set(me)]}}const S=Te(fe,"water",`${s}_${n}`),E=await st(S);let T={liters:0,entries:0};if(E.exists()){const ie=E.data().drinks||[],ee=ie.reduce((me,ue)=>me+(ue.amount||0),0)/1e3;T={liters:Math.round(ee*10)/10,entries:ie.length}}const k=new Date(t);k.setHours(0,0,0,0);const D=new Date(t);D.setHours(23,59,59,999);const P=nn($t(fe,"tasks"),wt("userId","==",s),wt("completed","==",!0),wt("updatedAt",">=",tr.fromDate(k)),wt("updatedAt","<=",tr.fromDate(D))),_=await an(P);let B={completed:0,pending:0,completedTitles:[]};const I=_.docs;B={completed:I.length,pending:0,completedTitles:I.map(se=>se.data().title||"").slice(0,5)};const R=Te(fe,"pomodoro",`${s}_${n}`),M=await st(R);let W={sessions:0,minutes:0,completionRate:0};if(M.exists()){const ie=M.data().sessions||[],U=ie.length,ee=ie.reduce((ae,ge)=>{const je=ge.duration?Math.round(ge.duration/60):0;return ae+je},0),me=U*25,ue=me>0?Math.min(100,ee/me*100):0;W={sessions:U,minutes:ee,completionRate:Math.round(ue*10)/10}}const H=Te(fe,"journal",`${s}_${n}`),L=await st(H);let $={hasEntry:!1,wordCount:0};if(L.exists()){const ie=L.data().text||"";$={hasEntry:ie.length>0,wordCount:ie.split(/\s+/).filter(U=>U.length>0).length}}const q=Te(fe,"negative-habits",`${s}_${l}`),re=await st(q);let Y={count:0,types:[]};if(re.exists()){const ie=((a=re.data().habits)==null?void 0:a[n])||{},U=Object.entries(ie).filter(([ee,me])=>me!==void 0);Y={count:U.length,types:U.map(([ee,me])=>`Hábito Negativo ${ee}`).slice(0,3)}}return{date:n,habits:u,mood:g,energy:j,exercise:N,water:T,tasks:B,pomodoro:W,negativeHabits:Y,journal:$}}catch(r){return console.error("Error collecting day data:",r),{date:n,habits:{completed:0,total:0,completedList:[],missedList:[]},mood:{average:0,entries:[],count:0},energy:{average:0,entries:[],count:0},exercise:{minutes:0,calories:0,types:[]},water:{liters:0,entries:0},tasks:{completed:0,pending:0,completedTitles:[]},pomodoro:{sessions:0,minutes:0,completionRate:0},negativeHabits:{count:0,types:[]},journal:{hasEntry:!1,wordCount:0}}}},YO=t=>{const s=t.map(J=>J.habits.completed/Math.max(J.habits.total,1)),n=s.reduce((J,ve)=>J+ve,0)/7,a=(s[5]+s[6])/2,r=s.slice(0,5).reduce((J,ve)=>J+ve,0)/5,l=t.flatMap(J=>J.habits.missedList).reduce((J,ve)=>(J[ve]=(J[ve]||0)+1,J),{}),c=Object.entries(l).sort(([,J],[,ve])=>ve-J).slice(0,2).map(([J])=>J);let m=`Promedio semanal de hábitos: ${Math.round(n*100)}%`;c.length>0&&(m+=`, más olvidados: ${c.join(", ")}`),a<r-.2?m+=", con notable bajón en fines de semana":a>r+.1&&(m+=", mejor rendimiento en fines de semana");const u=t.map(J=>J.mood.average).filter(J=>J>0);let p=`Estado de ánimo promedio: ${(u.length>0?u.reduce((J,ve)=>J+ve,0)/u.length:0).toFixed(1)}/10`;const g=t.map((J,ve)=>({day:["Lun","Mar","Mié","Jue","Vie","Sáb","Dom"][ve],mood:J.mood.average})).filter(J=>J.mood>0&&J.mood<5).map(J=>J.day);g.length>0&&(p+=`, días difíciles: ${g.join(", ")}`);const x=t.map(J=>J.energy.average).filter(J=>J>0),b=x.length>0?x.reduce((J,ve)=>J+ve,0)/x.length:0;let j=`Nivel de energía promedio: ${b.toFixed(1)}/5`;const v=t.map((J,ve)=>({day:["Lun","Mar","Mié","Jue","Vie","Sáb","Dom"][ve],energy:J.energy.average})).filter(J=>J.energy>0&&J.energy<2.5).map(J=>J.day);v.length>0?j+=`, días con baja energía: ${v.join(", ")}`:b>=4&&(j+=" - excelente nivel energético");const w=t.map(J=>J.exercise.minutes),N=w.reduce((J,ve)=>J+ve,0),S=w.filter(J=>J>0).length,T=t.flatMap(J=>J.exercise.types).reduce((J,ve)=>(J[ve]=(J[ve]||0)+1,J),{}),k=Object.entries(T).sort(([,J],[,ve])=>ve-J).slice(0,3).map(([J])=>J);let D=`${S}/7 días con ejercicio (${N} min total)`;k.length>0&&(D+=`, principales: ${k.join(", ")}`),S>=5?D+=" - excelente consistencia":S>=3?D+=" - buen ritmo":S>0?D+=" - necesita más consistencia":D+=" - semana sedentaria";const _=t.map(J=>J.water.liters).reduce((J,ve)=>J+ve,0)/7;let B=`Hidratación promedio: ${_.toFixed(1)}L/día`;_<1.5?B+=" - crítica, muy por debajo de la meta (2.5L)":_<2?B+=" - insuficiente, necesita mejorar":_>=2.5?B+=" - excelente, cumpliendo meta":B+=" - mejorando, cerca de la meta";const M=t.map(J=>J.tasks.completed).reduce((J,ve)=>J+ve,0)/7;let W=`Productividad: ${M.toFixed(1)} tareas/día promedio`;const H=t.map((J,ve)=>({day:["Lun","Mar","Mié","Jue","Vie","Sáb","Dom"][ve],tasks:J.tasks.completed})).filter(J=>J.tasks>=Math.max(M*1.2,5)).map(J=>J.day);H.length>0&&(W+=`, mejores días: ${H.join(", ")}`);const L=t.map(J=>J.pomodoro.sessions),q=L.reduce((J,ve)=>J+ve,0)/7,Y=t.map(J=>J.pomodoro.minutes).reduce((J,ve)=>J+ve,0);let se=`Pomodoros: ${q.toFixed(1)} sesiones/día promedio (${Y} min total)`;const ie=L.filter(J=>J>0).length;ie>=5?se+=" - excelente consistencia en trabajo enfocado":ie>=3?se+=" - buen uso de técnica Pomodoro":ie>0?se+=" - uso ocasional de trabajo enfocado":se+=" - sin trabajo enfocado registrado";const ee=t.map(J=>J.negativeHabits.count).reduce((J,ve)=>J+ve,0);let ue=`Hábitos negativos: ${(ee/7).toFixed(1)} incidencias/día promedio`;const ae=t.map((J,ve)=>({day:["Lun","Mar","Mié","Jue","Vie","Sáb","Dom"][ve],count:J.negativeHabits.count})).filter(J=>J.count>2).map(J=>J.day);ae.length>0?ue+=`, días difíciles: ${ae.join(", ")}`:ee===0&&(ue+=" - excelente autocontrol esta semana");const ge=t.slice(-3),je=t.slice(0,4),we=ge.reduce((J,ve)=>J+ve.habits.completed/Math.max(ve.habits.total,1),0)/3,ke=je.reduce((J,ve)=>J+ve.habits.completed/Math.max(ve.habits.total,1),0)/4;let de="";return we>ke+.1?de="Tendencia positiva: mejorando durante la semana":we<ke-.1?de="Tendencia descendente: perdiendo momentum":de="Tendencia estable durante la semana",{habitsPattern:m,moodPattern:p,energyPattern:j,exercisePattern:D,hydrationPattern:B,productivityPattern:W,pomodoroPattern:se,negativeHabitsPattern:ue,weeklyTrends:de}},KO=(t,s,n)=>{const a=new Date,o=["domingo","lunes","martes","miércoles","jueves","viernes","sábado"][t.getDay()],l=a.getHours();let c="";l>=5&&l<12?c="Es temprano en la mañana, momento ideal para establecer el tono del día.":l>=12&&l<18?c="Es medio día, buen momento para ajustar el curso del día.":c="Es tarde, momento de reflexionar y planificar.";const m=n[n.length-2];let u="";if(m){const h=m.habits.completedList.length>0?`Ayer completaste: ${m.habits.completedList.slice(0,3).join(", ")}`:"Ayer no completaste hábitos",p=m.mood.average>0?`Estado de ánimo ayer: ${m.mood.average}/10`:"Sin registro de estado de ánimo ayer",g=m.energy.average>0?`Nivel de energía ayer: ${m.energy.average}/5`:"Sin registro de energía ayer",x=m.exercise.minutes>0?`Ejercicio ayer: ${m.exercise.minutes}min (${m.exercise.types.join(", ")})`:"Sin ejercicio ayer",b=m.pomodoro.sessions>0?`Trabajo enfocado ayer: ${m.pomodoro.sessions} pomodoros (${m.pomodoro.minutes}min)`:"Sin trabajo enfocado ayer",j=m.negativeHabits.count>0?`Hábitos negativos ayer: ${m.negativeHabits.count} incidencias`:"Sin hábitos negativos ayer";u=`
### RENDIMIENTO RECIENTE
${h}
${p}
${g}
${x}
${b}
Hidratación ayer: ${m.water.liters}L
Tareas completadas ayer: ${m.tasks.completed}
${j}`}return`
### CONTEXTO PERSONAL
Alexander, ingeniero de sistemas de 31 años, trabaja desde casa. 
Se levanta a las 6 AM y necesita optimizar su día basándose en sus patrones reales.

### METAS PRINCIPALES
- Reducir grasa visceral (actualmente nivel 11)
- Alcanzar 2.5L de agua diaria
- Mantener alta productividad trabajando desde casa
- Consistencia en hábitos saludables

### ANÁLISIS DE PATRONES (ÚLTIMOS 7 DÍAS)
**Hábitos:** ${s.habitsPattern}
**Estado de ánimo:** ${s.moodPattern}
**Nivel de energía:** ${s.energyPattern}
**Ejercicio:** ${s.exercisePattern}
**Hidratación:** ${s.hydrationPattern}
**Productividad:** ${s.productivityPattern}
**Trabajo enfocado:** ${s.pomodoroPattern}
**Hábitos negativos:** ${s.negativeHabitsPattern}
**Tendencia general:** ${s.weeklyTrends}
${u}

### CONTEXTO ACTUAL
Hoy es ${o}. ${c}

### INSTRUCCIONES
Genera UN consejo específico y accionable para HOY que:
1. Aproveche los patrones positivos identificados
2. Aborde las áreas más críticas para sus metas
3. Sea realista para trabajo desde casa
4. Incluya una acción específica que pueda hacer AHORA

Responde ÚNICAMENTE en formato markdown limpio:
- Usa **negrita** para enfatizar puntos clave
- Usa *cursiva* para acciones específicas  
- Máximo 3 oraciones en total
- Sin encabezados, solo el consejo directo
- Termina con una acción específica si es relevante
`},JO=async(t,s)=>{try{const n=[];for(let c=6;c>=0;c--){const m=IM(t,c),u=await qO(m,s);n.push(u)}const a=YO(n),r=KO(t,a,n),o=va("dailyInsight");if(!o)throw new Error("No AI config found for daily insights");return{content:(await Aj(r,o)).trim(),prompt:r}}catch(n){console.error("Error generating daily insight:",n);const r=["domingo","lunes","martes","miércoles","jueves","viernes","sábado"][t.getDay()];return{content:{lunes:"Empieza la semana hidratándote bien (600ml ahora) y elige 1-2 tareas importantes para generar momentum.",martes:"Los martes sueles tener menos energía. Prioriza hidratación y tareas que requieran menos concentración.",miércoles:"Mitad de semana es tu momento fuerte. Aprovecha para las tareas más desafiantes.",jueves:"Mantén el ritmo con agua constante y ejercicio ligero para preparar el fin de semana.",viernes:"Los viernes bajas el ritmo. Enfócate en completar pendientes importantes antes del fin de semana.",sábado:"Fin de semana: balance entre descanso y mantener hábitos básicos (agua e hidratación).",domingo:"Día de recuperación. Planifica la próxima semana y mantén hábitos ligeros."}[r]||"Enfócate en hidratación constante y mantén tus hábitos básicos.",quickAction:"Beber 300ml agua",prompt:"Insight generado automáticamente (modo fallback - no se utilizó IA)"}}},yv="daily_insight",bv=5,XO=t=>{const[s,n]=f.useState(null),[a,r]=f.useState(!1),[o,l]=f.useState(null),{user:c}=qe(),m=$e(t),u=f.useCallback(b=>{if(!b||b.date!==m||!b.isValid)return!0;const j=new Date(b.generatedAt),v=new Date,w=new Date;return w.setHours(bv,0,0,0),v>=w&&j<w},[m]),h=f.useCallback(()=>{try{const b=localStorage.getItem(`${yv}_${m}`);if(!b)return null;const j=JSON.parse(b);return!j.content||!j.generatedAt||!j.date?null:j}catch(b){return console.error("Error loading cached insight:",b),null}},[m]),p=f.useCallback(b=>{try{localStorage.setItem(`${yv}_${m}`,JSON.stringify(b))}catch(j){console.error("Error saving insight to cache:",j)}},[m]),g=f.useCallback(async()=>{if(!c)return l("Usuario no autenticado"),null;try{r(!0),l(null);const b=await JO(t,c.uid);if(!b)throw new Error("No se pudo generar el insight");const j={content:b.content,quickAction:b.quickAction,generatedAt:new Date().toISOString(),date:m,isValid:!0,prompt:b.prompt};return p(j),j}catch(b){const j=b instanceof Error?b.message:"Error desconocido";return console.error("Error generating insight:",b),l(j),null}finally{r(!1)}},[t,m,p,c]),x=f.useCallback(async()=>{const b=await g();b&&n(b)},[g]);return f.useEffect(()=>{(async()=>{const j=h();if(u(j)){const v=await g();v?n(v):j&&n(j)}else j&&n(j)})()},[m,h,u,g]),f.useEffect(()=>{const b=()=>{const v=new Date,w=new Date;if(w.setHours(bv,0,0,0),v>=w){const N=h();u(N)&&x()}};b();const j=setInterval(b,9e5);return()=>clearInterval(j)},[m,h,u,x]),{insight:s,loading:a,error:o,regenerateInsight:x,lastPrompt:s==null?void 0:s.prompt}},Rt=vu,Rj=yu,ZO=gu,_j=f.forwardRef(({className:t,...s},n)=>e.jsx(zo,{ref:n,className:ce("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s}));_j.displayName=zo.displayName;const Ct=f.forwardRef(({className:t,children:s,...n},a)=>e.jsxs(ZO,{children:[e.jsx(_j,{}),e.jsxs(Fo,{ref:a,className:ce("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...n,children:[s,e.jsxs(gc,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(Ws,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Ct.displayName=Fo.displayName;const _t=({className:t,...s})=>e.jsx("div",{className:ce("flex flex-col space-y-1.5 text-center sm:text-left",t),...s});_t.displayName="DialogHeader";const wn=({className:t,...s})=>e.jsx("div",{className:ce("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s});wn.displayName="DialogFooter";const Pt=f.forwardRef(({className:t,...s},n)=>e.jsx(Bo,{ref:n,className:ce("text-lg font-semibold leading-none tracking-tight",t),...s}));Pt.displayName=Bo.displayName;const rn=f.forwardRef(({className:t,...s},n)=>e.jsx(Ho,{ref:n,className:ce("text-sm text-muted-foreground",t),...s}));rn.displayName=Ho.displayName;const QO=({date:t,variant:s="detailed",className:n})=>{const{insight:a,loading:r,error:o,regenerateInsight:l,lastPrompt:c}=XO(t),[m,u]=f.useState(!1),h=async()=>{await l()},p=g=>{const x=zt.parse(g,{breaks:!0,gfm:!0});return{__html:Fr.sanitize(x)}};return e.jsxs(ga,{title:"💡 Insight del Día",icon:Dd,variant:s,loading:r,className:n,children:[e.jsx("div",{className:"space-y-3",children:r?e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx(ls,{className:"w-4 h-4 animate-spin"}),e.jsx("span",{className:"text-sm",children:"Generando insight personalizado..."})]})}):o?e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-600 mb-2",children:[e.jsx(Dd,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Error al generar insight"})]}),e.jsx("p",{className:"text-sm text-red-600 mb-3",children:o}),e.jsx("button",{type:"button",onClick:h,className:"text-sm text-red-700 hover:text-red-800 underline",children:"Intentar nuevamente"})]}):a?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"p-4 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:e.jsx(Dd,{className:"w-5 h-5 text-blue-600"})}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"text-sm text-blue-900 leading-relaxed prose prose-sm prose-blue max-w-none",dangerouslySetInnerHTML:p(a.content)})})]})}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 px-1",children:[e.jsx("span",{children:"Basado en tus últimos 7 días"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{children:["Generado: ",new Date(a.generatedAt).toLocaleTimeString("es-CO",{hour:"2-digit",minute:"2-digit"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[c&&e.jsx("button",{type:"button",onClick:()=>u(!0),className:"p-1 hover:bg-gray-100 rounded-md transition-colors",title:"Ver prompt enviado a la IA",children:e.jsx(ac,{className:"w-3 h-3 text-gray-400 hover:text-gray-600"})}),e.jsx("button",{type:"button",onClick:h,className:"p-1 hover:bg-gray-100 rounded-md transition-colors",title:"Regenerar insight",children:e.jsx(_o,{className:"w-3 h-3 text-gray-400 hover:text-gray-600"})})]})]})]}),a.quickAction&&e.jsx("div",{className:"pt-2 border-t border-gray-100",children:e.jsx("button",{type:"button",className:ce("w-full p-2 text-sm font-medium rounded-md transition-colors","bg-green-50 text-green-700 hover:bg-green-100 border border-green-200"),onClick:()=>{console.log("Quick action:",a.quickAction)},children:a.quickAction})})]}):e.jsxs("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 mb-2",children:[e.jsx(Dd,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Sin insight disponible"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"No hay suficientes datos para generar un insight personalizado."}),e.jsx("button",{type:"button",onClick:h,className:"text-sm text-blue-600 hover:text-blue-700 underline",children:"Generar insight"})]})}),e.jsx(Rt,{open:m,onOpenChange:u,children:e.jsxs(Ct,{className:"max-w-4xl max-h-[80vh]",children:[e.jsxs(_t,{children:[e.jsxs(Pt,{className:"flex items-center gap-2",children:[e.jsx(ac,{className:"w-5 h-5"}),"Prompt enviado a la IA"]}),e.jsx(rn,{children:"Este es el prompt completo que se envió al modelo de IA para generar el insight personalizado."})]}),e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"relative",children:e.jsx("pre",{className:"bg-gray-50 border rounded-lg p-4 text-sm font-mono leading-relaxed overflow-auto max-h-[50vh] whitespace-pre-wrap",children:c||"No hay prompt disponible"})})})]})})]})},e4=()=>{const[t,s]=f.useState(new Date);return bI(),e.jsxs(Xs,{children:[e.jsx(or,{selectedDate:t,onChange:s}),e.jsx("div",{className:"mb-8",children:e.jsx(UO,{date:t,variant:"detailed"})}),e.jsx("div",{className:"mb-8",children:e.jsx(QO,{date:t,variant:"detailed"})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-4 xl:grid-cols-8 gap-4 mb-8",children:[e.jsx(EI,{date:t,variant:"compact"}),e.jsx(TI,{date:t,variant:"compact"}),e.jsx(kI,{date:t,variant:"compact"}),e.jsx(MO,{date:t,variant:"compact"}),e.jsx(zO,{date:t,variant:"compact"}),e.jsx(FO,{date:t,variant:"compact"}),e.jsx(BO,{date:t,variant:"compact"}),e.jsx(HO,{date:t,variant:"compact"})]}),e.jsx("div",{className:"mb-8",children:e.jsx(WO,{date:t,variant:"detailed"})}),e.jsx("div",{className:"mb-8",children:e.jsx(VO,{date:t})}),e.jsx("div",{className:"mt-6",children:e.jsx(yI,{})})]})};function ff(t,[s,n]){return Math.min(n,Math.max(s,t))}function Pj(t){const s=f.useRef({value:t,previous:t});return f.useMemo(()=>(s.current.value!==t&&(s.current.previous=s.current.value,s.current.value=t),s.current.previous),[t])}var t4=[" ","Enter","ArrowUp","ArrowDown"],s4=[" ","Enter"],to="Select",[Pu,Mu,n4]=SA(to),[Xo,tW]=Br(to,[n4,Lo]),Iu=Lo(),[a4,Ti]=Xo(to),[r4,i4]=Xo(to),Mj=t=>{const{__scopeSelect:s,children:n,open:a,defaultOpen:r,onOpenChange:o,value:l,defaultValue:c,onValueChange:m,dir:u,name:h,autoComplete:p,disabled:g,required:x,form:b}=t,j=Iu(s),[v,w]=f.useState(null),[N,S]=f.useState(null),[E,T]=f.useState(!1),k=bu(u),[D,P]=$r({prop:a,defaultProp:r??!1,onChange:o,caller:to}),[_,B]=$r({prop:l,defaultProp:c,onChange:m,caller:to}),I=f.useRef(null),R=v?b||!!v.closest("form"):!0,[M,W]=f.useState(new Set),H=Array.from(M).map(L=>L.props.value).join(";");return e.jsx(Mf,{...j,children:e.jsxs(a4,{required:x,scope:s,trigger:v,onTriggerChange:w,valueNode:N,onValueNodeChange:S,valueNodeHasChildren:E,onValueNodeHasChildrenChange:T,contentId:$o(),value:_,onValueChange:B,open:D,onOpenChange:P,dir:k,triggerPointerDownPosRef:I,disabled:g,children:[e.jsx(Pu.Provider,{scope:s,children:e.jsx(r4,{scope:t.__scopeSelect,onNativeOptionAdd:f.useCallback(L=>{W($=>new Set($).add(L))},[]),onNativeOptionRemove:f.useCallback(L=>{W($=>{const q=new Set($);return q.delete(L),q})},[]),children:n})}),R?e.jsxs(aw,{"aria-hidden":!0,required:x,tabIndex:-1,name:h,autoComplete:p,value:_,onChange:L=>B(L.target.value),disabled:g,form:b,children:[_===void 0?e.jsx("option",{value:""}):null,Array.from(M)]},H):null]})})};Mj.displayName=to;var Ij="SelectTrigger",Oj=f.forwardRef((t,s)=>{const{__scopeSelect:n,disabled:a=!1,...r}=t,o=Iu(n),l=Ti(Ij,n),c=l.disabled||a,m=ws(s,l.onTriggerChange),u=Mu(n),h=f.useRef("touch"),[p,g,x]=iw(j=>{const v=u().filter(S=>!S.disabled),w=v.find(S=>S.value===l.value),N=ow(v,j,w);N!==void 0&&l.onValueChange(N.value)}),b=j=>{c||(l.onOpenChange(!0),x()),j&&(l.triggerPointerDownPosRef.current={x:Math.round(j.pageX),y:Math.round(j.pageY)})};return e.jsx(xu,{asChild:!0,...o,children:e.jsx(At.button,{type:"button",role:"combobox","aria-controls":l.contentId,"aria-expanded":l.open,"aria-required":l.required,"aria-autocomplete":"none",dir:l.dir,"data-state":l.open?"open":"closed",disabled:c,"data-disabled":c?"":void 0,"data-placeholder":rw(l.value)?"":void 0,...r,ref:m,onClick:nt(r.onClick,j=>{j.currentTarget.focus(),h.current!=="mouse"&&b(j)}),onPointerDown:nt(r.onPointerDown,j=>{h.current=j.pointerType;const v=j.target;v.hasPointerCapture(j.pointerId)&&v.releasePointerCapture(j.pointerId),j.button===0&&j.ctrlKey===!1&&j.pointerType==="mouse"&&(b(j),j.preventDefault())}),onKeyDown:nt(r.onKeyDown,j=>{const v=p.current!=="";!(j.ctrlKey||j.altKey||j.metaKey)&&j.key.length===1&&g(j.key),!(v&&j.key===" ")&&t4.includes(j.key)&&(b(),j.preventDefault())})})})});Oj.displayName=Ij;var Lj="SelectValue",$j=f.forwardRef((t,s)=>{const{__scopeSelect:n,className:a,style:r,children:o,placeholder:l="",...c}=t,m=Ti(Lj,n),{onValueNodeHasChildrenChange:u}=m,h=o!==void 0,p=ws(s,m.onValueNodeChange);return zr(()=>{u(h)},[u,h]),e.jsx(At.span,{...c,ref:p,style:{pointerEvents:"none"},children:rw(m.value)?e.jsx(e.Fragment,{children:l}):o})});$j.displayName=Lj;var o4="SelectIcon",zj=f.forwardRef((t,s)=>{const{__scopeSelect:n,children:a,...r}=t;return e.jsx(At.span,{"aria-hidden":!0,...r,ref:s,children:a||"▼"})});zj.displayName=o4;var l4="SelectPortal",Fj=t=>e.jsx(By,{asChild:!0,...t});Fj.displayName=l4;var so="SelectContent",Bj=f.forwardRef((t,s)=>{const n=Ti(so,t.__scopeSelect),[a,r]=f.useState();if(zr(()=>{r(new DocumentFragment)},[]),!n.open){const o=a;return o?xi.createPortal(e.jsx(Hj,{scope:t.__scopeSelect,children:e.jsx(Pu.Slot,{scope:t.__scopeSelect,children:e.jsx("div",{children:t.children})})}),o):null}return e.jsx(Wj,{...t,ref:s})});Bj.displayName=so;var Aa=10,[Hj,Di]=Xo(so),c4="SelectContentImpl",d4=Vy("SelectContent.RemoveScroll"),Wj=f.forwardRef((t,s)=>{const{__scopeSelect:n,position:a="item-aligned",onCloseAutoFocus:r,onEscapeKeyDown:o,onPointerDownOutside:l,side:c,sideOffset:m,align:u,alignOffset:h,arrowPadding:p,collisionBoundary:g,collisionPadding:x,sticky:b,hideWhenDetached:j,avoidCollisions:v,...w}=t,N=Ti(so,n),[S,E]=f.useState(null),[T,k]=f.useState(null),D=ws(s,ae=>E(ae)),[P,_]=f.useState(null),[B,I]=f.useState(null),R=Mu(n),[M,W]=f.useState(!1),H=f.useRef(!1);f.useEffect(()=>{if(S)return Hy(S)},[S]),Wy();const L=f.useCallback(ae=>{const[ge,...je]=R().map(de=>de.ref.current),[we]=je.slice(-1),ke=document.activeElement;for(const de of ae)if(de===ke||(de==null||de.scrollIntoView({block:"nearest"}),de===ge&&T&&(T.scrollTop=0),de===we&&T&&(T.scrollTop=T.scrollHeight),de==null||de.focus(),document.activeElement!==ke))return},[R,T]),$=f.useCallback(()=>L([P,S]),[L,P,S]);f.useEffect(()=>{M&&$()},[M,$]);const{onOpenChange:q,triggerPointerDownPosRef:re}=N;f.useEffect(()=>{if(S){let ae={x:0,y:0};const ge=we=>{var ke,de;ae={x:Math.abs(Math.round(we.pageX)-(((ke=re.current)==null?void 0:ke.x)??0)),y:Math.abs(Math.round(we.pageY)-(((de=re.current)==null?void 0:de.y)??0))}},je=we=>{ae.x<=10&&ae.y<=10?we.preventDefault():S.contains(we.target)||q(!1),document.removeEventListener("pointermove",ge),re.current=null};return re.current!==null&&(document.addEventListener("pointermove",ge),document.addEventListener("pointerup",je,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",ge),document.removeEventListener("pointerup",je,{capture:!0})}}},[S,q,re]),f.useEffect(()=>{const ae=()=>q(!1);return window.addEventListener("blur",ae),window.addEventListener("resize",ae),()=>{window.removeEventListener("blur",ae),window.removeEventListener("resize",ae)}},[q]);const[Y,se]=iw(ae=>{const ge=R().filter(ke=>!ke.disabled),je=ge.find(ke=>ke.ref.current===document.activeElement),we=ow(ge,ae,je);we&&setTimeout(()=>we.ref.current.focus())}),ie=f.useCallback((ae,ge,je)=>{const we=!H.current&&!je;(N.value!==void 0&&N.value===ge||we)&&(_(ae),we&&(H.current=!0))},[N.value]),U=f.useCallback(()=>S==null?void 0:S.focus(),[S]),ee=f.useCallback((ae,ge,je)=>{const we=!H.current&&!je;(N.value!==void 0&&N.value===ge||we)&&I(ae)},[N.value]),me=a==="popper"?pf:Uj,ue=me===pf?{side:c,sideOffset:m,align:u,alignOffset:h,arrowPadding:p,collisionBoundary:g,collisionPadding:x,sticky:b,hideWhenDetached:j,avoidCollisions:v}:{};return e.jsx(Hj,{scope:n,content:S,viewport:T,onViewportChange:k,itemRefCallback:ie,selectedItem:P,onItemLeave:U,itemTextRefCallback:ee,focusSelectedItem:$,selectedItemText:B,position:a,isPositioned:M,searchRef:Y,children:e.jsx(Uy,{as:d4,allowPinchZoom:!0,children:e.jsx(Gy,{asChild:!0,trapped:N.open,onMountAutoFocus:ae=>{ae.preventDefault()},onUnmountAutoFocus:nt(r,ae=>{var ge;(ge=N.trigger)==null||ge.focus({preventScroll:!0}),ae.preventDefault()}),children:e.jsx(_f,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:o,onPointerDownOutside:l,onFocusOutside:ae=>ae.preventDefault(),onDismiss:()=>N.onOpenChange(!1),children:e.jsx(me,{role:"listbox",id:N.contentId,"data-state":N.open?"open":"closed",dir:N.dir,onContextMenu:ae=>ae.preventDefault(),...w,...ue,onPlaced:()=>W(!0),ref:D,style:{display:"flex",flexDirection:"column",outline:"none",...w.style},onKeyDown:nt(w.onKeyDown,ae=>{const ge=ae.ctrlKey||ae.altKey||ae.metaKey;if(ae.key==="Tab"&&ae.preventDefault(),!ge&&ae.key.length===1&&se(ae.key),["ArrowUp","ArrowDown","Home","End"].includes(ae.key)){let we=R().filter(ke=>!ke.disabled).map(ke=>ke.ref.current);if(["ArrowUp","End"].includes(ae.key)&&(we=we.slice().reverse()),["ArrowUp","ArrowDown"].includes(ae.key)){const ke=ae.target,de=we.indexOf(ke);we=we.slice(de+1)}setTimeout(()=>L(we)),ae.preventDefault()}})})})})})})});Wj.displayName=c4;var u4="SelectItemAlignedPosition",Uj=f.forwardRef((t,s)=>{const{__scopeSelect:n,onPlaced:a,...r}=t,o=Ti(so,n),l=Di(so,n),[c,m]=f.useState(null),[u,h]=f.useState(null),p=ws(s,D=>h(D)),g=Mu(n),x=f.useRef(!1),b=f.useRef(!0),{viewport:j,selectedItem:v,selectedItemText:w,focusSelectedItem:N}=l,S=f.useCallback(()=>{if(o.trigger&&o.valueNode&&c&&u&&j&&v&&w){const D=o.trigger.getBoundingClientRect(),P=u.getBoundingClientRect(),_=o.valueNode.getBoundingClientRect(),B=w.getBoundingClientRect();if(o.dir!=="rtl"){const ke=B.left-P.left,de=_.left-ke,J=D.left-de,ve=D.width+J,ft=Math.max(ve,P.width),pt=window.innerWidth-Aa,ot=ff(de,[Aa,Math.max(Aa,pt-ft)]);c.style.minWidth=ve+"px",c.style.left=ot+"px"}else{const ke=P.right-B.right,de=window.innerWidth-_.right-ke,J=window.innerWidth-D.right-de,ve=D.width+J,ft=Math.max(ve,P.width),pt=window.innerWidth-Aa,ot=ff(de,[Aa,Math.max(Aa,pt-ft)]);c.style.minWidth=ve+"px",c.style.right=ot+"px"}const I=g(),R=window.innerHeight-Aa*2,M=j.scrollHeight,W=window.getComputedStyle(u),H=parseInt(W.borderTopWidth,10),L=parseInt(W.paddingTop,10),$=parseInt(W.borderBottomWidth,10),q=parseInt(W.paddingBottom,10),re=H+L+M+q+$,Y=Math.min(v.offsetHeight*5,re),se=window.getComputedStyle(j),ie=parseInt(se.paddingTop,10),U=parseInt(se.paddingBottom,10),ee=D.top+D.height/2-Aa,me=R-ee,ue=v.offsetHeight/2,ae=v.offsetTop+ue,ge=H+L+ae,je=re-ge;if(ge<=ee){const ke=I.length>0&&v===I[I.length-1].ref.current;c.style.bottom="0px";const de=u.clientHeight-j.offsetTop-j.offsetHeight,J=Math.max(me,ue+(ke?U:0)+de+$),ve=ge+J;c.style.height=ve+"px"}else{const ke=I.length>0&&v===I[0].ref.current;c.style.top="0px";const J=Math.max(ee,H+j.offsetTop+(ke?ie:0)+ue)+je;c.style.height=J+"px",j.scrollTop=ge-ee+j.offsetTop}c.style.margin=`${Aa}px 0`,c.style.minHeight=Y+"px",c.style.maxHeight=R+"px",a==null||a(),requestAnimationFrame(()=>x.current=!0)}},[g,o.trigger,o.valueNode,c,u,j,v,w,o.dir,a]);zr(()=>S(),[S]);const[E,T]=f.useState();zr(()=>{u&&T(window.getComputedStyle(u).zIndex)},[u]);const k=f.useCallback(D=>{D&&b.current===!0&&(S(),N==null||N(),b.current=!1)},[S,N]);return e.jsx(h4,{scope:n,contentWrapper:c,shouldExpandOnScrollRef:x,onScrollButtonChange:k,children:e.jsx("div",{ref:m,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:E},children:e.jsx(At.div,{...r,ref:p,style:{boxSizing:"border-box",maxHeight:"100%",...r.style}})})})});Uj.displayName=u4;var m4="SelectPopperPosition",pf=f.forwardRef((t,s)=>{const{__scopeSelect:n,align:a="start",collisionPadding:r=Aa,...o}=t,l=Iu(n);return e.jsx(Pf,{...l,...o,ref:s,align:a,collisionPadding:r,style:{boxSizing:"border-box",...o.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});pf.displayName=m4;var[h4,dp]=Xo(so,{}),xf="SelectViewport",Vj=f.forwardRef((t,s)=>{const{__scopeSelect:n,nonce:a,...r}=t,o=Di(xf,n),l=dp(xf,n),c=ws(s,o.onViewportChange),m=f.useRef(0);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:a}),e.jsx(Pu.Slot,{scope:n,children:e.jsx(At.div,{"data-radix-select-viewport":"",role:"presentation",...r,ref:c,style:{position:"relative",flex:1,overflow:"hidden auto",...r.style},onScroll:nt(r.onScroll,u=>{const h=u.currentTarget,{contentWrapper:p,shouldExpandOnScrollRef:g}=l;if(g!=null&&g.current&&p){const x=Math.abs(m.current-h.scrollTop);if(x>0){const b=window.innerHeight-Aa*2,j=parseFloat(p.style.minHeight),v=parseFloat(p.style.height),w=Math.max(j,v);if(w<b){const N=w+x,S=Math.min(b,N),E=N-S;p.style.height=S+"px",p.style.bottom==="0px"&&(h.scrollTop=E>0?E:0,p.style.justifyContent="flex-end")}}}m.current=h.scrollTop})})})]})});Vj.displayName=xf;var Gj="SelectGroup",[f4,p4]=Xo(Gj),x4=f.forwardRef((t,s)=>{const{__scopeSelect:n,...a}=t,r=$o();return e.jsx(f4,{scope:n,id:r,children:e.jsx(At.div,{role:"group","aria-labelledby":r,...a,ref:s})})});x4.displayName=Gj;var qj="SelectLabel",Yj=f.forwardRef((t,s)=>{const{__scopeSelect:n,...a}=t,r=p4(qj,n);return e.jsx(At.div,{id:r.id,...a,ref:s})});Yj.displayName=qj;var nu="SelectItem",[g4,Kj]=Xo(nu),Jj=f.forwardRef((t,s)=>{const{__scopeSelect:n,value:a,disabled:r=!1,textValue:o,...l}=t,c=Ti(nu,n),m=Di(nu,n),u=c.value===a,[h,p]=f.useState(o??""),[g,x]=f.useState(!1),b=ws(s,N=>{var S;return(S=m.itemRefCallback)==null?void 0:S.call(m,N,a,r)}),j=$o(),v=f.useRef("touch"),w=()=>{r||(c.onValueChange(a),c.onOpenChange(!1))};if(a==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return e.jsx(g4,{scope:n,value:a,disabled:r,textId:j,isSelected:u,onItemTextChange:f.useCallback(N=>{p(S=>S||((N==null?void 0:N.textContent)??"").trim())},[]),children:e.jsx(Pu.ItemSlot,{scope:n,value:a,disabled:r,textValue:h,children:e.jsx(At.div,{role:"option","aria-labelledby":j,"data-highlighted":g?"":void 0,"aria-selected":u&&g,"data-state":u?"checked":"unchecked","aria-disabled":r||void 0,"data-disabled":r?"":void 0,tabIndex:r?void 0:-1,...l,ref:b,onFocus:nt(l.onFocus,()=>x(!0)),onBlur:nt(l.onBlur,()=>x(!1)),onClick:nt(l.onClick,()=>{v.current!=="mouse"&&w()}),onPointerUp:nt(l.onPointerUp,()=>{v.current==="mouse"&&w()}),onPointerDown:nt(l.onPointerDown,N=>{v.current=N.pointerType}),onPointerMove:nt(l.onPointerMove,N=>{var S;v.current=N.pointerType,r?(S=m.onItemLeave)==null||S.call(m):v.current==="mouse"&&N.currentTarget.focus({preventScroll:!0})}),onPointerLeave:nt(l.onPointerLeave,N=>{var S;N.currentTarget===document.activeElement&&((S=m.onItemLeave)==null||S.call(m))}),onKeyDown:nt(l.onKeyDown,N=>{var E;((E=m.searchRef)==null?void 0:E.current)!==""&&N.key===" "||(s4.includes(N.key)&&w(),N.key===" "&&N.preventDefault())})})})})});Jj.displayName=nu;var Ul="SelectItemText",Xj=f.forwardRef((t,s)=>{const{__scopeSelect:n,className:a,style:r,...o}=t,l=Ti(Ul,n),c=Di(Ul,n),m=Kj(Ul,n),u=i4(Ul,n),[h,p]=f.useState(null),g=ws(s,w=>p(w),m.onItemTextChange,w=>{var N;return(N=c.itemTextRefCallback)==null?void 0:N.call(c,w,m.value,m.disabled)}),x=h==null?void 0:h.textContent,b=f.useMemo(()=>e.jsx("option",{value:m.value,disabled:m.disabled,children:x},m.value),[m.disabled,m.value,x]),{onNativeOptionAdd:j,onNativeOptionRemove:v}=u;return zr(()=>(j(b),()=>v(b)),[j,v,b]),e.jsxs(e.Fragment,{children:[e.jsx(At.span,{id:m.textId,...o,ref:g}),m.isSelected&&l.valueNode&&!l.valueNodeHasChildren?xi.createPortal(o.children,l.valueNode):null]})});Xj.displayName=Ul;var Zj="SelectItemIndicator",Qj=f.forwardRef((t,s)=>{const{__scopeSelect:n,...a}=t;return Kj(Zj,n).isSelected?e.jsx(At.span,{"aria-hidden":!0,...a,ref:s}):null});Qj.displayName=Zj;var gf="SelectScrollUpButton",ew=f.forwardRef((t,s)=>{const n=Di(gf,t.__scopeSelect),a=dp(gf,t.__scopeSelect),[r,o]=f.useState(!1),l=ws(s,a.onScrollButtonChange);return zr(()=>{if(n.viewport&&n.isPositioned){let c=function(){const u=m.scrollTop>0;o(u)};const m=n.viewport;return c(),m.addEventListener("scroll",c),()=>m.removeEventListener("scroll",c)}},[n.viewport,n.isPositioned]),r?e.jsx(sw,{...t,ref:l,onAutoScroll:()=>{const{viewport:c,selectedItem:m}=n;c&&m&&(c.scrollTop=c.scrollTop-m.offsetHeight)}}):null});ew.displayName=gf;var vf="SelectScrollDownButton",tw=f.forwardRef((t,s)=>{const n=Di(vf,t.__scopeSelect),a=dp(vf,t.__scopeSelect),[r,o]=f.useState(!1),l=ws(s,a.onScrollButtonChange);return zr(()=>{if(n.viewport&&n.isPositioned){let c=function(){const u=m.scrollHeight-m.clientHeight,h=Math.ceil(m.scrollTop)<u;o(h)};const m=n.viewport;return c(),m.addEventListener("scroll",c),()=>m.removeEventListener("scroll",c)}},[n.viewport,n.isPositioned]),r?e.jsx(sw,{...t,ref:l,onAutoScroll:()=>{const{viewport:c,selectedItem:m}=n;c&&m&&(c.scrollTop=c.scrollTop+m.offsetHeight)}}):null});tw.displayName=vf;var sw=f.forwardRef((t,s)=>{const{__scopeSelect:n,onAutoScroll:a,...r}=t,o=Di("SelectScrollButton",n),l=f.useRef(null),c=Mu(n),m=f.useCallback(()=>{l.current!==null&&(window.clearInterval(l.current),l.current=null)},[]);return f.useEffect(()=>()=>m(),[m]),zr(()=>{var h;const u=c().find(p=>p.ref.current===document.activeElement);(h=u==null?void 0:u.ref.current)==null||h.scrollIntoView({block:"nearest"})},[c]),e.jsx(At.div,{"aria-hidden":!0,...r,ref:s,style:{flexShrink:0,...r.style},onPointerDown:nt(r.onPointerDown,()=>{l.current===null&&(l.current=window.setInterval(a,50))}),onPointerMove:nt(r.onPointerMove,()=>{var u;(u=o.onItemLeave)==null||u.call(o),l.current===null&&(l.current=window.setInterval(a,50))}),onPointerLeave:nt(r.onPointerLeave,()=>{m()})})}),v4="SelectSeparator",nw=f.forwardRef((t,s)=>{const{__scopeSelect:n,...a}=t;return e.jsx(At.div,{"aria-hidden":!0,...a,ref:s})});nw.displayName=v4;var yf="SelectArrow",y4=f.forwardRef((t,s)=>{const{__scopeSelect:n,...a}=t,r=Iu(n),o=Ti(yf,n),l=Di(yf,n);return o.open&&l.position==="popper"?e.jsx(If,{...r,...a,ref:s}):null});y4.displayName=yf;var b4="SelectBubbleInput",aw=f.forwardRef(({__scopeSelect:t,value:s,...n},a)=>{const r=f.useRef(null),o=ws(a,r),l=Pj(s);return f.useEffect(()=>{const c=r.current;if(!c)return;const m=window.HTMLSelectElement.prototype,h=Object.getOwnPropertyDescriptor(m,"value").set;if(l!==s&&h){const p=new Event("change",{bubbles:!0});h.call(c,s),c.dispatchEvent(p)}},[l,s]),e.jsx(At.select,{...n,style:{...Wb,...n.style},ref:o,defaultValue:s})});aw.displayName=b4;function rw(t){return t===""||t===void 0}function iw(t){const s=hi(t),n=f.useRef(""),a=f.useRef(0),r=f.useCallback(l=>{const c=n.current+l;s(c),function m(u){n.current=u,window.clearTimeout(a.current),u!==""&&(a.current=window.setTimeout(()=>m(""),1e3))}(c)},[s]),o=f.useCallback(()=>{n.current="",window.clearTimeout(a.current)},[]);return f.useEffect(()=>()=>window.clearTimeout(a.current),[]),[n,r,o]}function ow(t,s,n){const r=s.length>1&&Array.from(s).every(u=>u===s[0])?s[0]:s,o=n?t.indexOf(n):-1;let l=j4(t,Math.max(o,0));r.length===1&&(l=l.filter(u=>u!==n));const m=l.find(u=>u.textValue.toLowerCase().startsWith(r.toLowerCase()));return m!==n?m:void 0}function j4(t,s){return t.map((n,a)=>t[(s+a)%t.length])}var w4=Mj,lw=Oj,N4=$j,S4=zj,C4=Fj,cw=Bj,E4=Vj,dw=Yj,uw=Jj,T4=Xj,D4=Qj,mw=ew,hw=tw,fw=nw;const Nt=w4,St=N4,xt=f.forwardRef(({className:t,children:s,...n},a)=>e.jsxs(lw,{ref:a,className:ce("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...n,children:[s,e.jsx(S4,{asChild:!0,children:e.jsx(_n,{className:"h-4 w-4 opacity-50"})})]}));xt.displayName=lw.displayName;const pw=f.forwardRef(({className:t,...s},n)=>e.jsx(mw,{ref:n,className:ce("flex cursor-default items-center justify-center py-1",t),...s,children:e.jsx(Xi,{className:"h-4 w-4"})}));pw.displayName=mw.displayName;const xw=f.forwardRef(({className:t,...s},n)=>e.jsx(hw,{ref:n,className:ce("flex cursor-default items-center justify-center py-1",t),...s,children:e.jsx(_n,{className:"h-4 w-4"})}));xw.displayName=hw.displayName;const gt=f.forwardRef(({className:t,children:s,position:n="popper",...a},r)=>e.jsx(C4,{children:e.jsxs(cw,{ref:r,className:ce("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:n,...a,children:[e.jsx(pw,{}),e.jsx(E4,{className:ce("p-1",n==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),e.jsx(xw,{})]})}));gt.displayName=cw.displayName;const k4=f.forwardRef(({className:t,...s},n)=>e.jsx(dw,{ref:n,className:ce("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...s}));k4.displayName=dw.displayName;const Pe=f.forwardRef(({className:t,children:s,...n},a)=>e.jsxs(uw,{ref:a,className:ce("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(D4,{children:e.jsx(ro,{className:"h-4 w-4"})})}),e.jsx(T4,{children:s})]}));Pe.displayName=uw.displayName;const A4=f.forwardRef(({className:t,...s},n)=>e.jsx(fw,{ref:n,className:ce("-mx-1 my-1 h-px bg-muted",t),...s}));A4.displayName=fw.displayName;const jv={lastMonth:{label:"Último mes",getValue:t=>({start:ts(Hl(t,1)),end:ea(Hl(t,1))})},currentMonth:{label:"Mes actual",getValue:t=>({start:ts(t),end:ea(t)})},last3Months:{label:"Últimos 3 meses",getValue:t=>({start:ts(Hl(t,2)),end:ea(t)})},last6Months:{label:"Últimos 6 meses",getValue:t=>({start:ts(Hl(t,5)),end:ea(t)})},lastYear:{label:"Último año",getValue:t=>({start:Bh(M0(t)),end:P0(M0(t))})},currentYear:{label:"Año actual",getValue:t=>({start:Bh(t),end:P0(t)})}},R4=({onPeriodChange:t})=>{const s=n=>{const a=new Date,r=jv[n];if(r){const{start:o,end:l}=r.getValue(a);t(o,l)}};return e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("span",{className:"text-sm font-medium",children:"Mostrar período:"}),e.jsxs(Nt,{onValueChange:s,defaultValue:"currentMonth",children:[e.jsx(xt,{className:"w-[180px]",children:e.jsx(St,{placeholder:"Seleccionar período"})}),e.jsx(gt,{children:Object.entries(jv).map(([n,{label:a}])=>e.jsx(Pe,{value:n,children:a},n))})]})]})},Ne=f.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:ce("rounded-lg border bg-card text-card-foreground shadow-sm overflow-hidden",t),...s}));Ne.displayName="Card";const Vt=f.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:ce("flex flex-col space-y-1.5 p-4 md:p-6",t),...s}));Vt.displayName="CardHeader";const Wt=f.forwardRef(({className:t,...s},n)=>e.jsx("h3",{ref:n,className:ce("text-lg md:text-2xl font-semibold leading-none tracking-tight",t),...s}));Wt.displayName="CardTitle";const fi=f.forwardRef(({className:t,...s},n)=>e.jsx("p",{ref:n,className:ce("text-sm md:text-base text-muted-foreground",t),...s}));fi.displayName="CardDescription";const De=f.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:ce("p-4 md:p-6 pt-0",t),...s}));De.displayName="CardContent";const bn=f.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:ce("flex items-center p-4 md:p-6 pt-0",t),...s}));bn.displayName="CardFooter";var au={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */au.exports;(function(t,s){(function(){var n,a="4.17.21",r=200,o="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",l="Expected a function",c="Invalid `variable` option passed into `_.template`",m="__lodash_hash_undefined__",u=500,h="__lodash_placeholder__",p=1,g=2,x=4,b=1,j=2,v=1,w=2,N=4,S=8,E=16,T=32,k=64,D=128,P=256,_=512,B=30,I="...",R=800,M=16,W=1,H=2,L=3,$=1/0,q=9007199254740991,re=17976931348623157e292,Y=NaN,se=4294967295,ie=se-1,U=se>>>1,ee=[["ary",D],["bind",v],["bindKey",w],["curry",S],["curryRight",E],["flip",_],["partial",T],["partialRight",k],["rearg",P]],me="[object Arguments]",ue="[object Array]",ae="[object AsyncFunction]",ge="[object Boolean]",je="[object Date]",we="[object DOMException]",ke="[object Error]",de="[object Function]",J="[object GeneratorFunction]",ve="[object Map]",ft="[object Number]",pt="[object Null]",ot="[object Object]",zs="[object Promise]",gs="[object Proxy]",G="[object RegExp]",te="[object Set]",le="[object String]",Ce="[object Symbol]",Se="[object Undefined]",be="[object WeakMap]",Re="[object WeakSet]",Ve="[object ArrayBuffer]",Qe="[object DataView]",Yt="[object Float32Array]",Cs="[object Float64Array]",Ut="[object Int8Array]",Us="[object Int16Array]",Fs="[object Int32Array]",ss="[object Uint8Array]",Rs="[object Uint8ClampedArray]",Es="[object Uint16Array]",Nn="[object Uint32Array]",We=/\b__p \+= '';/g,lt=/\b(__p \+=) '' \+/g,yt=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Ft=/&(?:amp|lt|gt|quot|#39);/g,Ue=/[&<>"']/g,ut=RegExp(Ft.source),Mt=RegExp(Ue.source),Ae=/<%-([\s\S]+?)%>/g,Oe=/<%([\s\S]+?)%>/g,Ye=/<%=([\s\S]+?)%>/g,Et=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,It=/^\w*$/,Tt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ds=/[\\^$.*+?()[\]{}|]/g,us=RegExp(ds.source),Bt=/^\s+/,In=/\s/,Ka=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,qn=/\{\n\/\* \[wrapped with (.+)\] \*/,ja=/,? & /,Vr=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,wa=/[()=,{}\[\]\/\s]/,$c=/\\(\\)?/g,zc=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,rl=/\w*$/,Fc=/^[-+]0x[0-9a-f]+$/i,Zu=/^0b[01]+$/i,Ge=/^\[object .+?Constructor\]$/,X=/^0o[0-7]+$/i,Ee=/^(?:0|[1-9]\d*)$/,Le=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Zt=/($^)/,Zs=/['\n\r\u2028\u2029\\]/g,vs="\\ud800-\\udfff",mn="\\u0300-\\u036f",Na="\\ufe20-\\ufe2f",_i="\\u20d0-\\u20ff",lo=mn+Na+_i,Vs="\\u2700-\\u27bf",il="a-z\\xdf-\\xf6\\xf8-\\xff",Bc="\\xac\\xb1\\xd7\\xf7",vC="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",yC="\\u2000-\\u206f",bC=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",ux="A-Z\\xc0-\\xd6\\xd8-\\xde",mx="\\ufe0e\\ufe0f",hx=Bc+vC+yC+bC,Qu="['’]",jC="["+vs+"]",fx="["+hx+"]",Hc="["+lo+"]",px="\\d+",wC="["+Vs+"]",xx="["+il+"]",gx="[^"+vs+hx+px+Vs+il+ux+"]",em="\\ud83c[\\udffb-\\udfff]",NC="(?:"+Hc+"|"+em+")",vx="[^"+vs+"]",tm="(?:\\ud83c[\\udde6-\\uddff]){2}",sm="[\\ud800-\\udbff][\\udc00-\\udfff]",co="["+ux+"]",yx="\\u200d",bx="(?:"+xx+"|"+gx+")",SC="(?:"+co+"|"+gx+")",jx="(?:"+Qu+"(?:d|ll|m|re|s|t|ve))?",wx="(?:"+Qu+"(?:D|LL|M|RE|S|T|VE))?",Nx=NC+"?",Sx="["+mx+"]?",CC="(?:"+yx+"(?:"+[vx,tm,sm].join("|")+")"+Sx+Nx+")*",EC="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",TC="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Cx=Sx+Nx+CC,DC="(?:"+[wC,tm,sm].join("|")+")"+Cx,kC="(?:"+[vx+Hc+"?",Hc,tm,sm,jC].join("|")+")",AC=RegExp(Qu,"g"),RC=RegExp(Hc,"g"),nm=RegExp(em+"(?="+em+")|"+kC+Cx,"g"),_C=RegExp([co+"?"+xx+"+"+jx+"(?="+[fx,co,"$"].join("|")+")",SC+"+"+wx+"(?="+[fx,co+bx,"$"].join("|")+")",co+"?"+bx+"+"+jx,co+"+"+wx,TC,EC,px,DC].join("|"),"g"),PC=RegExp("["+yx+vs+lo+mx+"]"),MC=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,IC=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],OC=-1,ps={};ps[Yt]=ps[Cs]=ps[Ut]=ps[Us]=ps[Fs]=ps[ss]=ps[Rs]=ps[Es]=ps[Nn]=!0,ps[me]=ps[ue]=ps[Ve]=ps[ge]=ps[Qe]=ps[je]=ps[ke]=ps[de]=ps[ve]=ps[ft]=ps[ot]=ps[G]=ps[te]=ps[le]=ps[be]=!1;var ms={};ms[me]=ms[ue]=ms[Ve]=ms[Qe]=ms[ge]=ms[je]=ms[Yt]=ms[Cs]=ms[Ut]=ms[Us]=ms[Fs]=ms[ve]=ms[ft]=ms[ot]=ms[G]=ms[te]=ms[le]=ms[Ce]=ms[ss]=ms[Rs]=ms[Es]=ms[Nn]=!0,ms[ke]=ms[de]=ms[be]=!1;var LC={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},$C={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},zC={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},FC={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},BC=parseFloat,HC=parseInt,Ex=typeof wl=="object"&&wl&&wl.Object===Object&&wl,WC=typeof self=="object"&&self&&self.Object===Object&&self,on=Ex||WC||Function("return this")(),am=s&&!s.nodeType&&s,Pi=am&&!0&&t&&!t.nodeType&&t,Tx=Pi&&Pi.exports===am,rm=Tx&&Ex.process,na=function(){try{var Q=Pi&&Pi.require&&Pi.require("util").types;return Q||rm&&rm.binding&&rm.binding("util")}catch{}}(),Dx=na&&na.isArrayBuffer,kx=na&&na.isDate,Ax=na&&na.isMap,Rx=na&&na.isRegExp,_x=na&&na.isSet,Px=na&&na.isTypedArray;function Yn(Q,he,oe){switch(oe.length){case 0:return Q.call(he);case 1:return Q.call(he,oe[0]);case 2:return Q.call(he,oe[0],oe[1]);case 3:return Q.call(he,oe[0],oe[1],oe[2])}return Q.apply(he,oe)}function UC(Q,he,oe,Ie){for(var et=-1,Gt=Q==null?0:Q.length;++et<Gt;){var Gs=Q[et];he(Ie,Gs,oe(Gs),Q)}return Ie}function aa(Q,he){for(var oe=-1,Ie=Q==null?0:Q.length;++oe<Ie&&he(Q[oe],oe,Q)!==!1;);return Q}function VC(Q,he){for(var oe=Q==null?0:Q.length;oe--&&he(Q[oe],oe,Q)!==!1;);return Q}function Mx(Q,he){for(var oe=-1,Ie=Q==null?0:Q.length;++oe<Ie;)if(!he(Q[oe],oe,Q))return!1;return!0}function Gr(Q,he){for(var oe=-1,Ie=Q==null?0:Q.length,et=0,Gt=[];++oe<Ie;){var Gs=Q[oe];he(Gs,oe,Q)&&(Gt[et++]=Gs)}return Gt}function Wc(Q,he){var oe=Q==null?0:Q.length;return!!oe&&uo(Q,he,0)>-1}function im(Q,he,oe){for(var Ie=-1,et=Q==null?0:Q.length;++Ie<et;)if(oe(he,Q[Ie]))return!0;return!1}function ys(Q,he){for(var oe=-1,Ie=Q==null?0:Q.length,et=Array(Ie);++oe<Ie;)et[oe]=he(Q[oe],oe,Q);return et}function qr(Q,he){for(var oe=-1,Ie=he.length,et=Q.length;++oe<Ie;)Q[et+oe]=he[oe];return Q}function om(Q,he,oe,Ie){var et=-1,Gt=Q==null?0:Q.length;for(Ie&&Gt&&(oe=Q[++et]);++et<Gt;)oe=he(oe,Q[et],et,Q);return oe}function GC(Q,he,oe,Ie){var et=Q==null?0:Q.length;for(Ie&&et&&(oe=Q[--et]);et--;)oe=he(oe,Q[et],et,Q);return oe}function lm(Q,he){for(var oe=-1,Ie=Q==null?0:Q.length;++oe<Ie;)if(he(Q[oe],oe,Q))return!0;return!1}var qC=cm("length");function YC(Q){return Q.split("")}function KC(Q){return Q.match(Vr)||[]}function Ix(Q,he,oe){var Ie;return oe(Q,function(et,Gt,Gs){if(he(et,Gt,Gs))return Ie=Gt,!1}),Ie}function Uc(Q,he,oe,Ie){for(var et=Q.length,Gt=oe+(Ie?1:-1);Ie?Gt--:++Gt<et;)if(he(Q[Gt],Gt,Q))return Gt;return-1}function uo(Q,he,oe){return he===he?o1(Q,he,oe):Uc(Q,Ox,oe)}function JC(Q,he,oe,Ie){for(var et=oe-1,Gt=Q.length;++et<Gt;)if(Ie(Q[et],he))return et;return-1}function Ox(Q){return Q!==Q}function Lx(Q,he){var oe=Q==null?0:Q.length;return oe?um(Q,he)/oe:Y}function cm(Q){return function(he){return he==null?n:he[Q]}}function dm(Q){return function(he){return Q==null?n:Q[he]}}function $x(Q,he,oe,Ie,et){return et(Q,function(Gt,Gs,rs){oe=Ie?(Ie=!1,Gt):he(oe,Gt,Gs,rs)}),oe}function XC(Q,he){var oe=Q.length;for(Q.sort(he);oe--;)Q[oe]=Q[oe].value;return Q}function um(Q,he){for(var oe,Ie=-1,et=Q.length;++Ie<et;){var Gt=he(Q[Ie]);Gt!==n&&(oe=oe===n?Gt:oe+Gt)}return oe}function mm(Q,he){for(var oe=-1,Ie=Array(Q);++oe<Q;)Ie[oe]=he(oe);return Ie}function ZC(Q,he){return ys(he,function(oe){return[oe,Q[oe]]})}function zx(Q){return Q&&Q.slice(0,Wx(Q)+1).replace(Bt,"")}function Kn(Q){return function(he){return Q(he)}}function hm(Q,he){return ys(he,function(oe){return Q[oe]})}function ol(Q,he){return Q.has(he)}function Fx(Q,he){for(var oe=-1,Ie=Q.length;++oe<Ie&&uo(he,Q[oe],0)>-1;);return oe}function Bx(Q,he){for(var oe=Q.length;oe--&&uo(he,Q[oe],0)>-1;);return oe}function QC(Q,he){for(var oe=Q.length,Ie=0;oe--;)Q[oe]===he&&++Ie;return Ie}var e1=dm(LC),t1=dm($C);function s1(Q){return"\\"+FC[Q]}function n1(Q,he){return Q==null?n:Q[he]}function mo(Q){return PC.test(Q)}function a1(Q){return MC.test(Q)}function r1(Q){for(var he,oe=[];!(he=Q.next()).done;)oe.push(he.value);return oe}function fm(Q){var he=-1,oe=Array(Q.size);return Q.forEach(function(Ie,et){oe[++he]=[et,Ie]}),oe}function Hx(Q,he){return function(oe){return Q(he(oe))}}function Yr(Q,he){for(var oe=-1,Ie=Q.length,et=0,Gt=[];++oe<Ie;){var Gs=Q[oe];(Gs===he||Gs===h)&&(Q[oe]=h,Gt[et++]=oe)}return Gt}function Vc(Q){var he=-1,oe=Array(Q.size);return Q.forEach(function(Ie){oe[++he]=Ie}),oe}function i1(Q){var he=-1,oe=Array(Q.size);return Q.forEach(function(Ie){oe[++he]=[Ie,Ie]}),oe}function o1(Q,he,oe){for(var Ie=oe-1,et=Q.length;++Ie<et;)if(Q[Ie]===he)return Ie;return-1}function l1(Q,he,oe){for(var Ie=oe+1;Ie--;)if(Q[Ie]===he)return Ie;return Ie}function ho(Q){return mo(Q)?d1(Q):qC(Q)}function Sa(Q){return mo(Q)?u1(Q):YC(Q)}function Wx(Q){for(var he=Q.length;he--&&In.test(Q.charAt(he)););return he}var c1=dm(zC);function d1(Q){for(var he=nm.lastIndex=0;nm.test(Q);)++he;return he}function u1(Q){return Q.match(nm)||[]}function m1(Q){return Q.match(_C)||[]}var h1=function Q(he){he=he==null?on:fo.defaults(on.Object(),he,fo.pick(on,IC));var oe=he.Array,Ie=he.Date,et=he.Error,Gt=he.Function,Gs=he.Math,rs=he.Object,pm=he.RegExp,f1=he.String,ra=he.TypeError,Gc=oe.prototype,p1=Gt.prototype,po=rs.prototype,qc=he["__core-js_shared__"],Yc=p1.toString,Qt=po.hasOwnProperty,x1=0,Ux=function(){var i=/[^.]+$/.exec(qc&&qc.keys&&qc.keys.IE_PROTO||"");return i?"Symbol(src)_1."+i:""}(),Kc=po.toString,g1=Yc.call(rs),v1=on._,y1=pm("^"+Yc.call(Qt).replace(ds,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Jc=Tx?he.Buffer:n,Kr=he.Symbol,Xc=he.Uint8Array,Vx=Jc?Jc.allocUnsafe:n,Zc=Hx(rs.getPrototypeOf,rs),Gx=rs.create,qx=po.propertyIsEnumerable,Qc=Gc.splice,Yx=Kr?Kr.isConcatSpreadable:n,ll=Kr?Kr.iterator:n,Mi=Kr?Kr.toStringTag:n,ed=function(){try{var i=zi(rs,"defineProperty");return i({},"",{}),i}catch{}}(),b1=he.clearTimeout!==on.clearTimeout&&he.clearTimeout,j1=Ie&&Ie.now!==on.Date.now&&Ie.now,w1=he.setTimeout!==on.setTimeout&&he.setTimeout,td=Gs.ceil,sd=Gs.floor,xm=rs.getOwnPropertySymbols,N1=Jc?Jc.isBuffer:n,Kx=he.isFinite,S1=Gc.join,C1=Hx(rs.keys,rs),qs=Gs.max,hn=Gs.min,E1=Ie.now,T1=he.parseInt,Jx=Gs.random,D1=Gc.reverse,gm=zi(he,"DataView"),cl=zi(he,"Map"),vm=zi(he,"Promise"),xo=zi(he,"Set"),dl=zi(he,"WeakMap"),ul=zi(rs,"create"),nd=dl&&new dl,go={},k1=Fi(gm),A1=Fi(cl),R1=Fi(vm),_1=Fi(xo),P1=Fi(dl),ad=Kr?Kr.prototype:n,ml=ad?ad.valueOf:n,Xx=ad?ad.toString:n;function O(i){if(Ts(i)&&!tt(i)&&!(i instanceof Dt)){if(i instanceof ia)return i;if(Qt.call(i,"__wrapped__"))return Zg(i)}return new ia(i)}var vo=function(){function i(){}return function(d){if(!Ns(d))return{};if(Gx)return Gx(d);i.prototype=d;var y=new i;return i.prototype=n,y}}();function rd(){}function ia(i,d){this.__wrapped__=i,this.__actions__=[],this.__chain__=!!d,this.__index__=0,this.__values__=n}O.templateSettings={escape:Ae,evaluate:Oe,interpolate:Ye,variable:"",imports:{_:O}},O.prototype=rd.prototype,O.prototype.constructor=O,ia.prototype=vo(rd.prototype),ia.prototype.constructor=ia;function Dt(i){this.__wrapped__=i,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=se,this.__views__=[]}function M1(){var i=new Dt(this.__wrapped__);return i.__actions__=On(this.__actions__),i.__dir__=this.__dir__,i.__filtered__=this.__filtered__,i.__iteratees__=On(this.__iteratees__),i.__takeCount__=this.__takeCount__,i.__views__=On(this.__views__),i}function I1(){if(this.__filtered__){var i=new Dt(this);i.__dir__=-1,i.__filtered__=!0}else i=this.clone(),i.__dir__*=-1;return i}function O1(){var i=this.__wrapped__.value(),d=this.__dir__,y=tt(i),C=d<0,A=y?i.length:0,F=YE(0,A,this.__views__),V=F.start,K=F.end,ne=K-V,pe=C?K:V-1,xe=this.__iteratees__,ye=xe.length,_e=0,He=hn(ne,this.__takeCount__);if(!y||!C&&A==ne&&He==ne)return jg(i,this.__actions__);var Je=[];e:for(;ne--&&_e<He;){pe+=d;for(var ct=-1,Xe=i[pe];++ct<ye;){var bt=xe[ct],Ot=bt.iteratee,Zn=bt.type,En=Ot(Xe);if(Zn==H)Xe=En;else if(!En){if(Zn==W)continue e;break e}}Je[_e++]=Xe}return Je}Dt.prototype=vo(rd.prototype),Dt.prototype.constructor=Dt;function Ii(i){var d=-1,y=i==null?0:i.length;for(this.clear();++d<y;){var C=i[d];this.set(C[0],C[1])}}function L1(){this.__data__=ul?ul(null):{},this.size=0}function $1(i){var d=this.has(i)&&delete this.__data__[i];return this.size-=d?1:0,d}function z1(i){var d=this.__data__;if(ul){var y=d[i];return y===m?n:y}return Qt.call(d,i)?d[i]:n}function F1(i){var d=this.__data__;return ul?d[i]!==n:Qt.call(d,i)}function B1(i,d){var y=this.__data__;return this.size+=this.has(i)?0:1,y[i]=ul&&d===n?m:d,this}Ii.prototype.clear=L1,Ii.prototype.delete=$1,Ii.prototype.get=z1,Ii.prototype.has=F1,Ii.prototype.set=B1;function yr(i){var d=-1,y=i==null?0:i.length;for(this.clear();++d<y;){var C=i[d];this.set(C[0],C[1])}}function H1(){this.__data__=[],this.size=0}function W1(i){var d=this.__data__,y=id(d,i);if(y<0)return!1;var C=d.length-1;return y==C?d.pop():Qc.call(d,y,1),--this.size,!0}function U1(i){var d=this.__data__,y=id(d,i);return y<0?n:d[y][1]}function V1(i){return id(this.__data__,i)>-1}function G1(i,d){var y=this.__data__,C=id(y,i);return C<0?(++this.size,y.push([i,d])):y[C][1]=d,this}yr.prototype.clear=H1,yr.prototype.delete=W1,yr.prototype.get=U1,yr.prototype.has=V1,yr.prototype.set=G1;function br(i){var d=-1,y=i==null?0:i.length;for(this.clear();++d<y;){var C=i[d];this.set(C[0],C[1])}}function q1(){this.size=0,this.__data__={hash:new Ii,map:new(cl||yr),string:new Ii}}function Y1(i){var d=vd(this,i).delete(i);return this.size-=d?1:0,d}function K1(i){return vd(this,i).get(i)}function J1(i){return vd(this,i).has(i)}function X1(i,d){var y=vd(this,i),C=y.size;return y.set(i,d),this.size+=y.size==C?0:1,this}br.prototype.clear=q1,br.prototype.delete=Y1,br.prototype.get=K1,br.prototype.has=J1,br.prototype.set=X1;function Oi(i){var d=-1,y=i==null?0:i.length;for(this.__data__=new br;++d<y;)this.add(i[d])}function Z1(i){return this.__data__.set(i,m),this}function Q1(i){return this.__data__.has(i)}Oi.prototype.add=Oi.prototype.push=Z1,Oi.prototype.has=Q1;function Ca(i){var d=this.__data__=new yr(i);this.size=d.size}function eE(){this.__data__=new yr,this.size=0}function tE(i){var d=this.__data__,y=d.delete(i);return this.size=d.size,y}function sE(i){return this.__data__.get(i)}function nE(i){return this.__data__.has(i)}function aE(i,d){var y=this.__data__;if(y instanceof yr){var C=y.__data__;if(!cl||C.length<r-1)return C.push([i,d]),this.size=++y.size,this;y=this.__data__=new br(C)}return y.set(i,d),this.size=y.size,this}Ca.prototype.clear=eE,Ca.prototype.delete=tE,Ca.prototype.get=sE,Ca.prototype.has=nE,Ca.prototype.set=aE;function Zx(i,d){var y=tt(i),C=!y&&Bi(i),A=!y&&!C&&ei(i),F=!y&&!C&&!A&&wo(i),V=y||C||A||F,K=V?mm(i.length,f1):[],ne=K.length;for(var pe in i)(d||Qt.call(i,pe))&&!(V&&(pe=="length"||A&&(pe=="offset"||pe=="parent")||F&&(pe=="buffer"||pe=="byteLength"||pe=="byteOffset")||Sr(pe,ne)))&&K.push(pe);return K}function Qx(i){var d=i.length;return d?i[km(0,d-1)]:n}function rE(i,d){return yd(On(i),Li(d,0,i.length))}function iE(i){return yd(On(i))}function ym(i,d,y){(y!==n&&!Ea(i[d],y)||y===n&&!(d in i))&&jr(i,d,y)}function hl(i,d,y){var C=i[d];(!(Qt.call(i,d)&&Ea(C,y))||y===n&&!(d in i))&&jr(i,d,y)}function id(i,d){for(var y=i.length;y--;)if(Ea(i[y][0],d))return y;return-1}function oE(i,d,y,C){return Jr(i,function(A,F,V){d(C,A,y(A),V)}),C}function eg(i,d){return i&&Xa(d,Qs(d),i)}function lE(i,d){return i&&Xa(d,$n(d),i)}function jr(i,d,y){d=="__proto__"&&ed?ed(i,d,{configurable:!0,enumerable:!0,value:y,writable:!0}):i[d]=y}function bm(i,d){for(var y=-1,C=d.length,A=oe(C),F=i==null;++y<C;)A[y]=F?n:eh(i,d[y]);return A}function Li(i,d,y){return i===i&&(y!==n&&(i=i<=y?i:y),d!==n&&(i=i>=d?i:d)),i}function oa(i,d,y,C,A,F){var V,K=d&p,ne=d&g,pe=d&x;if(y&&(V=A?y(i,C,A,F):y(i)),V!==n)return V;if(!Ns(i))return i;var xe=tt(i);if(xe){if(V=JE(i),!K)return On(i,V)}else{var ye=fn(i),_e=ye==de||ye==J;if(ei(i))return Sg(i,K);if(ye==ot||ye==me||_e&&!A){if(V=ne||_e?{}:Wg(i),!K)return ne?zE(i,lE(V,i)):$E(i,eg(V,i))}else{if(!ms[ye])return A?i:{};V=XE(i,ye,K)}}F||(F=new Ca);var He=F.get(i);if(He)return He;F.set(i,V),v0(i)?i.forEach(function(Xe){V.add(oa(Xe,d,y,Xe,i,F))}):x0(i)&&i.forEach(function(Xe,bt){V.set(bt,oa(Xe,d,y,bt,i,F))});var Je=pe?ne?Fm:zm:ne?$n:Qs,ct=xe?n:Je(i);return aa(ct||i,function(Xe,bt){ct&&(bt=Xe,Xe=i[bt]),hl(V,bt,oa(Xe,d,y,bt,i,F))}),V}function cE(i){var d=Qs(i);return function(y){return tg(y,i,d)}}function tg(i,d,y){var C=y.length;if(i==null)return!C;for(i=rs(i);C--;){var A=y[C],F=d[A],V=i[A];if(V===n&&!(A in i)||!F(V))return!1}return!0}function sg(i,d,y){if(typeof i!="function")throw new ra(l);return bl(function(){i.apply(n,y)},d)}function fl(i,d,y,C){var A=-1,F=Wc,V=!0,K=i.length,ne=[],pe=d.length;if(!K)return ne;y&&(d=ys(d,Kn(y))),C?(F=im,V=!1):d.length>=r&&(F=ol,V=!1,d=new Oi(d));e:for(;++A<K;){var xe=i[A],ye=y==null?xe:y(xe);if(xe=C||xe!==0?xe:0,V&&ye===ye){for(var _e=pe;_e--;)if(d[_e]===ye)continue e;ne.push(xe)}else F(d,ye,C)||ne.push(xe)}return ne}var Jr=kg(Ja),ng=kg(wm,!0);function dE(i,d){var y=!0;return Jr(i,function(C,A,F){return y=!!d(C,A,F),y}),y}function od(i,d,y){for(var C=-1,A=i.length;++C<A;){var F=i[C],V=d(F);if(V!=null&&(K===n?V===V&&!Xn(V):y(V,K)))var K=V,ne=F}return ne}function uE(i,d,y,C){var A=i.length;for(y=rt(y),y<0&&(y=-y>A?0:A+y),C=C===n||C>A?A:rt(C),C<0&&(C+=A),C=y>C?0:b0(C);y<C;)i[y++]=d;return i}function ag(i,d){var y=[];return Jr(i,function(C,A,F){d(C,A,F)&&y.push(C)}),y}function ln(i,d,y,C,A){var F=-1,V=i.length;for(y||(y=QE),A||(A=[]);++F<V;){var K=i[F];d>0&&y(K)?d>1?ln(K,d-1,y,C,A):qr(A,K):C||(A[A.length]=K)}return A}var jm=Ag(),rg=Ag(!0);function Ja(i,d){return i&&jm(i,d,Qs)}function wm(i,d){return i&&rg(i,d,Qs)}function ld(i,d){return Gr(d,function(y){return Cr(i[y])})}function $i(i,d){d=Zr(d,i);for(var y=0,C=d.length;i!=null&&y<C;)i=i[Za(d[y++])];return y&&y==C?i:n}function ig(i,d,y){var C=d(i);return tt(i)?C:qr(C,y(i))}function Sn(i){return i==null?i===n?Se:pt:Mi&&Mi in rs(i)?qE(i):iT(i)}function Nm(i,d){return i>d}function mE(i,d){return i!=null&&Qt.call(i,d)}function hE(i,d){return i!=null&&d in rs(i)}function fE(i,d,y){return i>=hn(d,y)&&i<qs(d,y)}function Sm(i,d,y){for(var C=y?im:Wc,A=i[0].length,F=i.length,V=F,K=oe(F),ne=1/0,pe=[];V--;){var xe=i[V];V&&d&&(xe=ys(xe,Kn(d))),ne=hn(xe.length,ne),K[V]=!y&&(d||A>=120&&xe.length>=120)?new Oi(V&&xe):n}xe=i[0];var ye=-1,_e=K[0];e:for(;++ye<A&&pe.length<ne;){var He=xe[ye],Je=d?d(He):He;if(He=y||He!==0?He:0,!(_e?ol(_e,Je):C(pe,Je,y))){for(V=F;--V;){var ct=K[V];if(!(ct?ol(ct,Je):C(i[V],Je,y)))continue e}_e&&_e.push(Je),pe.push(He)}}return pe}function pE(i,d,y,C){return Ja(i,function(A,F,V){d(C,y(A),F,V)}),C}function pl(i,d,y){d=Zr(d,i),i=qg(i,d);var C=i==null?i:i[Za(ca(d))];return C==null?n:Yn(C,i,y)}function og(i){return Ts(i)&&Sn(i)==me}function xE(i){return Ts(i)&&Sn(i)==Ve}function gE(i){return Ts(i)&&Sn(i)==je}function xl(i,d,y,C,A){return i===d?!0:i==null||d==null||!Ts(i)&&!Ts(d)?i!==i&&d!==d:vE(i,d,y,C,xl,A)}function vE(i,d,y,C,A,F){var V=tt(i),K=tt(d),ne=V?ue:fn(i),pe=K?ue:fn(d);ne=ne==me?ot:ne,pe=pe==me?ot:pe;var xe=ne==ot,ye=pe==ot,_e=ne==pe;if(_e&&ei(i)){if(!ei(d))return!1;V=!0,xe=!1}if(_e&&!xe)return F||(F=new Ca),V||wo(i)?Fg(i,d,y,C,A,F):VE(i,d,ne,y,C,A,F);if(!(y&b)){var He=xe&&Qt.call(i,"__wrapped__"),Je=ye&&Qt.call(d,"__wrapped__");if(He||Je){var ct=He?i.value():i,Xe=Je?d.value():d;return F||(F=new Ca),A(ct,Xe,y,C,F)}}return _e?(F||(F=new Ca),GE(i,d,y,C,A,F)):!1}function yE(i){return Ts(i)&&fn(i)==ve}function Cm(i,d,y,C){var A=y.length,F=A,V=!C;if(i==null)return!F;for(i=rs(i);A--;){var K=y[A];if(V&&K[2]?K[1]!==i[K[0]]:!(K[0]in i))return!1}for(;++A<F;){K=y[A];var ne=K[0],pe=i[ne],xe=K[1];if(V&&K[2]){if(pe===n&&!(ne in i))return!1}else{var ye=new Ca;if(C)var _e=C(pe,xe,ne,i,d,ye);if(!(_e===n?xl(xe,pe,b|j,C,ye):_e))return!1}}return!0}function lg(i){if(!Ns(i)||tT(i))return!1;var d=Cr(i)?y1:Ge;return d.test(Fi(i))}function bE(i){return Ts(i)&&Sn(i)==G}function jE(i){return Ts(i)&&fn(i)==te}function wE(i){return Ts(i)&&Cd(i.length)&&!!ps[Sn(i)]}function cg(i){return typeof i=="function"?i:i==null?zn:typeof i=="object"?tt(i)?mg(i[0],i[1]):ug(i):R0(i)}function Em(i){if(!yl(i))return C1(i);var d=[];for(var y in rs(i))Qt.call(i,y)&&y!="constructor"&&d.push(y);return d}function NE(i){if(!Ns(i))return rT(i);var d=yl(i),y=[];for(var C in i)C=="constructor"&&(d||!Qt.call(i,C))||y.push(C);return y}function Tm(i,d){return i<d}function dg(i,d){var y=-1,C=Ln(i)?oe(i.length):[];return Jr(i,function(A,F,V){C[++y]=d(A,F,V)}),C}function ug(i){var d=Hm(i);return d.length==1&&d[0][2]?Vg(d[0][0],d[0][1]):function(y){return y===i||Cm(y,i,d)}}function mg(i,d){return Um(i)&&Ug(d)?Vg(Za(i),d):function(y){var C=eh(y,i);return C===n&&C===d?th(y,i):xl(d,C,b|j)}}function cd(i,d,y,C,A){i!==d&&jm(d,function(F,V){if(A||(A=new Ca),Ns(F))SE(i,d,V,y,cd,C,A);else{var K=C?C(Gm(i,V),F,V+"",i,d,A):n;K===n&&(K=F),ym(i,V,K)}},$n)}function SE(i,d,y,C,A,F,V){var K=Gm(i,y),ne=Gm(d,y),pe=V.get(ne);if(pe){ym(i,y,pe);return}var xe=F?F(K,ne,y+"",i,d,V):n,ye=xe===n;if(ye){var _e=tt(ne),He=!_e&&ei(ne),Je=!_e&&!He&&wo(ne);xe=ne,_e||He||Je?tt(K)?xe=K:_s(K)?xe=On(K):He?(ye=!1,xe=Sg(ne,!0)):Je?(ye=!1,xe=Cg(ne,!0)):xe=[]:jl(ne)||Bi(ne)?(xe=K,Bi(K)?xe=j0(K):(!Ns(K)||Cr(K))&&(xe=Wg(ne))):ye=!1}ye&&(V.set(ne,xe),A(xe,ne,C,F,V),V.delete(ne)),ym(i,y,xe)}function hg(i,d){var y=i.length;if(y)return d+=d<0?y:0,Sr(d,y)?i[d]:n}function fg(i,d,y){d.length?d=ys(d,function(F){return tt(F)?function(V){return $i(V,F.length===1?F[0]:F)}:F}):d=[zn];var C=-1;d=ys(d,Kn(Ke()));var A=dg(i,function(F,V,K){var ne=ys(d,function(pe){return pe(F)});return{criteria:ne,index:++C,value:F}});return XC(A,function(F,V){return LE(F,V,y)})}function CE(i,d){return pg(i,d,function(y,C){return th(i,C)})}function pg(i,d,y){for(var C=-1,A=d.length,F={};++C<A;){var V=d[C],K=$i(i,V);y(K,V)&&gl(F,Zr(V,i),K)}return F}function EE(i){return function(d){return $i(d,i)}}function Dm(i,d,y,C){var A=C?JC:uo,F=-1,V=d.length,K=i;for(i===d&&(d=On(d)),y&&(K=ys(i,Kn(y)));++F<V;)for(var ne=0,pe=d[F],xe=y?y(pe):pe;(ne=A(K,xe,ne,C))>-1;)K!==i&&Qc.call(K,ne,1),Qc.call(i,ne,1);return i}function xg(i,d){for(var y=i?d.length:0,C=y-1;y--;){var A=d[y];if(y==C||A!==F){var F=A;Sr(A)?Qc.call(i,A,1):_m(i,A)}}return i}function km(i,d){return i+sd(Jx()*(d-i+1))}function TE(i,d,y,C){for(var A=-1,F=qs(td((d-i)/(y||1)),0),V=oe(F);F--;)V[C?F:++A]=i,i+=y;return V}function Am(i,d){var y="";if(!i||d<1||d>q)return y;do d%2&&(y+=i),d=sd(d/2),d&&(i+=i);while(d);return y}function mt(i,d){return qm(Gg(i,d,zn),i+"")}function DE(i){return Qx(No(i))}function kE(i,d){var y=No(i);return yd(y,Li(d,0,y.length))}function gl(i,d,y,C){if(!Ns(i))return i;d=Zr(d,i);for(var A=-1,F=d.length,V=F-1,K=i;K!=null&&++A<F;){var ne=Za(d[A]),pe=y;if(ne==="__proto__"||ne==="constructor"||ne==="prototype")return i;if(A!=V){var xe=K[ne];pe=C?C(xe,ne,K):n,pe===n&&(pe=Ns(xe)?xe:Sr(d[A+1])?[]:{})}hl(K,ne,pe),K=K[ne]}return i}var gg=nd?function(i,d){return nd.set(i,d),i}:zn,AE=ed?function(i,d){return ed(i,"toString",{configurable:!0,enumerable:!1,value:nh(d),writable:!0})}:zn;function RE(i){return yd(No(i))}function la(i,d,y){var C=-1,A=i.length;d<0&&(d=-d>A?0:A+d),y=y>A?A:y,y<0&&(y+=A),A=d>y?0:y-d>>>0,d>>>=0;for(var F=oe(A);++C<A;)F[C]=i[C+d];return F}function _E(i,d){var y;return Jr(i,function(C,A,F){return y=d(C,A,F),!y}),!!y}function dd(i,d,y){var C=0,A=i==null?C:i.length;if(typeof d=="number"&&d===d&&A<=U){for(;C<A;){var F=C+A>>>1,V=i[F];V!==null&&!Xn(V)&&(y?V<=d:V<d)?C=F+1:A=F}return A}return Rm(i,d,zn,y)}function Rm(i,d,y,C){var A=0,F=i==null?0:i.length;if(F===0)return 0;d=y(d);for(var V=d!==d,K=d===null,ne=Xn(d),pe=d===n;A<F;){var xe=sd((A+F)/2),ye=y(i[xe]),_e=ye!==n,He=ye===null,Je=ye===ye,ct=Xn(ye);if(V)var Xe=C||Je;else pe?Xe=Je&&(C||_e):K?Xe=Je&&_e&&(C||!He):ne?Xe=Je&&_e&&!He&&(C||!ct):He||ct?Xe=!1:Xe=C?ye<=d:ye<d;Xe?A=xe+1:F=xe}return hn(F,ie)}function vg(i,d){for(var y=-1,C=i.length,A=0,F=[];++y<C;){var V=i[y],K=d?d(V):V;if(!y||!Ea(K,ne)){var ne=K;F[A++]=V===0?0:V}}return F}function yg(i){return typeof i=="number"?i:Xn(i)?Y:+i}function Jn(i){if(typeof i=="string")return i;if(tt(i))return ys(i,Jn)+"";if(Xn(i))return Xx?Xx.call(i):"";var d=i+"";return d=="0"&&1/i==-$?"-0":d}function Xr(i,d,y){var C=-1,A=Wc,F=i.length,V=!0,K=[],ne=K;if(y)V=!1,A=im;else if(F>=r){var pe=d?null:WE(i);if(pe)return Vc(pe);V=!1,A=ol,ne=new Oi}else ne=d?[]:K;e:for(;++C<F;){var xe=i[C],ye=d?d(xe):xe;if(xe=y||xe!==0?xe:0,V&&ye===ye){for(var _e=ne.length;_e--;)if(ne[_e]===ye)continue e;d&&ne.push(ye),K.push(xe)}else A(ne,ye,y)||(ne!==K&&ne.push(ye),K.push(xe))}return K}function _m(i,d){return d=Zr(d,i),i=qg(i,d),i==null||delete i[Za(ca(d))]}function bg(i,d,y,C){return gl(i,d,y($i(i,d)),C)}function ud(i,d,y,C){for(var A=i.length,F=C?A:-1;(C?F--:++F<A)&&d(i[F],F,i););return y?la(i,C?0:F,C?F+1:A):la(i,C?F+1:0,C?A:F)}function jg(i,d){var y=i;return y instanceof Dt&&(y=y.value()),om(d,function(C,A){return A.func.apply(A.thisArg,qr([C],A.args))},y)}function Pm(i,d,y){var C=i.length;if(C<2)return C?Xr(i[0]):[];for(var A=-1,F=oe(C);++A<C;)for(var V=i[A],K=-1;++K<C;)K!=A&&(F[A]=fl(F[A]||V,i[K],d,y));return Xr(ln(F,1),d,y)}function wg(i,d,y){for(var C=-1,A=i.length,F=d.length,V={};++C<A;){var K=C<F?d[C]:n;y(V,i[C],K)}return V}function Mm(i){return _s(i)?i:[]}function Im(i){return typeof i=="function"?i:zn}function Zr(i,d){return tt(i)?i:Um(i,d)?[i]:Xg(Kt(i))}var PE=mt;function Qr(i,d,y){var C=i.length;return y=y===n?C:y,!d&&y>=C?i:la(i,d,y)}var Ng=b1||function(i){return on.clearTimeout(i)};function Sg(i,d){if(d)return i.slice();var y=i.length,C=Vx?Vx(y):new i.constructor(y);return i.copy(C),C}function Om(i){var d=new i.constructor(i.byteLength);return new Xc(d).set(new Xc(i)),d}function ME(i,d){var y=d?Om(i.buffer):i.buffer;return new i.constructor(y,i.byteOffset,i.byteLength)}function IE(i){var d=new i.constructor(i.source,rl.exec(i));return d.lastIndex=i.lastIndex,d}function OE(i){return ml?rs(ml.call(i)):{}}function Cg(i,d){var y=d?Om(i.buffer):i.buffer;return new i.constructor(y,i.byteOffset,i.length)}function Eg(i,d){if(i!==d){var y=i!==n,C=i===null,A=i===i,F=Xn(i),V=d!==n,K=d===null,ne=d===d,pe=Xn(d);if(!K&&!pe&&!F&&i>d||F&&V&&ne&&!K&&!pe||C&&V&&ne||!y&&ne||!A)return 1;if(!C&&!F&&!pe&&i<d||pe&&y&&A&&!C&&!F||K&&y&&A||!V&&A||!ne)return-1}return 0}function LE(i,d,y){for(var C=-1,A=i.criteria,F=d.criteria,V=A.length,K=y.length;++C<V;){var ne=Eg(A[C],F[C]);if(ne){if(C>=K)return ne;var pe=y[C];return ne*(pe=="desc"?-1:1)}}return i.index-d.index}function Tg(i,d,y,C){for(var A=-1,F=i.length,V=y.length,K=-1,ne=d.length,pe=qs(F-V,0),xe=oe(ne+pe),ye=!C;++K<ne;)xe[K]=d[K];for(;++A<V;)(ye||A<F)&&(xe[y[A]]=i[A]);for(;pe--;)xe[K++]=i[A++];return xe}function Dg(i,d,y,C){for(var A=-1,F=i.length,V=-1,K=y.length,ne=-1,pe=d.length,xe=qs(F-K,0),ye=oe(xe+pe),_e=!C;++A<xe;)ye[A]=i[A];for(var He=A;++ne<pe;)ye[He+ne]=d[ne];for(;++V<K;)(_e||A<F)&&(ye[He+y[V]]=i[A++]);return ye}function On(i,d){var y=-1,C=i.length;for(d||(d=oe(C));++y<C;)d[y]=i[y];return d}function Xa(i,d,y,C){var A=!y;y||(y={});for(var F=-1,V=d.length;++F<V;){var K=d[F],ne=C?C(y[K],i[K],K,y,i):n;ne===n&&(ne=i[K]),A?jr(y,K,ne):hl(y,K,ne)}return y}function $E(i,d){return Xa(i,Wm(i),d)}function zE(i,d){return Xa(i,Bg(i),d)}function md(i,d){return function(y,C){var A=tt(y)?UC:oE,F=d?d():{};return A(y,i,Ke(C,2),F)}}function yo(i){return mt(function(d,y){var C=-1,A=y.length,F=A>1?y[A-1]:n,V=A>2?y[2]:n;for(F=i.length>3&&typeof F=="function"?(A--,F):n,V&&Cn(y[0],y[1],V)&&(F=A<3?n:F,A=1),d=rs(d);++C<A;){var K=y[C];K&&i(d,K,C,F)}return d})}function kg(i,d){return function(y,C){if(y==null)return y;if(!Ln(y))return i(y,C);for(var A=y.length,F=d?A:-1,V=rs(y);(d?F--:++F<A)&&C(V[F],F,V)!==!1;);return y}}function Ag(i){return function(d,y,C){for(var A=-1,F=rs(d),V=C(d),K=V.length;K--;){var ne=V[i?K:++A];if(y(F[ne],ne,F)===!1)break}return d}}function FE(i,d,y){var C=d&v,A=vl(i);function F(){var V=this&&this!==on&&this instanceof F?A:i;return V.apply(C?y:this,arguments)}return F}function Rg(i){return function(d){d=Kt(d);var y=mo(d)?Sa(d):n,C=y?y[0]:d.charAt(0),A=y?Qr(y,1).join(""):d.slice(1);return C[i]()+A}}function bo(i){return function(d){return om(k0(D0(d).replace(AC,"")),i,"")}}function vl(i){return function(){var d=arguments;switch(d.length){case 0:return new i;case 1:return new i(d[0]);case 2:return new i(d[0],d[1]);case 3:return new i(d[0],d[1],d[2]);case 4:return new i(d[0],d[1],d[2],d[3]);case 5:return new i(d[0],d[1],d[2],d[3],d[4]);case 6:return new i(d[0],d[1],d[2],d[3],d[4],d[5]);case 7:return new i(d[0],d[1],d[2],d[3],d[4],d[5],d[6])}var y=vo(i.prototype),C=i.apply(y,d);return Ns(C)?C:y}}function BE(i,d,y){var C=vl(i);function A(){for(var F=arguments.length,V=oe(F),K=F,ne=jo(A);K--;)V[K]=arguments[K];var pe=F<3&&V[0]!==ne&&V[F-1]!==ne?[]:Yr(V,ne);if(F-=pe.length,F<y)return Og(i,d,hd,A.placeholder,n,V,pe,n,n,y-F);var xe=this&&this!==on&&this instanceof A?C:i;return Yn(xe,this,V)}return A}function _g(i){return function(d,y,C){var A=rs(d);if(!Ln(d)){var F=Ke(y,3);d=Qs(d),y=function(K){return F(A[K],K,A)}}var V=i(d,y,C);return V>-1?A[F?d[V]:V]:n}}function Pg(i){return Nr(function(d){var y=d.length,C=y,A=ia.prototype.thru;for(i&&d.reverse();C--;){var F=d[C];if(typeof F!="function")throw new ra(l);if(A&&!V&&gd(F)=="wrapper")var V=new ia([],!0)}for(C=V?C:y;++C<y;){F=d[C];var K=gd(F),ne=K=="wrapper"?Bm(F):n;ne&&Vm(ne[0])&&ne[1]==(D|S|T|P)&&!ne[4].length&&ne[9]==1?V=V[gd(ne[0])].apply(V,ne[3]):V=F.length==1&&Vm(F)?V[K]():V.thru(F)}return function(){var pe=arguments,xe=pe[0];if(V&&pe.length==1&&tt(xe))return V.plant(xe).value();for(var ye=0,_e=y?d[ye].apply(this,pe):xe;++ye<y;)_e=d[ye].call(this,_e);return _e}})}function hd(i,d,y,C,A,F,V,K,ne,pe){var xe=d&D,ye=d&v,_e=d&w,He=d&(S|E),Je=d&_,ct=_e?n:vl(i);function Xe(){for(var bt=arguments.length,Ot=oe(bt),Zn=bt;Zn--;)Ot[Zn]=arguments[Zn];if(He)var En=jo(Xe),Qn=QC(Ot,En);if(C&&(Ot=Tg(Ot,C,A,He)),F&&(Ot=Dg(Ot,F,V,He)),bt-=Qn,He&&bt<pe){var Ps=Yr(Ot,En);return Og(i,d,hd,Xe.placeholder,y,Ot,Ps,K,ne,pe-bt)}var Ta=ye?y:this,Tr=_e?Ta[i]:i;return bt=Ot.length,K?Ot=oT(Ot,K):Je&&bt>1&&Ot.reverse(),xe&&ne<bt&&(Ot.length=ne),this&&this!==on&&this instanceof Xe&&(Tr=ct||vl(Tr)),Tr.apply(Ta,Ot)}return Xe}function Mg(i,d){return function(y,C){return pE(y,i,d(C),{})}}function fd(i,d){return function(y,C){var A;if(y===n&&C===n)return d;if(y!==n&&(A=y),C!==n){if(A===n)return C;typeof y=="string"||typeof C=="string"?(y=Jn(y),C=Jn(C)):(y=yg(y),C=yg(C)),A=i(y,C)}return A}}function Lm(i){return Nr(function(d){return d=ys(d,Kn(Ke())),mt(function(y){var C=this;return i(d,function(A){return Yn(A,C,y)})})})}function pd(i,d){d=d===n?" ":Jn(d);var y=d.length;if(y<2)return y?Am(d,i):d;var C=Am(d,td(i/ho(d)));return mo(d)?Qr(Sa(C),0,i).join(""):C.slice(0,i)}function HE(i,d,y,C){var A=d&v,F=vl(i);function V(){for(var K=-1,ne=arguments.length,pe=-1,xe=C.length,ye=oe(xe+ne),_e=this&&this!==on&&this instanceof V?F:i;++pe<xe;)ye[pe]=C[pe];for(;ne--;)ye[pe++]=arguments[++K];return Yn(_e,A?y:this,ye)}return V}function Ig(i){return function(d,y,C){return C&&typeof C!="number"&&Cn(d,y,C)&&(y=C=n),d=Er(d),y===n?(y=d,d=0):y=Er(y),C=C===n?d<y?1:-1:Er(C),TE(d,y,C,i)}}function xd(i){return function(d,y){return typeof d=="string"&&typeof y=="string"||(d=da(d),y=da(y)),i(d,y)}}function Og(i,d,y,C,A,F,V,K,ne,pe){var xe=d&S,ye=xe?V:n,_e=xe?n:V,He=xe?F:n,Je=xe?n:F;d|=xe?T:k,d&=~(xe?k:T),d&N||(d&=-4);var ct=[i,d,A,He,ye,Je,_e,K,ne,pe],Xe=y.apply(n,ct);return Vm(i)&&Yg(Xe,ct),Xe.placeholder=C,Kg(Xe,i,d)}function $m(i){var d=Gs[i];return function(y,C){if(y=da(y),C=C==null?0:hn(rt(C),292),C&&Kx(y)){var A=(Kt(y)+"e").split("e"),F=d(A[0]+"e"+(+A[1]+C));return A=(Kt(F)+"e").split("e"),+(A[0]+"e"+(+A[1]-C))}return d(y)}}var WE=xo&&1/Vc(new xo([,-0]))[1]==$?function(i){return new xo(i)}:ih;function Lg(i){return function(d){var y=fn(d);return y==ve?fm(d):y==te?i1(d):ZC(d,i(d))}}function wr(i,d,y,C,A,F,V,K){var ne=d&w;if(!ne&&typeof i!="function")throw new ra(l);var pe=C?C.length:0;if(pe||(d&=-97,C=A=n),V=V===n?V:qs(rt(V),0),K=K===n?K:rt(K),pe-=A?A.length:0,d&k){var xe=C,ye=A;C=A=n}var _e=ne?n:Bm(i),He=[i,d,y,C,A,xe,ye,F,V,K];if(_e&&aT(He,_e),i=He[0],d=He[1],y=He[2],C=He[3],A=He[4],K=He[9]=He[9]===n?ne?0:i.length:qs(He[9]-pe,0),!K&&d&(S|E)&&(d&=-25),!d||d==v)var Je=FE(i,d,y);else d==S||d==E?Je=BE(i,d,K):(d==T||d==(v|T))&&!A.length?Je=HE(i,d,y,C):Je=hd.apply(n,He);var ct=_e?gg:Yg;return Kg(ct(Je,He),i,d)}function $g(i,d,y,C){return i===n||Ea(i,po[y])&&!Qt.call(C,y)?d:i}function zg(i,d,y,C,A,F){return Ns(i)&&Ns(d)&&(F.set(d,i),cd(i,d,n,zg,F),F.delete(d)),i}function UE(i){return jl(i)?n:i}function Fg(i,d,y,C,A,F){var V=y&b,K=i.length,ne=d.length;if(K!=ne&&!(V&&ne>K))return!1;var pe=F.get(i),xe=F.get(d);if(pe&&xe)return pe==d&&xe==i;var ye=-1,_e=!0,He=y&j?new Oi:n;for(F.set(i,d),F.set(d,i);++ye<K;){var Je=i[ye],ct=d[ye];if(C)var Xe=V?C(ct,Je,ye,d,i,F):C(Je,ct,ye,i,d,F);if(Xe!==n){if(Xe)continue;_e=!1;break}if(He){if(!lm(d,function(bt,Ot){if(!ol(He,Ot)&&(Je===bt||A(Je,bt,y,C,F)))return He.push(Ot)})){_e=!1;break}}else if(!(Je===ct||A(Je,ct,y,C,F))){_e=!1;break}}return F.delete(i),F.delete(d),_e}function VE(i,d,y,C,A,F,V){switch(y){case Qe:if(i.byteLength!=d.byteLength||i.byteOffset!=d.byteOffset)return!1;i=i.buffer,d=d.buffer;case Ve:return!(i.byteLength!=d.byteLength||!F(new Xc(i),new Xc(d)));case ge:case je:case ft:return Ea(+i,+d);case ke:return i.name==d.name&&i.message==d.message;case G:case le:return i==d+"";case ve:var K=fm;case te:var ne=C&b;if(K||(K=Vc),i.size!=d.size&&!ne)return!1;var pe=V.get(i);if(pe)return pe==d;C|=j,V.set(i,d);var xe=Fg(K(i),K(d),C,A,F,V);return V.delete(i),xe;case Ce:if(ml)return ml.call(i)==ml.call(d)}return!1}function GE(i,d,y,C,A,F){var V=y&b,K=zm(i),ne=K.length,pe=zm(d),xe=pe.length;if(ne!=xe&&!V)return!1;for(var ye=ne;ye--;){var _e=K[ye];if(!(V?_e in d:Qt.call(d,_e)))return!1}var He=F.get(i),Je=F.get(d);if(He&&Je)return He==d&&Je==i;var ct=!0;F.set(i,d),F.set(d,i);for(var Xe=V;++ye<ne;){_e=K[ye];var bt=i[_e],Ot=d[_e];if(C)var Zn=V?C(Ot,bt,_e,d,i,F):C(bt,Ot,_e,i,d,F);if(!(Zn===n?bt===Ot||A(bt,Ot,y,C,F):Zn)){ct=!1;break}Xe||(Xe=_e=="constructor")}if(ct&&!Xe){var En=i.constructor,Qn=d.constructor;En!=Qn&&"constructor"in i&&"constructor"in d&&!(typeof En=="function"&&En instanceof En&&typeof Qn=="function"&&Qn instanceof Qn)&&(ct=!1)}return F.delete(i),F.delete(d),ct}function Nr(i){return qm(Gg(i,n,t0),i+"")}function zm(i){return ig(i,Qs,Wm)}function Fm(i){return ig(i,$n,Bg)}var Bm=nd?function(i){return nd.get(i)}:ih;function gd(i){for(var d=i.name+"",y=go[d],C=Qt.call(go,d)?y.length:0;C--;){var A=y[C],F=A.func;if(F==null||F==i)return A.name}return d}function jo(i){var d=Qt.call(O,"placeholder")?O:i;return d.placeholder}function Ke(){var i=O.iteratee||ah;return i=i===ah?cg:i,arguments.length?i(arguments[0],arguments[1]):i}function vd(i,d){var y=i.__data__;return eT(d)?y[typeof d=="string"?"string":"hash"]:y.map}function Hm(i){for(var d=Qs(i),y=d.length;y--;){var C=d[y],A=i[C];d[y]=[C,A,Ug(A)]}return d}function zi(i,d){var y=n1(i,d);return lg(y)?y:n}function qE(i){var d=Qt.call(i,Mi),y=i[Mi];try{i[Mi]=n;var C=!0}catch{}var A=Kc.call(i);return C&&(d?i[Mi]=y:delete i[Mi]),A}var Wm=xm?function(i){return i==null?[]:(i=rs(i),Gr(xm(i),function(d){return qx.call(i,d)}))}:oh,Bg=xm?function(i){for(var d=[];i;)qr(d,Wm(i)),i=Zc(i);return d}:oh,fn=Sn;(gm&&fn(new gm(new ArrayBuffer(1)))!=Qe||cl&&fn(new cl)!=ve||vm&&fn(vm.resolve())!=zs||xo&&fn(new xo)!=te||dl&&fn(new dl)!=be)&&(fn=function(i){var d=Sn(i),y=d==ot?i.constructor:n,C=y?Fi(y):"";if(C)switch(C){case k1:return Qe;case A1:return ve;case R1:return zs;case _1:return te;case P1:return be}return d});function YE(i,d,y){for(var C=-1,A=y.length;++C<A;){var F=y[C],V=F.size;switch(F.type){case"drop":i+=V;break;case"dropRight":d-=V;break;case"take":d=hn(d,i+V);break;case"takeRight":i=qs(i,d-V);break}}return{start:i,end:d}}function KE(i){var d=i.match(qn);return d?d[1].split(ja):[]}function Hg(i,d,y){d=Zr(d,i);for(var C=-1,A=d.length,F=!1;++C<A;){var V=Za(d[C]);if(!(F=i!=null&&y(i,V)))break;i=i[V]}return F||++C!=A?F:(A=i==null?0:i.length,!!A&&Cd(A)&&Sr(V,A)&&(tt(i)||Bi(i)))}function JE(i){var d=i.length,y=new i.constructor(d);return d&&typeof i[0]=="string"&&Qt.call(i,"index")&&(y.index=i.index,y.input=i.input),y}function Wg(i){return typeof i.constructor=="function"&&!yl(i)?vo(Zc(i)):{}}function XE(i,d,y){var C=i.constructor;switch(d){case Ve:return Om(i);case ge:case je:return new C(+i);case Qe:return ME(i,y);case Yt:case Cs:case Ut:case Us:case Fs:case ss:case Rs:case Es:case Nn:return Cg(i,y);case ve:return new C;case ft:case le:return new C(i);case G:return IE(i);case te:return new C;case Ce:return OE(i)}}function ZE(i,d){var y=d.length;if(!y)return i;var C=y-1;return d[C]=(y>1?"& ":"")+d[C],d=d.join(y>2?", ":" "),i.replace(Ka,`{
/* [wrapped with `+d+`] */
`)}function QE(i){return tt(i)||Bi(i)||!!(Yx&&i&&i[Yx])}function Sr(i,d){var y=typeof i;return d=d??q,!!d&&(y=="number"||y!="symbol"&&Ee.test(i))&&i>-1&&i%1==0&&i<d}function Cn(i,d,y){if(!Ns(y))return!1;var C=typeof d;return(C=="number"?Ln(y)&&Sr(d,y.length):C=="string"&&d in y)?Ea(y[d],i):!1}function Um(i,d){if(tt(i))return!1;var y=typeof i;return y=="number"||y=="symbol"||y=="boolean"||i==null||Xn(i)?!0:It.test(i)||!Et.test(i)||d!=null&&i in rs(d)}function eT(i){var d=typeof i;return d=="string"||d=="number"||d=="symbol"||d=="boolean"?i!=="__proto__":i===null}function Vm(i){var d=gd(i),y=O[d];if(typeof y!="function"||!(d in Dt.prototype))return!1;if(i===y)return!0;var C=Bm(y);return!!C&&i===C[0]}function tT(i){return!!Ux&&Ux in i}var sT=qc?Cr:lh;function yl(i){var d=i&&i.constructor,y=typeof d=="function"&&d.prototype||po;return i===y}function Ug(i){return i===i&&!Ns(i)}function Vg(i,d){return function(y){return y==null?!1:y[i]===d&&(d!==n||i in rs(y))}}function nT(i){var d=Nd(i,function(C){return y.size===u&&y.clear(),C}),y=d.cache;return d}function aT(i,d){var y=i[1],C=d[1],A=y|C,F=A<(v|w|D),V=C==D&&y==S||C==D&&y==P&&i[7].length<=d[8]||C==(D|P)&&d[7].length<=d[8]&&y==S;if(!(F||V))return i;C&v&&(i[2]=d[2],A|=y&v?0:N);var K=d[3];if(K){var ne=i[3];i[3]=ne?Tg(ne,K,d[4]):K,i[4]=ne?Yr(i[3],h):d[4]}return K=d[5],K&&(ne=i[5],i[5]=ne?Dg(ne,K,d[6]):K,i[6]=ne?Yr(i[5],h):d[6]),K=d[7],K&&(i[7]=K),C&D&&(i[8]=i[8]==null?d[8]:hn(i[8],d[8])),i[9]==null&&(i[9]=d[9]),i[0]=d[0],i[1]=A,i}function rT(i){var d=[];if(i!=null)for(var y in rs(i))d.push(y);return d}function iT(i){return Kc.call(i)}function Gg(i,d,y){return d=qs(d===n?i.length-1:d,0),function(){for(var C=arguments,A=-1,F=qs(C.length-d,0),V=oe(F);++A<F;)V[A]=C[d+A];A=-1;for(var K=oe(d+1);++A<d;)K[A]=C[A];return K[d]=y(V),Yn(i,this,K)}}function qg(i,d){return d.length<2?i:$i(i,la(d,0,-1))}function oT(i,d){for(var y=i.length,C=hn(d.length,y),A=On(i);C--;){var F=d[C];i[C]=Sr(F,y)?A[F]:n}return i}function Gm(i,d){if(!(d==="constructor"&&typeof i[d]=="function")&&d!="__proto__")return i[d]}var Yg=Jg(gg),bl=w1||function(i,d){return on.setTimeout(i,d)},qm=Jg(AE);function Kg(i,d,y){var C=d+"";return qm(i,ZE(C,lT(KE(C),y)))}function Jg(i){var d=0,y=0;return function(){var C=E1(),A=M-(C-y);if(y=C,A>0){if(++d>=R)return arguments[0]}else d=0;return i.apply(n,arguments)}}function yd(i,d){var y=-1,C=i.length,A=C-1;for(d=d===n?C:d;++y<d;){var F=km(y,A),V=i[F];i[F]=i[y],i[y]=V}return i.length=d,i}var Xg=nT(function(i){var d=[];return i.charCodeAt(0)===46&&d.push(""),i.replace(Tt,function(y,C,A,F){d.push(A?F.replace($c,"$1"):C||y)}),d});function Za(i){if(typeof i=="string"||Xn(i))return i;var d=i+"";return d=="0"&&1/i==-$?"-0":d}function Fi(i){if(i!=null){try{return Yc.call(i)}catch{}try{return i+""}catch{}}return""}function lT(i,d){return aa(ee,function(y){var C="_."+y[0];d&y[1]&&!Wc(i,C)&&i.push(C)}),i.sort()}function Zg(i){if(i instanceof Dt)return i.clone();var d=new ia(i.__wrapped__,i.__chain__);return d.__actions__=On(i.__actions__),d.__index__=i.__index__,d.__values__=i.__values__,d}function cT(i,d,y){(y?Cn(i,d,y):d===n)?d=1:d=qs(rt(d),0);var C=i==null?0:i.length;if(!C||d<1)return[];for(var A=0,F=0,V=oe(td(C/d));A<C;)V[F++]=la(i,A,A+=d);return V}function dT(i){for(var d=-1,y=i==null?0:i.length,C=0,A=[];++d<y;){var F=i[d];F&&(A[C++]=F)}return A}function uT(){var i=arguments.length;if(!i)return[];for(var d=oe(i-1),y=arguments[0],C=i;C--;)d[C-1]=arguments[C];return qr(tt(y)?On(y):[y],ln(d,1))}var mT=mt(function(i,d){return _s(i)?fl(i,ln(d,1,_s,!0)):[]}),hT=mt(function(i,d){var y=ca(d);return _s(y)&&(y=n),_s(i)?fl(i,ln(d,1,_s,!0),Ke(y,2)):[]}),fT=mt(function(i,d){var y=ca(d);return _s(y)&&(y=n),_s(i)?fl(i,ln(d,1,_s,!0),n,y):[]});function pT(i,d,y){var C=i==null?0:i.length;return C?(d=y||d===n?1:rt(d),la(i,d<0?0:d,C)):[]}function xT(i,d,y){var C=i==null?0:i.length;return C?(d=y||d===n?1:rt(d),d=C-d,la(i,0,d<0?0:d)):[]}function gT(i,d){return i&&i.length?ud(i,Ke(d,3),!0,!0):[]}function vT(i,d){return i&&i.length?ud(i,Ke(d,3),!0):[]}function yT(i,d,y,C){var A=i==null?0:i.length;return A?(y&&typeof y!="number"&&Cn(i,d,y)&&(y=0,C=A),uE(i,d,y,C)):[]}function Qg(i,d,y){var C=i==null?0:i.length;if(!C)return-1;var A=y==null?0:rt(y);return A<0&&(A=qs(C+A,0)),Uc(i,Ke(d,3),A)}function e0(i,d,y){var C=i==null?0:i.length;if(!C)return-1;var A=C-1;return y!==n&&(A=rt(y),A=y<0?qs(C+A,0):hn(A,C-1)),Uc(i,Ke(d,3),A,!0)}function t0(i){var d=i==null?0:i.length;return d?ln(i,1):[]}function bT(i){var d=i==null?0:i.length;return d?ln(i,$):[]}function jT(i,d){var y=i==null?0:i.length;return y?(d=d===n?1:rt(d),ln(i,d)):[]}function wT(i){for(var d=-1,y=i==null?0:i.length,C={};++d<y;){var A=i[d];C[A[0]]=A[1]}return C}function s0(i){return i&&i.length?i[0]:n}function NT(i,d,y){var C=i==null?0:i.length;if(!C)return-1;var A=y==null?0:rt(y);return A<0&&(A=qs(C+A,0)),uo(i,d,A)}function ST(i){var d=i==null?0:i.length;return d?la(i,0,-1):[]}var CT=mt(function(i){var d=ys(i,Mm);return d.length&&d[0]===i[0]?Sm(d):[]}),ET=mt(function(i){var d=ca(i),y=ys(i,Mm);return d===ca(y)?d=n:y.pop(),y.length&&y[0]===i[0]?Sm(y,Ke(d,2)):[]}),TT=mt(function(i){var d=ca(i),y=ys(i,Mm);return d=typeof d=="function"?d:n,d&&y.pop(),y.length&&y[0]===i[0]?Sm(y,n,d):[]});function DT(i,d){return i==null?"":S1.call(i,d)}function ca(i){var d=i==null?0:i.length;return d?i[d-1]:n}function kT(i,d,y){var C=i==null?0:i.length;if(!C)return-1;var A=C;return y!==n&&(A=rt(y),A=A<0?qs(C+A,0):hn(A,C-1)),d===d?l1(i,d,A):Uc(i,Ox,A,!0)}function AT(i,d){return i&&i.length?hg(i,rt(d)):n}var RT=mt(n0);function n0(i,d){return i&&i.length&&d&&d.length?Dm(i,d):i}function _T(i,d,y){return i&&i.length&&d&&d.length?Dm(i,d,Ke(y,2)):i}function PT(i,d,y){return i&&i.length&&d&&d.length?Dm(i,d,n,y):i}var MT=Nr(function(i,d){var y=i==null?0:i.length,C=bm(i,d);return xg(i,ys(d,function(A){return Sr(A,y)?+A:A}).sort(Eg)),C});function IT(i,d){var y=[];if(!(i&&i.length))return y;var C=-1,A=[],F=i.length;for(d=Ke(d,3);++C<F;){var V=i[C];d(V,C,i)&&(y.push(V),A.push(C))}return xg(i,A),y}function Ym(i){return i==null?i:D1.call(i)}function OT(i,d,y){var C=i==null?0:i.length;return C?(y&&typeof y!="number"&&Cn(i,d,y)?(d=0,y=C):(d=d==null?0:rt(d),y=y===n?C:rt(y)),la(i,d,y)):[]}function LT(i,d){return dd(i,d)}function $T(i,d,y){return Rm(i,d,Ke(y,2))}function zT(i,d){var y=i==null?0:i.length;if(y){var C=dd(i,d);if(C<y&&Ea(i[C],d))return C}return-1}function FT(i,d){return dd(i,d,!0)}function BT(i,d,y){return Rm(i,d,Ke(y,2),!0)}function HT(i,d){var y=i==null?0:i.length;if(y){var C=dd(i,d,!0)-1;if(Ea(i[C],d))return C}return-1}function WT(i){return i&&i.length?vg(i):[]}function UT(i,d){return i&&i.length?vg(i,Ke(d,2)):[]}function VT(i){var d=i==null?0:i.length;return d?la(i,1,d):[]}function GT(i,d,y){return i&&i.length?(d=y||d===n?1:rt(d),la(i,0,d<0?0:d)):[]}function qT(i,d,y){var C=i==null?0:i.length;return C?(d=y||d===n?1:rt(d),d=C-d,la(i,d<0?0:d,C)):[]}function YT(i,d){return i&&i.length?ud(i,Ke(d,3),!1,!0):[]}function KT(i,d){return i&&i.length?ud(i,Ke(d,3)):[]}var JT=mt(function(i){return Xr(ln(i,1,_s,!0))}),XT=mt(function(i){var d=ca(i);return _s(d)&&(d=n),Xr(ln(i,1,_s,!0),Ke(d,2))}),ZT=mt(function(i){var d=ca(i);return d=typeof d=="function"?d:n,Xr(ln(i,1,_s,!0),n,d)});function QT(i){return i&&i.length?Xr(i):[]}function eD(i,d){return i&&i.length?Xr(i,Ke(d,2)):[]}function tD(i,d){return d=typeof d=="function"?d:n,i&&i.length?Xr(i,n,d):[]}function Km(i){if(!(i&&i.length))return[];var d=0;return i=Gr(i,function(y){if(_s(y))return d=qs(y.length,d),!0}),mm(d,function(y){return ys(i,cm(y))})}function a0(i,d){if(!(i&&i.length))return[];var y=Km(i);return d==null?y:ys(y,function(C){return Yn(d,n,C)})}var sD=mt(function(i,d){return _s(i)?fl(i,d):[]}),nD=mt(function(i){return Pm(Gr(i,_s))}),aD=mt(function(i){var d=ca(i);return _s(d)&&(d=n),Pm(Gr(i,_s),Ke(d,2))}),rD=mt(function(i){var d=ca(i);return d=typeof d=="function"?d:n,Pm(Gr(i,_s),n,d)}),iD=mt(Km);function oD(i,d){return wg(i||[],d||[],hl)}function lD(i,d){return wg(i||[],d||[],gl)}var cD=mt(function(i){var d=i.length,y=d>1?i[d-1]:n;return y=typeof y=="function"?(i.pop(),y):n,a0(i,y)});function r0(i){var d=O(i);return d.__chain__=!0,d}function dD(i,d){return d(i),i}function bd(i,d){return d(i)}var uD=Nr(function(i){var d=i.length,y=d?i[0]:0,C=this.__wrapped__,A=function(F){return bm(F,i)};return d>1||this.__actions__.length||!(C instanceof Dt)||!Sr(y)?this.thru(A):(C=C.slice(y,+y+(d?1:0)),C.__actions__.push({func:bd,args:[A],thisArg:n}),new ia(C,this.__chain__).thru(function(F){return d&&!F.length&&F.push(n),F}))});function mD(){return r0(this)}function hD(){return new ia(this.value(),this.__chain__)}function fD(){this.__values__===n&&(this.__values__=y0(this.value()));var i=this.__index__>=this.__values__.length,d=i?n:this.__values__[this.__index__++];return{done:i,value:d}}function pD(){return this}function xD(i){for(var d,y=this;y instanceof rd;){var C=Zg(y);C.__index__=0,C.__values__=n,d?A.__wrapped__=C:d=C;var A=C;y=y.__wrapped__}return A.__wrapped__=i,d}function gD(){var i=this.__wrapped__;if(i instanceof Dt){var d=i;return this.__actions__.length&&(d=new Dt(this)),d=d.reverse(),d.__actions__.push({func:bd,args:[Ym],thisArg:n}),new ia(d,this.__chain__)}return this.thru(Ym)}function vD(){return jg(this.__wrapped__,this.__actions__)}var yD=md(function(i,d,y){Qt.call(i,y)?++i[y]:jr(i,y,1)});function bD(i,d,y){var C=tt(i)?Mx:dE;return y&&Cn(i,d,y)&&(d=n),C(i,Ke(d,3))}function jD(i,d){var y=tt(i)?Gr:ag;return y(i,Ke(d,3))}var wD=_g(Qg),ND=_g(e0);function SD(i,d){return ln(jd(i,d),1)}function CD(i,d){return ln(jd(i,d),$)}function ED(i,d,y){return y=y===n?1:rt(y),ln(jd(i,d),y)}function i0(i,d){var y=tt(i)?aa:Jr;return y(i,Ke(d,3))}function o0(i,d){var y=tt(i)?VC:ng;return y(i,Ke(d,3))}var TD=md(function(i,d,y){Qt.call(i,y)?i[y].push(d):jr(i,y,[d])});function DD(i,d,y,C){i=Ln(i)?i:No(i),y=y&&!C?rt(y):0;var A=i.length;return y<0&&(y=qs(A+y,0)),Ed(i)?y<=A&&i.indexOf(d,y)>-1:!!A&&uo(i,d,y)>-1}var kD=mt(function(i,d,y){var C=-1,A=typeof d=="function",F=Ln(i)?oe(i.length):[];return Jr(i,function(V){F[++C]=A?Yn(d,V,y):pl(V,d,y)}),F}),AD=md(function(i,d,y){jr(i,y,d)});function jd(i,d){var y=tt(i)?ys:dg;return y(i,Ke(d,3))}function RD(i,d,y,C){return i==null?[]:(tt(d)||(d=d==null?[]:[d]),y=C?n:y,tt(y)||(y=y==null?[]:[y]),fg(i,d,y))}var _D=md(function(i,d,y){i[y?0:1].push(d)},function(){return[[],[]]});function PD(i,d,y){var C=tt(i)?om:$x,A=arguments.length<3;return C(i,Ke(d,4),y,A,Jr)}function MD(i,d,y){var C=tt(i)?GC:$x,A=arguments.length<3;return C(i,Ke(d,4),y,A,ng)}function ID(i,d){var y=tt(i)?Gr:ag;return y(i,Sd(Ke(d,3)))}function OD(i){var d=tt(i)?Qx:DE;return d(i)}function LD(i,d,y){(y?Cn(i,d,y):d===n)?d=1:d=rt(d);var C=tt(i)?rE:kE;return C(i,d)}function $D(i){var d=tt(i)?iE:RE;return d(i)}function zD(i){if(i==null)return 0;if(Ln(i))return Ed(i)?ho(i):i.length;var d=fn(i);return d==ve||d==te?i.size:Em(i).length}function FD(i,d,y){var C=tt(i)?lm:_E;return y&&Cn(i,d,y)&&(d=n),C(i,Ke(d,3))}var BD=mt(function(i,d){if(i==null)return[];var y=d.length;return y>1&&Cn(i,d[0],d[1])?d=[]:y>2&&Cn(d[0],d[1],d[2])&&(d=[d[0]]),fg(i,ln(d,1),[])}),wd=j1||function(){return on.Date.now()};function HD(i,d){if(typeof d!="function")throw new ra(l);return i=rt(i),function(){if(--i<1)return d.apply(this,arguments)}}function l0(i,d,y){return d=y?n:d,d=i&&d==null?i.length:d,wr(i,D,n,n,n,n,d)}function c0(i,d){var y;if(typeof d!="function")throw new ra(l);return i=rt(i),function(){return--i>0&&(y=d.apply(this,arguments)),i<=1&&(d=n),y}}var Jm=mt(function(i,d,y){var C=v;if(y.length){var A=Yr(y,jo(Jm));C|=T}return wr(i,C,d,y,A)}),d0=mt(function(i,d,y){var C=v|w;if(y.length){var A=Yr(y,jo(d0));C|=T}return wr(d,C,i,y,A)});function u0(i,d,y){d=y?n:d;var C=wr(i,S,n,n,n,n,n,d);return C.placeholder=u0.placeholder,C}function m0(i,d,y){d=y?n:d;var C=wr(i,E,n,n,n,n,n,d);return C.placeholder=m0.placeholder,C}function h0(i,d,y){var C,A,F,V,K,ne,pe=0,xe=!1,ye=!1,_e=!0;if(typeof i!="function")throw new ra(l);d=da(d)||0,Ns(y)&&(xe=!!y.leading,ye="maxWait"in y,F=ye?qs(da(y.maxWait)||0,d):F,_e="trailing"in y?!!y.trailing:_e);function He(Ps){var Ta=C,Tr=A;return C=A=n,pe=Ps,V=i.apply(Tr,Ta),V}function Je(Ps){return pe=Ps,K=bl(bt,d),xe?He(Ps):V}function ct(Ps){var Ta=Ps-ne,Tr=Ps-pe,_0=d-Ta;return ye?hn(_0,F-Tr):_0}function Xe(Ps){var Ta=Ps-ne,Tr=Ps-pe;return ne===n||Ta>=d||Ta<0||ye&&Tr>=F}function bt(){var Ps=wd();if(Xe(Ps))return Ot(Ps);K=bl(bt,ct(Ps))}function Ot(Ps){return K=n,_e&&C?He(Ps):(C=A=n,V)}function Zn(){K!==n&&Ng(K),pe=0,C=ne=A=K=n}function En(){return K===n?V:Ot(wd())}function Qn(){var Ps=wd(),Ta=Xe(Ps);if(C=arguments,A=this,ne=Ps,Ta){if(K===n)return Je(ne);if(ye)return Ng(K),K=bl(bt,d),He(ne)}return K===n&&(K=bl(bt,d)),V}return Qn.cancel=Zn,Qn.flush=En,Qn}var WD=mt(function(i,d){return sg(i,1,d)}),UD=mt(function(i,d,y){return sg(i,da(d)||0,y)});function VD(i){return wr(i,_)}function Nd(i,d){if(typeof i!="function"||d!=null&&typeof d!="function")throw new ra(l);var y=function(){var C=arguments,A=d?d.apply(this,C):C[0],F=y.cache;if(F.has(A))return F.get(A);var V=i.apply(this,C);return y.cache=F.set(A,V)||F,V};return y.cache=new(Nd.Cache||br),y}Nd.Cache=br;function Sd(i){if(typeof i!="function")throw new ra(l);return function(){var d=arguments;switch(d.length){case 0:return!i.call(this);case 1:return!i.call(this,d[0]);case 2:return!i.call(this,d[0],d[1]);case 3:return!i.call(this,d[0],d[1],d[2])}return!i.apply(this,d)}}function GD(i){return c0(2,i)}var qD=PE(function(i,d){d=d.length==1&&tt(d[0])?ys(d[0],Kn(Ke())):ys(ln(d,1),Kn(Ke()));var y=d.length;return mt(function(C){for(var A=-1,F=hn(C.length,y);++A<F;)C[A]=d[A].call(this,C[A]);return Yn(i,this,C)})}),Xm=mt(function(i,d){var y=Yr(d,jo(Xm));return wr(i,T,n,d,y)}),f0=mt(function(i,d){var y=Yr(d,jo(f0));return wr(i,k,n,d,y)}),YD=Nr(function(i,d){return wr(i,P,n,n,n,d)});function KD(i,d){if(typeof i!="function")throw new ra(l);return d=d===n?d:rt(d),mt(i,d)}function JD(i,d){if(typeof i!="function")throw new ra(l);return d=d==null?0:qs(rt(d),0),mt(function(y){var C=y[d],A=Qr(y,0,d);return C&&qr(A,C),Yn(i,this,A)})}function XD(i,d,y){var C=!0,A=!0;if(typeof i!="function")throw new ra(l);return Ns(y)&&(C="leading"in y?!!y.leading:C,A="trailing"in y?!!y.trailing:A),h0(i,d,{leading:C,maxWait:d,trailing:A})}function ZD(i){return l0(i,1)}function QD(i,d){return Xm(Im(d),i)}function ek(){if(!arguments.length)return[];var i=arguments[0];return tt(i)?i:[i]}function tk(i){return oa(i,x)}function sk(i,d){return d=typeof d=="function"?d:n,oa(i,x,d)}function nk(i){return oa(i,p|x)}function ak(i,d){return d=typeof d=="function"?d:n,oa(i,p|x,d)}function rk(i,d){return d==null||tg(i,d,Qs(d))}function Ea(i,d){return i===d||i!==i&&d!==d}var ik=xd(Nm),ok=xd(function(i,d){return i>=d}),Bi=og(function(){return arguments}())?og:function(i){return Ts(i)&&Qt.call(i,"callee")&&!qx.call(i,"callee")},tt=oe.isArray,lk=Dx?Kn(Dx):xE;function Ln(i){return i!=null&&Cd(i.length)&&!Cr(i)}function _s(i){return Ts(i)&&Ln(i)}function ck(i){return i===!0||i===!1||Ts(i)&&Sn(i)==ge}var ei=N1||lh,dk=kx?Kn(kx):gE;function uk(i){return Ts(i)&&i.nodeType===1&&!jl(i)}function mk(i){if(i==null)return!0;if(Ln(i)&&(tt(i)||typeof i=="string"||typeof i.splice=="function"||ei(i)||wo(i)||Bi(i)))return!i.length;var d=fn(i);if(d==ve||d==te)return!i.size;if(yl(i))return!Em(i).length;for(var y in i)if(Qt.call(i,y))return!1;return!0}function hk(i,d){return xl(i,d)}function fk(i,d,y){y=typeof y=="function"?y:n;var C=y?y(i,d):n;return C===n?xl(i,d,n,y):!!C}function Zm(i){if(!Ts(i))return!1;var d=Sn(i);return d==ke||d==we||typeof i.message=="string"&&typeof i.name=="string"&&!jl(i)}function pk(i){return typeof i=="number"&&Kx(i)}function Cr(i){if(!Ns(i))return!1;var d=Sn(i);return d==de||d==J||d==ae||d==gs}function p0(i){return typeof i=="number"&&i==rt(i)}function Cd(i){return typeof i=="number"&&i>-1&&i%1==0&&i<=q}function Ns(i){var d=typeof i;return i!=null&&(d=="object"||d=="function")}function Ts(i){return i!=null&&typeof i=="object"}var x0=Ax?Kn(Ax):yE;function xk(i,d){return i===d||Cm(i,d,Hm(d))}function gk(i,d,y){return y=typeof y=="function"?y:n,Cm(i,d,Hm(d),y)}function vk(i){return g0(i)&&i!=+i}function yk(i){if(sT(i))throw new et(o);return lg(i)}function bk(i){return i===null}function jk(i){return i==null}function g0(i){return typeof i=="number"||Ts(i)&&Sn(i)==ft}function jl(i){if(!Ts(i)||Sn(i)!=ot)return!1;var d=Zc(i);if(d===null)return!0;var y=Qt.call(d,"constructor")&&d.constructor;return typeof y=="function"&&y instanceof y&&Yc.call(y)==g1}var Qm=Rx?Kn(Rx):bE;function wk(i){return p0(i)&&i>=-q&&i<=q}var v0=_x?Kn(_x):jE;function Ed(i){return typeof i=="string"||!tt(i)&&Ts(i)&&Sn(i)==le}function Xn(i){return typeof i=="symbol"||Ts(i)&&Sn(i)==Ce}var wo=Px?Kn(Px):wE;function Nk(i){return i===n}function Sk(i){return Ts(i)&&fn(i)==be}function Ck(i){return Ts(i)&&Sn(i)==Re}var Ek=xd(Tm),Tk=xd(function(i,d){return i<=d});function y0(i){if(!i)return[];if(Ln(i))return Ed(i)?Sa(i):On(i);if(ll&&i[ll])return r1(i[ll]());var d=fn(i),y=d==ve?fm:d==te?Vc:No;return y(i)}function Er(i){if(!i)return i===0?i:0;if(i=da(i),i===$||i===-$){var d=i<0?-1:1;return d*re}return i===i?i:0}function rt(i){var d=Er(i),y=d%1;return d===d?y?d-y:d:0}function b0(i){return i?Li(rt(i),0,se):0}function da(i){if(typeof i=="number")return i;if(Xn(i))return Y;if(Ns(i)){var d=typeof i.valueOf=="function"?i.valueOf():i;i=Ns(d)?d+"":d}if(typeof i!="string")return i===0?i:+i;i=zx(i);var y=Zu.test(i);return y||X.test(i)?HC(i.slice(2),y?2:8):Fc.test(i)?Y:+i}function j0(i){return Xa(i,$n(i))}function Dk(i){return i?Li(rt(i),-q,q):i===0?i:0}function Kt(i){return i==null?"":Jn(i)}var kk=yo(function(i,d){if(yl(d)||Ln(d)){Xa(d,Qs(d),i);return}for(var y in d)Qt.call(d,y)&&hl(i,y,d[y])}),w0=yo(function(i,d){Xa(d,$n(d),i)}),Td=yo(function(i,d,y,C){Xa(d,$n(d),i,C)}),Ak=yo(function(i,d,y,C){Xa(d,Qs(d),i,C)}),Rk=Nr(bm);function _k(i,d){var y=vo(i);return d==null?y:eg(y,d)}var Pk=mt(function(i,d){i=rs(i);var y=-1,C=d.length,A=C>2?d[2]:n;for(A&&Cn(d[0],d[1],A)&&(C=1);++y<C;)for(var F=d[y],V=$n(F),K=-1,ne=V.length;++K<ne;){var pe=V[K],xe=i[pe];(xe===n||Ea(xe,po[pe])&&!Qt.call(i,pe))&&(i[pe]=F[pe])}return i}),Mk=mt(function(i){return i.push(n,zg),Yn(N0,n,i)});function Ik(i,d){return Ix(i,Ke(d,3),Ja)}function Ok(i,d){return Ix(i,Ke(d,3),wm)}function Lk(i,d){return i==null?i:jm(i,Ke(d,3),$n)}function $k(i,d){return i==null?i:rg(i,Ke(d,3),$n)}function zk(i,d){return i&&Ja(i,Ke(d,3))}function Fk(i,d){return i&&wm(i,Ke(d,3))}function Bk(i){return i==null?[]:ld(i,Qs(i))}function Hk(i){return i==null?[]:ld(i,$n(i))}function eh(i,d,y){var C=i==null?n:$i(i,d);return C===n?y:C}function Wk(i,d){return i!=null&&Hg(i,d,mE)}function th(i,d){return i!=null&&Hg(i,d,hE)}var Uk=Mg(function(i,d,y){d!=null&&typeof d.toString!="function"&&(d=Kc.call(d)),i[d]=y},nh(zn)),Vk=Mg(function(i,d,y){d!=null&&typeof d.toString!="function"&&(d=Kc.call(d)),Qt.call(i,d)?i[d].push(y):i[d]=[y]},Ke),Gk=mt(pl);function Qs(i){return Ln(i)?Zx(i):Em(i)}function $n(i){return Ln(i)?Zx(i,!0):NE(i)}function qk(i,d){var y={};return d=Ke(d,3),Ja(i,function(C,A,F){jr(y,d(C,A,F),C)}),y}function Yk(i,d){var y={};return d=Ke(d,3),Ja(i,function(C,A,F){jr(y,A,d(C,A,F))}),y}var Kk=yo(function(i,d,y){cd(i,d,y)}),N0=yo(function(i,d,y,C){cd(i,d,y,C)}),Jk=Nr(function(i,d){var y={};if(i==null)return y;var C=!1;d=ys(d,function(F){return F=Zr(F,i),C||(C=F.length>1),F}),Xa(i,Fm(i),y),C&&(y=oa(y,p|g|x,UE));for(var A=d.length;A--;)_m(y,d[A]);return y});function Xk(i,d){return S0(i,Sd(Ke(d)))}var Zk=Nr(function(i,d){return i==null?{}:CE(i,d)});function S0(i,d){if(i==null)return{};var y=ys(Fm(i),function(C){return[C]});return d=Ke(d),pg(i,y,function(C,A){return d(C,A[0])})}function Qk(i,d,y){d=Zr(d,i);var C=-1,A=d.length;for(A||(A=1,i=n);++C<A;){var F=i==null?n:i[Za(d[C])];F===n&&(C=A,F=y),i=Cr(F)?F.call(i):F}return i}function e2(i,d,y){return i==null?i:gl(i,d,y)}function t2(i,d,y,C){return C=typeof C=="function"?C:n,i==null?i:gl(i,d,y,C)}var C0=Lg(Qs),E0=Lg($n);function s2(i,d,y){var C=tt(i),A=C||ei(i)||wo(i);if(d=Ke(d,4),y==null){var F=i&&i.constructor;A?y=C?new F:[]:Ns(i)?y=Cr(F)?vo(Zc(i)):{}:y={}}return(A?aa:Ja)(i,function(V,K,ne){return d(y,V,K,ne)}),y}function n2(i,d){return i==null?!0:_m(i,d)}function a2(i,d,y){return i==null?i:bg(i,d,Im(y))}function r2(i,d,y,C){return C=typeof C=="function"?C:n,i==null?i:bg(i,d,Im(y),C)}function No(i){return i==null?[]:hm(i,Qs(i))}function i2(i){return i==null?[]:hm(i,$n(i))}function o2(i,d,y){return y===n&&(y=d,d=n),y!==n&&(y=da(y),y=y===y?y:0),d!==n&&(d=da(d),d=d===d?d:0),Li(da(i),d,y)}function l2(i,d,y){return d=Er(d),y===n?(y=d,d=0):y=Er(y),i=da(i),fE(i,d,y)}function c2(i,d,y){if(y&&typeof y!="boolean"&&Cn(i,d,y)&&(d=y=n),y===n&&(typeof d=="boolean"?(y=d,d=n):typeof i=="boolean"&&(y=i,i=n)),i===n&&d===n?(i=0,d=1):(i=Er(i),d===n?(d=i,i=0):d=Er(d)),i>d){var C=i;i=d,d=C}if(y||i%1||d%1){var A=Jx();return hn(i+A*(d-i+BC("1e-"+((A+"").length-1))),d)}return km(i,d)}var d2=bo(function(i,d,y){return d=d.toLowerCase(),i+(y?T0(d):d)});function T0(i){return sh(Kt(i).toLowerCase())}function D0(i){return i=Kt(i),i&&i.replace(Le,e1).replace(RC,"")}function u2(i,d,y){i=Kt(i),d=Jn(d);var C=i.length;y=y===n?C:Li(rt(y),0,C);var A=y;return y-=d.length,y>=0&&i.slice(y,A)==d}function m2(i){return i=Kt(i),i&&Mt.test(i)?i.replace(Ue,t1):i}function h2(i){return i=Kt(i),i&&us.test(i)?i.replace(ds,"\\$&"):i}var f2=bo(function(i,d,y){return i+(y?"-":"")+d.toLowerCase()}),p2=bo(function(i,d,y){return i+(y?" ":"")+d.toLowerCase()}),x2=Rg("toLowerCase");function g2(i,d,y){i=Kt(i),d=rt(d);var C=d?ho(i):0;if(!d||C>=d)return i;var A=(d-C)/2;return pd(sd(A),y)+i+pd(td(A),y)}function v2(i,d,y){i=Kt(i),d=rt(d);var C=d?ho(i):0;return d&&C<d?i+pd(d-C,y):i}function y2(i,d,y){i=Kt(i),d=rt(d);var C=d?ho(i):0;return d&&C<d?pd(d-C,y)+i:i}function b2(i,d,y){return y||d==null?d=0:d&&(d=+d),T1(Kt(i).replace(Bt,""),d||0)}function j2(i,d,y){return(y?Cn(i,d,y):d===n)?d=1:d=rt(d),Am(Kt(i),d)}function w2(){var i=arguments,d=Kt(i[0]);return i.length<3?d:d.replace(i[1],i[2])}var N2=bo(function(i,d,y){return i+(y?"_":"")+d.toLowerCase()});function S2(i,d,y){return y&&typeof y!="number"&&Cn(i,d,y)&&(d=y=n),y=y===n?se:y>>>0,y?(i=Kt(i),i&&(typeof d=="string"||d!=null&&!Qm(d))&&(d=Jn(d),!d&&mo(i))?Qr(Sa(i),0,y):i.split(d,y)):[]}var C2=bo(function(i,d,y){return i+(y?" ":"")+sh(d)});function E2(i,d,y){return i=Kt(i),y=y==null?0:Li(rt(y),0,i.length),d=Jn(d),i.slice(y,y+d.length)==d}function T2(i,d,y){var C=O.templateSettings;y&&Cn(i,d,y)&&(d=n),i=Kt(i),d=Td({},d,C,$g);var A=Td({},d.imports,C.imports,$g),F=Qs(A),V=hm(A,F),K,ne,pe=0,xe=d.interpolate||Zt,ye="__p += '",_e=pm((d.escape||Zt).source+"|"+xe.source+"|"+(xe===Ye?zc:Zt).source+"|"+(d.evaluate||Zt).source+"|$","g"),He="//# sourceURL="+(Qt.call(d,"sourceURL")?(d.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++OC+"]")+`
`;i.replace(_e,function(Xe,bt,Ot,Zn,En,Qn){return Ot||(Ot=Zn),ye+=i.slice(pe,Qn).replace(Zs,s1),bt&&(K=!0,ye+=`' +
__e(`+bt+`) +
'`),En&&(ne=!0,ye+=`';
`+En+`;
__p += '`),Ot&&(ye+=`' +
((__t = (`+Ot+`)) == null ? '' : __t) +
'`),pe=Qn+Xe.length,Xe}),ye+=`';
`;var Je=Qt.call(d,"variable")&&d.variable;if(!Je)ye=`with (obj) {
`+ye+`
}
`;else if(wa.test(Je))throw new et(c);ye=(ne?ye.replace(We,""):ye).replace(lt,"$1").replace(yt,"$1;"),ye="function("+(Je||"obj")+`) {
`+(Je?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(K?", __e = _.escape":"")+(ne?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+ye+`return __p
}`;var ct=A0(function(){return Gt(F,He+"return "+ye).apply(n,V)});if(ct.source=ye,Zm(ct))throw ct;return ct}function D2(i){return Kt(i).toLowerCase()}function k2(i){return Kt(i).toUpperCase()}function A2(i,d,y){if(i=Kt(i),i&&(y||d===n))return zx(i);if(!i||!(d=Jn(d)))return i;var C=Sa(i),A=Sa(d),F=Fx(C,A),V=Bx(C,A)+1;return Qr(C,F,V).join("")}function R2(i,d,y){if(i=Kt(i),i&&(y||d===n))return i.slice(0,Wx(i)+1);if(!i||!(d=Jn(d)))return i;var C=Sa(i),A=Bx(C,Sa(d))+1;return Qr(C,0,A).join("")}function _2(i,d,y){if(i=Kt(i),i&&(y||d===n))return i.replace(Bt,"");if(!i||!(d=Jn(d)))return i;var C=Sa(i),A=Fx(C,Sa(d));return Qr(C,A).join("")}function P2(i,d){var y=B,C=I;if(Ns(d)){var A="separator"in d?d.separator:A;y="length"in d?rt(d.length):y,C="omission"in d?Jn(d.omission):C}i=Kt(i);var F=i.length;if(mo(i)){var V=Sa(i);F=V.length}if(y>=F)return i;var K=y-ho(C);if(K<1)return C;var ne=V?Qr(V,0,K).join(""):i.slice(0,K);if(A===n)return ne+C;if(V&&(K+=ne.length-K),Qm(A)){if(i.slice(K).search(A)){var pe,xe=ne;for(A.global||(A=pm(A.source,Kt(rl.exec(A))+"g")),A.lastIndex=0;pe=A.exec(xe);)var ye=pe.index;ne=ne.slice(0,ye===n?K:ye)}}else if(i.indexOf(Jn(A),K)!=K){var _e=ne.lastIndexOf(A);_e>-1&&(ne=ne.slice(0,_e))}return ne+C}function M2(i){return i=Kt(i),i&&ut.test(i)?i.replace(Ft,c1):i}var I2=bo(function(i,d,y){return i+(y?" ":"")+d.toUpperCase()}),sh=Rg("toUpperCase");function k0(i,d,y){return i=Kt(i),d=y?n:d,d===n?a1(i)?m1(i):KC(i):i.match(d)||[]}var A0=mt(function(i,d){try{return Yn(i,n,d)}catch(y){return Zm(y)?y:new et(y)}}),O2=Nr(function(i,d){return aa(d,function(y){y=Za(y),jr(i,y,Jm(i[y],i))}),i});function L2(i){var d=i==null?0:i.length,y=Ke();return i=d?ys(i,function(C){if(typeof C[1]!="function")throw new ra(l);return[y(C[0]),C[1]]}):[],mt(function(C){for(var A=-1;++A<d;){var F=i[A];if(Yn(F[0],this,C))return Yn(F[1],this,C)}})}function $2(i){return cE(oa(i,p))}function nh(i){return function(){return i}}function z2(i,d){return i==null||i!==i?d:i}var F2=Pg(),B2=Pg(!0);function zn(i){return i}function ah(i){return cg(typeof i=="function"?i:oa(i,p))}function H2(i){return ug(oa(i,p))}function W2(i,d){return mg(i,oa(d,p))}var U2=mt(function(i,d){return function(y){return pl(y,i,d)}}),V2=mt(function(i,d){return function(y){return pl(i,y,d)}});function rh(i,d,y){var C=Qs(d),A=ld(d,C);y==null&&!(Ns(d)&&(A.length||!C.length))&&(y=d,d=i,i=this,A=ld(d,Qs(d)));var F=!(Ns(y)&&"chain"in y)||!!y.chain,V=Cr(i);return aa(A,function(K){var ne=d[K];i[K]=ne,V&&(i.prototype[K]=function(){var pe=this.__chain__;if(F||pe){var xe=i(this.__wrapped__),ye=xe.__actions__=On(this.__actions__);return ye.push({func:ne,args:arguments,thisArg:i}),xe.__chain__=pe,xe}return ne.apply(i,qr([this.value()],arguments))})}),i}function G2(){return on._===this&&(on._=v1),this}function ih(){}function q2(i){return i=rt(i),mt(function(d){return hg(d,i)})}var Y2=Lm(ys),K2=Lm(Mx),J2=Lm(lm);function R0(i){return Um(i)?cm(Za(i)):EE(i)}function X2(i){return function(d){return i==null?n:$i(i,d)}}var Z2=Ig(),Q2=Ig(!0);function oh(){return[]}function lh(){return!1}function eA(){return{}}function tA(){return""}function sA(){return!0}function nA(i,d){if(i=rt(i),i<1||i>q)return[];var y=se,C=hn(i,se);d=Ke(d),i-=se;for(var A=mm(C,d);++y<i;)d(y);return A}function aA(i){return tt(i)?ys(i,Za):Xn(i)?[i]:On(Xg(Kt(i)))}function rA(i){var d=++x1;return Kt(i)+d}var iA=fd(function(i,d){return i+d},0),oA=$m("ceil"),lA=fd(function(i,d){return i/d},1),cA=$m("floor");function dA(i){return i&&i.length?od(i,zn,Nm):n}function uA(i,d){return i&&i.length?od(i,Ke(d,2),Nm):n}function mA(i){return Lx(i,zn)}function hA(i,d){return Lx(i,Ke(d,2))}function fA(i){return i&&i.length?od(i,zn,Tm):n}function pA(i,d){return i&&i.length?od(i,Ke(d,2),Tm):n}var xA=fd(function(i,d){return i*d},1),gA=$m("round"),vA=fd(function(i,d){return i-d},0);function yA(i){return i&&i.length?um(i,zn):0}function bA(i,d){return i&&i.length?um(i,Ke(d,2)):0}return O.after=HD,O.ary=l0,O.assign=kk,O.assignIn=w0,O.assignInWith=Td,O.assignWith=Ak,O.at=Rk,O.before=c0,O.bind=Jm,O.bindAll=O2,O.bindKey=d0,O.castArray=ek,O.chain=r0,O.chunk=cT,O.compact=dT,O.concat=uT,O.cond=L2,O.conforms=$2,O.constant=nh,O.countBy=yD,O.create=_k,O.curry=u0,O.curryRight=m0,O.debounce=h0,O.defaults=Pk,O.defaultsDeep=Mk,O.defer=WD,O.delay=UD,O.difference=mT,O.differenceBy=hT,O.differenceWith=fT,O.drop=pT,O.dropRight=xT,O.dropRightWhile=gT,O.dropWhile=vT,O.fill=yT,O.filter=jD,O.flatMap=SD,O.flatMapDeep=CD,O.flatMapDepth=ED,O.flatten=t0,O.flattenDeep=bT,O.flattenDepth=jT,O.flip=VD,O.flow=F2,O.flowRight=B2,O.fromPairs=wT,O.functions=Bk,O.functionsIn=Hk,O.groupBy=TD,O.initial=ST,O.intersection=CT,O.intersectionBy=ET,O.intersectionWith=TT,O.invert=Uk,O.invertBy=Vk,O.invokeMap=kD,O.iteratee=ah,O.keyBy=AD,O.keys=Qs,O.keysIn=$n,O.map=jd,O.mapKeys=qk,O.mapValues=Yk,O.matches=H2,O.matchesProperty=W2,O.memoize=Nd,O.merge=Kk,O.mergeWith=N0,O.method=U2,O.methodOf=V2,O.mixin=rh,O.negate=Sd,O.nthArg=q2,O.omit=Jk,O.omitBy=Xk,O.once=GD,O.orderBy=RD,O.over=Y2,O.overArgs=qD,O.overEvery=K2,O.overSome=J2,O.partial=Xm,O.partialRight=f0,O.partition=_D,O.pick=Zk,O.pickBy=S0,O.property=R0,O.propertyOf=X2,O.pull=RT,O.pullAll=n0,O.pullAllBy=_T,O.pullAllWith=PT,O.pullAt=MT,O.range=Z2,O.rangeRight=Q2,O.rearg=YD,O.reject=ID,O.remove=IT,O.rest=KD,O.reverse=Ym,O.sampleSize=LD,O.set=e2,O.setWith=t2,O.shuffle=$D,O.slice=OT,O.sortBy=BD,O.sortedUniq=WT,O.sortedUniqBy=UT,O.split=S2,O.spread=JD,O.tail=VT,O.take=GT,O.takeRight=qT,O.takeRightWhile=YT,O.takeWhile=KT,O.tap=dD,O.throttle=XD,O.thru=bd,O.toArray=y0,O.toPairs=C0,O.toPairsIn=E0,O.toPath=aA,O.toPlainObject=j0,O.transform=s2,O.unary=ZD,O.union=JT,O.unionBy=XT,O.unionWith=ZT,O.uniq=QT,O.uniqBy=eD,O.uniqWith=tD,O.unset=n2,O.unzip=Km,O.unzipWith=a0,O.update=a2,O.updateWith=r2,O.values=No,O.valuesIn=i2,O.without=sD,O.words=k0,O.wrap=QD,O.xor=nD,O.xorBy=aD,O.xorWith=rD,O.zip=iD,O.zipObject=oD,O.zipObjectDeep=lD,O.zipWith=cD,O.entries=C0,O.entriesIn=E0,O.extend=w0,O.extendWith=Td,rh(O,O),O.add=iA,O.attempt=A0,O.camelCase=d2,O.capitalize=T0,O.ceil=oA,O.clamp=o2,O.clone=tk,O.cloneDeep=nk,O.cloneDeepWith=ak,O.cloneWith=sk,O.conformsTo=rk,O.deburr=D0,O.defaultTo=z2,O.divide=lA,O.endsWith=u2,O.eq=Ea,O.escape=m2,O.escapeRegExp=h2,O.every=bD,O.find=wD,O.findIndex=Qg,O.findKey=Ik,O.findLast=ND,O.findLastIndex=e0,O.findLastKey=Ok,O.floor=cA,O.forEach=i0,O.forEachRight=o0,O.forIn=Lk,O.forInRight=$k,O.forOwn=zk,O.forOwnRight=Fk,O.get=eh,O.gt=ik,O.gte=ok,O.has=Wk,O.hasIn=th,O.head=s0,O.identity=zn,O.includes=DD,O.indexOf=NT,O.inRange=l2,O.invoke=Gk,O.isArguments=Bi,O.isArray=tt,O.isArrayBuffer=lk,O.isArrayLike=Ln,O.isArrayLikeObject=_s,O.isBoolean=ck,O.isBuffer=ei,O.isDate=dk,O.isElement=uk,O.isEmpty=mk,O.isEqual=hk,O.isEqualWith=fk,O.isError=Zm,O.isFinite=pk,O.isFunction=Cr,O.isInteger=p0,O.isLength=Cd,O.isMap=x0,O.isMatch=xk,O.isMatchWith=gk,O.isNaN=vk,O.isNative=yk,O.isNil=jk,O.isNull=bk,O.isNumber=g0,O.isObject=Ns,O.isObjectLike=Ts,O.isPlainObject=jl,O.isRegExp=Qm,O.isSafeInteger=wk,O.isSet=v0,O.isString=Ed,O.isSymbol=Xn,O.isTypedArray=wo,O.isUndefined=Nk,O.isWeakMap=Sk,O.isWeakSet=Ck,O.join=DT,O.kebabCase=f2,O.last=ca,O.lastIndexOf=kT,O.lowerCase=p2,O.lowerFirst=x2,O.lt=Ek,O.lte=Tk,O.max=dA,O.maxBy=uA,O.mean=mA,O.meanBy=hA,O.min=fA,O.minBy=pA,O.stubArray=oh,O.stubFalse=lh,O.stubObject=eA,O.stubString=tA,O.stubTrue=sA,O.multiply=xA,O.nth=AT,O.noConflict=G2,O.noop=ih,O.now=wd,O.pad=g2,O.padEnd=v2,O.padStart=y2,O.parseInt=b2,O.random=c2,O.reduce=PD,O.reduceRight=MD,O.repeat=j2,O.replace=w2,O.result=Qk,O.round=gA,O.runInContext=Q,O.sample=OD,O.size=zD,O.snakeCase=N2,O.some=FD,O.sortedIndex=LT,O.sortedIndexBy=$T,O.sortedIndexOf=zT,O.sortedLastIndex=FT,O.sortedLastIndexBy=BT,O.sortedLastIndexOf=HT,O.startCase=C2,O.startsWith=E2,O.subtract=vA,O.sum=yA,O.sumBy=bA,O.template=T2,O.times=nA,O.toFinite=Er,O.toInteger=rt,O.toLength=b0,O.toLower=D2,O.toNumber=da,O.toSafeInteger=Dk,O.toString=Kt,O.toUpper=k2,O.trim=A2,O.trimEnd=R2,O.trimStart=_2,O.truncate=P2,O.unescape=M2,O.uniqueId=rA,O.upperCase=I2,O.upperFirst=sh,O.each=i0,O.eachRight=o0,O.first=s0,rh(O,function(){var i={};return Ja(O,function(d,y){Qt.call(O.prototype,y)||(i[y]=d)}),i}(),{chain:!1}),O.VERSION=a,aa(["bind","bindKey","curry","curryRight","partial","partialRight"],function(i){O[i].placeholder=O}),aa(["drop","take"],function(i,d){Dt.prototype[i]=function(y){y=y===n?1:qs(rt(y),0);var C=this.__filtered__&&!d?new Dt(this):this.clone();return C.__filtered__?C.__takeCount__=hn(y,C.__takeCount__):C.__views__.push({size:hn(y,se),type:i+(C.__dir__<0?"Right":"")}),C},Dt.prototype[i+"Right"]=function(y){return this.reverse()[i](y).reverse()}}),aa(["filter","map","takeWhile"],function(i,d){var y=d+1,C=y==W||y==L;Dt.prototype[i]=function(A){var F=this.clone();return F.__iteratees__.push({iteratee:Ke(A,3),type:y}),F.__filtered__=F.__filtered__||C,F}}),aa(["head","last"],function(i,d){var y="take"+(d?"Right":"");Dt.prototype[i]=function(){return this[y](1).value()[0]}}),aa(["initial","tail"],function(i,d){var y="drop"+(d?"":"Right");Dt.prototype[i]=function(){return this.__filtered__?new Dt(this):this[y](1)}}),Dt.prototype.compact=function(){return this.filter(zn)},Dt.prototype.find=function(i){return this.filter(i).head()},Dt.prototype.findLast=function(i){return this.reverse().find(i)},Dt.prototype.invokeMap=mt(function(i,d){return typeof i=="function"?new Dt(this):this.map(function(y){return pl(y,i,d)})}),Dt.prototype.reject=function(i){return this.filter(Sd(Ke(i)))},Dt.prototype.slice=function(i,d){i=rt(i);var y=this;return y.__filtered__&&(i>0||d<0)?new Dt(y):(i<0?y=y.takeRight(-i):i&&(y=y.drop(i)),d!==n&&(d=rt(d),y=d<0?y.dropRight(-d):y.take(d-i)),y)},Dt.prototype.takeRightWhile=function(i){return this.reverse().takeWhile(i).reverse()},Dt.prototype.toArray=function(){return this.take(se)},Ja(Dt.prototype,function(i,d){var y=/^(?:filter|find|map|reject)|While$/.test(d),C=/^(?:head|last)$/.test(d),A=O[C?"take"+(d=="last"?"Right":""):d],F=C||/^find/.test(d);A&&(O.prototype[d]=function(){var V=this.__wrapped__,K=C?[1]:arguments,ne=V instanceof Dt,pe=K[0],xe=ne||tt(V),ye=function(bt){var Ot=A.apply(O,qr([bt],K));return C&&_e?Ot[0]:Ot};xe&&y&&typeof pe=="function"&&pe.length!=1&&(ne=xe=!1);var _e=this.__chain__,He=!!this.__actions__.length,Je=F&&!_e,ct=ne&&!He;if(!F&&xe){V=ct?V:new Dt(this);var Xe=i.apply(V,K);return Xe.__actions__.push({func:bd,args:[ye],thisArg:n}),new ia(Xe,_e)}return Je&&ct?i.apply(this,K):(Xe=this.thru(ye),Je?C?Xe.value()[0]:Xe.value():Xe)})}),aa(["pop","push","shift","sort","splice","unshift"],function(i){var d=Gc[i],y=/^(?:push|sort|unshift)$/.test(i)?"tap":"thru",C=/^(?:pop|shift)$/.test(i);O.prototype[i]=function(){var A=arguments;if(C&&!this.__chain__){var F=this.value();return d.apply(tt(F)?F:[],A)}return this[y](function(V){return d.apply(tt(V)?V:[],A)})}}),Ja(Dt.prototype,function(i,d){var y=O[d];if(y){var C=y.name+"";Qt.call(go,C)||(go[C]=[]),go[C].push({name:d,func:y})}}),go[hd(n,w).name]=[{name:"wrapper",func:n}],Dt.prototype.clone=M1,Dt.prototype.reverse=I1,Dt.prototype.value=O1,O.prototype.at=uD,O.prototype.chain=mD,O.prototype.commit=hD,O.prototype.next=fD,O.prototype.plant=xD,O.prototype.reverse=gD,O.prototype.toJSON=O.prototype.valueOf=O.prototype.value=vD,O.prototype.first=O.prototype.head,ll&&(O.prototype[ll]=pD),O},fo=h1();Pi?((Pi.exports=fo)._=fo,am._=fo):on._=fo}).call(wl)})(au,au.exports);var pn=au.exports;const gw=(t,s)=>{const[n,a]=f.useState(null),[r,o]=f.useState(!0),[l,c]=f.useState(null),{user:m}=qe();return f.useEffect(()=>{(async()=>{if(a(null),!!m){o(!0),c(null);try{const h=[],p=new Date(t),g=new Date(s);for(;p<=g;)h.push($e(p)),p.setDate(p.getDate()+1);const x=new Map(h.map(R=>[R,{date:R,drinks:[],totalWater:0}])),b=h.map(R=>{const M=Te(fe,"water",`${m.uid}_${R}`);return st(M)});(await Promise.all(b)).forEach(R=>{if(R.exists()){const M=R.data();x.set(M.date,{date:M.date,drinks:M.drinks||[],totalWater:M.totalWater||0})}});const v=Array.from(x.values()),w=pn.sumBy(v,"totalWater"),N=v.filter(R=>R.totalWater>0).length,S=v.filter(R=>R.totalWater>=2e3).length,E=N>0?w/N:0,T=v.flatMap(R=>R.drinks),k=pn.groupBy(T,"type"),D=Object.entries(k).map(([R,M])=>({type:R,count:M.length,totalAmount:pn.sumBy(M,"amount"),percentage:pn.sumBy(M,"amount")/w*100||0})).sort((R,M)=>M.totalAmount-R.totalAmount),P=pn.groupBy(T,R=>Wn[R.type].category),_=Object.entries(P).map(([R,M])=>({category:R,totalAmount:pn.sumBy(M,"amount"),percentage:pn.sumBy(M,"amount")/w*100||0})).sort((R,M)=>M.totalAmount-R.totalAmount);let B;s.getTime()-t.getTime()>2592e6&&(B=Object.entries(pn.groupBy(v,R=>R.date.substring(0,7))).map(([R,M])=>({month:`${R}-01`,average:pn.sumBy(M,"totalWater")/M.length})).sort((R,M)=>new Date(R.month).getTime()-new Date(M.month).getTime()));const I=v.map(R=>({date:R.date,intake:R.totalWater}));a({dailyStats:I,summary:{totalIntake:w,avgDailyIntake:E,daysTracked:N,daysWithGoal:S},drinkStats:D,categoryStats:_,...B&&{monthlyAverages:B}})}catch(h){console.error("Error al cargar estadísticas:",h),c(h instanceof Error?h.message:"Error al cargar estadísticas")}finally{o(!1)}}})()},[m,t,s]),{stats:n,loading:r,error:l}},wv=["#60A5FA","#34D399","#A78BFA","#F87171","#FBBF24","#A3E635"],_4=({startDate:t,endDate:s})=>{const{stats:n,loading:a,error:r}=gw(t,s);if(a)return e.jsx(Ne,{className:"w-full",children:e.jsx(De,{className:"flex items-center justify-center p-6",children:e.jsx(ls,{className:"w-6 h-6 animate-spin"})})});if(r||!n)return e.jsx(Ne,{className:"w-full",children:e.jsx(De,{className:"p-6",children:e.jsx("p",{className:"text-red-500",children:"Error al cargar estadísticas"})})});const o=l=>at(new Date(l),"dd MMM",{locale:kn});return e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(Ne,{className:"w-full md:col-span-2",children:[e.jsx(Vt,{className:"pb-2",children:e.jsx(Wt,{children:"Resumen del Período"})}),e.jsx(De,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-muted",children:[" ",e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[Math.round(n.summary.avgDailyIntake),"ml"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Promedio diario"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted",children:[" ",e.jsx("div",{className:"text-2xl font-bold text-green-600",children:n.summary.daysTracked}),e.jsx("div",{className:"text-sm text-gray-600",children:"Días registrados"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted",children:[" ",e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:n.summary.daysWithGoal}),e.jsx("div",{className:"text-sm text-gray-600",children:"Días meta alcanzada"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted",children:[" ",e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:[Math.round(n.summary.totalIntake/1e3),"L"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total consumido"})]})]})})]}),e.jsxs(Ne,{className:"w-full md:col-span-2",children:[e.jsx(Vt,{children:e.jsx(Wt,{children:"Tendencia de Consumo"})}),e.jsx(De,{children:e.jsx("div",{className:"h-[300px]",children:e.jsx(gn,{width:"100%",height:"100%",children:e.jsxs(qi,{data:n.dailyStats,children:[e.jsx(sr,{strokeDasharray:"3 3"}),e.jsx(Ma,{dataKey:"date",tickFormatter:o,interval:"preserveStartEnd"}),e.jsx(ma,{tickFormatter:l=>`${l}ml`}),e.jsx(vn,{formatter:l=>[`${l}ml`,"Consumo"],labelFormatter:l=>at(new Date(l),"dd MMMM yyyy",{locale:kn})}),e.jsx(gi,{type:"monotone",dataKey:"intake",stroke:"#60A5FA",strokeWidth:2,dot:!1})]})})})})]}),e.jsxs(Ne,{className:"w-full",children:[e.jsx(Vt,{children:e.jsx(Wt,{children:"Distribución por Categoría"})}),e.jsx(De,{children:e.jsx("div",{className:"h-[300px]",children:e.jsx(gn,{width:"100%",height:"100%",children:e.jsxs(bc,{children:[e.jsx(jc,{data:n.categoryStats,dataKey:"totalAmount",nameKey:"category",cx:"50%",cy:"50%",outerRadius:100,label:({category:l})=>hc[l],children:n.categoryStats.map((l,c)=>e.jsx(wc,{fill:wv[c%wv.length]},l.category))}),e.jsx(vn,{formatter:l=>[`${l}ml`,"Cantidad"],labelFormatter:l=>hc[l]})]})})})})]}),e.jsxs(Ne,{className:"w-full",children:[e.jsx(Vt,{children:e.jsx(Wt,{children:"Top Bebidas"})}),"        ",e.jsx(De,{children:e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[" ",n.drinkStats.slice(0,6).map(l=>{const c=Wn[l.type],m=Ni[c.icon];return e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-muted hover:bg-accent transition-colors",children:[e.jsx(m,{className:`w-8 h-8 ${c.color} flex-shrink-0`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[" ",e.jsx("div",{className:"font-medium text-base",children:c.name})," ",e.jsxs("div",{className:"text-sm text-muted-foreground",children:[" ",Math.round(l.totalAmount),"ml"]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[" ",l.count," veces (",Math.round(l.percentage),"%)"]})]})]},l.type)})]})})]}),n.monthlyAverages&&e.jsxs(Ne,{className:"w-full md:col-span-2",children:[e.jsx(Vt,{children:e.jsx(Wt,{children:"Promedios Mensuales"})}),e.jsx(De,{children:e.jsx("div",{className:"h-[300px]",children:e.jsx(gn,{width:"100%",height:"100%",children:e.jsxs(Nu,{data:n.monthlyAverages,children:[e.jsx(sr,{strokeDasharray:"3 3"}),e.jsx(Ma,{dataKey:"month",tickFormatter:l=>{const c=new Date(l);return at(c,"MMM yyyy",{locale:kn})}}),e.jsx(ma,{tickFormatter:l=>`${Math.round(l)}ml`}),e.jsx(vn,{formatter:l=>[`${Math.round(l)}ml`,"Promedio"],labelFormatter:l=>{const c=new Date(l);return at(c,"MMMM yyyy",{locale:kn})}}),e.jsx(rc,{dataKey:"average",fill:"#60A5FA"})]})})})})]})]})};var up="Progress",mp=100,[P4,sW]=Br(up),[M4,I4]=P4(up),vw=f.forwardRef((t,s)=>{const{__scopeProgress:n,value:a=null,max:r,getValueLabel:o=O4,...l}=t;(r||r===0)&&!Nv(r)&&console.error(L4(`${r}`,"Progress"));const c=Nv(r)?r:mp;a!==null&&!Sv(a,c)&&console.error($4(`${a}`,"Progress"));const m=Sv(a,c)?a:null,u=ru(m)?o(m,c):void 0;return e.jsx(M4,{scope:n,value:m,max:c,children:e.jsx(At.div,{"aria-valuemax":c,"aria-valuemin":0,"aria-valuenow":ru(m)?m:void 0,"aria-valuetext":u,role:"progressbar","data-state":jw(m,c),"data-value":m??void 0,"data-max":c,...l,ref:s})})});vw.displayName=up;var yw="ProgressIndicator",bw=f.forwardRef((t,s)=>{const{__scopeProgress:n,...a}=t,r=I4(yw,n);return e.jsx(At.div,{"data-state":jw(r.value,r.max),"data-value":r.value??void 0,"data-max":r.max,...a,ref:s})});bw.displayName=yw;function O4(t,s){return`${Math.round(t/s*100)}%`}function jw(t,s){return t==null?"indeterminate":t===s?"complete":"loading"}function ru(t){return typeof t=="number"}function Nv(t){return ru(t)&&!isNaN(t)&&t>0}function Sv(t,s){return ru(t)&&!isNaN(t)&&t<=s&&t>=0}function L4(t,s){return`Invalid prop \`max\` of value \`${t}\` supplied to \`${s}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${mp}\`.`}function $4(t,s){return`Invalid prop \`value\` of value \`${t}\` supplied to \`${s}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${mp} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var ww=vw,z4=bw;const Vn=f.forwardRef(({className:t,value:s,...n},a)=>e.jsx(ww,{ref:a,className:ce("relative h-4 w-full overflow-hidden rounded-full bg-secondary",t),...n,children:e.jsx(z4,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})}));Vn.displayName=ww.displayName;const F4=({intake:t,goal:s})=>{const n=()=>{const a=t/s*100;return a>=100?"¡Excelente! Has alcanzado tu meta diaria 🎉":a>=75?"¡Vas muy bien! Ya casi llegas a tu meta 💪":a>=50?"¡A mitad de camino! Sigue así 🌊":a>=25?"¡Buen comienzo! Mantén el ritmo 💧":"¡Comienza tu día con buena hidratación! 🚰"};return e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"font-medium text-lg flex items-center gap-2",children:[e.jsx($f,{className:"w-5 h-5"}),"Hidratación"]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:t>s?"text-blue-500 font-medium":"",children:[t,"ml / ",s,"ml"]}),e.jsx("div",{className:"text-xs text-gray-500",children:t>s?`+${t-s}ml extra`:""})]})]}),e.jsx(Vn,{value:Math.min(t/s*100,100),className:"h-3"}),e.jsx("p",{className:"text-sm text-gray-600 mt-2 text-center",children:n()})]})};function B4(t,s){return f.useReducer((n,a)=>s[n][a]??n,t)}var hp="ScrollArea",[Nw,nW]=Br(hp),[H4,ya]=Nw(hp),Sw=f.forwardRef((t,s)=>{const{__scopeScrollArea:n,type:a="hover",dir:r,scrollHideDelay:o=600,...l}=t,[c,m]=f.useState(null),[u,h]=f.useState(null),[p,g]=f.useState(null),[x,b]=f.useState(null),[j,v]=f.useState(null),[w,N]=f.useState(0),[S,E]=f.useState(0),[T,k]=f.useState(!1),[D,P]=f.useState(!1),_=ws(s,I=>m(I)),B=bu(r);return e.jsx(H4,{scope:n,type:a,dir:B,scrollHideDelay:o,scrollArea:c,viewport:u,onViewportChange:h,content:p,onContentChange:g,scrollbarX:x,onScrollbarXChange:b,scrollbarXEnabled:T,onScrollbarXEnabledChange:k,scrollbarY:j,onScrollbarYChange:v,scrollbarYEnabled:D,onScrollbarYEnabledChange:P,onCornerWidthChange:N,onCornerHeightChange:E,children:e.jsx(At.div,{dir:B,...l,ref:_,style:{position:"relative","--radix-scroll-area-corner-width":w+"px","--radix-scroll-area-corner-height":S+"px",...t.style}})})});Sw.displayName=hp;var Cw="ScrollAreaViewport",Ew=f.forwardRef((t,s)=>{const{__scopeScrollArea:n,children:a,nonce:r,...o}=t,l=ya(Cw,n),c=f.useRef(null),m=ws(s,c,l.onViewportChange);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:r}),e.jsx(At.div,{"data-radix-scroll-area-viewport":"",...o,ref:m,style:{overflowX:l.scrollbarXEnabled?"scroll":"hidden",overflowY:l.scrollbarYEnabled?"scroll":"hidden",...t.style},children:e.jsx("div",{ref:l.onContentChange,style:{minWidth:"100%",display:"table"},children:a})})]})});Ew.displayName=Cw;var ur="ScrollAreaScrollbar",fp=f.forwardRef((t,s)=>{const{forceMount:n,...a}=t,r=ya(ur,t.__scopeScrollArea),{onScrollbarXEnabledChange:o,onScrollbarYEnabledChange:l}=r,c=t.orientation==="horizontal";return f.useEffect(()=>(c?o(!0):l(!0),()=>{c?o(!1):l(!1)}),[c,o,l]),r.type==="hover"?e.jsx(W4,{...a,ref:s,forceMount:n}):r.type==="scroll"?e.jsx(U4,{...a,ref:s,forceMount:n}):r.type==="auto"?e.jsx(Tw,{...a,ref:s,forceMount:n}):r.type==="always"?e.jsx(pp,{...a,ref:s}):null});fp.displayName=ur;var W4=f.forwardRef((t,s)=>{const{forceMount:n,...a}=t,r=ya(ur,t.__scopeScrollArea),[o,l]=f.useState(!1);return f.useEffect(()=>{const c=r.scrollArea;let m=0;if(c){const u=()=>{window.clearTimeout(m),l(!0)},h=()=>{m=window.setTimeout(()=>l(!1),r.scrollHideDelay)};return c.addEventListener("pointerenter",u),c.addEventListener("pointerleave",h),()=>{window.clearTimeout(m),c.removeEventListener("pointerenter",u),c.removeEventListener("pointerleave",h)}}},[r.scrollArea,r.scrollHideDelay]),e.jsx(Hr,{present:n||o,children:e.jsx(Tw,{"data-state":o?"visible":"hidden",...a,ref:s})})}),U4=f.forwardRef((t,s)=>{const{forceMount:n,...a}=t,r=ya(ur,t.__scopeScrollArea),o=t.orientation==="horizontal",l=Lu(()=>m("SCROLL_END"),100),[c,m]=B4("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return f.useEffect(()=>{if(c==="idle"){const u=window.setTimeout(()=>m("HIDE"),r.scrollHideDelay);return()=>window.clearTimeout(u)}},[c,r.scrollHideDelay,m]),f.useEffect(()=>{const u=r.viewport,h=o?"scrollLeft":"scrollTop";if(u){let p=u[h];const g=()=>{const x=u[h];p!==x&&(m("SCROLL"),l()),p=x};return u.addEventListener("scroll",g),()=>u.removeEventListener("scroll",g)}},[r.viewport,o,m,l]),e.jsx(Hr,{present:n||c!=="hidden",children:e.jsx(pp,{"data-state":c==="hidden"?"hidden":"visible",...a,ref:s,onPointerEnter:nt(t.onPointerEnter,()=>m("POINTER_ENTER")),onPointerLeave:nt(t.onPointerLeave,()=>m("POINTER_LEAVE"))})})}),Tw=f.forwardRef((t,s)=>{const n=ya(ur,t.__scopeScrollArea),{forceMount:a,...r}=t,[o,l]=f.useState(!1),c=t.orientation==="horizontal",m=Lu(()=>{if(n.viewport){const u=n.viewport.offsetWidth<n.viewport.scrollWidth,h=n.viewport.offsetHeight<n.viewport.scrollHeight;l(c?u:h)}},10);return Io(n.viewport,m),Io(n.content,m),e.jsx(Hr,{present:a||o,children:e.jsx(pp,{"data-state":o?"visible":"hidden",...r,ref:s})})}),pp=f.forwardRef((t,s)=>{const{orientation:n="vertical",...a}=t,r=ya(ur,t.__scopeScrollArea),o=f.useRef(null),l=f.useRef(0),[c,m]=f.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),u=_w(c.viewport,c.content),h={...a,sizes:c,onSizesChange:m,hasThumb:u>0&&u<1,onThumbChange:g=>o.current=g,onThumbPointerUp:()=>l.current=0,onThumbPointerDown:g=>l.current=g};function p(g,x){return J4(g,l.current,c,x)}return n==="horizontal"?e.jsx(V4,{...h,ref:s,onThumbPositionChange:()=>{if(r.viewport&&o.current){const g=r.viewport.scrollLeft,x=Cv(g,c,r.dir);o.current.style.transform=`translate3d(${x}px, 0, 0)`}},onWheelScroll:g=>{r.viewport&&(r.viewport.scrollLeft=g)},onDragScroll:g=>{r.viewport&&(r.viewport.scrollLeft=p(g,r.dir))}}):n==="vertical"?e.jsx(G4,{...h,ref:s,onThumbPositionChange:()=>{if(r.viewport&&o.current){const g=r.viewport.scrollTop,x=Cv(g,c);o.current.style.transform=`translate3d(0, ${x}px, 0)`}},onWheelScroll:g=>{r.viewport&&(r.viewport.scrollTop=g)},onDragScroll:g=>{r.viewport&&(r.viewport.scrollTop=p(g))}}):null}),V4=f.forwardRef((t,s)=>{const{sizes:n,onSizesChange:a,...r}=t,o=ya(ur,t.__scopeScrollArea),[l,c]=f.useState(),m=f.useRef(null),u=ws(s,m,o.onScrollbarXChange);return f.useEffect(()=>{m.current&&c(getComputedStyle(m.current))},[m]),e.jsx(kw,{"data-orientation":"horizontal",...r,ref:u,sizes:n,style:{bottom:0,left:o.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:o.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":Ou(n)+"px",...t.style},onThumbPointerDown:h=>t.onThumbPointerDown(h.x),onDragScroll:h=>t.onDragScroll(h.x),onWheelScroll:(h,p)=>{if(o.viewport){const g=o.viewport.scrollLeft+h.deltaX;t.onWheelScroll(g),Mw(g,p)&&h.preventDefault()}},onResize:()=>{m.current&&o.viewport&&l&&a({content:o.viewport.scrollWidth,viewport:o.viewport.offsetWidth,scrollbar:{size:m.current.clientWidth,paddingStart:ou(l.paddingLeft),paddingEnd:ou(l.paddingRight)}})}})}),G4=f.forwardRef((t,s)=>{const{sizes:n,onSizesChange:a,...r}=t,o=ya(ur,t.__scopeScrollArea),[l,c]=f.useState(),m=f.useRef(null),u=ws(s,m,o.onScrollbarYChange);return f.useEffect(()=>{m.current&&c(getComputedStyle(m.current))},[m]),e.jsx(kw,{"data-orientation":"vertical",...r,ref:u,sizes:n,style:{top:0,right:o.dir==="ltr"?0:void 0,left:o.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":Ou(n)+"px",...t.style},onThumbPointerDown:h=>t.onThumbPointerDown(h.y),onDragScroll:h=>t.onDragScroll(h.y),onWheelScroll:(h,p)=>{if(o.viewport){const g=o.viewport.scrollTop+h.deltaY;t.onWheelScroll(g),Mw(g,p)&&h.preventDefault()}},onResize:()=>{m.current&&o.viewport&&l&&a({content:o.viewport.scrollHeight,viewport:o.viewport.offsetHeight,scrollbar:{size:m.current.clientHeight,paddingStart:ou(l.paddingTop),paddingEnd:ou(l.paddingBottom)}})}})}),[q4,Dw]=Nw(ur),kw=f.forwardRef((t,s)=>{const{__scopeScrollArea:n,sizes:a,hasThumb:r,onThumbChange:o,onThumbPointerUp:l,onThumbPointerDown:c,onThumbPositionChange:m,onDragScroll:u,onWheelScroll:h,onResize:p,...g}=t,x=ya(ur,n),[b,j]=f.useState(null),v=ws(s,_=>j(_)),w=f.useRef(null),N=f.useRef(""),S=x.viewport,E=a.content-a.viewport,T=hi(h),k=hi(m),D=Lu(p,10);function P(_){if(w.current){const B=_.clientX-w.current.left,I=_.clientY-w.current.top;u({x:B,y:I})}}return f.useEffect(()=>{const _=B=>{const I=B.target;(b==null?void 0:b.contains(I))&&T(B,E)};return document.addEventListener("wheel",_,{passive:!1}),()=>document.removeEventListener("wheel",_,{passive:!1})},[S,b,E,T]),f.useEffect(k,[a,k]),Io(b,D),Io(x.content,D),e.jsx(q4,{scope:n,scrollbar:b,hasThumb:r,onThumbChange:hi(o),onThumbPointerUp:hi(l),onThumbPositionChange:k,onThumbPointerDown:hi(c),children:e.jsx(At.div,{...g,ref:v,style:{position:"absolute",...g.style},onPointerDown:nt(t.onPointerDown,_=>{_.button===0&&(_.target.setPointerCapture(_.pointerId),w.current=b.getBoundingClientRect(),N.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",x.viewport&&(x.viewport.style.scrollBehavior="auto"),P(_))}),onPointerMove:nt(t.onPointerMove,P),onPointerUp:nt(t.onPointerUp,_=>{const B=_.target;B.hasPointerCapture(_.pointerId)&&B.releasePointerCapture(_.pointerId),document.body.style.webkitUserSelect=N.current,x.viewport&&(x.viewport.style.scrollBehavior=""),w.current=null})})})}),iu="ScrollAreaThumb",Aw=f.forwardRef((t,s)=>{const{forceMount:n,...a}=t,r=Dw(iu,t.__scopeScrollArea);return e.jsx(Hr,{present:n||r.hasThumb,children:e.jsx(Y4,{ref:s,...a})})}),Y4=f.forwardRef((t,s)=>{const{__scopeScrollArea:n,style:a,...r}=t,o=ya(iu,n),l=Dw(iu,n),{onThumbPositionChange:c}=l,m=ws(s,p=>l.onThumbChange(p)),u=f.useRef(void 0),h=Lu(()=>{u.current&&(u.current(),u.current=void 0)},100);return f.useEffect(()=>{const p=o.viewport;if(p){const g=()=>{if(h(),!u.current){const x=X4(p,c);u.current=x,c()}};return c(),p.addEventListener("scroll",g),()=>p.removeEventListener("scroll",g)}},[o.viewport,h,c]),e.jsx(At.div,{"data-state":l.hasThumb?"visible":"hidden",...r,ref:m,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...a},onPointerDownCapture:nt(t.onPointerDownCapture,p=>{const x=p.target.getBoundingClientRect(),b=p.clientX-x.left,j=p.clientY-x.top;l.onThumbPointerDown({x:b,y:j})}),onPointerUp:nt(t.onPointerUp,l.onThumbPointerUp)})});Aw.displayName=iu;var xp="ScrollAreaCorner",Rw=f.forwardRef((t,s)=>{const n=ya(xp,t.__scopeScrollArea),a=!!(n.scrollbarX&&n.scrollbarY);return n.type!=="scroll"&&a?e.jsx(K4,{...t,ref:s}):null});Rw.displayName=xp;var K4=f.forwardRef((t,s)=>{const{__scopeScrollArea:n,...a}=t,r=ya(xp,n),[o,l]=f.useState(0),[c,m]=f.useState(0),u=!!(o&&c);return Io(r.scrollbarX,()=>{var p;const h=((p=r.scrollbarX)==null?void 0:p.offsetHeight)||0;r.onCornerHeightChange(h),m(h)}),Io(r.scrollbarY,()=>{var p;const h=((p=r.scrollbarY)==null?void 0:p.offsetWidth)||0;r.onCornerWidthChange(h),l(h)}),u?e.jsx(At.div,{...a,ref:s,style:{width:o,height:c,position:"absolute",right:r.dir==="ltr"?0:void 0,left:r.dir==="rtl"?0:void 0,bottom:0,...t.style}}):null});function ou(t){return t?parseInt(t,10):0}function _w(t,s){const n=t/s;return isNaN(n)?0:n}function Ou(t){const s=_w(t.viewport,t.content),n=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,a=(t.scrollbar.size-n)*s;return Math.max(a,18)}function J4(t,s,n,a="ltr"){const r=Ou(n),o=r/2,l=s||o,c=r-l,m=n.scrollbar.paddingStart+l,u=n.scrollbar.size-n.scrollbar.paddingEnd-c,h=n.content-n.viewport,p=a==="ltr"?[0,h]:[h*-1,0];return Pw([m,u],p)(t)}function Cv(t,s,n="ltr"){const a=Ou(s),r=s.scrollbar.paddingStart+s.scrollbar.paddingEnd,o=s.scrollbar.size-r,l=s.content-s.viewport,c=o-a,m=n==="ltr"?[0,l]:[l*-1,0],u=ff(t,m);return Pw([0,l],[0,c])(u)}function Pw(t,s){return n=>{if(t[0]===t[1]||s[0]===s[1])return s[0];const a=(s[1]-s[0])/(t[1]-t[0]);return s[0]+a*(n-t[0])}}function Mw(t,s){return t>0&&t<s}var X4=(t,s=()=>{})=>{let n={left:t.scrollLeft,top:t.scrollTop},a=0;return function r(){const o={left:t.scrollLeft,top:t.scrollTop},l=n.left!==o.left,c=n.top!==o.top;(l||c)&&s(),n=o,a=window.requestAnimationFrame(r)}(),()=>window.cancelAnimationFrame(a)};function Lu(t,s){const n=hi(t),a=f.useRef(0);return f.useEffect(()=>()=>window.clearTimeout(a.current),[]),f.useCallback(()=>{window.clearTimeout(a.current),a.current=window.setTimeout(n,s)},[n,s])}function Io(t,s){const n=hi(s);zr(()=>{let a=0;if(t){const r=new ResizeObserver(()=>{cancelAnimationFrame(a),a=window.requestAnimationFrame(n)});return r.observe(t),()=>{window.cancelAnimationFrame(a),r.unobserve(t)}}},[t,n])}var Iw=Sw,Z4=Ew,Q4=Rw;const $u=f.forwardRef(({className:t,children:s,...n},a)=>e.jsxs(Iw,{ref:a,className:ce("relative overflow-hidden",t),...n,children:[e.jsx(Z4,{className:"h-full w-full rounded-[inherit]",children:s}),e.jsx(Ow,{}),e.jsx(Q4,{})]}));$u.displayName=Iw.displayName;const Ow=f.forwardRef(({className:t,orientation:s="vertical",...n},a)=>e.jsx(fp,{ref:a,orientation:s,className:ce("flex touch-none select-none transition-colors",s==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",s==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...n,children:e.jsx(Aw,{className:"relative flex-1 rounded-full bg-border"})}));Ow.displayName=fp.displayName;const e5=({isOpen:t,onClose:s,onSelect:n})=>{var h;const[a,r]=f.useState(null),[o,l]=f.useState("water"),c=Object.entries(Wn).reduce((p,[g,x])=>{const b=x.category;return p[b]||(p[b]=[]),p[b].push({key:g,...x}),p},{}),m=p=>{r(a===p?null:p)},u=p=>{a&&(n(a,p),r(null),s())};return e.jsx(Rt,{open:t,onOpenChange:s,children:e.jsxs(Ct,{className:"sm:max-w-4xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsx(_t,{children:e.jsx(Pt,{className:"text-xl",children:"Seleccionar bebida"})}),e.jsxs("div",{className:"flex flex-col gap-4 flex-1",children:[e.jsxs(Nt,{value:o,onValueChange:l,children:[e.jsx(xt,{className:"w-full md:w-64",children:e.jsx(St,{placeholder:"Selecciona una categoría"})}),e.jsx(gt,{children:Object.entries(hc).map(([p,g])=>e.jsx(Pe,{value:p,children:g},p))})]}),e.jsx($u,{className:"flex-1",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3 p-1",children:(h=c[o])==null?void 0:h.map(p=>{const g=Ni[p.icon],x=a===p.key;return e.jsx("div",{className:"relative",children:e.jsxs(z,{variant:x?"default":"outline",className:"w-full h-20 flex flex-col items-center justify-center gap-2 p-3 text-center transition-all hover:scale-105 transform",onClick:()=>m(p.key),children:[e.jsx(g,{className:`w-6 h-6 ${x?"text-white":p.color} flex-shrink-0`}),e.jsx("span",{className:"text-xs leading-tight break-words font-medium",children:p.name})]})},p.key)})})}),a&&e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-4 shadow-sm",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3",children:[e.jsx("div",{className:"flex items-center gap-3 sm:flex-shrink-0",children:(()=>{const p=Wn[a],g=Ni[p.icon];return e.jsxs(e.Fragment,{children:[e.jsx(g,{className:`w-6 h-6 ${p.color}`}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:p.name}),e.jsx("p",{className:"text-sm text-gray-600",children:"Selecciona la cantidad"})]})]})})()}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-2",children:Wn[a].amounts.map(p=>e.jsxs(z,{variant:"outline",size:"sm",className:"bg-white hover:bg-blue-50 border-blue-200 text-blue-700 font-medium transition-all hover:scale-105 transform",onClick:()=>u(p),children:[p,"ml"]},p))})}),e.jsx(z,{variant:"ghost",size:"sm",className:"text-gray-500 hover:text-gray-700 sm:flex-shrink-0",onClick:()=>r(null),children:"✕"})]})})]})]})})},t5=["water","sparklingWater","flavoredWater","coffee","tea","aromatica","milk","juice","sportsdrink","soda","energyDrink"],s5=({selectedDrink:t,onDrinkSelect:s,onAmountSelect:n,disabled:a})=>{const[r,o]=f.useState(!1),l=(m,u)=>{n(m,u),o(!1)},c=m=>{s(t===m?null:m)};return e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Agregar bebida"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Selecciona una bebida para registrar"})]}),"      ",e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:[t5.map(m=>{const u=Wn[m],h=Ni[u.icon],p=t===m;return e.jsxs(z,{variant:p?"default":"outline",className:ce("h-20 w-full flex flex-col items-center justify-center gap-1 p-2","transition-all duration-200 hover:scale-105",p&&"ring-2 ring-blue-500 ring-offset-1"),onClick:()=>c(m),disabled:a,children:[e.jsx(h,{className:ce("w-5 h-5 flex-shrink-0",p?"text-white":u.color)}),e.jsx("span",{className:"text-xs font-medium leading-tight text-center",children:u.name})]},m)}),e.jsxs(z,{variant:"outline",className:"h-20 w-full flex flex-col items-center justify-center gap-1 p-2 border-dashed border-2 hover:border-blue-300 hover:bg-blue-50",onClick:()=>o(!0),disabled:a,children:[e.jsx(as,{className:"w-5 h-5 text-gray-400"}),e.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Más"})]})]}),t&&e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:(()=>{const m=Wn[t],u=Ni[m.icon];return e.jsxs(e.Fragment,{children:[e.jsx(u,{className:ce("w-5 h-5",m.color)}),e.jsx("span",{className:"font-medium text-gray-900",children:m.name})]})})()}),e.jsx(z,{variant:"ghost",size:"sm",className:"text-gray-400 hover:text-gray-600 h-8 w-8 p-0",onClick:()=>s(null),children:e.jsx(Ws,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:Wn[t].amounts.map(m=>e.jsx(z,{variant:"outline",className:"h-10 bg-white hover:bg-blue-50 hover:border-blue-300",onClick:()=>{n(t,m),s(null)},children:e.jsxs("span",{className:"font-medium",children:[m,"ml"]})},m))})]}),e.jsx(e5,{isOpen:r,onClose:()=>o(!1),onSelect:l})]})},Be=f.forwardRef(({className:t,type:s,inputMode:n,...a},r)=>{const o=n||n5(s);return e.jsx("input",{type:s,inputMode:o,className:ce("flex h-11 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background","file:border-0 file:bg-transparent file:text-sm file:font-medium","placeholder:text-muted-foreground","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","disabled:cursor-not-allowed disabled:opacity-50","transition-colors duration-150","touch-manipulation","appearance-none [-webkit-appearance:none]",t),ref:r,...a})});Be.displayName="Input";function n5(t){switch(t){case"email":return"email";case"tel":return"tel";case"number":return"numeric";case"search":return"search";case"url":return"url";default:return"text"}}const a5=({drink:t,isOpen:s,onClose:n,onSave:a})=>{const[r,o]=f.useState(""),[l,c]=f.useState("");if(f.useEffect(()=>{t&&(o(t.amount.toString()),c(t.time))},[t]),!t)return null;const m=Wn[t.type],u=Ni[m.icon],h=()=>{const p={...t,amount:parseInt(r),time:l,hydration:parseInt(r)*m.hydrationFactor};a(p),n()};return e.jsx(Rt,{open:s,onOpenChange:n,children:e.jsxs(Ct,{className:"sm:max-w-md",children:[e.jsx(_t,{children:e.jsxs(Pt,{className:"flex items-center gap-2",children:[e.jsx(u,{className:`w-5 h-5 ${m.color}`}),"Editar ",m.name]})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{htmlFor:"amount",className:"text-sm font-medium",children:"Cantidad (ml)"}),e.jsx(Be,{id:"amount",type:"number",value:r,onChange:p=>o(p.target.value),min:"0",step:"50"})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("label",{htmlFor:"time",className:"text-sm font-medium",children:"Hora"}),e.jsx(Be,{id:"time",type:"time",value:l,onChange:p=>c(p.target.value)})]})]}),e.jsxs(wn,{className:"sm:justify-start",children:[e.jsx(z,{type:"button",variant:"secondary",onClick:n,children:"Cancelar"}),e.jsx(z,{type:"button",onClick:h,disabled:!r||!l,children:"Guardar cambios"})]})]})})},r5=({drinks:t,showHistory:s,onToggleHistory:n,onDeleteDrink:a,onEditDrink:r,isCurrentDate:o})=>{const[l,c]=f.useState(null),m=(h,p)=>{c({index:h,drink:p})},u=h=>{l&&(r(l.index,h),c(null))};return e.jsxs("div",{children:[e.jsxs(z,{variant:"outline",className:"w-full",onClick:n,children:[s?e.jsx(Xi,{className:"w-4 h-4 mr-2"}):e.jsx(_n,{className:"w-4 h-4 mr-2"}),"Historial de hoy"]}),s&&t.length>0&&e.jsx("div",{className:"mt-4 space-y-2",children:t.map((h,p)=>{const g=Wn[h.type],x=Ni[g.icon];return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-muted rounded-lg",children:[e.jsx(x,{className:`w-5 h-5 ${g.color} flex-shrink-0`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"font-medium text-sm",children:g.name}),e.jsxs("span",{className:"text-muted-foreground text-sm font-medium",children:[h.amount,"ml"]})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:h.time})]}),o&&e.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[e.jsx(z,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-accent-foreground/10 touch-manipulation",onClick:()=>m(p,h),title:"Editar",children:e.jsx(Su,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx(z,{variant:"ghost",size:"icon",className:"h-8 w-8 hover:bg-destructive/10 touch-manipulation",onClick:()=>a(p),title:"Eliminar",children:e.jsx(Zi,{className:"h-4 w-4 text-destructive"})})]})]},h.timestamp)})}),s&&t.length===0&&e.jsxs("div",{className:"mt-4 text-center text-muted-foreground text-sm py-4",children:[" ","No hay registros para este día"]}),e.jsx(a5,{drink:(l==null?void 0:l.drink)||null,isOpen:!!l,onClose:()=>c(null),onSave:u})]})};var Ze=function(){return Ze=Object.assign||function(s){for(var n,a=1,r=arguments.length;a<r;a++){n=arguments[a];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(s[o]=n[o])}return s},Ze.apply(this,arguments)};function i5(t,s){var n={};for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&s.indexOf(a)<0&&(n[a]=t[a]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,a=Object.getOwnPropertySymbols(t);r<a.length;r++)s.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(t,a[r])&&(n[a[r]]=t[a[r]]);return n}function Lw(t,s,n){for(var a=0,r=s.length,o;a<r;a++)(o||!(a in s))&&(o||(o=Array.prototype.slice.call(s,0,a)),o[a]=s[a]);return t.concat(o||Array.prototype.slice.call(s))}function Tc(t){return t.mode==="multiple"}function Dc(t){return t.mode==="range"}function zu(t){return t.mode==="single"}var o5={root:"rdp",multiple_months:"rdp-multiple_months",with_weeknumber:"rdp-with_weeknumber",vhidden:"rdp-vhidden",button_reset:"rdp-button_reset",button:"rdp-button",caption:"rdp-caption",caption_start:"rdp-caption_start",caption_end:"rdp-caption_end",caption_between:"rdp-caption_between",caption_label:"rdp-caption_label",caption_dropdowns:"rdp-caption_dropdowns",dropdown:"rdp-dropdown",dropdown_month:"rdp-dropdown_month",dropdown_year:"rdp-dropdown_year",dropdown_icon:"rdp-dropdown_icon",months:"rdp-months",month:"rdp-month",table:"rdp-table",tbody:"rdp-tbody",tfoot:"rdp-tfoot",head:"rdp-head",head_row:"rdp-head_row",head_cell:"rdp-head_cell",nav:"rdp-nav",nav_button:"rdp-nav_button",nav_button_previous:"rdp-nav_button_previous",nav_button_next:"rdp-nav_button_next",nav_icon:"rdp-nav_icon",row:"rdp-row",weeknumber:"rdp-weeknumber",cell:"rdp-cell",day:"rdp-day",day_today:"rdp-day_today",day_outside:"rdp-day_outside",day_selected:"rdp-day_selected",day_disabled:"rdp-day_disabled",day_hidden:"rdp-day_hidden",day_range_start:"rdp-day_range_start",day_range_end:"rdp-day_range_end",day_range_middle:"rdp-day_range_middle"};function l5(t,s){return at(t,"LLLL y",s)}function c5(t,s){return at(t,"d",s)}function d5(t,s){return at(t,"LLLL",s)}function u5(t){return"".concat(t)}function m5(t,s){return at(t,"cccccc",s)}function h5(t,s){return at(t,"yyyy",s)}var f5=Object.freeze({__proto__:null,formatCaption:l5,formatDay:c5,formatMonthCaption:d5,formatWeekNumber:u5,formatWeekdayName:m5,formatYearCaption:h5}),p5=function(t,s,n){return at(t,"do MMMM (EEEE)",n)},x5=function(){return"Month: "},g5=function(){return"Go to next month"},v5=function(){return"Go to previous month"},y5=function(t,s){return at(t,"cccc",s)},b5=function(t){return"Week n. ".concat(t)},j5=function(){return"Year: "},w5=Object.freeze({__proto__:null,labelDay:p5,labelMonthDropdown:x5,labelNext:g5,labelPrevious:v5,labelWeekNumber:b5,labelWeekday:y5,labelYearDropdown:j5});function N5(){var t="buttons",s=o5,n=BA,a={},r={},o=1,l={},c=new Date;return{captionLayout:t,classNames:s,formatters:f5,labels:w5,locale:n,modifiersClassNames:a,modifiers:r,numberOfMonths:o,styles:l,today:c,mode:"default"}}function S5(t){var s=t.fromYear,n=t.toYear,a=t.fromMonth,r=t.toMonth,o=t.fromDate,l=t.toDate;return a?o=ts(a):s&&(o=new Date(s,0,1)),r?l=ea(r):n&&(l=new Date(n,11,31)),{fromDate:o?cs(o):void 0,toDate:l?cs(l):void 0}}var $w=f.createContext(void 0);function C5(t){var s,n=t.initialProps,a=N5(),r=S5(n),o=r.fromDate,l=r.toDate,c=(s=n.captionLayout)!==null&&s!==void 0?s:a.captionLayout;c!=="buttons"&&(!o||!l)&&(c="buttons");var m;(zu(n)||Tc(n)||Dc(n))&&(m=n.onSelect);var u=Ze(Ze(Ze({},a),n),{captionLayout:c,classNames:Ze(Ze({},a.classNames),n.classNames),components:Ze({},n.components),formatters:Ze(Ze({},a.formatters),n.formatters),fromDate:o,labels:Ze(Ze({},a.labels),n.labels),mode:n.mode||a.mode,modifiers:Ze(Ze({},a.modifiers),n.modifiers),modifiersClassNames:Ze(Ze({},a.modifiersClassNames),n.modifiersClassNames),onSelect:m,styles:Ze(Ze({},a.styles),n.styles),toDate:l});return e.jsx($w.Provider,{value:u,children:t.children})}function fs(){var t=f.useContext($w);if(!t)throw new Error("useDayPicker must be used within a DayPickerProvider.");return t}function zw(t){var s=fs(),n=s.locale,a=s.classNames,r=s.styles,o=s.formatters.formatCaption;return e.jsx("div",{className:a.caption_label,style:r.caption_label,"aria-live":"polite",role:"presentation",id:t.id,children:o(t.displayMonth,{locale:n})})}function E5(t){return e.jsx("svg",Ze({width:"8px",height:"8px",viewBox:"0 0 120 120","data-testid":"iconDropdown"},t,{children:e.jsx("path",{d:"M4.22182541,48.2218254 C8.44222828,44.0014225 15.2388494,43.9273804 19.5496459,47.9996989 L19.7781746,48.2218254 L60,88.443 L100.221825,48.2218254 C104.442228,44.0014225 111.238849,43.9273804 115.549646,47.9996989 L115.778175,48.2218254 C119.998577,52.4422283 120.07262,59.2388494 116.000301,63.5496459 L115.778175,63.7781746 L67.7781746,111.778175 C63.5577717,115.998577 56.7611506,116.07262 52.4503541,112.000301 L52.2218254,111.778175 L4.22182541,63.7781746 C-0.0739418023,59.4824074 -0.0739418023,52.5175926 4.22182541,48.2218254 Z",fill:"currentColor",fillRule:"nonzero"})}))}function Fw(t){var s,n,a=t.onChange,r=t.value,o=t.children,l=t.caption,c=t.className,m=t.style,u=fs(),h=(n=(s=u.components)===null||s===void 0?void 0:s.IconDropdown)!==null&&n!==void 0?n:E5;return e.jsxs("div",{className:c,style:m,children:[e.jsx("span",{className:u.classNames.vhidden,children:t["aria-label"]}),e.jsx("select",{name:t.name,"aria-label":t["aria-label"],className:u.classNames.dropdown,style:u.styles.dropdown,value:r,onChange:a,children:o}),e.jsxs("div",{className:u.classNames.caption_label,style:u.styles.caption_label,"aria-hidden":"true",children:[l,e.jsx(h,{className:u.classNames.dropdown_icon,style:u.styles.dropdown_icon})]})]})}function T5(t){var s,n=fs(),a=n.fromDate,r=n.toDate,o=n.styles,l=n.locale,c=n.formatters.formatMonthCaption,m=n.classNames,u=n.components,h=n.labels.labelMonthDropdown;if(!a)return e.jsx(e.Fragment,{});if(!r)return e.jsx(e.Fragment,{});var p=[];if(qA(a,r))for(var g=ts(a),x=a.getMonth();x<=r.getMonth();x++)p.push(dh(g,x));else for(var g=ts(new Date),x=0;x<=11;x++)p.push(dh(g,x));var b=function(v){var w=Number(v.target.value),N=dh(ts(t.displayMonth),w);t.onChange(N)},j=(s=u==null?void 0:u.Dropdown)!==null&&s!==void 0?s:Fw;return e.jsx(j,{name:"months","aria-label":h(),className:m.dropdown_month,style:o.dropdown_month,onChange:b,value:t.displayMonth.getMonth(),caption:c(t.displayMonth,{locale:l}),children:p.map(function(v){return e.jsx("option",{value:v.getMonth(),children:c(v,{locale:l})},v.getMonth())})})}function D5(t){var s,n=t.displayMonth,a=fs(),r=a.fromDate,o=a.toDate,l=a.locale,c=a.styles,m=a.classNames,u=a.components,h=a.formatters.formatYearCaption,p=a.labels.labelYearDropdown,g=[];if(!r)return e.jsx(e.Fragment,{});if(!o)return e.jsx(e.Fragment,{});for(var x=r.getFullYear(),b=o.getFullYear(),j=x;j<=b;j++)g.push(I0(Bh(new Date),j));var v=function(N){var S=I0(ts(n),Number(N.target.value));t.onChange(S)},w=(s=u==null?void 0:u.Dropdown)!==null&&s!==void 0?s:Fw;return e.jsx(w,{name:"years","aria-label":p(),className:m.dropdown_year,style:c.dropdown_year,onChange:v,value:n.getFullYear(),caption:h(n,{locale:l}),children:g.map(function(N){return e.jsx("option",{value:N.getFullYear(),children:h(N,{locale:l})},N.getFullYear())})})}function k5(t,s){var n=f.useState(t),a=n[0],r=n[1],o=s===void 0?a:s;return[o,r]}function A5(t){var s=t.month,n=t.defaultMonth,a=t.today,r=s||n||a||new Date,o=t.toDate,l=t.fromDate,c=t.numberOfMonths,m=c===void 0?1:c;if(o&&nc(o,r)<0){var u=-1*(m-1);r=$a(o,u)}return l&&nc(r,l)<0&&(r=l),ts(r)}function R5(){var t=fs(),s=A5(t),n=k5(s,t.month),a=n[0],r=n[1],o=function(l){var c;if(!t.disableNavigation){var m=ts(l);r(m),(c=t.onMonthChange)===null||c===void 0||c.call(t,m)}};return[a,o]}function _5(t,s){for(var n=s.reverseMonths,a=s.numberOfMonths,r=ts(t),o=ts($a(r,a)),l=nc(o,r),c=[],m=0;m<l;m++){var u=$a(r,m);c.push(u)}return n&&(c=c.reverse()),c}function P5(t,s){if(!s.disableNavigation){var n=s.toDate,a=s.pagedNavigation,r=s.numberOfMonths,o=r===void 0?1:r,l=a?o:1,c=ts(t);if(!n)return $a(c,l);var m=nc(n,t);if(!(m<o))return $a(c,l)}}function M5(t,s){if(!s.disableNavigation){var n=s.fromDate,a=s.pagedNavigation,r=s.numberOfMonths,o=r===void 0?1:r,l=a?o:1,c=ts(t);if(!n)return $a(c,-l);var m=nc(c,n);if(!(m<=0))return $a(c,-l)}}var Bw=f.createContext(void 0);function I5(t){var s=fs(),n=R5(),a=n[0],r=n[1],o=_5(a,s),l=P5(a,s),c=M5(a,s),m=function(p){return o.some(function(g){return Of(p,g)})},u=function(p,g){m(p)||(g&&Ds(p,g)?r($a(p,1+s.numberOfMonths*-1)):r(p))},h={currentMonth:a,displayMonths:o,goToMonth:r,goToDate:u,previousMonth:c,nextMonth:l,isDateDisplayed:m};return e.jsx(Bw.Provider,{value:h,children:t.children})}function kc(){var t=f.useContext(Bw);if(!t)throw new Error("useNavigation must be used within a NavigationProvider");return t}function Ev(t){var s,n=fs(),a=n.classNames,r=n.styles,o=n.components,l=kc().goToMonth,c=function(h){l($a(h,t.displayIndex?-t.displayIndex:0))},m=(s=o==null?void 0:o.CaptionLabel)!==null&&s!==void 0?s:zw,u=e.jsx(m,{id:t.id,displayMonth:t.displayMonth});return e.jsxs("div",{className:a.caption_dropdowns,style:r.caption_dropdowns,children:[e.jsx("div",{className:a.vhidden,children:u}),e.jsx(T5,{onChange:c,displayMonth:t.displayMonth}),e.jsx(D5,{onChange:c,displayMonth:t.displayMonth})]})}function O5(t){return e.jsx("svg",Ze({width:"16px",height:"16px",viewBox:"0 0 120 120"},t,{children:e.jsx("path",{d:"M69.490332,3.34314575 C72.6145263,0.218951416 77.6798462,0.218951416 80.8040405,3.34314575 C83.8617626,6.40086786 83.9268205,11.3179931 80.9992143,14.4548388 L80.8040405,14.6568542 L35.461,60 L80.8040405,105.343146 C83.8617626,108.400868 83.9268205,113.317993 80.9992143,116.454839 L80.8040405,116.656854 C77.7463184,119.714576 72.8291931,119.779634 69.6923475,116.852028 L69.490332,116.656854 L18.490332,65.6568542 C15.4326099,62.5991321 15.367552,57.6820069 18.2951583,54.5451612 L18.490332,54.3431458 L69.490332,3.34314575 Z",fill:"currentColor",fillRule:"nonzero"})}))}function L5(t){return e.jsx("svg",Ze({width:"16px",height:"16px",viewBox:"0 0 120 120"},t,{children:e.jsx("path",{d:"M49.8040405,3.34314575 C46.6798462,0.218951416 41.6145263,0.218951416 38.490332,3.34314575 C35.4326099,6.40086786 35.367552,11.3179931 38.2951583,14.4548388 L38.490332,14.6568542 L83.8333725,60 L38.490332,105.343146 C35.4326099,108.400868 35.367552,113.317993 38.2951583,116.454839 L38.490332,116.656854 C41.5480541,119.714576 46.4651794,119.779634 49.602025,116.852028 L49.8040405,116.656854 L100.804041,65.6568542 C103.861763,62.5991321 103.926821,57.6820069 100.999214,54.5451612 L100.804041,54.3431458 L49.8040405,3.34314575 Z",fill:"currentColor"})}))}var lu=f.forwardRef(function(t,s){var n=fs(),a=n.classNames,r=n.styles,o=[a.button_reset,a.button];t.className&&o.push(t.className);var l=o.join(" "),c=Ze(Ze({},r.button_reset),r.button);return t.style&&Object.assign(c,t.style),e.jsx("button",Ze({},t,{ref:s,type:"button",className:l,style:c}))});function $5(t){var s,n,a=fs(),r=a.dir,o=a.locale,l=a.classNames,c=a.styles,m=a.labels,u=m.labelPrevious,h=m.labelNext,p=a.components;if(!t.nextMonth&&!t.previousMonth)return e.jsx(e.Fragment,{});var g=u(t.previousMonth,{locale:o}),x=[l.nav_button,l.nav_button_previous].join(" "),b=h(t.nextMonth,{locale:o}),j=[l.nav_button,l.nav_button_next].join(" "),v=(s=p==null?void 0:p.IconRight)!==null&&s!==void 0?s:L5,w=(n=p==null?void 0:p.IconLeft)!==null&&n!==void 0?n:O5;return e.jsxs("div",{className:l.nav,style:c.nav,children:[!t.hidePrevious&&e.jsx(lu,{name:"previous-month","aria-label":g,className:x,style:c.nav_button_previous,disabled:!t.previousMonth,onClick:t.onPreviousClick,children:r==="rtl"?e.jsx(v,{className:l.nav_icon,style:c.nav_icon}):e.jsx(w,{className:l.nav_icon,style:c.nav_icon})}),!t.hideNext&&e.jsx(lu,{name:"next-month","aria-label":b,className:j,style:c.nav_button_next,disabled:!t.nextMonth,onClick:t.onNextClick,children:r==="rtl"?e.jsx(w,{className:l.nav_icon,style:c.nav_icon}):e.jsx(v,{className:l.nav_icon,style:c.nav_icon})})]})}function Tv(t){var s=fs().numberOfMonths,n=kc(),a=n.previousMonth,r=n.nextMonth,o=n.goToMonth,l=n.displayMonths,c=l.findIndex(function(b){return Of(t.displayMonth,b)}),m=c===0,u=c===l.length-1,h=s>1&&(m||!u),p=s>1&&(u||!m),g=function(){a&&o(a)},x=function(){r&&o(r)};return e.jsx($5,{displayMonth:t.displayMonth,hideNext:h,hidePrevious:p,nextMonth:r,previousMonth:a,onPreviousClick:g,onNextClick:x})}function z5(t){var s,n=fs(),a=n.classNames,r=n.disableNavigation,o=n.styles,l=n.captionLayout,c=n.components,m=(s=c==null?void 0:c.CaptionLabel)!==null&&s!==void 0?s:zw,u;return r?u=e.jsx(m,{id:t.id,displayMonth:t.displayMonth}):l==="dropdown"?u=e.jsx(Ev,{displayMonth:t.displayMonth,id:t.id}):l==="dropdown-buttons"?u=e.jsxs(e.Fragment,{children:[e.jsx(Ev,{displayMonth:t.displayMonth,displayIndex:t.displayIndex,id:t.id}),e.jsx(Tv,{displayMonth:t.displayMonth,displayIndex:t.displayIndex,id:t.id})]}):u=e.jsxs(e.Fragment,{children:[e.jsx(m,{id:t.id,displayMonth:t.displayMonth,displayIndex:t.displayIndex}),e.jsx(Tv,{displayMonth:t.displayMonth,id:t.id})]}),e.jsx("div",{className:a.caption,style:o.caption,children:u})}function F5(t){var s=fs(),n=s.footer,a=s.styles,r=s.classNames.tfoot;return n?e.jsx("tfoot",{className:r,style:a.tfoot,children:e.jsx("tr",{children:e.jsx("td",{colSpan:8,children:n})})}):e.jsx(e.Fragment,{})}function B5(t,s,n){for(var a=n?Lf(new Date):ar(new Date,{locale:t,weekStartsOn:s}),r=[],o=0;o<7;o++){var l=es(a,o);r.push(l)}return r}function H5(){var t=fs(),s=t.classNames,n=t.styles,a=t.showWeekNumber,r=t.locale,o=t.weekStartsOn,l=t.ISOWeek,c=t.formatters.formatWeekdayName,m=t.labels.labelWeekday,u=B5(r,o,l);return e.jsxs("tr",{style:n.head_row,className:s.head_row,children:[a&&e.jsx("td",{style:n.head_cell,className:s.head_cell}),u.map(function(h,p){return e.jsx("th",{scope:"col",className:s.head_cell,style:n.head_cell,"aria-label":m(h,{locale:r}),children:c(h,{locale:r})},p)})]})}function W5(){var t,s=fs(),n=s.classNames,a=s.styles,r=s.components,o=(t=r==null?void 0:r.HeadRow)!==null&&t!==void 0?t:H5;return e.jsx("thead",{style:a.head,className:n.head,children:e.jsx(o,{})})}function U5(t){var s=fs(),n=s.locale,a=s.formatters.formatDay;return e.jsx(e.Fragment,{children:a(t.date,{locale:n})})}var gp=f.createContext(void 0);function V5(t){if(!Tc(t.initialProps)){var s={selected:void 0,modifiers:{disabled:[]}};return e.jsx(gp.Provider,{value:s,children:t.children})}return e.jsx(G5,{initialProps:t.initialProps,children:t.children})}function G5(t){var s=t.initialProps,n=t.children,a=s.selected,r=s.min,o=s.max,l=function(u,h,p){var g,x;(g=s.onDayClick)===null||g===void 0||g.call(s,u,h,p);var b=!!(h.selected&&r&&(a==null?void 0:a.length)===r);if(!b){var j=!!(!h.selected&&o&&(a==null?void 0:a.length)===o);if(!j){var v=a?Lw([],a):[];if(h.selected){var w=v.findIndex(function(N){return sn(u,N)});v.splice(w,1)}else v.push(u);(x=s.onSelect)===null||x===void 0||x.call(s,v,u,h,p)}}},c={disabled:[]};a&&c.disabled.push(function(u){var h=o&&a.length>o-1,p=a.some(function(g){return sn(g,u)});return!!(h&&!p)});var m={selected:a,onDayClick:l,modifiers:c};return e.jsx(gp.Provider,{value:m,children:n})}function vp(){var t=f.useContext(gp);if(!t)throw new Error("useSelectMultiple must be used within a SelectMultipleProvider");return t}function q5(t,s){var n=s||{},a=n.from,r=n.to;return a&&r?sn(r,t)&&sn(a,t)?void 0:sn(r,t)?{from:r,to:void 0}:sn(a,t)?void 0:Gd(a,t)?{from:t,to:r}:{from:a,to:t}:r?Gd(t,r)?{from:r,to:t}:{from:t,to:r}:a?Ds(t,a)?{from:t,to:a}:{from:a,to:t}:{from:t,to:void 0}}var yp=f.createContext(void 0);function Y5(t){if(!Dc(t.initialProps)){var s={selected:void 0,modifiers:{range_start:[],range_end:[],range_middle:[],disabled:[]}};return e.jsx(yp.Provider,{value:s,children:t.children})}return e.jsx(K5,{initialProps:t.initialProps,children:t.children})}function K5(t){var s=t.initialProps,n=t.children,a=s.selected,r=a||{},o=r.from,l=r.to,c=s.min,m=s.max,u=function(x,b,j){var v,w;(v=s.onDayClick)===null||v===void 0||v.call(s,x,b,j);var N=q5(x,a);(w=s.onSelect)===null||w===void 0||w.call(s,N,x,b,j)},h={range_start:[],range_end:[],range_middle:[],disabled:[]};if(o?(h.range_start=[o],l?(h.range_end=[l],sn(o,l)||(h.range_middle=[{after:o,before:l}])):h.range_end=[o]):l&&(h.range_start=[l],h.range_end=[l]),c&&(o&&!l&&h.disabled.push({after:Vl(o,c-1),before:es(o,c-1)}),o&&l&&h.disabled.push({after:o,before:es(o,c-1)}),!o&&l&&h.disabled.push({after:Vl(l,c-1),before:es(l,c-1)})),m){if(o&&!l&&(h.disabled.push({before:es(o,-m+1)}),h.disabled.push({after:es(o,m-1)})),o&&l){var p=Ir(l,o)+1,g=m-p;h.disabled.push({before:Vl(o,g)}),h.disabled.push({after:es(l,g)})}!o&&l&&(h.disabled.push({before:es(l,-m+1)}),h.disabled.push({after:es(l,m-1)}))}return e.jsx(yp.Provider,{value:{selected:a,onDayClick:u,modifiers:h},children:n})}function bp(){var t=f.useContext(yp);if(!t)throw new Error("useSelectRange must be used within a SelectRangeProvider");return t}function Bd(t){return Array.isArray(t)?Lw([],t):t!==void 0?[t]:[]}function J5(t){var s={};return Object.entries(t).forEach(function(n){var a=n[0],r=n[1];s[a]=Bd(r)}),s}var Fa;(function(t){t.Outside="outside",t.Disabled="disabled",t.Selected="selected",t.Hidden="hidden",t.Today="today",t.RangeStart="range_start",t.RangeEnd="range_end",t.RangeMiddle="range_middle"})(Fa||(Fa={}));var X5=Fa.Selected,kr=Fa.Disabled,Z5=Fa.Hidden,Q5=Fa.Today,bh=Fa.RangeEnd,jh=Fa.RangeMiddle,wh=Fa.RangeStart,e3=Fa.Outside;function t3(t,s,n){var a,r=(a={},a[X5]=Bd(t.selected),a[kr]=Bd(t.disabled),a[Z5]=Bd(t.hidden),a[Q5]=[t.today],a[bh]=[],a[jh]=[],a[wh]=[],a[e3]=[],a);return t.fromDate&&r[kr].push({before:t.fromDate}),t.toDate&&r[kr].push({after:t.toDate}),Tc(t)?r[kr]=r[kr].concat(s.modifiers[kr]):Dc(t)&&(r[kr]=r[kr].concat(n.modifiers[kr]),r[wh]=n.modifiers[wh],r[jh]=n.modifiers[jh],r[bh]=n.modifiers[bh]),r}var Hw=f.createContext(void 0);function s3(t){var s=fs(),n=vp(),a=bp(),r=t3(s,n,a),o=J5(s.modifiers),l=Ze(Ze({},r),o);return e.jsx(Hw.Provider,{value:l,children:t.children})}function Ww(){var t=f.useContext(Hw);if(!t)throw new Error("useModifiers must be used within a ModifiersProvider");return t}function n3(t){return!!(t&&typeof t=="object"&&"before"in t&&"after"in t)}function a3(t){return!!(t&&typeof t=="object"&&"from"in t)}function r3(t){return!!(t&&typeof t=="object"&&"after"in t)}function i3(t){return!!(t&&typeof t=="object"&&"before"in t)}function o3(t){return!!(t&&typeof t=="object"&&"dayOfWeek"in t)}function l3(t,s){var n,a=s.from,r=s.to;if(a&&r){var o=Ir(r,a)<0;o&&(n=[r,a],a=n[0],r=n[1]);var l=Ir(t,a)>=0&&Ir(r,t)>=0;return l}return r?sn(r,t):a?sn(a,t):!1}function c3(t){return lb(t)}function d3(t){return Array.isArray(t)&&t.every(lb)}function u3(t,s){return s.some(function(n){if(typeof n=="boolean")return n;if(c3(n))return sn(t,n);if(d3(n))return n.includes(t);if(a3(n))return l3(t,n);if(o3(n))return n.dayOfWeek.includes(t.getDay());if(n3(n)){var a=Ir(n.before,t),r=Ir(n.after,t),o=a>0,l=r<0,c=Gd(n.before,n.after);return c?l&&o:o||l}return r3(n)?Ir(t,n.after)>0:i3(n)?Ir(n.before,t)>0:typeof n=="function"?n(t):!1})}function jp(t,s,n){var a=Object.keys(s).reduce(function(o,l){var c=s[l];return u3(t,c)&&o.push(l),o},[]),r={};return a.forEach(function(o){return r[o]=!0}),n&&!Of(t,n)&&(r.outside=!0),r}function m3(t,s){for(var n=ts(t[0]),a=ea(t[t.length-1]),r,o,l=n;l<=a;){var c=jp(l,s),m=!c.disabled&&!c.hidden;if(!m){l=es(l,1);continue}if(c.selected)return l;c.today&&!o&&(o=l),r||(r=l),l=es(l,1)}return o||r}var h3=365;function Uw(t,s){var n=s.moveBy,a=s.direction,r=s.context,o=s.modifiers,l=s.retry,c=l===void 0?{count:0,lastFocused:t}:l,m=r.weekStartsOn,u=r.fromDate,h=r.toDate,p=r.locale,g={day:es,week:sc,month:$a,year:UA,startOfWeek:function(v){return r.ISOWeek?Lf(v):ar(v,{locale:p,weekStartsOn:m})},endOfWeek:function(v){return r.ISOWeek?ob(v):ha(v,{locale:p,weekStartsOn:m})}},x=g[n](t,a==="after"?1:-1);a==="before"&&u?x=VA([u,x]):a==="after"&&h&&(x=GA([h,x]));var b=!0;if(o){var j=jp(x,o);b=!j.disabled&&!j.hidden}return b?x:c.count>h3?c.lastFocused:Uw(x,{moveBy:n,direction:a,context:r,modifiers:o,retry:Ze(Ze({},c),{count:c.count+1})})}var Vw=f.createContext(void 0);function f3(t){var s=kc(),n=Ww(),a=f.useState(),r=a[0],o=a[1],l=f.useState(),c=l[0],m=l[1],u=m3(s.displayMonths,n),h=r??(c&&s.isDateDisplayed(c))?c:u,p=function(){m(r),o(void 0)},g=function(v){o(v)},x=fs(),b=function(v,w){if(r){var N=Uw(r,{moveBy:v,direction:w,context:x,modifiers:n});sn(r,N)||(s.goToDate(N,r),g(N))}},j={focusedDay:r,focusTarget:h,blur:p,focus:g,focusDayAfter:function(){return b("day","after")},focusDayBefore:function(){return b("day","before")},focusWeekAfter:function(){return b("week","after")},focusWeekBefore:function(){return b("week","before")},focusMonthBefore:function(){return b("month","before")},focusMonthAfter:function(){return b("month","after")},focusYearBefore:function(){return b("year","before")},focusYearAfter:function(){return b("year","after")},focusStartOfWeek:function(){return b("startOfWeek","before")},focusEndOfWeek:function(){return b("endOfWeek","after")}};return e.jsx(Vw.Provider,{value:j,children:t.children})}function wp(){var t=f.useContext(Vw);if(!t)throw new Error("useFocusContext must be used within a FocusProvider");return t}function p3(t,s){var n=Ww(),a=jp(t,n,s);return a}var Np=f.createContext(void 0);function x3(t){if(!zu(t.initialProps)){var s={selected:void 0};return e.jsx(Np.Provider,{value:s,children:t.children})}return e.jsx(g3,{initialProps:t.initialProps,children:t.children})}function g3(t){var s=t.initialProps,n=t.children,a=function(o,l,c){var m,u,h;if((m=s.onDayClick)===null||m===void 0||m.call(s,o,l,c),l.selected&&!s.required){(u=s.onSelect)===null||u===void 0||u.call(s,void 0,o,l,c);return}(h=s.onSelect)===null||h===void 0||h.call(s,o,o,l,c)},r={selected:s.selected,onDayClick:a};return e.jsx(Np.Provider,{value:r,children:n})}function Gw(){var t=f.useContext(Np);if(!t)throw new Error("useSelectSingle must be used within a SelectSingleProvider");return t}function v3(t,s){var n=fs(),a=Gw(),r=vp(),o=bp(),l=wp(),c=l.focusDayAfter,m=l.focusDayBefore,u=l.focusWeekAfter,h=l.focusWeekBefore,p=l.blur,g=l.focus,x=l.focusMonthBefore,b=l.focusMonthAfter,j=l.focusYearBefore,v=l.focusYearAfter,w=l.focusStartOfWeek,N=l.focusEndOfWeek,S=function($){var q,re,Y,se;zu(n)?(q=a.onDayClick)===null||q===void 0||q.call(a,t,s,$):Tc(n)?(re=r.onDayClick)===null||re===void 0||re.call(r,t,s,$):Dc(n)?(Y=o.onDayClick)===null||Y===void 0||Y.call(o,t,s,$):(se=n.onDayClick)===null||se===void 0||se.call(n,t,s,$)},E=function($){var q;g(t),(q=n.onDayFocus)===null||q===void 0||q.call(n,t,s,$)},T=function($){var q;p(),(q=n.onDayBlur)===null||q===void 0||q.call(n,t,s,$)},k=function($){var q;(q=n.onDayMouseEnter)===null||q===void 0||q.call(n,t,s,$)},D=function($){var q;(q=n.onDayMouseLeave)===null||q===void 0||q.call(n,t,s,$)},P=function($){var q;(q=n.onDayPointerEnter)===null||q===void 0||q.call(n,t,s,$)},_=function($){var q;(q=n.onDayPointerLeave)===null||q===void 0||q.call(n,t,s,$)},B=function($){var q;(q=n.onDayTouchCancel)===null||q===void 0||q.call(n,t,s,$)},I=function($){var q;(q=n.onDayTouchEnd)===null||q===void 0||q.call(n,t,s,$)},R=function($){var q;(q=n.onDayTouchMove)===null||q===void 0||q.call(n,t,s,$)},M=function($){var q;(q=n.onDayTouchStart)===null||q===void 0||q.call(n,t,s,$)},W=function($){var q;(q=n.onDayKeyUp)===null||q===void 0||q.call(n,t,s,$)},H=function($){var q;switch($.key){case"ArrowLeft":$.preventDefault(),$.stopPropagation(),n.dir==="rtl"?c():m();break;case"ArrowRight":$.preventDefault(),$.stopPropagation(),n.dir==="rtl"?m():c();break;case"ArrowDown":$.preventDefault(),$.stopPropagation(),u();break;case"ArrowUp":$.preventDefault(),$.stopPropagation(),h();break;case"PageUp":$.preventDefault(),$.stopPropagation(),$.shiftKey?j():x();break;case"PageDown":$.preventDefault(),$.stopPropagation(),$.shiftKey?v():b();break;case"Home":$.preventDefault(),$.stopPropagation(),w();break;case"End":$.preventDefault(),$.stopPropagation(),N();break}(q=n.onDayKeyDown)===null||q===void 0||q.call(n,t,s,$)},L={onClick:S,onFocus:E,onBlur:T,onKeyDown:H,onKeyUp:W,onMouseEnter:k,onMouseLeave:D,onPointerEnter:P,onPointerLeave:_,onTouchCancel:B,onTouchEnd:I,onTouchMove:R,onTouchStart:M};return L}function y3(){var t=fs(),s=Gw(),n=vp(),a=bp(),r=zu(t)?s.selected:Tc(t)?n.selected:Dc(t)?a.selected:void 0;return r}function b3(t){return Object.values(Fa).includes(t)}function j3(t,s){var n=[t.classNames.day];return Object.keys(s).forEach(function(a){var r=t.modifiersClassNames[a];if(r)n.push(r);else if(b3(a)){var o=t.classNames["day_".concat(a)];o&&n.push(o)}}),n}function w3(t,s){var n=Ze({},t.styles.day);return Object.keys(s).forEach(function(a){var r;n=Ze(Ze({},n),(r=t.modifiersStyles)===null||r===void 0?void 0:r[a])}),n}function N3(t,s,n){var a,r,o,l=fs(),c=wp(),m=p3(t,s),u=v3(t,m),h=y3(),p=!!(l.onDayClick||l.mode!=="default");f.useEffect(function(){var k;m.outside||c.focusedDay&&p&&sn(c.focusedDay,t)&&((k=n.current)===null||k===void 0||k.focus())},[c.focusedDay,t,n,p,m.outside]);var g=j3(l,m).join(" "),x=w3(l,m),b=!!(m.outside&&!l.showOutsideDays||m.hidden),j=(o=(r=l.components)===null||r===void 0?void 0:r.DayContent)!==null&&o!==void 0?o:U5,v=e.jsx(j,{date:t,displayMonth:s,activeModifiers:m}),w={style:x,className:g,children:v,role:"gridcell"},N=c.focusTarget&&sn(c.focusTarget,t)&&!m.outside,S=c.focusedDay&&sn(c.focusedDay,t),E=Ze(Ze(Ze({},w),(a={disabled:m.disabled,role:"gridcell"},a["aria-selected"]=m.selected,a.tabIndex=S||N?0:-1,a)),u),T={isButton:p,isHidden:b,activeModifiers:m,selectedDays:h,buttonProps:E,divProps:w};return T}function S3(t){var s=f.useRef(null),n=N3(t.date,t.displayMonth,s);return n.isHidden?e.jsx("div",{role:"gridcell"}):n.isButton?e.jsx(lu,Ze({name:"day",ref:s},n.buttonProps)):e.jsx("div",Ze({},n.divProps))}function C3(t){var s=t.number,n=t.dates,a=fs(),r=a.onWeekNumberClick,o=a.styles,l=a.classNames,c=a.locale,m=a.labels.labelWeekNumber,u=a.formatters.formatWeekNumber,h=u(Number(s),{locale:c});if(!r)return e.jsx("span",{className:l.weeknumber,style:o.weeknumber,children:h});var p=m(Number(s),{locale:c}),g=function(x){r(s,n,x)};return e.jsx(lu,{name:"week-number","aria-label":p,className:l.weeknumber,style:o.weeknumber,onClick:g,children:h})}function E3(t){var s,n,a=fs(),r=a.styles,o=a.classNames,l=a.showWeekNumber,c=a.components,m=(s=c==null?void 0:c.Day)!==null&&s!==void 0?s:S3,u=(n=c==null?void 0:c.WeekNumber)!==null&&n!==void 0?n:C3,h;return l&&(h=e.jsx("td",{className:o.cell,style:r.cell,children:e.jsx(u,{number:t.weekNumber,dates:t.dates})})),e.jsxs("tr",{className:o.row,style:r.row,children:[h,t.dates.map(function(p){return e.jsx("td",{className:o.cell,style:r.cell,role:"presentation",children:e.jsx(m,{displayMonth:t.displayMonth,date:p})},WA(p))})]})}function Dv(t,s,n){for(var a=n!=null&&n.ISOWeek?ob(s):ha(s,n),r=n!=null&&n.ISOWeek?Lf(t):ar(t,n),o=Ir(a,r),l=[],c=0;c<=o;c++)l.push(es(r,c));var m=l.reduce(function(u,h){var p=n!=null&&n.ISOWeek?YA(h):KA(h,n),g=u.find(function(x){return x.weekNumber===p});return g?(g.dates.push(h),u):(u.push({weekNumber:p,dates:[h]}),u)},[]);return m}function T3(t,s){var n=Dv(ts(t),ea(t),s);if(s!=null&&s.useFixedWeeks){var a=HA(t,s);if(a<6){var r=n[n.length-1],o=r.dates[r.dates.length-1],l=sc(o,6-a),c=Dv(sc(o,1),l,s);n.push.apply(n,c)}}return n}function D3(t){var s,n,a,r=fs(),o=r.locale,l=r.classNames,c=r.styles,m=r.hideHead,u=r.fixedWeeks,h=r.components,p=r.weekStartsOn,g=r.firstWeekContainsDate,x=r.ISOWeek,b=T3(t.displayMonth,{useFixedWeeks:!!u,ISOWeek:x,locale:o,weekStartsOn:p,firstWeekContainsDate:g}),j=(s=h==null?void 0:h.Head)!==null&&s!==void 0?s:W5,v=(n=h==null?void 0:h.Row)!==null&&n!==void 0?n:E3,w=(a=h==null?void 0:h.Footer)!==null&&a!==void 0?a:F5;return e.jsxs("table",{id:t.id,className:l.table,style:c.table,role:"grid","aria-labelledby":t["aria-labelledby"],children:[!m&&e.jsx(j,{}),e.jsx("tbody",{className:l.tbody,style:c.tbody,children:b.map(function(N){return e.jsx(v,{displayMonth:t.displayMonth,dates:N.dates,weekNumber:N.weekNumber},N.weekNumber)})}),e.jsx(w,{displayMonth:t.displayMonth})]})}function k3(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var A3=k3()?f.useLayoutEffect:f.useEffect,Nh=!1,R3=0;function kv(){return"react-day-picker-".concat(++R3)}function _3(t){var s,n=t??(Nh?kv():null),a=f.useState(n),r=a[0],o=a[1];return A3(function(){r===null&&o(kv())},[]),f.useEffect(function(){Nh===!1&&(Nh=!0)},[]),(s=t??r)!==null&&s!==void 0?s:void 0}function P3(t){var s,n,a=fs(),r=a.dir,o=a.classNames,l=a.styles,c=a.components,m=kc().displayMonths,u=_3(a.id?"".concat(a.id,"-").concat(t.displayIndex):void 0),h=a.id?"".concat(a.id,"-grid-").concat(t.displayIndex):void 0,p=[o.month],g=l.month,x=t.displayIndex===0,b=t.displayIndex===m.length-1,j=!x&&!b;r==="rtl"&&(s=[x,b],b=s[0],x=s[1]),x&&(p.push(o.caption_start),g=Ze(Ze({},g),l.caption_start)),b&&(p.push(o.caption_end),g=Ze(Ze({},g),l.caption_end)),j&&(p.push(o.caption_between),g=Ze(Ze({},g),l.caption_between));var v=(n=c==null?void 0:c.Caption)!==null&&n!==void 0?n:z5;return e.jsxs("div",{className:p.join(" "),style:g,children:[e.jsx(v,{id:u,displayMonth:t.displayMonth,displayIndex:t.displayIndex}),e.jsx(D3,{id:h,"aria-labelledby":u,displayMonth:t.displayMonth})]},t.displayIndex)}function M3(t){var s=fs(),n=s.classNames,a=s.styles;return e.jsx("div",{className:n.months,style:a.months,children:t.children})}function I3(t){var s,n,a=t.initialProps,r=fs(),o=wp(),l=kc(),c=f.useState(!1),m=c[0],u=c[1];f.useEffect(function(){r.initialFocus&&o.focusTarget&&(m||(o.focus(o.focusTarget),u(!0)))},[r.initialFocus,m,o.focus,o.focusTarget,o]);var h=[r.classNames.root,r.className];r.numberOfMonths>1&&h.push(r.classNames.multiple_months),r.showWeekNumber&&h.push(r.classNames.with_weeknumber);var p=Ze(Ze({},r.styles.root),r.style),g=Object.keys(a).filter(function(b){return b.startsWith("data-")}).reduce(function(b,j){var v;return Ze(Ze({},b),(v={},v[j]=a[j],v))},{}),x=(n=(s=a.components)===null||s===void 0?void 0:s.Months)!==null&&n!==void 0?n:M3;return e.jsx("div",Ze({className:h.join(" "),style:p,dir:r.dir,id:r.id,nonce:a.nonce,title:a.title,lang:a.lang},g,{children:e.jsx(x,{children:l.displayMonths.map(function(b,j){return e.jsx(P3,{displayIndex:j,displayMonth:b},j)})})}))}function O3(t){var s=t.children,n=i5(t,["children"]);return e.jsx(C5,{initialProps:n,children:e.jsx(I5,{children:e.jsx(x3,{initialProps:n,children:e.jsx(V5,{initialProps:n,children:e.jsx(Y5,{initialProps:n,children:e.jsx(s3,{children:e.jsx(f3,{children:s})})})})})})})}function L3(t){return e.jsx(O3,Ze({},t,{children:e.jsx(I3,{initialProps:t})}))}function Ac({className:t,classNames:s,showOutsideDays:n=!0,components:a,...r}){return e.jsx(L3,{showOutsideDays:n,className:ce("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:ce(dc({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:ce(dc({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...s},components:{IconLeft:()=>e.jsx(Bf,{className:"h-4 w-4"}),IconRight:()=>e.jsx(rr,{className:"h-4 w-4"}),...a},...r})}Ac.displayName="Calendar";const $3=({selectedDate:t,goal:s=2500})=>{const[n,a]=f.useState(ts(t));f.useEffect(()=>{a(ts(t))},[t]);const r=f.useMemo(()=>ts(n),[n]),o=f.useMemo(()=>ea(n),[n]),{stats:l,loading:c}=gw(r,o),m=f.useMemo(()=>{const h={};return l==null||l.dailyStats.forEach(({date:p,intake:g})=>{h[p]=g}),h},[l]),u=h=>{const p=$e(h.date),g=m[p]||0,x=Math.min(g/s,1),b=28,j=3,v=(b-j)/2,w=2*Math.PI*v,N=w-x*w,S=g>=s;return e.jsxs("div",{className:"relative flex items-center justify-center w-7 h-7",children:[e.jsxs("svg",{width:b,height:b,className:"absolute",children:[e.jsx("circle",{cx:b/2,cy:b/2,r:v,stroke:S?"#bfdbfe":"#e5e7eb",strokeWidth:j,fill:"none"}),e.jsx("circle",{cx:b/2,cy:b/2,r:v,stroke:S?"#3b82f6":"#9ca3af",strokeWidth:j,fill:"none",strokeDasharray:w,strokeDashoffset:N,strokeLinecap:"round",style:{transform:"rotate(-90deg)",transformOrigin:"50% 50%"}})]}),e.jsx("span",{className:"text-[10px] font-medium z-10",children:h.date.getDate()})]})};return e.jsxs(Ne,{className:"w-full",children:[e.jsxs(Vt,{className:"flex flex-col items-center gap-2",children:[e.jsx($f,{className:"w-5 h-5 text-blue-600"}),e.jsx(Wt,{className:"text-center",children:"Historial Mensual"})]}),e.jsxs(De,{className:"relative p-4",children:[c&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/50 z-10",children:e.jsx(ls,{className:"w-6 h-6 animate-spin"})}),e.jsx(Ac,{month:n,onMonthChange:a,showOutsideDays:!0,components:{DayContent:u},className:"p-0 w-full"})]})]})},z3=({selectedDate:t,goal:s})=>{const[n,a]=f.useState(null),[r,o]=f.useState(!1),{user:l}=qe(),{intake:c,drinks:m,status:u,error:h,addDrink:p,editDrink:g,deleteDrink:x,resync:b}=lj(t),{isOnline:j}=Va();if(!l)return e.jsx(Ne,{className:"w-full",children:e.jsx(De,{className:"p-4 text-center",children:e.jsx("p",{children:"Inicia sesión para registrar tu hidratación"})})});const v=$e(t)===$e(new Date);return e.jsxs(Ne,{className:"w-full shadow-sm border-0 bg-gradient-to-br from-white to-blue-50/30",children:[e.jsx(De,{className:"p-6 md:p-8",children:e.jsxs("div",{className:"space-y-8",children:[e.jsx(F4,{intake:c,goal:s}),v&&e.jsx("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:e.jsx(s5,{selectedDrink:n,onDrinkSelect:a,onAmountSelect:(w,N)=>{p(w,N),a(null)},disabled:u==="saving"||!j})}),e.jsx(r5,{drinks:m,showHistory:r,onToggleHistory:()=>o(!r),onDeleteDrink:x,onEditDrink:g,isCurrentDate:v}),h&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 shadow-sm",children:e.jsxs("p",{className:"text-sm text-red-600 flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 bg-red-500 rounded-full flex-shrink-0"}),h]})}),u==="saving"&&e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-xl p-4 shadow-sm",children:e.jsxs("p",{className:"text-sm text-blue-600 flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin flex-shrink-0"}),"Guardando tu progreso..."]})})]})}),e.jsxs(bn,{className:"justify-center gap-2 text-xs p-2",children:[u==="saving"&&e.jsx("span",{className:"text-blue-500",children:"Guardando..."}),u==="pending"&&e.jsx("span",{className:"text-yellow-600",children:"Pendiente de sincronizar"}),u==="saved"&&e.jsx("span",{className:"text-green-600",children:"Sincronizado"}),u==="error"&&e.jsx("span",{className:"text-red-600",children:"Error de sincronización"}),!j&&e.jsx("span",{className:"text-orange-600",children:"Offline"}),e.jsx(z,{onClick:b,variant:"link",className:"p-0 h-auto",children:"Reintentar"})]})]})},F3=t=>{const[s,n]=f.useState(null),[a,r]=f.useState(!0),[o,l]=f.useState(null),{user:c}=qe();return f.useEffect(()=>{(async()=>{if(c){r(!0),l(null);try{const u=[];for(let S=6;S>=0;S--){const E=new Date(t);E.setDate(E.getDate()-S),u.push($e(E))}const h=await Promise.all(u.map(async S=>{const E=Te(fe,"water",`${c.uid}_${S}`),T=await st(E);return T.exists()?{date:S,drinks:T.data().drinks||[],totalWater:T.data().totalWater||0}:{date:S,drinks:[],totalWater:0}})),p=pn.sumBy(h,"totalWater"),g=p/7,x=h.flatMap(S=>S.drinks),b=pn.groupBy(x,"type"),j=Object.entries(b).map(([S,E])=>({type:S,count:E.length,totalAmount:pn.sumBy(E,"amount"),percentage:pn.sumBy(E,"amount")/p*100||0})).sort((S,E)=>E.count-S.count),v=pn.groupBy(x,S=>Wn[S.type].category),w=Object.entries(v).map(([S,E])=>({category:S,totalAmount:pn.sumBy(E,"amount"),percentage:pn.sumBy(E,"amount")/p*100||0})).sort((S,E)=>E.totalAmount-S.totalAmount),N=h.map(S=>({date:S.date,intake:S.totalWater}));n({totalIntake:p,avgDailyIntake:g,commonDrinks:j,dailyIntake:N,categoryStats:w})}catch(u){console.error("Error al cargar estadísticas:",u),l(u instanceof Error?u.message:"Error al cargar estadísticas")}finally{r(!1)}}})()},[c,t]),{stats:s,loading:a,error:o}},Av=["#60A5FA","#34D399","#A78BFA","#F87171","#FBBF24","#A3E635"],B3=({selectedDate:t})=>{const{stats:s,loading:n,error:a}=F3(t);return n?e.jsx(Ne,{className:"w-full",children:e.jsx(De,{className:"flex items-center justify-center p-6",children:e.jsx(ls,{className:"w-6 h-6 animate-spin"})})}):a||!s?e.jsx(Ne,{className:"w-full",children:e.jsx(De,{className:"p-6",children:e.jsx("p",{className:"text-red-500",children:"Error al cargar estadísticas"})})}):e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(Ne,{className:"w-full",children:[e.jsx(Vt,{children:e.jsx(Wt,{children:"Consumo Diario"})}),e.jsxs(De,{children:[e.jsx("div",{className:"h-64",children:e.jsx(gn,{width:"100%",height:"100%",children:e.jsxs(Nu,{data:s.dailyIntake,children:[e.jsx(Ma,{dataKey:"date",tickFormatter:r=>new Date(r).toLocaleDateString("es-ES",{weekday:"short"})}),e.jsx(ma,{tickFormatter:r=>`${r}ml`}),e.jsx(vn,{formatter:r=>[`${r}ml`,"Consumo"],labelFormatter:r=>new Date(r).toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"short"})}),e.jsx(rc,{dataKey:"intake",fill:"#60A5FA"})]})})}),e.jsxs("div",{className:"mt-4 text-sm text-gray-500 text-center",children:["Promedio diario: ",Math.round(s.avgDailyIntake),"ml"]})]})]}),e.jsxs(Ne,{className:"w-full",children:[e.jsx(Vt,{children:e.jsx(Wt,{children:"Distribución por Categoría"})}),e.jsx(De,{children:e.jsx("div",{className:"h-64",children:e.jsx(gn,{width:"100%",height:"100%",children:e.jsxs(bc,{children:[e.jsx(jc,{data:s.categoryStats,dataKey:"totalAmount",nameKey:"category",cx:"50%",cy:"50%",outerRadius:80,label:({category:r})=>hc[r],children:s.categoryStats.map((r,o)=>e.jsx(wc,{fill:Av[o%Av.length]},r.category))}),e.jsx(vn,{formatter:r=>[`${r}ml`,"Cantidad"],labelFormatter:r=>hc[r]})]})})})})]}),e.jsxs(Ne,{className:"w-full md:col-span-2",children:[e.jsx(Vt,{children:e.jsx(Wt,{children:"Bebidas Más Consumidas"})}),e.jsxs(De,{children:["          ",e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4",children:[" ",s.commonDrinks.slice(0,6).map(r=>{const o=Wn[r.type],l=Ni[o.icon];return e.jsxs("div",{className:"flex flex-col items-center p-4 rounded-lg bg-muted text-center",children:[e.jsx(l,{className:`w-6 h-6 ${o.color} mb-2 flex-shrink-0`}),e.jsx("span",{className:"font-medium text-sm leading-tight",children:o.name})," ",e.jsxs("span",{className:"text-sm text-muted-foreground mt-1",children:[" ",r.totalAmount,"ml"]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[" ",r.count," veces"]})]},r.type)})]})]})]})]})};var H3="Label",qw=f.forwardRef((t,s)=>e.jsx(At.label,{...t,ref:s,onMouseDown:n=>{var r;n.target.closest("button, input, select, textarea")||((r=t.onMouseDown)==null||r.call(t,n),!n.defaultPrevented&&n.detail>1&&n.preventDefault())}}));qw.displayName=H3;var Yw=qw;const W3=Wo("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Fe=f.forwardRef(({className:t,...s},n)=>e.jsx(Yw,{ref:n,className:ce(W3(),t),...s}));Fe.displayName=Yw.displayName;var Fu="Tabs",[U3,aW]=Br(Fu,[ju]),Kw=ju(),[V3,Sp]=U3(Fu),Jw=f.forwardRef((t,s)=>{const{__scopeTabs:n,value:a,onValueChange:r,defaultValue:o,orientation:l="horizontal",dir:c,activationMode:m="automatic",...u}=t,h=bu(c),[p,g]=$r({prop:a,onChange:r,defaultProp:o??"",caller:Fu});return e.jsx(V3,{scope:n,baseId:$o(),value:p,onValueChange:g,orientation:l,dir:h,activationMode:m,children:e.jsx(At.div,{dir:h,"data-orientation":l,...u,ref:s})})});Jw.displayName=Fu;var Xw="TabsList",Zw=f.forwardRef((t,s)=>{const{__scopeTabs:n,loop:a=!0,...r}=t,o=Sp(Xw,n),l=Kw(n);return e.jsx(qy,{asChild:!0,...l,orientation:o.orientation,dir:o.dir,loop:a,children:e.jsx(At.div,{role:"tablist","aria-orientation":o.orientation,...r,ref:s})})});Zw.displayName=Xw;var Qw="TabsTrigger",eN=f.forwardRef((t,s)=>{const{__scopeTabs:n,value:a,disabled:r=!1,...o}=t,l=Sp(Qw,n),c=Kw(n),m=nN(l.baseId,a),u=aN(l.baseId,a),h=a===l.value;return e.jsx(Yy,{asChild:!0,...c,focusable:!r,active:h,children:e.jsx(At.button,{type:"button",role:"tab","aria-selected":h,"aria-controls":u,"data-state":h?"active":"inactive","data-disabled":r?"":void 0,disabled:r,id:m,...o,ref:s,onMouseDown:nt(t.onMouseDown,p=>{!r&&p.button===0&&p.ctrlKey===!1?l.onValueChange(a):p.preventDefault()}),onKeyDown:nt(t.onKeyDown,p=>{[" ","Enter"].includes(p.key)&&l.onValueChange(a)}),onFocus:nt(t.onFocus,()=>{const p=l.activationMode!=="manual";!h&&!r&&p&&l.onValueChange(a)})})})});eN.displayName=Qw;var tN="TabsContent",sN=f.forwardRef((t,s)=>{const{__scopeTabs:n,value:a,forceMount:r,children:o,...l}=t,c=Sp(tN,n),m=nN(c.baseId,a),u=aN(c.baseId,a),h=a===c.value,p=f.useRef(h);return f.useEffect(()=>{const g=requestAnimationFrame(()=>p.current=!1);return()=>cancelAnimationFrame(g)},[]),e.jsx(Hr,{present:r||h,children:({present:g})=>e.jsx(At.div,{"data-state":h?"active":"inactive","data-orientation":c.orientation,role:"tabpanel","aria-labelledby":m,hidden:!g,id:u,tabIndex:0,...l,ref:s,style:{...t.style,animationDuration:p.current?"0s":void 0},children:g&&o})})});sN.displayName=tN;function nN(t,s){return`${t}-trigger-${s}`}function aN(t,s){return`${t}-content-${s}`}var G3=Jw,rN=Zw,iN=eN,oN=sN;const Ga=G3,qa=f.forwardRef(({className:t,...s},n)=>e.jsx(rN,{ref:n,className:ce("inline-flex h-10 md:h-12 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground w-full md:w-auto overflow-x-auto",t),...s}));qa.displayName=rN.displayName;const js=f.forwardRef(({className:t,...s},n)=>e.jsx(iN,{ref:n,className:ce("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 md:px-4 md:py-2 text-sm md:text-base font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm touch-manipulation active:scale-95 min-w-0 flex-1 md:flex-initial",t),...s}));js.displayName=iN.displayName;const hs=f.forwardRef(({className:t,...s},n)=>e.jsx(oN,{ref:n,className:ce("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...s}));hs.displayName=oN.displayName;const Ml=new Map,Il=new Map;function lN(t,s){const{user:n}=qe(),[a,r]=f.useState(s),[o,l]=f.useState("idle"),[c,m]=f.useState(null),u=f.useRef(!1),h=f.useCallback(async()=>{if(!n||u.current)return;const g=`${n.uid}_${t}`;if(Ml.has(g)){const b=Ml.get(g);r({...s,...b}),u.current=!0;return}if(Il.has(g))try{const b=await Il.get(g);r({...s,...b}),u.current=!0;return}catch{}l("loading"),m(null);const x=(async()=>{try{const b=Te(fe,"settings",g);Me.logRead("settings","useModuleSettings.loadSettings",g);const j=await st(b),v=j.exists()?j.data():{};return Ml.set(g,v),Il.delete(g),v}catch(b){throw Il.delete(g),b}})();Il.set(g,x);try{const b=await x;r({...s,...b}),l("idle"),u.current=!0}catch(b){m(b.message),l("error")}},[n,t]);return f.useEffect(()=>{h()},[h]),{settings:a,status:o,error:c,saveSettings:async g=>{if(!n)return;l("saving"),m(null);const x=a,b=`${n.uid}_${t}`;try{const j={...a,...g};r(j),l("saved");const v=Te(fe,"settings",b),w=Object.fromEntries(Object.entries(g).filter(([,S])=>S!==void 0&&!(typeof S=="number"&&isNaN(S))));Me.logWrite("settings","useModuleSettings.saveSettings",b),await qt(v,{userId:n.uid,...w},{merge:!0});const N=Ml.get(b)||{};Ml.set(b,{...N,...w})}catch(j){throw r(x),m(j.message),l("error"),j}},refetch:h}}const q3=()=>{const[t,s]=f.useState(new Date),[n,a]=f.useState(new Date),[r,o]=f.useState(new Date),{user:l}=qe(),c=f.useMemo(()=>({dailyGoal:2e3}),[]),{settings:m,saveSettings:u}=lN("water",c),[h,p]=f.useState(m.dailyGoal);f.useEffect(()=>{p(m.dailyGoal)},[m.dailyGoal]);const g=(x,b)=>{a(x),o(b)};return l?e.jsxs(Xs,{children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Control de Hidratación"}),e.jsx("p",{className:"text-gray-500",children:"Registra y monitorea tu consumo diario de agua"})]}),e.jsxs(Ga,{defaultValue:"daily",className:"w-full",children:[e.jsxs(qa,{className:"mb-6",children:[e.jsx(js,{value:"daily",children:"Registro Diario"}),e.jsx(js,{value:"stats",children:"Estadísticas"}),e.jsx(js,{value:"settings",children:"Configuración"})]}),e.jsxs(hs,{value:"daily",children:[e.jsx(or,{selectedDate:t,onChange:s}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-[1fr_300px]",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx(z3,{selectedDate:t,goal:m.dailyGoal}),e.jsx(B3,{selectedDate:t})]}),e.jsx("div",{children:e.jsx($3,{selectedDate:t,goal:m.dailyGoal})})]})]}),e.jsxs(hs,{value:"stats",children:[e.jsx(R4,{onPeriodChange:g}),e.jsx(_4,{startDate:n,endDate:r})]}),e.jsx(hs,{value:"settings",className:"space-y-4",children:e.jsx(Ne,{children:e.jsxs(De,{className:"pt-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx(Fe,{htmlFor:"goal",children:"Meta diaria (ml)"}),e.jsx(Be,{id:"goal",type:"number",value:h,onChange:x=>p(Number(x.target.value))})]}),e.jsx(z,{onClick:()=>u({dailyGoal:h}),children:"Guardar"})]})})})]})]}):e.jsx(Xs,{children:e.jsx(Ne,{children:e.jsx(De,{className:"p-6",children:e.jsx("p",{className:"text-center",children:"Inicia sesión para ver tus estadísticas de hidratación"})})})})},Y3=(t,s=2e3)=>{const n=f.useRef(),a=f.useRef(null),r=f.useCallback(c=>{a.current=c,n.current&&clearTimeout(n.current),n.current=setTimeout(async()=>{if(a.current)try{await t(a.current),a.current=null}catch(m){console.error("Error in debounced write:",m)}},s)},[t,s]),o=f.useCallback(async()=>{if(n.current&&clearTimeout(n.current),a.current)try{await t(a.current),a.current=null}catch(c){console.error("Error in flush write:",c)}},[t]),l=f.useCallback(()=>{n.current&&clearTimeout(n.current)},[]);return{debouncedWrite:r,flushPendingWrite:o,cleanup:l,hasPendingWrite:()=>a.current!==null}},Sh=crypto.randomUUID(),Ol=30*60,K3=({onComplete:t,onCancel:s,selectedDate:n})=>{const{user:a}=qe(),[r,o]=f.useState(null),[l,c]=f.useState(!1),m=f.useRef(),u=f.useRef(!1),h=f.useRef(0),p=ij();f.useEffect(()=>{p.setOnCompletion(E=>{console.log("Callback de finalización llamado, guardando sesión..."),t(E)})},[p,t]);const g=$e(n||new Date),x=Y3(async E=>{if(!a)return;const T=Te(fe,"pomodoro",`${a.uid}_${g}`);await qt(T,E,{merge:!0})},1e3),b=f.useCallback(()=>{m.current&&(cancelAnimationFrame(m.current),m.current=void 0)},[]),j=f.useCallback(()=>{u.current||(u.current=!0,b(),p.stopTimer(),o(null),c(!1),setTimeout(()=>{u.current=!1},100))},[b,p]),v=f.useCallback(E=>{const T=(Date.now()-E)/1e3;return Math.max(0,Ol-T)},[]);f.useEffect(()=>{if(!a)return;const E=Te(fe,"pomodoro",`${a.uid}_${g}`),T=cR(E,k=>{if(!k.exists()){j();return}const P=k.data().activePomodoro;if(!P||l){j();return}if(P.deviceId!==Sh&&!p.isActive)return;if(v(P.startTime.timestamp)<=0){const B=Date.now();B-h.current>5e3&&(h.current=B,x.debouncedWrite({activePomodoro:null,updatedAt:dt()})),P.deviceId===Sh&&t(Ol),j();return}o(P),p.isActive||p.startTimer()});return()=>{T(),b(),x.cleanup()}},[a,g,p.isActive,l,v,b,j,t,x]);const w=f.useCallback(async()=>{if(!a||p.isActive)return;const E=new Date,k={startTime:cn(n||E,E.getHours(),E.getMinutes()),duration:Ol,deviceId:Sh};o(k),c(!1),p.startTimer();try{const D=Te(fe,"pomodoro",`${a.uid}_${g}`);await qt(D,{userId:a.uid,date:g,activePomodoro:k,updatedAt:dt()},{merge:!0})}catch(D){console.error("Error starting timer:",D),j()}},[a,g,p.isActive,n,j,p]),N=f.useCallback(async()=>{if(!(!a||!r||l))try{c(!0),x.debouncedWrite({activePomodoro:null,updatedAt:dt()});const E=p.time;E>0&&s(E),j()}catch(E){console.error("Error stopping timer:",E),c(!1)}},[a,g,r,l,p.time,s,j,x]),S=E=>{const T=Math.floor(E/60),k=Math.floor(E%60);return`${T<10?"0":""}${T}:${k<10?"0":""}${k}`};return{time:Ol-p.time,isActive:p.isActive,formattedTime:S(Ol-p.time),startTimer:w,stopTimer:N}},J3=(t="week")=>{const[s,n]=f.useState(null),[a,r]=f.useState(!0),[o,l]=f.useState(null),{user:c}=qe();return f.useEffect(()=>{(async()=>{if(!c){r(!1);return}try{r(!0),l(null);const u=Mr(new Date),h=cs(t==="week"?Vl(u,7):Hl(u,1)),p=JA({start:h,end:u}),g=[],x={};if((await Promise.allSettled(p.map(async E=>{const T=$e(E),k=Te(fe,"pomodoro",`${c.uid}_${T}`);try{const D=await st(k);if(D.exists()){const P=D.data();return{dateStr:T,data:P}}}catch(D){console.error("PomodoroStats - Error fetching doc:",D)}return null}))).forEach(E=>{if(E.status==="fulfilled"&&E.value){const{dateStr:T,data:k}=E.value;g.push(...k.sessions);const P=k.sessions.filter(_=>_.completed).reduce((_,B)=>_+B.duration,0)/60;x[T]=P}}),g.length===0){n({totalSessions:0,totalTime:0,averageSessionTime:0,completionRate:0,...t==="week"&&{averageWeekdayHours:0}}),r(!1);return}const j=Object.entries(x).reduce((E,[T,k])=>k>E[1]?[T,k]:E,["",0]),v=g.filter(E=>E.completed),w=g.reduce((E,T)=>E+T.duration,0);let N;if(t==="week"){const E=Object.entries(x).filter(([D])=>{const P=new Date(D).getDay();return P!==0&&P!==6}),T=E.reduce((D,[,P])=>D+P,0),k=E.length;N=k>0?T/60/k:0}const S={totalSessions:g.length,totalTime:w,averageSessionTime:w/g.length,completionRate:v.length/g.length*100,...N!==void 0&&{averageWeekdayHours:N},...j[1]>0&&{bestDay:{date:at(new Date(j[0]),"dd/MM/yyyy"),minutes:j[1]}}};n(S)}catch(u){console.error("Error fetching pomodoro stats:",u),l(u instanceof Error?u.message:"Error al cargar las estadísticas")}finally{r(!1)}})()},[c,t]),{stats:s,loading:a,error:o}},X3=(t,s)=>{const[n,a]=f.useState(null),[r,o]=f.useState(!0),[l,c]=f.useState(null),{user:m}=qe();return f.useEffect(()=>{(async()=>{if(a(null),!!m){o(!0),c(null);try{const h=[],p=new Date(t);for(;p<=s;)h.push($e(p)),p.setDate(p.getDate()+1);const x=(await Promise.allSettled(h.map(b=>st(Te(fe,"pomodoro",`${m.uid}_${b}`))))).map((b,j)=>{if(b.status==="fulfilled"){const v=b.value,N=(v.exists()?v.data().sessions||[]:[]).filter(S=>S.completed).reduce((S,E)=>S+(E.duration||0),0)/60;return{date:h[j],minutes:N}}return console.error("PomodoroStatsRange - Error fetching doc:",b.reason),{date:h[j],minutes:0}});a({dailyStats:x})}catch(h){console.error("Error al cargar estadísticas:",h),c(h instanceof Error?h.message:"Error al cargar estadísticas")}finally{o(!1)}}})()},[m,t,s]),{stats:n,loading:r,error:l}},Z3=({count:t,onIncrement:s,disabled:n,status:a})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex flex-col items-center min-w-[3rem]",children:[e.jsx("span",{className:"font-medium text-lg",children:t}),e.jsx("span",{className:"text-xs text-gray-500",children:"completados"})]}),e.jsx(z,{variant:"outline",size:"icon",onClick:s,disabled:n,className:"h-8 w-8",children:e.jsx(as,{className:"w-4 h-4"})}),a==="saving"&&e.jsx("span",{className:"text-xs text-blue-500 animate-pulse",children:"Guardando..."}),a==="error"&&e.jsx("span",{className:"text-xs text-red-500",children:"Error al guardar"})]}),Cp=TA,Bu=f.forwardRef(({className:t,...s},n)=>e.jsx(CA,{ref:n,className:ce("border-b",t),...s}));Bu.displayName="AccordionItem";const Hu=f.forwardRef(({className:t,children:s,...n},a)=>e.jsx(EA,{className:"flex",children:e.jsxs(Ky,{ref:a,className:ce("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",t),...n,children:[s,e.jsx(_n,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})}));Hu.displayName=Ky.displayName;const Wu=f.forwardRef(({className:t,children:s,...n},a)=>e.jsx(Jy,{ref:a,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...n,children:e.jsx("div",{className:ce("pb-4 pt-0",t),children:s})}));Wu.displayName=Jy.displayName;const Rv=t=>new Date(t).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit",hour12:!1}),Q3=({sessions:t,onDeleteSession:s,onEditSession:n})=>{const[a,r]=f.useState(!1),o=[...t].sort((l,c)=>c.startTime.timestamp-l.startTime.timestamp);return e.jsx(Cp,{type:"single",collapsible:!0,onValueChange:l=>r(!!l),value:a?"history":"",children:e.jsxs(Bu,{value:"history",className:"border-none",children:[e.jsx(Hu,{className:"w-full h-11 flex items-center justify-center gap-2 border rounded-lg bg-background hover:bg-accent data-[state=open]:rounded-b-none",children:e.jsx("span",{className:"text-sm font-semibold",children:"Historial de hoy"})}),e.jsx(Wu,{className:"mt-2 space-y-2",children:o.length===0?e.jsx("div",{className:"text-center text-gray-500 text-sm py-2",children:"No hay sesiones registradas hoy"}):o.map((l,c)=>e.jsxs("div",{className:"flex flex-col p-2.5 bg-muted rounded-lg text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[l.completed?e.jsx(za,{className:"w-4 h-4 text-green-500 flex-shrink-0"}):e.jsx(gR,{className:"w-4 h-4 text-red-500 flex-shrink-0"}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-xs text-gray-400 w-4",children:c+1}),e.jsx("span",{children:Rv(l.startTime.timestamp)}),e.jsx("span",{className:"text-gray-400",children:"→"}),e.jsx("span",{children:Rv(l.endTime.timestamp)})]})}),e.jsxs("span",{className:"text-gray-500 whitespace-nowrap",children:[Math.floor(l.duration/60),"min"]}),e.jsxs("div",{className:"flex gap-1 ml-2",children:[n&&e.jsx(z,{variant:"ghost",size:"icon",className:"h-auto w-auto p-1",onClick:()=>n(l),children:e.jsx(sa,{className:"w-4 h-4 text-muted-foreground"})}),s&&e.jsx(z,{variant:"ghost",size:"icon",className:"h-auto w-auto p-1",onClick:()=>s(l),children:e.jsx(Zi,{className:"w-4 h-4 text-destructive"})})]})]}),l.description&&e.jsx("div",{className:"ml-6 mt-1 text-xs text-gray-500",children:l.description})]},l.startTime.timestamp))})]})})},eL=({time:t,isActive:s,onStart:n,onStop:a,disabled:r})=>{const[o,l]=f.useState(!1),c=async u=>{if(u.preventDefault(),!o)try{l(!0),await a()}finally{l(!1)}},m=async u=>{if(u.preventDefault(),!o)try{l(!0),await n()}finally{l(!1)}};return e.jsxs("div",{className:"flex flex-col items-center gap-6",children:[e.jsx("div",{className:"text-6xl font-mono tracking-wider",children:t}),e.jsx("div",{className:"flex gap-4",children:s?e.jsxs(z,{size:"lg",onClick:c,disabled:r||o,variant:"destructive",className:"w-40 text-lg",children:[o?e.jsx(ls,{className:"w-5 h-5 mr-2 animate-spin"}):e.jsx(Wf,{className:"w-5 h-5 mr-2"}),o?"Deteniendo...":"Detener"]}):e.jsxs(z,{size:"lg",onClick:m,disabled:r||o,className:"w-40 text-lg",children:[o?e.jsx(ls,{className:"w-5 h-5 mr-2 animate-spin"}):e.jsx(yn,{className:"w-5 h-5 mr-2"}),o?"Iniciando...":"Iniciar"]})}),e.jsx("div",{className:"text-sm text-gray-500",children:s?e.jsx(e.Fragment,{children:o?e.jsx("span",{children:"Procesando cambio de estado..."}):e.jsx("span",{children:"Concentración en progreso..."})}):e.jsx("span",{children:"30 minutos de concentración"})})]})},tL=({progress:t,currentTime:s,totalTime:n,isActive:a})=>{const r=Math.min(Math.max(t,0),100);return e.jsxs("div",{className:"space-y-2",children:[e.jsx(Vn,{value:r,className:`h-2 transition-all duration-300 ${a?"bg-gray-100":"bg-gray-50"}`}),e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:s}),e.jsx("span",{className:"text-gray-500",children:" restantes"})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("span",{children:"Total: "}),e.jsx("span",{className:"font-medium",children:n})]})]}),e.jsx("div",{className:"text-center text-sm text-gray-500",children:r>0&&e.jsxs("span",{children:[Math.round(r),"% completado"]})})]})};var Uu="Checkbox",[sL,rW]=Br(Uu),[nL,Ep]=sL(Uu);function aL(t){const{__scopeCheckbox:s,checked:n,children:a,defaultChecked:r,disabled:o,form:l,name:c,onCheckedChange:m,required:u,value:h="on",internal_do_not_use_render:p}=t,[g,x]=$r({prop:n,defaultProp:r??!1,onChange:m,caller:Uu}),[b,j]=f.useState(null),[v,w]=f.useState(null),N=f.useRef(!1),S=b?!!l||!!b.closest("form"):!0,E={checked:g,disabled:o,setChecked:x,control:b,setControl:j,name:c,form:l,value:h,hasConsumerStoppedPropagationRef:N,required:u,defaultChecked:wi(r)?!1:r,isFormControl:S,bubbleInput:v,setBubbleInput:w};return e.jsx(nL,{scope:s,...E,children:rL(p)?p(E):a})}var cN="CheckboxTrigger",dN=f.forwardRef(({__scopeCheckbox:t,onKeyDown:s,onClick:n,...a},r)=>{const{control:o,value:l,disabled:c,checked:m,required:u,setControl:h,setChecked:p,hasConsumerStoppedPropagationRef:g,isFormControl:x,bubbleInput:b}=Ep(cN,t),j=ws(r,h),v=f.useRef(m);return f.useEffect(()=>{const w=o==null?void 0:o.form;if(w){const N=()=>p(v.current);return w.addEventListener("reset",N),()=>w.removeEventListener("reset",N)}},[o,p]),e.jsx(At.button,{type:"button",role:"checkbox","aria-checked":wi(m)?"mixed":m,"aria-required":u,"data-state":pN(m),"data-disabled":c?"":void 0,disabled:c,value:l,...a,ref:j,onKeyDown:nt(s,w=>{w.key==="Enter"&&w.preventDefault()}),onClick:nt(n,w=>{p(N=>wi(N)?!0:!N),b&&x&&(g.current=w.isPropagationStopped(),g.current||w.stopPropagation())})})});dN.displayName=cN;var Tp=f.forwardRef((t,s)=>{const{__scopeCheckbox:n,name:a,checked:r,defaultChecked:o,required:l,disabled:c,value:m,onCheckedChange:u,form:h,...p}=t;return e.jsx(aL,{__scopeCheckbox:n,checked:r,defaultChecked:o,disabled:c,required:l,onCheckedChange:u,name:a,form:h,value:m,internal_do_not_use_render:({isFormControl:g})=>e.jsxs(e.Fragment,{children:[e.jsx(dN,{...p,ref:s,__scopeCheckbox:n}),g&&e.jsx(fN,{__scopeCheckbox:n})]})})});Tp.displayName=Uu;var uN="CheckboxIndicator",mN=f.forwardRef((t,s)=>{const{__scopeCheckbox:n,forceMount:a,...r}=t,o=Ep(uN,n);return e.jsx(Hr,{present:a||wi(o.checked)||o.checked===!0,children:e.jsx(At.span,{"data-state":pN(o.checked),"data-disabled":o.disabled?"":void 0,...r,ref:s,style:{pointerEvents:"none",...t.style}})})});mN.displayName=uN;var hN="CheckboxBubbleInput",fN=f.forwardRef(({__scopeCheckbox:t,...s},n)=>{const{control:a,hasConsumerStoppedPropagationRef:r,checked:o,defaultChecked:l,required:c,disabled:m,name:u,value:h,form:p,bubbleInput:g,setBubbleInput:x}=Ep(hN,t),b=ws(n,x),j=Pj(o),v=DA(a);f.useEffect(()=>{const N=g;if(!N)return;const S=window.HTMLInputElement.prototype,T=Object.getOwnPropertyDescriptor(S,"checked").set,k=!r.current;if(j!==o&&T){const D=new Event("click",{bubbles:k});N.indeterminate=wi(o),T.call(N,wi(o)?!1:o),N.dispatchEvent(D)}},[g,j,o,r]);const w=f.useRef(wi(o)?!1:o);return e.jsx(At.input,{type:"checkbox","aria-hidden":!0,defaultChecked:l??w.current,required:c,disabled:m,name:u,value:h,form:p,...s,tabIndex:-1,ref:b,style:{...s.style,...v,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});fN.displayName=hN;function rL(t){return typeof t=="function"}function wi(t){return t==="indeterminate"}function pN(t){return wi(t)?"indeterminate":t?"checked":"unchecked"}const As=f.forwardRef(({className:t,...s},n)=>e.jsx(Tp,{ref:n,className:ce("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...s,children:e.jsx(mN,{className:ce("flex items-center justify-center text-current"),children:e.jsx(ro,{className:"h-4 w-4"})})}));As.displayName=Tp.displayName;const iL=({session:t,onClose:s,onSave:n})=>{const[a,r]=f.useState(""),[o,l]=f.useState(""),[c,m]=f.useState(!1),[u,h]=f.useState("");if(f.useEffect(()=>{if(t){const g=new Date(t.startTime.timestamp),x=new Date(t.endTime.timestamp);r(`${String(g.getHours()).padStart(2,"0")}:${String(g.getMinutes()).padStart(2,"0")}`),l(`${String(x.getHours()).padStart(2,"0")}:${String(x.getMinutes()).padStart(2,"0")}`),m(t.completed),h(t.description||"")}},[t]),!t)return null;const p=()=>{const g=new Date(t.startTime.timestamp),[x,b]=a.split(":").map(Number),[j,v]=o.split(":").map(Number),w=new Date(g);w.setHours(x,b,0,0);const N=new Date(g);N.setHours(j,v,0,0),N<w&&N.setDate(N.getDate()+1);const S={startTime:{timestamp:w.getTime(),utcOffset:-w.getTimezoneOffset(),formatted:new Date(w).toLocaleString("es-ES",{day:"numeric",month:"long",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!0})+` UTC${-w.getTimezoneOffset()>=0?"+":"-"}${Math.abs(Math.floor(-w.getTimezoneOffset()/60))}`},endTime:{timestamp:N.getTime(),utcOffset:-N.getTimezoneOffset(),formatted:new Date(N).toLocaleString("es-ES",{day:"numeric",month:"long",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!0})+` UTC${-N.getTimezoneOffset()>=0?"+":"-"}${Math.abs(Math.floor(-N.getTimezoneOffset()/60))}`},duration:(N.getTime()-w.getTime())/1e3,completed:c,description:u.trim()||void 0};n(t,S),s()};return e.jsx(Rt,{open:!!t,onOpenChange:g=>{g||s()},children:e.jsxs(Ct,{className:"sm:max-w-md",children:[e.jsx(_t,{children:e.jsx(Pt,{children:"Editar Sesión Pomodoro"})}),e.jsxs("div",{className:"py-4 space-y-4",children:[" ",e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[" ",e.jsx(Fe,{htmlFor:"startTime",children:"Hora inicio"}),e.jsx(Be,{id:"startTime",type:"time",value:a,onChange:g=>r(g.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Fe,{htmlFor:"endTime",children:"Hora fin"}),e.jsx(Be,{id:"endTime",type:"time",value:o,onChange:g=>l(g.target.value)})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Fe,{htmlFor:"description",children:"Descripción (opcional)"}),e.jsx(Be,{id:"description",type:"text",value:u,onChange:g=>h(g.target.value),placeholder:"¿Qué hiciste en esta sesión?"})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-2",children:[" ",e.jsx(As,{id:"completed",checked:c,onCheckedChange:g=>m(!!g)}),e.jsx(Fe,{htmlFor:"completed",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Sesión completada"})]})]}),e.jsxs(wn,{children:[e.jsx(z,{variant:"outline",onClick:s,children:"Cancelar"}),e.jsx(z,{onClick:p,children:"Guardar cambios"})]})]})})},Md=t=>{const s=Math.floor(t/60),n=t%60;return s>0?`${s}h ${n}min`:`${n}min`},oL=t=>t===100?{icon:yb,message:"¡Meta diaria alcanzada! 🎉",description:"Has completado tu objetivo del día ¡Excelente trabajo!",color:"text-green-600"}:t>=75?{icon:Uo,message:"¡Casi ahí! 💪",description:"Estás muy cerca de alcanzar tu meta diaria",color:"text-blue-600"}:t>=50?{icon:Js,message:"¡Buen progreso! 👍",description:"Mantén el ritmo, vas por buen camino",color:"text-indigo-600"}:t>=25?{icon:Js,message:"¡Sigue adelante! 🎯",description:"Has comenzado bien, mantén el enfoque",color:"text-blue-600"}:{icon:Js,message:"¡Comencemos! 🚀",description:"Es un buen momento para enfocarse en tus objetivos",color:"text-gray-600"},lL=t=>t>=100?{background:"bg-green-500",text:"text-green-700",icon:"bg-green-100"}:t>=75?{background:"bg-blue-500",text:"text-blue-700",icon:"bg-blue-100"}:t>=50?{background:"bg-indigo-500",text:"text-indigo-700",icon:"bg-indigo-100"}:t>=25?{background:"bg-blue-500",text:"text-blue-700",icon:"bg-blue-100"}:{background:"bg-gray-500",text:"text-gray-700",icon:"bg-gray-100"},cL=({sessions:t,dailyGoal:s=300})=>{const n=t.filter(p=>p.completed).reduce((p,g)=>p+g.duration,0),a=Math.floor(n/60),r=Math.min(Math.round(a/s*100),100),o=Math.max(s-a,0),{icon:l,message:c,description:m,color:u}=oL(r),h=lL(r);return e.jsx(Ne,{className:"p-6 bg-gradient-to-br from-white to-gray-50",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-full ${h.icon} mt-1`,children:e.jsx(l,{className:`w-5 h-5 ${u}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:`font-semibold text-lg ${u}`,children:c}),e.jsx("p",{className:"text-sm text-gray-600",children:m})]})]}),e.jsxs("div",{className:"text-sm text-gray-600 flex justify-between items-center",children:[e.jsxs("span",{children:["Meta diaria: ",Md(s)]}),e.jsxs("span",{className:`font-medium ${u}`,children:[r,"% completado"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(Vn,{value:r,className:"h-3"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Tiempo efectivo"}),e.jsx("p",{className:`text-lg font-semibold ${h.text}`,children:Md(a)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Tiempo restante"}),e.jsx("p",{className:"text-lg font-semibold text-gray-700",children:Md(o)})]})]})]}),e.jsx("div",{className:"text-center",children:r<100?e.jsxs("p",{className:"text-sm text-gray-600",children:["Te faltan ",e.jsx("span",{className:"font-medium",children:Md(o)})," para alcanzar tu meta diaria"]}):e.jsx("p",{className:"text-sm font-medium text-green-600",children:"¡Felicitaciones! Has superado tu meta diaria de productividad 🎉"})})]})})},_v=t=>{const s=Math.floor(t/60),n=t%60;return`${s<10?"0":""}${s}:${n<10?"0":""}${n}`},ql=t=>{if(t<60)return`${t} min`;const s=Math.floor(t/60),n=t%60;return`${s}h ${n}min`};var xN="AlertDialog",[dL,iW]=Br(xN,[Xy]),Wr=Xy(),gN=t=>{const{__scopeAlertDialog:s,...n}=t,a=Wr(s);return e.jsx(vu,{...a,...n,modal:!0})};gN.displayName=xN;var uL="AlertDialogTrigger",vN=f.forwardRef((t,s)=>{const{__scopeAlertDialog:n,...a}=t,r=Wr(n);return e.jsx(yu,{...r,...a,ref:s})});vN.displayName=uL;var mL="AlertDialogPortal",yN=t=>{const{__scopeAlertDialog:s,...n}=t,a=Wr(s);return e.jsx(gu,{...a,...n})};yN.displayName=mL;var hL="AlertDialogOverlay",bN=f.forwardRef((t,s)=>{const{__scopeAlertDialog:n,...a}=t,r=Wr(n);return e.jsx(zo,{...r,...a,ref:s})});bN.displayName=hL;var To="AlertDialogContent",[fL,pL]=dL(To),xL=Fy("AlertDialogContent"),jN=f.forwardRef((t,s)=>{const{__scopeAlertDialog:n,children:a,...r}=t,o=Wr(n),l=f.useRef(null),c=ws(s,l),m=f.useRef(null);return e.jsx(kA,{contentName:To,titleName:wN,docsSlug:"alert-dialog",children:e.jsx(fL,{scope:n,cancelRef:m,children:e.jsxs(Fo,{role:"alertdialog",...o,...r,ref:c,onOpenAutoFocus:nt(r.onOpenAutoFocus,u=>{var h;u.preventDefault(),(h=m.current)==null||h.focus({preventScroll:!0})}),onPointerDownOutside:u=>u.preventDefault(),onInteractOutside:u=>u.preventDefault(),children:[e.jsx(xL,{children:a}),e.jsx(vL,{contentRef:l})]})})})});jN.displayName=To;var wN="AlertDialogTitle",NN=f.forwardRef((t,s)=>{const{__scopeAlertDialog:n,...a}=t,r=Wr(n);return e.jsx(Bo,{...r,...a,ref:s})});NN.displayName=wN;var SN="AlertDialogDescription",CN=f.forwardRef((t,s)=>{const{__scopeAlertDialog:n,...a}=t,r=Wr(n);return e.jsx(Ho,{...r,...a,ref:s})});CN.displayName=SN;var gL="AlertDialogAction",EN=f.forwardRef((t,s)=>{const{__scopeAlertDialog:n,...a}=t,r=Wr(n);return e.jsx(gc,{...r,...a,ref:s})});EN.displayName=gL;var TN="AlertDialogCancel",DN=f.forwardRef((t,s)=>{const{__scopeAlertDialog:n,...a}=t,{cancelRef:r}=pL(TN,n),o=Wr(n),l=ws(s,r);return e.jsx(gc,{...o,...a,ref:l})});DN.displayName=TN;var vL=({contentRef:t})=>{const s=`\`${To}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${To}\` by passing a \`${SN}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${To}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return f.useEffect(()=>{var a;document.getElementById((a=t.current)==null?void 0:a.getAttribute("aria-describedby"))||console.warn(s)},[s,t]),null},yL=gN,bL=vN,jL=yN,kN=bN,AN=jN,RN=EN,_N=DN,PN=NN,MN=CN;const Ur=yL,ki=bL,wL=jL,IN=f.forwardRef(({className:t,...s},n)=>e.jsx(kN,{className:ce("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s,ref:n}));IN.displayName=kN.displayName;const mr=f.forwardRef(({className:t,...s},n)=>e.jsxs(wL,{children:[e.jsx(IN,{}),e.jsx(AN,{ref:n,className:ce("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...s})]}));mr.displayName=AN.displayName;const hr=({className:t,...s})=>e.jsx("div",{className:ce("flex flex-col space-y-2 text-center sm:text-left",t),...s});hr.displayName="AlertDialogHeader";const fr=({className:t,...s})=>e.jsx("div",{className:ce("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s});fr.displayName="AlertDialogFooter";const pr=f.forwardRef(({className:t,...s},n)=>e.jsx(PN,{ref:n,className:ce("text-lg font-semibold",t),...s}));pr.displayName=PN.displayName;const xr=f.forwardRef(({className:t,...s},n)=>e.jsx(MN,{ref:n,className:ce("text-sm text-muted-foreground",t),...s}));xr.displayName=MN.displayName;const gr=f.forwardRef(({className:t,...s},n)=>e.jsx(RN,{ref:n,className:ce(dc(),t),...s}));gr.displayName=RN.displayName;const vr=f.forwardRef(({className:t,...s},n)=>e.jsx(_N,{ref:n,className:ce(dc({variant:"outline"}),"mt-2 sm:mt-0",t),...s}));vr.displayName=_N.displayName;const Ch=30*60,NL=({selectedDate:t})=>{const{user:s}=qe(),n=300,[a,r]=f.useState(!1),[o,l]=f.useState(null),{supported:c,permission:m,preferences:u,requestPermission:h,sendNotification:p,updatePreferences:g,startPersistentNotification:x,stopPersistentNotification:b}=Qf(),{count:j,sessions:v,status:w,error:N,saveSession:S,deleteSession:E,editSession:T,addManualSession:k,resync:D}=rj(t),{isOnline:P}=Va(),_=f.useCallback(async U=>{await S(U,!0),u.enabled&&m==="granted"&&p("¡Pomodoro completado! 🎉",{body:"Has completado exitosamente tu sesión de concentración",requireInteraction:!0})},[S,u,m,p]),B=f.useCallback(async U=>{await S(U,!1,{description:"Sesión interrumpida manualmente"})},[S]),{time:I,isActive:R,formattedTime:M,startTimer:W,stopTimer:H}=K3({onComplete:_,onCancel:B,selectedDate:t}),L=(Ch-I)/Ch*100,$=async()=>{c&&(u.enabled?g({enabled:!1}):m==="default"?r(!0):m==="granted"&&g({enabled:!0}))},q=async()=>{await h()&&g({enabled:!0}),r(!1)},re=async()=>{w==="saving"||!P||await k()},Y=U=>{l(U)},se=async(U,ee)=>{await T(U,ee),l(null)},ie=f.useRef(I);return f.useEffect(()=>{ie.current=I},[I]),f.useEffect(()=>{!c||!u.enabled||m!=="granted"||(R?x("Pomodoro en progreso",()=>`Tiempo restante: ${_v(Math.ceil(ie.current))}`):b())},[R,c,u.enabled,m,x,b]),f.useEffect(()=>()=>{b()},[b]),s?e.jsxs("div",{className:"space-y-6",children:[e.jsx(cL,{sessions:v,dailyGoal:n}),e.jsx(Ne,{className:"w-full",children:e.jsxs(De,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Js,{className:"w-5 h-5"}),e.jsx("h2",{className:"text-lg font-medium",children:"Pomodoro Timer"})]}),c&&e.jsx(z,{variant:"outline",size:"sm",onClick:$,className:"flex items-center gap-2","aria-label":u.enabled?"Desactivar notificaciones":"Activar notificaciones",children:u.enabled?e.jsxs(e.Fragment,{children:[e.jsx(Wh,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline"})]}):e.jsxs(e.Fragment,{children:[e.jsx($d,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline"})]})})]}),e.jsx(Z3,{count:j,onIncrement:re,disabled:w==="saving"||!P,status:w})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(eL,{time:M,isActive:R,onStart:W,onStop:H,disabled:w==="saving"||!P}),e.jsx(tL,{progress:L,currentTime:M,totalTime:_v(Ch),isActive:R})]}),e.jsx("div",{className:"mt-6",children:e.jsx(Q3,{sessions:v,onEditSession:Y,onDeleteSession:E})})]})}),o&&e.jsx(iL,{session:o,onClose:()=>l(null),onSave:se}),e.jsx(Ur,{open:a,onOpenChange:r,children:e.jsxs(mr,{children:[e.jsxs(hr,{children:[e.jsx(pr,{children:"Activar notificaciones"}),e.jsx(xr,{children:"¿Te gustaría recibir notificaciones cuando se complete un Pomodoro? Esto te ayudará a mantenerte informado incluso cuando el navegador esté en segundo plano."})]}),e.jsxs(fr,{children:[e.jsx(vr,{children:"No, gracias"}),e.jsx(gr,{onClick:q,children:"Activar notificaciones"})]})]})}),N&&e.jsx("p",{className:"mt-2 text-sm text-red-500",children:N}),e.jsxs("div",{className:"flex justify-center items-center gap-2 text-xs p-2",children:[w==="saving"&&e.jsx("span",{className:"text-blue-500",children:"Guardando..."}),w==="pending"&&e.jsx("span",{className:"text-yellow-600",children:"Pendiente de sincronizar"}),w==="saved"&&e.jsx("span",{className:"text-green-600",children:"Sincronizado"}),w==="error"&&e.jsx("span",{className:"text-red-600",children:"Error de sincronización"}),!P&&e.jsx("span",{className:"text-orange-600",children:"Offline"}),e.jsx(z,{onClick:D,variant:"link",className:"p-0 h-auto",children:"Reintentar"})]})]}):e.jsxs(Ne,{className:"w-full",children:[e.jsx(De,{className:"p-4 text-center",children:e.jsx("p",{children:"Inicia sesión para usar el temporizador Pomodoro"})}),e.jsxs(bn,{className:"justify-center gap-2 text-xs p-2",children:[w==="saving"&&e.jsx("span",{className:"text-blue-500",children:"Guardando..."}),w==="pending"&&e.jsx("span",{className:"text-yellow-600",children:"Pendiente de sincronizar"}),w==="saved"&&e.jsx("span",{className:"text-green-600",children:"Sincronizado"}),w==="error"&&e.jsx("span",{className:"text-red-600",children:"Error de sincronización"}),!P&&e.jsx("span",{className:"text-orange-600",children:"Offline"}),e.jsx(z,{onClick:D,variant:"link",className:"p-0 h-auto",children:"Reintentar"})]})]})},Pv=({dateRange:t})=>{var o;const{user:s}=qe(),{stats:n,loading:a,error:r}=J3(t);return s?a?e.jsxs(Ne,{children:[e.jsx(Vt,{children:e.jsxs(Wt,{children:["Estadísticas (",t==="week"?"Semana":"Mes",")"]})}),e.jsx(De,{children:e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsx("p",{className:"text-gray-500",children:"Cargando estadísticas..."})})})]}):r?e.jsxs(Ne,{children:[e.jsx(Vt,{children:e.jsxs(Wt,{children:["Estadísticas (",t==="week"?"Semana":"Mes",")"]})}),e.jsx(De,{children:e.jsx("div",{className:"text-red-500",children:"Error al cargar las estadísticas. Por favor, intenta de nuevo."})})]}):n?e.jsxs(Ne,{children:[e.jsx(Vt,{children:e.jsxs(Wt,{children:["Estadísticas ",t==="week"?"de la Semana":"del Mes"]})}),e.jsx(De,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-2 text-center text-sm",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Sesiones"}),e.jsx("p",{className:"text-lg font-semibold",children:n.totalSessions})]}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Tiempo Total"}),e.jsx("p",{className:"text-lg font-semibold",children:ql(Math.floor(n.totalTime/60))})]}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Promedio/Sesión"}),e.jsx("p",{className:"text-lg font-semibold",children:ql(Math.floor(n.averageSessionTime/60))})]}),t==="week"?e.jsxs("div",{className:"space-y-0.5 col-span-2",children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Promedio diario"}),e.jsxs("p",{className:"text-lg font-semibold",children:[(o=n.averageWeekdayHours)==null?void 0:o.toFixed(1),"h/día"]})]}):e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Completitud"}),e.jsxs("p",{className:"text-lg font-semibold",children:[n.completionRate.toFixed(1),"%"]})]}),n.bestDay&&e.jsxs("div",{className:"space-y-0.5 col-span-2",children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:"Mejor Día"}),e.jsx("p",{className:"text-lg font-semibold",children:ql(Math.floor(n.bestDay.minutes))}),e.jsx("p",{className:"text-xs text-gray-400",children:n.bestDay.date})]})]})})]}):e.jsxs(Ne,{children:[e.jsx(Vt,{children:e.jsxs(Wt,{children:["Estadísticas (",t==="week"?"Semana":"Mes",")"]})}),e.jsx(De,{children:e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-gray-500",children:"No hay datos disponibles"})})})]}):null},SL=({selectedDate:t,goal:s=300})=>{const[n,a]=f.useState(ts(t));f.useEffect(()=>{a(ts(t))},[t]);const r=f.useMemo(()=>ts(n),[n]),o=f.useMemo(()=>ea(n),[n]),{stats:l,loading:c}=X3(r,o),m=f.useMemo(()=>{const h={};return l==null||l.dailyStats.forEach(({date:p,minutes:g})=>{h[p]=g}),h},[l]),u=h=>{const p=$e(h.date),g=m[p]||0,x=Math.min(g/s,1),b=28,j=3,v=(b-j)/2,w=2*Math.PI*v,N=w-x*w,S=g>=s;return e.jsxs("div",{className:"relative flex items-center justify-center w-7 h-7",children:[e.jsxs("svg",{width:b,height:b,className:"absolute",children:[e.jsx("circle",{cx:b/2,cy:b/2,r:v,stroke:S?"#fecaca":"#e5e7eb",strokeWidth:j,fill:"none"}),e.jsx("circle",{cx:b/2,cy:b/2,r:v,stroke:S?"#f87171":"#9ca3af",strokeWidth:j,fill:"none",strokeDasharray:w,strokeDashoffset:N,strokeLinecap:"round",style:{transform:"rotate(-90deg)",transformOrigin:"50% 50%"}})]}),e.jsx("span",{className:"text-[10px] font-medium z-10",children:h.date.getDate()})]})};return e.jsxs(Ne,{className:"w-full",children:[e.jsxs(Vt,{className:"flex flex-col items-center gap-2",children:[e.jsx(Ji,{className:"w-5 h-5 text-red-600"}),e.jsx(Wt,{className:"text-center",children:"Historial Mensual"})]}),e.jsxs(De,{className:"relative p-4",children:[c&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/50 z-10",children:e.jsx(ls,{className:"w-6 h-6 animate-spin"})}),e.jsx(Ac,{month:n,onMonthChange:a,showOutsideDays:!0,components:{DayContent:u},className:"p-0 w-full"})]})]})};function CL(){const[t,s]=f.useState(new Date),{user:n}=qe();return n?e.jsxs(Xs,{children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Pomodoro Timer"}),e.jsx("p",{className:"text-gray-500",children:"Gestiona tus sesiones de trabajo y productividad"})]}),e.jsx(or,{selectedDate:t,onChange:s}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-[1fr_300px]",children:[e.jsx("div",{className:"space-y-6",children:e.jsx(NL,{selectedDate:t})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(SL,{selectedDate:t}),e.jsx(Pv,{dateRange:"week"}),e.jsx(Pv,{dateRange:"month"})]})]})]}):e.jsx(Xs,{children:e.jsx("div",{className:"text-center py-8",children:e.jsx("h2",{className:"text-xl font-semibold",children:"Inicia sesión para ver tus estadísticas"})})})}const EL=({onSelect:t,disabled:s})=>e.jsx("div",{className:"grid grid-cols-3 gap-2 mb-4",children:Yi.map(n=>e.jsx("div",{className:"relative",children:e.jsxs(z,{variant:"outline",onClick:()=>t(n),className:"h-12 text-lg w-full relative",disabled:s,children:[e.jsx("span",{children:n.emoji}),e.jsx("span",{className:"w-full text-center text-xs text-gray-500 mt-1",children:n.text})]})},n.emoji))}),TL=({isOpen:t,onClose:s,moodEntry:n,onSave:a,onDelete:r})=>{const[o,l]=f.useState(""),[c,m]=f.useState(!1);f.useEffect(()=>{n!=null&&n.time&&l(n.time)},[n]);const u=async()=>{if(n){m(!0);try{const[p,g]=o.split(":").map(Number),x=new Date(n.timestamp),b=cn(x,p,g);await a({...n,time:o,timestamp:b.timestamp}),s()}catch(p){console.error("Error al guardar:",p)}finally{m(!1)}}},h=async()=>{if(r){m(!0);try{await r(),s()}catch(p){console.error("Error al eliminar:",p)}finally{m(!1)}}};return e.jsx(Rt,{open:t,onOpenChange:s,children:e.jsxs(Ct,{className:"sm:max-w-md",children:[e.jsx(_t,{children:e.jsx(Pt,{children:"Editar registro"})}),e.jsxs("div",{className:"flex items-center gap-4 py-4",children:[e.jsx("span",{className:"text-2xl",children:n==null?void 0:n.emoji}),e.jsx("span",{children:n==null?void 0:n.text})]}),e.jsx("div",{className:"grid gap-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{htmlFor:"time",className:"text-sm",children:"Hora:"}),e.jsx(Be,{id:"time",type:"time",value:o,onChange:p=>l(p.target.value)})]})}),e.jsxs(wn,{className:"gap-2 sm:gap-0",children:[r&&e.jsx(z,{variant:"destructive",onClick:h,disabled:c,className:"w-full sm:w-auto",children:"Eliminar"}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsx(z,{variant:"outline",onClick:s,disabled:c,className:"flex-1 sm:flex-none",children:"Cancelar"}),e.jsx(z,{onClick:u,disabled:c,className:"flex-1 sm:flex-none",children:"Guardar"})]})]})]})})},DL=({moods:t,onUpdateMood:s,onDeleteMood:n})=>{const[a,r]=f.useState(!1),[o,l]=f.useState(null),c=[...t].sort((x,b)=>x.timestamp-b.timestamp),m=a?c:c.slice(0,3),u=t.length>3,h=x=>{l(x)},p=async x=>{o&&await s(o.timestamp,x)},g=async()=>{o&&await n(o.timestamp)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-4 space-y-2",children:[m.map((x,b)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-muted rounded hover:bg-accent transition-colors",children:[e.jsx("span",{className:"text-xl",children:x.emoji}),e.jsx("span",{children:x.text}),e.jsx("span",{className:"text-gray-500 ml-auto",children:x.time}),e.jsx(z,{variant:"ghost",size:"sm",className:"ml-2 h-8 w-8 p-0",onClick:()=>h(x),children:e.jsx(Su,{className:"h-4 w-4"})})]},`${x.timestamp}_${b}`)),u&&e.jsx(z,{variant:"ghost",className:"w-full h-8 text-sm text-gray-500 hover:text-gray-900",onClick:()=>r(!a),children:a?e.jsxs("span",{className:"flex items-center gap-1",children:["Ver menos ",e.jsx(Xi,{className:"h-4 w-4"})]}):e.jsxs("span",{className:"flex items-center gap-1",children:["Ver más (",t.length-3,") ",e.jsx(_n,{className:"h-4 w-4"})]})}),t.length===0&&e.jsx("div",{className:"text-center text-gray-500 py-4",children:"No hay registros para este día"})]}),e.jsx(TL,{isOpen:o!==null,onClose:()=>l(null),moodEntry:o,onSave:p,onDelete:g})]})},kL=["bg-red-500 text-white","bg-orange-500 text-white","bg-yellow-400 text-black","bg-lime-500 text-black","bg-green-600 text-white"],AL=[vb,gb,Vh,Uh,xb],ON=({onSelect:t,disabled:s})=>{const[n,a]=f.useState(""),r=o=>{t(o,n||void 0),a("")};return e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"text",placeholder:"Comentario opcional",value:n,onChange:o=>a(o.target.value),className:"w-full border rounded p-2 text-sm"}),e.jsx("div",{className:"grid grid-cols-5 gap-2 mb-2",children:[1,2,3,4,5].map(o=>{const l=AL[o-1];return e.jsx(z,{variant:"default",className:`h-12 w-full ${kL[o-1]} flex items-center justify-center`,onClick:()=>r(o),disabled:s,children:e.jsx(l,{className:"h-5 w-5"})},o)})})]})},RL=({isOpen:t,onClose:s,energyEntry:n,onSave:a,onDelete:r})=>{const[o,l]=f.useState(""),[c,m]=f.useState(3),[u,h]=f.useState(""),[p,g]=f.useState(!1);f.useEffect(()=>{n&&(l(n.time),m(n.level),h(n.comment||""))},[n]);const x=async()=>{if(n){g(!0);try{const[j,v]=o.split(":").map(Number),w=new Date(n.timestamp),N=cn(w,j,v);await a({level:c,comment:u||void 0,time:o,timestamp:N.timestamp}),s()}finally{g(!1)}}},b=async()=>{if(!(!r||!n)){g(!0);try{await r(),s()}finally{g(!1)}}};return e.jsx(Rt,{open:t,onOpenChange:s,children:e.jsxs(Ct,{className:"sm:max-w-md",children:[e.jsx(_t,{children:e.jsx(Pt,{children:"Editar registro"})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{htmlFor:"time",className:"text-sm",children:"Hora:"}),e.jsx(Be,{id:"time",type:"time",value:o,onChange:j=>l(j.target.value)})]}),e.jsx(Be,{type:"text",placeholder:"Comentario opcional",value:u,onChange:j=>h(j.target.value)}),e.jsx(ON,{onSelect:j=>m(j),disabled:!1})]}),e.jsxs(wn,{className:"gap-2 sm:gap-0",children:[r&&e.jsx(z,{variant:"destructive",onClick:b,disabled:p,className:"w-full sm:w-auto",children:"Eliminar"}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsx(z,{variant:"outline",onClick:s,disabled:p,className:"flex-1 sm:flex-none",children:"Cancelar"}),e.jsx(z,{onClick:x,disabled:p,className:"flex-1 sm:flex-none",children:"Guardar"})]})]})]})})},_L=["bg-red-500","bg-orange-500","bg-yellow-400","bg-lime-500","bg-green-600"],PL=({entries:t,onUpdate:s,onDelete:n})=>{const[a,r]=f.useState(!1),[o,l]=f.useState(null),c=[...t].sort((p,g)=>p.timestamp-g.timestamp),m=t.length>0?Math.round(t.reduce((p,g)=>p+g.level,0)/t.length*10)/10:0,u=async p=>{o&&(await s(o.timestamp,p),l(null))},h=async()=>{o&&(await n(o.timestamp),l(null))};return e.jsxs(e.Fragment,{children:[e.jsx(Cp,{type:"single",collapsible:!0,value:a?"history":"",onValueChange:p=>r(!!p),children:e.jsxs(Bu,{value:"history",className:"border-none",children:[e.jsx(Hu,{className:"w-full h-11 flex items-center justify-between gap-2 border rounded-lg bg-background hover:bg-accent data-[state=open]:rounded-b-none",children:e.jsx("span",{className:"text-sm font-semibold",children:"Historial de hoy"})}),e.jsxs(Wu,{className:"mt-2 space-y-2",children:[c.length===0?e.jsx("div",{className:"text-center text-gray-500 text-sm py-2",children:"No hay registros para este día"}):c.map((p,g)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-muted rounded",children:[e.jsx("span",{className:`w-3 h-3 rounded-full ${_L[p.level-1]}`}),e.jsxs("span",{className:"text-sm",children:["Nivel ",p.level]}),p.comment&&e.jsx("span",{className:"text-sm flex-1",children:p.comment}),e.jsx("span",{className:"text-gray-500 ml-auto text-sm",children:p.time}),e.jsx(z,{variant:"ghost",size:"sm",className:"ml-2 h-8 w-8 p-0",onClick:()=>l(p),children:e.jsx(Su,{className:"h-4 w-4"})})]},`${p.timestamp}_${g}`)),c.length>0&&e.jsxs("div",{className:"text-center text-xs text-muted-foreground",children:["Promedio del día: ",m]})]})]})}),e.jsx(RL,{isOpen:o!==null,onClose:()=>l(null),energyEntry:o,onSave:u,onDelete:h})]})},kt=f.forwardRef(({className:t,...s},n)=>e.jsx("textarea",{className:ce("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:n,...s}));kt.displayName="Textarea";const ML=Wo("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Zo=f.forwardRef(({className:t,variant:s,...n},a)=>e.jsx("div",{ref:a,role:"alert",className:ce(ML({variant:s}),t),...n}));Zo.displayName="Alert";const IL=f.forwardRef(({className:t,...s},n)=>e.jsx("h5",{ref:n,className:ce("mb-1 font-medium leading-none tracking-tight",t),...s}));IL.displayName="AlertTitle";const Qo=f.forwardRef(({className:t,...s},n)=>e.jsx("div",{ref:n,className:ce("text-sm [&_p]:leading-relaxed",t),...s}));Qo.displayName="AlertDescription";const OL=()=>{const[t,s]=f.useState(!1),[n,a]=f.useState(""),[r,o]=f.useState(null),[l,c]=f.useState(!1),{user:m}=qe(),u=async()=>{var p;if(!(!m||!n.trim())){c(!0),o(null);try{const g=JSON.parse(n);if(!Array.isArray(g))throw new Error("El JSON debe ser un array de objetos");let x=0;for(const b of g){if(!b.date||!Array.isArray(b.moods)){console.warn("Datos inválidos para un día:",b);continue}const j=`${m.uid}_${b.date}`,v=Te($t(fe,"moods"),j),w=await st(v),N=w.exists()?((p=w.data())==null?void 0:p.moods)||[]:[],S=b.moods.map((k,D)=>{let P,_;if(k.time){P=k.time;const[B,I]=k.time.split(":").map(Number),R=new Date(b.date);R.setHours(B,I,0,0),_=R.getTime()}else if(k.hour!==void 0&&k.minute!==void 0){P=`${k.hour.toString().padStart(2,"0")}:${k.minute.toString().padStart(2,"0")}`;const B=new Date(b.date);B.setHours(k.hour,k.minute,0,0),_=B.getTime()}else{const B=new Date,I=B.getHours(),R=B.getMinutes()+D;P=`${I.toString().padStart(2,"0")}:${(R%60).toString().padStart(2,"0")}`;const M=new Date(b.date);_=cn(M,I,R%60).timestamp}return{emoji:k.emoji,text:k.text,time:P,timestamp:_}}),E=[...N,...S],T={id:j,userId:m.uid,date:b.date,moods:E};await qt(v,T),x+=S.length}vt.success(`Se importaron ${x} estados de ánimo correctamente`),a(""),s(!1)}catch(g){const x=g instanceof Error?g.message:"Error al importar estados de ánimo";o(x),vt.error(x)}finally{c(!1)}}};return e.jsxs(Rt,{open:t,onOpenChange:s,children:[e.jsx(Rj,{asChild:!0,children:e.jsxs(z,{variant:"outline",size:"sm",children:[e.jsx(Qi,{className:"h-4 w-4 mr-2"}),"Importar Estados"]})}),e.jsxs(Ct,{className:"max-w-2xl",children:[e.jsx(_t,{children:e.jsx(Pt,{children:"Importar Estados de Ánimo desde JSON"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:'Pegue el JSON con los estados de ánimo a importar. El campo "time" es opcional.'}),e.jsxs("details",{className:"text-xs text-gray-500",children:[e.jsx("summary",{className:"cursor-pointer hover:text-gray-700",children:"Ver ejemplo de formato"}),e.jsx("pre",{className:"mt-2 p-2 bg-gray-50 rounded text-xs overflow-x-auto",children:`[
  {
    "date": "2024-01-15",
    "moods": [
      {
        "emoji": "😊",
        "text": "Feliz",
        "time": "09:30"
      },
      {
        "emoji": "😌",
        "text": "Tranquilo",
        "hour": 14,
        "minute": 15
      },
      {
        "emoji": "🤔",
        "text": "Pensativo"
      }
    ]
  }
]`})]})]}),e.jsx(kt,{value:n,onChange:p=>a(p.target.value),placeholder:"Pegue aquí el JSON con los estados de ánimo...",className:"min-h-[200px] font-mono text-sm"}),r&&e.jsxs(Zo,{variant:"destructive",children:[e.jsx(yc,{className:"h-4 w-4"}),e.jsx(Qo,{children:r})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(z,{variant:"outline",onClick:()=>s(!1),children:"Cancelar"}),e.jsx(z,{onClick:u,disabled:!n.trim()||l,children:l?"Importando...":"Importar"})]})]})]})]})},Ba=RA,Ha=_A,LL=PA,LN=f.forwardRef(({className:t,inset:s,children:n,...a},r)=>e.jsxs(Zy,{ref:r,className:ce("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",s&&"pl-8",t),...a,children:[n,e.jsx(rr,{className:"ml-auto h-4 w-4"})]}));LN.displayName=Zy.displayName;const $N=f.forwardRef(({className:t,...s},n)=>e.jsx(Qy,{ref:n,className:ce("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...s}));$N.displayName=Qy.displayName;const pa=f.forwardRef(({className:t,sideOffset:s=4,...n},a)=>e.jsx(AA,{children:e.jsx(eb,{ref:a,sideOffset:s,className:ce("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...n})}));pa.displayName=eb.displayName;const Lt=f.forwardRef(({className:t,inset:s,...n},a)=>e.jsx(tb,{ref:a,className:ce("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s&&"pl-8",t),...n}));Lt.displayName=tb.displayName;const $L=f.forwardRef(({className:t,children:s,checked:n,...a},r)=>e.jsxs(sb,{ref:r,className:ce("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:n,...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(nb,{children:e.jsx(ro,{className:"h-4 w-4"})})}),s]}));$L.displayName=sb.displayName;const zL=f.forwardRef(({className:t,children:s,...n},a)=>e.jsxs(ab,{ref:a,className:ce("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...n,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(nb,{children:e.jsx(Hf,{className:"h-2 w-2 fill-current"})})}),s]}));zL.displayName=ab.displayName;const FL=f.forwardRef(({className:t,inset:s,...n},a)=>e.jsx(rb,{ref:a,className:ce("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",t),...n}));FL.displayName=rb.displayName;const el=f.forwardRef(({className:t,...s},n)=>e.jsx(ib,{ref:n,className:ce("-mx-1 my-1 h-px bg-muted",t),...s}));el.displayName=ib.displayName;const BL={entry:"",setEntry:()=>{}},zN=f.createContext(BL),HL=({children:t})=>{const[s,n]=f.useState("");return e.jsx(zN.Provider,{value:{entry:s,setEntry:n},children:t})},FN=()=>f.useContext(zN),WL={isUnlocked:!1,setUnlocked:()=>{}},BN=f.createContext(WL),UL=({children:t})=>{const[s,n]=f.useState(!1);return e.jsx(BN.Provider,{value:{isUnlocked:s,setUnlocked:n},children:t})},Dp=()=>f.useContext(BN),ba=t=>t.trim().split(/\s+/).filter(Boolean).length,ri=va("mood"),VL=ri?`https://generativelanguage.googleapis.com/v1beta/models/${ri.model}:generateContent`:"",GL=({selectedDate:t,open:s,onOpenChange:n})=>{const{user:a}=qe(),{entry:r}=FN(),{isUnlocked:o}=Dp(),[l,c]=f.useState(!1),m=s!==void 0?s:l,u=n??c,[h,p]=f.useState(!1),[g,x]=f.useState([]),[b,j]=f.useState(""),[v,w]=f.useState(0),N="AIzaSyAW4Ot-z7OH4ZR3OeaN7vcbkEDlWpo1aMY",S=Yi.map(I=>I.text).join(", "),E=(ri==null?void 0:ri.prompt)??'Analiza la siguiente entrada del diario y sugiere estados de ánimo en formato JSON: [{"emoji":"","text":"","time":"HH:mm","reason":""}]',T=ri==null?void 0:ri.params;if(f.useEffect(()=>{m&&o&&(async()=>{const I=r||await k();j(`${E}
Moods disponibles: ${S}. Solo usa estos valores.
${I}`)})()},[m,r,o]),f.useEffect(()=>{w(ba(b))},[b]),!o)return null;const k=async()=>{if(!a)return"";const I=$e(t),R=Te(fe,"journal",`${a.uid}_${I}`),M=await st(R);return M.exists()&&M.data().text||""},D=I=>{try{const R=I.match(/\[[\s\S]*\]/);if(!R)return[];const M=JSON.parse(R[0]);if(!Array.isArray(M))return[];const W=new Set(Yi.map($=>$.text)),H={mañana:"09:00",tarde:"15:00",noche:"21:00"},L=new Map(Yi.map($=>[$.text,$.emoji]));return M.filter($=>W.has($.text)).map($=>({...$,emoji:$.emoji||L.get($.text)||"",time:$.time||H[$.timeOfDay??""]||"12:00"}))}catch{return[]}},P=async I=>{var R,M,W,H,L;p(!0);try{if(!I.trim()){x([]);return}const q=await(await fetch(`${VL}?key=${N}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:I}]}],...T})})).json(),re=((L=(H=(W=(M=(R=q==null?void 0:q.candidates)==null?void 0:R[0])==null?void 0:M.content)==null?void 0:W.parts)==null?void 0:H[0])==null?void 0:L.text)||"",Y=D(re);x(Y)}catch{x([])}finally{p(!1)}},_=async I=>{if(!a)return;const R=$e(t),M=`${a.uid}_${R}`,W=Te($t(fe,"moods"),M);let H=12,L=0;if(I.time){const[U,ee]=I.time.split(":").map(Number);H=U??12,L=ee??0}else I.timeOfDay&&(H={mañana:9,tarde:15,noche:21}[I.timeOfDay]??12);const $=`${H.toString().padStart(2,"0")}:${L.toString().padStart(2,"0")}`,q=cn(t,H,L),re=await st(W),Y=re.exists()&&Array.isArray(re.data().moods)?re.data().moods:[],se=Yi.find(U=>U.text===I.text),ie={emoji:I.emoji||(se==null?void 0:se.emoji)||"",text:I.text,time:$,timestamp:q.timestamp};await qt(W,{id:M,userId:a.uid,date:R,moods:[...Y,ie]})},B=()=>{u(!1),x([]),j(""),w(0)};return e.jsxs(Rt,{open:m,onOpenChange:I=>I?u(!0):B(),children:[s===void 0&&e.jsxs(z,{variant:"outline",size:"sm",onClick:()=>u(!0),className:"flex items-center gap-2",children:[e.jsx($s,{className:"h-4 w-4"}),"Analizar Diario"]}),e.jsxs(Ct,{className:"max-w-2xl",children:[e.jsx(_t,{children:e.jsx(Pt,{children:"Sugerencias de estados de ánimo"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(kt,{value:b,onChange:I=>j(I.target.value),className:"max-h-[500px] overflow-y-auto"}),e.jsxs("p",{className:"text-xs text-right",children:["Tokens: ",v," ",v>3500&&e.jsx("span",{className:"text-red-500",children:"¡Prompt demasiado largo!"})]}),e.jsxs(z,{onClick:()=>P(b),disabled:h||!N,className:"w-full flex items-center justify-center gap-2",children:[h&&e.jsx(ls,{className:"h-4 w-4 animate-spin"}),h?"Consultando...":"Analizar"]}),h&&e.jsxs("p",{className:"flex items-center justify-center gap-2 text-sm",children:[e.jsx(ls,{className:"h-4 w-4 animate-spin"})," Consultando..."]}),!h&&g.map((I,R)=>e.jsxs("div",{className:"border rounded p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:I.emoji}),e.jsx("span",{children:I.text}),e.jsx("span",{className:"ml-auto text-sm text-gray-500",children:I.time})]}),I.reason&&e.jsx("p",{className:"text-sm text-gray-500",dangerouslySetInnerHTML:{__html:Fr.sanitize(I.reason)}}),e.jsx(z,{size:"sm",className:"ml-auto",onClick:()=>_(I),children:"Registrar"})]},R)),!h&&g.length===0&&e.jsx("p",{className:"text-sm text-center text-gray-500",children:"No se encontraron sugerencias"})]})]})]})},qL=({selectedDate:t})=>{const[s,n]=f.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs(Ba,{children:[e.jsx(Ha,{asChild:!0,children:e.jsxs(z,{size:"sm",variant:"outline",className:"flex items-center gap-2 text-blue-600",children:[e.jsx($s,{className:"w-4 h-4"}),"IA"]})}),e.jsx(pa,{align:"end",children:e.jsx(Lt,{onSelect:()=>n(!0),children:"Sugerir moods"})})]}),e.jsx(GL,{selectedDate:t,open:s,onOpenChange:n})]})},HN=({selectedDate:t,energyFirst:s=!1})=>{const{user:n}=qe(),{isUnlocked:a}=Dp(),{moodHistory:r,status:o,error:l,addMood:c,updateMood:m,deleteMood:u,resync:h}=dj(t),{energyHistory:p,status:g,error:x,addEntry:b,updateEntry:j,deleteEntry:v,resync:w}=kj(t),{isOnline:N}=Va(),S=p.slice().sort((P,_)=>_.timestamp-P.timestamp)[0],E=["text-red-500","text-orange-500","text-yellow-500","text-lime-600","text-green-600"];if(!n)return e.jsx(Ne,{className:"w-full",children:e.jsx(De,{className:"p-4 text-center",children:e.jsx("p",{children:"Inicia sesión para registrar tu estado de ánimo"})})});const T=$e(t)===$e(new Date),k=e.jsxs(Ne,{className:"w-full",children:[e.jsxs(De,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"font-medium",children:"Estado de ánimo"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(OL,{}),a&&e.jsx(qL,{selectedDate:t})]})]}),T&&e.jsx(EL,{onSelect:c,disabled:o==="saving"||!N}),e.jsx(DL,{moods:r,onUpdateMood:m,onDeleteMood:u}),l&&e.jsx("p",{className:"mt-2 text-sm text-red-500",children:l})]}),e.jsxs(bn,{className:"justify-center gap-2 text-xs p-2",children:[o==="saving"&&e.jsx("span",{className:"text-blue-500",children:"Guardando..."}),o==="pending"&&e.jsx("span",{className:"text-yellow-600",children:"Pendiente de sincronizar"}),o==="saved"&&e.jsx("span",{className:"text-green-600",children:"Sincronizado"}),o==="error"&&e.jsx("span",{className:"text-red-500",children:"Error al guardar"}),!N&&e.jsx("span",{className:"text-orange-600",children:"Offline"}),e.jsx(z,{onClick:h,variant:"link",className:"p-0 h-auto text-xs",children:"Reintentar"})]})]}),D=e.jsxs(Ne,{className:"w-full",children:[e.jsxs(De,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("h3",{className:"font-medium",children:["Nivel de energía",S&&e.jsxs("span",{className:`ml-2 ${E[S.level-1]}`,children:["(",S.level,")"]})]}),e.jsx("div",{className:"flex items-center gap-2"})]}),T&&e.jsx("div",{className:"mb-4",children:e.jsx(ON,{onSelect:b,disabled:g==="saving"||!N})}),e.jsx(PL,{entries:p,onUpdate:j,onDelete:v}),x&&e.jsx("p",{className:"mt-2 text-sm text-red-500",children:x})]}),e.jsxs(bn,{className:"justify-center gap-2 text-xs p-2",children:[g==="saving"&&e.jsx("span",{className:"text-blue-500",children:"Guardando..."}),g==="pending"&&e.jsx("span",{className:"text-yellow-600",children:"Pendiente de sincronizar"}),g==="saved"&&e.jsx("span",{className:"text-green-600",children:"Sincronizado"}),g==="error"&&e.jsx("span",{className:"text-red-500",children:"Error al guardar"}),!N&&e.jsx("span",{className:"text-orange-600",children:"Offline"}),e.jsx(z,{onClick:w,variant:"link",className:"p-0 h-auto text-xs",children:"Reintentar"})]})]});return e.jsxs("div",{className:"space-y-4",children:[s?D:k,s?k:D]})},Mv=["#FF8042","#00C49F","#FFBB28","#FF8042","#0088FE","#FF0000"],YL=()=>{const[t,s]=f.useState(new Date),[n]=f.useState([]);return e.jsxs(Xs,{children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Estado de Ánimo"}),e.jsx("p",{className:"text-gray-500",children:"Registra y analiza tu estado emocional para mejorar tu bienestar"})]}),e.jsx(or,{selectedDate:t,onChange:s}),e.jsxs(Ga,{defaultValue:"tracker",className:"space-y-4",children:[e.jsxs(qa,{children:[e.jsx(js,{value:"tracker",children:"Registro Diario"}),e.jsx(js,{value:"analytics",children:"Análisis"}),e.jsx(js,{value:"settings",children:"Configuración"})]}),e.jsx(hs,{value:"tracker",className:"space-y-4",children:e.jsx(HN,{selectedDate:t})}),e.jsx(hs,{value:"analytics",className:"space-y-4",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsx(Ne,{children:e.jsxs(De,{className:"pt-6",children:[e.jsx("h3",{className:"font-medium mb-4",children:"Distribución de Estados de Ánimo"}),e.jsx("div",{className:"h-64",children:e.jsx(gn,{width:"100%",height:"100%",children:e.jsxs(bc,{children:[e.jsx(jc,{data:n,cx:"50%",cy:"50%",labelLine:!1,outerRadius:80,fill:"#8884d8",dataKey:"value",label:({cx:a,cy:r,midAngle:o,innerRadius:l,outerRadius:c,value:m,index:u})=>{const h=Math.PI/180,p=25+l+(c-l),g=a+p*Math.cos(-o*h),x=r+p*Math.sin(-o*h);return e.jsx("text",{x:g,y:x,fill:"#888",textAnchor:g>a?"start":"end",dominantBaseline:"central",children:`${n[u].name} (${m})`})},children:n.map(a=>e.jsx(wc,{fill:Mv[a%Mv.length]},`cell-${a}`))}),e.jsx(vn,{})]})})})]})}),e.jsx(Ne,{children:e.jsx(De,{className:"pt-6",children:e.jsx("h3",{className:"font-medium mb-4",children:"Patrones y Tendencias"})})})]})}),e.jsxs(hs,{value:"settings",className:"space-y-4",children:[e.jsx(Ne,{children:e.jsx(De,{className:"pt-6",children:e.jsx("h3",{className:"font-medium mb-4",children:"Configuración de Estados de Ánimo"})})}),"        "]})]})]})},KL=({onLock:t})=>e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(vR,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Mi Diario"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-sm text-gray-500",children:new Date().toLocaleDateString("es-ES",{weekday:"long",day:"numeric",month:"long"})})}),e.jsx(z,{variant:"ghost",size:"icon",onClick:t,title:"Bloquear diario",children:e.jsx(bb,{className:"w-4 h-4"})})]})]}),JL=({value:t,onChange:s})=>e.jsx(kt,{value:t,onChange:n=>s(n.target.value),placeholder:"¿Cómo ha sido tu día?",className:"w-full h-64 resize-none"}),WN=({lastUpdated:t,className:s=""})=>t?e.jsxs("div",{className:`flex items-center gap-2 text-sm text-gray-500 ${s}`,children:[e.jsx(Js,{className:"w-4 h-4"}),e.jsxs("span",{children:["Última actualización: ",t]})]}):null,XL=({onUnlock:t,lastUpdated:s})=>{const[n,a]=f.useState(""),[r,o]=f.useState(!1),l=c=>{c.preventDefault(),n==="1234"?(t(),o(!1)):o(!0)};return e.jsx(Ne,{className:"w-full",children:e.jsx(De,{className:"p-4",children:e.jsxs("form",{onSubmit:l,className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx(bb,{className:"w-12 h-12 text-blue-500"})}),e.jsx("h3",{className:"text-center text-lg font-medium",children:"Diario Protegido"}),e.jsx("p",{className:"text-center text-sm text-gray-500",children:"Ingresa la contraseña para acceder a tu diario"}),e.jsx(Be,{type:"password",value:n,onChange:c=>a(c.target.value),placeholder:"Contraseña",className:r?"border-destructive focus-visible:ring-destructive":""}),r&&e.jsx("p",{className:"text-sm text-red-500 text-center",children:"Contraseña incorrecta"}),e.jsx(z,{type:"submit",className:"w-full",children:"Desbloquear"}),e.jsx(WN,{lastUpdated:s,className:"justify-center"})]})})})},ZL=Wo("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}}),Ht=f.forwardRef(({className:t,variant:s,...n},a)=>e.jsx("div",{ref:a,className:ce(ZL({variant:s}),t),...n}));Ht.displayName="Badge";const kp={PERSONAL:"personal",WORK:"work",HOME:"home",HEALTH:"health",SHOPPING:"shopping",STUDY:"study",SOCIAL:"social",OTHER:"other"},Un={personal:"Personal",work:"Trabajo",home:"Casa",health:"Salud",shopping:"Compras",study:"Estudio",social:"Social",other:"Otro"},no={personal:{bg:"bg-purple-100",text:"text-purple-700"},work:{bg:"bg-blue-100",text:"text-blue-700"},home:{bg:"bg-green-100",text:"text-green-700"},health:{bg:"bg-red-100",text:"text-red-700"},shopping:{bg:"bg-yellow-100",text:"text-yellow-700"},study:{bg:"bg-indigo-100",text:"text-indigo-700"},social:{bg:"bg-pink-100",text:"text-pink-700"},other:{bg:"bg-gray-100",text:"text-gray-700"}},QL={daily:"Diario",weekly:"Semanal",monthly:"Mensual"},Iv={do:{label:"HACER",color:"bg-red-500",text:"Urgente e importante"},decide:{label:"DECIDIR",color:"bg-orange-500",text:"Importante, no urgente"},delegate:{label:"DELEGAR",color:"bg-blue-500",text:"Urgente, no importante"},delete:{label:"ELIMINAR",color:"bg-gray-500",text:"Ni urgente ni importante"},none:{label:"",color:"",text:""}},Ov=t=>at(t,"dd/MM"),e$=t=>t!=null&&t.type&&QL[t.type]||"",t$=(t="none")=>Iv[t]||Iv.none,s$=t=>t?Ds(cs(t),cs(new Date)):!1,UN=f.memo(({task:t,onEdit:s,onDelete:n,onView:a})=>{const r=Xt(),o=f.useCallback(u=>{u.stopPropagation(),s(t)},[s,t]),l=f.useCallback(u=>{u.stopPropagation(),a==null||a(t)},[a,t]),c=f.useCallback(u=>{u.stopPropagation(),r(`/task/${t.taskCode}/run`)},[r,t.taskCode]),m=f.useCallback(()=>{n(t.id)},[n,t.id]);return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(z,{variant:"ghost",size:"sm",onClick:c,className:"h-7 w-7 p-0 text-green-600 hover:text-green-700 hover:bg-green-50",title:"Ejecutar tarea",children:e.jsx(yn,{className:"h-3 w-3"})}),e.jsx(z,{variant:"ghost",size:"sm",onClick:o,className:"h-7 w-7 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",title:"Editar tarea",children:e.jsx(sa,{className:"h-3 w-3"})}),e.jsx(z,{variant:"ghost",size:"sm",onClick:l,className:"h-7 w-7 p-0 text-gray-600 hover:text-gray-700 hover:bg-gray-100",title:"Ver detalles",children:e.jsx(ac,{className:"h-3 w-3"})}),e.jsxs(Ba,{children:[e.jsx(Ha,{asChild:!0,children:e.jsx(z,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0 hover:bg-gray-50",onClick:u=>u.stopPropagation(),children:e.jsx(yR,{className:"w-3 h-3"})})}),e.jsx(pa,{align:"end",className:"w-48",children:e.jsxs(Ur,{children:[e.jsx(ki,{asChild:!0,children:e.jsxs(Lt,{onSelect:u=>u.preventDefault(),className:"text-sm text-red-600 focus:text-red-600",children:[e.jsx("span",{className:"mr-2",children:"🗑️"}),"Eliminar tarea"]})}),e.jsxs(mr,{children:[e.jsxs(hr,{children:[e.jsx(pr,{children:"¿Eliminar tarea?"}),e.jsxs(xr,{children:['Esta acción no se puede deshacer. La tarea "',t.title,'" será eliminada permanentemente.']})]}),e.jsxs(fr,{children:[e.jsx(vr,{children:"Cancelar"}),e.jsx(gr,{onClick:m,className:"bg-red-600 hover:bg-red-700",children:"Eliminar"})]})]})]})})]})]})});UN.displayName="CompactTaskActions";const fc=f.memo(({task:t,onDelete:s,onEdit:n,onView:a,onMove:r,onAssignTimeOfDay:o,showCategoryLabel:l=!0})=>{const c=Xt(),m=s$(t.startDate??null),u=t$(t.priority),h=f.useCallback(()=>{a==null||a(t)},[a,t]),p=()=>t.completed?"default":m?"destructive":"secondary",g=()=>t.completed?e.jsx(Uo,{className:"h-3 w-3"}):m?e.jsx(Js,{className:"h-3 w-3"}):e.jsx(ns,{className:"h-3 w-3"}),x=()=>{if(t.completed)return"Completada";if(m)return"Vencida";if(t.startDate){const b=cs(new Date),j=es(b,1);if(Ds(t.startDate,cs(es(b,1))))return"Hoy";if(Ds(t.startDate,cs(es(j,1))))return"Mañana"}return"Pendiente"};return e.jsxs("div",{className:"hover:bg-gray-50 transition-colors cursor-pointer",onClick:h,children:[e.jsx("div",{className:"md:hidden",children:e.jsx(Ne,{className:ce("border border-gray-200 bg-white m-2",t.completed&&"opacity-75",!t.completed&&m&&"border-l-4 border-l-red-500 bg-red-50/30"),children:e.jsx(De,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[l&&e.jsx("div",{className:"flex-shrink-0 mt-1",children:e.jsx(ic,{className:"h-4 w-4 text-gray-400"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:ce("text-sm font-medium text-gray-900 flex-1",t.completed&&"line-through text-gray-500"),children:t.title}),e.jsxs("span",{className:"text-xs font-mono text-gray-400",children:["#",t.taskCode]})]}),t.description&&e.jsx("p",{className:ce("text-xs text-gray-500 mt-1 line-clamp-2",t.completed&&"line-through"),children:t.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ht,{variant:p(),className:"text-xs",children:e.jsxs("div",{className:"flex items-center gap-1",children:[g(),e.jsx("span",{children:x()})]})}),t.isPrivate&&e.jsx(Ht,{variant:"outline",className:"text-xs",children:"🔒"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500",children:[l&&e.jsx("span",{children:Un[t.category]}),t.estimatedTime&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{children:[t.estimatedTime,"m"]})]}),t.startDate&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsx("span",{children:Ov(t.startDate)})]}),u.label&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsx("span",{children:u.label})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(z,{variant:"ghost",size:"sm",onClick:b=>{b.stopPropagation(),c(`/task/${t.taskCode}/run`)},className:"h-6 w-6 p-0 text-green-600",children:e.jsx(yn,{className:"h-3 w-3"})}),e.jsx(z,{variant:"ghost",size:"sm",onClick:b=>{b.stopPropagation(),n(t)},className:"h-6 w-6 p-0 text-blue-600",children:e.jsx(sa,{className:"h-3 w-3"})})]})]})]})})})}),e.jsxs("div",{className:"hidden md:grid grid-cols-12 gap-4 p-4 border-b border-gray-100",children:[e.jsx("div",{className:"col-span-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[l&&e.jsx("div",{className:"flex-shrink-0 mt-1",children:e.jsx(ic,{className:"h-4 w-4 text-gray-400"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:ce("text-sm font-medium text-gray-900 flex-1",t.completed&&"line-through text-gray-500"),children:t.title}),e.jsxs("span",{className:"text-xs font-mono text-gray-400",children:["#",t.taskCode]})]}),t.description&&e.jsx("p",{className:ce("text-xs text-gray-500 mt-1 line-clamp-1",t.completed&&"line-through"),children:t.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[l&&e.jsx("span",{className:"text-xs text-gray-500",children:Un[t.category]}),t.isPrivate&&e.jsx(Ht,{variant:"outline",className:"text-xs",children:"🔒 Privada"}),t.isRecurrent&&e.jsxs(Ht,{variant:"outline",className:"text-xs",children:[e.jsx(Uf,{className:"w-3 h-3 mr-1"}),e$(t.recurrence)]})]})]})]})}),e.jsx("div",{className:"col-span-2 flex justify-center items-center",children:e.jsx(Ht,{variant:p(),className:"text-xs",children:e.jsxs("div",{className:"flex items-center gap-1",children:[g(),e.jsx("span",{children:x()})]})})}),e.jsx("div",{className:"col-span-1 flex justify-center items-center",children:u.label?e.jsx(Ht,{variant:"outline",className:"text-xs",style:{backgroundColor:u.color+"20",color:u.color},children:u.label}):e.jsx("span",{className:"text-xs text-gray-400",children:"Sin prioridad"})}),e.jsx("div",{className:"col-span-1 flex justify-center items-center",children:t.estimatedTime?e.jsxs("span",{className:"text-xs text-gray-600",children:[t.estimatedTime,"m"]}):e.jsx("span",{className:"text-xs text-gray-400",children:"-"})}),e.jsx("div",{className:"col-span-2 flex justify-center items-center",children:t.startDate?e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-600",children:[e.jsx(ns,{className:"h-3 w-3"}),e.jsx("span",{children:Ov(t.startDate)})]}):e.jsx("span",{className:"text-xs text-gray-400",children:"Sin fecha"})}),e.jsx("div",{className:"col-span-2 flex justify-center items-center",children:e.jsx(UN,{task:t,onEdit:n,onDelete:s,onView:a,onMove:r,onAssignTimeOfDay:o})})]})]})});fc.displayName="TaskItemList";const n$=t=>{const s={do:{label:"HACER",color:"bg-red-500",text:"Urgente e importante",urgent:!0,important:!0},decide:{label:"DECIDIR",color:"bg-yellow-500",text:"Importante pero no urgente",urgent:!1,important:!0},delegate:{label:"DELEGAR",color:"bg-blue-500",text:"Urgente pero no importante",urgent:!0,important:!1},delete:{label:"ELIMINAR",color:"bg-gray-500",text:"Ni urgente ni importante",urgent:!1,important:!1},none:{label:"",color:"",text:"",urgent:!1,important:!1}};return s[t]||s.none},a$=t=>{if(!t)return"";if(t<60)return`${t} min`;{const s=Math.floor(t/60),n=t%60;return n===0?`${s}h`:`${s}h ${n}min`}},Vu=({task:t,isOpen:s,onClose:n,onEdit:a,onToggle:r,onDelete:o})=>{if(!t)return null;const l=Xt(),c=no[t.category],m=n$(t.priority),u=t.isRecurrent&&t.recurrence?aj(t.startDate||new Date,t.recurrence.pattern,t.recurrence.customDays):"",h=t.startDate&&Ds(cs(t.startDate),cs(new Date)),{total:p,checked:g}=_u(t.description||""),x=p>0,b=x?t.progress??g/p*100:0,j=Tj(t.description||"");return e.jsx(Rt,{open:s,onOpenChange:v=>{v||n()},children:e.jsxs(Ct,{className:"max-w-5xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[e.jsxs("div",{className:"col-span-12 md:col-span-8 space-y-6",children:[e.jsx(_t,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[t.isPrivate&&e.jsx("span",{className:"text-lg mt-1",children:"🔒"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(Pt,{className:"text-2xl font-semibold leading-tight break-words text-gray-900",children:t.title}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["en lista ",e.jsx("span",{className:"font-medium",children:Un[t.category]})]}),e.jsx("div",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-md bg-gray-100 text-gray-700",children:e.jsxs("span",{className:"text-xs font-mono",children:["#",t.taskCode]})})]})]})]})}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[t.startDate&&e.jsxs("div",{className:`inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium ${h?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"}`,children:[e.jsx("span",{children:"📅"}),PM(t.startDate),h&&" (Vencida)"]}),t.timeOfDay&&e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium bg-orange-100 text-orange-800",children:[e.jsx("span",{children:"🕐"}),t.timeOfDay==="morning"&&"Mañana",t.timeOfDay==="afternoon"&&"Tarde",t.timeOfDay==="evening"&&"Noche"]})]}),t.description&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx("span",{children:"📝"}),"Descripción"]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("div",{className:"prose prose-sm max-w-none text-gray-700",dangerouslySetInnerHTML:{__html:j}}),x&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Progreso de elementos"}),e.jsxs("span",{className:"text-gray-600",children:[g," de ",p," completados"]})]}),e.jsx(Vn,{value:b,className:"h-2"})]})]})]}),t.priority&&m.text||t.isRecurrent&&u?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center gap-2",children:[e.jsx("span",{children:"�"}),"Detalles adicionales"]}),t.priority&&m.text&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Matriz de Eisenhower"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:m.text}),e.jsxs("div",{className:"flex gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"Urgente:"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${m.urgent?"bg-red-100 text-red-800":"bg-gray-100 text-gray-600"}`,children:m.urgent?"Sí":"No"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"Importante:"}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${m.important?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-600"}`,children:m.important?"Sí":"No"})]}),m.label&&e.jsxs("div",{className:`inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium text-white ${m.color}`,children:[e.jsx("span",{children:"⚡"}),m.label]})]})]})]}):null]}),e.jsxs("div",{className:"col-span-12 md:col-span-4 space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 uppercase tracking-wide",children:"Acciones"}),e.jsxs("div",{className:"space-y-2",children:[r&&e.jsx(z,{onClick:()=>r(t.id,!t.completed),variant:t.completed?"outline":"default",className:"w-full justify-start gap-2",children:t.completed?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"↩️"}),"Marcar pendiente"]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"✅"}),"Marcar completada"]})}),e.jsxs(z,{onClick:()=>l(`/task/${t.taskCode}/run`),variant:"outline",className:"w-full justify-start gap-2",children:[e.jsx(yn,{className:"w-4 h-4"}),"Ejecutar"]}),e.jsxs(z,{onClick:()=>a(t),variant:"outline",className:"w-full justify-start gap-2",children:[e.jsx("span",{children:"✏️"}),"Editar"]}),o&&e.jsxs(Ur,{children:[e.jsx(ki,{asChild:!0,children:e.jsxs(z,{variant:"outline",className:"w-full justify-start gap-2 text-red-600 hover:text-red-700 hover:bg-red-50",children:[e.jsx("span",{children:"🗑️"}),"Eliminar"]})}),e.jsxs(mr,{children:[e.jsxs(hr,{children:[e.jsx(pr,{children:"¿Eliminar tarea?"}),e.jsxs(xr,{children:['Esta acción no se puede deshacer. La tarea "',t.title,'" será eliminada permanentemente.']})]}),e.jsxs(fr,{children:[e.jsx(vr,{children:"Cancelar"}),e.jsx(gr,{onClick:()=>{o(t.id),n()},className:"bg-red-600 hover:bg-red-700",children:"Eliminar"})]})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 uppercase tracking-wide",children:"Organización"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Lista"}),e.jsxs("div",{className:`inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium ${c.bg} ${c.text}`,children:[e.jsx("span",{children:"📋"}),Un[t.category]]})]}),t.size&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Tamaño"}),e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium bg-gray-100 text-gray-800",children:[e.jsx("span",{children:"📏"}),t.size]})]}),t.estimatedTime&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Tiempo estimado"}),e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium bg-emerald-100 text-emerald-800",children:[e.jsx("span",{children:"⏱️"}),a$(t.estimatedTime)]})]}),t.isRecurrent&&u&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Recurrencia"}),e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-sm font-medium bg-purple-100 text-purple-800",children:[e.jsx("span",{children:"🔄"}),u]})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"text-sm text-gray-500 pt-2 border-t",children:[e.jsx("p",{className:"font-medium text-gray-600 mb-1",children:"Creada"}),t.createdAt?new Date(t.createdAt.seconds*1e3).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):"Recientemente"]})})]})]}),e.jsx(wn,{className:"mt-6 border-t pt-4",children:e.jsx(z,{variant:"outline",onClick:n,children:"Cerrar"})})]})})},r$=({value:t,onChange:s,multiline:n})=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(bR,{className:"w-4 h-4"}),"Título"]}),n?e.jsx(kt,{value:t,onChange:a=>s(a.target.value),placeholder:"Una tarea por línea",className:"min-h-[120px]"}):e.jsx(Be,{value:t,onChange:a=>s(a.target.value),placeholder:"Título de la tarea..."})]}),i$=({textAreaRef:t,value:s,onChange:n})=>{const a=f.useCallback(()=>{const c=t.current;if(!c)return;const{selectionStart:m,selectionEnd:u}=c,h=s.split(`
`);let p=0,g=0;for(let j=0;j<h.length;j++){if(p+h[j].length+1>m){g=j;break}p+=h[j].length+1}if(g===0)return;const x=h[g];h[g]=h[g-1],h[g-1]=x;const b=h.join(`
`);n(b),setTimeout(()=>{const j=h[g-1].length,v=m-p,w=p-j-1+v,N=u-p+w;c.setSelectionRange(Math.max(0,w),Math.max(0,N)),c.focus()},0)},[t,s,n]),r=f.useCallback(()=>{const c=t.current;if(!c)return;const{selectionStart:m,selectionEnd:u}=c,h=s.split(`
`);let p=0,g=0;for(let j=0;j<h.length;j++){if(p+h[j].length+1>m){g=j;break}p+=h[j].length+1}if(g===h.length-1)return;const x=h[g];h[g]=h[g+1],h[g+1]=x;const b=h.join(`
`);n(b),setTimeout(()=>{const j=h[g+1].length,v=m-p,w=p+j+1+v,N=u-p+w;c.setSelectionRange(w,N),c.focus()},0)},[t,s,n]),o=f.useCallback(()=>{var v;const c=t.current;if(!c)return;const{selectionStart:m,selectionEnd:u}=c,h=s.split(`
`);let p=0,g=0;for(let w=0;w<h.length;w++){if(p+h[w].length+1>m){g=w;break}p+=h[w].length+1}const x=h[g];let b=x;if(x.match(/^\s*-\s*\[\s*\]\s*/))b=x.replace(/^\s*-\s*\[\s*\]\s*/,"- [x] ");else if(x.match(/^\s*-\s*\[x\]\s*/i))b=x.replace(/^\s*-\s*\[x\]\s*/i,"- [ ] ");else{const w=((v=x.match(/^\s*/))==null?void 0:v[0])||"",N=x.slice(w.length);b=w+"- [ ] "+N}h[g]=b;const j=h.join(`
`);n(j),setTimeout(()=>{const w=b.length-x.length,N=m+(m>p?w:0),S=u+w;c.setSelectionRange(N,S),c.focus()},0)},[t,s,n]);return{handleKeyDown:f.useCallback(c=>{if(c.altKey&&c.key==="ArrowUp"){c.preventDefault(),a();return}if(c.altKey&&c.key==="ArrowDown"){c.preventDefault(),r();return}if(c.ctrlKey&&c.key==="l"){c.preventDefault(),o();return}},[a,r,o]),moveLineUp:a,moveLineDown:r,toggleCheckboxLine:o}},o$=({value:t,onChange:s})=>{const n=f.useRef(null),{handleKeyDown:a}=i$({textAreaRef:n,value:t,onChange:s});return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(jR,{className:"w-4 h-4"}),"Descripción de la tarea",e.jsx("span",{className:"text-xs text-gray-500 ml-2",children:"(Alt+↑↓ mover líneas, Ctrl+L toggle checkbox)"})]}),e.jsx(kt,{ref:n,value:t,onChange:r=>s(r.target.value),onKeyDown:a,placeholder:"Agrega más detalles sobre la tarea...",className:"min-h-[250px] resize-y"})]})},lr=({className:t})=>{const[s,n]=f.useState(0);return f.useEffect(()=>{const a=setInterval(()=>{n(r=>{const o=r+5;return o>=100?(clearInterval(a),100):o})},500);return()=>clearInterval(a)},[]),e.jsxs("div",{className:`flex items-center gap-2 ${t??""}`,children:[e.jsx(Vn,{value:s,className:"flex-1"}),e.jsxs("span",{className:"text-xs text-muted-foreground w-8 text-right",children:[s,"%"]})]})},ii=va("task"),l$=ii?`https://generativelanguage.googleapis.com/v1beta/models/${ii.model}:generateContent`:"",c$=({title:t,description:s,onInsert:n})=>{var w;const[a,r]=f.useState(!1),[o,l]=f.useState(""),[c,m]=f.useState(""),[u,h]=f.useState(!1),[p,g]=f.useState(0),x="AIzaSyAW4Ot-z7OH4ZR3OeaN7vcbkEDlWpo1aMY",b=((w=ii==null?void 0:ii.prompts)==null?void 0:w.breakdown)??"Desglosa la siguiente tarea en subtareas concretas y accionables:",j=ii==null?void 0:ii.params;f.useEffect(()=>{a&&l(`${b}
Tarea: ${t}
Descripcion: ${s}`)},[a,t,s]),f.useEffect(()=>{g(ba(o))},[o]);const v=async()=>{var N,S,E,T,k;if(t){h(!0);try{const P=await(await fetch(`${l$}?key=${x}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:o}]}],...j})})).json(),_=(k=(T=(E=(S=(N=P==null?void 0:P.candidates)==null?void 0:N[0])==null?void 0:S.content)==null?void 0:E.parts)==null?void 0:T[0])==null?void 0:k.text;m(_||"No se pudo obtener sugerencia")}catch{m("Error al consultar la API")}finally{h(!1)}}};return e.jsxs(e.Fragment,{children:[e.jsxs(z,{type:"button",variant:"outline",size:"sm",onClick:()=>r(!0),className:"flex items-center gap-2",children:[e.jsx($s,{className:"w-4 h-4"})," Subtareas IA"]}),e.jsx(Rt,{open:a,onOpenChange:r,children:e.jsxs(Ct,{className:"w-[95vw] h-[90vh] max-w-none max-h-none overflow-hidden flex flex-col sm:w-[90vw] sm:h-[85vh]",children:[e.jsxs(_t,{className:"flex-shrink-0",children:[e.jsx(Pt,{className:"text-xl",children:"Desglose de Tarea con IA"}),e.jsx(rn,{children:"La IA descompondrá tu tarea en subtareas concretas y accionables. Usa el panel izquierdo para editar el prompt y visualiza el resultado en el panel derecho."})]}),e.jsxs("div",{className:"flex-1 flex flex-col sm:flex-row gap-4 min-h-0 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[e.jsxs("div",{className:"flex-1 flex flex-col mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2 flex-shrink-0",children:"Prompt para IA"}),e.jsx(kt,{value:o,onChange:N=>l(N.target.value),className:"flex-1 resize-none min-h-0",placeholder:"Escribe o modifica el prompt para la IA..."})]}),e.jsxs("div",{className:"flex flex-col gap-3 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"text-gray-500",children:["Tokens: ",p]}),p>3500&&e.jsx("span",{className:"text-red-500 font-medium",children:"¡Prompt demasiado largo!"})]}),e.jsxs(z,{onClick:v,disabled:u||!x||p>3500,className:"w-full flex items-center justify-center gap-2",size:"lg",children:[u&&e.jsx(ls,{className:"w-4 h-4 animate-spin"}),e.jsx($s,{className:"w-4 h-4"}),u?"Consultando IA...":"Obtener subtareas"]}),u&&e.jsx(lr,{className:"mt-2"})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 sm:border-l sm:border-gray-200 sm:pl-4 border-t sm:border-t-0 border-gray-200 pt-4 sm:pt-0",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Resultado"}),c&&e.jsxs(z,{type:"button",size:"sm",variant:"outline",onClick:()=>{navigator.clipboard.writeText(c),vt.success("Texto copiado al portapapeles")},className:"flex items-center gap-1",children:[e.jsx(Ua,{className:"w-4 h-4"}),"Copiar"]})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[e.jsx(kt,{readOnly:!0,value:c||(u?"Generando subtareas...":"Las subtareas aparecerán aquí después de generar"),className:"flex-1 resize-none bg-gray-50 border-gray-200 min-h-0",placeholder:"Las subtareas aparecerán aquí..."}),c&&e.jsx("div",{className:"mt-3 flex-shrink-0",children:e.jsx(z,{type:"button",className:"w-full",onClick:()=>{n(c),vt.success("Subtareas insertadas en descripción"),r(!1),m("")},variant:"default",children:"📝 Insertar en descripción"})})]})]})]}),e.jsx("div",{className:"flex-shrink-0 mt-4 pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 text-xs text-gray-500",children:[e.jsx("span",{children:"💡 Tip: Describe tu tarea con detalle para obtener mejores subtareas"}),!x]})})]})})]})},oi=va("task"),d$=oi?`https://generativelanguage.googleapis.com/v1beta/models/${oi.model}:generateContent`:"",u$=({title:t,description:s,onInsert:n})=>{var w;const[a,r]=f.useState(!1),[o,l]=f.useState(""),[c,m]=f.useState(""),[u,h]=f.useState(!1),[p,g]=f.useState(0),x="AIzaSyAW4Ot-z7OH4ZR3OeaN7vcbkEDlWpo1aMY",b=((w=oi==null?void 0:oi.prompts)==null?void 0:w.improveDescription)??"Mejora la descripción de la tarea sin cambiar su esencia. Si no hay descripción, genera una basada en el título (máx. 150 palabras).",j=oi==null?void 0:oi.params;f.useEffect(()=>{a&&l(`${b}
Título: ${t}
Descripción actual: ${s||"N/A"}`)},[a,t,s]),f.useEffect(()=>{g(ba(o))},[o]);const v=async()=>{var N,S,E,T,k;if(t){h(!0);try{const P=await(await fetch(`${d$}?key=${x}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:o}]}],...j})})).json(),_=(k=(T=(E=(S=(N=P==null?void 0:P.candidates)==null?void 0:N[0])==null?void 0:S.content)==null?void 0:E.parts)==null?void 0:T[0])==null?void 0:k.text;m(_||"No se pudo obtener sugerencia")}catch{m("Error al consultar la API")}finally{h(!1)}}};return e.jsxs(e.Fragment,{children:[e.jsxs(z,{type:"button",variant:"outline",size:"sm",onClick:()=>r(!0),className:"flex items-center gap-2",children:[e.jsx($s,{className:"w-4 h-4"})," Mejorar descripción"]}),e.jsx(Rt,{open:a,onOpenChange:r,children:e.jsxs(Ct,{className:"w-[95vw] h-[90vh] max-w-none max-h-none overflow-hidden flex flex-col sm:w-[90vw] sm:h-[85vh]",children:[e.jsxs(_t,{className:"flex-shrink-0",children:[e.jsx(Pt,{className:"text-xl",children:"Mejorar Descripción con IA"}),e.jsx(rn,{children:"La IA mejorará la descripción de tu tarea sin cambiar su esencia. Usa el panel izquierdo para editar el prompt y visualiza el resultado en el panel derecho."})]}),e.jsxs("div",{className:"flex-1 flex flex-col sm:flex-row gap-4 min-h-0 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[e.jsxs("div",{className:"flex-1 flex flex-col mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2 flex-shrink-0",children:"Prompt para IA"}),e.jsx(kt,{value:o,onChange:N=>l(N.target.value),className:"flex-1 resize-none min-h-0",placeholder:"Escribe o modifica el prompt para la IA..."})]}),e.jsxs("div",{className:"flex flex-col gap-3 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"text-gray-500",children:["Tokens: ",p]}),p>3500&&e.jsx("span",{className:"text-red-500 font-medium",children:"¡Prompt demasiado largo!"})]}),e.jsxs(z,{onClick:v,disabled:u||!x||p>3500,className:"w-full flex items-center justify-center gap-2",size:"lg",children:[u&&e.jsx(ls,{className:"w-4 h-4 animate-spin"}),e.jsx($s,{className:"w-4 h-4"}),u?"Consultando IA...":"Obtener descripción"]}),u&&e.jsx(lr,{className:"mt-2"})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 sm:border-l sm:border-gray-200 sm:pl-4 border-t sm:border-t-0 border-gray-200 pt-4 sm:pt-0",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Resultado"}),c&&e.jsxs(z,{type:"button",size:"sm",variant:"outline",onClick:()=>{navigator.clipboard.writeText(c),vt.success("Texto copiado al portapapeles")},className:"flex items-center gap-1",children:[e.jsx(Ua,{className:"w-4 h-4"}),"Copiar"]})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[e.jsx(kt,{readOnly:!0,value:c||(u?"Generando descripción mejorada...":"La descripción mejorada aparecerá aquí después de generar"),className:"flex-1 resize-none bg-gray-50 border-gray-200 min-h-0",placeholder:"La descripción mejorada aparecerá aquí..."}),c&&e.jsx("div",{className:"mt-3 flex-shrink-0",children:e.jsx(z,{type:"button",className:"w-full",onClick:()=>{n(c),vt.success("Descripción insertada"),r(!1),m("")},variant:"default",children:"📝 Insertar en descripción"})})]})]})]}),e.jsx("div",{className:"flex-shrink-0 mt-4 pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 text-xs text-gray-500",children:[e.jsx("span",{children:"💡 Tip: La IA mantendrá la esencia de tu tarea mientras mejora la claridad"}),!x]})})]})})]})},li=va("task"),m$=li?`https://generativelanguage.googleapis.com/v1beta/models/${li.model}:generateContent`:"",h$=({title:t,description:s,onInsert:n})=>{var w;const[a,r]=f.useState(!1),[o,l]=f.useState(""),[c,m]=f.useState(""),[u,h]=f.useState(!1),[p,g]=f.useState(0),x="AIzaSyAW4Ot-z7OH4ZR3OeaN7vcbkEDlWpo1aMY",b=((w=li==null?void 0:li.prompts)==null?void 0:w.ideas)??"Sugiere ejemplos o estrategias breves para abordar la tarea. Máximo 150 palabras.",j=li==null?void 0:li.params;f.useEffect(()=>{a&&l(`${b}
Título: ${t}
Descripción: ${s}`)},[a,t,s]),f.useEffect(()=>{g(ba(o))},[o]);const v=async()=>{var N,S,E,T,k;if(t){h(!0);try{const P=await(await fetch(`${m$}?key=${x}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:o}]}],...j})})).json(),_=(k=(T=(E=(S=(N=P==null?void 0:P.candidates)==null?void 0:N[0])==null?void 0:S.content)==null?void 0:E.parts)==null?void 0:T[0])==null?void 0:k.text;m(_||"No se pudo obtener sugerencia")}catch{m("Error al consultar la API")}finally{h(!1)}}};return e.jsxs(e.Fragment,{children:[e.jsxs(z,{type:"button",variant:"outline",size:"sm",onClick:()=>r(!0),className:"flex items-center gap-2",children:[e.jsx($s,{className:"w-4 h-4"})," Ideas"]}),e.jsx(Rt,{open:a,onOpenChange:r,children:e.jsxs(Ct,{className:"w-[95vw] h-[90vh] max-w-none max-h-none overflow-hidden flex flex-col sm:w-[90vw] sm:h-[85vh]",children:[e.jsxs(_t,{className:"flex-shrink-0",children:[e.jsx(Pt,{className:"text-xl",children:"Ideas para la Tarea con IA"}),e.jsx(rn,{children:"La IA te sugerirá ejemplos y estrategias para abordar tu tarea. Usa el panel izquierdo para editar el prompt y visualiza el resultado en el panel derecho."})]}),e.jsxs("div",{className:"flex-1 flex flex-col sm:flex-row gap-4 min-h-0 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[e.jsxs("div",{className:"flex-1 flex flex-col mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2 flex-shrink-0",children:"Prompt para IA"}),e.jsx(kt,{value:o,onChange:N=>l(N.target.value),className:"flex-1 resize-none min-h-0",placeholder:"Escribe o modifica el prompt para la IA..."})]}),e.jsxs("div",{className:"flex flex-col gap-3 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"text-gray-500",children:["Tokens: ",p]}),p>3500&&e.jsx("span",{className:"text-red-500 font-medium",children:"¡Prompt demasiado largo!"})]}),e.jsxs(z,{onClick:v,disabled:u||!x||p>3500,className:"w-full flex items-center justify-center gap-2",size:"lg",children:[u&&e.jsx(ls,{className:"w-4 h-4 animate-spin"}),e.jsx($s,{className:"w-4 h-4"}),u?"Consultando IA...":"Obtener ideas"]}),u&&e.jsx(lr,{className:"mt-2"})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 sm:border-l sm:border-gray-200 sm:pl-4 border-t sm:border-t-0 border-gray-200 pt-4 sm:pt-0",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Resultado"}),c&&e.jsxs(z,{type:"button",size:"sm",variant:"outline",onClick:()=>{navigator.clipboard.writeText(c),vt.success("Texto copiado al portapapeles")},className:"flex items-center gap-1",children:[e.jsx(Ua,{className:"w-4 h-4"}),"Copiar"]})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[e.jsx(kt,{readOnly:!0,value:c||(u?"Generando ideas...":"Las ideas aparecerán aquí después de generar"),className:"flex-1 resize-none bg-gray-50 border-gray-200 min-h-0",placeholder:"Las ideas aparecerán aquí..."}),c&&e.jsx("div",{className:"mt-3 flex-shrink-0",children:e.jsx(z,{type:"button",className:"w-full",onClick:()=>{n(c),vt.success("Ideas insertadas en descripción"),r(!1),m("")},variant:"default",children:"📝 Insertar en descripción"})})]})]})]}),e.jsx("div",{className:"flex-shrink-0 mt-4 pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 text-xs text-gray-500",children:[e.jsx("span",{children:"💡 Tip: Sé específico sobre el contexto de tu tarea para mejores ideas"}),!x]})})]})})]})};function f$(t){if(typeof document>"u")return;let s=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",s.appendChild(n),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t))}const VN=Z.createContext({drawerRef:{current:null},overlayRef:{current:null},onPress:()=>{},onRelease:()=>{},onDrag:()=>{},onNestedDrag:()=>{},onNestedOpenChange:()=>{},onNestedRelease:()=>{},openProp:void 0,dismissible:!1,isOpen:!1,isDragging:!1,keyboardIsOpen:{current:!1},snapPointsOffset:null,snapPoints:null,handleOnly:!1,modal:!1,shouldFade:!1,activeSnapPoint:null,onOpenChange:()=>{},setActiveSnapPoint:()=>{},closeDrawer:()=>{},direction:"bottom",shouldScaleBackground:!1,setBackgroundColorOnScale:!0,noBodyStyles:!1,container:null,autoFocus:!1}),Rc=()=>{const t=Z.useContext(VN);if(!t)throw new Error("useDrawerContext must be used within a Drawer.Root");return t};f$(`[data-vaul-drawer]{touch-action:none;will-change:transform;transition:transform .5s cubic-bezier(.32, .72, 0, 1);animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=open]{animation-name:slideFromBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=bottom][data-state=closed]{animation-name:slideToBottom}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=open]{animation-name:slideFromTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=top][data-state=closed]{animation-name:slideToTop}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=open]{animation-name:slideFromLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=left][data-state=closed]{animation-name:slideToLeft}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=open]{animation-name:slideFromRight}[data-vaul-drawer][data-vaul-snap-points=false][data-vaul-drawer-direction=right][data-state=closed]{animation-name:slideToRight}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,100%,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,-100%,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(-100%,0,0)}[data-vaul-drawer][data-vaul-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(100%,0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=top]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=bottom]{transform:translate3d(0,var(--snap-point-height,0),0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=left]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-drawer][data-vaul-delayed-snap-points=true][data-vaul-drawer-direction=right]{transform:translate3d(var(--snap-point-height,0),0,0)}[data-vaul-overlay][data-vaul-snap-points=false]{animation-duration:.5s;animation-timing-function:cubic-bezier(0.32,0.72,0,1)}[data-vaul-overlay][data-vaul-snap-points=false][data-state=open]{animation-name:fadeIn}[data-vaul-overlay][data-state=closed]{animation-name:fadeOut}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:0;transition:opacity .5s cubic-bezier(.32, .72, 0, 1)}[data-vaul-overlay][data-vaul-snap-points=true]{opacity:1}[data-vaul-drawer]:not([data-vaul-custom-container=true])::after{content:'';position:absolute;background:inherit;background-color:inherit}[data-vaul-drawer][data-vaul-drawer-direction=top]::after{top:initial;bottom:100%;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=bottom]::after{top:100%;bottom:initial;left:0;right:0;height:200%}[data-vaul-drawer][data-vaul-drawer-direction=left]::after{left:initial;right:100%;top:0;bottom:0;width:200%}[data-vaul-drawer][data-vaul-drawer-direction=right]::after{left:100%;right:initial;top:0;bottom:0;width:200%}[data-vaul-overlay][data-vaul-snap-points=true]:not([data-vaul-snap-points-overlay=true]):not(
[data-state=closed]
){opacity:0}[data-vaul-overlay][data-vaul-snap-points-overlay=true]{opacity:1}[data-vaul-handle]{display:block;position:relative;opacity:.7;background:#e2e2e4;margin-left:auto;margin-right:auto;height:5px;width:32px;border-radius:1rem;touch-action:pan-y}[data-vaul-handle]:active,[data-vaul-handle]:hover{opacity:1}[data-vaul-handle-hitarea]{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:max(100%,2.75rem);height:max(100%,2.75rem);touch-action:inherit}@media (hover:hover) and (pointer:fine){[data-vaul-drawer]{user-select:none}}@media (pointer:fine){[data-vaul-handle-hitarea]:{width:100%;height:100%}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeOut{to{opacity:0}}@keyframes slideFromBottom{from{transform:translate3d(0,100%,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToBottom{to{transform:translate3d(0,100%,0)}}@keyframes slideFromTop{from{transform:translate3d(0,-100%,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToTop{to{transform:translate3d(0,-100%,0)}}@keyframes slideFromLeft{from{transform:translate3d(-100%,0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToLeft{to{transform:translate3d(-100%,0,0)}}@keyframes slideFromRight{from{transform:translate3d(100%,0,0)}to{transform:translate3d(0,0,0)}}@keyframes slideToRight{to{transform:translate3d(100%,0,0)}}`);const p$=24,x$=typeof window<"u"?f.useLayoutEffect:f.useEffect;function Lv(...t){return(...s)=>{for(let n of t)typeof n=="function"&&n(...s)}}function g$(){return Ap(/^Mac/)}function v$(){return Ap(/^iPhone/)}function $v(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function y$(){return Ap(/^iPad/)||g$()&&navigator.maxTouchPoints>1}function GN(){return v$()||y$()}function Ap(t){return typeof window<"u"&&window.navigator!=null?t.test(window.navigator.platform):void 0}const Eh=typeof document<"u"&&window.visualViewport;function zv(t){let s=window.getComputedStyle(t);return/(auto|scroll)/.test(s.overflow+s.overflowX+s.overflowY)}function qN(t){for(zv(t)&&(t=t.parentElement);t&&!zv(t);)t=t.parentElement;return t||document.scrollingElement||document.documentElement}const b$=new Set(["checkbox","radio","range","color","file","image","button","submit","reset"]);let Id=0,Th;function j$(t={}){let{isDisabled:s}=t;x$(()=>{if(!s)return Id++,Id===1&&GN()&&(Th=w$()),()=>{Id--,Id===0&&(Th==null||Th())}},[s])}function w$(){let t,s=0,n=p=>{t=qN(p.target),!(t===document.documentElement&&t===document.body)&&(s=p.changedTouches[0].pageY)},a=p=>{if(!t||t===document.documentElement||t===document.body){p.preventDefault();return}let g=p.changedTouches[0].pageY,x=t.scrollTop,b=t.scrollHeight-t.clientHeight;b!==0&&((x<=0&&g>s||x>=b&&g<s)&&p.preventDefault(),s=g)},r=p=>{let g=p.target;bf(g)&&g!==document.activeElement&&(p.preventDefault(),g.style.transform="translateY(-2000px)",g.focus(),requestAnimationFrame(()=>{g.style.transform=""}))},o=p=>{let g=p.target;bf(g)&&(g.style.transform="translateY(-2000px)",requestAnimationFrame(()=>{g.style.transform="",Eh&&(Eh.height<window.innerHeight?requestAnimationFrame(()=>{Fv(g)}):Eh.addEventListener("resize",()=>Fv(g),{once:!0}))}))},l=()=>{window.scrollTo(0,0)},c=window.pageXOffset,m=window.pageYOffset,u=Lv(N$(document.documentElement,"paddingRight",`${window.innerWidth-document.documentElement.clientWidth}px`));window.scrollTo(0,0);let h=Lv(Ll(document,"touchstart",n,{passive:!1,capture:!0}),Ll(document,"touchmove",a,{passive:!1,capture:!0}),Ll(document,"touchend",r,{passive:!1,capture:!0}),Ll(document,"focus",o,!0),Ll(window,"scroll",l));return()=>{u(),h(),window.scrollTo(c,m)}}function N$(t,s,n){let a=t.style[s];return t.style[s]=n,()=>{t.style[s]=a}}function Ll(t,s,n,a){return t.addEventListener(s,n,a),()=>{t.removeEventListener(s,n,a)}}function Fv(t){let s=document.scrollingElement||document.documentElement;for(;t&&t!==s;){let n=qN(t);if(n!==document.documentElement&&n!==document.body&&n!==t){let a=n.getBoundingClientRect().top,r=t.getBoundingClientRect().top,o=t.getBoundingClientRect().bottom;const l=n.getBoundingClientRect().bottom+p$;o>l&&(n.scrollTop+=r-a)}t=n.parentElement}}function bf(t){return t instanceof HTMLInputElement&&!b$.has(t.type)||t instanceof HTMLTextAreaElement||t instanceof HTMLElement&&t.isContentEditable}function S$(t,s){typeof t=="function"?t(s):t!=null&&(t.current=s)}function C$(...t){return s=>t.forEach(n=>S$(n,s))}function YN(...t){return f.useCallback(C$(...t),t)}const KN=new WeakMap;function Ys(t,s,n=!1){if(!t||!(t instanceof HTMLElement))return;let a={};Object.entries(s).forEach(([r,o])=>{if(r.startsWith("--")){t.style.setProperty(r,o);return}a[r]=t.style[r],t.style[r]=o}),!n&&KN.set(t,a)}function E$(t,s){if(!t||!(t instanceof HTMLElement))return;let n=KN.get(t);n&&(t.style[s]=n[s])}const Ks=t=>{switch(t){case"top":case"bottom":return!0;case"left":case"right":return!1;default:return t}};function Od(t,s){if(!t)return null;const n=window.getComputedStyle(t),a=n.transform||n.webkitTransform||n.mozTransform;let r=a.match(/^matrix3d\((.+)\)$/);return r?parseFloat(r[1].split(", ")[Ks(s)?13:12]):(r=a.match(/^matrix\((.+)\)$/),r?parseFloat(r[1].split(", ")[Ks(s)?5:4]):null)}function T$(t){return 8*(Math.log(t+1)-2)}function Dh(t,s){if(!t)return()=>{};const n=t.style.cssText;return Object.assign(t.style,s),()=>{t.style.cssText=n}}function D$(...t){return(...s)=>{for(const n of t)typeof n=="function"&&n(...s)}}const Ss={DURATION:.5,EASE:[.32,.72,0,1]},JN=.4,k$=.25,A$=100,XN=8,Wi=16,jf=26,kh="vaul-dragging";function ZN(t){const s=Z.useRef(t);return Z.useEffect(()=>{s.current=t}),Z.useMemo(()=>(...n)=>s.current==null?void 0:s.current.call(s,...n),[])}function R$({defaultProp:t,onChange:s}){const n=Z.useState(t),[a]=n,r=Z.useRef(a),o=ZN(s);return Z.useEffect(()=>{r.current!==a&&(o(a),r.current=a)},[a,r,o]),n}function QN({prop:t,defaultProp:s,onChange:n=()=>{}}){const[a,r]=R$({defaultProp:s,onChange:n}),o=t!==void 0,l=o?t:a,c=ZN(n),m=Z.useCallback(u=>{if(o){const p=typeof u=="function"?u(t):u;p!==t&&c(p)}else r(u)},[o,t,r,c]);return[l,m]}function _$({activeSnapPointProp:t,setActiveSnapPointProp:s,snapPoints:n,drawerRef:a,overlayRef:r,fadeFromIndex:o,onSnapPointChange:l,direction:c="bottom",container:m,snapToSequentialPoint:u}){const[h,p]=QN({prop:t,defaultProp:n==null?void 0:n[0],onChange:s}),[g,x]=Z.useState(typeof window<"u"?{innerWidth:window.innerWidth,innerHeight:window.innerHeight}:void 0);Z.useEffect(()=>{function D(){x({innerWidth:window.innerWidth,innerHeight:window.innerHeight})}return window.addEventListener("resize",D),()=>window.removeEventListener("resize",D)},[]);const b=Z.useMemo(()=>h===(n==null?void 0:n[n.length-1])||null,[n,h]),j=Z.useMemo(()=>n==null?void 0:n.findIndex(D=>D===h),[n,h]),v=n&&n.length>0&&(o||o===0)&&!Number.isNaN(o)&&n[o]===h||!n,w=Z.useMemo(()=>{const D=m?{width:m.getBoundingClientRect().width,height:m.getBoundingClientRect().height}:typeof window<"u"?{width:window.innerWidth,height:window.innerHeight}:{width:0,height:0};var P;return(P=n==null?void 0:n.map(_=>{const B=typeof _=="string";let I=0;if(B&&(I=parseInt(_,10)),Ks(c)){const M=B?I:g?_*D.height:0;return g?c==="bottom"?D.height-M:-D.height+M:M}const R=B?I:g?_*D.width:0;return g?c==="right"?D.width-R:-D.width+R:R}))!=null?P:[]},[n,g,m]),N=Z.useMemo(()=>j!==null?w==null?void 0:w[j]:null,[w,j]),S=Z.useCallback(D=>{var P;const _=(P=w==null?void 0:w.findIndex(B=>B===D))!=null?P:null;l(_),Ys(a.current,{transition:`transform ${Ss.DURATION}s cubic-bezier(${Ss.EASE.join(",")})`,transform:Ks(c)?`translate3d(0, ${D}px, 0)`:`translate3d(${D}px, 0, 0)`}),w&&_!==w.length-1&&_!==o&&_<o?Ys(r.current,{transition:`opacity ${Ss.DURATION}s cubic-bezier(${Ss.EASE.join(",")})`,opacity:"0"}):Ys(r.current,{transition:`opacity ${Ss.DURATION}s cubic-bezier(${Ss.EASE.join(",")})`,opacity:"1"}),p(n==null?void 0:n[Math.max(_,0)])},[a.current,n,w,o,r,p]);Z.useEffect(()=>{if(h||t){var D;const P=(D=n==null?void 0:n.findIndex(_=>_===t||_===h))!=null?D:-1;w&&P!==-1&&typeof w[P]=="number"&&S(w[P])}},[h,t,n,w,S]);function E({draggedDistance:D,closeDrawer:P,velocity:_,dismissible:B}){if(o===void 0)return;const I=c==="bottom"||c==="right"?(N??0)-D:(N??0)+D,R=j===o-1,M=j===0,W=D>0;if(R&&Ys(r.current,{transition:`opacity ${Ss.DURATION}s cubic-bezier(${Ss.EASE.join(",")})`}),!u&&_>2&&!W){B?P():S(w[0]);return}if(!u&&_>2&&W&&w&&n){S(w[n.length-1]);return}const H=w==null?void 0:w.reduce(($,q)=>typeof $!="number"||typeof q!="number"?$:Math.abs(q-I)<Math.abs($-I)?q:$),L=Ks(c)?window.innerHeight:window.innerWidth;if(_>JN&&Math.abs(D)<L*.4){const $=W?1:-1;if($>0&&b){S(w[n.length-1]);return}if(M&&$<0&&B&&P(),j===null)return;S(w[j+$]);return}S(H)}function T({draggedDistance:D}){if(N===null)return;const P=c==="bottom"||c==="right"?N-D:N+D;(c==="bottom"||c==="right")&&P<w[w.length-1]||(c==="top"||c==="left")&&P>w[w.length-1]||Ys(a.current,{transform:Ks(c)?`translate3d(0, ${P}px, 0)`:`translate3d(${P}px, 0, 0)`})}function k(D,P){if(!n||typeof j!="number"||!w||o===void 0)return null;const _=j===o-1;if(j>=o&&P)return 0;if(_&&!P)return 1;if(!v&&!_)return null;const I=_?j+1:j-1,R=_?w[I]-w[I-1]:w[I+1]-w[I],M=D/Math.abs(R);return _?1-M:M}return{isLastSnapPoint:b,activeSnapPoint:h,shouldFade:v,getPercentageDragged:k,setActiveSnapPoint:p,activeSnapPointIndex:j,onRelease:E,onDrag:T,snapPointsOffset:w}}const P$=()=>()=>{};function M$(){const{direction:t,isOpen:s,shouldScaleBackground:n,setBackgroundColorOnScale:a,noBodyStyles:r}=Rc(),o=Z.useRef(null),l=f.useMemo(()=>document.body.style.backgroundColor,[]);function c(){return(window.innerWidth-jf)/window.innerWidth}Z.useEffect(()=>{if(s&&n){o.current&&clearTimeout(o.current);const m=document.querySelector("[data-vaul-drawer-wrapper]")||document.querySelector("[vaul-drawer-wrapper]");if(!m)return;D$(a&&!r?Dh(document.body,{background:"black"}):P$,Dh(m,{transformOrigin:Ks(t)?"top":"left",transitionProperty:"transform, border-radius",transitionDuration:`${Ss.DURATION}s`,transitionTimingFunction:`cubic-bezier(${Ss.EASE.join(",")})`}));const u=Dh(m,{borderRadius:`${XN}px`,overflow:"hidden",...Ks(t)?{transform:`scale(${c()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`}:{transform:`scale(${c()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`}});return()=>{u(),o.current=window.setTimeout(()=>{l?document.body.style.background=l:document.body.style.removeProperty("background")},Ss.DURATION*1e3)}}},[s,n,l])}let $l=null;function I$({isOpen:t,modal:s,nested:n,hasBeenOpened:a,preventScrollRestoration:r,noBodyStyles:o}){const[l,c]=Z.useState(()=>typeof window<"u"?window.location.href:""),m=Z.useRef(0),u=Z.useCallback(()=>{if($v()&&$l===null&&t&&!o){$l={position:document.body.style.position,top:document.body.style.top,left:document.body.style.left,height:document.body.style.height,right:"unset"};const{scrollX:p,innerHeight:g}=window;document.body.style.setProperty("position","fixed","important"),Object.assign(document.body.style,{top:`${-m.current}px`,left:`${-p}px`,right:"0px",height:"auto"}),window.setTimeout(()=>window.requestAnimationFrame(()=>{const x=g-window.innerHeight;x&&m.current>=g&&(document.body.style.top=`${-(m.current+x)}px`)}),300)}},[t]),h=Z.useCallback(()=>{if($v()&&$l!==null&&!o){const p=-parseInt(document.body.style.top,10),g=-parseInt(document.body.style.left,10);Object.assign(document.body.style,$l),window.requestAnimationFrame(()=>{if(r&&l!==window.location.href){c(window.location.href);return}window.scrollTo(g,p)}),$l=null}},[l]);return Z.useEffect(()=>{function p(){m.current=window.scrollY}return p(),window.addEventListener("scroll",p),()=>{window.removeEventListener("scroll",p)}},[]),Z.useEffect(()=>{n||!a||(t?(!window.matchMedia("(display-mode: standalone)").matches&&u(),s||window.setTimeout(()=>{h()},500)):h())},[t,a,l,s,n,u,h]),{restorePositionSetting:h}}function O$({open:t,onOpenChange:s,children:n,onDrag:a,onRelease:r,snapPoints:o,shouldScaleBackground:l=!1,setBackgroundColorOnScale:c=!0,closeThreshold:m=k$,scrollLockTimeout:u=A$,dismissible:h=!0,handleOnly:p=!1,fadeFromIndex:g=o&&o.length-1,activeSnapPoint:x,setActiveSnapPoint:b,fixed:j,modal:v=!0,onClose:w,nested:N,noBodyStyles:S,direction:E="bottom",defaultOpen:T=!1,disablePreventScroll:k=!0,snapToSequentialPoint:D=!1,preventScrollRestoration:P=!1,repositionInputs:_=!0,onAnimationEnd:B,container:I,autoFocus:R=!1}){var M,W;const[H=!1,L]=QN({defaultProp:T,prop:t,onChange:We=>{s==null||s(We),!We&&!N&&Re(),setTimeout(()=>{B==null||B(We)},Ss.DURATION*1e3),We&&!v&&typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),We||(document.body.style.pointerEvents="auto")}}),[$,q]=Z.useState(!1),[re,Y]=Z.useState(!1),[se,ie]=Z.useState(!1),U=Z.useRef(null),ee=Z.useRef(null),me=Z.useRef(null),ue=Z.useRef(null),ae=Z.useRef(null),ge=Z.useRef(!1),je=Z.useRef(null),we=Z.useRef(0),ke=Z.useRef(!1),de=Z.useRef(0),J=Z.useRef(null),ve=Z.useRef(((M=J.current)==null?void 0:M.getBoundingClientRect().height)||0),ft=Z.useRef(((W=J.current)==null?void 0:W.getBoundingClientRect().width)||0),pt=Z.useRef(0),ot=Z.useCallback(We=>{o&&We===le.length-1&&(ee.current=new Date)},[]),{activeSnapPoint:zs,activeSnapPointIndex:gs,setActiveSnapPoint:G,onRelease:te,snapPointsOffset:le,onDrag:Ce,shouldFade:Se,getPercentageDragged:be}=_$({snapPoints:o,activeSnapPointProp:x,setActiveSnapPointProp:b,drawerRef:J,fadeFromIndex:g,overlayRef:U,onSnapPointChange:ot,direction:E,container:I,snapToSequentialPoint:D});j$({isDisabled:!H||re||!v||se||!$||!_||!k});const{restorePositionSetting:Re}=I$({isOpen:H,modal:v,nested:N,hasBeenOpened:$,preventScrollRestoration:P,noBodyStyles:S});function Ve(){return(window.innerWidth-jf)/window.innerWidth}function Qe(We){var lt,yt;!h&&!o||J.current&&!J.current.contains(We.target)||(ve.current=((lt=J.current)==null?void 0:lt.getBoundingClientRect().height)||0,ft.current=((yt=J.current)==null?void 0:yt.getBoundingClientRect().width)||0,Y(!0),me.current=new Date,GN()&&window.addEventListener("touchend",()=>ge.current=!1,{once:!0}),We.target.setPointerCapture(We.pointerId),we.current=Ks(E)?We.pageY:We.pageX)}function Yt(We,lt){var yt,Ft;let Ue=We;const ut=(yt=window.getSelection())==null?void 0:yt.toString(),Mt=J.current?Od(J.current,E):null,Ae=new Date;if(Ue.hasAttribute("data-vaul-no-drag")||Ue.closest("[data-vaul-no-drag]"))return!1;if(E==="right"||E==="left")return!0;if(ee.current&&Ae.getTime()-ee.current.getTime()<500)return!1;if(Mt!==null&&(E==="bottom"?Mt>0:Mt<0))return!0;if(ut&&ut.length>0)return!1;if(Ae.getTime()-((Ft=ae.current)==null?void 0:Ft.getTime())<u&&Mt===0||lt)return ae.current=Ae,!1;for(;Ue;){if(Ue.scrollHeight>Ue.clientHeight){if(Ue.scrollTop!==0)return ae.current=new Date,!1;if(Ue.getAttribute("role")==="dialog")return!0}Ue=Ue.parentNode}return!0}function Cs(We){if(J.current&&re){const lt=E==="bottom"||E==="right"?1:-1,yt=(we.current-(Ks(E)?We.pageY:We.pageX))*lt,Ft=yt>0,Ue=o&&!h&&!Ft;if(Ue&&gs===0)return;const ut=Math.abs(yt),Mt=document.querySelector("[data-vaul-drawer-wrapper]"),Ae=E==="bottom"||E==="top"?ve.current:ft.current;let Oe=ut/Ae;const Ye=be(ut,Ft);if(Ye!==null&&(Oe=Ye),Ue&&Oe>=1||!ge.current&&!Yt(We.target,Ft))return;if(J.current.classList.add(kh),ge.current=!0,Ys(J.current,{transition:"none"}),Ys(U.current,{transition:"none"}),o&&Ce({draggedDistance:yt}),Ft&&!o){const It=T$(yt),Tt=Math.min(It*-1,0)*lt;Ys(J.current,{transform:Ks(E)?`translate3d(0, ${Tt}px, 0)`:`translate3d(${Tt}px, 0, 0)`});return}const Et=1-Oe;if((Se||g&&gs===g-1)&&(a==null||a(We,Oe),Ys(U.current,{opacity:`${Et}`,transition:"none"},!0)),Mt&&U.current&&l){const It=Math.min(Ve()+Oe*(1-Ve()),1),Tt=8-Oe*8,ds=Math.max(0,14-Oe*14);Ys(Mt,{borderRadius:`${Tt}px`,transform:Ks(E)?`scale(${It}) translate3d(0, ${ds}px, 0)`:`scale(${It}) translate3d(${ds}px, 0, 0)`,transition:"none"},!0)}if(!o){const It=ut*lt;Ys(J.current,{transform:Ks(E)?`translate3d(0, ${It}px, 0)`:`translate3d(${It}px, 0, 0)`})}}}Z.useEffect(()=>{var We;function lt(){if(!J.current||!_)return;const yt=document.activeElement;if(bf(yt)||ke.current){var Ft;const Ue=((Ft=window.visualViewport)==null?void 0:Ft.height)||0,ut=window.innerHeight;let Mt=ut-Ue;const Ae=J.current.getBoundingClientRect().height||0,Oe=Ae>ut*.8;pt.current||(pt.current=Ae);const Ye=J.current.getBoundingClientRect().top;if(Math.abs(de.current-Mt)>60&&(ke.current=!ke.current),o&&o.length>0&&le&&gs){const Et=le[gs]||0;Mt+=Et}if(de.current=Mt,Ae>Ue||ke.current){const Et=J.current.getBoundingClientRect().height;let It=Et;Et>Ue&&(It=Ue-(Oe?Ye:jf)),j?J.current.style.height=`${Et-Math.max(Mt,0)}px`:J.current.style.height=`${Math.max(It,Ue-Ye)}px`}else J.current.style.height=`${pt.current}px`;o&&o.length>0&&!ke.current?J.current.style.bottom="0px":J.current.style.bottom=`${Math.max(Mt,0)}px`}}return(We=window.visualViewport)==null||We.addEventListener("resize",lt),()=>{var yt;return(yt=window.visualViewport)==null?void 0:yt.removeEventListener("resize",lt)}},[gs,o,le]);function Ut(We){Fs(),w==null||w(),We||L(!1),setTimeout(()=>{o&&G(o[0])},Ss.DURATION*1e3)}function Us(){if(!J.current)return;const We=document.querySelector("[data-vaul-drawer-wrapper]"),lt=Od(J.current,E);Ys(J.current,{transform:"translate3d(0, 0, 0)",transition:`transform ${Ss.DURATION}s cubic-bezier(${Ss.EASE.join(",")})`}),Ys(U.current,{transition:`opacity ${Ss.DURATION}s cubic-bezier(${Ss.EASE.join(",")})`,opacity:"1"}),l&&lt&&lt>0&&H&&Ys(We,{borderRadius:`${XN}px`,overflow:"hidden",...Ks(E)?{transform:`scale(${Ve()}) translate3d(0, calc(env(safe-area-inset-top) + 14px), 0)`,transformOrigin:"top"}:{transform:`scale(${Ve()}) translate3d(calc(env(safe-area-inset-top) + 14px), 0, 0)`,transformOrigin:"left"},transitionProperty:"transform, border-radius",transitionDuration:`${Ss.DURATION}s`,transitionTimingFunction:`cubic-bezier(${Ss.EASE.join(",")})`},!0)}function Fs(){!re||!J.current||(J.current.classList.remove(kh),ge.current=!1,Y(!1),ue.current=new Date)}function ss(We){if(!re||!J.current)return;J.current.classList.remove(kh),ge.current=!1,Y(!1),ue.current=new Date;const lt=Od(J.current,E);if(!Yt(We.target,!1)||!lt||Number.isNaN(lt)||me.current===null)return;const yt=ue.current.getTime()-me.current.getTime(),Ft=we.current-(Ks(E)?We.pageY:We.pageX),Ue=Math.abs(Ft)/yt;if(Ue>.05&&(ie(!0),setTimeout(()=>{ie(!1)},200)),o){te({draggedDistance:Ft*(E==="bottom"||E==="right"?1:-1),closeDrawer:Ut,velocity:Ue,dismissible:h}),r==null||r(We,!0);return}if(E==="bottom"||E==="right"?Ft>0:Ft<0){Us(),r==null||r(We,!0);return}if(Ue>JN){Ut(),r==null||r(We,!1);return}var ut;const Mt=Math.min((ut=J.current.getBoundingClientRect().height)!=null?ut:0,window.innerHeight);var Ae;const Oe=Math.min((Ae=J.current.getBoundingClientRect().width)!=null?Ae:0,window.innerWidth),Ye=E==="left"||E==="right";if(Math.abs(lt)>=(Ye?Oe:Mt)*m){Ut(),r==null||r(We,!1);return}r==null||r(We,!0),Us()}Z.useEffect(()=>(H&&(Ys(document.documentElement,{scrollBehavior:"auto"}),ee.current=new Date),()=>{E$(document.documentElement,"scrollBehavior")}),[H]);function Rs(We){const lt=We?(window.innerWidth-Wi)/window.innerWidth:1,yt=We?-Wi:0;je.current&&window.clearTimeout(je.current),Ys(J.current,{transition:`transform ${Ss.DURATION}s cubic-bezier(${Ss.EASE.join(",")})`,transform:`scale(${lt}) translate3d(0, ${yt}px, 0)`}),!We&&J.current&&(je.current=setTimeout(()=>{const Ft=Od(J.current,E);Ys(J.current,{transition:"none",transform:Ks(E)?`translate3d(0, ${Ft}px, 0)`:`translate3d(${Ft}px, 0, 0)`})},500))}function Es(We,lt){if(lt<0)return;const yt=(window.innerWidth-Wi)/window.innerWidth,Ft=yt+lt*(1-yt),Ue=-Wi+lt*Wi;Ys(J.current,{transform:Ks(E)?`scale(${Ft}) translate3d(0, ${Ue}px, 0)`:`scale(${Ft}) translate3d(${Ue}px, 0, 0)`,transition:"none"})}function Nn(We,lt){const yt=Ks(E)?window.innerHeight:window.innerWidth,Ft=lt?(yt-Wi)/yt:1,Ue=lt?-Wi:0;lt&&Ys(J.current,{transition:`transform ${Ss.DURATION}s cubic-bezier(${Ss.EASE.join(",")})`,transform:Ks(E)?`scale(${Ft}) translate3d(0, ${Ue}px, 0)`:`scale(${Ft}) translate3d(${Ue}px, 0, 0)`})}return Z.createElement(vu,{defaultOpen:T,onOpenChange:We=>{!h&&!We||(We?q(!0):Ut(!0),L(We))},open:H},Z.createElement(VN.Provider,{value:{activeSnapPoint:zs,snapPoints:o,setActiveSnapPoint:G,drawerRef:J,overlayRef:U,onOpenChange:s,onPress:Qe,onRelease:ss,onDrag:Cs,dismissible:h,handleOnly:p,isOpen:H,isDragging:re,shouldFade:Se,closeDrawer:Ut,onNestedDrag:Es,onNestedOpenChange:Rs,onNestedRelease:Nn,keyboardIsOpen:ke,modal:v,snapPointsOffset:le,direction:E,shouldScaleBackground:l,setBackgroundColorOnScale:c,noBodyStyles:S,container:I,autoFocus:R}},n))}const eS=Z.forwardRef(function({...t},s){const{overlayRef:n,snapPoints:a,onRelease:r,shouldFade:o,isOpen:l,modal:c}=Rc(),m=YN(s,n),u=a&&a.length>0;return c?Z.createElement(zo,{onMouseUp:r,ref:m,"data-vaul-overlay":"","data-vaul-snap-points":l&&u?"true":"false","data-vaul-snap-points-overlay":l&&o?"true":"false",...t}):(typeof window<"u"&&window.requestAnimationFrame(()=>{document.body.style.pointerEvents="auto"}),null)});eS.displayName="Drawer.Overlay";const tS=Z.forwardRef(function({onPointerDownOutside:t,style:s,onOpenAutoFocus:n,...a},r){const{drawerRef:o,onPress:l,onRelease:c,onDrag:m,keyboardIsOpen:u,snapPointsOffset:h,modal:p,isOpen:g,direction:x,snapPoints:b,container:j,handleOnly:v,autoFocus:w}=Rc(),[N,S]=Z.useState(!1),E=YN(r,o),T=Z.useRef(null),k=Z.useRef(null),D=Z.useRef(!1),P=b&&b.length>0;M$();const _=(I,R,M=0)=>{if(D.current)return!0;const W=Math.abs(I.y),H=Math.abs(I.x),L=H>W,$=["bottom","right"].includes(R)?1:-1;if(R==="left"||R==="right"){if(!(I.x*$<0)&&H>=0&&H<=M)return L}else if(!(I.y*$<0)&&W>=0&&W<=M)return!L;return D.current=!0,!0};Z.useEffect(()=>{P&&window.requestAnimationFrame(()=>{S(!0)})},[]);function B(I){T.current=null,D.current=!1,c(I)}return Z.createElement(Fo,{"data-vaul-drawer-direction":x,"data-vaul-drawer":"","data-vaul-delayed-snap-points":N?"true":"false","data-vaul-snap-points":g&&P?"true":"false","data-vaul-custom-container":j?"true":"false",...a,ref:E,style:h&&h.length>0?{"--snap-point-height":`${h[0]}px`,...s}:s,onPointerDown:I=>{v||(a.onPointerDown==null||a.onPointerDown.call(a,I),T.current={x:I.pageX,y:I.pageY},l(I))},onOpenAutoFocus:I=>{n==null||n(I),w||I.preventDefault()},onPointerDownOutside:I=>{if(t==null||t(I),!p||I.defaultPrevented){I.preventDefault();return}u.current&&(u.current=!1)},onFocusOutside:I=>{if(!p){I.preventDefault();return}},onPointerMove:I=>{if(k.current=I,v||(a.onPointerMove==null||a.onPointerMove.call(a,I),!T.current))return;const R=I.pageY-T.current.y,M=I.pageX-T.current.x,W=I.pointerType==="touch"?10:2;_({x:M,y:R},x,W)?m(I):(Math.abs(M)>W||Math.abs(R)>W)&&(T.current=null)},onPointerUp:I=>{a.onPointerUp==null||a.onPointerUp.call(a,I),T.current=null,D.current=!1,c(I)},onPointerOut:I=>{a.onPointerOut==null||a.onPointerOut.call(a,I),B(k.current)},onContextMenu:I=>{a.onContextMenu==null||a.onContextMenu.call(a,I),B(k.current)}})});tS.displayName="Drawer.Content";const L$=250,$$=120,z$=Z.forwardRef(function({preventCycle:t=!1,children:s,...n},a){const{closeDrawer:r,isDragging:o,snapPoints:l,activeSnapPoint:c,setActiveSnapPoint:m,dismissible:u,handleOnly:h,isOpen:p,onPress:g,onDrag:x}=Rc(),b=Z.useRef(null),j=Z.useRef(!1);function v(){if(j.current){S();return}window.setTimeout(()=>{w()},$$)}function w(){if(o||t||j.current){S();return}if(S(),(!l||l.length===0)&&u){r();return}if(c===l[l.length-1]&&u){r();return}const T=l.findIndex(D=>D===c);if(T===-1)return;const k=l[T+1];m(k)}function N(){b.current=window.setTimeout(()=>{j.current=!0},L$)}function S(){window.clearTimeout(b.current),j.current=!1}return Z.createElement("div",{onClick:v,onPointerCancel:S,onPointerDown:E=>{h&&g(E),N()},onPointerMove:E=>{h&&x(E)},ref:a,"data-vaul-drawer-visible":p?"true":"false","data-vaul-handle":"","aria-hidden":"true",...n},Z.createElement("span",{"data-vaul-handle-hitarea":"","aria-hidden":"true"},s))});z$.displayName="Drawer.Handle";function F$(t){const s=Rc(),{container:n=s.container,...a}=t;return Z.createElement(gu,{container:n,...a})}const Ya={Root:O$,Content:tS,Overlay:eS,Trigger:yu,Portal:F$,Close:gc,Title:Bo,Description:Ho},Rp=({shouldScaleBackground:t=!0,...s})=>e.jsx(Ya.Root,{shouldScaleBackground:t,...s});Rp.displayName="Drawer";const sS=Ya.Trigger,B$=Ya.Portal,nS=Ya.Close,aS=f.forwardRef(({className:t,...s},n)=>e.jsx(Ya.Overlay,{ref:n,className:ce("fixed inset-0 z-50 bg-black/80",t),...s}));aS.displayName=Ya.Overlay.displayName;const _p=f.forwardRef(({className:t,children:s,...n},a)=>e.jsxs(B$,{children:[e.jsx(aS,{}),e.jsxs(Ya.Content,{ref:a,className:ce("fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",t),...n,children:[e.jsx("div",{className:"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted"}),s]})]}));_p.displayName="DrawerContent";const Pp=({className:t,...s})=>e.jsx("div",{className:ce("grid gap-1.5 p-4 text-center sm:text-left",t),...s});Pp.displayName="DrawerHeader";const Mp=({className:t,...s})=>e.jsx("div",{className:ce("mt-auto flex flex-col gap-2 p-4",t),...s});Mp.displayName="DrawerFooter";const Ip=f.forwardRef(({className:t,...s},n)=>e.jsx(Ya.Title,{ref:n,className:ce("text-lg font-semibold leading-none tracking-tight",t),...s}));Ip.displayName=Ya.Title.displayName;const Op=f.forwardRef(({className:t,...s},n)=>e.jsx(Ya.Description,{ref:n,className:ce("text-sm text-muted-foreground",t),...s}));Op.displayName=Ya.Description.displayName;var Gu="Popover",[rS,oW]=Br(Gu,[Lo]),_c=Lo(),[H$,Ai]=rS(Gu),iS=t=>{const{__scopePopover:s,children:n,open:a,defaultOpen:r,onOpenChange:o,modal:l=!1}=t,c=_c(s),m=f.useRef(null),[u,h]=f.useState(!1),[p,g]=$r({prop:a,defaultProp:r??!1,onChange:o,caller:Gu});return e.jsx(Mf,{...c,children:e.jsx(H$,{scope:s,contentId:$o(),triggerRef:m,open:p,onOpenChange:g,onOpenToggle:f.useCallback(()=>g(x=>!x),[g]),hasCustomAnchor:u,onCustomAnchorAdd:f.useCallback(()=>h(!0),[]),onCustomAnchorRemove:f.useCallback(()=>h(!1),[]),modal:l,children:n})})};iS.displayName=Gu;var oS="PopoverAnchor",W$=f.forwardRef((t,s)=>{const{__scopePopover:n,...a}=t,r=Ai(oS,n),o=_c(n),{onCustomAnchorAdd:l,onCustomAnchorRemove:c}=r;return f.useEffect(()=>(l(),()=>c()),[l,c]),e.jsx(xu,{...o,...a,ref:s})});W$.displayName=oS;var lS="PopoverTrigger",cS=f.forwardRef((t,s)=>{const{__scopePopover:n,...a}=t,r=Ai(lS,n),o=_c(n),l=ws(s,r.triggerRef),c=e.jsx(At.button,{type:"button","aria-haspopup":"dialog","aria-expanded":r.open,"aria-controls":r.contentId,"data-state":fS(r.open),...a,ref:l,onClick:nt(t.onClick,r.onOpenToggle)});return r.hasCustomAnchor?c:e.jsx(xu,{asChild:!0,...o,children:c})});cS.displayName=lS;var Lp="PopoverPortal",[U$,V$]=rS(Lp,{forceMount:void 0}),dS=t=>{const{__scopePopover:s,forceMount:n,children:a,container:r}=t,o=Ai(Lp,s);return e.jsx(U$,{scope:s,forceMount:n,children:e.jsx(Hr,{present:n||o.open,children:e.jsx(By,{asChild:!0,container:r,children:a})})})};dS.displayName=Lp;var Oo="PopoverContent",uS=f.forwardRef((t,s)=>{const n=V$(Oo,t.__scopePopover),{forceMount:a=n.forceMount,...r}=t,o=Ai(Oo,t.__scopePopover);return e.jsx(Hr,{present:a||o.open,children:o.modal?e.jsx(q$,{...r,ref:s}):e.jsx(Y$,{...r,ref:s})})});uS.displayName=Oo;var G$=Vy("PopoverContent.RemoveScroll"),q$=f.forwardRef((t,s)=>{const n=Ai(Oo,t.__scopePopover),a=f.useRef(null),r=ws(s,a),o=f.useRef(!1);return f.useEffect(()=>{const l=a.current;if(l)return Hy(l)},[]),e.jsx(Uy,{as:G$,allowPinchZoom:!0,children:e.jsx(mS,{...t,ref:r,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:nt(t.onCloseAutoFocus,l=>{var c;l.preventDefault(),o.current||(c=n.triggerRef.current)==null||c.focus()}),onPointerDownOutside:nt(t.onPointerDownOutside,l=>{const c=l.detail.originalEvent,m=c.button===0&&c.ctrlKey===!0,u=c.button===2||m;o.current=u},{checkForDefaultPrevented:!1}),onFocusOutside:nt(t.onFocusOutside,l=>l.preventDefault(),{checkForDefaultPrevented:!1})})})}),Y$=f.forwardRef((t,s)=>{const n=Ai(Oo,t.__scopePopover),a=f.useRef(!1),r=f.useRef(!1);return e.jsx(mS,{...t,ref:s,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var l,c;(l=t.onCloseAutoFocus)==null||l.call(t,o),o.defaultPrevented||(a.current||(c=n.triggerRef.current)==null||c.focus(),o.preventDefault()),a.current=!1,r.current=!1},onInteractOutside:o=>{var m,u;(m=t.onInteractOutside)==null||m.call(t,o),o.defaultPrevented||(a.current=!0,o.detail.originalEvent.type==="pointerdown"&&(r.current=!0));const l=o.target;((u=n.triggerRef.current)==null?void 0:u.contains(l))&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&r.current&&o.preventDefault()}})}),mS=f.forwardRef((t,s)=>{const{__scopePopover:n,trapFocus:a,onOpenAutoFocus:r,onCloseAutoFocus:o,disableOutsidePointerEvents:l,onEscapeKeyDown:c,onPointerDownOutside:m,onFocusOutside:u,onInteractOutside:h,...p}=t,g=Ai(Oo,n),x=_c(n);return Wy(),e.jsx(Gy,{asChild:!0,loop:!0,trapped:a,onMountAutoFocus:r,onUnmountAutoFocus:o,children:e.jsx(_f,{asChild:!0,disableOutsidePointerEvents:l,onInteractOutside:h,onEscapeKeyDown:c,onPointerDownOutside:m,onFocusOutside:u,onDismiss:()=>g.onOpenChange(!1),children:e.jsx(Pf,{"data-state":fS(g.open),role:"dialog",id:g.contentId,...x,...p,ref:s,style:{...p.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),hS="PopoverClose",K$=f.forwardRef((t,s)=>{const{__scopePopover:n,...a}=t,r=Ai(hS,n);return e.jsx(At.button,{type:"button",...a,ref:s,onClick:nt(t.onClick,()=>r.onOpenChange(!1))})});K$.displayName=hS;var J$="PopoverArrow",X$=f.forwardRef((t,s)=>{const{__scopePopover:n,...a}=t,r=_c(n);return e.jsx(If,{...r,...a,ref:s})});X$.displayName=J$;function fS(t){return t?"open":"closed"}var Z$=iS,Q$=cS,ez=dS,pS=uS;const xS=Z$,gS=Q$,$p=f.forwardRef(({className:t,align:s="center",sideOffset:n=4,...a},r)=>e.jsx(ez,{children:e.jsx(pS,{ref:r,align:s,sideOffset:n,className:ce("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...a})}));$p.displayName=pS.displayName;function zp(t=768){const[s,n]=f.useState(!1);return f.useEffect(()=>{const a=()=>{const r=window.innerWidth<t,o="ontouchstart"in window||navigator.maxTouchPoints>0,l=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);n(r||o&&l)};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[t]),s}function Bv({value:t,onChange:s,placeholder:n="Seleccionar fecha",disabled:a=!1,className:r,minDate:o,maxDate:l}){const c=zp(),[m,u]=f.useState(!1),[h,p]=f.useState(t);f.useEffect(()=>{p(t)},[t]);const g=j=>{p(j),s==null||s(j),u(!1)},x=h?at(h,"PPP",{locale:kn}):n,b=e.jsx(Ac,{mode:"single",selected:h,onSelect:g,disabled:a,fromDate:o,toDate:l,initialFocus:!0});return c?e.jsxs(Rp,{open:m,onOpenChange:u,children:[e.jsx(sS,{asChild:!0,children:e.jsxs(z,{variant:"outline",disabled:a,className:ce("w-full justify-start text-left font-normal",!h&&"text-muted-foreground",r),children:[e.jsx(ns,{className:"mr-2 h-4 w-4"}),x]})}),e.jsxs(_p,{children:[e.jsxs(Pp,{className:"text-left",children:[e.jsx(Ip,{children:"Seleccionar fecha"}),e.jsx(Op,{children:"Elige la fecha que desees"})]}),e.jsx("div",{className:"px-4 pb-4",children:b}),e.jsx(Mp,{className:"pt-2",children:e.jsx(nS,{asChild:!0,children:e.jsx(z,{variant:"outline",children:"Cancelar"})})})]})]}):e.jsxs(xS,{open:m,onOpenChange:u,children:[e.jsx(gS,{asChild:!0,children:e.jsxs(z,{variant:"outline",disabled:a,className:ce("w-full justify-start text-left font-normal",!h&&"text-muted-foreground",r),children:[e.jsx(ns,{className:"mr-2 h-4 w-4"}),x]})}),e.jsx($p,{className:"w-auto p-0",align:"start",children:b})]})}const tz=()=>{const t=[];for(let s=6;s<=22;s++)t.push(`${s.toString().padStart(2,"0")}:00`),s<22&&t.push(`${s.toString().padStart(2,"0")}:30`);return t},sz=({startDate:t,endDate:s,onStartDateChange:n,onEndDateChange:a,showClearButton:r=!1})=>{const o=zp(),l=f.useMemo(()=>tz(),[]),c=v=>$e(v),m=v=>at(v,"HH:mm"),u=(v,w)=>{const[N,S,E]=v.split("-").map(Number),T=new Date;if(T.setFullYear(N,S-1,E),w){const[k,D]=w.split(":").map(Number);T.setHours(k,D,0,0)}else T.setHours(12,0,0,0);return T},h=v=>{if(!v){n(void 0);return}const w=t?m(t):void 0,N=u(v,w);if(s){const S=mc(t,s,N);a(S)}n(N)},p=v=>{if(!t)return;const w=c(t),N=u(w,v);if(s){const S=mc(t,s,N);a(S)}n(N)},g=v=>{if(!v){a(void 0);return}const w=s?m(s):void 0,N=u(v,w);a(N)},x=v=>{if(!s)return;const w=c(s),N=u(w,v);a(N)},b=v=>{if(!t)return;const w=new Date(t.getTime()+v*60*1e3);a(w)},j=()=>{if(t){const v=c(t),w=u(v);n(w)}a(void 0)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ns,{className:"w-4 h-4"}),"Fecha y Hora de Inicio"]}),r&&t&&e.jsx(z,{variant:"ghost",size:"sm",onClick:()=>n(void 0),className:"h-8 px-2",children:e.jsx(Ws,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex gap-2",children:[o?e.jsx("div",{className:"flex-1",children:e.jsx(Bv,{value:t,onChange:n,placeholder:"Seleccionar fecha"})}):e.jsx(Be,{type:"date",className:"flex-1",value:t?c(t):"",onChange:v=>h(v.target.value||void 0)}),e.jsxs(Nt,{value:t?m(t):"",onValueChange:p,disabled:!t,children:[e.jsx(xt,{className:"w-32",children:e.jsx(St,{placeholder:"Hora",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Js,{className:"w-3 h-3"}),t?m(t):"Hora"]})})}),e.jsx(gt,{children:l.map(v=>e.jsx(Pe,{value:v,children:v},v))})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ns,{className:"w-4 h-4"}),"Fecha y Hora de Fin (opcional)"]}),s&&e.jsx(z,{variant:"ghost",size:"sm",onClick:()=>a(void 0),className:"h-8 px-2",children:e.jsx(Ws,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex gap-2",children:[o?e.jsx("div",{className:"flex-1",children:e.jsx(Bv,{value:s,onChange:a,placeholder:"Seleccionar fecha"})}):e.jsx(Be,{type:"date",className:"flex-1",value:s?c(s):"",onChange:v=>g(v.target.value||void 0)}),e.jsxs(Nt,{value:s?m(s):"",onValueChange:x,disabled:!s,children:[e.jsx(xt,{className:"w-32",children:e.jsx(St,{placeholder:"Hora",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Js,{className:"w-3 h-3"}),s?m(s):"Hora"]})})}),e.jsx(gt,{children:l.map(v=>e.jsx(Pe,{value:v,children:v},v))})]})]})]}),t&&e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("span",{className:"text-xs text-gray-600 w-full",children:"Duración rápida:"}),e.jsx(z,{type:"button",variant:"outline",size:"sm",onClick:()=>b(30),className:"h-7 text-xs",children:"30 min"}),e.jsx(z,{type:"button",variant:"outline",size:"sm",onClick:()=>b(60),className:"h-7 text-xs",children:"1 hora"}),e.jsx(z,{type:"button",variant:"outline",size:"sm",onClick:()=>b(120),className:"h-7 text-xs",children:"2 horas"}),e.jsx(z,{type:"button",variant:"outline",size:"sm",onClick:j,className:"h-7 text-xs",children:"Sin hora"})]})]})};function nz({value:t,onChange:s,options:n,placeholder:a="Seleccionar opción",disabled:r=!1,className:o,label:l,description:c}){const m=zp(),[u,h]=f.useState(!1),[p,g]=f.useState(t);f.useEffect(()=>{g(t)},[t]);const x=v=>{g(v),s==null||s(v),h(!1)},b=n.find(v=>v.value===p),j=(b==null?void 0:b.label)||a;return m?e.jsxs(Rp,{open:u,onOpenChange:h,children:[e.jsx(sS,{asChild:!0,children:e.jsxs(z,{variant:"outline",disabled:r,className:ce("w-full justify-between text-left font-normal h-11",!p&&"text-muted-foreground",o),children:[e.jsx("span",{className:"truncate",children:j}),e.jsx(_n,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsxs(_p,{className:"max-h-[80vh]",children:[e.jsxs(Pp,{className:"text-left",children:[e.jsx(Ip,{children:l||"Seleccionar opción"}),c&&e.jsx(Op,{children:c})]}),e.jsx($u,{className:"px-4 max-h-[60vh]",children:e.jsx("div",{className:"space-y-1 pb-4",children:n.map(v=>e.jsxs("button",{disabled:v.disabled,onClick:()=>!v.disabled&&x(v.value),className:ce("flex w-full items-center rounded-lg px-4 py-3 text-left transition-colors","hover:bg-accent hover:text-accent-foreground","focus:bg-accent focus:text-accent-foreground focus:outline-none","disabled:pointer-events-none disabled:opacity-50","active:scale-[0.98] transition-transform",p===v.value&&"bg-accent font-medium"),children:[e.jsx("span",{className:"flex-1",children:v.label}),p===v.value&&e.jsx(ro,{className:"ml-2 h-5 w-5 shrink-0 text-primary"})]},v.value))})}),e.jsx(Mp,{className:"pt-2",children:e.jsx(nS,{asChild:!0,children:e.jsx(z,{variant:"outline",children:"Cancelar"})})})]})]}):e.jsxs(Nt,{value:p,onValueChange:x,disabled:r,children:[e.jsx(xt,{className:ce("w-full",o),children:e.jsx(St,{placeholder:a})}),e.jsx(gt,{children:n.map(v=>e.jsx(Pe,{value:v.value,disabled:v.disabled,children:v.label},v.value))})]})}const az=({value:t,onChange:s})=>{const a=Object.values(kp).map(r=>({value:r,label:Un[r]}));return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ic,{className:"w-4 h-4"}),"Categoría"]}),e.jsx(nz,{value:t,onChange:r=>s(r),options:a,placeholder:"Selecciona una categoría",label:"Categoría",description:"Clasifica tu tarea según su tipo"})]})},rz=({value:t,onChange:s})=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Js,{className:"w-4 h-4"}),"Tiempo estimado (min)"]}),e.jsx(Be,{type:"number",min:"0",placeholder:"Ej. 30",value:t??"",onChange:n=>{const a=n.target.value;s(a===""?void 0:Number(a))}})]}),vS=({initialDate:t,initialConfig:s}={})=>{const[n,a]=f.useState(t||new Date),[r,o]=f.useState(s),l=(u,h)=>h?_M(u,h.pattern,h.customDays):u;return{date:n,setDate:a,config:r,setConfig:o,calculateNextDate:l,getRecurrenceText:(u,h)=>h?aj(u,h.pattern,h.customDays):"",updateRecurrenceConfig:(u,h)=>{const p={pattern:u,frequency:1,...u==="custom"&&{customDays:h||1}};o(p),a(l(new Date,p))},formatDateForInput:rf}},iz=({isRecurrent:t,onRecurrentChange:s,config:n,onConfigChange:a})=>{const{getRecurrenceText:r}=vS({initialConfig:n}),o=l=>{const c={...n||{},frequency:1,pattern:l,...l==="custom"&&{customDays:(n==null?void 0:n.customDays)||1}};a(c)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(As,{id:"isRecurrent",checked:t,onCheckedChange:l=>{s(l)}}),e.jsx("label",{htmlFor:"isRecurrent",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Tarea recurrente"})]}),t&&n&&e.jsxs("div",{className:"pl-6 space-y-4",children:[e.jsxs(Nt,{value:n.pattern,onValueChange:l=>o(l),children:[e.jsx(xt,{className:"w-full",children:e.jsx(St,{placeholder:"Selecciona frecuencia"})}),e.jsxs(gt,{children:[e.jsx(Pe,{value:"daily",children:"Diariamente"}),e.jsx(Pe,{value:"weekly",children:"Semanalmente"}),e.jsx(Pe,{value:"monthly",children:"Mensualmente"}),e.jsx(Pe,{value:"custom",children:"Personalizado"})]})]}),n.pattern==="custom"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Be,{type:"number",min:"1",value:n.customDays,onChange:l=>{const c=parseInt(l.target.value);c>0&&a({...n,customDays:c})},className:"w-24"}),e.jsx("span",{className:"text-sm text-gray-500",children:"días"})]}),n&&e.jsx("div",{className:"text-sm text-blue-600",children:r(new Date,n)})]})]})},Fp=({openCreateModal:t,onSave:s,isModalOpen:n=!1})=>{const a=f.useCallback(r=>{const o=document.activeElement,l=o instanceof HTMLInputElement||o instanceof HTMLTextAreaElement||o instanceof HTMLSelectElement||(o==null?void 0:o.getAttribute("contenteditable"))==="true";if(r.ctrlKey&&r.key==="n"&&!l){r.preventDefault(),r.stopPropagation(),t();return}if(r.ctrlKey&&r.key==="s"&&n&&s){r.preventDefault(),r.stopPropagation(),s();return}},[t,s,n]);return f.useEffect(()=>(document.addEventListener("keydown",a),()=>{document.removeEventListener("keydown",a)}),[a]),{openCreateModal:t}},tl=({isOpen:t,onClose:s,onConfirm:n,task:a,mode:r})=>{const{calculateNextDate:o}=vS({initialConfig:a.recurrence,initialDate:a.startDate}),[l,c]=f.useState(()=>r==="create"?{title:"",description:"",category:"personal",isRecurrent:!1,isPrivate:a.isPrivate||!1,priority:"delete",size:"pequeña",estimatedTime:void 0,timeOfDay:void 0}:{title:a.title||"",description:a.description||"",startDate:r==="complete"?o(new Date,a.recurrence):a.startDate||void 0,endDate:a.endDate||void 0,isRecurrent:a.isRecurrent??!1,isPrivate:a.isPrivate??!1,category:a.category||"personal",recurrence:a.recurrence,priority:a.priority||"delete",size:a.size||"pequeña",estimatedTime:a.estimatedTime,timeOfDay:a.timeOfDay}),[m,u]=f.useState(()=>a.priority==="do"||a.priority==="delegate"),[h,p]=f.useState(()=>a.priority==="do"||a.priority==="decide"),[g,x]=f.useState(a.size||"pequeña");f.useEffect(()=>{t&&(r==="create"?(c({title:"",description:"",category:"personal",isRecurrent:!1,isPrivate:a.isPrivate||!1,priority:"delete",size:"pequeña",estimatedTime:void 0,timeOfDay:void 0}),u(!1),p(!1),x("pequeña")):(c({title:a.title||"",description:a.description||"",startDate:r==="complete"?o(new Date,a.recurrence):a.startDate||void 0,endDate:a.endDate||void 0,isRecurrent:a.isRecurrent||!1,isPrivate:a.isPrivate||!1,category:a.category||"personal",recurrence:a.recurrence,priority:a.priority||"delete",size:a.size||"pequeña",estimatedTime:a.estimatedTime,timeOfDay:a.timeOfDay}),u(a.priority==="do"||a.priority==="delegate"),p(a.priority==="do"||a.priority==="decide"),x(a.size||"pequeña")))},[a,r,t]);const b=()=>{if(!l.title.trim())return;const v=m&&h?"do":h?"decide":m?"delegate":"delete";r==="create"?(l.title.split(`
`).map(N=>N.trim()).filter(Boolean).forEach(N=>{n({...l,title:N,priority:v,size:g})}),s()):n({...l,priority:v,size:g})};Fp({openCreateModal:()=>{},onSave:b,isModalOpen:t});const j=()=>{switch(r){case"create":return"Nueva Tarea";case"edit":return"Editar Tarea";case"complete":return"Completar Tarea";default:return""}};return e.jsx(Rt,{open:t,onOpenChange:s,children:e.jsxs(Ct,{className:"max-w-[95vw] w-[95vw] max-h-[90vh] h-[80vh] overflow-y-auto sm:max-w-[90vw] sm:w-[90vw] lg:max-w-[85vw] lg:w-[85vw]",children:[e.jsxs(_t,{children:[e.jsx(Pt,{children:j()}),r==="complete"&&e.jsx(rn,{children:a.title})]}),e.jsxs("div",{className:"grid gap-6 py-4 lg:grid-cols-2",children:[e.jsxs("div",{className:"space-y-4",children:[r!=="complete"&&e.jsx(r$,{multiline:r==="create",value:l.title,onChange:v=>c(w=>({...w,title:v}))}),e.jsx(o$,{value:l.description||"",onChange:v=>c(w=>({...w,description:v}))}),r==="edit"&&e.jsxs(e.Fragment,{children:[e.jsx(c$,{title:l.title,description:l.description||"",onInsert:v=>c(w=>({...w,description:(w.description?w.description+`
`:"")+v}))}),e.jsx(u$,{title:l.title,description:l.description||"",onInsert:v=>c(w=>({...w,description:(w.description?w.description+`
`:"")+v}))}),e.jsx(h$,{title:l.title,description:l.description||"",onInsert:v=>c(w=>({...w,description:(w.description?w.description+`
`:"")+v}))})]})]}),e.jsxs("div",{className:"space-y-6",children:[r!=="complete"&&e.jsx(az,{value:l.category,onChange:v=>c(w=>({...w,category:v}))}),r!=="complete"&&e.jsx(sz,{startDate:l.startDate,endDate:l.endDate,onStartDateChange:v=>c(w=>({...w,startDate:v})),onEndDateChange:v=>c(w=>({...w,endDate:v})),showClearButton:!0}),r!=="complete"&&e.jsx(iz,{isRecurrent:l.isRecurrent??!1,onRecurrentChange:v=>c(w=>({...w,isRecurrent:v,recurrence:v?{pattern:"daily",frequency:1}:void 0})),config:l.recurrence,onConfigChange:v=>c(w=>({...w,recurrence:v}))}),r!=="complete"&&e.jsx(rz,{value:l.estimatedTime,onChange:v=>c(w=>({...w,estimatedTime:v}))}),r!=="complete"&&e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx(As,{checked:m,onCheckedChange:v=>u(!!v)}),"Urgente"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx(As,{checked:h,onCheckedChange:v=>p(!!v)}),"Importante"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx(As,{checked:l.isPrivate??!1,onCheckedChange:v=>c(w=>({...w,isPrivate:!!v}))}),"🔒 Privada (solo en Journal)"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Tamaño"}),e.jsxs(Nt,{value:g,onValueChange:v=>x(v),children:[e.jsx(xt,{className:"h-8 w-28",children:e.jsx(St,{placeholder:"Tamaño"})}),e.jsxs(gt,{children:[e.jsx(Pe,{value:"pequeña",children:"pequeña"}),e.jsx(Pe,{value:"mediana",children:"mediana"}),e.jsx(Pe,{value:"grande",children:"grande"})]})]})]})]})]})]}),e.jsxs(wn,{children:[e.jsx(z,{variant:"outline",onClick:s,children:"Cancelar"}),e.jsx(z,{onClick:b,disabled:!l.title.trim(),children:r==="complete"?"Completar":r==="create"?"Crear":"Guardar cambios"})]})]})})},oz=({selectedDate:t})=>{const{allTasks:s,status:n,error:a,showRecurrenceModal:r,currentTask:o,modalMode:l,addTask:c,editTask:m,toggleTask:u,deleteTask:h,completeRecurrentTask:p,setShowRecurrenceModal:g,openEditModal:x,openCreateModal:b}=oo(),[j,v]=f.useState(null),[w,N]=f.useState(!1),[S,E]=f.useState(""),[T,k]=f.useState(!1),D=s.filter(M=>M.isPrivate),P=D.filter(M=>M.startDate&&sn(M.startDate,t)),_=D.filter(M=>!M.completed&&(!M.startDate||!sn(M.startDate,t))),B=()=>{b(t,!0)},I=()=>{try{const M=JSON.parse(S);if(!Array.isArray(M)){vt.error("El JSON debe contener un array de tareas");return}let W=0,H=0;M.forEach(L=>{if(L.title){let $;if(L.startDate||L.dueDate){const q=L.startDate||L.dueDate,re=new Date(q);isNaN(re.getTime())?(H++,console.warn(`Fecha inválida para tarea "${L.title}": ${q}`)):$=re}c({title:L.title,description:L.description||"",startDate:$,category:L.category||"personal",priority:L.priority||void 0,isPrivate:!0,isRecurrent:L.isRecurrent||!1,size:L.size||void 0}),W++}}),H>0?vt.warning(`${W} tareas importadas. ${H} fechas inválidas fueron omitidas.`):vt.success(`${W} tareas privadas importadas correctamente`),E(""),k(!1)}catch(M){vt.error("Error al importar las tareas. Verifica el formato JSON."),console.error("Error de importación:",M)}},R=()=>{const M=D.map(H=>{var L,$,q;return{title:H.title,description:H.description||"",startDate:(L=H.startDate)==null?void 0:L.toISOString(),endDate:($=H.endDate)==null?void 0:$.toISOString(),category:H.category,priority:H.priority,size:H.size,completed:H.completed,isRecurrent:H.isRecurrent||!1,...H.recurrence&&{recurrence:{frequency:H.recurrence.frequency,pattern:H.recurrence.pattern,customDays:H.recurrence.customDays,nextDate:(q=H.recurrence.nextDate)==null?void 0:q.toISOString()}}}}),W=JSON.stringify(M,null,2);navigator.clipboard.writeText(W).then(()=>{vt.success("Tareas privadas copiadas al portapapeles con fechas incluidas")})};return e.jsxs(Ne,{className:"w-full mt-4",children:[e.jsx(Vt,{children:e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Wt,{className:"text-lg",children:"🔒 Tareas Privadas"}),e.jsxs(Ht,{variant:"secondary",className:"text-xs",children:[D.length," total"]})]})})}),e.jsxs(De,{className:"space-y-4",children:[P.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-sm text-gray-600 mb-2",children:["Para hoy (",P.length,")"]}),e.jsx("div",{className:"space-y-2",children:P.map(M=>e.jsx(fc,{task:M,onDelete:h,onEdit:x,onView:W=>{v(W),N(!0)},onMove:(W,H)=>m(W,{startDate:H||void 0}),onAssignTimeOfDay:(W,H)=>m(W,{timeOfDay:H})},M.id))})]}),_.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-sm text-gray-600 mb-2",children:["Pendientes (",_.length,")"]}),e.jsx("div",{className:"space-y-2",children:_.map(M=>e.jsx(fc,{task:M,onDelete:h,onEdit:x,onView:W=>{v(W),N(!0)},onMove:(W,H)=>m(W,{startDate:H||void 0}),onAssignTimeOfDay:(W,H)=>m(W,{timeOfDay:H})},M.id))})]}),D.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("p",{children:"No tienes tareas privadas"}),e.jsx("p",{className:"text-sm",children:"Crea una nueva o importa desde JSON"})]}),n==="saving"&&e.jsx(Ht,{variant:"secondary",className:"text-xs",children:"Guardando..."}),a&&e.jsx("p",{className:"text-sm text-red-500",children:a})]}),e.jsxs(bn,{className:"justify-end flex-wrap gap-2",children:[e.jsxs(Rt,{open:T,onOpenChange:k,children:[e.jsx(Rj,{asChild:!0,children:e.jsxs(z,{size:"sm",variant:"outline",children:[e.jsx(Qi,{className:"w-4 h-4 mr-2"}),"Importar"]})}),e.jsxs(Ct,{children:[e.jsxs(_t,{children:[e.jsx(Pt,{children:"Importar Tareas Privadas"}),e.jsx(rn,{children:"Pega el JSON con las tareas a importar. Todas se marcar\\u00e1n como privadas."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(kt,{placeholder:`Ejemplo - Puedes incluir fechas en formato ISO (YYYY-MM-DD) o dejarlas sin fecha:
[
  {
    "title": "Reflexión personal importante",
    "description": "Pensar sobre mis metas de vida",
    "dueDate": "2024-12-31",
    "category": "personal",
    "priority": "do",
    "size": "mediana"
  },
  {
    "title": "Tarea sensible del trabajo",
    "description": "Revisar tema confidencial",
    "dueDate": "2024-06-15T14:30:00Z",
    "category": "work",
    "priority": "decide"
  },
  {
    "title": "Tarea sin fecha específica",
    "description": "Esta tarea no tiene fecha límite",
    "category": "personal"
  }
]

Formatos de fecha soportados:
- "2024-12-31" (solo fecha)
- "2024-06-15T14:30:00Z" (fecha y hora ISO)
- "2024-06-15T14:30:00" (fecha y hora local)
- Sin campo "dueDate" = sin fecha asignada`,value:S,onChange:M=>E(M.target.value),rows:15,className:"font-mono text-sm"}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(z,{variant:"outline",onClick:()=>k(!1),children:"Cancelar"}),e.jsx(z,{onClick:I,disabled:!S.trim(),children:"Importar Tareas"})]})]})]})]}),e.jsxs(z,{size:"sm",variant:"outline",onClick:R,children:[e.jsx(ta,{className:"w-4 h-4 mr-2"}),"Exportar"]}),e.jsxs(z,{size:"sm",onClick:B,children:[e.jsx(as,{className:"w-4 h-4 mr-2"}),"Nueva Privada"]})]}),e.jsx(tl,{isOpen:r,onClose:()=>g(),onConfirm:M=>{const W={...M,isPrivate:!0};l==="complete"?p(W):l==="edit"?m(o.id,W):c(W)},task:o||{id:"",taskCode:0,title:"",completed:!1,category:"personal",createdAt:{seconds:Date.now()/1e3}},mode:l}),e.jsx(Vu,{task:j,isOpen:w,onClose:()=>N(!1),onEdit:M=>{N(!1),x(M)},onToggle:u})]})},lz=t=>t.charAt(0).toUpperCase()+t.slice(1),cz=({open:t,onOpenChange:s})=>{const{user:n}=qe(),[a,r]=f.useState("config"),[o,l]=f.useState("thisWeek"),[c,m]=f.useState(new Date),[u,h]=f.useState(new Date),[p,g]=f.useState({includeJournal:!0,includeMoods:!0,includeEnergy:!0,includePrivateTasks:!0}),[x,b]=f.useState(!1),j=(D,P)=>{g(_=>({..._,[D]:P}))},v=()=>{const D=new Date;if(o==="thisWeek")return{start:ar(D,{weekStartsOn:1}),end:ha(D,{weekStartsOn:1})};if(o==="lastWeek"){const P=XA(D);return{start:ar(P,{weekStartsOn:1}),end:ha(P,{weekStartsOn:1})}}else return{start:c,end:u}},w=async(D,P)=>{if(!n)return{journals:[],moods:[],energy:[],privateTasks:[]};const _=[],B=[],I=[];for(let M=new Date(D);M<=P;M.setDate(M.getDate()+1)){const W=$e(M);if(p.includeJournal){const H=Te(fe,"journal",`${n.uid}_${W}`),L=await st(H);L.exists()&&_.push({userId:n.uid,text:L.data().text||"",date:W,lastUpdated:L.data().lastUpdated||new Date,displayTime:L.data().displayTime||""})}if(p.includeMoods){const H=Te(fe,"moods",`${n.uid}_${W}`),L=await st(H);L.exists()&&B.push(L.data())}if(p.includeEnergy){const H=Te(fe,"energy",`${n.uid}_${W}`),L=await st(H);L.exists()&&I.push(L.data())}}let R=[];if(p.includePrivateTasks){const M=nn($t(fe,"tasks"),wt("userId","==",n.uid),wt("isPrivate","==",!0));R=(await an(M)).docs.map(H=>({id:H.id,...H.data()})).filter(H=>{var Y;if(!((Y=H.createdAt)!=null&&Y.seconds))return!1;const L=new Date(H.createdAt.seconds*1e3),$=$e(L),q=$e(D),re=$e(P);return $>=q&&$<=re})}return{journals:_,moods:B,energy:I,privateTasks:R}},N=async()=>{if(!n)return;const{start:D,end:P}=v(),{journals:_,moods:B,energy:I,privateTasks:R}=await w(D,P);let M=`# Diario del ${at(D,"dd MMMM yyyy",{locale:kn})} al ${at(P,"dd MMMM yyyy",{locale:kn})}

`;for(let $=new Date(D);$<=P;$.setDate($.getDate()+1)){const q=$e($),re=at($,"EEEE, d 'de' MMMM 'de' yyyy",{locale:kn});M+=`### ${lz(re)}

`;let Y=!1;if(p.includeMoods){const se=B.find(ie=>ie.date===q);se!=null&&se.moods&&se.moods.length>0&&(M+=`**Estados de ánimo:**
`,se.moods.forEach(ie=>{M+=`- ${ie.time}: ${ie.emoji} ${ie.text}
`}),M+=`
`,Y=!0)}if(p.includeEnergy){const se=I.find(ie=>ie.date===q);se!=null&&se.entries&&se.entries.length>0&&(M+=`**Niveles de energía:**
`,se.entries.forEach(ie=>{const U=ie.comment?` - ${ie.comment}`:"";M+=`- ${ie.time}: Nivel ${ie.level}/5${U}
`}),M+=`
`,Y=!0)}if(p.includePrivateTasks){const se=R.filter(ie=>{var ee;if(!((ee=ie.createdAt)!=null&&ee.seconds))return!1;const U=new Date(ie.createdAt.seconds*1e3);return $e(U)===q});se.length>0&&(M+=`**Tareas privadas:**
`,se.forEach(ie=>{const U=ie.completed?"✅":"◯",ee=ie.description?` - ${ie.description}`:"";M+=`- ${U} ${ie.title}${ee}
`}),M+=`
`,Y=!0)}if(p.includeJournal){const se=_.find(ie=>ie.date===q);se!=null&&se.text&&se.text.trim()&&(M+=`**Diario:**
${se.text}

`,Y=!0)}Y||(M+=`_Sin entradas para este día_

`)}const W=new Blob([M],{type:"text/markdown;charset=utf-8"}),H=URL.createObjectURL(W),L=document.createElement("a");L.href=H,L.download=`${$e(D)}_a_${$e(P)}.md`,document.body.appendChild(L),L.click(),document.body.removeChild(L),URL.revokeObjectURL(H)},S=async()=>{b(!0),r("processing");try{await N(),setTimeout(()=>{E()},1e3)}catch(D){console.error("Error exporting:",D)}finally{b(!1)}},E=()=>{r("config"),b(!1),s(!1)},T=()=>Object.values(p).some(Boolean),k=()=>{const{start:D,end:P}=v();return`${at(D,"dd/MM/yyyy")} - ${at(P,"dd/MM/yyyy")}`};return e.jsx(Rt,{open:t,onOpenChange:E,children:e.jsxs(Ct,{className:"max-w-lg",children:[e.jsx(_t,{children:e.jsxs(Pt,{className:"flex items-center gap-2",children:[e.jsx(ta,{className:"w-5 h-5"}),"Exportar Diario"]})}),a==="config"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(Ne,{children:[e.jsx(Vt,{className:"pb-3",children:e.jsxs(Wt,{className:"text-sm flex items-center gap-2",children:[e.jsx(ns,{className:"w-4 h-4"}),"Rango de fechas"]})}),e.jsxs(De,{className:"space-y-3",children:[e.jsxs(Nt,{value:o,onValueChange:D=>l(D),children:[e.jsx(xt,{className:"w-full",children:e.jsx(St,{placeholder:"Seleccionar rango"})}),e.jsxs(gt,{children:[e.jsx(Pe,{value:"thisWeek",children:"Esta semana"}),e.jsx(Pe,{value:"lastWeek",children:"Semana pasada"}),e.jsx(Pe,{value:"custom",children:"Rango personalizado"})]})]}),o==="custom"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"date",className:"border rounded-md px-2 py-1 flex-1 text-sm",value:rf(c),onChange:D=>m(new Date(D.target.value)),placeholder:"Fecha de inicio",title:"Fecha de inicio"}),e.jsx("input",{type:"date",className:"border rounded-md px-2 py-1 flex-1 text-sm",value:rf(u),onChange:D=>h(new Date(D.target.value)),placeholder:"Fecha de fin",title:"Fecha de fin"})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-2",children:["Exportando: ",k()]})]})]}),e.jsxs(Ne,{children:[e.jsx(Vt,{className:"pb-3",children:e.jsx(Wt,{className:"text-sm",children:"Contenido a incluir"})}),e.jsx(De,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(As,{id:"journal",checked:p.includeJournal,onCheckedChange:D=>j("includeJournal",!!D),className:"mt-1"}),e.jsxs("div",{className:"flex items-start gap-2 flex-1",children:[e.jsx(vc,{className:"w-4 h-4 mt-1 text-gray-600"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"journal",className:"text-sm font-medium cursor-pointer block",children:"Entradas del diario"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Contenido textual del diario personal"})]})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(As,{id:"moods",checked:p.includeMoods,onCheckedChange:D=>j("includeMoods",!!D),className:"mt-1"}),e.jsxs("div",{className:"flex items-start gap-2 flex-1",children:[e.jsx(wR,{className:"w-4 h-4 mt-1 text-gray-600"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"moods",className:"text-sm font-medium cursor-pointer block",children:"Estados de ánimo"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Emociones registradas con hora y emoji"})]})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(As,{id:"energy",checked:p.includeEnergy,onCheckedChange:D=>j("includeEnergy",!!D),className:"mt-1"}),e.jsxs("div",{className:"flex items-start gap-2 flex-1",children:[e.jsx(NR,{className:"w-4 h-4 mt-1 text-gray-600"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"energy",className:"text-sm font-medium cursor-pointer block",children:"Niveles de energía"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Registros de energía del 1-5 con comentarios"})]})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(As,{id:"tasks",checked:p.includePrivateTasks,onCheckedChange:D=>j("includePrivateTasks",!!D),className:"mt-1"}),e.jsxs("div",{className:"flex items-start gap-2 flex-1",children:[e.jsx(zf,{className:"w-4 h-4 mt-1 text-gray-600"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tasks",className:"text-sm font-medium cursor-pointer block",children:"Tareas privadas"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Tareas marcadas como privadas"})]})]})]})]})})]})]}),a==="processing"&&e.jsxs("div",{className:"py-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Generando archivo markdown..."})]}),e.jsx(wn,{className:"gap-2",children:a==="config"&&e.jsxs(e.Fragment,{children:[e.jsx(z,{variant:"outline",onClick:E,children:"Cancelar"}),e.jsxs(z,{onClick:S,disabled:!T()||x,className:"flex items-center gap-2",children:[e.jsx(ta,{className:"w-4 h-4"}),"Exportar"]})]})})]})})},zl=({title:t,tasks:s,onDelete:n,onEdit:a,onView:r,onMove:o,onAssignTimeOfDay:l})=>{if(s.length===0)return null;const c={do:0,decide:1,delegate:2,delete:3},m=s.sort((u,h)=>{var x,b;const p=c[u.priority||"none"]??4,g=c[h.priority||"none"]??4;return p!==g?p-g:u.startDate&&h.startDate?u.startDate.getTime()-h.startDate.getTime():!u.startDate&&!h.startDate?(((x=h.createdAt)==null?void 0:x.seconds)||0)-(((b=u.createdAt)==null?void 0:b.seconds)||0):u.startDate?-1:1});return e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-medium text-sm text-gray-500 uppercase tracking-wider pt-4",children:t}),e.jsx("div",{className:"hidden md:block",children:e.jsx(Ne,{children:e.jsxs(De,{className:"p-0",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-4 p-4 bg-gray-50 border-b text-sm font-medium text-gray-700",children:[e.jsx("div",{className:"col-span-4",children:"Tarea"}),e.jsx("div",{className:"col-span-2 text-center",children:"Estado"}),e.jsx("div",{className:"col-span-1 text-center",children:"Prioridad"}),e.jsx("div",{className:"col-span-1 text-center",children:"Tiempo"}),e.jsx("div",{className:"col-span-2 text-center",children:"Fecha"}),e.jsx("div",{className:"col-span-2 text-center",children:"Acciones"})]}),e.jsx("div",{className:"divide-y divide-gray-100",children:m.map(u=>e.jsx(fc,{task:u,onDelete:n,onEdit:a,onView:r,onMove:o,onAssignTimeOfDay:l},u.id))})]})})}),e.jsx("div",{className:"md:hidden space-y-3",children:m.map(u=>e.jsx(fc,{task:u,onDelete:n,onEdit:a,onView:r,onMove:o,onAssignTimeOfDay:l},u.id))})]})},Hv={all:"Todas las fechas",today:"Hoy",week:"Esta semana",month:"Este mes",overdue:"Vencidas",noDate:"Sin fecha"},dz=({tasks:t,onDelete:s,onEdit:n,onView:a,onMove:r,onAssignTimeOfDay:o,status:l,error:c})=>{const[m,u]=f.useState("all"),[h,p]=f.useState("all"),[g,x]=f.useState(!1),[b,j]=f.useState(""),v=f.useMemo(()=>{let E=m==="all"?t:t.filter(I=>I.category===m);if(b.trim()){const I=b.toLowerCase().trim();E=E.filter(R=>R.title.toLowerCase().includes(I)||R.description&&R.description.toLowerCase().includes(I))}const T=new Date,k=cs(T),D=ar(T),P=ha(T),_=ts(T),B=ea(T);switch(h){case"today":return E.filter(I=>I.startDate&&Gi(I.startDate,{start:k,end:Mr(T)}));case"week":return E.filter(I=>I.startDate&&Gi(I.startDate,{start:D,end:P}));case"month":return E.filter(I=>I.startDate&&Gi(I.startDate,{start:_,end:B}));case"overdue":return E.filter(I=>I.startDate&&Ds(I.startDate,k));case"noDate":return E.filter(I=>!I.startDate);default:return E}},[t,m,h,b]),w=f.useMemo(()=>b.trim()!==""||m!=="all"||h!=="all",[b,m,h]),N=()=>{j(""),u("all"),p("all")},S=f.useMemo(()=>{const E=new Date,T=cs(E),k=Mr(E),D=ha(E);return v.reduce((P,_)=>(_.startDate&&Ds(_.startDate,T)?P.overdue.push(_):_.startDate?Ds(_.startDate,k)?P.today.push(_):Ds(_.startDate,D)?P.thisWeek.push(_):P.future.push(_):P.noDate.push(_),P),{overdue:[],today:[],thisWeek:[],future:[],noDate:[]})},[v]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-4 items-stretch sm:items-center",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Vo,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(Be,{placeholder:"Buscar tareas por nombre o descripción...",value:b,onChange:E=>j(E.target.value),className:"pl-10 pr-10"}),b&&e.jsx(z,{variant:"ghost",size:"sm",onClick:()=>j(""),className:"absolute right-1 top-1/2 transform -translate-y-1/2 h-6 w-6 p-0 hover:bg-gray-100",children:e.jsx(Ws,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"md:hidden flex gap-2",children:[e.jsxs(z,{variant:w?"default":"outline",onClick:()=>x(!g),className:`flex items-center gap-2 ${w?"bg-blue-600 hover:bg-blue-700":""}`,children:[e.jsx(Cu,{className:"w-4 h-4"}),"Filtros",w&&e.jsx("span",{className:"bg-white text-blue-600 rounded-full px-2 py-0.5 text-xs font-medium",children:"Activos"})]}),w&&e.jsx(z,{variant:"ghost",onClick:N,className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(Ws,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"hidden md:flex",children:w&&e.jsxs(z,{variant:"ghost",onClick:N,className:"text-red-600 hover:text-red-700 hover:bg-red-50 flex items-center gap-2",children:[e.jsx(Ws,{className:"w-4 h-4"}),"Limpiar filtros"]})})]}),"      ",e.jsxs("div",{className:`space-y-4 md:space-y-0 md:flex md:items-center md:gap-4 ${g?"block":"hidden md:flex"}`,children:[e.jsxs("div",{className:"flex-1 space-y-2 md:space-y-0",children:[e.jsx("span",{className:"text-sm text-gray-500 font-medium block md:inline md:mr-2",children:"Categoría:"}),e.jsxs(Nt,{value:m,onValueChange:E=>u(E),children:[e.jsx(xt,{className:`w-full md:w-[180px] ${m!=="all"?"border-blue-500 bg-blue-50":""}`,children:e.jsx(St,{children:m==="all"?"Todas las categorías":Un[m]})}),e.jsxs(gt,{children:[e.jsx(Pe,{value:"all",children:"Todas las categorías"}),Object.entries(kp).map(([E,T])=>e.jsx(Pe,{value:T,children:Un[T]},E))]})]})]}),e.jsxs("div",{className:"flex-1 space-y-2 md:space-y-0",children:[e.jsx("span",{className:"text-sm text-gray-500 font-medium block md:inline md:mr-2",children:"Fecha:"}),e.jsxs(Nt,{value:h,onValueChange:E=>p(E),children:[e.jsx(xt,{className:`w-full md:w-[180px] ${h!=="all"?"border-blue-500 bg-blue-50":""}`,children:e.jsx(St,{children:Hv[h]})}),e.jsx(gt,{children:Object.entries(Hv).map(([E,T])=>e.jsx(Pe,{value:E,children:T},E))})]})]})]}),e.jsxs("div",{children:[e.jsx(zl,{title:"Tareas Vencidas",tasks:S.overdue,onDelete:s,onEdit:n,onView:a,onMove:r,onAssignTimeOfDay:o}),e.jsx(zl,{title:"Para Hoy",tasks:S.today,onDelete:s,onEdit:n,onView:a,onMove:r,onAssignTimeOfDay:o}),e.jsx(zl,{title:"Esta Semana",tasks:S.thisWeek,onDelete:s,onEdit:n,onView:a,onMove:r,onAssignTimeOfDay:o}),e.jsx(zl,{title:"Próximamente",tasks:S.future,onDelete:s,onEdit:n,onView:a,onMove:r,onAssignTimeOfDay:o}),e.jsx(zl,{title:"Sin Fecha",tasks:S.noDate,onDelete:s,onEdit:n,onView:a,onMove:r,onAssignTimeOfDay:o}),v.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:m==="all"&&h==="all"?"No hay tareas pendientes":"No hay tareas pendientes con los filtros seleccionados"}),l&&l!=="idle"&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs text-gray-500",children:[l==="loading"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border border-gray-300 border-t-blue-500 rounded-full animate-spin"}),e.jsx("span",{children:"Cargando tareas..."})]}),l==="saving"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-3 h-3 border border-gray-300 border-t-blue-500 rounded-full animate-spin"}),e.jsx("span",{children:"Guardando..."})]}),l==="pending"&&e.jsx("span",{className:"text-yellow-600",children:"Pendiente de sincronizar"}),l==="saved"&&e.jsx("span",{className:"text-green-600",children:"✓ Sincronizado"}),l==="error"&&c&&e.jsx("span",{className:"text-red-600",children:"⚠ Error de sincronización"})]})})]})]})},Bp=({error:t,onRetry:s,showClearCache:n=!1})=>{const a=(t==null?void 0:t.includes("sincronización"))||(t==null?void 0:t.includes("INTERNAL ASSERTION"))||(t==null?void 0:t.includes("Unexpected state")),r=async()=>{try{await Jd()}catch(o){console.error("Error clearing cache:",o),alert("Error al limpiar el cache. Intenta recargar la página manualmente.")}};return t?e.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-600 mb-2",children:[e.jsx(jb,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Error de sincronización"})]}),e.jsx("p",{className:"text-sm text-red-600 mb-3",children:t}),e.jsxs("div",{className:"flex gap-2",children:[s&&e.jsxs(z,{type:"button",onClick:s,size:"sm",variant:"outline",className:"text-red-600 border-red-300 hover:bg-red-50",children:[e.jsx(_o,{className:"w-4 h-4 mr-1"}),"Reintentar"]}),(a||n)&&e.jsxs(z,{type:"button",onClick:r,size:"sm",variant:"outline",className:"text-red-600 border-red-300 hover:bg-red-50",children:[e.jsx(Zi,{className:"w-4 h-4 mr-1"}),"Limpiar Cache"]})]}),a&&e.jsx("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded",children:e.jsxs("p",{className:"text-xs text-yellow-800",children:[e.jsx("strong",{children:"Sugerencia:"})," Este error suele ocurrir cuando hay conflictos entre datos guardados offline y en el servidor. Limpiar el cache ayudará a resolver el problema, aunque tendrás que volver a sincronizar tus datos."]})})]}):null},uz={daily:"Diario",weekly:"Semanal",monthly:"Mensual"},Wv={do:{label:"HACER",color:"bg-red-500",text:"Urgente e importante"},decide:{label:"DECIDIR",color:"bg-orange-500",text:"Importante, no urgente"},delegate:{label:"DELEGAR",color:"bg-blue-500",text:"Urgente, no importante"},delete:{label:"ELIMINAR",color:"bg-gray-500",text:"Ni urgente ni importante"},none:{label:"",color:"",text:""}},Ah={do:{icon:"🔥",num:1,style:"bg-red-600 text-white"},decide:{icon:"🤔",num:2,style:"bg-orange-500 text-white"},delegate:{icon:"📬",num:3,style:"bg-blue-500 text-white"},delete:{icon:"🗑️",num:4,style:"bg-gray-500 text-white"},none:{icon:"🗑️",num:4,style:"bg-gray-500 text-white"}},mz=t=>at(t,"dd/MM"),hz=t=>t!=null&&t.type&&uz[t.type]||"",fz=(t="none")=>Wv[t]||Wv.none,pz=t=>t?Ds(cs(t),cs(new Date)):!1,yS=f.memo(({task:t,showCategoryLabel:s,overdue:n})=>{var c,m;const a={bg:((c=no[t.category])==null?void 0:c.bg)||"bg-purple-100",text:((m=no[t.category])==null?void 0:m.text)||"text-purple-800"},r=fz(t.priority),o=hz(t.recurrence),l="text-xs px-1.5 py-0.5";return e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s&&e.jsxs(Ht,{className:ce(l,a.bg,a.text),children:[e.jsx(ic,{className:"w-3 h-3 mr-1"}),Un[t.category]]}),t.startDate&&e.jsxs(Ht,{variant:n?"destructive":"secondary",className:l,children:[e.jsx(ns,{className:"w-3 h-3 mr-1"}),mz(t.startDate),n&&" (vencida)"]}),e.jsx(xa,{children:e.jsxs(Ms,{children:[e.jsx(Is,{asChild:!0,children:e.jsxs(Ht,{className:ce(l,"gap-0.5",Ah[t.priority||"none"].style),children:[e.jsx("span",{className:"mr-0.5",children:Ah[t.priority||"none"].icon}),Ah[t.priority||"none"].num]})}),e.jsx(ks,{children:r.text})]})}),t.estimatedTime!==void 0&&e.jsxs(Ht,{variant:"outline",className:l,children:[e.jsx(Js,{className:"w-3 h-3 mr-1"}),t.estimatedTime,"m"]}),t.isRecurrent&&o&&e.jsxs(Ht,{variant:"outline",className:l,children:[e.jsx(Uf,{className:"w-3 h-3 mr-1"}),o]})]})});yS.displayName="TaskBadges";const bS=f.memo(({task:t,onEdit:s,onDelete:n,onMove:a,onAssignTimeOfDay:r})=>{const o=Xt(),l=f.useCallback(S=>{S.stopPropagation(),a==null||a(t.id,Ia(new Date))},[a,t.id]),c=f.useCallback(S=>{S.stopPropagation(),a==null||a(t.id,Ia(es(new Date,1)))},[a,t.id]),m=f.useCallback(S=>{S.stopPropagation(),a==null||a(t.id,Ia(es(new Date,2)))},[a,t.id]),u=f.useCallback(S=>{S.stopPropagation(),a==null||a(t.id,null)},[a,t.id]),h=f.useCallback(S=>{S.stopPropagation(),r==null||r(t.id,"morning")},[r,t.id]),p=f.useCallback(S=>{S.stopPropagation(),r==null||r(t.id,"afternoon")},[r,t.id]),g=f.useCallback(S=>{S.stopPropagation(),r==null||r(t.id,"evening")},[r,t.id]),x=f.useCallback(S=>{S.stopPropagation(),s(t)},[s,t]),b=f.useCallback(()=>{n(t.id)},[n,t.id]),j=f.useCallback(S=>{S.stopPropagation(),o(`/task/${t.taskCode}/run`)},[o,t.taskCode]),v="h-6 w-6 md:h-5 md:w-5 p-0 rounded-full hover:bg-muted",w=a&&e.jsxs("div",{className:"flex gap-1 pr-2 border-r border-gray-200",children:[e.jsx(z,{variant:"ghost",size:"icon",className:v,title:"Asignar para hoy",onClick:l,children:e.jsx("span",{role:"img","aria-label":"hoy",className:"text-xs",children:"📆"})}),e.jsx(z,{variant:"ghost",size:"icon",className:v,title:"Asignar para mañana",onClick:c,children:e.jsx("span",{role:"img","aria-label":"mañana",className:"text-xs",children:"📋"})}),e.jsx(z,{variant:"ghost",size:"icon",className:v,title:"Asignar para pasado mañana",onClick:m,children:e.jsx("span",{role:"img","aria-label":"pasado mañana",className:"text-xs",children:"📊"})}),e.jsx(z,{variant:"ghost",size:"icon",className:v,title:"Quitar fecha",onClick:u,children:e.jsx("span",{role:"img","aria-label":"sin fecha",className:"text-xs",children:"🚫"})})]}),N=r&&e.jsxs("div",{className:"flex gap-1 pl-2",children:[e.jsx(z,{variant:"ghost",size:"icon",className:ce(v,"bg-amber-50 hover:bg-amber-100"),title:"Horario: Mañana (6AM-12PM)",onClick:h,children:e.jsx("span",{role:"img","aria-label":"horario mañana",className:"text-xs",children:"🌅"})}),e.jsx(z,{variant:"ghost",size:"icon",className:ce(v,"bg-blue-50 hover:bg-blue-100"),title:"Horario: Tarde (12PM-6PM)",onClick:p,children:e.jsx("span",{role:"img","aria-label":"horario tarde",className:"text-xs",children:"🏙️"})}),e.jsx(z,{variant:"ghost",size:"icon",className:ce(v,"bg-purple-50 hover:bg-purple-100"),title:"Horario: Noche (6PM-12AM)",onClick:g,children:e.jsx("span",{role:"img","aria-label":"horario noche",className:"text-xs",children:"🌙"})})]});return e.jsxs("div",{className:"flex justify-between w-full",children:[e.jsxs("div",{className:"flex gap-1",children:[w,N]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(z,{variant:"ghost",size:"icon",className:v,title:"Ejecutar",onClick:j,children:e.jsx(yn,{className:"w-3 h-3 md:w-3 md:h-3 text-green-600"})}),e.jsx(z,{variant:"ghost",size:"icon",className:v,title:"Editar tarea",onClick:x,children:e.jsx(sa,{className:"w-3 h-3 md:w-3 md:h-3 text-muted-foreground"})}),e.jsxs(Ur,{children:[e.jsx(ki,{asChild:!0,children:e.jsx(z,{variant:"ghost",size:"icon",className:ce(v,"hover:bg-red-50"),title:"Eliminar tarea",onClick:S=>S.stopPropagation(),children:e.jsx(Ws,{className:"w-3 h-3 md:w-3 md:h-3 text-red-500"})})}),e.jsxs(mr,{children:[e.jsxs(hr,{children:[e.jsx(pr,{children:"¿Eliminar tarea?"}),e.jsxs(xr,{children:['Esta acción no se puede deshacer. La tarea "',t.title,'" será eliminada permanentemente.']})]}),e.jsxs(fr,{children:[e.jsx(vr,{children:"Cancelar"}),e.jsx(gr,{onClick:b,className:"bg-red-600 hover:bg-red-700",children:"Eliminar"})]})]})]})]})]})});bS.displayName="TaskKanbanActions";const jS=f.memo(({task:t,onDelete:s,onEdit:n,onView:a,onMove:r,onAssignTimeOfDay:o,showCategoryLabel:l=!0})=>{const c=pz(t.startDate??null),{total:m,checked:u}=_u(t.description||""),h=m?t.progress??u/m*100:0,p=f.useCallback(()=>{a==null||a(t)},[a,t]),g=ce("cursor-pointer relative hover:shadow-md transition-all duration-200 border-0 shadow-sm text-sm w-full max-w-none lg:max-w-[18rem]",t.completed?"bg-muted/30":"bg-white",!t.completed&&c&&"border-l-4 border-l-red-500 bg-red-50");return e.jsxs(Ne,{onClick:p,className:g,children:[e.jsx(De,{className:"p-2 md:p-2 flex flex-col gap-1.5",children:e.jsx("div",{className:"flex items-start gap-2",children:e.jsxs("div",{className:"flex-1 min-w-0 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t.isPrivate&&e.jsx("span",{className:"text-xs",children:"🔒"}),e.jsx("span",{className:ce("text-sm break-words line-clamp-2 font-medium flex-1",t.completed?"line-through text-muted-foreground":"text-foreground"),children:t.title}),e.jsxs("span",{className:"text-xs font-mono text-gray-400 flex-shrink-0",children:["#",t.taskCode]})]}),e.jsx("div",{className:"flex flex-wrap gap-1 pt-0.5",children:e.jsx(yS,{task:t,showCategoryLabel:l,overdue:c})}),m>0&&e.jsxs("div",{className:"pt-1 space-y-0.5",children:[e.jsx(Vn,{value:h,className:"h-1"}),e.jsxs("p",{className:"text-[10px] text-right text-muted-foreground",children:[u," de ",m]})]})]})})}),e.jsx(bn,{className:"px-2 py-1.5 bg-gray-50/50 border-t border-gray-100 p-0 md:p-0",children:e.jsx("div",{className:"px-2 py-1.5 w-full",children:e.jsx(bS,{task:t,onEdit:n,onDelete:s,onMove:r,onAssignTimeOfDay:o})})})]})});jS.displayName="TaskItemKanban";const Uv={all:"Todas las fechas",today:"Hoy",tomorrow:"Mañana",week:"Esta semana",month:"Este mes",overdue:"Vencidas",noDate:"Sin fecha"},Vv={all:"Todas",do:"do",decide:"decide",delegate:"delegate",delete:"delete"},Gv={all:"Todas",none:"Sin tamaño",pequeña:"pequeña",mediana:"mediana",grande:"grande"},Ld={all:"Todas",yes:"Sí",no:"No"},qv={all:"Todas",t60:"≤1h",t120:"≤2h",t180:"≤3h",none:"Sin estimación"},Yv={default:"Predeterminado",priorityAsc:"Prioridad ↓",priorityDesc:"Prioridad ↑",durationAsc:"Duración ↓",durationDesc:"Duración ↑"},xz=({tasks:t,onDelete:s,onEdit:n,onView:a,onMove:r,onAdd:o,onFilteredTasksChange:l})=>{const[c,m]=f.useState(null),[u,h]=f.useState("all"),[p,g]=f.useState("today"),[x,b]=f.useState("all"),[j,v]=f.useState("all"),[w,N]=f.useState("all"),[S,E]=f.useState("all"),[T,k]=f.useState("all"),[D,P]=f.useState("default"),[_,B]=f.useState(!1),[I,R]=f.useState(""),M=f.useMemo(()=>{let U=t.filter(de=>!de.isRecurrent&&!de.isPrivate);if(I.trim()){const de=I.toLowerCase().trim();U=U.filter(J=>J.title.toLowerCase().includes(de)||J.description&&J.description.toLowerCase().includes(de))}if(u!=="all"&&(U=U.filter(de=>de.category===u)),x!=="all"&&(U=U.filter(de=>de.priority===x)),j!=="all"&&(j==="none"?U=U.filter(de=>!de.size):U=U.filter(de=>de.size===j)),T!=="all")if(T==="none")U=U.filter(de=>de.estimatedTime===void 0);else{const J={t60:60,t120:120,t180:180,all:1/0,none:0}[T];U=U.filter(ve=>(ve.estimatedTime??1/0)<=J)}w!=="all"&&(U=U.filter(de=>{const J=de.priority==="do"||de.priority==="delegate";return w==="yes"?J:!J})),S!=="all"&&(U=U.filter(de=>{const J=de.priority==="do"||de.priority==="decide";return S==="yes"?J:!J}));const ee=new Date,me=cs(ee),ue=ar(ee),ae=ha(ee),ge=ts(ee),je=ea(ee),we=es(me,1),ke=Mr(we);switch(p){case"today":return U.filter(de=>de.startDate&&Gi(de.startDate,{start:me,end:Mr(ee)}));case"tomorrow":return U.filter(de=>de.startDate&&Gi(de.startDate,{start:we,end:ke}));case"week":return U.filter(de=>de.startDate&&Gi(de.startDate,{start:ue,end:ae}));case"month":return U.filter(de=>de.startDate&&Gi(de.startDate,{start:ge,end:je}));case"overdue":return U.filter(de=>de.startDate&&Ds(de.startDate,me));case"noDate":return U.filter(de=>!de.startDate);default:return U}},[t,u,x,j,w,S,T,p,I]);f.useEffect(()=>{l==null||l(M)},[M,l]);const W=f.useMemo(()=>I.trim()!==""||u!=="all"||p!=="today"||x!=="all"||j!=="all"||w!=="all"||S!=="all"||T!=="all",[I,u,p,x,j,w,S,T]),H=()=>{R(""),h("all"),g("today"),b("all"),v("all"),N("all"),E("all"),k("all"),P("default")},L=f.useMemo(()=>{const U=new Date,ee=cs(U),me=Mr(U),ue=es(cs(U),1),ae=Mr(ue),ge=ha(U),je={do:0,decide:1,delegate:2,delete:3},we=M.reduce((de,J)=>(J.startDate&&Ds(J.startDate,ee)?de.overdue.push(J):J.startDate?Ds(J.startDate,me)?de.today.push(J):Ds(J.startDate,ae)?de.tomorrow.push(J):Ds(J.startDate,ge)?de.thisWeek.push(J):de.future.push(J):de.noDate.push(J),de),{overdue:[],today:[],tomorrow:[],thisWeek:[],future:[],noDate:[]}),ke=(de,J)=>{var zs,gs;const ve=je[de.priority||"none"]??4,ft=je[J.priority||"none"]??4,pt=de.estimatedTime??1/0,ot=J.estimatedTime??1/0;switch(D){case"priorityAsc":if(ve!==ft)return ft-ve;break;case"priorityDesc":if(ve!==ft)return ve-ft;break;case"durationAsc":if(pt!==ot)return pt-ot;break;case"durationDesc":if(pt!==ot)return ot-pt;break;default:if(ve!==ft)return ve-ft}return de.startDate&&J.startDate?de.startDate.getTime()-J.startDate.getTime():!de.startDate&&!J.startDate?(((zs=J.createdAt)==null?void 0:zs.seconds)||0)-(((gs=de.createdAt)==null?void 0:gs.seconds)||0):de.startDate?-1:1};return Object.values(we).forEach(de=>{de.sort(ke)}),we},[M,D]),$=f.useMemo(()=>{const U={overdue:0,today:0,tomorrow:0,thisWeek:0,future:0,noDate:0};return Object.keys(L).forEach(ee=>{U[ee]=L[ee].reduce((me,ue)=>me+(ue.estimatedTime||0),0)}),U},[L]),q=f.useMemo(()=>Object.values($).reduce((U,ee)=>U+ee,0),[$]),re=[{key:"overdue",title:"Vencidas"},{key:"today",title:"Para Hoy"},{key:"tomorrow",title:"Mañana"},{key:"thisWeek",title:"Esta Semana"},{key:"future",title:"Próximamente"},{key:"noDate",title:"Sin Fecha"}],Y=U=>{const ee=new Date;switch(U){case"overdue":return Ia(es(cs(ee),-1));case"today":return Ia(ee);case"tomorrow":return Ia(es(cs(ee),1));case"thisWeek":return Ia(ha(ee));case"future":return Ia(sc(ee,1));case"noDate":default:return null}},se=U=>{c&&(r(c.id,Y(U)),m(null))},ie=()=>{const U=M.map(me=>({nombre:me.title,descripción:me.description||"",categoria:Un[me.category],prioridad:me.priority||"sin prioridad",tamaño:me.size||"sin tamaño",fecha:me.startDate?new Date(me.startDate).toLocaleDateString("es-ES"):"sin fecha",completada:me.completed?"Sí":"No"})),ee=JSON.stringify(U,null,2);navigator.clipboard.writeText(ee).then(()=>{vt.success(`${U.length} tareas filtradas copiadas al portapapeles`)}).catch(()=>{vt.error("Error al copiar las tareas")})};return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-end items-center text-xs text-gray-500 gap-1",children:[e.jsx(Js,{className:"w-3 h-3"}),ql(q)]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-4 items-stretch sm:items-center",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(Vo,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(Be,{placeholder:"Buscar tareas por nombre...",value:I,onChange:U=>R(U.target.value),className:"pl-10 pr-10"}),I&&e.jsx(z,{variant:"ghost",size:"sm",onClick:()=>R(""),className:"absolute right-1 top-1/2 transform -translate-y-1/2 h-6 w-6 p-0 hover:bg-gray-100",children:e.jsx(Ws,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"md:hidden flex gap-2",children:[e.jsxs(z,{variant:W?"default":"outline",onClick:()=>B(!_),className:`flex items-center gap-2 ${W?"bg-blue-600 hover:bg-blue-700":""}`,children:[e.jsx(Cu,{className:"w-4 h-4"}),"Filtros",W&&e.jsx("span",{className:"bg-white text-blue-600 rounded-full px-2 py-0.5 text-xs font-medium",children:"Activos"})]}),W&&e.jsx(z,{variant:"ghost",onClick:H,className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(Ws,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"hidden md:flex",children:W&&e.jsxs(z,{variant:"ghost",onClick:H,className:"text-red-600 hover:text-red-700 hover:bg-red-50 flex items-center gap-2",children:[e.jsx(Ws,{className:"w-4 h-4"}),"Limpiar filtros"]})})]}),e.jsx("div",{className:`${_?"block":"hidden md:block"}`,children:e.jsxs("div",{className:"flex flex-wrap items-end gap-3 md:gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Categoría"}),e.jsxs(Nt,{value:u,onValueChange:U=>h(U),children:[e.jsx(xt,{className:`w-32 ${u!=="all"?"border-blue-500 bg-blue-50":""}`,children:e.jsx(St,{children:u==="all"?"Todas":Un[u]})}),e.jsxs(gt,{children:[e.jsx(Pe,{value:"all",children:"Todas"}),Object.values(kp).map(U=>e.jsx(Pe,{value:U,children:Un[U]},U))]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Fecha"}),e.jsxs(Nt,{value:p,onValueChange:U=>g(U),children:[e.jsx(xt,{className:`w-32 ${p!=="today"?"border-blue-500 bg-blue-50":""}`,children:e.jsx(St,{children:Uv[p]})}),e.jsx(gt,{children:Object.entries(Uv).map(([U,ee])=>e.jsx(Pe,{value:U,children:ee},U))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Prioridad"}),e.jsxs(Nt,{value:x,onValueChange:U=>b(U),children:[e.jsx(xt,{className:`w-24 ${x!=="all"?"border-blue-500 bg-blue-50":""}`,children:e.jsx(St,{children:Vv[x]})}),e.jsx(gt,{children:Object.entries(Vv).map(([U,ee])=>e.jsx(Pe,{value:U,children:ee},U))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Tamaño"}),e.jsxs(Nt,{value:j,onValueChange:U=>v(U),children:[e.jsx(xt,{className:`w-24 ${j!=="all"?"border-blue-500 bg-blue-50":""}`,children:e.jsx(St,{children:Gv[j]})}),e.jsx(gt,{children:Object.entries(Gv).map(([U,ee])=>e.jsx(Pe,{value:U,children:ee},U))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Urgente"}),e.jsxs(Nt,{value:w,onValueChange:U=>N(U),children:[e.jsx(xt,{className:`w-20 ${w!=="all"?"border-blue-500 bg-blue-50":""}`,children:e.jsx(St,{children:Ld[w]})}),e.jsx(gt,{children:Object.entries(Ld).map(([U,ee])=>e.jsx(Pe,{value:U,children:ee},U))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Importante"}),e.jsxs(Nt,{value:S,onValueChange:U=>E(U),children:[e.jsx(xt,{className:`w-20 ${S!=="all"?"border-blue-500 bg-blue-50":""}`,children:e.jsx(St,{children:Ld[S]})}),e.jsx(gt,{children:Object.entries(Ld).map(([U,ee])=>e.jsx(Pe,{value:U,children:ee},U))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Estimado"}),e.jsxs(Nt,{value:T,onValueChange:U=>k(U),children:[e.jsx(xt,{className:`w-24 ${T!=="all"?"border-blue-500 bg-blue-50":""}`,children:e.jsx(St,{children:qv[T]})}),e.jsx(gt,{children:Object.entries(qv).map(([U,ee])=>e.jsx(Pe,{value:U,children:ee},U))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Ordenar"}),e.jsxs(Nt,{value:D,onValueChange:U=>P(U),children:[e.jsx(xt,{className:"w-28",children:e.jsx(St,{children:Yv[D]})}),e.jsx(gt,{children:Object.entries(Yv).map(([U,ee])=>e.jsx(Pe,{value:U,children:ee},U))})]})]}),e.jsx("div",{className:"flex items-end gap-2",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Exportar filtradas"}),e.jsxs(z,{variant:"outline",size:"sm",onClick:ie,className:"flex items-center gap-1 min-w-fit",disabled:M.length===0,title:`Copia al portapapeles las ${M.length} tareas que se muestran actualmente con todos los filtros aplicados`,children:[e.jsx(Ua,{className:"w-3 h-3"}),e.jsxs("span",{className:"whitespace-nowrap",children:["Copiar visibles (",M.length,")"]})]})]})})]})}),e.jsx("div",{className:"flex flex-col lg:flex-row items-start gap-2 lg:gap-4 overflow-x-auto pb-2 p-2 lg:p-3 rounded bg-gradient-to-br from-blue-50 via-indigo-50 to-indigo-100",children:re.map(U=>e.jsxs("div",{className:"w-full lg:w-[16rem] xl:w-[18rem] lg:flex-shrink-0 space-y-2",onDragOver:ee=>ee.preventDefault(),onDrop:()=>se(U.key),children:[e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsxs("h3",{className:"font-medium text-xs lg:text-sm text-gray-500 uppercase tracking-wider flex items-center gap-1",children:[U.title,$[U.key]>0&&e.jsxs("span",{className:"text-[10px] text-gray-400 flex items-center gap-1",children:[e.jsx(Js,{className:"w-3 h-3"}),ql($[U.key])]})]}),e.jsx("div",{className:"flex gap-1",children:e.jsx(z,{size:"icon",variant:"ghost",onClick:()=>o(Y(U.key)),className:"h-6 w-6 lg:h-8 lg:w-8",children:e.jsx(as,{className:"w-3 h-3 lg:w-4 lg:h-4"})})})]}),L[U.key].map(ee=>e.jsx("div",{draggable:!0,onDragStart:()=>m(ee),onDragEnd:()=>m(null),children:e.jsx(jS,{task:ee,onDelete:s,onEdit:n,onView:a,onMove:r,showCategoryLabel:u==="all"})},ee.id))]},U.key))})]})},gz={do:{color:"bg-red-500",text:"Hacer (urgente + importante)",label:"🔥 do"},decide:{color:"bg-orange-500",text:"Decidir (importante)",label:"🤔 decide"},delegate:{color:"bg-blue-500",text:"Delegar (urgente)",label:"📤 delegate"},delete:{color:"bg-gray-400",text:"Eliminar (sin prioridad)",label:"🗑️ delete"}},vz=()=>e.jsxs("div",{className:"mt-6 text-sm",children:[e.jsx("h2",{className:"font-medium mb-2",children:"Convenciones de prioridad"}),e.jsx("ul",{className:"space-y-1",children:Object.entries(gz).map(([t,s])=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(Ht,{className:`text-xs font-normal px-2 py-0.5 text-white ${s.color}`,children:s.label}),e.jsx("span",{children:s.text})]},t))})]}),ci=va("task"),yz=ci?`https://generativelanguage.googleapis.com/v1beta/models/${ci.model}:generateContent`:"",wS=({tasks:t,open:s,onOpenChange:n})=>{const[a,r]=f.useState(!1),o=s!==void 0?s:a,l=n??r,[c,m]=f.useState(null),[u,h]=f.useState(""),[p,g]=f.useState(!1),[x,b]=f.useState(""),[j,v]=f.useState(0),w="AIzaSyAW4Ot-z7OH4ZR3OeaN7vcbkEDlWpo1aMY",N=(ci==null?void 0:ci.prompt)??"Eres un asistente de productividad. Basándote en el estado de ánimo y las tareas pendientes sugiere cuál debería abordar primero.",S=ci==null?void 0:ci.params;f.useEffect(()=>{if(c){const D=t.sort((P,_)=>{var B,I;return(((B=P.startDate)==null?void 0:B.getTime())||1/0)-(((I=_.startDate)==null?void 0:I.getTime())||1/0)}).slice(0,15).map(P=>`- ${P.title}${P.startDate?` (vence ${at(P.startDate,"yyyy-MM-dd")})`:""} - ${Un[P.category]}`).join(`
`);b(`${N}
Estado de ánimo: ${c.text}
Tareas pendientes:
${D}`)}else b("")},[c,t]),f.useEffect(()=>{v(ba(x))},[x]);const E=D=>{try{const P=zt.parse(D);return Fr.sanitize(P)}catch(P){return console.error("Error procesando Markdown:",P),Fr.sanitize(D.replace(/\n/g,"<br>"))}},T=async()=>{var D,P,_,B,I;if(c){g(!0);try{const M=await(await fetch(`${yz}?key=${w}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:x}]}],...S})})).json(),W=(I=(B=(_=(P=(D=M==null?void 0:M.candidates)==null?void 0:D[0])==null?void 0:P.content)==null?void 0:_.parts)==null?void 0:B[0])==null?void 0:I.text;h(W||"No se pudo obtener sugerencia")}catch{h("Error al consultar la API")}finally{g(!1)}}},k=()=>{l(!1),h(""),m(null)};return e.jsxs(Rt,{open:o,onOpenChange:D=>D?l(!0):k(),children:[s===void 0&&e.jsxs(z,{size:"sm",variant:"outline",onClick:()=>l(!0),className:"flex items-center gap-2",children:[e.jsx($s,{className:"w-4 h-4"}),"Sugerir tarea"]}),e.jsx(Ct,{className:"max-w-6xl h-[80vh]",children:e.jsxs("div",{className:"flex-1 flex flex-col sm:flex-row gap-4 min-h-0 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[e.jsxs("div",{className:"flex-1 flex flex-col space-y-4 mb-3",children:[e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx("h2",{className:"text-lg font-medium mb-1",children:"Sugerencia de tarea con IA"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Selecciona tu estado de ánimo para recibir recomendaciones personalizadas"})]}),!c&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"¿Cómo te sientes?"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:Yi.map(D=>e.jsx("div",{className:"relative",children:e.jsxs(z,{variant:"outline",onClick:()=>m(D),className:"h-12 text-lg w-full relative",children:[e.jsx("span",{children:D.emoji}),e.jsx("span",{className:"w-full text-center text-xs text-gray-500 mt-1",children:D.text})]})},D.emoji))})]}),c&&e.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[e.jsx("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-3 p-2 bg-gray-50 rounded-md",children:e.jsxs("span",{children:["Estado de ánimo: ",e.jsxs("strong",{children:[c.emoji," ",c.text]})]})}),e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Prompt para IA:"}),e.jsx(kt,{value:x,onChange:D=>b(D.target.value),className:"flex-1 resize-none min-h-0",placeholder:"Modifica el prompt para personalizar la sugerencia..."})]})]}),c&&e.jsxs("div",{className:"flex flex-col gap-3 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"text-gray-500",children:["Tokens: ",j]}),j>3500&&e.jsx("span",{className:"text-red-500 font-medium",children:"¡Prompt demasiado largo!"})]}),e.jsxs(z,{onClick:T,disabled:p||!w||j>3500,className:"w-full flex items-center justify-center gap-2",size:"lg",children:[p&&e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx($s,{className:"w-4 h-4"}),p?"Consultando IA...":"Generar sugerencia"]}),p&&e.jsx(lr,{className:"mt-2"})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 sm:border-l sm:border-gray-200 sm:pl-4 border-t sm:border-t-0 border-gray-200 pt-4 sm:pt-0",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"Resultado"}),u?e.jsx("div",{className:"flex-1 p-4 bg-muted rounded-md overflow-auto",children:e.jsx("div",{className:`prose prose-sm max-w-none dark:prose-invert\r
                    prose-headings:text-foreground prose-p:text-foreground \r
                    prose-strong:text-foreground prose-ul:text-foreground \r
                    prose-ol:text-foreground prose-li:text-foreground\r
                    prose-code:bg-accent prose-code:px-1 prose-code:py-0.5 prose-code:rounded prose-code:text-foreground\r
                    prose-pre:bg-accent prose-pre:border prose-pre:text-foreground\r
                    prose-blockquote:border-l-accent prose-blockquote:text-foreground`,dangerouslySetInnerHTML:{__html:E(u)}})}):e.jsx("div",{className:"flex-1 flex items-center justify-center text-gray-500 text-sm",children:c?"Haz clic en 'Generar sugerencia' para obtener recomendaciones":"Selecciona tu estado de ánimo para comenzar"})]})]})})]})},di=va("task"),bz=di?`https://generativelanguage.googleapis.com/v1beta/models/${di.model}:generateContent`:"",NS=({tasks:t,onUpdate:s,open:n,onOpenChange:a})=>{var E;const[r,o]=f.useState(!1),l=n!==void 0?n:r,c=a??o,[m,u]=f.useState(!1),[h,p]=f.useState(""),[g,x]=f.useState(""),[b,j]=f.useState(0),v="AIzaSyAW4Ot-z7OH4ZR3OeaN7vcbkEDlWpo1aMY",w=((E=di==null?void 0:di.prompts)==null?void 0:E.reprioritize)??"Analiza la lista de tareas y devuelve un JSON con id, urgent, important, size y estimatedTime (minutos).",N=di==null?void 0:di.params;f.useEffect(()=>{if(l){const T=t.map(k=>`- id:${k.id} title:${k.title} desc:${k.description||""} priority:${k.priority||""} size:${k.size||""} time:${k.estimatedTime||""}`).join(`
`);x(`${w}
${T}`)}},[l,t]),f.useEffect(()=>{j(ba(g))},[g]);const S=async()=>{var T,k,D,P,_;if(t.length!==0){u(!0);try{const I=await(await fetch(`${bz}?key=${v}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:g}]}],...N})})).json(),R=((_=(P=(D=(k=(T=I==null?void 0:I.candidates)==null?void 0:T[0])==null?void 0:k.content)==null?void 0:D.parts)==null?void 0:P[0])==null?void 0:_.text)||"";p(R);const M=R.match(/```json([\s\S]*?)```/),W=M?M[1]:R;JSON.parse(W).forEach(L=>{const $=L.urgent&&L.important?"do":L.important?"decide":L.urgent?"delegate":"delete";s(L.id,{priority:$,size:L.size,estimatedTime:L.estimatedTime})})}catch{p("Error al consultar la API")}finally{u(!1)}}};return e.jsxs(e.Fragment,{children:[n===void 0&&e.jsxs(z,{size:"sm",variant:"outline",onClick:()=>c(!0),className:"flex items-center gap-2",children:[e.jsx($s,{className:"w-4 h-4"}),"Repriorizar"]}),e.jsx(Rt,{open:l,onOpenChange:c,children:e.jsxs(Ct,{className:"max-w-6xl h-[80vh]",children:[e.jsxs(_t,{className:"flex-shrink-0 pb-1 space-y-0",children:[e.jsx(Pt,{className:"text-lg font-medium",children:"Repriorizar Tareas con IA"}),e.jsx(rn,{className:"text-sm mt-1",children:"La IA analizará tus tareas y ajustará automáticamente prioridad, tamaño y tiempo estimado."})]}),e.jsxs("div",{className:"flex-1 flex flex-col sm:flex-row gap-4 min-h-0 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[e.jsxs("div",{className:"flex-1 flex flex-col mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2 flex-shrink-0",children:"Prompt para IA"}),e.jsx(kt,{value:g,onChange:T=>x(T.target.value),className:"flex-1 resize-none min-h-0",placeholder:"Lista de tareas a analizar..."})]}),e.jsxs("div",{className:"flex flex-col gap-3 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"text-gray-500",children:["Tokens: ",b]}),b>3500&&e.jsx("span",{className:"text-red-500 font-medium",children:"¡Prompt demasiado largo!"})]}),e.jsxs(z,{onClick:S,disabled:m||!v||b>3500,className:"w-full flex items-center justify-center gap-2",size:"lg",children:[m&&e.jsx(ls,{className:"w-4 h-4 animate-spin"}),e.jsx($s,{className:"w-4 h-4"}),m?"Analizando...":"Repriorizar tareas"]}),m&&e.jsx(lr,{className:"mt-2"})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 sm:border-l sm:border-gray-200 sm:pl-4 border-t sm:border-t-0 border-gray-200 pt-4 sm:pt-0",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Resultado del análisis"}),h&&e.jsxs(z,{type:"button",size:"sm",variant:"outline",onClick:()=>{navigator.clipboard.writeText(h),vt.success("Análisis copiado al portapapeles")},className:"flex items-center gap-1",children:[e.jsx(Ua,{className:"w-4 h-4"}),"Copiar"]})]}),e.jsx("div",{className:"flex-1 flex flex-col min-h-0",children:e.jsx("div",{className:"flex-1 bg-gray-50 border border-gray-200 rounded-md p-3 overflow-auto",children:h?e.jsx("pre",{className:"text-xs whitespace-pre-wrap font-mono text-gray-700",children:h}):m?e.jsx("div",{className:"text-sm text-gray-500",children:"Analizando tareas..."}):e.jsx("div",{className:"text-sm text-gray-500",children:"El análisis y repriorizacion aparecerá aquí. Las tareas se actualizarán automáticamente una vez completado el análisis."})})})]})]}),e.jsx("div",{className:"flex-shrink-0 mt-4 pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 text-xs text-gray-500",children:[e.jsx("span",{children:"💡 Tip: Las tareas se actualizarán automáticamente según la matriz de Eisenhower"}),!v]})})]})})]})},jz={daily:"Diario",weekly:"Semanal",monthly:"Mensual"},Kv={do:{label:"HACER",color:"bg-red-500",text:"Urgente e importante"},decide:{label:"DECIDIR",color:"bg-orange-500",text:"Importante, no urgente"},delegate:{label:"DELEGAR",color:"bg-blue-500",text:"Urgente, no importante"},delete:{label:"ELIMINAR",color:"bg-gray-500",text:"Ni urgente ni importante"},none:{label:"",color:"",text:""}},Rh={do:{icon:"🔥",num:1,style:"bg-red-600 text-white"},decide:{icon:"🤔",num:2,style:"bg-orange-500 text-white"},delegate:{icon:"📬",num:3,style:"bg-blue-500 text-white"},delete:{icon:"🗑️",num:4,style:"bg-gray-500 text-white"},none:{icon:"🗑️",num:4,style:"bg-gray-500 text-white"}},wz=t=>at(t,"dd/MM"),Nz=t=>t!=null&&t.type&&jz[t.type]||"",Sz=(t="none")=>Kv[t]||Kv.none,Cz=t=>t?Ds(cs(t),cs(new Date)):!1,Ez=(t,s)=>{const n=at(t,"HH:mm");if(s){const a=at(s,"HH:mm");return`${n} - ${a}`}return n},SS=f.memo(({task:t,showCategoryLabel:s,overdue:n})=>{var l,c;const a={bg:((l=no[t.category])==null?void 0:l.bg)||"bg-purple-100",text:((c=no[t.category])==null?void 0:c.text)||"text-purple-800"},r=Sz(t.priority),o=Nz(t.recurrence);return e.jsxs("div",{className:"flex flex-wrap gap-0.5 leading-none",children:[s&&e.jsxs(Ht,{className:ce("text-xs px-1 py-0 h-auto",a.bg,a.text),children:[e.jsx(ic,{className:"w-3 h-3 mr-0.5"}),Un[t.category]]}),t.startDate&&e.jsxs(Ht,{variant:n?"destructive":"secondary",className:"text-xs px-1 py-0 h-auto",children:[e.jsx(ns,{className:"w-3 h-3 mr-0.5"}),wz(t.startDate),n&&" (vencida)"]}),t.startDate&&(t.startDate.getHours()!==12||t.startDate.getMinutes()!==0)&&e.jsxs(Ht,{variant:"outline",className:"text-xs px-1 py-0 h-auto bg-blue-50 text-blue-700",children:[e.jsx(Js,{className:"w-3 h-3 mr-0.5"}),Ez(t.startDate,t.endDate)]}),e.jsx(xa,{children:e.jsxs(Ms,{children:[e.jsx(Is,{asChild:!0,children:e.jsxs(Ht,{className:ce("text-xs px-1 py-0 h-auto gap-0.5",Rh[t.priority||"none"].style),children:[e.jsx("span",{children:Rh[t.priority||"none"].icon}),Rh[t.priority||"none"].num]})}),e.jsx(ks,{children:r.text})]})}),t.estimatedTime!==void 0&&e.jsxs(Ht,{variant:"outline",className:"text-xs px-1 py-0 h-auto",children:[e.jsx(Js,{className:"w-3 h-3 mr-0.5"}),t.estimatedTime,"m"]}),t.isRecurrent&&o&&e.jsxs(Ht,{variant:"outline",className:"text-xs px-1 py-0 h-auto",children:[e.jsx(Uf,{className:"w-3 h-3 mr-0.5"}),o]}),!s&&t.size&&e.jsx(Ht,{variant:"outline",className:"text-xs px-1 py-0 h-auto",children:t.size})]})});SS.displayName="TaskBadges";const CS=f.memo(({task:t,onEdit:s,onDelete:n,onMove:a})=>{const r=Xt(),o=f.useCallback(x=>{x.stopPropagation(),a==null||a(t.id,Ia(new Date))},[a,t.id]),l=f.useCallback(x=>{x.stopPropagation(),a==null||a(t.id,Ia(es(new Date,1)))},[a,t.id]),c=f.useCallback(x=>{x.stopPropagation(),a==null||a(t.id,Ia(es(new Date,2)))},[a,t.id]),m=f.useCallback(x=>{x.stopPropagation(),a==null||a(t.id,null)},[a,t.id]),u=f.useCallback(x=>{x.stopPropagation(),s(t)},[s,t]),h=f.useCallback(()=>{n(t.id)},[n,t.id]),p=f.useCallback(x=>{x.stopPropagation(),r(`/task/${t.taskCode}/run`)},[r,t.taskCode]),g="h-4 w-4 p-0 rounded-full hover:bg-muted";return e.jsxs("div",{className:"flex items-center justify-center gap-0.5 py-0.5",children:[a&&e.jsxs("div",{className:"flex gap-0.5 pr-1 border-r border-gray-200",children:[e.jsx(z,{variant:"ghost",size:"icon",className:g,title:"Asignar para hoy",onClick:o,children:e.jsx("span",{role:"img","aria-label":"hoy",className:"text-[10px]",children:"📆"})}),e.jsx(z,{variant:"ghost",size:"icon",className:g,title:"Asignar para mañana",onClick:l,children:e.jsx("span",{role:"img","aria-label":"mañana",className:"text-[10px]",children:"📋"})}),e.jsx(z,{variant:"ghost",size:"icon",className:g,title:"Asignar para pasado mañana",onClick:c,children:e.jsx("span",{role:"img","aria-label":"pasado mañana",className:"text-[10px]",children:"📊"})}),e.jsx(z,{variant:"ghost",size:"icon",className:g,title:"Quitar fecha",onClick:m,children:e.jsx("span",{role:"img","aria-label":"sin fecha",className:"text-[10px]",children:"🚫"})})]}),e.jsx(z,{variant:"ghost",size:"icon",className:g,title:"Ejecutar",onClick:p,children:e.jsx(yn,{className:"w-2.5 h-2.5 text-green-600"})}),e.jsx(z,{variant:"ghost",size:"icon",className:g,title:"Editar tarea",onClick:u,children:e.jsx(sa,{className:"w-2.5 h-2.5 text-muted-foreground"})}),e.jsxs(Ur,{children:[e.jsx(ki,{asChild:!0,children:e.jsx(z,{variant:"ghost",size:"icon",className:ce(g,"hover:bg-red-50"),title:"Eliminar tarea",onClick:x=>x.stopPropagation(),children:e.jsx(Ws,{className:"w-2.5 h-2.5 text-red-500"})})}),e.jsxs(mr,{children:[e.jsxs(hr,{children:[e.jsx(pr,{children:"¿Eliminar tarea?"}),e.jsxs(xr,{children:['Esta acción no se puede deshacer. La tarea "',t.title,'" será eliminada permanentemente.']})]}),e.jsxs(fr,{children:[e.jsx(vr,{children:"Cancelar"}),e.jsx(gr,{onClick:h,className:"bg-red-600 hover:bg-red-700",children:"Eliminar"})]})]})]})]})});CS.displayName="TaskCalendarActions";const Pc=f.memo(({task:t,onDelete:s,onEdit:n,onView:a,onMove:r,showCategoryLabel:o=!0})=>{const l=Cz(t.startDate??null),{total:c,checked:m}=_u(t.description||""),u=c?t.progress??m/c*100:0,h=f.useCallback(()=>{a==null||a(t)},[a,t]),p=ce("cursor-pointer relative hover:shadow-md transition-all duration-200 border-0 shadow-sm bg-white",t.completed&&"opacity-70 bg-gray-50",!t.completed&&l&&"border-l-4 border-l-red-500 bg-red-50");return e.jsxs(Ne,{onClick:h,className:p,children:[e.jsxs(De,{className:"px-1 py-0.5 space-y-0.5",children:[e.jsx("div",{className:"space-y-0",children:e.jsxs("div",{className:"flex items-center gap-1",children:[t.isPrivate&&e.jsx("span",{className:"text-[10px]",children:"🔒"}),e.jsx("span",{className:ce("text-xs font-medium leading-none line-clamp-1 flex-1",t.completed?"line-through text-muted-foreground":"text-foreground"),children:t.title}),e.jsxs("span",{className:"text-[10px] font-mono text-gray-400 flex-shrink-0",children:["#",t.taskCode]})]})}),e.jsx(SS,{task:t,showCategoryLabel:o,overdue:l}),c>0&&e.jsxs("div",{className:"space-y-0",children:[e.jsx(Vn,{value:u,className:"h-0.5"}),e.jsxs("p",{className:"text-[10px] text-right text-muted-foreground leading-none",children:[m," de ",c]})]})]}),e.jsx(bn,{className:"!px-0.5 !py-0.5 bg-gray-50/50 border-t border-gray-100",children:e.jsx("div",{className:"w-full",children:e.jsx(CS,{task:t,onEdit:n,onDelete:s,onMove:r})})})]})});Pc.displayName="TaskItemCalendar";const Tz=({tasks:t,onDelete:s,onEdit:n,onView:a,onMove:r})=>{const o=cs(new Date),l=f.useMemo(()=>t.filter(c=>c.startDate?Ds(c.startDate,o)&&!c.completed:!1).sort((c,m)=>c.startDate&&m.startDate?c.startDate.getTime()-m.startDate.getTime():0),[t,o]);return l.length===0?null:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"sticky top-0 bg-white py-2 z-10",children:e.jsxs("h3",{className:"text-sm font-semibold text-red-600 flex items-center gap-2",children:[e.jsx("span",{children:"🔴"}),"Tareas Vencidas (",l.length,")"]})}),e.jsx("div",{className:"space-y-2",children:l.map(c=>e.jsx(Pc,{task:c,onDelete:s,onEdit:n,onView:a,onMove:r,showCategoryLabel:!0},c.id))})]})},qu=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function sl(t){const s=Object.prototype.toString.call(t);return s==="[object Window]"||s==="[object global]"}function Hp(t){return"nodeType"in t}function Gn(t){var s,n;return t?sl(t)?t:Hp(t)&&(s=(n=t.ownerDocument)==null?void 0:n.defaultView)!=null?s:window:window}function Wp(t){const{Document:s}=Gn(t);return t instanceof s}function Mc(t){return sl(t)?!1:t instanceof Gn(t).HTMLElement}function ES(t){return t instanceof Gn(t).SVGElement}function nl(t){return t?sl(t)?t.document:Hp(t)?Wp(t)?t:Mc(t)||ES(t)?t.ownerDocument:document:document:document}const Ci=qu?f.useLayoutEffect:f.useEffect;function Up(t){const s=f.useRef(t);return Ci(()=>{s.current=t}),f.useCallback(function(){for(var n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return s.current==null?void 0:s.current(...a)},[])}function Dz(){const t=f.useRef(null),s=f.useCallback((a,r)=>{t.current=setInterval(a,r)},[]),n=f.useCallback(()=>{t.current!==null&&(clearInterval(t.current),t.current=null)},[]);return[s,n]}function Vp(t,s){s===void 0&&(s=[t]);const n=f.useRef(t);return Ci(()=>{n.current!==t&&(n.current=t)},s),n}function Ic(t,s){const n=f.useRef();return f.useMemo(()=>{const a=t(n.current);return n.current=a,a},[...s])}function wf(t){const s=Up(t),n=f.useRef(null),a=f.useCallback(r=>{r!==n.current&&(s==null||s(r,n.current)),n.current=r},[]);return[n,a]}function Nf(t){const s=f.useRef();return f.useEffect(()=>{s.current=t},[t]),s.current}let _h={};function Gp(t,s){return f.useMemo(()=>{if(s)return s;const n=_h[t]==null?0:_h[t]+1;return _h[t]=n,t+"-"+n},[t,s])}function TS(t){return function(s){for(var n=arguments.length,a=new Array(n>1?n-1:0),r=1;r<n;r++)a[r-1]=arguments[r];return a.reduce((o,l)=>{const c=Object.entries(l);for(const[m,u]of c){const h=o[m];h!=null&&(o[m]=h+t*u)}return o},{...s})}}const Do=TS(1),cu=TS(-1);function kz(t){return"clientX"in t&&"clientY"in t}function DS(t){if(!t)return!1;const{KeyboardEvent:s}=Gn(t.target);return s&&t instanceof s}function Az(t){if(!t)return!1;const{TouchEvent:s}=Gn(t.target);return s&&t instanceof s}function Sf(t){if(Az(t)){if(t.touches&&t.touches.length){const{clientX:s,clientY:n}=t.touches[0];return{x:s,y:n}}else if(t.changedTouches&&t.changedTouches.length){const{clientX:s,clientY:n}=t.changedTouches[0];return{x:s,y:n}}}return kz(t)?{x:t.clientX,y:t.clientY}:null}const Cf=Object.freeze({Translate:{toString(t){if(!t)return;const{x:s,y:n}=t;return"translate3d("+(s?Math.round(s):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(t){if(!t)return;const{scaleX:s,scaleY:n}=t;return"scaleX("+s+") scaleY("+n+")"}},Transform:{toString(t){if(t)return[Cf.Translate.toString(t),Cf.Scale.toString(t)].join(" ")}},Transition:{toString(t){let{property:s,duration:n,easing:a}=t;return s+" "+n+"ms "+a}}}),Jv="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function Rz(t){return t.matches(Jv)?t:t.querySelector(Jv)}const _z={display:"none"};function Pz(t){let{id:s,value:n}=t;return Z.createElement("div",{id:s,style:_z},n)}function Mz(t){let{id:s,announcement:n,ariaLiveType:a="assertive"}=t;const r={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return Z.createElement("div",{id:s,style:r,role:"status","aria-live":a,"aria-atomic":!0},n)}function Iz(){const[t,s]=f.useState("");return{announce:f.useCallback(a=>{a!=null&&s(a)},[]),announcement:t}}const kS=f.createContext(null);function Oz(t){const s=f.useContext(kS);f.useEffect(()=>{if(!s)throw new Error("useDndMonitor must be used within a children of <DndContext>");return s(t)},[t,s])}function Lz(){const[t]=f.useState(()=>new Set),s=f.useCallback(a=>(t.add(a),()=>t.delete(a)),[t]);return[f.useCallback(a=>{let{type:r,event:o}=a;t.forEach(l=>{var c;return(c=l[r])==null?void 0:c.call(l,o)})},[t]),s]}const $z={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},zz={onDragStart(t){let{active:s}=t;return"Picked up draggable item "+s.id+"."},onDragOver(t){let{active:s,over:n}=t;return n?"Draggable item "+s.id+" was moved over droppable area "+n.id+".":"Draggable item "+s.id+" is no longer over a droppable area."},onDragEnd(t){let{active:s,over:n}=t;return n?"Draggable item "+s.id+" was dropped over droppable area "+n.id:"Draggable item "+s.id+" was dropped."},onDragCancel(t){let{active:s}=t;return"Dragging was cancelled. Draggable item "+s.id+" was dropped."}};function Fz(t){let{announcements:s=zz,container:n,hiddenTextDescribedById:a,screenReaderInstructions:r=$z}=t;const{announce:o,announcement:l}=Iz(),c=Gp("DndLiveRegion"),[m,u]=f.useState(!1);if(f.useEffect(()=>{u(!0)},[]),Oz(f.useMemo(()=>({onDragStart(p){let{active:g}=p;o(s.onDragStart({active:g}))},onDragMove(p){let{active:g,over:x}=p;s.onDragMove&&o(s.onDragMove({active:g,over:x}))},onDragOver(p){let{active:g,over:x}=p;o(s.onDragOver({active:g,over:x}))},onDragEnd(p){let{active:g,over:x}=p;o(s.onDragEnd({active:g,over:x}))},onDragCancel(p){let{active:g,over:x}=p;o(s.onDragCancel({active:g,over:x}))}}),[o,s])),!m)return null;const h=Z.createElement(Z.Fragment,null,Z.createElement(Pz,{id:a,value:r.draggable}),Z.createElement(Mz,{id:c,announcement:l}));return n?xi.createPortal(h,n):h}var xn;(function(t){t.DragStart="dragStart",t.DragMove="dragMove",t.DragEnd="dragEnd",t.DragCancel="dragCancel",t.DragOver="dragOver",t.RegisterDroppable="registerDroppable",t.SetDroppableDisabled="setDroppableDisabled",t.UnregisterDroppable="unregisterDroppable"})(xn||(xn={}));function du(){}function Bz(t,s){return f.useMemo(()=>({sensor:t,options:s??{}}),[t,s])}function Hz(){for(var t=arguments.length,s=new Array(t),n=0;n<t;n++)s[n]=arguments[n];return f.useMemo(()=>[...s].filter(a=>a!=null),[...s])}const Wa=Object.freeze({x:0,y:0});function Wz(t,s){let{data:{value:n}}=t,{data:{value:a}}=s;return a-n}function Uz(t,s){if(!t||t.length===0)return null;const[n]=t;return n[s]}function Vz(t,s){const n=Math.max(s.top,t.top),a=Math.max(s.left,t.left),r=Math.min(s.left+s.width,t.left+t.width),o=Math.min(s.top+s.height,t.top+t.height),l=r-a,c=o-n;if(a<r&&n<o){const m=s.width*s.height,u=t.width*t.height,h=l*c,p=h/(m+u-h);return Number(p.toFixed(4))}return 0}const Gz=t=>{let{collisionRect:s,droppableRects:n,droppableContainers:a}=t;const r=[];for(const o of a){const{id:l}=o,c=n.get(l);if(c){const m=Vz(c,s);m>0&&r.push({id:l,data:{droppableContainer:o,value:m}})}}return r.sort(Wz)};function qz(t,s,n){return{...t,scaleX:s&&n?s.width/n.width:1,scaleY:s&&n?s.height/n.height:1}}function AS(t,s){return t&&s?{x:t.left-s.left,y:t.top-s.top}:Wa}function Yz(t){return function(n){for(var a=arguments.length,r=new Array(a>1?a-1:0),o=1;o<a;o++)r[o-1]=arguments[o];return r.reduce((l,c)=>({...l,top:l.top+t*c.y,bottom:l.bottom+t*c.y,left:l.left+t*c.x,right:l.right+t*c.x}),{...n})}}const Kz=Yz(1);function Jz(t){if(t.startsWith("matrix3d(")){const s=t.slice(9,-1).split(/, /);return{x:+s[12],y:+s[13],scaleX:+s[0],scaleY:+s[5]}}else if(t.startsWith("matrix(")){const s=t.slice(7,-1).split(/, /);return{x:+s[4],y:+s[5],scaleX:+s[0],scaleY:+s[3]}}return null}function Xz(t,s,n){const a=Jz(s);if(!a)return t;const{scaleX:r,scaleY:o,x:l,y:c}=a,m=t.left-l-(1-r)*parseFloat(n),u=t.top-c-(1-o)*parseFloat(n.slice(n.indexOf(" ")+1)),h=r?t.width/r:t.width,p=o?t.height/o:t.height;return{width:h,height:p,top:u,right:m+h,bottom:u+p,left:m}}const Zz={ignoreTransform:!1};function Oc(t,s){s===void 0&&(s=Zz);let n=t.getBoundingClientRect();if(s.ignoreTransform){const{transform:u,transformOrigin:h}=Gn(t).getComputedStyle(t);u&&(n=Xz(n,u,h))}const{top:a,left:r,width:o,height:l,bottom:c,right:m}=n;return{top:a,left:r,width:o,height:l,bottom:c,right:m}}function Xv(t){return Oc(t,{ignoreTransform:!0})}function Qz(t){const s=t.innerWidth,n=t.innerHeight;return{top:0,left:0,right:s,bottom:n,width:s,height:n}}function e6(t,s){return s===void 0&&(s=Gn(t).getComputedStyle(t)),s.position==="fixed"}function t6(t,s){s===void 0&&(s=Gn(t).getComputedStyle(t));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(r=>{const o=s[r];return typeof o=="string"?n.test(o):!1})}function qp(t,s){const n=[];function a(r){if(s!=null&&n.length>=s||!r)return n;if(Wp(r)&&r.scrollingElement!=null&&!n.includes(r.scrollingElement))return n.push(r.scrollingElement),n;if(!Mc(r)||ES(r)||n.includes(r))return n;const o=Gn(t).getComputedStyle(r);return r!==t&&t6(r,o)&&n.push(r),e6(r,o)?n:a(r.parentNode)}return t?a(t):n}function RS(t){const[s]=qp(t,1);return s??null}function Ph(t){return!qu||!t?null:sl(t)?t:Hp(t)?Wp(t)||t===nl(t).scrollingElement?window:Mc(t)?t:null:null}function _S(t){return sl(t)?t.scrollX:t.scrollLeft}function PS(t){return sl(t)?t.scrollY:t.scrollTop}function Ef(t){return{x:_S(t),y:PS(t)}}var tn;(function(t){t[t.Forward=1]="Forward",t[t.Backward=-1]="Backward"})(tn||(tn={}));function MS(t){return!qu||!t?!1:t===document.scrollingElement}function IS(t){const s={x:0,y:0},n=MS(t)?{height:window.innerHeight,width:window.innerWidth}:{height:t.clientHeight,width:t.clientWidth},a={x:t.scrollWidth-n.width,y:t.scrollHeight-n.height},r=t.scrollTop<=s.y,o=t.scrollLeft<=s.x,l=t.scrollTop>=a.y,c=t.scrollLeft>=a.x;return{isTop:r,isLeft:o,isBottom:l,isRight:c,maxScroll:a,minScroll:s}}const s6={x:.2,y:.2};function n6(t,s,n,a,r){let{top:o,left:l,right:c,bottom:m}=n;a===void 0&&(a=10),r===void 0&&(r=s6);const{isTop:u,isBottom:h,isLeft:p,isRight:g}=IS(t),x={x:0,y:0},b={x:0,y:0},j={height:s.height*r.y,width:s.width*r.x};return!u&&o<=s.top+j.height?(x.y=tn.Backward,b.y=a*Math.abs((s.top+j.height-o)/j.height)):!h&&m>=s.bottom-j.height&&(x.y=tn.Forward,b.y=a*Math.abs((s.bottom-j.height-m)/j.height)),!g&&c>=s.right-j.width?(x.x=tn.Forward,b.x=a*Math.abs((s.right-j.width-c)/j.width)):!p&&l<=s.left+j.width&&(x.x=tn.Backward,b.x=a*Math.abs((s.left+j.width-l)/j.width)),{direction:x,speed:b}}function a6(t){if(t===document.scrollingElement){const{innerWidth:o,innerHeight:l}=window;return{top:0,left:0,right:o,bottom:l,width:o,height:l}}const{top:s,left:n,right:a,bottom:r}=t.getBoundingClientRect();return{top:s,left:n,right:a,bottom:r,width:t.clientWidth,height:t.clientHeight}}function OS(t){return t.reduce((s,n)=>Do(s,Ef(n)),Wa)}function r6(t){return t.reduce((s,n)=>s+_S(n),0)}function i6(t){return t.reduce((s,n)=>s+PS(n),0)}function o6(t,s){if(s===void 0&&(s=Oc),!t)return;const{top:n,left:a,bottom:r,right:o}=s(t);RS(t)&&(r<=0||o<=0||n>=window.innerHeight||a>=window.innerWidth)&&t.scrollIntoView({block:"center",inline:"center"})}const l6=[["x",["left","right"],r6],["y",["top","bottom"],i6]];class Yp{constructor(s,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const a=qp(n),r=OS(a);this.rect={...s},this.width=s.width,this.height=s.height;for(const[o,l,c]of l6)for(const m of l)Object.defineProperty(this,m,{get:()=>{const u=c(a),h=r[o]-u;return this.rect[m]+h},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Yl{constructor(s){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var a;return(a=this.target)==null?void 0:a.removeEventListener(...n)})},this.target=s}add(s,n,a){var r;(r=this.target)==null||r.addEventListener(s,n,a),this.listeners.push([s,n,a])}}function c6(t){const{EventTarget:s}=Gn(t);return t instanceof s?t:nl(t)}function Mh(t,s){const n=Math.abs(t.x),a=Math.abs(t.y);return typeof s=="number"?Math.sqrt(n**2+a**2)>s:"x"in s&&"y"in s?n>s.x&&a>s.y:"x"in s?n>s.x:"y"in s?a>s.y:!1}var ua;(function(t){t.Click="click",t.DragStart="dragstart",t.Keydown="keydown",t.ContextMenu="contextmenu",t.Resize="resize",t.SelectionChange="selectionchange",t.VisibilityChange="visibilitychange"})(ua||(ua={}));function Zv(t){t.preventDefault()}function d6(t){t.stopPropagation()}var os;(function(t){t.Space="Space",t.Down="ArrowDown",t.Right="ArrowRight",t.Left="ArrowLeft",t.Up="ArrowUp",t.Esc="Escape",t.Enter="Enter",t.Tab="Tab"})(os||(os={}));const LS={start:[os.Space,os.Enter],cancel:[os.Esc],end:[os.Space,os.Enter,os.Tab]},u6=(t,s)=>{let{currentCoordinates:n}=s;switch(t.code){case os.Right:return{...n,x:n.x+25};case os.Left:return{...n,x:n.x-25};case os.Down:return{...n,y:n.y+25};case os.Up:return{...n,y:n.y-25}}};class $S{constructor(s){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=s;const{event:{target:n}}=s;this.props=s,this.listeners=new Yl(nl(n)),this.windowListeners=new Yl(Gn(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(ua.Resize,this.handleCancel),this.windowListeners.add(ua.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(ua.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:s,onStart:n}=this.props,a=s.node.current;a&&o6(a),n(Wa)}handleKeyDown(s){if(DS(s)){const{active:n,context:a,options:r}=this.props,{keyboardCodes:o=LS,coordinateGetter:l=u6,scrollBehavior:c="smooth"}=r,{code:m}=s;if(o.end.includes(m)){this.handleEnd(s);return}if(o.cancel.includes(m)){this.handleCancel(s);return}const{collisionRect:u}=a.current,h=u?{x:u.left,y:u.top}:Wa;this.referenceCoordinates||(this.referenceCoordinates=h);const p=l(s,{active:n,context:a.current,currentCoordinates:h});if(p){const g=cu(p,h),x={x:0,y:0},{scrollableAncestors:b}=a.current;for(const j of b){const v=s.code,{isTop:w,isRight:N,isLeft:S,isBottom:E,maxScroll:T,minScroll:k}=IS(j),D=a6(j),P={x:Math.min(v===os.Right?D.right-D.width/2:D.right,Math.max(v===os.Right?D.left:D.left+D.width/2,p.x)),y:Math.min(v===os.Down?D.bottom-D.height/2:D.bottom,Math.max(v===os.Down?D.top:D.top+D.height/2,p.y))},_=v===os.Right&&!N||v===os.Left&&!S,B=v===os.Down&&!E||v===os.Up&&!w;if(_&&P.x!==p.x){const I=j.scrollLeft+g.x,R=v===os.Right&&I<=T.x||v===os.Left&&I>=k.x;if(R&&!g.y){j.scrollTo({left:I,behavior:c});return}R?x.x=j.scrollLeft-I:x.x=v===os.Right?j.scrollLeft-T.x:j.scrollLeft-k.x,x.x&&j.scrollBy({left:-x.x,behavior:c});break}else if(B&&P.y!==p.y){const I=j.scrollTop+g.y,R=v===os.Down&&I<=T.y||v===os.Up&&I>=k.y;if(R&&!g.x){j.scrollTo({top:I,behavior:c});return}R?x.y=j.scrollTop-I:x.y=v===os.Down?j.scrollTop-T.y:j.scrollTop-k.y,x.y&&j.scrollBy({top:-x.y,behavior:c});break}}this.handleMove(s,Do(cu(p,this.referenceCoordinates),x))}}}handleMove(s,n){const{onMove:a}=this.props;s.preventDefault(),a(n)}handleEnd(s){const{onEnd:n}=this.props;s.preventDefault(),this.detach(),n()}handleCancel(s){const{onCancel:n}=this.props;s.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}$S.activators=[{eventName:"onKeyDown",handler:(t,s,n)=>{let{keyboardCodes:a=LS,onActivation:r}=s,{active:o}=n;const{code:l}=t.nativeEvent;if(a.start.includes(l)){const c=o.activatorNode.current;return c&&t.target!==c?!1:(t.preventDefault(),r==null||r({event:t.nativeEvent}),!0)}return!1}}];function Qv(t){return!!(t&&"distance"in t)}function ey(t){return!!(t&&"delay"in t)}class Kp{constructor(s,n,a){var r;a===void 0&&(a=c6(s.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=s,this.events=n;const{event:o}=s,{target:l}=o;this.props=s,this.events=n,this.document=nl(l),this.documentListeners=new Yl(this.document),this.listeners=new Yl(a),this.windowListeners=new Yl(Gn(l)),this.initialCoordinates=(r=Sf(o))!=null?r:Wa,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:s,props:{options:{activationConstraint:n,bypassActivationConstraint:a}}}=this;if(this.listeners.add(s.move.name,this.handleMove,{passive:!1}),this.listeners.add(s.end.name,this.handleEnd),s.cancel&&this.listeners.add(s.cancel.name,this.handleCancel),this.windowListeners.add(ua.Resize,this.handleCancel),this.windowListeners.add(ua.DragStart,Zv),this.windowListeners.add(ua.VisibilityChange,this.handleCancel),this.windowListeners.add(ua.ContextMenu,Zv),this.documentListeners.add(ua.Keydown,this.handleKeydown),n){if(a!=null&&a({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(ey(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if(Qv(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(s,n){const{active:a,onPending:r}=this.props;r(a,s,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:s}=this,{onStart:n}=this.props;s&&(this.activated=!0,this.documentListeners.add(ua.Click,d6,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(ua.SelectionChange,this.removeTextSelection),n(s))}handleMove(s){var n;const{activated:a,initialCoordinates:r,props:o}=this,{onMove:l,options:{activationConstraint:c}}=o;if(!r)return;const m=(n=Sf(s))!=null?n:Wa,u=cu(r,m);if(!a&&c){if(Qv(c)){if(c.tolerance!=null&&Mh(u,c.tolerance))return this.handleCancel();if(Mh(u,c.distance))return this.handleStart()}if(ey(c)&&Mh(u,c.tolerance))return this.handleCancel();this.handlePending(c,u);return}s.cancelable&&s.preventDefault(),l(m)}handleEnd(){const{onAbort:s,onEnd:n}=this.props;this.detach(),this.activated||s(this.props.active),n()}handleCancel(){const{onAbort:s,onCancel:n}=this.props;this.detach(),this.activated||s(this.props.active),n()}handleKeydown(s){s.code===os.Esc&&this.handleCancel()}removeTextSelection(){var s;(s=this.document.getSelection())==null||s.removeAllRanges()}}const m6={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Jp extends Kp{constructor(s){const{event:n}=s,a=nl(n.target);super(s,m6,a)}}Jp.activators=[{eventName:"onPointerDown",handler:(t,s)=>{let{nativeEvent:n}=t,{onActivation:a}=s;return!n.isPrimary||n.button!==0?!1:(a==null||a({event:n}),!0)}}];const h6={move:{name:"mousemove"},end:{name:"mouseup"}};var Tf;(function(t){t[t.RightClick=2]="RightClick"})(Tf||(Tf={}));class f6 extends Kp{constructor(s){super(s,h6,nl(s.event.target))}}f6.activators=[{eventName:"onMouseDown",handler:(t,s)=>{let{nativeEvent:n}=t,{onActivation:a}=s;return n.button===Tf.RightClick?!1:(a==null||a({event:n}),!0)}}];const Ih={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class p6 extends Kp{constructor(s){super(s,Ih)}static setup(){return window.addEventListener(Ih.move.name,s,{capture:!1,passive:!1}),function(){window.removeEventListener(Ih.move.name,s)};function s(){}}}p6.activators=[{eventName:"onTouchStart",handler:(t,s)=>{let{nativeEvent:n}=t,{onActivation:a}=s;const{touches:r}=n;return r.length>1?!1:(a==null||a({event:n}),!0)}}];var Kl;(function(t){t[t.Pointer=0]="Pointer",t[t.DraggableRect=1]="DraggableRect"})(Kl||(Kl={}));var uu;(function(t){t[t.TreeOrder=0]="TreeOrder",t[t.ReversedTreeOrder=1]="ReversedTreeOrder"})(uu||(uu={}));function x6(t){let{acceleration:s,activator:n=Kl.Pointer,canScroll:a,draggingRect:r,enabled:o,interval:l=5,order:c=uu.TreeOrder,pointerCoordinates:m,scrollableAncestors:u,scrollableAncestorRects:h,delta:p,threshold:g}=t;const x=v6({delta:p,disabled:!o}),[b,j]=Dz(),v=f.useRef({x:0,y:0}),w=f.useRef({x:0,y:0}),N=f.useMemo(()=>{switch(n){case Kl.Pointer:return m?{top:m.y,bottom:m.y,left:m.x,right:m.x}:null;case Kl.DraggableRect:return r}},[n,r,m]),S=f.useRef(null),E=f.useCallback(()=>{const k=S.current;if(!k)return;const D=v.current.x*w.current.x,P=v.current.y*w.current.y;k.scrollBy(D,P)},[]),T=f.useMemo(()=>c===uu.TreeOrder?[...u].reverse():u,[c,u]);f.useEffect(()=>{if(!o||!u.length||!N){j();return}for(const k of T){if((a==null?void 0:a(k))===!1)continue;const D=u.indexOf(k),P=h[D];if(!P)continue;const{direction:_,speed:B}=n6(k,P,N,s,g);for(const I of["x","y"])x[I][_[I]]||(B[I]=0,_[I]=0);if(B.x>0||B.y>0){j(),S.current=k,b(E,l),v.current=B,w.current=_;return}}v.current={x:0,y:0},w.current={x:0,y:0},j()},[s,E,a,j,o,l,JSON.stringify(N),JSON.stringify(x),b,u,T,h,JSON.stringify(g)])}const g6={x:{[tn.Backward]:!1,[tn.Forward]:!1},y:{[tn.Backward]:!1,[tn.Forward]:!1}};function v6(t){let{delta:s,disabled:n}=t;const a=Nf(s);return Ic(r=>{if(n||!a||!r)return g6;const o={x:Math.sign(s.x-a.x),y:Math.sign(s.y-a.y)};return{x:{[tn.Backward]:r.x[tn.Backward]||o.x===-1,[tn.Forward]:r.x[tn.Forward]||o.x===1},y:{[tn.Backward]:r.y[tn.Backward]||o.y===-1,[tn.Forward]:r.y[tn.Forward]||o.y===1}}},[n,s,a])}function y6(t,s){const n=s!=null?t.get(s):void 0,a=n?n.node.current:null;return Ic(r=>{var o;return s==null?null:(o=a??r)!=null?o:null},[a,s])}function b6(t,s){return f.useMemo(()=>t.reduce((n,a)=>{const{sensor:r}=a,o=r.activators.map(l=>({eventName:l.eventName,handler:s(l.handler,a)}));return[...n,...o]},[]),[t,s])}var pc;(function(t){t[t.Always=0]="Always",t[t.BeforeDragging=1]="BeforeDragging",t[t.WhileDragging=2]="WhileDragging"})(pc||(pc={}));var Df;(function(t){t.Optimized="optimized"})(Df||(Df={}));const ty=new Map;function j6(t,s){let{dragging:n,dependencies:a,config:r}=s;const[o,l]=f.useState(null),{frequency:c,measure:m,strategy:u}=r,h=f.useRef(t),p=v(),g=Vp(p),x=f.useCallback(function(w){w===void 0&&(w=[]),!g.current&&l(N=>N===null?w:N.concat(w.filter(S=>!N.includes(S))))},[g]),b=f.useRef(null),j=Ic(w=>{if(p&&!n)return ty;if(!w||w===ty||h.current!==t||o!=null){const N=new Map;for(let S of t){if(!S)continue;if(o&&o.length>0&&!o.includes(S.id)&&S.rect.current){N.set(S.id,S.rect.current);continue}const E=S.node.current,T=E?new Yp(m(E),E):null;S.rect.current=T,T&&N.set(S.id,T)}return N}return w},[t,o,n,p,m]);return f.useEffect(()=>{h.current=t},[t]),f.useEffect(()=>{p||x()},[n,p]),f.useEffect(()=>{o&&o.length>0&&l(null)},[JSON.stringify(o)]),f.useEffect(()=>{p||typeof c!="number"||b.current!==null||(b.current=setTimeout(()=>{x(),b.current=null},c))},[c,p,x,...a]),{droppableRects:j,measureDroppableContainers:x,measuringScheduled:o!=null};function v(){switch(u){case pc.Always:return!1;case pc.BeforeDragging:return n;default:return!n}}}function zS(t,s){return Ic(n=>t?n||(typeof s=="function"?s(t):t):null,[s,t])}function w6(t,s){return zS(t,s)}function N6(t){let{callback:s,disabled:n}=t;const a=Up(s),r=f.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:o}=window;return new o(a)},[a,n]);return f.useEffect(()=>()=>r==null?void 0:r.disconnect(),[r]),r}function Xp(t){let{callback:s,disabled:n}=t;const a=Up(s),r=f.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:o}=window;return new o(a)},[n]);return f.useEffect(()=>()=>r==null?void 0:r.disconnect(),[r]),r}function S6(t){return new Yp(Oc(t),t)}function sy(t,s,n){s===void 0&&(s=S6);const[a,r]=f.useState(null);function o(){r(m=>{if(!t)return null;if(t.isConnected===!1){var u;return(u=m??n)!=null?u:null}const h=s(t);return JSON.stringify(m)===JSON.stringify(h)?m:h})}const l=N6({callback(m){if(t)for(const u of m){const{type:h,target:p}=u;if(h==="childList"&&p instanceof HTMLElement&&p.contains(t)){o();break}}}}),c=Xp({callback:o});return Ci(()=>{o(),t?(c==null||c.observe(t),l==null||l.observe(document.body,{childList:!0,subtree:!0})):(c==null||c.disconnect(),l==null||l.disconnect())},[t]),a}function C6(t){const s=zS(t);return AS(t,s)}const ny=[];function E6(t){const s=f.useRef(t),n=Ic(a=>t?a&&a!==ny&&t&&s.current&&t.parentNode===s.current.parentNode?a:qp(t):ny,[t]);return f.useEffect(()=>{s.current=t},[t]),n}function T6(t){const[s,n]=f.useState(null),a=f.useRef(t),r=f.useCallback(o=>{const l=Ph(o.target);l&&n(c=>c?(c.set(l,Ef(l)),new Map(c)):null)},[]);return f.useEffect(()=>{const o=a.current;if(t!==o){l(o);const c=t.map(m=>{const u=Ph(m);return u?(u.addEventListener("scroll",r,{passive:!0}),[u,Ef(u)]):null}).filter(m=>m!=null);n(c.length?new Map(c):null),a.current=t}return()=>{l(t),l(o)};function l(c){c.forEach(m=>{const u=Ph(m);u==null||u.removeEventListener("scroll",r)})}},[r,t]),f.useMemo(()=>t.length?s?Array.from(s.values()).reduce((o,l)=>Do(o,l),Wa):OS(t):Wa,[t,s])}function ay(t,s){s===void 0&&(s=[]);const n=f.useRef(null);return f.useEffect(()=>{n.current=null},s),f.useEffect(()=>{const a=t!==Wa;a&&!n.current&&(n.current=t),!a&&n.current&&(n.current=null)},[t]),n.current?cu(t,n.current):Wa}function D6(t){f.useEffect(()=>{if(!qu)return;const s=t.map(n=>{let{sensor:a}=n;return a.setup==null?void 0:a.setup()});return()=>{for(const n of s)n==null||n()}},t.map(s=>{let{sensor:n}=s;return n}))}function k6(t,s){return f.useMemo(()=>t.reduce((n,a)=>{let{eventName:r,handler:o}=a;return n[r]=l=>{o(l,s)},n},{}),[t,s])}function FS(t){return f.useMemo(()=>t?Qz(t):null,[t])}const ry=[];function A6(t,s){s===void 0&&(s=Oc);const[n]=t,a=FS(n?Gn(n):null),[r,o]=f.useState(ry);function l(){o(()=>t.length?t.map(m=>MS(m)?a:new Yp(s(m),m)):ry)}const c=Xp({callback:l});return Ci(()=>{c==null||c.disconnect(),l(),t.forEach(m=>c==null?void 0:c.observe(m))},[t]),r}function R6(t){if(!t)return null;if(t.children.length>1)return t;const s=t.children[0];return Mc(s)?s:t}function _6(t){let{measure:s}=t;const[n,a]=f.useState(null),r=f.useCallback(u=>{for(const{target:h}of u)if(Mc(h)){a(p=>{const g=s(h);return p?{...p,width:g.width,height:g.height}:g});break}},[s]),o=Xp({callback:r}),l=f.useCallback(u=>{const h=R6(u);o==null||o.disconnect(),h&&(o==null||o.observe(h)),a(h?s(h):null)},[s,o]),[c,m]=wf(l);return f.useMemo(()=>({nodeRef:c,rect:n,setRef:m}),[n,c,m])}const P6=[{sensor:Jp,options:{}},{sensor:$S,options:{}}],M6={current:{}},Hd={draggable:{measure:Xv},droppable:{measure:Xv,strategy:pc.WhileDragging,frequency:Df.Optimized},dragOverlay:{measure:Oc}};class Jl extends Map{get(s){var n;return s!=null&&(n=super.get(s))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(s=>{let{disabled:n}=s;return!n})}getNodeFor(s){var n,a;return(n=(a=this.get(s))==null?void 0:a.node.current)!=null?n:void 0}}const I6={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Jl,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:du},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Hd,measureDroppableContainers:du,windowRect:null,measuringScheduled:!1},O6={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:du,draggableNodes:new Map,over:null,measureDroppableContainers:du},Zp=f.createContext(O6),L6=f.createContext(I6);function $6(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Jl}}}function z6(t,s){switch(s.type){case xn.DragStart:return{...t,draggable:{...t.draggable,initialCoordinates:s.initialCoordinates,active:s.active}};case xn.DragMove:return t.draggable.active==null?t:{...t,draggable:{...t.draggable,translate:{x:s.coordinates.x-t.draggable.initialCoordinates.x,y:s.coordinates.y-t.draggable.initialCoordinates.y}}};case xn.DragEnd:case xn.DragCancel:return{...t,draggable:{...t.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case xn.RegisterDroppable:{const{element:n}=s,{id:a}=n,r=new Jl(t.droppable.containers);return r.set(a,n),{...t,droppable:{...t.droppable,containers:r}}}case xn.SetDroppableDisabled:{const{id:n,key:a,disabled:r}=s,o=t.droppable.containers.get(n);if(!o||a!==o.key)return t;const l=new Jl(t.droppable.containers);return l.set(n,{...o,disabled:r}),{...t,droppable:{...t.droppable,containers:l}}}case xn.UnregisterDroppable:{const{id:n,key:a}=s,r=t.droppable.containers.get(n);if(!r||a!==r.key)return t;const o=new Jl(t.droppable.containers);return o.delete(n),{...t,droppable:{...t.droppable,containers:o}}}default:return t}}function F6(t){let{disabled:s}=t;const{active:n,activatorEvent:a,draggableNodes:r}=f.useContext(Zp),o=Nf(a),l=Nf(n==null?void 0:n.id);return f.useEffect(()=>{if(!s&&!a&&o&&l!=null){if(!DS(o)||document.activeElement===o.target)return;const c=r.get(l);if(!c)return;const{activatorNode:m,node:u}=c;if(!m.current&&!u.current)return;requestAnimationFrame(()=>{for(const h of[m.current,u.current]){if(!h)continue;const p=Rz(h);if(p){p.focus();break}}})}},[a,s,r,l,o]),null}function B6(t,s){let{transform:n,...a}=s;return t!=null&&t.length?t.reduce((r,o)=>o({transform:r,...a}),n):n}function H6(t){return f.useMemo(()=>({draggable:{...Hd.draggable,...t==null?void 0:t.draggable},droppable:{...Hd.droppable,...t==null?void 0:t.droppable},dragOverlay:{...Hd.dragOverlay,...t==null?void 0:t.dragOverlay}}),[t==null?void 0:t.draggable,t==null?void 0:t.droppable,t==null?void 0:t.dragOverlay])}function W6(t){let{activeNode:s,measure:n,initialRect:a,config:r=!0}=t;const o=f.useRef(!1),{x:l,y:c}=typeof r=="boolean"?{x:r,y:r}:r;Ci(()=>{if(!l&&!c||!s){o.current=!1;return}if(o.current||!a)return;const u=s==null?void 0:s.node.current;if(!u||u.isConnected===!1)return;const h=n(u),p=AS(h,a);if(l||(p.x=0),c||(p.y=0),o.current=!0,Math.abs(p.x)>0||Math.abs(p.y)>0){const g=RS(u);g&&g.scrollBy({top:p.y,left:p.x})}},[s,l,c,a,n])}const BS=f.createContext({...Wa,scaleX:1,scaleY:1});var ui;(function(t){t[t.Uninitialized=0]="Uninitialized",t[t.Initializing=1]="Initializing",t[t.Initialized=2]="Initialized"})(ui||(ui={}));const U6=f.memo(function(s){var n,a,r,o;let{id:l,accessibility:c,autoScroll:m=!0,children:u,sensors:h=P6,collisionDetection:p=Gz,measuring:g,modifiers:x,...b}=s;const j=f.useReducer(z6,void 0,$6),[v,w]=j,[N,S]=Lz(),[E,T]=f.useState(ui.Uninitialized),k=E===ui.Initialized,{draggable:{active:D,nodes:P,translate:_},droppable:{containers:B}}=v,I=D!=null?P.get(D):null,R=f.useRef({initial:null,translated:null}),M=f.useMemo(()=>{var Ue;return D!=null?{id:D,data:(Ue=I==null?void 0:I.data)!=null?Ue:M6,rect:R}:null},[D,I]),W=f.useRef(null),[H,L]=f.useState(null),[$,q]=f.useState(null),re=Vp(b,Object.values(b)),Y=Gp("DndDescribedBy",l),se=f.useMemo(()=>B.getEnabled(),[B]),ie=H6(g),{droppableRects:U,measureDroppableContainers:ee,measuringScheduled:me}=j6(se,{dragging:k,dependencies:[_.x,_.y],config:ie.droppable}),ue=y6(P,D),ae=f.useMemo(()=>$?Sf($):null,[$]),ge=Ft(),je=w6(ue,ie.draggable.measure);W6({activeNode:D!=null?P.get(D):null,config:ge.layoutShiftCompensation,initialRect:je,measure:ie.draggable.measure});const we=sy(ue,ie.draggable.measure,je),ke=sy(ue?ue.parentElement:null),de=f.useRef({activatorEvent:null,active:null,activeNode:ue,collisionRect:null,collisions:null,droppableRects:U,draggableNodes:P,draggingNode:null,draggingNodeRect:null,droppableContainers:B,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),J=B.getNodeFor((n=de.current.over)==null?void 0:n.id),ve=_6({measure:ie.dragOverlay.measure}),ft=(a=ve.nodeRef.current)!=null?a:ue,pt=k?(r=ve.rect)!=null?r:we:null,ot=!!(ve.nodeRef.current&&ve.rect),zs=C6(ot?null:we),gs=FS(ft?Gn(ft):null),G=E6(k?J??ue:null),te=A6(G),le=B6(x,{transform:{x:_.x-zs.x,y:_.y-zs.y,scaleX:1,scaleY:1},activatorEvent:$,active:M,activeNodeRect:we,containerNodeRect:ke,draggingNodeRect:pt,over:de.current.over,overlayNodeRect:ve.rect,scrollableAncestors:G,scrollableAncestorRects:te,windowRect:gs}),Ce=ae?Do(ae,_):null,Se=T6(G),be=ay(Se),Re=ay(Se,[we]),Ve=Do(le,be),Qe=pt?Kz(pt,le):null,Yt=M&&Qe?p({active:M,collisionRect:Qe,droppableRects:U,droppableContainers:se,pointerCoordinates:Ce}):null,Cs=Uz(Yt,"id"),[Ut,Us]=f.useState(null),Fs=ot?le:Do(le,Re),ss=qz(Fs,(o=Ut==null?void 0:Ut.rect)!=null?o:null,we),Rs=f.useRef(null),Es=f.useCallback((Ue,ut)=>{let{sensor:Mt,options:Ae}=ut;if(W.current==null)return;const Oe=P.get(W.current);if(!Oe)return;const Ye=Ue.nativeEvent,Et=new Mt({active:W.current,activeNode:Oe,event:Ye,options:Ae,context:de,onAbort(Tt){if(!P.get(Tt))return;const{onDragAbort:us}=re.current,Bt={id:Tt};us==null||us(Bt),N({type:"onDragAbort",event:Bt})},onPending(Tt,ds,us,Bt){if(!P.get(Tt))return;const{onDragPending:Ka}=re.current,qn={id:Tt,constraint:ds,initialCoordinates:us,offset:Bt};Ka==null||Ka(qn),N({type:"onDragPending",event:qn})},onStart(Tt){const ds=W.current;if(ds==null)return;const us=P.get(ds);if(!us)return;const{onDragStart:Bt}=re.current,In={activatorEvent:Ye,active:{id:ds,data:us.data,rect:R}};xi.unstable_batchedUpdates(()=>{Bt==null||Bt(In),T(ui.Initializing),w({type:xn.DragStart,initialCoordinates:Tt,active:ds}),N({type:"onDragStart",event:In}),L(Rs.current),q(Ye)})},onMove(Tt){w({type:xn.DragMove,coordinates:Tt})},onEnd:It(xn.DragEnd),onCancel:It(xn.DragCancel)});Rs.current=Et;function It(Tt){return async function(){const{active:us,collisions:Bt,over:In,scrollAdjustedTranslate:Ka}=de.current;let qn=null;if(us&&Ka){const{cancelDrop:ja}=re.current;qn={activatorEvent:Ye,active:us,collisions:Bt,delta:Ka,over:In},Tt===xn.DragEnd&&typeof ja=="function"&&await Promise.resolve(ja(qn))&&(Tt=xn.DragCancel)}W.current=null,xi.unstable_batchedUpdates(()=>{w({type:Tt}),T(ui.Uninitialized),Us(null),L(null),q(null),Rs.current=null;const ja=Tt===xn.DragEnd?"onDragEnd":"onDragCancel";if(qn){const Vr=re.current[ja];Vr==null||Vr(qn),N({type:ja,event:qn})}})}}},[P]),Nn=f.useCallback((Ue,ut)=>(Mt,Ae)=>{const Oe=Mt.nativeEvent,Ye=P.get(Ae);if(W.current!==null||!Ye||Oe.dndKit||Oe.defaultPrevented)return;const Et={active:Ye};Ue(Mt,ut.options,Et)===!0&&(Oe.dndKit={capturedBy:ut.sensor},W.current=Ae,Es(Mt,ut))},[P,Es]),We=b6(h,Nn);D6(h),Ci(()=>{we&&E===ui.Initializing&&T(ui.Initialized)},[we,E]),f.useEffect(()=>{const{onDragMove:Ue}=re.current,{active:ut,activatorEvent:Mt,collisions:Ae,over:Oe}=de.current;if(!ut||!Mt)return;const Ye={active:ut,activatorEvent:Mt,collisions:Ae,delta:{x:Ve.x,y:Ve.y},over:Oe};xi.unstable_batchedUpdates(()=>{Ue==null||Ue(Ye),N({type:"onDragMove",event:Ye})})},[Ve.x,Ve.y]),f.useEffect(()=>{const{active:Ue,activatorEvent:ut,collisions:Mt,droppableContainers:Ae,scrollAdjustedTranslate:Oe}=de.current;if(!Ue||W.current==null||!ut||!Oe)return;const{onDragOver:Ye}=re.current,Et=Ae.get(Cs),It=Et&&Et.rect.current?{id:Et.id,rect:Et.rect.current,data:Et.data,disabled:Et.disabled}:null,Tt={active:Ue,activatorEvent:ut,collisions:Mt,delta:{x:Oe.x,y:Oe.y},over:It};xi.unstable_batchedUpdates(()=>{Us(It),Ye==null||Ye(Tt),N({type:"onDragOver",event:Tt})})},[Cs]),Ci(()=>{de.current={activatorEvent:$,active:M,activeNode:ue,collisionRect:Qe,collisions:Yt,droppableRects:U,draggableNodes:P,draggingNode:ft,draggingNodeRect:pt,droppableContainers:B,over:Ut,scrollableAncestors:G,scrollAdjustedTranslate:Ve},R.current={initial:pt,translated:Qe}},[M,ue,Yt,Qe,P,ft,pt,U,B,Ut,G,Ve]),x6({...ge,delta:_,draggingRect:Qe,pointerCoordinates:Ce,scrollableAncestors:G,scrollableAncestorRects:te});const lt=f.useMemo(()=>({active:M,activeNode:ue,activeNodeRect:we,activatorEvent:$,collisions:Yt,containerNodeRect:ke,dragOverlay:ve,draggableNodes:P,droppableContainers:B,droppableRects:U,over:Ut,measureDroppableContainers:ee,scrollableAncestors:G,scrollableAncestorRects:te,measuringConfiguration:ie,measuringScheduled:me,windowRect:gs}),[M,ue,we,$,Yt,ke,ve,P,B,U,Ut,ee,G,te,ie,me,gs]),yt=f.useMemo(()=>({activatorEvent:$,activators:We,active:M,activeNodeRect:we,ariaDescribedById:{draggable:Y},dispatch:w,draggableNodes:P,over:Ut,measureDroppableContainers:ee}),[$,We,M,we,w,Y,P,Ut,ee]);return Z.createElement(kS.Provider,{value:S},Z.createElement(Zp.Provider,{value:yt},Z.createElement(L6.Provider,{value:lt},Z.createElement(BS.Provider,{value:ss},u)),Z.createElement(F6,{disabled:(c==null?void 0:c.restoreFocus)===!1})),Z.createElement(Fz,{...c,hiddenTextDescribedById:Y}));function Ft(){const Ue=(H==null?void 0:H.autoScrollEnabled)===!1,ut=typeof m=="object"?m.enabled===!1:m===!1,Mt=k&&!Ue&&!ut;return typeof m=="object"?{...m,enabled:Mt}:{enabled:Mt}}}),V6=f.createContext(null),iy="button",G6="Draggable";function q6(t){let{id:s,data:n,disabled:a=!1,attributes:r}=t;const o=Gp(G6),{activators:l,activatorEvent:c,active:m,activeNodeRect:u,ariaDescribedById:h,draggableNodes:p,over:g}=f.useContext(Zp),{role:x=iy,roleDescription:b="draggable",tabIndex:j=0}=r??{},v=(m==null?void 0:m.id)===s,w=f.useContext(v?BS:V6),[N,S]=wf(),[E,T]=wf(),k=k6(l,s),D=Vp(n);Ci(()=>(p.set(s,{id:s,key:o,node:N,activatorNode:E,data:D}),()=>{const _=p.get(s);_&&_.key===o&&p.delete(s)}),[p,s]);const P=f.useMemo(()=>({role:x,tabIndex:j,"aria-disabled":a,"aria-pressed":v&&x===iy?!0:void 0,"aria-roledescription":b,"aria-describedby":h.draggable}),[a,x,j,v,b,h.draggable]);return{active:m,activatorEvent:c,activeNodeRect:u,attributes:P,isDragging:v,listeners:a?void 0:k,node:N,over:g,setNodeRef:S,setActivatorNodeRef:T,transform:w}}const Y6=({task:t,onDelete:s,onEdit:n,onQuickUpdate:a,style:r,className:o,isDraggable:l=!0})=>{const[c,m]=f.useState(!1),{attributes:u,listeners:h,setNodeRef:p,transform:g,isDragging:x}=q6({id:`task-${t.id}`,data:{task:t,type:"task-move"},disabled:!l||c}),b=no[t.category]||no.personal,j=()=>({"text-red-700":"#b91c1c","text-blue-700":"#1d4ed8","text-green-700":"#15803d","text-purple-700":"#7e22ce","text-orange-700":"#c2410c","text-pink-700":"#be185d"})[b.text]||"#7e22ce",v=_=>{_.stopPropagation(),m(!1),n(t)},w=_=>{_.stopPropagation(),m(!1),s(t.id)},N=t.startDate?at(t.startDate,"HH:mm"):"",S=t.endDate?at(t.endDate,"HH:mm"):"",E=f.useMemo(()=>{if(!t.startDate||!t.endDate)return null;const _=t.endDate.getTime()-t.startDate.getTime(),B=Math.floor(_/6e4);if(B<60)return{minutes:B,label:`${B} min`};{const I=Math.floor(B/60),R=B%60;return{minutes:B,label:R>0?`${I}h ${R}min`:`${I}h`}}},[t.startDate,t.endDate]),T=_=>{if(!t.endDate||!t.startDate)return;const B=new Date(t.endDate);B.setMinutes(B.getMinutes()+_),!(B.getTime()-t.startDate.getTime()<15*6e4)&&(B.getHours()>22||B.getHours()===22&&B.getMinutes()>0||(m(!1),a?a({...t,endDate:B}):n({...t,endDate:B})))},k=f.useMemo(()=>E?{by30:E.minutes>=45,by60:E.minutes>=75}:{by30:!1,by60:!1},[E]),D=f.useMemo(()=>{if(!t.endDate)return{by30:!1,by60:!1,by120:!1};const _=B=>{const I=new Date(t.endDate);return I.setMinutes(I.getMinutes()+B),I.getHours()<22||I.getHours()===22&&I.getMinutes()===0};return{by30:_(30),by60:_(60),by120:_(120)}},[t.endDate]),P=g?{transform:Cf.Transform.toString(g),zIndex:1e3}:{};return e.jsxs(xS,{open:c,onOpenChange:m,children:[e.jsx(gS,{asChild:!0,children:e.jsxs("div",{className:ce("cursor-pointer overflow-hidden rounded text-white text-xs relative","hover:opacity-90 transition-opacity","flex",x&&"opacity-50 shadow-lg",o),style:{...r,...P,backgroundColor:j(),minHeight:"48px"},children:[l&&e.jsx("div",{ref:p,...u,...h,className:"w-6 flex-shrink-0 bg-black/10 hover:bg-black/20 flex items-center justify-center cursor-move border-r border-white/20 transition-colors",title:"Arrastrar para mover tarea",children:e.jsx(SR,{className:"w-4 h-4 opacity-75"})}),e.jsxs("div",{className:"flex-1 p-1 flex flex-col min-w-0",children:[e.jsx("div",{className:"font-semibold leading-tight truncate",children:t.title}),e.jsxs("div",{className:"text-[10px] opacity-90 leading-tight mt-0.5",children:[N,S&&` - ${S}`]}),t.isPrivate&&e.jsx("div",{className:"text-[10px] opacity-75",children:"🔒"})]})]})}),e.jsx($p,{className:"w-80 p-3",align:"start",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("h4",{className:"font-semibold text-sm flex-1",children:t.title}),t.isPrivate&&e.jsx("span",{className:"text-sm",children:"🔒"})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["#",t.taskCode]})]}),e.jsxs("div",{className:"space-y-2 text-xs",children:[t.startDate&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Js,{className:"w-3 h-3 text-muted-foreground"}),e.jsxs("span",{children:[at(t.startDate,"dd/MM/yyyy")," - ",N,S&&` a ${S}`]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded",style:{backgroundColor:j()}}),e.jsx("span",{children:Un[t.category]})]})]}),E&&e.jsxs("div",{className:"space-y-2 p-2 bg-muted/50 rounded-md",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs font-medium",children:[e.jsx(Ji,{className:"w-3 h-3"}),e.jsxs("span",{children:["Duración: ",E.label]})]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsx(z,{variant:"outline",size:"sm",className:"h-7 text-xs px-2",onClick:()=>T(-60),disabled:!k.by60,title:k.by60?"Reducir 1 hora":"Duración mínima: 15 min",children:"-1h"}),e.jsx(z,{variant:"outline",size:"sm",className:"h-7 text-xs px-2",onClick:()=>T(-30),disabled:!k.by30,title:k.by30?"Reducir 30 minutos":"Duración mínima: 15 min",children:"-30"}),e.jsx(z,{variant:"outline",size:"sm",className:"h-7 text-xs px-2",onClick:()=>T(30),disabled:!D.by30,title:D.by30?"Aumentar 30 minutos":"Límite: 22:00",children:"+30"}),e.jsx(z,{variant:"outline",size:"sm",className:"h-7 text-xs px-2",onClick:()=>T(60),disabled:!D.by60,title:D.by60?"Aumentar 1 hora":"Límite: 22:00",children:"+1h"}),e.jsx(z,{variant:"outline",size:"sm",className:"h-7 text-xs px-2",onClick:()=>T(120),disabled:!D.by120,title:D.by120?"Aumentar 2 horas":"Límite: 22:00",children:"+2h"})]})]}),t.description&&e.jsxs("div",{className:"text-xs text-muted-foreground max-h-20 overflow-y-auto",children:[t.description.slice(0,200),t.description.length>200&&"..."]}),e.jsxs("div",{className:"flex gap-2 pt-2 border-t",children:[e.jsxs(z,{variant:"outline",size:"sm",className:"flex-1 h-8 text-xs",onClick:v,children:[e.jsx(sa,{className:"w-3 h-3 mr-1"}),"Editar"]}),e.jsx(z,{variant:"destructive",size:"sm",className:"h-8 text-xs",onClick:w,children:e.jsx(Ws,{className:"w-3 h-3"})})]})]})})]})},K6=()=>{const t=[];for(let s=6;s<=22;s++)t.push({hour:s,minute:0,label:`${s.toString().padStart(2,"0")}:00`}),s<22&&t.push({hour:s,minute:30,label:`${s.toString().padStart(2,"0")}:30`});return t},J6=({tasks:t,onDelete:s,onEdit:n,onQuickUpdate:a,onView:r,onMove:o})=>{const l=new Date,c=f.useMemo(()=>K6(),[]),m=f.useRef(null),u=Hz(Bz(Jp,{activationConstraint:{distance:5}}));f.useEffect(()=>{if(!m.current)return;const S=new Date,E=S.getHours(),k=S.getMinutes()<30?`${E.toString().padStart(2,"0")}:00`:`${E.toString().padStart(2,"0")}:30`,D=m.current.querySelector(`[data-time="${k}"]`);D&&setTimeout(()=>{D.scrollIntoView({behavior:"smooth",block:"center"})},300)},[]);const{tasksWithTime:h,tasksWithoutTime:p}=f.useMemo(()=>{const S=[],E=[];return t.forEach(T=>{if(!T.startDate||!sn(T.startDate,l))return;const k=T.startDate.getHours(),D=T.startDate.getMinutes();if(k!==12||D!==0)S.push(T);else if(T.endDate){const P=T.endDate.getHours(),_=T.endDate.getMinutes();P!==12||_!==0?S.push(T):E.push(T)}else E.push(T)}),{tasksWithTime:S,tasksWithoutTime:E}},[t,l]),g=S=>{const E=S.getHours(),T=S.getMinutes();return((E-6)*60+T)/30*50},x=(S,E)=>{if(!E)return 50;const T=(E.getTime()-S.getTime())/6e4;return Math.max(50,T/30*50)},b=f.useMemo(()=>{if(h.length===0)return[];const E=[...h].sort((k,D)=>{const P=k.startDate.getTime()-D.startDate.getTime();if(P!==0)return P;const _=k.endDate?k.endDate.getTime()-k.startDate.getTime():0;return(D.endDate?D.endDate.getTime()-D.startDate.getTime():0)-_}).map(k=>({...k,top:g(k.startDate),height:x(k.startDate,k.endDate),columnIndex:0,totalColumns:1})),T=[];for(const k of E){const D=k.top,P=k.top+k.height;let _=-1;for(let B=0;B<T.length;B++)if(T[B]<=D){_=B;break}_===-1&&(_=T.length,T.push(0)),k.columnIndex=_,k.totalColumns=1,T[_]=P}for(let k=0;k<E.length;k++){const D=E[k],P=D.top+D.height;let _=D.columnIndex+1;for(let B=0;B<E.length;B++){if(k===B)continue;const I=E[B],R=I.top,M=I.top+I.height;R<P&&M>D.top&&(_=Math.max(_,I.columnIndex+1))}D.totalColumns=_}return E},[h]),j=h.length+p.length,v=()=>{},w=S=>{},N=S=>{var M;const{active:E,delta:T}=S;if(!((M=E.data.current)!=null&&M.task)||!o)return;const k=E.data.current.task;if(!k.startDate)return;const D=g(k.startDate),P=Math.max(0,D+T.y),_=LM(P,k.startDate),B=$M(_,15),I=B.getHours();if(I<6||I>=22)return;const R=mc(k.startDate,k.endDate,B);R&&R.getHours()>22||o(k.id,B)};return j===0?null:e.jsx(U6,{sensors:u,onDragStart:v,onDragMove:w,onDragEnd:N,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"sticky top-0 bg-white py-2 z-10",children:e.jsxs("h3",{className:"text-sm font-semibold text-blue-600 flex items-center gap-2",children:[e.jsx("span",{children:"📅"}),"Hoy - ",at(l,"dd/MM/yyyy")," (",j," tareas)"]})}),h.length>0&&e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 px-3 py-2 border-b",children:e.jsx("h4",{className:"text-xs font-semibold text-gray-700",children:"Franjas Horarias (06:00 - 22:00)"})}),e.jsxs("div",{ref:m,className:"max-h-[600px] overflow-y-auto relative",id:"today-time-grid",children:[e.jsx("div",{className:"divide-y",children:c.map(S=>{const E=S.minute===0,T=new Date,k=T.getHours()===S.hour&&(T.getMinutes()<30?S.minute===0:S.minute===30);return e.jsxs("div",{className:ce("flex h-[50px] relative bg-gray-50/50",E&&"border-t-2 border-gray-300"),"data-time":S.label,children:[k&&e.jsx("div",{className:"absolute inset-x-0 top-0 h-0.5 bg-red-500 z-30",children:e.jsx("div",{className:"absolute left-0 top-0 w-2 h-2 bg-red-500 rounded-full -mt-[3px]"})}),e.jsx("div",{className:ce("w-16 flex-shrink-0 px-2 py-1 border-r bg-gray-50 flex items-center",!E&&"text-gray-400"),children:e.jsx("span",{className:ce("text-[11px] font-medium",E?"text-gray-700":"text-gray-400"),children:S.label})}),e.jsx("div",{className:"flex-1"})]},`${S.hour}-${S.minute}`)})}),e.jsx("div",{className:"absolute top-0 left-16 right-0 pointer-events-none",style:{height:`${c.length*50}px`},children:b.map(S=>{const E=100/S.totalColumns,T=S.columnIndex/S.totalColumns*100;return e.jsx(Y6,{task:S,onDelete:s,onEdit:n,onQuickUpdate:a,className:"pointer-events-auto",style:{position:"absolute",top:`${S.top}px`,height:`${S.height-2}px`,left:`${T}%`,width:`calc(${E}% - 4px)`,marginLeft:"2px"}},S.id)})})]})]}),p.length>0&&e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-amber-50 px-3 py-2 border-b border-amber-200",children:e.jsxs("h4",{className:"text-xs font-semibold text-amber-800 flex items-center gap-1",children:[e.jsx("span",{children:"⏰"}),"Sin Hora Asignada (",p.length,")"]})}),e.jsx("div",{className:"p-2 space-y-2 bg-white",children:p.map(S=>e.jsx(Pc,{task:S,onDelete:s,onEdit:n,onView:r,onMove:o,showCategoryLabel:!0},S.id))})]})]})})},X6=({tasks:t,onDelete:s,onEdit:n,onView:a,onMove:r})=>{const o=new Date,l=cs(o),c=f.useMemo(()=>{const g={};return t.forEach(x=>{if(!x.startDate||!Gd(cs(x.startDate),l)||sn(x.startDate,o))return;const b=at(x.startDate,"yyyy-MM-dd");g[b]||(g[b]=[]),g[b].push(x)}),Object.keys(g).forEach(x=>{g[x].sort((b,j)=>{if(b.startDate&&j.startDate){const v=b.startDate.getHours()!==12||b.startDate.getMinutes()!==0,w=j.startDate.getHours()!==12||j.startDate.getMinutes()!==0;if(v&&w)return b.startDate.getTime()-j.startDate.getTime();if(v)return-1;if(w)return 1}return 0})}),g},[t,o,l]),m=f.useMemo(()=>Object.keys(c).sort((g,x)=>g.localeCompare(x)),[c]),u=m.reduce((g,x)=>g+c[x].length,0);if(u===0)return null;const h=g=>{if(!g.startDate)return!1;const x=g.startDate.getHours(),b=g.startDate.getMinutes();return x!==12||b!==0},p=g=>{if(!g.startDate||!h(g))return"";const x=at(g.startDate,"HH:mm");if(g.endDate){const b=at(g.endDate,"HH:mm");return`${x} - ${b}`}return x};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"sticky top-0 bg-white py-2 z-10",children:e.jsxs("h3",{className:"text-sm font-semibold text-green-600 flex items-center gap-2",children:[e.jsx("span",{children:"📆"}),"Tareas Futuras (",u,")"]})}),e.jsx("div",{className:"space-y-6",children:m.map(g=>{const x=c[g],b=new Date(g+"T12:00:00");return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 pb-1 border-b",children:[e.jsx(ns,{className:"w-4 h-4 text-gray-500"}),e.jsx("h4",{className:"text-sm font-semibold text-gray-700",children:at(b,"EEEE, d 'de' MMMM",{locale:kn})}),e.jsxs(Ht,{variant:"outline",className:"text-xs",children:[x.length," ",x.length===1?"tarea":"tareas"]})]}),e.jsx("div",{className:"space-y-2 pl-2",children:x.map(j=>{const v=p(j);return e.jsxs("div",{className:"space-y-1",children:[v&&e.jsxs(Ht,{variant:"secondary",className:"text-xs bg-blue-50 text-blue-700 border-blue-200",children:[e.jsx(Js,{className:"w-3 h-3 mr-1"}),v]}),e.jsx(Pc,{task:j,onDelete:s,onEdit:n,onView:a,onMove:r,showCategoryLabel:!0})]},j.id)})})]},g)})})]})},Z6=({tasks:t,onDelete:s,onEdit:n,onView:a,onMove:r})=>{const o=f.useMemo(()=>t.filter(l=>!l.startDate&&!l.completed).sort((l,c)=>{var p,g;const m={do:1,decide:2,delegate:3,delete:4},u=m[l.priority]||5,h=m[c.priority]||5;return u!==h?u-h:(((p=c.createdAt)==null?void 0:p.seconds)||0)-(((g=l.createdAt)==null?void 0:g.seconds)||0)}),[t]);return o.length===0?null:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"sticky top-0 bg-white py-2 z-10",children:e.jsxs("h3",{className:"text-sm font-semibold text-gray-600 flex items-center gap-2",children:[e.jsx("span",{children:"📋"}),"Sin Fecha (",o.length,")"]})}),e.jsx("div",{className:"space-y-2",children:o.map(l=>e.jsx(Pc,{task:l,onDelete:s,onEdit:n,onView:a,onMove:r,showCategoryLabel:!0},l.id))})]})},Q6=({tasks:t,onDelete:s,onEdit:n,onQuickUpdate:a,onView:r,onMove:o,searchQuery:l,onSearchChange:c})=>{const[m,u]=f.useState(""),h=l!==void 0?l:m,p=c||u,g=f.useMemo(()=>{if(!h.trim())return t;const b=h.toLowerCase().trim();return t.filter(j=>j.title.toLowerCase().includes(b)||j.description&&j.description.toLowerCase().includes(b))},[t,h]),x=f.useMemo(()=>{const b=new Date,j=new Date(b.getFullYear(),b.getMonth(),b.getDate());let v=0,w=0,N=0,S=0;return g.forEach(E=>{if(!E.startDate){S++;return}const T=new Date(E.startDate),k=new Date(T.getFullYear(),T.getMonth(),T.getDate());k<j?v++:k.getTime()===j.getTime()?w++:N++}),{overdue:v,todayCount:w,future:N,noDate:S}},[g]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"sticky top-0 bg-white z-20 pb-4",children:[e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(Vo,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(Be,{placeholder:"Buscar tareas por nombre o descripción...",value:h,onChange:b=>p(b.target.value),className:"pl-10 pr-10"}),h&&e.jsx(z,{variant:"ghost",size:"sm",onClick:()=>p(""),className:"absolute right-1 top-1/2 transform -translate-y-1/2 h-6 w-6 p-0 hover:bg-gray-100",children:e.jsx(Ws,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-3 text-xs",children:[x.overdue>0&&e.jsxs("div",{className:"flex items-center gap-1 text-red-600",children:[e.jsx("span",{className:"font-semibold",children:x.overdue})," vencidas"]}),x.todayCount>0&&e.jsxs("div",{className:"flex items-center gap-1 text-blue-600",children:[e.jsx("span",{className:"font-semibold",children:x.todayCount})," hoy"]}),x.future>0&&e.jsxs("div",{className:"flex items-center gap-1 text-green-600",children:[e.jsx("span",{className:"font-semibold",children:x.future})," futuras"]}),x.noDate>0&&e.jsxs("div",{className:"flex items-center gap-1 text-gray-500",children:[e.jsx("span",{className:"font-semibold",children:x.noDate})," sin fecha"]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 min-w-fit",children:[e.jsx("div",{className:"flex-1 md:min-w-[300px] lg:min-w-[350px]",children:e.jsxs("div",{className:"border rounded-lg p-4 bg-red-50/50 h-full",children:[e.jsx(Tz,{tasks:g,onDelete:s,onEdit:n,onView:r,onMove:o}),x.overdue===0&&e.jsx("div",{className:"text-center py-8 text-gray-400 text-sm",children:"No hay tareas vencidas"})]})}),e.jsx("div",{className:"flex-1 md:min-w-[400px] lg:min-w-[500px]",children:e.jsxs("div",{className:"border rounded-lg p-4 bg-blue-50/50 h-full",children:[e.jsx(J6,{tasks:g,onDelete:s,onEdit:n,onQuickUpdate:a,onView:r,onMove:o}),x.todayCount===0&&e.jsx("div",{className:"text-center py-8 text-gray-400 text-sm",children:"No hay tareas para hoy"})]})}),e.jsx("div",{className:"flex-1 md:min-w-[300px] lg:min-w-[350px]",children:e.jsxs("div",{className:"border rounded-lg p-4 bg-green-50/50 h-full",children:[e.jsx(X6,{tasks:g,onDelete:s,onEdit:n,onView:r,onMove:o}),x.future===0&&e.jsx("div",{className:"text-center py-8 text-gray-400 text-sm",children:"No hay tareas futuras"})]})}),x.noDate>0&&e.jsx("div",{className:"flex-1 md:min-w-[300px] lg:min-w-[350px]",children:e.jsx("div",{className:"border rounded-lg p-4 bg-gray-50/50 h-full",children:e.jsx(Z6,{tasks:g,onDelete:s,onEdit:n,onView:r,onMove:o})})})]})}),g.length===0&&e.jsx("div",{className:"text-center py-12 text-gray-500",children:e.jsx("p",{className:"text-sm",children:h?`No se encontraron tareas con "${h}"`:"No hay tareas para mostrar"})})]})},eF=()=>{const{tasks:t,status:s,error:n,showRecurrenceModal:a,currentTask:r,modalMode:o,addTask:l,editTask:c,toggleTask:m,deleteTask:u,completeRecurrentTask:h,setShowRecurrenceModal:p,openEditModal:g,openCreateModal:x,resync:b}=oo(),{isOnline:j}=Va(),[v,w]=f.useState(null),[N,S]=f.useState(!1);return Fp({openCreateModal:x,isModalOpen:a||N}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs(Ne,{className:"w-full",children:[e.jsxs(De,{className:"pt-6 overflow-x-auto",children:[e.jsx(xz,{tasks:t,onDelete:u,onEdit:g,onView:E=>{w(E),S(!0)},onMove:(E,T)=>c(E,{startDate:T??void 0}),onAdd:E=>x(E??void 0),onFilteredTasksChange:()=>{}}),n&&e.jsx("p",{className:"text-sm text-red-500 mt-4",children:n})]}),e.jsxs(bn,{className:"justify-center gap-2 text-xs p-2",children:[s==="saving"&&e.jsx("span",{className:"text-blue-500",children:"Guardando..."}),s==="pending"&&e.jsx("span",{className:"text-yellow-600",children:"Pendiente de sincronizar"}),s==="saved"&&e.jsx("span",{className:"text-green-600",children:"Sincronizado"}),s==="error"&&e.jsx("span",{className:"text-red-600",children:"Error de sincronización"}),!j&&e.jsx("span",{className:"text-orange-600",children:"Offline"}),e.jsx(z,{onClick:b,variant:"link",className:"p-0 h-auto",children:"Reintentar"})]})]}),e.jsx(tl,{isOpen:a,onClose:()=>p(),onConfirm:E=>{o==="complete"?h(E):o==="edit"?c(r.id,E):l(E)},task:r||{id:"",taskCode:0,title:"",completed:!1,category:"personal",createdAt:{seconds:Date.now()/1e3}},mode:o}),e.jsx(Vu,{task:v,isOpen:N,onClose:()=>S(!1),onEdit:E=>{S(!1),g(E)},onToggle:m}),e.jsx(vz,{})]})},tF=({showFloatingButton:t=!1})=>{const{user:s}=qe(),n=oo(),{tasks:a,status:r,error:o,showRecurrenceModal:l,currentTask:c,modalMode:m,addTask:u,editTask:h,toggleTask:p,deleteTask:g,completeRecurrentTask:x,setShowRecurrenceModal:b,openEditModal:j,openCreateModal:v,resync:w,clearCacheAndReload:N}=n,{isOnline:S}=Va(),[E,T]=f.useState(null),[k,D]=f.useState(!1);return Fp({openCreateModal:v,isModalOpen:l||k}),s?e.jsxs("div",{className:"space-y-8 relative",children:[e.jsxs(Ne,{children:[e.jsx(De,{className:"pt-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(dz,{tasks:a,onDelete:g,onEdit:j,onView:P=>{T(P),D(!0)},onMove:(P,_)=>{const B=a.find(R=>R.id===P);if(!B)return;if(!_){h(P,{startDate:void 0,endDate:void 0});return}const I=mc(B.startDate,B.endDate,_);h(P,{startDate:_,endDate:I})},onAssignTimeOfDay:(P,_)=>h(P,{timeOfDay:_}),status:r,error:o}),o&&e.jsx(Bp,{error:o,onRetry:w,showClearCache:!0})]})}),e.jsxs(bn,{className:"gap-2 text-xs p-2 border-t",children:[r==="saving"&&e.jsx("span",{className:"text-blue-500",children:"Guardando..."}),r==="pending"&&e.jsx("span",{className:"text-yellow-600",children:"Pendiente de sincronizar"}),r==="saved"&&e.jsx("span",{className:"text-green-600",children:"Sincronizado"}),r==="error"&&e.jsx("span",{className:"text-red-600",children:"Error de sincronización"}),!S&&e.jsx("span",{className:"text-orange-600",children:"Offline"}),e.jsx(z,{onClick:w,variant:"link",className:"p-0 h-auto",children:"Reintentar"}),(r==="error"||!S)&&e.jsx(z,{onClick:N,variant:"link",className:"p-0 h-auto text-red-600",children:"Limpiar Cache"})]})]}),t&&e.jsx("div",{className:"md:hidden fixed bottom-20 right-4 z-50",children:e.jsx(z,{onClick:()=>v(),size:"lg",className:"w-14 h-14 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 bg-blue-600 hover:bg-blue-700 active:scale-95 border-0 flex items-center justify-center text-white",children:e.jsx(as,{className:"w-6 h-6 text-white"})})}),e.jsx(tl,{isOpen:l,onClose:()=>b(),onConfirm:P=>{m==="complete"?x(P):m==="edit"?h(c.id,P):u(P)},task:c||{id:"",taskCode:0,title:"",completed:!1,category:"personal",createdAt:{seconds:Date.now()/1e3}},mode:m}),e.jsx(Vu,{task:E,isOpen:k,onClose:()=>D(!1),onEdit:P=>{D(!1),j(P)},onToggle:p})]}):e.jsxs(Ne,{children:[e.jsx(De,{className:"p-8 text-center",children:e.jsx("p",{children:"Inicia sesión para gestionar tus tareas"})}),e.jsxs(bn,{className:"gap-2 text-xs p-2",children:[r==="saving"&&e.jsx("span",{className:"text-blue-500",children:"Guardando..."}),r==="pending"&&e.jsx("span",{className:"text-yellow-600",children:"Pendiente de sincronizar"}),r==="saved"&&e.jsx("span",{className:"text-green-600",children:"Sincronizado"}),r==="error"&&e.jsx("span",{className:"text-red-600",children:"Error de sincronización"}),!S&&e.jsx("span",{className:"text-orange-600",children:"Offline"}),e.jsx(z,{onClick:w,variant:"link",className:"p-0 h-auto",children:"Reintentar"})]})]})},mi=va("journal"),sF=mi?`https://generativelanguage.googleapis.com/v1beta/models/${mi.model}:generateContent`:"",nF=({entry:t,open:s,onOpenChange:n,onInsert:a,onReplace:r})=>{const[o,l]=f.useState(!1),c=s!==void 0?s:o,m=n??l,[u,h]=f.useState(""),[p,g]=f.useState(!1),[x,b]=f.useState(""),[j,v]=f.useState(0),w="AIzaSyAW4Ot-z7OH4ZR3OeaN7vcbkEDlWpo1aMY",N=(mi==null?void 0:mi.prompt)??"Reescribe el siguiente texto del diario de forma clara y natural:",S=mi==null?void 0:mi.params;f.useEffect(()=>{c&&b(`${N}
${t}`)},[c,t]),f.useEffect(()=>{v(ba(x))},[x]);const E=async()=>{var k,D,P,_,B;if(t){g(!0);try{const R=await(await fetch(`${sF}?key=${w}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:x}]}],...S})})).json(),M=(B=(_=(P=(D=(k=R==null?void 0:R.candidates)==null?void 0:k[0])==null?void 0:D.content)==null?void 0:P.parts)==null?void 0:_[0])==null?void 0:B.text;h(M||"No se pudo obtener respuesta")}catch{h("Error al consultar la API")}finally{g(!1)}}},T=()=>{m(!1),h(""),b(""),v(0)};return e.jsxs(Rt,{open:c,onOpenChange:k=>k?m(!0):T(),children:[s===void 0&&e.jsxs(z,{size:"sm",variant:"outline",onClick:()=>m(!0),className:"flex items-center gap-2",children:[e.jsx($s,{className:"w-4 h-4"}),"Mejorar entrada"]}),e.jsxs(Ct,{className:"w-[95vw] h-[90vh] max-w-none max-h-none overflow-hidden flex flex-col sm:w-[90vw] sm:h-[85vh]",children:[e.jsxs(_t,{className:"flex-shrink-0",children:[e.jsx(Pt,{className:"text-xl",children:"Reescribir Diario con IA"}),e.jsx(rn,{children:"Gemini transformará tu texto en un estilo más natural. Usa el panel izquierdo para editar el prompt y visualiza el resultado en el panel derecho."})]}),e.jsxs("div",{className:"flex-1 flex flex-col sm:flex-row gap-4 min-h-0 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[e.jsxs("div",{className:"flex-1 flex flex-col mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2 flex-shrink-0",children:"Prompt para IA"}),e.jsx(kt,{value:x,onChange:k=>b(k.target.value),className:"flex-1 resize-none min-h-0",placeholder:"Escribe o modifica el prompt para la IA..."})]}),e.jsxs("div",{className:"flex flex-col gap-3 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"text-gray-500",children:["Tokens: ",j]}),j>3500&&e.jsx("span",{className:"text-red-500 font-medium",children:"¡Prompt demasiado largo!"})]}),e.jsxs(z,{onClick:E,disabled:p||!w||j>3500,className:"w-full flex items-center justify-center gap-2",size:"lg",children:[p&&e.jsx(ls,{className:"w-4 h-4 animate-spin"}),e.jsx($s,{className:"w-4 h-4"}),p?"Consultando IA...":"Generar versión mejorada"]}),p&&e.jsx(lr,{className:"mt-2"})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 sm:border-l sm:border-gray-200 sm:pl-4 border-t sm:border-t-0 border-gray-200 pt-4 sm:pt-0",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Resultado"}),u&&e.jsxs(z,{type:"button",size:"sm",variant:"outline",onClick:()=>{navigator.clipboard.writeText(u),vt.success("Texto copiado al portapapeles")},className:"flex items-center gap-1",children:[e.jsx(Ua,{className:"w-4 h-4"}),"Copiar"]})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-h-0",children:[e.jsx(kt,{readOnly:!0,value:u||(p?"Generando respuesta...":"El resultado aparecerá aquí después de generar"),className:"flex-1 resize-none bg-gray-50 border-gray-200 min-h-0",placeholder:"El resultado aparecerá aquí..."}),u&&(a||r)&&e.jsxs("div",{className:"mt-3 flex flex-col sm:flex-row gap-2 flex-shrink-0",children:[a&&e.jsx(z,{type:"button",className:"flex-1",onClick:()=>{a(u),vt.success("Texto insertado")},variant:"default",children:"📝 Insertar en entrada"}),r&&e.jsx(z,{type:"button",className:"flex-1",onClick:()=>{r(u),vt.success("Texto reemplazado")},variant:"secondary",children:"🔄 Reemplazar entrada"})]})]})]})]}),e.jsx("div",{className:"flex-shrink-0 mt-4 pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 text-xs text-gray-500",children:[e.jsx("span",{children:"💡 Tip: Puedes editar el prompt para obtener diferentes estilos de reescritura"}),!w]})})]})]})},Xl=va("journal"),aF=Xl?`https://generativelanguage.googleapis.com/v1beta/models/${Xl.model}:generateContent`:"",rF=({entry:t,selectedDate:s,open:n,onOpenChange:a})=>{const{user:r}=qe(),[o,l]=f.useState(!1),c=n!==void 0?n:o,m=a??l,[u,h]=f.useState(""),[p,g]=f.useState(""),[x,b]=f.useState(!1),[j,v]=f.useState(0),w="AIzaSyAW4Ot-z7OH4ZR3OeaN7vcbkEDlWpo1aMY",N="Analiza la siguiente entrada del diario y los estados de ánimo del día. Da una breve opinión sobre cómo fue y sugiere mejoras para mañana.",S=Xl==null?void 0:Xl.params;f.useEffect(()=>{c?(async()=>{let k="";if(r){const D=$e(s),P=Te($t(fe,"moods"),`${r.uid}_${D}`),_=await st(P);k=(_.exists()&&Array.isArray(_.data().moods)?_.data().moods:[]).map(I=>`${I.emoji} ${I.text}`).join(", ")}g(`${N}
Moods: ${k}
Diario:
${t}`)})():(g(""),h(""))},[c,t,r,s]),f.useEffect(()=>{v(ba(p))},[p]);const E=async()=>{var k,D,P,_,B;if(p){b(!0);try{const R=await(await fetch(`${aF}?key=${w}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:p}]}],...S})})).json(),M=(B=(_=(P=(D=(k=R==null?void 0:R.candidates)==null?void 0:k[0])==null?void 0:D.content)==null?void 0:P.parts)==null?void 0:_[0])==null?void 0:B.text;h(M||"No se pudo obtener respuesta")}catch{h("Error al consultar la API")}finally{b(!1)}}},T=()=>{m(!1),h(""),g(""),v(0)};return e.jsx(Rt,{open:c,onOpenChange:k=>k?m(!0):T(),children:e.jsxs(Ct,{className:"w-full sm:max-w-5xl max-h-[90vh] overflow-auto",children:[e.jsxs(_t,{children:[e.jsx(Pt,{children:"Opinión del día"}),e.jsx(rn,{children:"Resumen y sugerencias para mañana."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(kt,{value:p,onChange:k=>g(k.target.value),className:"max-h-[500px] overflow-y-auto"}),e.jsxs("p",{className:"text-xs text-right",children:["Tokens: ",j," ",j>3500&&e.jsx("span",{className:"text-red-500",children:"¡Prompt demasiado largo!"})]}),e.jsxs(z,{onClick:E,disabled:x||!w,className:"w-full flex items-center justify-center gap-2",children:[x&&e.jsx(ls,{className:"w-4 h-4 animate-spin"}),x?"Consultando...":"Analizar día"]}),x&&e.jsx(lr,{className:"mt-2"}),u&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex justify-end",children:e.jsx(z,{type:"button",size:"icon",variant:"ghost",onClick:()=>{navigator.clipboard.writeText(u),vt.success("Texto copiado")},children:e.jsx(Ua,{className:"w-4 h-4"})})}),e.jsx(kt,{readOnly:!0,value:u,className:"max-h-[300px]"})]})]})]})})},iF=({entry:t,selectedDate:s,onInsert:n,onReplace:a})=>{const[r,o]=f.useState(!1),[l,c]=f.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs(Ba,{children:[e.jsx(Ha,{asChild:!0,children:e.jsxs(z,{size:"sm",variant:"outline",className:"flex items-center gap-2 text-blue-600",children:[e.jsx($s,{className:"w-4 h-4"}),"IA"]})}),e.jsxs(pa,{align:"end",children:[e.jsx(Lt,{onSelect:()=>o(!0),children:"Reescribir entrada"}),e.jsx(Lt,{onSelect:()=>c(!0),children:"Opinión y consejos"})]})]}),e.jsx(nF,{entry:t,open:r,onOpenChange:o,onInsert:n,onReplace:a}),e.jsx(rF,{entry:t,selectedDate:s,open:l,onOpenChange:c})]})},oF=t=>{const[s,n]=f.useState(""),[a,r]=f.useState("idle"),[o,l]=f.useState(null),[c,m]=f.useState(void 0),{user:u}=qe(),h=f.useCallback(async()=>{if(!u)return;r("saving"),l(null);const x=$e(t);try{Me.logRead("journal","useJournalData.loadJournalEntry");const b=Te(fe,"journal",`${u.uid}_${x}`),j=await st(b);if(j.exists()){const v=j.data();if(n(v.text||""),v.lastUpdated){const w=v.lastUpdated.toDate();m(Zd(w))}r("saved")}else n(""),r("idle"),m(void 0)}catch(b){console.error("Error loading journal entry:",b),l(b instanceof Error?b.message:"Error loading journal entry"),r("error")}},[u,t]);f.useEffect(()=>{h()},[h]);const p=f.useCallback(async x=>{if(!u)return;r("saving"),l(null);const b=s,j=c,v=new Date,w=Zd(v);n(x),m(w);const N=$e(t),S=Te(fe,"journal",`${u.uid}_${N}`);try{Me.logWrite("journal","useJournalData.saveEntry"),await qt(S,{userId:u.uid,text:x,date:N,lastUpdated:dt(),displayTime:v.toLocaleString("es-ES",{hour:"2-digit",minute:"2-digit",day:"2-digit",month:"2-digit"})},{merge:!0}),r("saved")}catch(E){console.error("Error saving journal entry:",E),n(b),m(j),l(E instanceof Error?E.message:"Error al guardar"),r("error")}},[u,t,s,c]),g=dr("Journal data");return{entry:s,setEntry:n,status:a,error:o,saveEntry:p,lastUpdated:c,loadJournalEntry:h,resync:g}},lF=({selectedDate:t})=>{const{user:s}=qe(),{isUnlocked:n,setUnlocked:a}=Dp(),[r,o]=f.useState(!1),{entry:l,setEntry:c,status:m,error:u,saveEntry:h,lastUpdated:p,resync:g}=oF(t),{isOnline:x}=Va(),{entry:b,setEntry:j}=FN();f.useEffect(()=>{j(l)},[l,j]);const v=()=>{a(!1)};return s?n?e.jsxs(e.Fragment,{children:[e.jsxs(Ne,{className:"w-full",children:[e.jsxs(De,{className:"p-4",children:[e.jsx(KL,{onLock:v}),e.jsx(JL,{value:b,onChange:w=>{j(w),c(w)}}),u&&e.jsx("p",{className:"mt-2 text-sm text-red-500",children:u})]}),e.jsxs(bn,{className:"flex flex-col gap-4 p-2",children:[e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx(WN,{lastUpdated:p}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{onClick:()=>h(b),disabled:m==="saving"||!x,children:m==="saving"?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(O0,{className:"w-4 h-4 animate-spin"}),"Guardando..."]}):e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(O0,{className:"w-4 h-4"}),"Guardar"]})}),e.jsx(iF,{entry:b,selectedDate:t,onInsert:w=>{j(N=>N+(N?`
`:"")+w),c(N=>N+(N?`
`:"")+w)},onReplace:w=>{j(w),c(w)}}),e.jsx(z,{variant:"outline",size:"sm",onClick:()=>o(!0),children:e.jsx(ta,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex justify-center items-center gap-2 text-xs",children:[m==="saving"&&e.jsx("span",{className:"text-blue-500",children:"Guardando..."}),m==="pending"&&e.jsx("span",{className:"text-yellow-600",children:"Pendiente de sincronizar"}),m==="saved"&&e.jsx("span",{className:"text-green-600",children:"Sincronizado"}),m==="error"&&e.jsx("span",{className:"text-red-600",children:"Error de sincronización"}),!x&&e.jsx("span",{className:"text-orange-600",children:"Offline"}),e.jsx(z,{onClick:g,variant:"link",className:"p-0 h-auto text-xs",children:"Reintentar"})]})]})]}),e.jsx(oz,{selectedDate:t}),e.jsx(cz,{open:r,onOpenChange:o})]}):e.jsx(XL,{onUnlock:()=>a(!0),lastUpdated:p}):e.jsx(Ne,{className:"w-full",children:e.jsx(De,{className:"p-4 text-center",children:e.jsx("p",{children:"Inicia sesión para usar el diario"})})})},cF=({selectedDate:t})=>e.jsx(HL,{children:e.jsx(UL,{children:e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx(lF,{selectedDate:t})}),e.jsxs("div",{className:"md:col-span-1 space-y-4",children:[e.jsx(HN,{selectedDate:t,energyFirst:!0}),e.jsxs(Zo,{children:[e.jsx(wu,{className:"h-4 w-4"}),e.jsx(Qo,{children:"Registrar tu estado de ánimo junto con tus entradas del diario te ayuda a mantener un mejor seguimiento de tus emociones y experiencias."})]})]})]})})})}),oy={currentWeek:{label:"Semana actual",getValue:t=>({start:ar(t),end:ha(t)})},currentMonth:{label:"Mes actual",getValue:t=>({start:ts(t),end:ea(t)})}},dF=({onPeriodChange:t})=>{const s=n=>{const a=new Date,r=oy[n];if(r){const{start:o,end:l}=r.getValue(a);t(o,l)}};return e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("span",{className:"text-sm font-medium",children:"Mostrar período:"}),e.jsxs(Nt,{onValueChange:s,defaultValue:"currentWeek",children:[e.jsx(xt,{className:"w-[180px]",children:e.jsx(St,{placeholder:"Seleccionar período"})}),e.jsx(gt,{children:Object.entries(oy).map(([n,{label:a}])=>e.jsx(Pe,{value:n,children:a},n))})]})]})},uF=(t,s)=>{const[n,a]=f.useState(null),[r,o]=f.useState(!0),[l,c]=f.useState(null),{user:m}=qe();return f.useEffect(()=>{(async()=>{if(m){o(!0),c(null);try{const h=[],p=new Date(t),g=new Date(s);for(;p<=g;)h.push($e(p)),p.setDate(p.getDate()+1);const x=h.map(D=>{const P=Te(fe,"journal",`${m.uid}_${D}`);return st(P)}),b=h.map(D=>{const P=Te(fe,"moods",`${m.uid}_${D}`);return st(P)}),j=await Promise.all(x),v=await Promise.all(b),w=new Map(h.map(D=>[D,{date:D,words:0,characters:0}]));j.forEach(D=>{var P,_;if(D.exists()){const B=D.data();w.set(B.date,{date:B.date,words:((P=B.text)==null?void 0:P.split(/\s+/).filter(Boolean).length)||0,characters:((_=B.text)==null?void 0:_.length)||0})}});const N=Array.from(w.values()).sort((D,P)=>D.date<P.date?1:-1),S={};v.forEach(D=>{if(D.exists()){const P=D.data();Array.isArray(P.moods)&&P.moods.forEach(_=>{S[_.text]=(S[_.text]||0)+1})}});const E=Object.entries(S).map(([D,P])=>({name:D,value:P})).sort((D,P)=>P.value-D.value).slice(0,5),T=N.filter(D=>D.words>0).length,k=T>0?Math.round(N.reduce((D,P)=>D+P.words,0)/T):0;a({entries:N,moodStats:E,totalEntries:T,averageWords:k})}catch(h){console.error("Error al cargar estadísticas del diario:",h),c(h instanceof Error?h.message:"Error al cargar estadísticas")}finally{o(!1)}}})()},[m,t,s]),{stats:n,loading:r,error:l}},ly=["#8884d8","#82ca9d","#ffc658","#ff8042","#a4de6c"],mF=()=>{const[t,s]=f.useState(new Date),[n,a]=f.useState(ar(new Date)),[r,o]=f.useState(ha(new Date)),{user:l}=qe(),{stats:c,loading:m,error:u}=uF(n,r),h=(p,g)=>{a(p),o(g)};return l?e.jsxs(Xs,{children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Diario Personal"}),e.jsx("p",{className:"text-gray-500",children:"Escribe y reflexiona sobre tus experiencias diarias"})]}),e.jsx(or,{selectedDate:t,onChange:s}),e.jsxs(Ga,{defaultValue:"entry",className:"space-y-4",children:[e.jsxs(qa,{children:[e.jsx(js,{value:"entry",children:"Entrada Diaria"}),e.jsx(js,{value:"analytics",children:"Análisis"}),e.jsx(js,{value:"settings",children:"Configuración"})]}),e.jsx(hs,{value:"entry",className:"space-y-4",children:e.jsx(cF,{selectedDate:t})}),e.jsxs(hs,{value:"analytics",className:"space-y-4",children:[e.jsx(dF,{onPeriodChange:h}),m||!c?e.jsx("div",{className:"p-4",children:"Cargando estadísticas..."}):u?e.jsx("div",{className:"p-4 text-red-500",children:"Error al cargar estadísticas"}):e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsx(Ne,{children:e.jsxs(De,{className:"pt-6",children:[e.jsx("h3",{className:"font-medium mb-4",children:"Actividad de Escritura"}),e.jsx("div",{className:"h-64",children:e.jsx(gn,{width:"100%",height:"100%",children:e.jsxs(Nu,{data:c.entries,children:[e.jsx(sr,{strokeDasharray:"3 3"}),e.jsx(Ma,{dataKey:"date"}),e.jsx(ma,{}),e.jsx(vn,{}),e.jsx(_r,{}),e.jsx(rc,{dataKey:"words",name:"Palabras",fill:"#8884d8"})]})})})]})}),e.jsx(Ne,{children:e.jsxs(De,{className:"pt-6",children:[e.jsx("h3",{className:"font-medium mb-4",children:"Estados de Ánimo Frecuentes"}),e.jsx("div",{className:"h-64",children:e.jsx(gn,{width:"100%",height:"100%",children:e.jsxs(bc,{children:[e.jsx(jc,{data:c.moodStats,nameKey:"name",dataKey:"value",cx:"50%",cy:"50%",outerRadius:80,label:!0,children:c.moodStats.map((p,g)=>e.jsx(wc,{fill:ly[g%ly.length]},p.name))}),e.jsx(vn,{}),e.jsx(_r,{})]})})})]})}),e.jsx(Ne,{children:e.jsxs(De,{className:"pt-6",children:[e.jsx("h3",{className:"font-medium mb-4",children:"Estadísticas Generales"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total de entradas"}),e.jsx("p",{className:"text-2xl font-bold",children:c.totalEntries})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Promedio de palabras"}),e.jsx("p",{className:"text-2xl font-bold",children:c.averageWords})]})]})]})}),e.jsx(Ne,{children:e.jsxs(De,{className:"pt-6",children:[e.jsx("h3",{className:"font-medium mb-4",children:"Sugerencias"}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[e.jsx("p",{children:"• Escribe regularmente para mantener un mejor seguimiento de tus emociones"}),e.jsx("p",{children:"• Registra tu estado de ánimo junto con tus entradas del diario"}),e.jsx("p",{children:"• Revisa tus entradas anteriores para identificar patrones"}),e.jsx("p",{children:"• Usa las estadísticas para entender mejor tus hábitos de escritura"})]})]})})]})]}),e.jsx(hs,{value:"settings",className:"space-y-4",children:e.jsxs(Ne,{children:[e.jsx(De,{className:"pt-6",children:e.jsx("h3",{className:"font-medium mb-4",children:"Configuración del Diario"})}),"          "]})})]})]}):e.jsx(Xs,{children:e.jsx("div",{className:"text-center py-8",children:e.jsx("h2",{className:"text-xl font-semibold",children:"Inicia sesión para acceder a tu diario"})})})},cy=[{tab:"list",label:"Lista",icon:e.jsx(CR,{className:"h-4 w-4"})},{tab:"kanban",label:"Kanban",icon:e.jsx(ER,{className:"h-4 w-4"})},{tab:"week",label:"Calendario",icon:e.jsx(ns,{className:"h-4 w-4"})},{tab:"analytics",label:"Análisis",icon:e.jsx(Ff,{className:"h-4 w-4"})}],kf=({title:t,actions:s=[],className:n,currentTab:a="list",onTabChange:r})=>{const{shouldShowDesktopNav:o}=Sc();return e.jsx("div",{className:ce("",n),children:e.jsx("div",{className:ce(o?"container mx-auto":"mx-auto px-4 w-full"),children:e.jsxs("div",{className:"bg-background/50 flex items-center justify-between gap-2 py-4 backdrop-blur-md lg:mt-4 lg:rounded-2xl lg:border lg:px-4",children:[e.jsx("div",{className:"flex items-center gap-5",children:e.jsxs("div",{className:"flex items-center gap-12",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg shadow-sm",children:e.jsx(zf,{className:"h-4 w-4 text-white"})}),e.jsx("h2",{className:"text-lg font-bold text-foreground",children:t})]}),e.jsx("nav",{className:"hidden lg:flex gap-2 lg:gap-4",children:cy.map(l=>{const c=a===l.tab;return e.jsxs("button",{onClick:()=>r==null?void 0:r(l.tab),className:ce("flex items-center space-x-3 px-4 py-3 rounded-xl text-sm font-medium transition-all duration-200 group","hover:bg-white/90 hover:shadow-lg",c?"bg-white text-blue-700 shadow-lg border border-blue-200":"text-gray-700 hover:text-gray-900"),children:[e.jsx("span",{className:ce("p-1.5 rounded-lg transition-colors",c?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-600 group-hover:bg-gray-200"),children:l.icon}),e.jsx("span",{className:"whitespace-nowrap",children:l.label})]},l.tab)})})]})}),s.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(xa,{children:e.jsx("div",{className:"hidden lg:flex items-center gap-2",children:s.map(l=>l.dropdown?e.jsxs(Ba,{children:[e.jsxs(Ms,{children:[e.jsx(Is,{asChild:!0,children:e.jsx(Ha,{asChild:!0,children:e.jsxs(z,{variant:"ghost",size:"sm",className:ce(l.showLabel?"h-8 px-3 gap-2":"h-8 w-8 p-0",l.className),children:[l.icon,l.showLabel?e.jsx("span",{className:"text-sm font-medium",children:l.label}):e.jsx("span",{className:"sr-only",children:l.label})]})})}),e.jsx(ks,{children:e.jsx("p",{children:l.tooltip})})]}),e.jsx(pa,{align:"end",children:l.dropdown.map((c,m)=>e.jsx(Lt,{onClick:c.onClick,children:c.label},m))})]},l.id):e.jsxs(Ms,{children:[e.jsx(Is,{asChild:!0,children:e.jsxs(z,{variant:"ghost",size:"sm",className:ce(l.showLabel?"h-8 px-3 gap-2":"h-8 w-8 p-0",l.className),onClick:l.onClick,children:[l.icon,l.showLabel?e.jsx("span",{className:"text-sm font-medium",children:l.label}):e.jsx("span",{className:"sr-only",children:l.label})]})}),e.jsx(ks,{children:e.jsx("p",{children:l.tooltip})})]},l.id))})}),e.jsxs(Ba,{children:[e.jsx(Ha,{asChild:!0,children:e.jsxs(z,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 lg:hidden",children:[e.jsx(Nc,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Opciones"})]})}),e.jsxs(pa,{align:"end",className:"w-56",children:[cy.map(l=>e.jsxs(Lt,{onClick:()=>r==null?void 0:r(l.tab),className:ce("flex items-center gap-2",a===l.tab&&"bg-accent font-medium"),children:[l.icon,e.jsx("span",{children:l.label})]},l.tab)),e.jsx(el,{}),s.map(l=>l.dropdown?e.jsxs(LL,{children:[e.jsxs(LN,{children:[l.icon,e.jsx("span",{className:"ml-2",children:l.label})]}),e.jsx($N,{children:l.dropdown.map((c,m)=>e.jsx(Lt,{onClick:c.onClick,children:c.label},m))})]},l.id):e.jsxs(Lt,{onClick:l.onClick,children:[l.icon,e.jsx("span",{className:"ml-2",children:l.label})]},l.id))]})]})]})]})})})},dy=["#0088FE","#00C49F","#FFBB28","#FF8042"],uy=()=>{const t=Xt(),s=jn(),[n,a]=f.useState([]),[r,o]=f.useState([]),[l,c]=f.useState(!1),[m,u]=f.useState(""),[h,p]=f.useState(!1),[g,x]=f.useState(!1),b=f.useMemo(()=>{const Y=s.pathname;return Y.includes("/task/kanban")?"kanban":Y.includes("/task/list")?"list":Y.includes("/task/calendar")?"week":"list"},[s.pathname]),[j,v]=f.useState("list"),w=Y=>{if(Y==="week"){t("/task/calendar");return}if(Y==="kanban"){t("/task/kanban");return}if(Y==="list"){t("/task/list"),v("list");return}if(Y==="analytics"){t("/task/list"),v("analytics");return}},{user:N}=qe(),S=oo(),{tasks:E,showRecurrenceModal:T,currentTask:k,modalMode:D,addTask:P,editTask:_,completeRecurrentTask:B,setShowRecurrenceModal:I,openCreateModal:R}=S;f.useEffect(()=>{N&&M()},[N]);const M=async()=>{if(!N)return;const Y=nn($t(fe,"tasks"),wt("userId","==",N.uid),db(100)),ie=(await an(Y)).docs.map(ue=>ue.data()).sort((ue,ae)=>{var we,ke,de,J;const ge=((ke=(we=ue.createdAt)==null?void 0:we.toDate)==null?void 0:ke.call(we))||new Date(0);return(((J=(de=ae.createdAt)==null?void 0:de.toDate)==null?void 0:J.call(de))||new Date(0)).getTime()-ge.getTime()}),U=ie.reduce((ue,ae)=>{var je,we,ke,de;const ge=((de=(ke=(we=(je=ae.createdAt)==null?void 0:je.toDate)==null?void 0:we.call(je))==null?void 0:ke.toISOString)==null?void 0:de.call(ke).split("T")[0])||"unknown";return ue[ge]||(ue[ge]={date:ge,completed:0,pending:0}),ue[ge][ae.completed?"completed":"pending"]++,ue},{});a(Object.values(U));const ee=ie.filter(ue=>ue.completed).length,me=ie.filter(ue=>!ue.completed).length;o([{name:"Completadas",value:ee},{name:"Pendientes",value:me}])};if(!N)return e.jsxs("div",{className:"min-h-screen",children:[e.jsx(kf,{title:"Tareas",actions:[],currentTab:b,onTabChange:w}),e.jsx("div",{className:"flex items-center justify-center min-h-[50vh]",children:e.jsx("div",{className:"text-center py-8",children:e.jsx("h2",{className:"text-xl font-semibold",children:"Inicia sesión para ver tus tareas"})})})]});const W=()=>{R()},H=()=>{c(!0)},L=()=>{try{const Y=JSON.parse(m);if(!Array.isArray(Y)){vt.error("El JSON debe contener un array de tareas");return}let se=0,ie=0;Y.forEach(U=>{if(U.title){let ee;if(U.dueDate){const me=new Date(U.dueDate);isNaN(me.getTime())?(ie++,console.warn(`Fecha inválida para tarea "${U.title}": ${U.dueDate}`)):ee=me}console.log("Would import task:",{title:U.title,description:U.description||"",dueDate:ee,category:U.category||"personal",priority:U.priority||void 0,isPrivate:!1,isRecurrent:U.isRecurrent||!1,size:U.size||void 0}),se++}}),ie>0?vt.warning(`${se} tareas procesadas. ${ie} fechas inválidas fueron omitidas.`):vt.success(`${se} tareas procesadas correctamente`),u(""),c(!1)}catch(Y){vt.error("Error al importar las tareas. Verifica el formato JSON."),console.error("Error de importación:",Y)}},$=()=>{vt.success("Funcionalidad de exportar - será implementada")},q=()=>{},re=[{id:"calendar",label:"Calendario",icon:e.jsx(ns,{className:"h-4 w-4"}),onClick:()=>t("/tasks/calendar"),tooltip:"Vista de calendario"},{id:"import",label:"Importar",icon:e.jsx(Qi,{className:"h-4 w-4"}),onClick:H,tooltip:"Importar tareas"},{id:"export",label:"Exportar",icon:e.jsx(ta,{className:"h-4 w-4"}),onClick:$,tooltip:"Exportar tareas"},{id:"ai",label:"AI Assistant",icon:e.jsx(wb,{className:"h-4 w-4"}),onClick:q,tooltip:"Asistente IA",dropdown:[{label:"Sugerir tareas",onClick:()=>p(!0)},{label:"Repriorizar visibles",onClick:()=>x(!0)}]},{id:"new",label:"Nuevo",icon:e.jsx(as,{className:"h-4 w-4"}),onClick:W,tooltip:"Crear nueva tarea",className:"bg-black text-white hover:bg-gray-800",showLabel:!0}];return e.jsxs("div",{className:"min-h-screen relative",children:[e.jsx(kf,{title:"Tareas",actions:re,currentTab:b,onTabChange:w}),e.jsx(z,{onClick:W,className:ce("fixed bottom-20 right-6 h-14 w-14 rounded-full shadow-lg hover:shadow-xl","transition-shadow z-50 lg:hidden bg-black text-white hover:bg-gray-800"),size:"icon",title:"Crear nueva tarea",children:e.jsx(as,{className:"h-6 w-6"})}),e.jsxs("div",{className:"p-4",children:[S.error&&e.jsx("div",{className:"mb-4",children:e.jsx(Bp,{error:S.error,onRetry:S.loadTasks,showClearCache:!0})}),b==="list"&&e.jsxs(Ga,{value:j,onValueChange:Y=>w(Y),className:"space-y-4",children:[e.jsx(hs,{value:"list",className:"space-y-4",children:e.jsx(tF,{})}),e.jsx(hs,{value:"analytics",className:"space-y-4",children:e.jsxs("div",{className:"grid md:grid-cols-2 xl:grid-cols-2 gap-4 lg:gap-6 xl:gap-8 desktop-grid-responsive",children:[e.jsx(Ne,{className:"desktop-card-enhanced",children:e.jsxs(De,{className:"pt-6",children:[e.jsx("h3",{className:"font-medium mb-4",children:"Progreso de Tareas"}),e.jsx("div",{className:"h-64 lg:h-80",children:e.jsx(gn,{width:"100%",height:"100%",children:e.jsxs(qi,{data:n,children:[e.jsx(sr,{strokeDasharray:"3 3"}),e.jsx(Ma,{dataKey:"date"}),e.jsx(ma,{}),e.jsx(vn,{}),e.jsx(_r,{}),e.jsx(gi,{type:"monotone",dataKey:"completed",name:"Completadas",stroke:"#8884d8"}),e.jsx(gi,{type:"monotone",dataKey:"pending",name:"Pendientes",stroke:"#82ca9d"})]})})})]})}),e.jsx(Ne,{className:"desktop-card-enhanced",children:e.jsxs(De,{className:"pt-6",children:[e.jsx("h3",{className:"font-medium mb-4",children:"Estado General"}),e.jsx("div",{className:"h-64 lg:h-80",children:e.jsx(gn,{width:"100%",height:"100%",children:e.jsxs(bc,{children:[e.jsx(jc,{data:r,cx:"50%",cy:"50%",labelLine:!1,outerRadius:80,fill:"#8884d8",dataKey:"value",label:({cx:Y,cy:se,midAngle:ie,innerRadius:U,outerRadius:ee,percent:me,name:ue})=>{const ae=Math.PI/180,ge=25+U+(ee-U),je=Y+ge*Math.cos(-ie*ae),we=se+ge*Math.sin(-ie*ae);return e.jsx("text",{x:je,y:we,fill:"#888",textAnchor:je>Y?"start":"end",dominantBaseline:"central",children:`${ue} (${(me*100).toFixed(0)}%)`})},children:r.map(Y=>e.jsx(wc,{fill:dy[Y%dy.length]},`cell-${Y}`))}),e.jsx(vn,{})]})})})]})})]})})]}),b==="kanban"&&e.jsx("div",{className:"space-y-4",children:e.jsx(eF,{})})]}),e.jsx(wS,{tasks:E,open:h,onOpenChange:p}),e.jsx(NS,{tasks:E,onUpdate:_,open:g,onOpenChange:x}),e.jsx(tl,{isOpen:T,onClose:()=>I(),onConfirm:Y=>{D==="complete"?B(Y):D==="edit"?_(k.id,Y):P(Y)},task:k||{id:"",taskCode:0,title:"",completed:!1,category:"personal",createdAt:{seconds:Date.now()/1e3}},mode:D}),e.jsx(Rt,{open:l,onOpenChange:c,children:e.jsxs(Ct,{className:"max-w-4xl",children:[e.jsxs(_t,{children:[e.jsx(Pt,{children:"Importar Tareas"}),e.jsx(rn,{children:"Pega el JSON con las tareas a importar. Puedes incluir fechas en varios formatos."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(kt,{placeholder:`Ejemplo - Importa tareas con fechas en diferentes formatos:
[
  {
    "title": "Completar proyecto importante",
    "description": "Terminar la implementación",
    "dueDate": "2024-12-31",
    "category": "work",
    "priority": "do",
    "size": "grande"
  },
  {
    "title": "Revisión médica anual", 
    "description": "Chequeo general de salud",
    "dueDate": "2024-07-15T09:00:00Z",
    "category": "health",
    "priority": "decide"
  },
  {
    "title": "Tarea flexible",
    "description": "Esta tarea no tiene fecha límite específica",
    "category": "personal",
    "isRecurrent": true
  }
]

Formatos de fecha soportados:
- "2024-12-31" (solo fecha)
- "2024-06-15T14:30:00Z" (fecha y hora ISO)
- "2024-06-15T14:30:00" (fecha y hora local)
- Sin campo "dueDate" = sin fecha asignada

Campos opcionales:
- description, dueDate, priority, size, isRecurrent`,value:m,onChange:Y=>u(Y.target.value),rows:20,className:"font-mono text-sm"}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(z,{variant:"outline",onClick:()=>c(!1),children:"Cancelar"}),e.jsx(z,{onClick:L,disabled:!m.trim(),children:"Importar Tareas"})]})]})]})})]})},hF=()=>{const[t,s]=z_(),n=Xt(),[a,r]=f.useState(!1),[o,l]=f.useState(""),[c,m]=f.useState(!1),[u,h]=f.useState(!1),[p,g]=f.useState(null),[x,b]=f.useState(!1),{user:j}=qe(),v=oo(),{tasks:w,showRecurrenceModal:N,currentTask:S,modalMode:E,addTask:T,editTask:k,deleteTask:D,toggleTask:P,completeRecurrentTask:_,setShowRecurrenceModal:B,openCreateModal:I,openEditModal:R,error:M,resync:W}=v,H=t.get("search")||"",L=ee=>{ee.trim()?s({search:ee}):s({})},$=Z.useMemo(()=>{if(!H.trim())return w;const ee=H.toLowerCase().trim();return w.filter(me=>me.title.toLowerCase().includes(ee)||me.description&&me.description.toLowerCase().includes(ee))},[w,H]);if(!j)return e.jsxs("div",{className:"min-h-screen p-4",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs(z,{variant:"ghost",size:"sm",onClick:()=>n("/task"),className:"flex items-center gap-2",children:[e.jsx(Po,{className:"w-4 h-4"}),"Volver"]}),e.jsx("h1",{className:"text-2xl font-bold",children:"Calendario de Tareas"})]}),e.jsx(Ne,{children:e.jsx(De,{className:"p-8 text-center",children:e.jsx("p",{children:"Inicia sesión para ver tu calendario de tareas"})})})]});const q=()=>{I()},re=()=>{r(!0)},Y=()=>{try{const ee=JSON.parse(o);if(!Array.isArray(ee)){vt.error("El JSON debe contener un array de tareas");return}let me=0,ue=0;ee.forEach(ae=>{if(typeof ae.title=="string"){let ge,je;if(ae.startDate||ae.dueDate){const we=ae.startDate||ae.dueDate,ke=new Date(we);isNaN(ke.getTime())?(ue++,console.warn(`Fecha inválida para tarea "${ae.title}": ${we}`)):ge=ke}if(ae.endDate){const we=new Date(ae.endDate);isNaN(we.getTime())?(ue++,console.warn(`Fecha de fin inválida para tarea "${ae.title}": ${ae.endDate}`)):je=we}T({title:ae.title,description:ae.description||"",startDate:ge,endDate:je,category:ae.category||"personal",priority:ae.priority||void 0,isPrivate:!1,isRecurrent:!!ae.isRecurrent||!1,size:ae.size||void 0}),me++}}),ue>0?vt.warning(`${me} tareas importadas. ${ue} fechas inválidas fueron omitidas.`):vt.success(`${me} tareas importadas correctamente`),l(""),r(!1)}catch(ee){vt.error("Error al importar las tareas. Verifica el formato JSON."),console.error("Error de importación:",ee)}},se=()=>{const ee=w.map(je=>{var we,ke;return{title:je.title,description:je.description||"",startDate:((we=je.startDate)==null?void 0:we.toISOString())||null,endDate:((ke=je.endDate)==null?void 0:ke.toISOString())||null,category:je.category,priority:je.priority||null,isRecurrent:je.isRecurrent||!1,size:je.size||null,completed:je.completed}}),me=JSON.stringify(ee,null,2),ue=new Blob([me],{type:"application/json"}),ae=URL.createObjectURL(ue),ge=document.createElement("a");ge.href=ae,ge.download=`tareas_${new Date().toISOString().split("T")[0]}.json`,ge.click(),URL.revokeObjectURL(ae),vt.success("Tareas exportadas correctamente")},ie=[{id:"back",label:"Volver",icon:e.jsx(Po,{className:"h-4 w-4"}),onClick:()=>n("/task/list"),tooltip:"Volver a tareas"},{id:"import",label:"Importar",icon:e.jsx(Qi,{className:"h-4 w-4"}),onClick:re,tooltip:"Importar tareas"},{id:"export",label:"Exportar",icon:e.jsx(ta,{className:"h-4 w-4"}),onClick:se,tooltip:"Exportar tareas"},{id:"ai",label:"AI Assistant",icon:e.jsx(wb,{className:"h-4 w-4"}),onClick:()=>{},tooltip:"Asistente IA",dropdown:[{label:"Sugerir tareas",onClick:()=>m(!0)},{label:"Repriorizar visibles",onClick:()=>h(!0)}]},{id:"new",label:"Nuevo",icon:e.jsx(as,{className:"h-4 w-4"}),onClick:q,tooltip:"Crear nueva tarea",className:"bg-black text-white hover:bg-gray-800",showLabel:!0}],U=ee=>{ee==="list"?n("/task/list"):ee==="kanban"?n("/task/kanban"):ee==="week"?n("/task/calendar"):ee==="analytics"&&n("/task/list")};return e.jsxs("div",{className:"min-h-screen relative",children:[e.jsx(kf,{title:H?`Calendario - Buscando: "${H}"`:"Calendario de Tareas",actions:ie,currentTab:"week",onTabChange:U}),e.jsx(z,{onClick:q,className:ce("fixed bottom-20 right-6 h-14 w-14 rounded-full shadow-lg hover:shadow-xl","transition-shadow z-50 lg:hidden bg-black text-white hover:bg-gray-800"),size:"icon",title:"Crear nueva tarea",children:e.jsx(as,{className:"h-6 w-6"})}),e.jsxs("div",{className:"p-4",children:[M&&e.jsx("div",{className:"mb-4",children:e.jsx(Bp,{error:M,onRetry:W,showClearCache:!0})}),e.jsx(Ne,{children:e.jsx(De,{className:"p-6",children:e.jsx(Q6,{tasks:$,onDelete:D,onEdit:R,onQuickUpdate:ee=>{k(ee.id,{endDate:ee.endDate})},onView:ee=>{g(ee),b(!0)},onMove:(ee,me)=>{const ue=w.find(ge=>ge.id===ee);if(!ue)return;if(!me){k(ee,{startDate:void 0,endDate:void 0});return}const ae=mc(ue.startDate,ue.endDate,me);k(ee,{startDate:me,endDate:ae})},searchQuery:H,onSearchChange:L})})})]}),e.jsx(wS,{tasks:w,open:c,onOpenChange:m}),e.jsx(NS,{tasks:w,onUpdate:k,open:u,onOpenChange:h}),e.jsx(tl,{isOpen:N,onClose:()=>B(),onConfirm:ee=>{E==="complete"?_(ee):E==="edit"?k(S.id,ee):T(ee)},task:S||{id:"",taskCode:0,title:"",completed:!1,category:"personal",createdAt:{seconds:Date.now()/1e3}},mode:E}),e.jsx(Rt,{open:a,onOpenChange:r,children:e.jsxs(Ct,{className:"max-w-4xl",children:[e.jsxs(_t,{children:[e.jsx(Pt,{children:"Importar Tareas"}),e.jsx(rn,{children:"Pega el JSON con las tareas a importar."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(kt,{placeholder:"Pega aquí el JSON con las tareas a importar...",value:o,onChange:ee=>l(ee.target.value),rows:10,className:"font-mono text-sm"}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(z,{variant:"outline",onClick:()=>r(!1),children:"Cancelar"}),e.jsx(z,{onClick:Y,disabled:!o.trim(),children:"Importar Tareas"})]})]})]})}),e.jsx(Vu,{task:p,isOpen:x,onClose:()=>b(!1),onEdit:ee=>{b(!1),R(ee)},onToggle:P})]})},fF=({view:t,onViewChange:s})=>e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(z,{variant:t==="weekly"?"default":"outline",size:"sm",onClick:()=>s("weekly"),className:"gap-2",children:[e.jsx(ns,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Semanal"})]}),e.jsxs(z,{variant:t==="graph"?"default":"outline",size:"sm",onClick:()=>s("graph"),className:"gap-2",children:[e.jsx(Nb,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Anual"})]})]}),HS=(t=new Date)=>{const s=new Date(t);let n=s.getDay();n=n===0?6:n-1;const a=[];for(let r=0;r<7;r++){const o=new Date(s);o.setDate(s.getDate()-n+r),a.push({dayName:["L","M","X","J","V","S","D"][r],fullDate:$e(o)})}return a},my={morning:{icon:Cb,title:"Mañana",defaultOpen:()=>{const t=new Date().getHours();return t>=5&&t<12}},afternoon:{icon:Gh,title:"Tarde",defaultOpen:()=>{const t=new Date().getHours();return t>=12&&t<18}},night:{icon:Sb,title:"Noche",defaultOpen:()=>{const t=new Date().getHours();return t>=18||t<5}},anytime:{icon:Gh,title:"Cualquier momento",defaultOpen:()=>!1}},pF=t=>t>=.9?"¡Increíble! ¡Sigue así! 🌟":t>=.7?"¡Vas muy bien! ¡No pares! 💪":t>=.5?"¡Buen progreso! ¡Sigue adelante! 🎯":t>=.3?"¡Cada pequeño paso cuenta! 🌱":"¡Hoy es un buen día para empezar! 🚀",xF=(t,s)=>{const n=new Date;let a=0;for(let r=0;r<30;r++){const o=new Date(n);o.setDate(o.getDate()-r);const l=$e(o);if(t.every(m=>s[`${m.id}_${l}`]))a++;else if(r<7)break}return a},WS=({children:t,completedHabits:s})=>{const[n,a]=f.useState(()=>Object.entries(my).filter(([l,c])=>c.defaultOpen()).map(([l])=>l)),r=Z.useMemo(()=>Rn.reduce((l,c)=>(l[c.timeOfDay]||(l[c.timeOfDay]=[]),l[c.timeOfDay].push(c),l),{}),[]),o=l=>{const c=HS(),m=$e(),u=l.filter(g=>s[`${g.id}_${m}`]).length;let h=0;const p=l.length*c.length;return c.forEach(g=>{l.forEach(x=>{s[`${x.id}_${g.fullDate}`]&&h++})}),{daily:{completed:u,total:l.length},weekly:{completed:h,total:p}}};return e.jsx(Cp,{type:"multiple",value:n,onValueChange:a,className:"w-full space-y-4",children:Object.entries(r).map(([l,c])=>{const m=my[l],u=m.icon,h=o(c),p=xF(c,s),g=h.daily.completed/h.daily.total;return e.jsxs(Bu,{value:l,className:"rounded-lg border border-gray-200 overflow-hidden",children:[e.jsx(Hu,{className:"w-full px-6 py-4 flex items-center justify-between text-left hover:bg-muted focus:outline-none focus:ring-2 focus:ring-ring data-[state=closed]:rounded-b-lg data-[state=open]:border-b",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:m.title}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:["Hoy: ",h.daily.completed,"/",h.daily.total]}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Semana: ",h.weekly.completed,"/",h.weekly.total]}),p>0&&e.jsxs("div",{className:"flex items-center gap-1 text-amber-500",children:[e.jsx(oc,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:p})]})]})]})}),e.jsx(Wu,{className:"px-6 py-4",children:e.jsxs("div",{className:"space-y-6",children:[t(c),e.jsxs("div",{className:"pt-2 space-y-3 border-t border-gray-100",children:[e.jsx(Vn,{value:h.daily.completed/h.daily.total*100,className:"h-2"}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:pF(g)}),h.daily.completed===h.daily.total&&e.jsxs("div",{className:"flex items-center gap-1 text-green-500",children:[e.jsx(yb,{className:"w-4 h-4"}),e.jsx("span",{children:"¡Completado!"})]})]})]})]})})]},l)})})},gF=({completedHabits:t,onToggle:s,disabled:n})=>{const a=HS(new Date),r=o=>e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"min-w-[480px] sm:min-w-[600px]",children:e.jsxs("div",{className:"grid grid-cols-[minmax(80px,140px)_repeat(7,minmax(32px,1fr))] sm:grid-cols-[minmax(120px,180px)_repeat(7,minmax(40px,1fr))] gap-1 sm:gap-2",children:[e.jsx("div",{}),a.map(l=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium text-xs sm:text-sm",children:l.dayName}),e.jsx("div",{className:"text-[9px] sm:text-[10px] text-gray-400",children:l.fullDate.split("-").slice(1).join("/")})]},l.fullDate)),o.map(l=>e.jsxs(Z.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 pr-1",children:[e.jsx("span",{className:"text-sm sm:text-base shrink-0",children:l.icon}),e.jsxs("div",{className:"flex flex-col min-w-0 flex-1",children:[e.jsx("span",{className:"text-xs sm:text-sm font-medium truncate leading-tight",children:l.name}),e.jsx("span",{className:"text-[10px] sm:text-xs text-gray-500 truncate leading-tight",children:l.goal})]})]}),a.map(c=>{const m=t[`${l.id}_${c.fullDate}`];return e.jsx(z,{variant:m?"default":"outline",className:`h-8 w-8 sm:h-10 sm:w-10 p-0 aspect-square rounded-lg flex items-center justify-center transition-colors mx-auto my-0.5 sm:my-1
                      ${m?DI[l.id]:"border-gray-300"}`,onClick:()=>s(l.id,c.fullDate),disabled:n,children:m?e.jsx(za,{className:"w-4 h-4 sm:w-5 sm:h-5 text-white"}):null},`${l.id}_${c.fullDate}`)})]},l.id))]})})});return e.jsx("div",{className:"w-full",children:e.jsx(WS,{completedHabits:t,children:r})})},US=({year:t,renderCell:s})=>{const n=MM(t);return e.jsxs("div",{className:"inline-block min-w-full",children:[e.jsx("div",{className:"flex gap-1 mb-2 ml-8",children:n.map((a,r)=>e.jsx("div",{className:ce("text-xs text-gray-500 text-center",r===0?"w-8":"w-14"),style:{minWidth:r===0?"32px":`${Math.ceil(a.days/7)*12}px`},children:a.name.slice(0,3)},a.name))}),e.jsxs("div",{className:"flex gap-1",children:[e.jsxs("div",{className:"flex flex-col gap-1 text-xs text-gray-500 pr-2",children:[e.jsx("div",{className:"h-3"}),e.jsx("div",{className:"h-3 flex items-center",children:"L"}),e.jsx("div",{className:"h-3"}),e.jsx("div",{className:"h-3 flex items-center",children:"M"}),e.jsx("div",{className:"h-3"}),e.jsx("div",{className:"h-3 flex items-center",children:"V"}),e.jsx("div",{className:"h-3"})]}),e.jsx("div",{className:"flex gap-1",children:n.map(a=>{const r=String(a.number).padStart(2,"0"),o=new Date(t,a.number-1,1).getDay(),l=o===0?6:o-1,c=l+a.days,m=Math.ceil(c/7);return e.jsx("div",{className:"flex gap-1",children:Array.from({length:m},(u,h)=>e.jsx("div",{className:"flex flex-col gap-1",children:Array.from({length:7},(p,g)=>{const x=h*7+g-l+1;if(x<1||x>a.days)return e.jsx("div",{className:"w-3 h-3"},g);const b=String(x).padStart(2,"0"),j=`${t}-${r}-${b}`;return e.jsx(Z.Fragment,{children:s(j)},j)})},h))},a.name)})})]})]})},vF=({completedHabits:t,onToggle:s})=>{const n=new Date().getFullYear(),a=r=>e.jsx("div",{className:"space-y-8",children:r.map(o=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("span",{className:"text-xl",children:o.icon}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-base",children:o.name}),e.jsxs("span",{className:"text-sm text-gray-600 ml-2",children:["(",o.goal,")"]})]})]}),e.jsxs("div",{className:"overflow-x-auto",children:[e.jsx(US,{year:n,renderCell:l=>{const c=t[`${o.id}_${l}`],m=new Date().toISOString().split("T")[0]===l;return e.jsx(z,{variant:"ghost",onClick:()=>s(o.id,l),className:ce("w-3 h-3 p-0 rounded-full border transition-all duration-200 hover:scale-110",c?"bg-green-600 border-green-700 hover:bg-green-700":"bg-gray-100 border-gray-200 hover:bg-gray-200 hover:border-gray-300",m&&"ring-2 ring-blue-400 ring-offset-1"),title:`${o.name} - ${new Date(l).toLocaleDateString("es-ES")}${c?" (Completado)":""}`})}}),e.jsxs("div",{className:"flex items-center gap-2 mt-4 text-xs text-gray-600",children:[e.jsx("span",{children:"Menos"}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-100 border border-gray-200 rounded-full"}),e.jsx("div",{className:"w-3 h-3 bg-green-200 border border-green-300 rounded-full"}),e.jsx("div",{className:"w-3 h-3 bg-green-400 border border-green-500 rounded-full"}),e.jsx("div",{className:"w-3 h-3 bg-green-600 border border-green-700 rounded-full"})]}),e.jsx("span",{children:"Más"})]})]})]},o.id))});return e.jsx("div",{className:"w-full",children:e.jsx(WS,{completedHabits:t,children:a})})},yF=()=>{const[t,s]=f.useState({}),[n,a]=f.useState("idle"),[r,o]=f.useState(null),{user:l}=qe(),c=f.useMemo(()=>Object.values(t).reduce((h,p)=>({...h,...p}),{}),[t]);f.useEffect(()=>{if(!l)return;const h=new Date,p=h.getFullYear(),g=h.getMonth()+1,x=`${p}-${String(g).padStart(2,"0")}`;(async()=>{try{Me.logRead("habits","useHabitData.loadCurrentMonth",`${l.uid}_${x}`);const v=Te(fe,"habits",`${l.uid}_${x}`),w=await st(v);if(w.exists()){const N=w.data();s(S=>({...S,[x]:N.habits||{}})),a("saved")}else s(N=>({...N,[x]:{}})),a("idle")}catch(v){console.error("Error loading current month habits:",v),o(v instanceof Error?v.message:"Error loading habits"),a("error")}})(),(async()=>{const v=bF(h),w=$t(fe,"habits");for(const N of v)if(N!==x)try{(await an(nn(w,wt("userId","==",l.uid),wt("yearMonth","==",N)))).forEach(E=>{const T=E.data();s(k=>({...k,[N]:T.habits||{}}))})}catch(S){console.error(`Error fetching month ${N}:`,S)}})()},[l]);const m=async(h,p)=>{if(!l)return;a("saving"),o(null);const[g,x]=p.split("-"),b=`${g}-${x}`,j=`${h}_${p}`,v=t[b]||{},w={...v,[j]:!v[j]},N=Te(fe,"habits",`${l.uid}_${b}`);try{Me.logWrite("habits","useHabitData.toggleHabit",`${l.uid}_${b}`),await qt(N,{userId:l.uid,yearMonth:b,habits:w,updatedAt:dt()},{merge:!0}),s(S=>({...S,[b]:w})),a("saved")}catch(S){o(S instanceof Error?S.message:"Error al guardar"),a("error")}},u=dr("Habit data");return{completedHabits:c,status:n,error:r,toggleHabit:m,resync:u}},bF=t=>{const s=t.getFullYear(),n=t.getMonth()+1,a=[];for(let r=1;r<=n;r++){const o=String(r).padStart(2,"0");a.push(`${s}-${o}`)}return a},Ra=va("habit"),jF=Ra?`https://generativelanguage.googleapis.com/v1beta/models/${Ra.model}:generateContent`:"";zt.setOptions({breaks:!0,gfm:!0});const wF=({completedHabits:t,open:s,onOpenChange:n})=>{var D,P;const[a,r]=f.useState(!1),o=s!==void 0?s:a,l=n??r,[c,m]=f.useState(""),[u,h]=f.useState(""),[p,g]=f.useState(!1),[x,b]=f.useState(0),j="AIzaSyAW4Ot-z7OH4ZR3OeaN7vcbkEDlWpo1aMY",v=((D=Ra==null?void 0:Ra.prompts)==null?void 0:D.predict)??"Analiza mis hábitos recientes y predice cuáles pueden fallar. Dame consejos para cumplirlos.",w=((P=Ra==null?void 0:Ra.prompts)==null?void 0:P.suggest)??"Sugiere nuevos hábitos basados en mis intereses y actividades.",N=Ra==null?void 0:Ra.params;f.useEffect(()=>{if(o){const _=E();h(`${v}
${w}
${_}`)}else h(""),m("")},[o,t]),f.useEffect(()=>{b(ba(u))},[u]);const S=_=>{try{const B=zt.parse(_);return Fr.sanitize(B)}catch(B){return console.error("Error procesando Markdown:",B),Fr.sanitize(_.replace(/\n/g,"<br>"))}},E=()=>{const _={};let B=null,I=null;const R=new Set;Object.entries(t).forEach(([L,$])=>{const[q,re]=L.split("_"),Y=parseInt(q,10);if(R.add(re),(!B||re<B)&&(B=re),(!I||re>I)&&(I=re),$){const se=_[Y]||{success:0,fail:0};se.success+=1,_[Y]=se}});const M=Array.from(R).sort();Rn.forEach(L=>{const $=_[L.id]||{success:0,fail:0};M.forEach(q=>{const re=`${L.id}_${q}`;t[re]||($.fail+=1)}),_[L.id]=$});const W=B&&I?`Datos del ${B} al ${I}`:"Sin registros",H=Rn.map(L=>{const $=_[L.id]||{success:0,fail:0};return`- ${L.name}: completado ${$.success} veces, no ejecutado ${$.fail} veces`}).join(`
`);return`${W}
${H}`},T=async()=>{var _,B,I,R,M;g(!0);try{const H=await(await fetch(`${jF}?key=${j}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:u}]}],...N})})).json(),L=(M=(R=(I=(B=(_=H==null?void 0:H.candidates)==null?void 0:_[0])==null?void 0:B.content)==null?void 0:I.parts)==null?void 0:R[0])==null?void 0:M.text;m(L||"No se pudo obtener sugerencia")}catch{m("Error al consultar la API")}finally{g(!1)}},k=()=>{l(!1),m(""),h(""),b(0)};return e.jsxs(Rt,{open:o,onOpenChange:_=>_?l(!0):k(),children:[s===void 0&&e.jsxs(z,{size:"sm",variant:"outline",onClick:()=>l(!0),className:"flex items-center gap-2",children:[e.jsx($s,{className:"w-4 h-4"}),"Analizar hábitos"]}),e.jsxs(Ct,{className:"w-[95vw] h-[90vh] max-w-none max-h-none overflow-hidden flex flex-col sm:w-[90vw] sm:h-[85vh]",children:[e.jsxs(_t,{className:"flex-shrink-0",children:[e.jsx(Pt,{className:"text-xl",children:"Análisis de Hábitos con IA"}),e.jsx(rn,{children:"La IA analizará tus hábitos recientes, predecirá cuáles pueden fallar y te dará consejos personalizados. Usa el panel izquierdo para editar el prompt y visualiza el resultado en el panel derecho."})]}),e.jsxs("div",{className:"flex-1 flex flex-col sm:flex-row gap-4 min-h-0 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[e.jsxs("div",{className:"flex-1 flex flex-col mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2 flex-shrink-0",children:"Prompt para IA"}),e.jsx(kt,{value:u,onChange:_=>h(_.target.value),className:"flex-1 resize-none min-h-0",placeholder:"Datos de hábitos para analizar..."})]}),e.jsxs("div",{className:"flex flex-col gap-3 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"text-gray-500",children:["Tokens: ",x]}),x>3500&&e.jsx("span",{className:"text-red-500 font-medium",children:"¡Prompt demasiado largo!"})]}),e.jsxs(z,{onClick:T,disabled:p||!j||x>3500,className:"w-full flex items-center justify-center gap-2",size:"lg",children:[p&&e.jsx(ls,{className:"w-4 h-4 animate-spin"}),e.jsx($s,{className:"w-4 h-4"}),p?"Consultando IA...":"Obtener análisis"]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 sm:border-l sm:border-gray-200 sm:pl-4 border-t sm:border-t-0 border-gray-200 pt-4 sm:pt-0",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Análisis y sugerencias"}),c&&e.jsxs(z,{type:"button",size:"sm",variant:"outline",onClick:()=>{navigator.clipboard.writeText(c),vt.success("Análisis copiado al portapapeles")},className:"flex items-center gap-1",children:[e.jsx(Ua,{className:"w-4 h-4"}),"Copiar"]})]}),e.jsx("div",{className:"flex-1 flex flex-col min-h-0",children:e.jsx("div",{className:"flex-1 bg-gray-50 border border-gray-200 rounded-md p-4 overflow-auto",children:c?e.jsx("div",{className:`prose prose-sm max-w-none dark:prose-invert
                      prose-headings:text-foreground prose-p:text-foreground 
                      prose-strong:text-foreground prose-ul:text-foreground 
                      prose-ol:text-foreground prose-li:text-foreground
                      prose-code:bg-accent prose-code:px-1 prose-code:py-0.5 prose-code:rounded prose-code:text-foreground
                      prose-pre:bg-accent prose-pre:border prose-pre:text-foreground
                      prose-blockquote:border-l-accent prose-blockquote:text-foreground`,dangerouslySetInnerHTML:{__html:S(c)}}):p?e.jsx("div",{className:"text-sm text-gray-500",children:"Analizando tus hábitos..."}):e.jsx("div",{className:"text-sm text-gray-500",children:"El análisis de tus hábitos aparecerá aquí. La IA te dará predicciones sobre qué hábitos pueden fallar y consejos para cumplirlos mejor."})})})]})]}),e.jsx("div",{className:"flex-shrink-0 mt-4 pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 text-xs text-gray-500",children:[e.jsx("span",{children:"💡 Tip: Mientras más datos tengas registrados, mejores serán las predicciones"}),!j]})})]})]})},NF=({completedHabits:t})=>{const[s,n]=f.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs(Ba,{children:[e.jsx(Ha,{asChild:!0,children:e.jsxs(z,{size:"sm",variant:"outline",className:"flex items-center gap-2 text-blue-600",children:[e.jsx($s,{className:"w-4 h-4"}),"IA"]})}),e.jsx(pa,{align:"end",children:e.jsx(Lt,{onSelect:()=>n(!0),children:"Analizar hábitos"})})]}),e.jsx(wF,{completedHabits:t,open:s,onOpenChange:n})]})},SF=()=>{const[t,s]=f.useState("weekly"),{user:n}=qe(),{completedHabits:a,status:r,error:o,toggleHabit:l,resync:c}=yF(),{isOnline:m}=Va();return n?e.jsxs(Ne,{className:"w-full",children:[e.jsxs(De,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"font-medium text-lg",children:"Hábitos"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(NF,{completedHabits:a}),e.jsx(fF,{view:t,onViewChange:s})]})]}),e.jsx("div",{className:"mb-4"}),t==="weekly"?e.jsx(gF,{completedHabits:a,onToggle:l,disabled:r==="saving"||!m}):e.jsx(vF,{completedHabits:a,onToggle:l}),o&&e.jsx("p",{className:"mt-4 text-sm text-red-500",children:o})]}),e.jsxs(bn,{className:"justify-center gap-2 text-xs p-2",children:[r==="saving"&&e.jsx("span",{className:"text-blue-500",children:"Guardando..."}),r==="pending"&&e.jsx("span",{className:"text-yellow-600",children:"Pendiente de sincronizar"}),r==="saved"&&e.jsx("span",{className:"text-green-600",children:"Sincronizado"}),r==="error"&&e.jsx("span",{className:"text-red-600",children:"Error de sincronización"}),!m&&e.jsx("span",{className:"text-orange-600",children:"Offline"}),e.jsx(z,{onClick:c,variant:"link",className:"p-0 h-auto text-xs",children:"Reintentar"})]})]}):e.jsx(Ne,{className:"w-full",children:e.jsx(De,{className:"p-4 text-center",children:e.jsx("p",{children:"Inicia sesión para registrar tus hábitos"})})})},CF=()=>{const[t,s]=f.useState(new Date),[n]=f.useState([]);return e.jsxs(Xs,{children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Seguimiento de Hábitos"}),e.jsx("p",{className:"text-gray-500",children:"Registra y analiza tus hábitos diarios para mejorar tu estilo de vida"})]}),e.jsx(or,{selectedDate:t,onChange:s}),e.jsxs(Ga,{defaultValue:"tracker",children:[e.jsxs(qa,{children:[e.jsx(js,{value:"tracker",children:"Registro Diario"}),e.jsx(js,{value:"analytics",children:"Análisis"})]}),e.jsx(hs,{value:"tracker",children:e.jsx("div",{className:"grid grid-cols-1",children:e.jsx(SF,{selectedDate:t})})}),"        ",e.jsx(hs,{value:"analytics",className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-2 gap-4 lg:gap-6 xl:gap-8 desktop-grid-responsive",children:[e.jsx(Ne,{className:"desktop-card-enhanced",children:e.jsxs(De,{className:"p-4 lg:p-6",children:[e.jsx("h3",{className:"font-medium mb-4",children:"Tendencias de Hábitos"}),e.jsx("div",{className:"h-64 md:h-80 lg:h-96",children:e.jsx(gn,{children:e.jsxs(qi,{data:n,children:[e.jsx(sr,{strokeDasharray:"3 3"}),e.jsx(Ma,{dataKey:"date"}),e.jsx(ma,{}),e.jsx(vn,{}),e.jsx(_r,{}),Rn.map(a=>e.jsx(gi,{type:"monotone",dataKey:a.name,name:`${a.icon} ${a.name}`,stroke:`var(--${a.name.toLowerCase()}-color)`},a.id))]})})})]})}),e.jsx(Ne,{className:"desktop-card-enhanced",children:e.jsx(De,{className:"p-4 lg:p-6",children:e.jsx("h3",{className:"font-medium mb-4",children:"Resumen del Mes"})})})]})})]})]})},dn={breakfast:{icon:Gh,title:"Desayuno",color:"bg-amber-100",hoverColor:"hover:bg-amber-200",order:1},morningSnack:{icon:Cb,title:"Media Mañana",color:"bg-orange-100",hoverColor:"hover:bg-orange-200",order:2},lunch:{icon:mb,title:"Almuerzo",color:"bg-emerald-100",hoverColor:"hover:bg-emerald-200",order:3},afternoonSnack:{icon:TR,title:"Merienda",color:"bg-purple-100",hoverColor:"hover:bg-purple-200",order:4},dinner:{icon:Sb,title:"Cena",color:"bg-indigo-100",hoverColor:"hover:bg-indigo-200",order:5}},Qp={breakfast:8,morningSnack:11,lunch:14,afternoonSnack:17,dinner:20},EF=(t,s)=>{const[n,a,r]=t.split("-").map(Number);return new Date(n,a-1,r,Qp[s]||0,0,0,0).getTime()<Date.now()},TF=(t=new Date)=>{const s=new Date(t);let n=s.getDay();n=n===0?6:n-1;const a=[];for(let r=0;r<7;r++){const o=new Date(s);o.setDate(s.getDate()-n+r),a.push({dayName:["L","M","X","J","V","S","D"][r],fullDate:$e(o),isCurrentMonth:o.getMonth()===s.getMonth(),date:new Date(o)})}return a},DF=()=>{const t=new Date;return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}`},kF=1,AF=1e6;let Oh=0;function RF(){return Oh=(Oh+1)%Number.MAX_SAFE_INTEGER,Oh.toString()}const Lh=new Map,hy=t=>{if(Lh.has(t))return;const s=setTimeout(()=>{Lh.delete(t),Zl({type:"REMOVE_TOAST",toastId:t})},AF);Lh.set(t,s)},_F=(t,s)=>{switch(s.type){case"ADD_TOAST":return{...t,toasts:[s.toast,...t.toasts].slice(0,kF)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(n=>n.id===s.toast.id?{...n,...s.toast}:n)};case"DISMISS_TOAST":{const{toastId:n}=s;return n?hy(n):t.toasts.forEach(a=>{hy(a.id)}),{...t,toasts:t.toasts.map(a=>a.id===n||n===void 0?{...a,open:!1}:a)}}case"REMOVE_TOAST":return s.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(n=>n.id!==s.toastId)}}},Wd=[];let Ud={toasts:[]};function Zl(t){Ud=_F(Ud,t),Wd.forEach(s=>{s(Ud)})}function PF({...t}){const s=RF(),n=r=>Zl({type:"UPDATE_TOAST",toast:{...r,id:s}}),a=()=>Zl({type:"DISMISS_TOAST",toastId:s});return Zl({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:r=>{r||a()}}}),{id:s,dismiss:a,update:n}}function Yu(){const[t,s]=f.useState(Ud);return f.useEffect(()=>(Wd.push(s),()=>{const n=Wd.indexOf(s);n>-1&&Wd.splice(n,1)}),[t]),{...t,toast:PF,dismiss:n=>Zl({type:"DISMISS_TOAST",toastId:n})}}const MF=(t,s)=>{const n=t[s];return n?Object.values(n).reduce((a,r)=>a+(r.calories||0),0):0},IF=({day:t,mealPlan:s,onOpenModal:n})=>{const a=new Date,r=new Date(t.fullDate),o=r.toDateString()===a.toDateString(),l=r<a&&!o,[c,m]=f.useState(!l),u=Object.keys(s[t.fullDate]||{}).length,h=Object.keys(dn).length,p=MF(s,t.fullDate);return e.jsxs("div",{className:`mx-2 my-3 rounded-xl shadow-sm border transition-all duration-200 ${l?"bg-gray-50 border-gray-200 opacity-75":"bg-white border-gray-100"}`,children:[e.jsxs("div",{className:`flex justify-between items-center p-4 ${l?"cursor-pointer hover:bg-gray-100":""} ${c?"border-b border-gray-100 rounded-t-xl":"rounded-xl"}`,onClick:l?()=>m(!c):void 0,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[l&&e.jsx("div",{className:"text-gray-400",children:c?e.jsx(_n,{className:"w-4 h-4"}):e.jsx(rr,{className:"w-4 h-4"})}),e.jsxs("h3",{className:`font-semibold text-base ${l?"text-gray-500":o?"text-blue-600":"text-gray-900"}`,children:[t.dayName,o&&" (Hoy)"]}),l&&!c&&e.jsxs("span",{className:"text-xs text-gray-400 bg-gray-100 px-2 py-1 rounded-md",children:[u,"/",h]})]}),e.jsx("span",{className:`text-sm px-2 py-1 rounded-md ${l?"text-gray-400 bg-gray-100":"text-gray-500 bg-gray-50"}`,children:t.fullDate.split("-").slice(1).join("/")})]}),c&&e.jsxs("div",{className:"p-4 pt-0 space-y-3",children:[Object.entries(dn).sort(([,g],[,x])=>g.order-x.order).map(([g,x])=>{var w;const b=(w=s[t.fullDate])==null?void 0:w[g],{color:j,hoverColor:v}=x;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex flex-col items-center w-12 shrink-0",children:[e.jsx(x.icon,{className:`w-5 h-5 mb-1 ${l?"text-gray-400":"text-gray-600"}`}),e.jsxs("span",{className:`text-xs text-center leading-tight ${l?"text-gray-400":"text-gray-500"}`,children:[Qp[g],":00"]})]}),b?e.jsxs("div",{className:`flex-1 p-3 rounded-lg transition-all duration-200 cursor-pointer border active:scale-95 ${l?"bg-gray-100 border-gray-200 hover:bg-gray-150":`${j} ${v} border-gray-200`}`,onClick:()=>n(t.fullDate,g,b),children:[e.jsx("div",{className:`font-medium text-sm mb-1 line-clamp-1 ${l?"text-gray-500":"text-gray-900"}`,children:b.name}),b.calories&&e.jsxs("div",{className:`text-xs mb-1 font-medium ${l?"text-gray-400":"text-blue-600"}`,children:["Calorías aproximadas: ",b.calories," kcal"]}),b.notes&&e.jsx("div",{className:`text-xs line-clamp-2 mb-2 ${l?"text-gray-400":"text-gray-600"}`,children:b.notes}),b.recipe&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${l?"bg-gray-400":"bg-blue-500"}`}),e.jsx("span",{className:`text-xs ${l?"text-gray-400":"text-blue-600"}`,children:"Receta"})]})]}):e.jsxs(z,{variant:"outline",disabled:l,className:`flex-1 justify-start border-dashed h-auto py-3 text-sm transition-all ${l?"border-gray-200 text-gray-400 bg-gray-50 cursor-not-allowed":"border-gray-300 text-gray-600 hover:bg-gray-50 active:scale-95"}`,onClick:()=>!l&&n(t.fullDate,g),children:[e.jsx(as,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"truncate",children:l?"No agregado":`Agregar ${x.title.toLowerCase()}`})]})]},g)}),p>0&&e.jsx("div",{className:"mt-4 pt-3 border-t border-gray-200",children:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:`text-sm font-medium ${l?"text-gray-500":"text-blue-600"}`,children:["Total del día: ",p," kcal"]})})})]})]})},OF=({date:t,type:s,meal:n,disabled:a,onOpenModal:r})=>{const{color:o,hoverColor:l}=dn[s],c=EF(t,s);return n?e.jsxs("div",{className:`h-full p-2 rounded ${o} relative group cursor-pointer transition-all duration-200 ease-in-out hover:shadow-md ${c?"opacity-50 grayscale":""}`,onClick:()=>r(t,s,n),children:[e.jsx("p",{className:"text-sm font-medium line-clamp-2",children:n.name}),n.calories&&e.jsxs("p",{className:"text-xs text-blue-600 mt-1 font-medium",children:["Calorías aproximadas: ",n.calories," kcal"]}),n.notes&&e.jsx("p",{className:"text-xs text-gray-600 mt-1 line-clamp-2",children:n.notes}),n.recipe&&e.jsx("div",{className:"absolute bottom-1 right-1",children:e.jsx("div",{className:"w-2 h-2 bg-sky-500 rounded-full"})}),e.jsx("div",{className:`absolute inset-0 flex items-center justify-center 
        bg-background/75 opacity-0 group-hover:opacity-100 rounded transition-opacity ${l}`,children:e.jsx(Su,{className:"h-4 w-4 text-gray-700"})})]}):e.jsx(z,{variant:"outline",className:`w-full h-full border-dashed ${c?"opacity-50":""}`,onClick:()=>r(t,s),disabled:a,children:e.jsx(as,{className:"h-4 w-4"})})},LF=(t,s)=>{const n=t[s];return n?Object.values(n).reduce((a,r)=>a+(r.calories||0),0):0},$F=({day:t,mealPlan:s,disabled:n,onOpenModal:a})=>{const r=LF(s,t.fullDate);return e.jsxs("div",{className:`px-2 ${t.isCurrentMonth?"":"bg-muted"}`,children:[e.jsxs("div",{className:"text-center py-2 border-b",children:[e.jsx("div",{className:"font-medium",children:t.dayName}),e.jsx("div",{className:"text-xs text-gray-500",children:t.fullDate.split("-").slice(1).join("/")})]}),Object.entries(dn).sort(([,o],[,l])=>o.order-l.order).map(([o])=>{var l;return e.jsx("div",{className:"h-32 py-2",children:e.jsx(OF,{date:t.fullDate,type:o,meal:(l=s[t.fullDate])==null?void 0:l[o],disabled:n,onOpenModal:a})},o)}),r>0&&e.jsx("div",{className:"text-center py-2 border-t border-gray-200 mt-2",children:e.jsxs("div",{className:"text-sm font-medium text-blue-600",children:["Total: ",r," kcal"]})})]})},al=()=>{const{user:t}=qe(),[s,n]=f.useState([]),[a,r]=f.useState("idle"),[o,l]=f.useState(null),c=f.useCallback(async()=>{if(!t){n([]);return}r("loading"),l(null);try{Me.logRead("shopping-list","useShoppingList.loadShoppingList");const g=nn($t(fe,"shopping-list"),wt("userId","==",t.uid)),x=await an(g);if(x.empty){n([]),r("idle");return}const b=x.docs.map(j=>{const v=j.data();return{id:j.id,name:v.name||"",stock:v.stock||0,toBuy:v.toBuy||0,status:v.status||"to-buy",...v.price!==void 0&&{price:v.price},...v.category&&{category:v.category},...v.place&&{place:v.place},...v.consumeBy&&{consumeBy:v.consumeBy},...v.nextPurchase&&{nextPurchase:v.nextPurchase}}});n(b),r("idle")}catch(g){(g==null?void 0:g.code)==="permission-denied"?(l("Error de permisos - Verificar reglas de Firestore"),r("error")):(l(g instanceof Error?g.message:"Error al cargar"),r("error"),n([]))}},[t]);f.useEffect(()=>{c()},[c]);const m=async g=>{if(!t){l("Usuario no autenticado");return}r("saving"),l(null);try{const x=s.find(j=>j.name.toLowerCase()===g.name.toLowerCase());if(x){const j=x.stock+Number(g.stock);x.status==="low-stock"?await u(x.id,{stock:j}):x.status==="to-buy"?await u(x.id,{stock:j,status:"in-stock"}):await u(x.id,{stock:j}),r("idle");return}const b={userId:t.uid,name:g.name,stock:Number(g.stock),toBuy:Number(g.toBuy),status:g.status,createdAt:dt(),updatedAt:dt()};g.price!==void 0&&g.price!==null&&!isNaN(Number(g.price))&&(b.price=Number(g.price)),g.category&&typeof g.category=="string"&&g.category.trim()!==""&&(b.category=g.category.trim()),g.place&&typeof g.place=="string"&&g.place.trim()!==""&&(b.place=g.place.trim()),g.consumeBy&&typeof g.consumeBy=="string"&&g.consumeBy.trim()!==""&&(b.consumeBy=g.consumeBy.trim()),g.nextPurchase&&(b.nextPurchase=!0),Me.logWrite("shopping-list","useShoppingList.addItem"),await Ao($t(fe,"shopping-list"),b),await c(),r("idle")}catch(x){const b=x instanceof Error?x.message:"Error al guardar";l(b),r("error")}},u=async(g,x)=>{if(!t){l("Usuario no autenticado");return}r("saving"),l(null);try{const b=Te(fe,"shopping-list",g),j={updatedAt:dt()};x.name!==void 0&&(j.name=x.name),x.stock!==void 0&&(j.stock=Number(x.stock)),x.toBuy!==void 0&&(j.toBuy=Number(x.toBuy)),x.status!==void 0&&(j.status=x.status),x.price!==void 0&&x.price!==null&&!isNaN(Number(x.price))&&(j.price=Number(x.price)),x.category!==void 0&&typeof x.category=="string"&&x.category.trim()!==""&&(j.category=x.category.trim()),x.place!==void 0&&typeof x.place=="string"&&x.place.trim()!==""&&(j.place=x.place.trim()),x.consumeBy!==void 0&&typeof x.consumeBy=="string"&&x.consumeBy.trim()!==""&&(j.consumeBy=x.consumeBy.trim()),x.nextPurchase!==void 0&&(j.nextPurchase=x.nextPurchase),Me.logWrite("shopping-list","useShoppingList.updateItem",g),await Hn(b,j),await c(),r("idle")}catch(b){const j=b instanceof Error?b.message:"Error al actualizar";l(j),r("error")}};return{items:s,status:a,error:o,addItem:m,updateItem:u,deleteItem:async g=>{if(!t){l("Usuario no autenticado");return}r("saving"),l(null);try{Me.logDelete("shopping-list","useShoppingList.deleteItem",g),await ao(Te(fe,"shopping-list",g)),await c(),r("idle")}catch(x){const b=x instanceof Error?x.message:"Error al eliminar";l(b),r("error")}},moveItem:(g,x)=>{u(g,{status:x})},loadShoppingList:c}},_a=va("meal"),$h=_a?`https://generativelanguage.googleapis.com/v1beta/models/${_a.model}:generateContent`:"",zF=({selectedMeal:t,onFormChange:s,onOverwriteDay:n,mealName:a})=>{var U,ee,me;const{items:r}=al(),[o,l]=f.useState(!1),[c,m]=f.useState(!1),[u,h]=f.useState(!1),[p,g]=f.useState(null),[x,b]=f.useState(""),[j,v]=f.useState(""),[w,N]=f.useState(0),[S,E]=f.useState(!1),[T,k]=f.useState(null),[D,P]=f.useState("meal"),_="AIzaSyAW4Ot-z7OH4ZR3OeaN7vcbkEDlWpo1aMY",B=((U=_a==null?void 0:_a.prompts)==null?void 0:U.meal)??"Genera una comida en formato JSON utilizando los ingredientes disponibles.",I=((ee=_a==null?void 0:_a.prompts)==null?void 0:ee.day)??"Genera todas las comidas del día en formato JSON.",R=_a==null?void 0:_a.params;f.useEffect(()=>{N(ba(x))},[x]);const M=()=>r.filter(ae=>{if(ae.category){const ge=ae.category.toLowerCase();if(["aseo","limpieza","cuidado personal","otro"].some(we=>ge.includes(we)))return!1}return ae.status==="in-stock"||ae.status==="low-stock"}).map(ae=>`${ae.name} (${ae.stock})`).join(", "),W=ue=>{const ae=M(),ge=j.trim();if(ue==="meal"){let je=`${B}
Dia: ${t.date}
Tipo: ${t.type}
Ingredientes: ${ae}`;ge&&(je+=`
Preferencias: ${ge}`),je+=`
Devuelve JSON {"name":"","notes":"","recipe":""}`,b(je)}else{let je=`${I}
Dia completo: ${t.date}
Ingredientes: ${ae}`;ge&&(je+=`
Preferencias: ${ge}`),je+=`
Devuelve JSON con llaves ${Object.keys(dn).join(", ")}.`,b(je)}g(ue)},H=()=>{g(null),b(""),N(0),E(!1),k(null)},L=async()=>{p==="meal"?(P("meal"),await $(x)):p==="day"&&(P("day"),await q(x))},$=async ue=>{var ae,ge,je,we,ke;l(!0),E(!0),k(null);try{const de=ue,ve=await(await fetch(`${$h}?key=${_}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:de}]}],...R})})).json(),pt=(((ke=(we=(je=(ge=(ae=ve==null?void 0:ve.candidates)==null?void 0:ae[0])==null?void 0:ge.content)==null?void 0:je.parts)==null?void 0:we[0])==null?void 0:ke.text)||"").match(/\{[\s\S]*\}/);if(pt){const ot=JSON.parse(pt[0]);k({name:ot.name||"",notes:ot.notes||"",recipe:ot.recipe||"",type:t.type})}}catch(de){console.error("AI meal error",de),k(null)}finally{l(!1)}},q=async ue=>{var ae,ge,je,we,ke;m(!0),E(!0),k(null);try{const de=ue,ve=await(await fetch(`${$h}?key=${_}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:de}]}],...R})})).json(),pt=(((ke=(we=(je=(ge=(ae=ve==null?void 0:ve.candidates)==null?void 0:ae[0])==null?void 0:ge.content)==null?void 0:je.parts)==null?void 0:we[0])==null?void 0:ke.text)||"").match(/\{[\s\S]*\}/);if(pt){const ot=JSON.parse(pt[0]);k(ot)}}catch(de){console.error("AI day error",de),k(null)}finally{m(!1)}},re=()=>{if(T){if(D==="meal")s("name",T.name||""),s("notes",T.notes||""),s("recipe",T.recipe||"");else{const ue={};Object.keys(dn).forEach(ae=>{T[ae]&&(ue[ae]={type:ae,name:T[ae].name||"",notes:T[ae].notes||"",recipe:T[ae].recipe||""})}),n(ue)}H()}},Y=()=>{D==="meal"?$(x):q(x)},se=()=>{E(!1),k(null)},ie=async()=>{var ue,ae,ge,je,we;if(!(!a||!_)){h(!0);try{const ke=`Estima las calorías aproximadas para una porción normal de: "${a}". Responde solo con el número de calorías, sin texto adicional ni explicaciones.`,J=await(await fetch(`${$h}?key=${_}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:ke}]}],...R})})).json(),ft=(((we=(je=(ge=(ae=(ue=J==null?void 0:J.candidates)==null?void 0:ue[0])==null?void 0:ae.content)==null?void 0:ge.parts)==null?void 0:je[0])==null?void 0:we.text)||"").match(/(\d+)/);if(ft){const pt=parseInt(ft[1]);s("calories",pt.toString())}}catch(ke){console.error("Error estimating calories:",ke)}finally{h(!1)}}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(kt,{placeholder:"Preferencias (opcional)",value:j,onChange:ue=>v(ue.target.value),className:"h-20"}),e.jsxs(z,{type:"button",onClick:()=>W("meal"),disabled:o||!_,variant:"secondary",className:"w-full flex items-center gap-2",children:[o&&e.jsx(ls,{className:"w-4 h-4 animate-spin"}),e.jsx(Pr,{className:"w-4 h-4"})," Generar comida"]}),e.jsxs(z,{type:"button",onClick:()=>W("day"),disabled:c||!_,variant:"ghost",className:"w-full flex items-center gap-2",children:[c&&e.jsx(ls,{className:"w-4 h-4 animate-spin"}),e.jsx(_o,{className:"w-4 h-4"})," Regenerar día"]}),a&&e.jsxs(z,{type:"button",onClick:ie,disabled:u||!_||!a.trim(),variant:"outline",className:"w-full flex items-center gap-2",children:[u&&e.jsx(ls,{className:"w-4 h-4 animate-spin"}),e.jsx(Pr,{className:"w-4 h-4"})," Estimar calorías"]}),(o||c||u)&&e.jsx(lr,{className:"mt-2"})]}),e.jsx(Rt,{open:p!==null,onOpenChange:ue=>ue?null:H(),children:e.jsxs(Ct,{className:"w-[95vw] h-[90vh] max-w-none max-h-none overflow-hidden flex flex-col sm:w-[90vw] sm:h-[85vh]",children:[e.jsxs(_t,{className:"flex-shrink-0",children:[e.jsx(Pt,{className:"text-xl",children:p==="meal"?"Generar Comida con IA":"Regenerar Día Completo con IA"}),e.jsx(rn,{children:p==="meal"?"La IA generará una comida específica basada en tus ingredientes disponibles y preferencias.":"La IA generará un plan completo del día con todas las comidas basándose en tus ingredientes disponibles."})]}),e.jsxs("div",{className:"flex-1 flex flex-col sm:flex-row gap-4 min-h-0 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[e.jsxs("div",{className:"flex-1 flex flex-col mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2 flex-shrink-0",children:"Prompt para IA"}),e.jsx(kt,{value:x,onChange:ue=>b(ue.target.value),className:"flex-1 resize-none min-h-0",placeholder:"Instrucciones para generar comidas..."})]}),e.jsxs("div",{className:"flex flex-col gap-3 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"text-gray-500",children:["Tokens: ",w]}),w>3500&&e.jsx("span",{className:"text-red-500 font-medium",children:"¡Prompt demasiado largo!"})]}),!S&&e.jsxs(z,{onClick:L,disabled:(p==="meal"?o:c)||!_||w>3500,className:"w-full flex items-center justify-center gap-2",size:"lg",children:[(p==="meal"?o:c)&&e.jsx(ls,{className:"w-4 h-4 animate-spin"}),e.jsx(Pr,{className:"w-4 h-4"}),(p==="meal"?o:c)?"Generando...":"Generar comidas"]}),(o||c)&&e.jsx(lr,{className:"mt-2"})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 sm:border-l sm:border-gray-200 sm:pl-4 border-t sm:border-t-0 border-gray-200 pt-4 sm:pt-0",children:[e.jsx("div",{className:"mb-3 flex items-center justify-between",children:e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:S?"Previsualización":"Información del proceso"})}),e.jsx("div",{className:"flex-1 flex flex-col min-h-0",children:S?e.jsxs("div",{className:"flex-1 flex flex-col space-y-4",children:[e.jsx("div",{className:"flex-1 overflow-auto",children:(o||c)&&!T?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full py-12 space-y-4",children:[e.jsx(ls,{className:"w-8 h-8 animate-spin text-blue-500"}),e.jsxs("div",{className:"text-center",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Generando ",D==="meal"?"comida":"plan del día","..."]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["La IA está creando tu ",D==="meal"?"comida personalizada":"plan completo del día"]})]})]}):T?D==="meal"?e.jsxs(Ne,{className:"h-full",children:[e.jsx(Vt,{className:"pb-3",children:e.jsxs(Wt,{className:"text-base flex items-center gap-2",children:[e.jsx(Pr,{className:"w-4 h-4 text-blue-500"}),"Comida Generada"]})}),e.jsxs(De,{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Nombre:"}),e.jsx("p",{className:"text-sm mt-1",children:T.name||"Sin nombre"})]}),T.notes&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Notas:"}),e.jsx("p",{className:"text-sm mt-1 text-gray-600",children:T.notes})]}),T.recipe&&e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Receta:"}),e.jsx("div",{className:"text-sm mt-1 text-gray-600 bg-gray-50 p-3 rounded-md max-h-32 overflow-y-auto",children:e.jsx("pre",{className:"whitespace-pre-wrap font-sans",children:T.recipe})})]})]})]}):e.jsx("div",{className:"space-y-3",children:Object.keys(dn).map(ue=>{var ge;const ae=T[ue];return ae?e.jsxs(Ne,{className:"border border-gray-200",children:[e.jsx(Vt,{className:"pb-2",children:e.jsxs(Wt,{className:"text-sm flex items-center gap-2",children:[e.jsx(Pr,{className:"w-3 h-3 text-blue-500"}),(ge=dn[ue])==null?void 0:ge.title]})}),e.jsxs(De,{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Nombre:"}),e.jsx("span",{className:"ml-1",children:ae.name||"Sin nombre"})]}),ae.notes&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Notas:"}),e.jsx("span",{className:"ml-1 text-gray-600",children:ae.notes})]}),ae.recipe&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Receta:"}),e.jsx("div",{className:"mt-1 text-gray-600 bg-gray-50 p-2 rounded text-xs max-h-16 overflow-y-auto",children:e.jsxs("pre",{className:"whitespace-pre-wrap font-sans",children:[ae.recipe.substring(0,100),"..."]})})]})]})]},ue):null})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full py-12 space-y-4",children:[e.jsx(Ws,{className:"w-8 h-8 text-red-500"}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Error al generar"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"No se pudo generar el contenido. Intenta nuevamente."})]})]})}),T&&e.jsxs("div",{className:"flex flex-col gap-2 pt-3 border-t",children:[e.jsxs(z,{onClick:re,className:"w-full gap-2",size:"sm",children:[e.jsx(ro,{className:"w-4 h-4"}),"Insertar"]}),e.jsxs(z,{onClick:Y,variant:"secondary",className:"w-full gap-2",size:"sm",disabled:o||c,children:[o||c?e.jsx(ls,{className:"w-4 h-4 animate-spin"}):e.jsx(_o,{className:"w-4 h-4"}),"Regenerar"]}),e.jsxs(z,{onClick:se,variant:"outline",className:"w-full gap-2",size:"sm",children:[e.jsx(Ws,{className:"w-4 h-4"}),"Cancelar"]})]}),!T&&e.jsx("div",{className:"flex justify-center pt-3 border-t",children:e.jsxs(z,{onClick:se,variant:"outline",className:"gap-2",size:"sm",children:[e.jsx(Ws,{className:"w-4 h-4"}),"Cancelar"]})})]}):e.jsx("div",{className:"flex-1 bg-gray-50 border border-gray-200 rounded-md p-4 overflow-auto",children:e.jsx("div",{className:"text-sm text-gray-700 space-y-3",children:p==="meal"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Tipo de comida:"})," ",(me=dn[t.type])==null?void 0:me.title]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Fecha:"})," ",t.date]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Ingredientes disponibles:"})," ",M()||"Ninguno disponible"]}),o||c?e.jsx("div",{className:"text-blue-600",children:"✨ Generando comida personalizada..."}):e.jsx("div",{className:"text-gray-500",children:"La comida se generará y podrás previsualizarla antes de insertarla."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Fecha completa:"})," ",t.date]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Comidas a generar:"})," ",Object.values(dn).map(ue=>ue.title).join(", ")]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Ingredientes disponibles:"})," ",M()||"Ninguno disponible"]}),o||c?e.jsx("div",{className:"text-blue-600",children:"✨ Generando plan completo del día..."}):e.jsx("div",{className:"text-gray-500",children:"Se generará el plan del día y podrás previsualizarlo antes de insertarlo."})]})})})})]})]}),e.jsxs("div",{className:"flex-shrink-0 mt-4 pt-3 border-t border-gray-200",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 text-xs text-gray-500",children:[e.jsx("span",{children:"💡 Tip: Mantén tu lista de compras actualizada para mejores sugerencias"}),!_]}),e.jsx(wn,{className:"flex justify-end gap-2 mt-3",children:e.jsx(z,{type:"button",variant:"outline",onClick:H,children:"Cancelar"})})]})]})})]})},FF=({show:t,onClose:s,selectedMealInfo:n,formData:a,onFormChange:r,onSubmit:o,onDelete:l,onOverwriteDay:c,weekDays:m})=>{if(!n)return null;const u=async g=>{g.preventDefault(),await o()},h=m.find(g=>g.fullDate===n.date),p=!!n.meal;return e.jsx(Rt,{open:t,onOpenChange:s,children:e.jsx(Ct,{className:"sm:max-w-[700px]",children:e.jsxs("form",{onSubmit:u,children:[e.jsxs(_t,{children:[e.jsx(Pt,{children:p?"Editar Comida":"Agregar Comida"}),e.jsxs(rn,{children:[h==null?void 0:h.dayName," - ",n.date.split("-").slice(1).join("/")]})]}),e.jsxs("div",{className:"space-y-4 py-4 sm:grid sm:grid-cols-2 sm:gap-4 sm:space-y-0",children:[e.jsxs("div",{className:"space-y-1 sm:col-span-2",children:[e.jsx(Fe,{htmlFor:"mealName",children:"Nombre de la Comida *"}),e.jsx(Be,{id:"mealName",type:"text",value:a.name,onChange:g=>r("name",g.target.value),placeholder:"Ej: Ensalada César",required:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Fe,{htmlFor:"mealNotes",children:"Notas Adicionales"}),e.jsx(Be,{id:"mealNotes",type:"text",value:a.notes,onChange:g=>r("notes",g.target.value),placeholder:"Ej: Sin crutones"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Fe,{htmlFor:"mealCalories",children:"Calorías Aproximadas"}),e.jsx(Be,{id:"mealCalories",type:"number",min:"0",max:"9999",value:a.calories||"",onChange:g=>r("calories",g.target.value?parseInt(g.target.value).toString():""),placeholder:"450"})]}),e.jsxs("div",{className:"space-y-1 sm:col-span-2",children:[e.jsx(Fe,{htmlFor:"mealRecipe",children:"Receta"}),e.jsx(kt,{id:"mealRecipe",value:a.recipe,onChange:g=>r("recipe",g.target.value),placeholder:"Ingredientes y preparación...",className:"h-40 resize-none"})]}),e.jsx("div",{className:"sm:col-span-2",children:e.jsx(zF,{selectedMeal:n,onFormChange:r,onOverwriteDay:g=>c(n.date,g),mealName:a.name})})]}),e.jsxs(wn,{className:"flex flex-col sm:flex-row sm:justify-between gap-2",children:[e.jsx("div",{className:"flex-grow sm:flex-grow-0",children:p&&e.jsxs(Ur,{children:[e.jsx(ki,{asChild:!0,children:e.jsxs(z,{type:"button",variant:"destructive",className:"w-full sm:w-auto",children:[e.jsx(Zi,{className:"w-4 h-4 mr-2"}),"Eliminar"]})}),e.jsxs(mr,{children:[e.jsxs(hr,{children:[e.jsx(pr,{children:"¿Estás seguro?"}),e.jsx(xr,{children:"Esta acción no se puede deshacer. Se eliminará permanentemente la comida."})]}),e.jsxs(fr,{children:[e.jsx(vr,{children:"Cancelar"}),e.jsx(gr,{onClick:l,children:"Eliminar"})]})]})]})}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-end justify-end",children:[e.jsxs("div",{children:[e.jsx(Fe,{htmlFor:"mealType",className:"sr-only",children:"Tipo"}),e.jsxs(Nt,{value:a.type,onValueChange:g=>r("type",g),name:"mealType",required:!0,children:[e.jsx(xt,{id:"mealType",className:"sm:w-40 w-full",children:e.jsx(St,{placeholder:"Selecciona un tipo"})}),e.jsx(gt,{children:Object.entries(dn).sort(([,g],[,x])=>g.order-x.order).map(([g,{title:x}])=>e.jsx(Pe,{value:g,children:x},g))})]})]}),e.jsx(z,{type:"button",variant:"outline",onClick:s,children:"Cancelar"}),e.jsx(z,{type:"submit",disabled:!a.name,children:p?"Actualizar":"Agregar"})]})]})]})})})},BF=({mealPlan:t,onAddMeal:s,onRemoveMeal:n,disabled:a,selectedDate:r=new Date})=>{const{toast:o}=Yu(),l=r,[c,m]=f.useState(!1),[u,h]=f.useState(null),[p,g]=f.useState({type:"breakfast",name:"",notes:"",recipe:"",calories:void 0}),x=TF(l),b=(S,E,T)=>{h({date:S,type:E,meal:T}),g({type:(T==null?void 0:T.type)||E,name:(T==null?void 0:T.name)||"",notes:(T==null?void 0:T.notes)||"",recipe:(T==null?void 0:T.recipe)||"",calories:T==null?void 0:T.calories}),m(!0)},j=(S,E)=>{g(T=>({...T,[S]:S==="calories"?E?parseInt(E):void 0:E}))},v=async()=>{if(u)try{u.meal&&u.meal.type!==p.type&&await n(u.date,u.meal.type),await s(u.date,p.type,{type:p.type,name:p.name,notes:p.notes,recipe:p.recipe,calories:p.calories}),m(!1)}catch(S){console.error("Error al guardar:",S),o({title:"Error al Guardar",description:"No se pudo guardar la comida.",variant:"destructive"})}},w=async()=>{if(u!=null&&u.meal)try{await n(u.date,u.meal.type),m(!1)}catch(S){console.error("Error al eliminar:",S),o({title:"Error al Eliminar",description:"No se pudo eliminar la comida.",variant:"destructive"})}},N=async(S,E)=>{for(const[T,k]of Object.entries(E))await s(S,T,k);if(u){const T=E[u.type];T&&g({type:u.type,name:T.name,notes:T.notes||"",recipe:T.recipe||"",calories:T.calories})}};return e.jsxs("div",{className:"w-full h-full flex flex-col",children:[e.jsx("div",{className:"md:hidden flex-1 overflow-y-auto",children:e.jsxs("div",{className:"pb-20 px-2",children:[" ",x.map(S=>e.jsx(IF,{day:S,mealPlan:t,onOpenModal:b},S.fullDate))]})}),"      ",e.jsx("div",{className:"hidden md:block flex-1 overflow-auto",children:e.jsx("div",{className:"min-h-full p-4 lg:p-6 xl:p-8",children:e.jsxs("div",{className:"grid grid-cols-8 gap-2 lg:gap-4 xl:gap-6 min-w-[900px] lg:min-w-[1200px] xl:min-w-[1400px] h-full",children:[e.jsx("div",{className:"bg-gray-50 rounded-lg p-3 lg:p-4 xl:p-6",children:Object.entries(dn).sort(([,S],[,E])=>S.order-E.order).map(([S,E])=>e.jsx("div",{className:"h-32 lg:h-36 xl:h-40 flex items-center justify-center border-b border-gray-200 last:border-b-0",children:e.jsxs("div",{className:"flex flex-col items-center gap-2 text-center",children:[e.jsx(E.icon,{className:"h-6 w-6 lg:h-7 lg:w-7 xl:h-8 xl:w-8 text-gray-600"}),e.jsx("span",{className:"font-medium text-sm lg:text-base",children:E.title}),e.jsxs("span",{className:"text-xs lg:text-sm text-gray-500",children:[Qp[S],":00"]})]})},S))}),x.map(S=>e.jsx($F,{day:S,mealPlan:t,disabled:a,onOpenModal:b},S.fullDate))]})})}),e.jsx(FF,{show:c,onClose:()=>m(!1),selectedMealInfo:u,formData:p,onFormChange:j,onSubmit:v,onDelete:w,onOverwriteDay:N,weekDays:x})]})},HF=({onImport:t,disabled:s})=>{const{toast:n}=Yu(),a=o=>!o||typeof o!="object"?!1:Object.entries(o).every(([l,c])=>!/^\d{4}-\d{2}-\d{2}$/.test(l)||!c||typeof c!="object"?!1:Object.entries(c).every(([u,h])=>!(!Object.keys(dn).includes(u)||!h||typeof h!="object"||typeof h.name!="string"||!h.name||h.notes&&typeof h.notes!="string"||h.recipe&&typeof h.recipe!="string"))),r=o=>{var m;const l=(m=o.target.files)==null?void 0:m[0];if(!l)return;const c=new FileReader;c.onload=async u=>{var h;try{const p=(h=u.target)==null?void 0:h.result,g=JSON.parse(p);if(!a(g))throw new Error("El formato del archivo no es válido. Revisa la documentación para ver el formato correcto.");await t(g)}catch(p){console.error("Error importing:",p),n({title:"Error de Importación",description:p instanceof Error?p.message:"Formato inválido",variant:"destructive"})}},c.readAsText(l)};return e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",title:"Importar Plan",accept:"application/json",onChange:r,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer",disabled:s}),e.jsxs(z,{variant:"outline",size:"sm",className:"w-full",disabled:s,children:[e.jsx(Qi,{className:"h-4 w-4 mr-2"}),"Importar Plan"]})]})},WF=({onImport:t,disabled:s})=>{const[n,a]=f.useState(!1),[r,o]=f.useState(""),{toast:l}=Yu(),c=u=>!u||typeof u!="object"?!1:Object.entries(u).every(([h,p])=>!/^\d{4}-\d{2}-\d{2}$/.test(h)||!p||typeof p!="object"?!1:Object.entries(p).every(([x,b])=>!(!Object.keys(dn).includes(x)||!b||typeof b!="object"||typeof b.name!="string"||!b.name||b.notes&&typeof b.notes!="string"||b.recipe&&typeof b.recipe!="string"))),m=async()=>{try{const u=JSON.parse(r);if(!c(u))throw new Error("El formato del JSON no es válido. Revisa la documentación para ver el formato correcto.");await t(u),o(""),a(!1)}catch(u){console.error("Error importing from text:",u),l({title:"Error de Importación",description:u instanceof Error?u.message:"Formato inválido",variant:"destructive"})}};return e.jsxs(Rt,{open:n,onOpenChange:a,children:[e.jsxs(z,{variant:"outline",size:"sm",type:"button",onClick:()=>a(!0),disabled:s,children:[e.jsx(DR,{className:"h-4 w-4 mr-2"}),"Pegar JSON"]}),e.jsxs(Ct,{children:[e.jsx(_t,{children:e.jsx(Pt,{children:"Pegar Plan de Comidas"})}),e.jsx(kt,{value:r,onChange:u=>o(u.target.value),placeholder:"Pegue aquí el JSON del plan de comidas",className:"mt-4 min-h-[200px]"}),e.jsxs(wn,{className:"gap-2 sm:gap-0",children:[e.jsx(z,{type:"button",variant:"outline",onClick:()=>a(!1),className:"flex-1 sm:flex-none",children:"Cancelar"}),e.jsx(z,{type:"button",onClick:m,className:"flex-1 sm:flex-none",disabled:!r.trim(),children:"Importar"})]})]})]})},VS=()=>{const[t,s]=f.useState({}),[n,a]=f.useState("idle"),[r,o]=f.useState(null),{user:l}=qe(),c=Object.values(t).reduce((x,b)=>({...x,...b}),{}),m=f.useCallback(async()=>{if(!l)return;a("loading"),o(null);const x=DF();try{let b={};Me.logRead("meals","useMealPlan.loadCurrentMonth");const j=Te(fe,"meals",`${l.uid}_${x}`),v=await st(j);if(v.exists()){const S=v.data();b[x]=S.meals||{}}else b[x]={};const w=UF(),N=$t(fe,"meals");for(const S of w)if(S!==x)try{Me.logRead("meals",`useMealPlan.loadMonth_${S}`);const E=nn(N,wt("userId","==",l.uid),wt("yearMonth","==",S)),T=await an(E);T.empty?b[S]={}:T.forEach(k=>{const D=k.data();b[S]=D.meals||{}})}catch(E){console.error(`Error fetching month ${S}:`,E)}s(b),a("saved")}catch(b){console.error("Error loading meal plans:",b),o(b instanceof Error?b.message:"Error al cargar el plan"),a("error")}},[l]);f.useEffect(()=>{m()},[m]);const u=f.useCallback(async(x,b,j)=>{if(!l)return;a("saving"),o(null);const[v,w]=x.split("-"),N=`${v}-${w}`,S=`${x}_${b}`,E=t[N]||{};try{const T={...E,[x]:{...E[x],[b]:{id:S,...j,calories:j.calories}}};s(D=>({...D,[N]:T}));const k=Te(fe,"meals",`${l.uid}_${N}`);Me.logWrite("meals","useMealPlan.addMeal"),await qt(k,{userId:l.uid,yearMonth:N,meals:T,updatedAt:dt()},{merge:!0}),a("saved")}catch(T){throw console.error("Error adding meal:",T),s(k=>({...k,[N]:E})),o(T instanceof Error?T.message:"Error al guardar"),a("error"),T}},[l,t]),h=f.useCallback(async(x,b)=>{if(!l)return;a("saving"),o(null);const[j,v]=x.split("-"),w=`${j}-${v}`,N=t[w]||{};try{const S=JSON.parse(JSON.stringify(N));if(S[x]){const T={...S[x]};delete T[b],Object.keys(T).length===0?delete S[x]:S[x]=T}s(T=>({...T,[w]:S}));const E=Te(fe,"meals",`${l.uid}_${w}`);Me.logWrite("meals","useMealPlan.removeMeal"),await qt(E,{userId:l.uid,yearMonth:w,meals:S,updatedAt:dt()}),a("saved")}catch(S){throw console.error("Error removing meal:",S),s(E=>({...E,[w]:N})),o(S instanceof Error?S.message:"Error al eliminar"),a("error"),S}},[l,t]),p=f.useCallback(async x=>{if(!l)return;a("saving"),o(null);const b=t;try{const j=Object.entries(x).reduce((w,[N,S])=>{const[E,T]=N.split("-"),k=`${E}-${T}`;return w[k]||(w[k]={}),w[k][N]=Object.entries(S).reduce((D,[P,_])=>{const B=`${N}_${P}`;return D[P]={..._,id:B,type:P,calories:_.calories},D},{}),w},{});s(w=>({...w,...j}));const v=dR(fe);Object.entries(j).forEach(([w,N])=>{const S=Te(fe,"meals",`${l.uid}_${w}`);v.set(S,{userId:l.uid,yearMonth:w,meals:N,updatedAt:dt()},{merge:!0})}),Me.logWrite("meals","useMealPlan.importMealPlan"),await v.commit(),a("saved")}catch(j){throw console.error("Error importing meal plan:",j),s(b),o(j instanceof Error?j.message:"Error al importar"),a("error"),j}},[l,t]),g=dr("Meal plan");return{mealPlan:c,status:n,error:r,addMeal:u,removeMeal:h,importMealPlan:p,loadMealPlans:m,resync:g}},UF=()=>{const t=new Date,s=t.getFullYear(),n=t.getMonth()+1,a=t.getDate(),r=new Date(s,n,0).getDate(),o=String(n).padStart(2,"0"),l=[`${s}-${o}`];if(r-a<7){let c=n+1,m=s;c>12&&(c=1,m=s+1);const u=String(c).padStart(2,"0");l.push(`${m}-${u}`)}return l},Ku=()=>{const{user:t}=qe(),[s,n]=f.useState([]),[a,r]=f.useState("idle"),[o,l]=f.useState(null),c=f.useCallback(async()=>{if(t){r("loading"),l(null);try{Me.logRead("recipes","useRecipes.loadRecipes");const p=nn($t(fe,"recipes"),wt("userId","==",t.uid)),x=(await an(p)).docs.map(b=>{const j=b.data();return{id:b.id,name:j.name,ingredients:j.ingredients||[],instructions:j.instructions||"",nutrition:j.nutrition||{calories:0,protein:0,carbs:0,fat:0},mealType:j.mealType,...j.description&&{description:j.description},...j.difficulty&&{difficulty:j.difficulty},...j.prepTime!==void 0&&{prepTime:j.prepTime},...j.favorite!==void 0&&{favorite:j.favorite}}});n(x),r("idle")}catch(p){console.error("Error loading recipes:",p),l(p instanceof Error?p.message:"Error al cargar recetas"),r("error")}}},[t]);return f.useEffect(()=>{if(!t){n([]);return}c()},[t,c]),{recipes:s,status:a,error:o,addRecipe:async p=>{if(!t){l("Usuario no autenticado");return}r("saving"),l(null);const g={id:`temp-${Date.now()}`,...p};n(x=>[...x,g]);try{const x={name:p.name,ingredients:p.ingredients,instructions:p.instructions,nutrition:p.nutrition,mealType:p.mealType,userId:t.uid,createdAt:dt(),updatedAt:dt()};p.description&&(x.description=p.description),p.difficulty&&(x.difficulty=p.difficulty),p.prepTime!==void 0&&(x.prepTime=p.prepTime),p.favorite!==void 0&&(x.favorite=p.favorite),Me.logWrite("recipes","useRecipes.addRecipe");const b=await Ao($t(fe,"recipes"),x);n(j=>j.map(v=>v.id===g.id?{...v,id:b.id}:v)),r("idle")}catch(x){console.error("Error adding recipe:",x),n(b=>b.filter(j=>j.id!==g.id)),l(x instanceof Error?x.message:"Error al guardar"),r("error")}},updateRecipe:async(p,g)=>{if(!t){l("Usuario no autenticado");return}r("saving"),l(null);const x=s.find(b=>b.id===p);if(x)try{const b={...x,...g};n(w=>w.map(N=>N.id===p?b:N));const j=Te(fe,"recipes",p),v={updatedAt:dt()};g.name!==void 0&&(v.name=g.name),g.ingredients!==void 0&&(v.ingredients=g.ingredients),g.instructions!==void 0&&(v.instructions=g.instructions),g.nutrition!==void 0&&(v.nutrition=g.nutrition),g.mealType!==void 0&&(v.mealType=g.mealType),g.description!==void 0&&(v.description=g.description),g.difficulty!==void 0&&(v.difficulty=g.difficulty),g.prepTime!==void 0&&(v.prepTime=g.prepTime),g.favorite!==void 0&&(v.favorite=g.favorite),Me.logWrite("recipes","useRecipes.updateRecipe",p),await Hn(j,v),r("idle")}catch(b){console.error("Error updating recipe:",b),n(j=>j.map(v=>v.id===p?x:v)),l(b instanceof Error?b.message:"Error al actualizar"),r("error")}},deleteRecipe:async p=>{if(!t){l("Usuario no autenticado");return}r("saving"),l(null);const g=s.find(x=>x.id===p);if(g)try{n(x=>x.filter(b=>b.id!==p)),Me.logDelete("recipes","useRecipes.deleteRecipe",p),await ao(Te(fe,"recipes",p)),r("idle")}catch(x){console.error("Error deleting recipe:",x),n(b=>[...b,g]),l(x instanceof Error?x.message:"Error al eliminar"),r("error")}},loadRecipes:c}},ex=()=>{const{user:t}=qe(),[s,n]=f.useState([]),[a,r]=f.useState("idle"),[o,l]=f.useState(null),c=f.useCallback(async()=>{if(t){r("loading"),l(null);try{Me.logRead("prepared-meals","usePreparedMeals.loadMeals");const p=nn($t(fe,"prepared-meals"),wt("userId","==",t.uid)),x=(await an(p)).docs.map(b=>{const j=b.data(),v={id:b.id,name:j.name||""};return j.portions!==void 0&&(v.portions=j.portions),v});n(x),r("idle")}catch(p){console.error("Error loading prepared meals:",p),l(p instanceof Error?p.message:"Error al cargar comidas"),r("error")}}},[t]);return f.useEffect(()=>{if(!t){n([]);return}c()},[t,c]),{meals:s,status:a,error:o,addMeal:async p=>{if(!t){l("Usuario no autenticado");return}r("saving"),l(null);const g={id:`temp-${Date.now()}`,...p};n(x=>[...x,g]);try{const x={name:p.name,userId:t.uid,createdAt:dt(),updatedAt:dt()};p.portions!==void 0&&(x.portions=p.portions),Me.logWrite("prepared-meals","usePreparedMeals.addMeal");const b=await Ao($t(fe,"prepared-meals"),x);n(j=>j.map(v=>v.id===g.id?{...v,id:b.id}:v)),r("idle")}catch(x){console.error("Error adding prepared meal:",x),n(j=>j.filter(v=>v.id!==g.id));const b=x instanceof Error?x.message:"Error al guardar";l(b),r("error")}},updateMeal:async(p,g)=>{if(!t){l("Usuario no autenticado");return}r("saving"),l(null);const x=s.find(b=>b.id===p);if(x)try{const b={...x,...g};n(w=>w.map(N=>N.id===p?b:N));const j=Te(fe,"prepared-meals",p),v={updatedAt:dt()};g.name!==void 0&&(v.name=g.name),g.portions!==void 0&&(v.portions=g.portions),Me.logWrite("prepared-meals","usePreparedMeals.updateMeal",p),await Hn(j,v),r("idle")}catch(b){console.error("Error updating prepared meal:",b),n(v=>v.map(w=>w.id===p?x:w));const j=b instanceof Error?b.message:"Error al actualizar";l(j),r("error")}},deleteMeal:async p=>{if(!t){l("Usuario no autenticado");return}r("saving"),l(null);const g=s.find(x=>x.id===p);if(g)try{n(x=>x.filter(b=>b.id!==p)),Me.logDelete("prepared-meals","usePreparedMeals.deleteMeal",p),await ao(Te(fe,"prepared-meals",p)),r("idle")}catch(x){console.error("Error deleting prepared meal:",x),n(j=>[...j,g]);const b=x instanceof Error?x.message:"Error al eliminar";l(b),r("error")}},loadMeals:c}},VF=[{path:"/meal",label:"Plan de Comidas",icon:e.jsx(ns,{className:"h-4 w-4"})},{path:"/shopping-list",label:"Lista de Compras",icon:e.jsx(ir,{className:"h-4 w-4"})},{path:"/recipes",label:"Recetas",icon:e.jsx(Go,{className:"h-4 w-4"})},{path:"/prepared-meals",label:"Comidas Preparadas",icon:e.jsx(Si,{className:"h-4 w-4"})}],Ju=({title:t,children:s,className:n})=>{const a=jn();return e.jsx("div",{className:ce("",n),children:e.jsx("div",{className:"container mx-auto",children:e.jsxs("div",{className:"bg-background/50 flex items-center justify-between gap-2 py-4 backdrop-blur-md lg:mt-4 lg:rounded-2xl lg:border lg:px-4",children:[e.jsx("div",{className:"flex items-center gap-5",children:e.jsxs("div",{className:"flex items-center gap-12",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg shadow-sm",children:e.jsx(kR,{className:"h-4 w-4 text-white"})}),e.jsx("h2",{className:"text-lg font-bold text-foreground",children:t})]}),e.jsx("nav",{className:"hidden md:flex gap-2 lg:gap-4",children:VF.map(r=>{const o=a.pathname===r.path;return e.jsxs(un,{to:r.path,className:ce("flex items-center space-x-3 px-4 py-3 rounded-xl text-sm font-medium transition-all duration-200 group","hover:bg-white/90 hover:shadow-lg",o?"bg-white text-blue-700 shadow-lg border border-blue-200":"text-gray-700 hover:text-gray-900"),children:[e.jsx("span",{className:ce("p-1.5 rounded-lg transition-colors",o?"bg-blue-100 text-blue-600":"bg-gray-100 text-gray-600 group-hover:bg-gray-200"),children:r.icon}),e.jsx("span",{className:"whitespace-nowrap",children:r.label})]},r.path)})})]})}),s&&e.jsx("div",{className:"flex items-center gap-3",children:s})]})})})},tx=({open:t,onOpenChange:s,config:n,customFieldValues:a={},onCustomFieldChange:r})=>{const[o,l]=f.useState(0),[c,m]=f.useState([]),[u,h]=f.useState({}),[p,g]=f.useState(""),[x,b]=f.useState(!1),j=c.map(L=>n.modules.find($=>$.id===L)).filter(L=>L!==void 0),v=j.filter(L=>L.fields&&L.fields.length>0),w=1+v.length+1,N=L=>{m($=>$.includes(L)?$.filter(q=>q!==L):[...$,L])},S=(L,$)=>{h(q=>{const re=q[L]||[],Y=re.includes($)?re.filter(se=>se!==$):[...re,$];return{...q,[L]:Y}})},E=()=>{o===0?v.length>0?l(1):(k(),l(w-1)):o<w-1&&(o===v.length&&k(),l(o+1))},T=()=>{o>0&&l(o-1)},k=()=>{const L={};j.forEach($=>{if($){const q=u[$.id]||[],re=a[$.id]||{},Y=$.dataGenerator(q,re);Y&&Object.keys(Y).length>0&&Object.assign(L,Y)}}),g(JSON.stringify(L,null,2))},D=async()=>{try{await navigator.clipboard.writeText(p),b(!0),vt.success("JSON copiado al portapapeles"),setTimeout(()=>b(!1),2e3)}catch{vt.error("Error al copiar al portapapeles")}},P=()=>{l(0),m([]),h({}),g(""),b(!1),s(!1)},_=()=>{var L,$;if(o===0)return c.length>0;if(o>0&&o<=v.length){const q=o-1,re=v[q];if(!re||((L=re.fields)==null?void 0:L.every(U=>U.type==="custom")))return!0;const se=u[re.id]||[];return(($=re.fields)==null?void 0:$.some(U=>U.type!=="custom"))?se.length>0:!0}return!0},B=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-4",children:"Selecciona los módulos que deseas exportar:"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:n.modules.map(L=>e.jsxs("div",{className:"flex items-start space-x-3 p-4 border rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(As,{id:L.id,checked:c.includes(L.id),onCheckedChange:()=>N(L.id),className:"mt-1"}),L.icon&&e.jsx("div",{className:"mt-1 text-gray-600",children:L.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:L.id,className:"text-sm font-medium cursor-pointer block",children:L.label}),L.description&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:L.description})]})]},L.id))})]}),I=L=>{const $=v[L];return!$||!$.fields?null:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-sm text-gray-600 mb-4",children:["Configura los campos para ",e.jsx("strong",{children:$.label}),":"]}),e.jsxs(Ne,{children:[e.jsx(Vt,{className:"pb-3",children:e.jsxs(Wt,{className:"text-base flex items-center gap-2",children:[$.icon,$.label]})}),e.jsx(De,{className:"space-y-3",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:$.fields.map(q=>{var re;return e.jsx("div",{children:q.type==="custom"&&q.component?e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx("label",{className:"text-sm font-medium block",children:q.label}),q.description&&e.jsx("p",{className:"text-xs text-gray-500",children:q.description}),q.component]}):e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(As,{id:`${$.id}-${q.id}`,checked:((re=u[$.id])==null?void 0:re.includes(q.id))||!1,onCheckedChange:()=>S($.id,q.id)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:`${$.id}-${q.id}`,className:"text-sm font-medium cursor-pointer block",children:q.label}),q.description&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:q.description})]})]})},q.id)})})})]})]})},R=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-4",children:"Aquí está tu JSON generado. Puedes copiarlo al portapapeles:"}),e.jsxs("div",{className:"relative",children:[e.jsx("pre",{className:"bg-gray-100 p-4 rounded-lg text-xs overflow-auto max-h-96 border",children:p}),e.jsxs(z,{onClick:D,variant:"outline",size:"sm",className:"absolute top-2 right-2 gap-2",disabled:x,children:[x?e.jsx(ro,{className:"w-4 h-4"}):e.jsx(Ua,{className:"w-4 h-4"}),x?"Copiado":"Copiar"]})]})]}),M=()=>o===0?B():o<=v.length?I(o-1):R(),W=()=>{if(o===0)return"Seleccionar Módulos";if(o<=v.length){const L=v[o-1];return`Configurar ${L==null?void 0:L.label}`}else return"Resultado"},H=()=>{const L=[{label:"Módulos",isCompleted:o>0,isCurrent:o===0}];return v.forEach(($,q)=>{const re=q+1;$&&L.push({label:$.label,isCompleted:o>re,isCurrent:o===re})}),L.push({label:"Resultado",isCompleted:!1,isCurrent:o===w-1}),e.jsxs("div",{className:"bg-gray-50 border-b",children:[e.jsx("div",{className:"flex items-center justify-center space-x-2 py-4 px-6",children:L.map(($,q)=>e.jsxs(Z.Fragment,{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`flex items-center justify-center w-8 h-8 rounded-full text-sm font-medium ${$.isCompleted?"bg-green-500 text-white":$.isCurrent?"bg-blue-500 text-white":"bg-gray-300 text-gray-600"}`,children:$.isCompleted?e.jsx(za,{className:"w-4 h-4"}):q+1}),e.jsx("span",{className:`ml-2 text-sm font-medium ${$.isCurrent?"text-blue-600":$.isCompleted?"text-green-600":"text-gray-500"}`,children:$.label})]}),q<L.length-1&&e.jsx(rr,{className:"w-4 h-4 text-gray-400"})]},q))}),o>0&&j.length>0&&e.jsxs("div",{className:"px-6 pb-3",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Módulos seleccionados:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:j.map($=>$&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:[$.icon,$.label]},$.id))})]})]})};return e.jsx(Rt,{open:t,onOpenChange:P,children:e.jsxs(Ct,{className:"sm:max-w-5xl max-h-[85vh] overflow-y-auto p-0",children:[e.jsx(_t,{className:"px-6 pt-6 pb-0",children:e.jsxs(Pt,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:n.title}),e.jsx("span",{className:"text-sm font-normal text-gray-500 mt-1",children:W()})]}),e.jsxs("span",{className:"text-sm font-normal text-gray-500",children:["Paso ",o+1," de ",w]})]})}),H(),e.jsx("div",{className:"px-6 pb-6",children:M()}),e.jsxs("div",{className:"flex justify-between px-6 py-4 border-t bg-gray-50",children:[e.jsxs(z,{variant:"outline",onClick:T,disabled:o===0,className:"gap-2",children:[e.jsx(Bf,{className:"w-4 h-4"}),"Anterior"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{variant:"outline",onClick:P,children:"Cancelar"}),o<w-1?e.jsxs(z,{onClick:E,disabled:!_(),className:"gap-2",children:["Siguiente",e.jsx(rr,{className:"w-4 h-4"})]}):e.jsx(z,{onClick:P,children:"Finalizar"})]})]})]})})},GF=({open:t,onOpenChange:s})=>{var h;const{items:n}=al(),{recipes:a}=Ku(),{meals:r}=ex(),{mealPlan:o}=VS(),[l,c]=f.useState({mealPlan:{dateRange:"today"}}),m=(p,g,x)=>{c(b=>({...b,[p]:{...b[p],[g]:x}}))},u={title:"Exportar Datos de Comidas",modules:[{id:"ingredients",label:"Ingredientes",description:"Lista de ingredientes disponibles con cantidades",icon:e.jsx(Si,{className:"w-4 h-4"}),fields:[{id:"in-stock",label:"En stock",description:"Elementos que ya tienes disponibles"},{id:"low-stock",label:"Stock bajo",description:"Elementos que necesitas reponer pronto"},{id:"to-buy",label:"Pendientes de compra",description:"Elementos que planeas comprar"},{id:"excludeNonFood",label:"Excluir no comestibles",description:"Filtrar elementos de aseo y limpieza"},{id:"withQuantities",label:"Incluir cantidades",description:"Agregar cantidades específicas de cada ingrediente"},{id:"groupByStatus",label:"Agrupar por estado",description:"Organizar por en stock, stock bajo, pendiente"}],dataGenerator:(p,g)=>{const x=["aseo","otro","limpieza"];let b=n;p.includes("excludeNonFood")&&(b=b.filter(N=>{if(!N.category)return!0;const S=N.category.toLowerCase();return!x.some(E=>S.includes(E))}));const j=[];p.includes("in-stock")&&j.push("in-stock"),p.includes("low-stock")&&j.push("low-stock"),p.includes("to-buy")&&j.push("to-buy"),j.length>0&&(b=b.filter(N=>j.includes(N.status)));const v=p.includes("withQuantities");return p.includes("groupByStatus")?{ingredientes:b.reduce((S,E)=>{const k={"in-stock":"en_stock","low-stock":"stock_bajo","to-buy":"pendiente_compra"}[E.status]||E.status;S[k]||(S[k]=[]);const D=v?{name:E.name,quantity:E.stock}:{name:E.name};return S[k].push(D),S},{})}:{ingredientes:b.map(S=>v?{name:S.name,quantity:S.stock,status:S.status}:{name:S.name,status:S.status})}}},{id:"preparedMeals",label:"Comidas Preparadas",description:"Lista de comidas ya preparadas",icon:e.jsx(Go,{className:"w-4 h-4"}),dataGenerator:(p,g)=>({comidasPreparadas:r.map(x=>({name:x.name,...x.portions!==void 0&&{porciones:x.portions}}))})},{id:"mealPlan",label:"Plan de Comidas",description:"Plan de comidas con selector de rango",icon:e.jsx(ns,{className:"w-4 h-4"}),fields:[{id:"dateRange",label:"Rango de fechas",description:"Selecciona qué período exportar",type:"custom",component:e.jsxs(Nt,{value:((h=l.mealPlan)==null?void 0:h.dateRange)||"today",onValueChange:p=>m("mealPlan","dateRange",p),children:[e.jsx(xt,{className:"w-full",children:e.jsx(St,{placeholder:"Selecciona el rango"})}),e.jsxs(gt,{children:[e.jsxs(Pe,{value:"today",children:["Solo hoy (",at(new Date,"dd/MM/yyyy",{locale:kn}),")"]}),e.jsx(Pe,{value:"yesterday-today",children:"Ayer y hoy"}),e.jsx(Pe,{value:"current-week",children:"Semana actual"}),e.jsx(Pe,{value:"all",children:"Todo el plan"})]})]})}],dataGenerator:(p,g)=>{const x=(g==null?void 0:g.dateRange)||"today",b=new Date,j=at(b,"yyyy-MM-dd");let v={...o};switch(x){case"today":v={[j]:o[j]||{}};break;case"yesterday-today":const w=Vl(b,1),N=at(w,"yyyy-MM-dd");v={[N]:o[N]||{},[j]:o[j]||{}};break;case"current-week":const S=ar(b,{weekStartsOn:1}),E=ha(b,{weekStartsOn:1});v={};for(let T=new Date(S);T<=E;T.setDate(T.getDate()+1)){const k=at(T,"yyyy-MM-dd");o[k]&&(v[k]=o[k])}break;case"all":default:v=o;break}return{planComidas:v,rango:x,fechas:Object.keys(v).sort()}}},{id:"recipes",label:"Recetas",description:"Recetas disponibles con campos personalizables",icon:e.jsx(vc,{className:"w-4 h-4"}),fields:[{id:"allRecipes",label:"Todas las recetas",description:"Incluir todas las recetas (por defecto solo favoritas)"},{id:"name",label:"Nombre",description:"Nombre de la receta"},{id:"description",label:"Descripción",description:"Descripción de la receta"},{id:"ingredients",label:"Ingredientes",description:"Lista de ingredientes y cantidades"},{id:"instructions",label:"Pasos de preparación",description:"Instrucciones paso a paso"},{id:"prepTime",label:"Tiempo estimado",description:"Tiempo de preparación en minutos"},{id:"mealType",label:"Tipo de comida",description:"Categoría de la comida"},{id:"difficulty",label:"Dificultad",description:"Nivel de dificultad"},{id:"nutrition",label:"Información nutricional",description:"Calorías, proteínas, carbohidratos, grasas"}],dataGenerator:(p,g)=>{const x=p.includes("allRecipes"),j=(x?a:a.filter(v=>v.favorite===!0)).map(v=>{const w={};return p.length===0||p.length===1&&p[0]==="allRecipes"?{name:v.name,description:v.description,ingredients:v.ingredients,instructions:v.instructions,mealType:v.mealType,favorite:v.favorite}:(p.includes("name")&&(w.name=v.name),p.includes("description")&&v.description&&(w.description=v.description),p.includes("ingredients")&&(w.ingredients=v.ingredients),p.includes("instructions")&&(w.instructions=v.instructions),p.includes("prepTime")&&v.prepTime&&(w.prepTime=v.prepTime),p.includes("mealType")&&(w.mealType=v.mealType),p.includes("difficulty")&&v.difficulty&&(w.difficulty=v.difficulty),p.includes("nutrition")&&(w.nutrition=v.nutrition),w)});return{recetas:j,total:j.length,tipo:x?"todas":"favoritas"}}}]};return e.jsx(tx,{open:t,onOpenChange:s,config:u,customFieldValues:l,onCustomFieldChange:m})},qF=({selectedDate:t})=>{const{user:s}=qe(),{toast:n}=Yu(),a=jn(),[r,o]=f.useState(!1),[l,c]=f.useState(!1),{mealPlan:m,status:u,error:h,addMeal:p,removeMeal:g,importMealPlan:x,resync:b}=VS(),{isOnline:j}=Va();if(al(),Ku(),ex(),!s)return e.jsx(Ne,{className:"w-full h-full",children:e.jsx(De,{className:"p-4 text-center",children:e.jsx("p",{children:"Inicia sesión para planificar tus comidas"})})});const v=async(...E)=>{try{await p(...E)}catch(T){console.error("Error adding meal:",T),n({title:"Error al Agregar",description:"No se pudo agregar la comida.",variant:"destructive"})}},w=async(...E)=>{try{await g(...E)}catch(T){console.error("Error removing meal:",T),n({title:"Error al Eliminar",description:"No se pudo eliminar la comida.",variant:"destructive"})}},N=async(...E)=>{try{await x(...E),n({title:"Importación Exitosa",description:"El plan de comidas se ha importado correctamente."}),o(!1)}catch(T){console.error("Error importing meal plan:",T),n({title:"Error al Importar",description:"No se pudo importar el plan de comidas.",variant:"destructive"})}},S=()=>{c(!0)};return e.jsxs("div",{className:"w-full h-full flex flex-col",children:[e.jsxs(Ju,{title:"Plan de Comidas",children:[e.jsx(xa,{children:e.jsxs("div",{className:"hidden md:flex items-center gap-2",children:[e.jsxs(Ms,{children:[e.jsx(Is,{asChild:!0,children:e.jsxs(z,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>o(!0),children:[e.jsx(Qi,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Importar Plan"})]})}),e.jsx(ks,{children:e.jsx("p",{children:"Importar Plan"})})]}),e.jsxs(Ms,{children:[e.jsx(Is,{asChild:!0,children:e.jsxs(z,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:S,children:[e.jsx(ta,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Exportar"})]})}),e.jsx(ks,{children:e.jsx("p",{children:"Exportar"})})]})]})}),e.jsxs(Ba,{children:[e.jsx(Ha,{asChild:!0,children:e.jsxs(z,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 md:hidden",children:[e.jsx(Nc,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Opciones"})]})}),e.jsxs(pa,{align:"end",children:[e.jsxs(Lt,{onClick:()=>o(!0),children:[e.jsx(Qi,{className:"mr-2 h-4 w-4"}),"Importar Plan"]}),e.jsxs(Lt,{onClick:S,children:[e.jsx(ta,{className:"mr-2 h-4 w-4"}),"Exportar"]}),e.jsx(el,{}),a.pathname!=="/meal"&&e.jsx(Lt,{asChild:!0,children:e.jsxs(un,{to:"/meal",className:"flex items-center",children:[e.jsx(ns,{className:"mr-2 h-4 w-4"}),"Plan de Comidas"]})}),a.pathname!=="/shopping-list"&&e.jsx(Lt,{asChild:!0,children:e.jsxs(un,{to:"/shopping-list",className:"flex items-center",children:[e.jsx(ir,{className:"mr-2 h-4 w-4"}),"Lista de Compras"]})}),a.pathname!=="/recipes"&&e.jsx(Lt,{asChild:!0,children:e.jsxs(un,{to:"/recipes",className:"flex items-center",children:[e.jsx(Go,{className:"mr-2 h-4 w-4"}),"Recetas"]})}),a.pathname!=="/prepared-meals"&&e.jsx(Lt,{asChild:!0,children:e.jsxs(un,{to:"/prepared-meals",className:"flex items-center",children:[e.jsx(Si,{className:"mr-2 h-4 w-4"}),"Comidas Preparadas"]})})]})]})]}),e.jsxs("div",{className:"flex-1 bg-gray-50 overflow-hidden",children:[e.jsx(BF,{mealPlan:m,onAddMeal:v,onRemoveMeal:w,disabled:u==="saving"||!j,selectedDate:t}),h&&e.jsxs(Zo,{variant:"destructive",className:"m-4",children:[e.jsx(yc,{className:"h-4 w-4"}),e.jsx(Qo,{className:"text-sm",children:h})]})]}),e.jsx(Rt,{open:r,onOpenChange:o,children:e.jsxs(Ct,{className:"sm:max-w-md",children:[e.jsx(_t,{children:e.jsx(Pt,{children:"Importar Plan de Comidas"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Puedes importar un plan de comidas desde un archivo JSON o pegando el contenido directamente."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(HF,{onImport:N,disabled:u==="saving"||!j}),e.jsx(WF,{onImport:N,disabled:u==="saving"||!j})]})]})]})}),e.jsx(GF,{open:l,onOpenChange:c}),e.jsxs("div",{className:"flex justify-center items-center gap-2 text-xs p-2 border-t bg-white",children:[u==="saving"&&e.jsx("span",{className:"text-blue-500",children:"Guardando..."}),u==="pending"&&e.jsx("span",{className:"text-yellow-600",children:"Pendiente de sincronizar"}),u==="saved"&&e.jsx("span",{className:"text-green-600",children:"Sincronizado"}),u==="error"&&e.jsx("span",{className:"text-red-600",children:"Error de sincronización"}),!j&&e.jsx("span",{className:"text-orange-600",children:"Offline"}),e.jsx(z,{onClick:b,variant:"link",className:"p-0 h-auto",children:"Reintentar"})]})]})},YF=()=>e.jsx(Xs,{noPadding:!0,className:"h-full",children:e.jsx(qF,{selectedDate:new Date})});var GS="Toggle",sx=f.forwardRef((t,s)=>{const{pressed:n,defaultPressed:a,onPressedChange:r,...o}=t,[l,c]=$r({prop:n,onChange:r,defaultProp:a??!1,caller:GS});return e.jsx(At.button,{type:"button","aria-pressed":l,"data-state":l?"on":"off","data-disabled":t.disabled?"":void 0,...o,ref:s,onClick:nt(t.onClick,()=>{t.disabled||c(!l)})})});sx.displayName=GS;var qS=sx,Ri="ToggleGroup",[YS,lW]=Br(Ri,[ju]),KS=ju(),nx=Z.forwardRef((t,s)=>{const{type:n,...a}=t;if(n==="single"){const r=a;return e.jsx(KF,{...r,ref:s})}if(n==="multiple"){const r=a;return e.jsx(JF,{...r,ref:s})}throw new Error(`Missing prop \`type\` expected on \`${Ri}\``)});nx.displayName=Ri;var[JS,XS]=YS(Ri),KF=Z.forwardRef((t,s)=>{const{value:n,defaultValue:a,onValueChange:r=()=>{},...o}=t,[l,c]=$r({prop:n,defaultProp:a??"",onChange:r,caller:Ri});return e.jsx(JS,{scope:t.__scopeToggleGroup,type:"single",value:Z.useMemo(()=>l?[l]:[],[l]),onItemActivate:c,onItemDeactivate:Z.useCallback(()=>c(""),[c]),children:e.jsx(ZS,{...o,ref:s})})}),JF=Z.forwardRef((t,s)=>{const{value:n,defaultValue:a,onValueChange:r=()=>{},...o}=t,[l,c]=$r({prop:n,defaultProp:a??[],onChange:r,caller:Ri}),m=Z.useCallback(h=>c((p=[])=>[...p,h]),[c]),u=Z.useCallback(h=>c((p=[])=>p.filter(g=>g!==h)),[c]);return e.jsx(JS,{scope:t.__scopeToggleGroup,type:"multiple",value:l,onItemActivate:m,onItemDeactivate:u,children:e.jsx(ZS,{...o,ref:s})})});nx.displayName=Ri;var[XF,ZF]=YS(Ri),ZS=Z.forwardRef((t,s)=>{const{__scopeToggleGroup:n,disabled:a=!1,rovingFocus:r=!0,orientation:o,dir:l,loop:c=!0,...m}=t,u=KS(n),h=bu(l),p={role:"group",dir:h,...m};return e.jsx(XF,{scope:n,rovingFocus:r,disabled:a,children:r?e.jsx(qy,{asChild:!0,...u,orientation:o,dir:h,loop:c,children:e.jsx(At.div,{...p,ref:s})}):e.jsx(At.div,{...p,ref:s})})}),mu="ToggleGroupItem",QS=Z.forwardRef((t,s)=>{const n=XS(mu,t.__scopeToggleGroup),a=ZF(mu,t.__scopeToggleGroup),r=KS(t.__scopeToggleGroup),o=n.value.includes(t.value),l=a.disabled||t.disabled,c={...t,pressed:o,disabled:l},m=Z.useRef(null);return a.rovingFocus?e.jsx(Yy,{asChild:!0,...r,focusable:!l,active:o,ref:m,children:e.jsx(fy,{...c,ref:s})}):e.jsx(fy,{...c,ref:s})});QS.displayName=mu;var fy=Z.forwardRef((t,s)=>{const{__scopeToggleGroup:n,value:a,...r}=t,o=XS(mu,n),l={role:"radio","aria-checked":t.pressed,"aria-pressed":void 0},c=o.type==="single"?l:void 0;return e.jsx(sx,{...c,...r,ref:s,onPressedChange:m=>{m?o.onItemActivate(a):o.onItemDeactivate(a)}})}),eC=nx,tC=QS;const sC=Wo("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-3",sm:"h-9 px-2.5",lg:"h-11 px-5"}},defaultVariants:{variant:"default",size:"default"}}),QF=f.forwardRef(({className:t,variant:s,size:n,...a},r)=>e.jsx(qS,{ref:r,className:ce(sC({variant:s,size:n,className:t})),...a}));QF.displayName=qS.displayName;const nC=f.createContext({size:"default",variant:"default"}),aC=f.forwardRef(({className:t,variant:s,size:n,children:a,...r},o)=>e.jsx(eC,{ref:o,className:ce("flex items-center justify-center gap-1",t),...r,children:e.jsx(nC.Provider,{value:{variant:s,size:n},children:a})}));aC.displayName=eC.displayName;const Af=f.forwardRef(({className:t,children:s,variant:n,size:a,...r},o)=>{const l=f.useContext(nC);return e.jsx(tC,{ref:o,className:ce(sC({variant:l.variant||n,size:l.size||a}),t),...r,children:s})});Af.displayName=tC.displayName;const eB=({open:t,onOpenChange:s})=>{const{items:n}=al(),a={title:"Exportar Lista de Compras",modules:[{id:"shoppingList",label:"Lista de Compras",description:"Elementos de la lista con opciones de formato",icon:e.jsx(ir,{className:"w-4 h-4"}),fields:[{id:"in-stock",label:"En stock",description:"Elementos que ya tienes disponibles"},{id:"low-stock",label:"Stock bajo",description:"Elementos que necesitas reponer pronto"},{id:"to-buy",label:"Pendientes de compra",description:"Elementos que planeas comprar"},{id:"nextPurchase",label:"Solo próximas compras",description:"Filtrar solo elementos marcados para próxima compra"},{id:"excludeCategories",label:"Excluir no comestibles",description:"Filtrar elementos de aseo y otros no comestibles"},{id:"withQuantities",label:"Incluir cantidades",description:"Agregar información de cantidades"},{id:"withPrices",label:"Incluir precios",description:"Agregar información de precios cuando esté disponible"},{id:"withDates",label:"Incluir fechas de consumo",description:"Agregar fechas de consumo preferente"},{id:"withPlaces",label:"Incluir lugares de compra",description:"Agregar información de dónde comprar"},{id:"byStatus",label:"Agrupar por estado",description:"Organizar elementos por estado (en stock, stock bajo, pendiente)"},{id:"byCategory",label:"Agrupar por categoría",description:"Organizar elementos por categorías"}],dataGenerator:(r,o)=>{let l=[...n];if(r.includes("excludeCategories")){const u=["aseo","otro","limpieza"];l=l.filter(h=>{if(!h.category)return!0;const p=h.category.toLowerCase();return!u.some(g=>p.includes(g))})}r.includes("nextPurchase")&&(l=l.filter(u=>u.nextPurchase===!0));const c=[];r.includes("in-stock")&&c.push("in-stock"),r.includes("low-stock")&&c.push("low-stock"),r.includes("to-buy")&&c.push("to-buy"),c.length>0&&(l=l.filter(u=>c.includes(u.status)));const m=u=>{const h={name:u.name};return r.includes("withQuantities")&&(h.quantity=u.stock),r.includes("withPrices")&&u.price&&(h.price=u.price),r.includes("withDates")&&u.consumeBy&&(h.consumeBy=u.consumeBy),r.includes("withPlaces")&&u.place&&(h.place=u.place),h};if(r.includes("byStatus")&&r.includes("byCategory"))return{listaCompras:l.reduce((h,p)=>{const x={"in-stock":"en_stock","low-stock":"stock_bajo","to-buy":"pendiente_compra"}[p.status]||p.status,b=p.category||"sin_categoria";return h[x]||(h[x]={}),h[x][b]||(h[x][b]=[]),h[x][b].push(m(p)),h},{})};if(r.includes("byStatus")){const u={"in-stock":"en_stock","low-stock":"stock_bajo","to-buy":"pendiente_compra"};return{listaCompras:l.reduce((p,g)=>{const x=u[g.status]||g.status;return p[x]||(p[x]=[]),p[x].push(m(g)),p},{})}}else return r.includes("byCategory")?{listaCompras:l.reduce((h,p)=>{const g=p.category||"sin_categoria";return h[g]||(h[g]=[]),h[g].push(m(p)),h},{})}:{listaCompras:l.map(m),total:l.length}}}]};return e.jsx(tx,{open:t,onOpenChange:s,config:a})},rC=[{value:"Aseo y Limpieza",emoji:"🧹"},{value:"Bebidas",emoji:"🥤"},{value:"Carnes y Pescados",emoji:"🥩"},{value:"Cereales y Granos",emoji:"🌾"},{value:"Condimentos y Especias",emoji:"🧂"},{value:"Congelados",emoji:"❄️"},{value:"Cuidado Personal",emoji:"🧴"},{value:"Enlatados y Conservas",emoji:"🥫"},{value:"Frutas y Verduras",emoji:"🍎"},{value:"Lácteos y Huevos",emoji:"🥛"},{value:"Panadería",emoji:"🍞"},{value:"Snacks y Dulces",emoji:"🍪"},{value:"Mascotas",emoji:"🐶"},{value:"Otro",emoji:"📦"}],tB=rC.reduce((t,s)=>(t[s.value]=s.emoji,t),{}),sB=rC.map(t=>t.value),xc=t=>{if(!t)return"";const s=tB[t];return s?`${s} ${t}`:t},nB=["Éxito","D1","Ara","Dollarcity","Olimpica (SAO)","Jumbo","Plaza de mercado","Panadería","Droguería","Otro"],aB=({open:t,onOpenChange:s,onSave:n,onDelete:a,item:r})=>{const[o,l]=f.useState(""),[c,m]=f.useState(1),[u,h]=f.useState(0),[p,g]=f.useState(""),[x,b]=f.useState(""),[j,v]=f.useState(""),[w,N]=f.useState(""),[S,E]=f.useState("to-buy");f.useEffect(()=>{r?(l(r.name),m(r.stock),h(r.toBuy),g(r.price?String(r.price):""),b(r.category||""),v(r.place||""),N(r.consumeBy||""),E(r.status)):(l(""),m(1),h(0),g(""),b(""),v(""),N(""),E("to-buy"))},[r,t]),f.useEffect(()=>{S==="to-buy"&&N("")},[S]);const T=()=>{const k={stock:Number(c),toBuy:Number(u),status:S};p&&p.trim()!==""&&(k.price=Number(p)),x&&x.trim()!==""&&(k.category=x),j&&j.trim()!==""&&(k.place=j),S!=="to-buy"&&w&&w.trim()!==""&&(k.consumeBy=w),r?n({...k,name:o},r.id):o.split(`
`).map(P=>P.trim()).filter(Boolean).forEach(P=>n({...k,name:P})),s(!1)};return e.jsx(Rt,{open:t,onOpenChange:s,children:e.jsxs(Ct,{className:"sm:max-w-md",children:[e.jsx(_t,{children:e.jsxs(Pt,{children:[r?"Editar":"Agregar"," Ítem"]})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs(Fe,{htmlFor:"names",children:["Nombre",r?"":"s"]}),r?e.jsx(Be,{id:"names",value:o,onChange:k=>l(k.target.value)}):e.jsx(kt,{id:"names",value:o,onChange:k=>l(k.target.value),placeholder:"Un producto por línea",className:"min-h-[120px]"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(Fe,{htmlFor:"stock",children:"Stock"}),e.jsx(Be,{id:"stock",type:"number",value:c,onChange:k=>m(Number(k.target.value))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Fe,{htmlFor:"toBuy",children:"A Comprar"}),e.jsx(Be,{id:"toBuy",type:"number",value:u,onChange:k=>h(Number(k.target.value))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Fe,{htmlFor:"price",children:"Precio"}),e.jsx(Be,{id:"price",type:"number",value:p,onChange:k=>g(k.target.value)})]})]}),"          ",e.jsxs("div",{className:"space-y-1",children:[e.jsx(Fe,{htmlFor:"category",children:"Categoría"}),e.jsxs(Nt,{value:x,onValueChange:b,children:[e.jsx(xt,{id:"category",children:e.jsx(St,{placeholder:"Seleccionar categoría"})}),e.jsx(gt,{children:sB.map(k=>e.jsx(Pe,{value:k,children:xc(k)},k))})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Fe,{htmlFor:"place",children:"Lugar de compra"}),e.jsxs(Nt,{value:j,onValueChange:v,children:[e.jsx(xt,{id:"place",children:e.jsx(St,{placeholder:"Seleccionar lugar"})}),e.jsx(gt,{children:nB.map(k=>e.jsx(Pe,{value:k,children:k},k))})]})]}),S!=="to-buy"&&e.jsxs("div",{className:"space-y-1",children:[e.jsx(Fe,{htmlFor:"consumeBy",children:"Consumir antes de"}),e.jsx(Be,{id:"consumeBy",type:"date",value:w,onChange:k=>N(k.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Fe,{htmlFor:"status",children:"Estado"}),e.jsxs(Nt,{value:S,onValueChange:k=>E(k),children:[e.jsx(xt,{id:"status",children:e.jsx(St,{})}),e.jsxs(gt,{children:[e.jsx(Pe,{value:"in-stock",children:"En Stock"}),e.jsx(Pe,{value:"to-buy",children:"Por Comprar"}),e.jsx(Pe,{value:"low-stock",children:"Poco Stock"})]})]})]})]}),e.jsxs(wn,{className:"flex justify-between",children:[r&&a?e.jsx(z,{variant:"destructive",onClick:()=>{a(r.id),s(!1)},children:"Eliminar"}):e.jsx("span",{}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{variant:"outline",onClick:()=>s(!1),children:"Cancelar"}),e.jsx(z,{onClick:T,children:"Guardar"})]})]})]})})},rB=MA,iB=IA,oB=OA,iC=({query:t,onQueryChange:s,sort:n,onSortChange:a,placeFilter:r,onPlaceFilterChange:o,statusFilter:l,onStatusFilterChange:c,categoryFilter:m,onCategoryFilterChange:u,onlyToBuy:h,onOnlyToBuyChange:p,nextOnly:g,onNextOnlyChange:x,expireSoonOnly:b,onExpireSoonOnlyChange:j,noPriceOnly:v=!1,onNoPriceOnlyChange:w,places:N,categories:S,filtersOpen:E,setFiltersOpen:T,isMobile:k})=>e.jsxs(rB,{open:!k||E,onOpenChange:T,children:[e.jsxs("div",{className:"flex gap-2 items-start",children:[e.jsx(Be,{placeholder:"Buscar",value:t,onChange:D=>s(D.target.value),className:"flex-1 sm:w-60"}),k&&e.jsx(iB,{asChild:!0,children:e.jsx(z,{variant:"outline",size:"icon",children:e.jsx(Cu,{className:"w-4 h-4"})})})]}),e.jsx(oB,{className:"mt-2",children:e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsxs(Nt,{value:n,onValueChange:D=>a(D),children:[e.jsx(xt,{className:"w-36",children:e.jsx(St,{placeholder:"Ordenar"})}),e.jsxs(gt,{children:[e.jsx(Pe,{value:"az",children:"Nombre A-Z"}),e.jsx(Pe,{value:"za",children:"Nombre Z-A"}),e.jsx(Pe,{value:"category",children:"Categoría"})]})]}),e.jsxs(Nt,{value:r||"all",onValueChange:D=>o(D==="all"?"":D),children:[e.jsx(xt,{className:"w-36",children:e.jsx(St,{placeholder:"Lugar"})}),e.jsxs(gt,{children:[e.jsx(Pe,{value:"all",children:"Todos los lugares"}),N.map(D=>e.jsx(Pe,{value:D,children:D},D))]})]}),e.jsxs(Nt,{value:l||"all",onValueChange:D=>c(D==="all"?"":D),children:[e.jsx(xt,{className:"w-36",children:e.jsx(St,{placeholder:"Estado"})}),e.jsxs(gt,{children:[e.jsx(Pe,{value:"all",children:"Todos"}),e.jsx(Pe,{value:"to-buy",children:"Por Comprar"}),e.jsx(Pe,{value:"in-stock",children:"En Stock"}),e.jsx(Pe,{value:"low-stock",children:"Poco Stock"})]})]}),e.jsxs(Nt,{value:m||"all",onValueChange:D=>u(D==="all"?"":D),children:[e.jsx(xt,{className:"w-44",children:e.jsx(St,{placeholder:"Categoría"})}),e.jsxs(gt,{children:[e.jsx(Pe,{value:"all",children:"Todas"}),w&&e.jsx(Pe,{value:"__empty",children:"Sin categoría"}),S.map(D=>e.jsx(Pe,{value:D,children:xc(D)},D))]})]}),w&&e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx(As,{checked:v,onCheckedChange:D=>w(!!D)}),"Sin precio"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx(As,{checked:h,onCheckedChange:D=>p(!!D)}),e.jsx(ir,{className:"w-4 h-4"}),"Lista activa"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx(As,{checked:g,onCheckedChange:D=>x(!!D)}),"Próxima compra"]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx(As,{checked:b,onCheckedChange:D=>j(!!D)}),"Próximos a vencer"]})]})})]}),py=[{key:"to-buy",title:"Por Comprar"},{key:"low-stock",title:"Poco Stock"},{key:"in-stock",title:"En Stock"}],xy={"to-buy":ir,"low-stock":jb,"in-stock":ro},lB=({items:t,onMove:s,onView:n,onToggleNext:a,onUpdateQuantity:r})=>{const[o,l]=f.useState(""),[c,m]=f.useState("az"),[u,h]=f.useState(""),[p,g]=f.useState(""),[x,b]=f.useState(""),[j,v]=f.useState(!1),[w,N]=f.useState(!1),[S,E]=f.useState(!1),[T,k]=f.useState(!1),{isMobile:D}=Sc(),P=f.useMemo(()=>Array.from(new Set(t.map(W=>W.place).filter(Boolean))),[t]),_=f.useMemo(()=>Array.from(new Set(t.map(W=>W.category).filter(Boolean))),[t]),B=f.useMemo(()=>{let W=t.filter(L=>L.name.toLowerCase().includes(o.toLowerCase()));if(u&&(W=W.filter(L=>L.place===u)),p&&(W=W.filter(L=>L.status===p)),x&&(W=W.filter(L=>L.category===x)),j&&(W=W.filter(L=>L.status==="to-buy")),S&&(W=W.filter(L=>L.nextPurchase)),w){const L=es(new Date,3);W=W.filter($=>{if(!$.consumeBy)return!1;const q=new Date($.consumeBy);return Ds(q,L)})}let H=[...W];switch(c){case"az":H.sort((L,$)=>L.name.localeCompare($.name));break;case"za":H.sort((L,$)=>$.name.localeCompare(L.name));break;case"category":H.sort((L,$)=>(L.category||"").localeCompare($.category||""));break}return H},[t,o,u,p,x,j,S,w,c]),I=f.useMemo(()=>{const W={"to-buy":0,"low-stock":0,"in-stock":0};return B.forEach(H=>{H.price!==void 0&&(W[H.status]+=H.price*H.toBuy)}),W},[B]),R=f.useMemo(()=>new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP"}),[]),M=({stockValue:W,toBuyValue:H,onStockIncrease:L,onStockDecrease:$,onToBuyIncrease:q,onToBuyDecrease:re})=>e.jsx("div",{className:"flex items-center justify-between text-xs",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-gray-600",children:"Stock:"}),e.jsx(z,{variant:"ghost",size:"sm",className:"h-4 w-4 p-0 text-gray-500 hover:text-gray-700",onClick:Y=>{Y.stopPropagation(),$()},children:e.jsx(_n,{className:"h-2.5 w-2.5"})}),e.jsx("span",{className:"font-medium min-w-[1rem] text-center",children:W}),e.jsx(z,{variant:"ghost",size:"sm",className:"h-4 w-4 p-0 text-gray-500 hover:text-gray-700",onClick:Y=>{Y.stopPropagation(),L()},children:e.jsx(Xi,{className:"h-2.5 w-2.5"})})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-gray-600",children:"Comprar:"}),e.jsx(z,{variant:"ghost",size:"sm",className:"h-4 w-4 p-0 text-gray-500 hover:text-gray-700",onClick:Y=>{Y.stopPropagation(),re()},children:e.jsx(_n,{className:"h-2.5 w-2.5"})}),e.jsx("span",{className:"font-medium min-w-[1rem] text-center",children:H}),e.jsx(z,{variant:"ghost",size:"sm",className:"h-4 w-4 p-0 text-gray-500 hover:text-gray-700",onClick:Y=>{Y.stopPropagation(),q()},children:e.jsx(Xi,{className:"h-2.5 w-2.5"})})]})]})});return e.jsx(xa,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-white p-4 rounded-lg border shadow-sm",children:e.jsx(iC,{query:o,onQueryChange:l,sort:c,onSortChange:m,placeFilter:u,onPlaceFilterChange:h,statusFilter:p,onStatusFilterChange:g,categoryFilter:x,onCategoryFilterChange:b,onlyToBuy:j,onOnlyToBuyChange:v,nextOnly:S,onNextOnlyChange:E,expireSoonOnly:w,onExpireSoonOnlyChange:N,places:P,categories:_,filtersOpen:T,setFiltersOpen:k,isMobile:D})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 lg:gap-8",children:py.map(W=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"font-semibold text-base text-gray-700 flex items-center gap-2",children:[Z.createElement(xy[W.key],{className:"w-4 h-4"}),W.title]}),e.jsx("span",{className:"text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded-full",children:B.filter(H=>H.status===W.key).length})]}),e.jsx("div",{className:"text-sm text-gray-600 font-medium",children:R.format(I[W.key])}),e.jsxs("div",{className:"space-y-2 h-full max-h-[calc(100vh-300px)] overflow-y-auto",children:[B.filter(H=>H.status===W.key).map(H=>{const L=es(new Date,3),$=H.consumeBy?new Date(H.consumeBy):null,q=$?Ds($,new Date):!1,re=$?Ds($,L):!1;return e.jsxs(Ne,{className:`cursor-pointer transition-all duration-200 hover:shadow-md border-l-4 ${W.key==="in-stock"?"border-l-green-500 hover:border-l-green-600":W.key==="low-stock"?"border-l-yellow-500 hover:border-l-yellow-600":"border-l-blue-500 hover:border-l-blue-600"} ${re||q?"border-red-500 bg-red-50/30":""} ${q?"bg-red-50/50":""}`,onClick:()=>n(H),children:[e.jsxs(De,{className:"p-2 pb-1 md:p-2 md:pb-1",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[e.jsx("span",{className:"font-medium text-sm leading-tight",children:H.name}),H.category&&e.jsx("span",{className:"bg-gray-100 text-gray-700 px-1 py-0.5 rounded text-xs whitespace-nowrap",children:xc(H.category)})]}),e.jsx("div",{className:"mb-2",children:e.jsx(M,{stockValue:H.stock,toBuyValue:H.toBuy,onStockIncrease:()=>r(H.id,"stock",H.stock+1),onStockDecrease:()=>r(H.id,"stock",Math.max(0,H.stock-1)),onToBuyIncrease:()=>r(H.id,"toBuy",H.toBuy+1),onToBuyDecrease:()=>r(H.id,"toBuy",Math.max(0,H.toBuy-1))})}),H.consumeBy&&e.jsxs("div",{className:`text-xs mt-1 text-center ${q?"text-red-600 font-medium":re?"text-orange-600":"text-gray-500"}`,children:[q?"⚠️ Vencido":re?"⏰ Por vencer":"Hasta"," ",H.consumeBy]})]}),e.jsx(bn,{className:"bg-gray-50/70 border-t border-gray-100 p-0 md:p-0",children:e.jsxs("div",{className:"flex justify-center gap-1 w-full px-2 py-2",children:[py.filter(Y=>Y.key!==W.key).map(Y=>{const se=xy[Y.key],ie=Y.key==="in-stock"?"text-green-600 hover:bg-green-50":Y.key==="low-stock"?"text-yellow-600 hover:bg-yellow-50":"text-blue-600 hover:bg-blue-50";return e.jsxs(Ms,{children:[e.jsx(Is,{asChild:!0,children:e.jsx(z,{variant:"ghost",size:"sm",className:`h-8 w-8 p-0 ${ie}`,onClick:U=>{U.stopPropagation(),s(H.id,Y.key)},children:e.jsx(se,{className:"w-4 h-4"})})}),e.jsxs(ks,{children:["Mover a ",Y.title]})]},Y.key)}),e.jsxs(Ms,{children:[e.jsx(Is,{asChild:!0,children:e.jsx(z,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-gray-600 hover:bg-gray-50",onClick:Y=>{Y.stopPropagation(),n(H)},children:e.jsx(ac,{className:"w-4 h-4"})})}),e.jsx(ks,{children:"Ver detalles"})]}),e.jsxs(Ms,{children:[e.jsx(Is,{asChild:!0,children:e.jsx(z,{variant:"ghost",size:"sm",className:`h-8 w-8 p-0 ${H.nextPurchase?"text-yellow-600 hover:bg-yellow-50":"text-gray-600 hover:bg-gray-50"}`,onClick:Y=>{Y.stopPropagation(),a(H)},children:e.jsx(Eb,{className:"w-4 h-4",...H.nextPurchase&&{fill:"currentColor"}})})}),e.jsx(ks,{children:H.nextPurchase?"Quitar de próxima compra":"Marcar próxima compra"})]})]})})]},H.id)}),B.filter(H=>H.status===W.key).length===0&&e.jsx("div",{className:"text-center py-8 text-gray-400 border-2 border-dashed border-gray-200 rounded-lg",children:e.jsx("div",{className:"text-sm",children:"Sin elementos"})})]})]},W.key))})]})})},cB=({items:t,onEdit:s,onDelete:n,onUpdate:a})=>{const[r,o]=f.useState(""),[l,c]=f.useState("az"),[m,u]=f.useState(""),[h,p]=f.useState(""),[g,x]=f.useState(""),[b,j]=f.useState(!1),[v,w]=f.useState(!1),[N,S]=f.useState(!1),[E,T]=f.useState(!1),[k,D]=f.useState(!1),{isMobile:P}=Sc(),_=f.useMemo(()=>Array.from(new Set(t.map(L=>L.place).filter(Boolean))),[t]),B=f.useMemo(()=>Array.from(new Set(t.map(L=>L.category).filter(Boolean))),[t]),I=f.useMemo(()=>{let L=t.filter(q=>q.name.toLowerCase().includes(r.toLowerCase()));if(m&&(L=L.filter(q=>q.place===m)),h&&(L=L.filter(q=>q.status===h)),g&&(g==="__empty"?L=L.filter(q=>!q.category):L=L.filter(q=>q.category===g)),N&&(L=L.filter(q=>q.price===void 0)),b&&(L=L.filter(q=>q.status==="to-buy")),v&&(L=L.filter(q=>q.nextPurchase)),E){const q=es(new Date,3);L=L.filter(re=>{if(!re.consumeBy)return!1;const Y=new Date(re.consumeBy);return Ds(Y,q)})}let $=[...L];switch(l){case"az":$.sort((q,re)=>q.name.localeCompare(re.name));break;case"za":$.sort((q,re)=>re.name.localeCompare(q.name));break;case"category":$.sort((q,re)=>(q.category||"").localeCompare(re.category||""));break}return $},[t,r,m,h,g,N,b,v,E,l]),R=f.useMemo(()=>I.reduce((L,$)=>$.status==="to-buy"&&$.price!==void 0?L+$.price*$.stock:L,0),[I]),M=L=>{switch(L){case"in-stock":return"default";case"low-stock":return"secondary";case"to-buy":return"destructive";default:return"outline"}},W=L=>{switch(L){case"in-stock":return"En Stock";case"low-stock":return"Poco Stock";case"to-buy":return"Por Comprar";default:return L}},H=L=>{const $=L.stock-1;$===0?a(L.id,{stock:1,status:"to-buy"}):$>0&&a(L.id,{stock:$})};return e.jsxs("div",{className:"space-y-4",children:[e.jsx(iC,{query:r,onQueryChange:o,sort:l,onSortChange:c,placeFilter:m,onPlaceFilterChange:u,statusFilter:h,onStatusFilterChange:p,categoryFilter:g,onCategoryFilterChange:x,onlyToBuy:b,onOnlyToBuyChange:j,nextOnly:v,onNextOnlyChange:w,expireSoonOnly:E,onExpireSoonOnlyChange:T,noPriceOnly:N,onNoPriceOnlyChange:S,places:_,categories:B,filtersOpen:k,setFiltersOpen:D,isMobile:P}),e.jsxs("div",{className:"text-right font-medium",children:["Total pendiente: ",new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP"}).format(R)]}),I.length===0?e.jsx(Ne,{className:"p-6 text-center",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx(Si,{className:"h-12 w-12 text-gray-400"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-600",children:"No hay productos"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"No se encontraron productos con los filtros aplicados"})]})]})}):e.jsx(Ne,{children:e.jsxs(De,{className:"p-0",children:[e.jsxs("div",{className:"hidden md:grid grid-cols-12 gap-4 p-4 bg-gray-50 border-b text-sm font-medium text-gray-700",children:[e.jsx("div",{className:"col-span-3",children:"Producto"}),e.jsx("div",{className:"col-span-2 text-center",children:"Categoría"}),e.jsx("div",{className:"col-span-2 text-center",children:"Estado"}),e.jsx("div",{className:"col-span-2 text-center",children:"Cantidad"}),e.jsx("div",{className:"col-span-2 text-center",children:"Precio"}),e.jsx("div",{className:"col-span-1 text-center",children:"Acciones"})]}),e.jsx("div",{className:"divide-y divide-gray-100",children:I.map((L,$)=>e.jsxs("div",{className:`hover:bg-gray-50 transition-colors ${$%2===0?"bg-white":"bg-gray-50/50"}`,children:[e.jsx("div",{className:"md:hidden p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:L.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(Ht,{variant:M(L.status),className:"text-xs",children:W(L.status)}),L.category&&e.jsx(Ht,{variant:"outline",className:"text-xs",children:xc(L.category)})]})]}),e.jsx("div",{className:"text-sm font-medium text-gray-900",children:L.price!==void 0&&e.jsx("span",{className:"text-green-600",children:new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP"}).format(L.price)})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Si,{className:"h-3 w-3"}),L.stock]}),L.place&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(L0,{className:"h-3 w-3"}),L.place]}),L.consumeBy&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ns,{className:"h-3 w-3"}),L.consumeBy]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(z,{variant:"ghost",size:"sm",onClick:()=>a(L.id,{stock:L.stock+1}),className:"h-6 w-6 p-0",children:e.jsx(Xi,{className:"h-3 w-3"})}),e.jsx("span",{className:"text-xs min-w-[1.5rem] text-center",children:L.stock}),e.jsx(z,{variant:"ghost",size:"sm",onClick:()=>H(L),className:"h-6 w-6 p-0",children:e.jsx(_n,{className:"h-3 w-3"})}),e.jsx(z,{variant:"ghost",size:"sm",onClick:()=>s(L),className:"h-6 w-6 p-0 text-blue-600 ml-1",children:e.jsx(sa,{className:"h-3 w-3"})}),e.jsx(z,{variant:"ghost",size:"sm",onClick:()=>n(L.id),className:"h-6 w-6 p-0 text-red-600",children:e.jsx(Zi,{className:"h-3 w-3"})})]})]})]})}),e.jsxs("div",{className:"hidden md:grid grid-cols-12 gap-4 p-4",children:[e.jsx("div",{className:"col-span-3",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900",children:L.name}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[L.place&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(L0,{className:"h-3 w-3"}),L.place]}),L.consumeBy&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ns,{className:"h-3 w-3"}),L.consumeBy]})]})]})}),e.jsx("div",{className:"col-span-2 flex justify-center items-center",children:L.category?e.jsx(Ht,{variant:"outline",className:"text-xs",children:xc(L.category)}):e.jsx("span",{className:"text-xs text-gray-400",children:"Sin categoría"})}),e.jsx("div",{className:"col-span-2 flex justify-center items-center",children:e.jsx(Ht,{variant:M(L.status),className:"text-xs",children:W(L.status)})}),e.jsx("div",{className:"col-span-2 flex justify-center items-center",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{variant:"ghost",size:"sm",onClick:()=>H(L),className:"h-6 w-6 p-0",children:e.jsx(_n,{className:"h-3 w-3"})}),e.jsx("span",{className:"text-sm font-medium min-w-[2rem] text-center",children:L.stock}),e.jsx(z,{variant:"ghost",size:"sm",onClick:()=>a(L.id,{stock:L.stock+1}),className:"h-6 w-6 p-0",children:e.jsx(Xi,{className:"h-3 w-3"})})]})}),e.jsx("div",{className:"col-span-2 flex justify-center items-center",children:L.price!==void 0?e.jsx("span",{className:"text-sm font-medium text-green-600",children:new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP"}).format(L.price)}):e.jsx("span",{className:"text-xs text-gray-400",children:"Sin precio"})}),e.jsxs("div",{className:"col-span-1 flex justify-center items-center gap-1",children:[e.jsx(z,{variant:"ghost",size:"sm",onClick:()=>s(L),className:"h-7 w-7 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50",title:"Editar producto",children:e.jsx(sa,{className:"h-3 w-3"})}),e.jsx(z,{variant:"ghost",size:"sm",onClick:()=>n(L.id),className:"h-7 w-7 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",title:"Eliminar producto",children:e.jsx(Zi,{className:"h-3 w-3"})})]})]})]},L.id))})]})})]})},dB=()=>{const{items:t,addItem:s,updateItem:n,deleteItem:a,moveItem:r}=al(),[o,l]=f.useState(!1),c=jn(),m=Xt(),[u,h]=f.useState(null),[p,g]=f.useState("kanban"),[x,b]=f.useState(!1),j=(v,w)=>{w?n(w,v):s(v)};return e.jsxs("div",{className:"w-full h-full flex flex-col",children:[e.jsxs(Ju,{title:"Lista de Compras",children:[e.jsx(xa,{children:e.jsxs("div",{className:"hidden md:flex items-center gap-2",children:[e.jsxs(aC,{type:"single",value:p,onValueChange:v=>v&&g(v),children:[e.jsxs(Ms,{children:[e.jsx(Is,{asChild:!0,children:e.jsx(Af,{value:"kanban","aria-label":"Kanban",children:e.jsx(hb,{className:"w-4 h-4"})})}),e.jsx(ks,{children:e.jsx("p",{children:"Vista Kanban"})})]}),e.jsxs(Ms,{children:[e.jsx(Is,{asChild:!0,children:e.jsx(Af,{value:"list","aria-label":"Lista",children:e.jsx(AR,{className:"w-4 h-4"})})}),e.jsx(ks,{children:e.jsx("p",{children:"Vista Lista"})})]})]}),e.jsxs(Ms,{children:[e.jsx(Is,{asChild:!0,children:e.jsxs(z,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>l(!0),children:[e.jsx(as,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Agregar"})]})}),e.jsx(ks,{children:e.jsx("p",{children:"Agregar"})})]}),e.jsxs(Ms,{children:[e.jsx(Is,{asChild:!0,children:e.jsxs(z,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>b(!0),children:[e.jsx(ta,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Exportar"})]})}),e.jsx(ks,{children:e.jsx("p",{children:"Exportar"})})]}),e.jsxs(Ms,{children:[e.jsx(Is,{asChild:!0,children:e.jsxs(z,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>m("/shopping/run"),children:[e.jsx(yn,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Ir de compras"})]})}),e.jsx(ks,{children:e.jsx("p",{children:"Ir de compras"})})]})]})}),e.jsxs(Ba,{children:[e.jsx(Ha,{asChild:!0,children:e.jsxs(z,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 md:hidden",children:[e.jsx(Nc,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Opciones"})]})}),e.jsxs(pa,{align:"end",children:[e.jsxs(Lt,{onClick:()=>l(!0),children:[e.jsx(as,{className:"mr-2 h-4 w-4"}),"Agregar"]}),e.jsxs(Lt,{onClick:()=>b(!0),children:[e.jsx(ta,{className:"mr-2 h-4 w-4"}),"Exportar ingredientes"]}),e.jsxs(Lt,{onClick:()=>m("/shopping/run"),children:[e.jsx(yn,{className:"mr-2 h-4 w-4"}),"Ir de compras"]}),e.jsx(el,{}),c.pathname!=="/meal"&&e.jsx(Lt,{asChild:!0,children:e.jsxs(un,{to:"/meal",className:"flex items-center",children:[e.jsx(ns,{className:"mr-2 h-4 w-4"}),"Plan de Comidas"]})}),c.pathname!=="/shopping-list"&&e.jsx(Lt,{asChild:!0,children:e.jsxs(un,{to:"/shopping-list",className:"flex items-center",children:[e.jsx(ir,{className:"mr-2 h-4 w-4"}),"Lista de Compras"]})}),c.pathname!=="/recipes"&&e.jsx(Lt,{asChild:!0,children:e.jsxs(un,{to:"/recipes",className:"flex items-center",children:[e.jsx(Go,{className:"mr-2 h-4 w-4"}),"Recetas"]})}),c.pathname!=="/prepared-meals"&&e.jsx(Lt,{asChild:!0,children:e.jsxs(un,{to:"/prepared-meals",className:"flex items-center",children:[e.jsx(Si,{className:"mr-2 h-4 w-4"}),"Comidas Preparadas"]})})]})]})]}),e.jsx("div",{className:"flex-1 overflow-auto p-4 space-y-4",children:t.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("p",{className:"text-lg",children:"No hay elementos en tu lista"}),e.jsx("p",{className:"text-sm",children:'Haz clic en "Agregar" para comenzar'})]}):p==="kanban"?e.jsx(lB,{items:t,onMove:r,onView:h,onToggleNext:v=>n(v.id,{nextPurchase:!v.nextPurchase}),onUpdateQuantity:(v,w,N)=>{n(v,{[w]:N})}}):e.jsx(cB,{items:t,onEdit:h,onDelete:a,onUpdate:n})}),e.jsx(aB,{open:o||!!u,onOpenChange:()=>{l(!1),h(null)},onSave:j,onDelete:v=>a(v),item:u||void 0}),e.jsx(eB,{open:x,onOpenChange:b})]})},uB=()=>e.jsx(Xs,{noPadding:!0,className:"h-full",children:e.jsx(dB,{})}),mB=({open:t,onOpenChange:s,onSave:n,recipe:a})=>{const[r,o]=f.useState(""),[l,c]=f.useState(""),[m,u]=f.useState(""),[h,p]=f.useState(""),[g,x]=f.useState("fácil"),[b,j]=f.useState(""),[v,w]=f.useState(""),[N,S]=f.useState(""),[E,T]=f.useState(""),[k,D]=f.useState(""),[P,_]=f.useState("breakfast");f.useEffect(()=>{a?(o(a.name),c(a.description||""),u(a.ingredients.map(I=>`${I.quantity} ${I.name}`).join(`
`)),p(a.instructions),x(a.difficulty||"fácil"),j(a.prepTime!==void 0?String(a.prepTime):""),w(String(a.nutrition.calories)),S(String(a.nutrition.protein)),T(String(a.nutrition.carbs)),D(String(a.nutrition.fat)),_(a.mealType)):(o(""),c(""),u(""),p(""),x("fácil"),j(""),w(""),S(""),T(""),D(""),_("breakfast"))},[a,t]);const B=()=>{const I=m.split(`
`).map(M=>M.trim()).filter(Boolean).map(M=>{const[W,...H]=M.split(" ");return{quantity:W,name:H.join(" ")}}),R={name:r,ingredients:I,description:l.trim()||void 0,difficulty:g,prepTime:b?Number(b):void 0,instructions:h,nutrition:{calories:Number(v)||0,protein:Number(N)||0,carbs:Number(E)||0,fat:Number(k)||0},mealType:P};a?n(R,a.id):n(R),s(!1)};return e.jsx(Rt,{open:t,onOpenChange:s,children:e.jsxs(Ct,{className:"sm:max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsx(_t,{children:e.jsxs(Pt,{children:[a?"Editar":"Agregar"," Receta"]})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(Fe,{htmlFor:"name",children:"Nombre"}),e.jsx(Be,{id:"name",value:r,onChange:I=>o(I.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Fe,{htmlFor:"description",children:"Descripción (opcional)"}),e.jsx(kt,{id:"description",value:l,onChange:I=>c(I.target.value),className:"min-h-[80px]"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(Fe,{htmlFor:"difficulty",children:"Dificultad"}),e.jsxs(Nt,{value:g,onValueChange:I=>x(I),children:[e.jsx(xt,{id:"difficulty",children:e.jsx(St,{})}),e.jsxs(gt,{children:[e.jsx(Pe,{value:"fácil",children:"Fácil"}),e.jsx(Pe,{value:"media",children:"Media"}),e.jsx(Pe,{value:"difícil",children:"Difícil"})]})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Fe,{htmlFor:"prepTime",children:"Tiempo (min)"}),e.jsx(Be,{id:"prepTime",type:"number",value:b,onChange:I=>j(I.target.value)})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Fe,{htmlFor:"ingredients",children:"Ingredientes (uno por línea)"}),e.jsx(kt,{id:"ingredients",value:m,onChange:I=>u(I.target.value),className:"min-h-[120px]"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Fe,{htmlFor:"instructions",children:"Instrucciones"}),e.jsx(kt,{id:"instructions",value:h,onChange:I=>p(I.target.value),className:"min-h-[120px]"})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(Fe,{htmlFor:"calories",children:"Calorías"}),e.jsx(Be,{id:"calories",type:"number",value:v,onChange:I=>w(I.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Fe,{htmlFor:"protein",children:"Proteína (g)"}),e.jsx(Be,{id:"protein",type:"number",value:N,onChange:I=>S(I.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Fe,{htmlFor:"carbs",children:"Carbs (g)"}),e.jsx(Be,{id:"carbs",type:"number",value:E,onChange:I=>T(I.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Fe,{htmlFor:"fat",children:"Grasa (g)"}),e.jsx(Be,{id:"fat",type:"number",value:k,onChange:I=>D(I.target.value)})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Fe,{htmlFor:"mealType",children:"Tipo de comida"}),e.jsxs(Nt,{value:P,onValueChange:I=>_(I),children:[e.jsx(xt,{id:"mealType",children:e.jsx(St,{})}),e.jsx(gt,{children:Object.entries(dn).map(([I,R])=>e.jsx(Pe,{value:I,children:R.title},I))})]})]})]}),e.jsx(wn,{children:e.jsx(z,{onClick:B,children:"Guardar"})})]})})},hB=({open:t,onOpenChange:s})=>{const{recipes:n}=Ku(),a={title:"Exportar Recetas",modules:[{id:"recipes",label:"Recetas",description:"Recetas con campos y opciones personalizables",icon:e.jsx(vc,{className:"w-4 h-4"}),fields:[{id:"allRecipes",label:"Todas las recetas",description:"Incluir todas las recetas (por defecto solo favoritas)"},{id:"groupByMealType",label:"Agrupar por tipo de comida",description:"Organizar por desayuno, almuerzo, cena, etc."},{id:"groupByDifficulty",label:"Agrupar por dificultad",description:"Organizar por nivel de dificultad"},{id:"name",label:"Nombre",description:"Nombre de la receta"},{id:"description",label:"Descripción",description:"Descripción de la receta"},{id:"difficulty",label:"Dificultad",description:"Nivel de dificultad (fácil, media, difícil)"},{id:"prepTime",label:"Tiempo de preparación",description:"Tiempo estimado en minutos"},{id:"ingredients",label:"Ingredientes",description:"Lista de ingredientes con cantidades"},{id:"instructions",label:"Pasos de preparación",description:"Instrucciones detalladas"},{id:"nutrition",label:"Información nutricional",description:"Calorías, proteínas, carbohidratos, grasas"},{id:"mealType",label:"Tipo de comida",description:"Categoría de la comida"},{id:"favorite",label:"Estado favorito",description:"Si la receta está marcada como favorita"}],dataGenerator:(r,o)=>{const l=r.includes("allRecipes"),c=l?n:n.filter(u=>u.favorite===!0),m=u=>{const h={};return r.filter(g=>g!=="allRecipes"&&g!=="groupByMealType"&&g!=="groupByDifficulty").length===0?{name:u.name,description:u.description,difficulty:u.difficulty,prepTime:u.prepTime,ingredients:u.ingredients,instructions:u.instructions,nutrition:u.nutrition,mealType:u.mealType,favorite:u.favorite}:(r.includes("name")&&(h.name=u.name),r.includes("description")&&u.description&&(h.description=u.description),r.includes("difficulty")&&u.difficulty&&(h.difficulty=u.difficulty),r.includes("prepTime")&&u.prepTime&&(h.prepTime=u.prepTime),r.includes("ingredients")&&(h.ingredients=u.ingredients),r.includes("instructions")&&(h.instructions=u.instructions),r.includes("nutrition")&&(h.nutrition=u.nutrition),r.includes("mealType")&&(h.mealType=u.mealType),r.includes("favorite")&&(h.favorite=u.favorite),h)};return r.includes("groupByMealType")&&r.includes("groupByDifficulty")?{recetas:c.reduce((h,p)=>{const g=p.mealType,x=p.difficulty||"sin_especificar";return h[g]||(h[g]={}),h[g][x]||(h[g][x]=[]),h[g][x].push(m(p)),h},{})}:r.includes("groupByMealType")?{recetas:c.reduce((h,p)=>{const g=p.mealType;return h[g]||(h[g]=[]),h[g].push(m(p)),h},{})}:r.includes("groupByDifficulty")?{recetas:c.reduce((h,p)=>{const g=p.difficulty||"sin_especificar";return h[g]||(h[g]=[]),h[g].push(m(p)),h},{})}:{recetas:c.map(m),total:c.length,tipo:l?"todas":"favoritas",exportedAt:new Date().toISOString()}}}]};return e.jsx(tx,{open:t,onOpenChange:s,config:a})},gy=({recipes:t,iconOnly:s=!1,className:n})=>{const[a,r]=f.useState(!1),o=()=>{r(!0)};return e.jsxs(e.Fragment,{children:[s?e.jsxs(z,{variant:"ghost",size:"sm",className:`h-8 w-8 p-0 ${n}`,onClick:o,children:[e.jsx(ta,{className:"w-4 h-4"}),e.jsx("span",{className:"sr-only",children:"Exportar"})]}):e.jsxs(z,{variant:"outline",size:"sm",onClick:o,className:`flex items-center gap-2 ${n}`,children:[e.jsx(ta,{className:"w-4 h-4"}),"Exportar"]}),e.jsx(hB,{open:a,onOpenChange:r})]})},fB=()=>{const{recipes:t,addRecipe:s,updateRecipe:n}=Ku(),[a,r]=f.useState(!1),o=jn(),[l,c]=f.useState(null),[m,u]=f.useState(""),[h,p]=f.useState(""),[g,x]=f.useState("az"),b=f.useMemo(()=>{let v=t.filter(N=>N.name.toLowerCase().includes(m.toLowerCase()));h&&(v=v.filter(N=>N.mealType===h));const w=[...v];return w.sort((N,S)=>g==="az"?N.name.localeCompare(S.name):S.name.localeCompare(N.name)),w},[t,m,h,g]),j=(v,w)=>{w?n(w,v):s(v)};return e.jsxs("div",{className:"w-full h-full flex flex-col",children:[e.jsxs(Ju,{title:"Recetas",children:[e.jsx(xa,{children:e.jsxs("div",{className:"hidden md:flex items-center gap-2",children:[e.jsxs(Ms,{children:[e.jsx(Is,{asChild:!0,children:e.jsxs(z,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>r(!0),children:[e.jsx(as,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Agregar"})]})}),e.jsx(ks,{children:e.jsx("p",{children:"Agregar"})})]}),e.jsxs(Ms,{children:[e.jsx(Is,{asChild:!0,children:e.jsx(gy,{recipes:t,iconOnly:!0})}),e.jsx(ks,{children:e.jsx("p",{children:"Exportar"})})]})]})}),e.jsxs(Ba,{children:[e.jsx(Ha,{asChild:!0,children:e.jsxs(z,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 md:hidden",children:[e.jsx(Nc,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Opciones"})]})}),e.jsxs(pa,{align:"end",children:[e.jsxs(Lt,{onClick:()=>r(!0),children:[e.jsx(as,{className:"mr-2 h-4 w-4"}),"Agregar"]}),e.jsx(Lt,{asChild:!0,children:e.jsx(gy,{recipes:t})}),e.jsx(el,{}),o.pathname!=="/meal"&&e.jsx(Lt,{asChild:!0,children:e.jsxs(un,{to:"/meal",className:"flex items-center",children:[e.jsx(ns,{className:"mr-2 h-4 w-4"}),"Plan de Comidas"]})}),o.pathname!=="/shopping-list"&&e.jsx(Lt,{asChild:!0,children:e.jsxs(un,{to:"/shopping-list",className:"flex items-center",children:[e.jsx(ir,{className:"mr-2 h-4 w-4"}),"Lista de Compras"]})}),o.pathname!=="/recipes"&&e.jsx(Lt,{asChild:!0,children:e.jsxs(un,{to:"/recipes",className:"flex items-center",children:[e.jsx(Go,{className:"mr-2 h-4 w-4"}),"Recetas"]})}),o.pathname!=="/prepared-meals"&&e.jsx(Lt,{asChild:!0,children:e.jsxs(un,{to:"/prepared-meals",className:"flex items-center",children:[e.jsx(Si,{className:"mr-2 h-4 w-4"}),"Comidas Preparadas"]})})]})]})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsxs("div",{className:"p-4 space-y-4 h-full overflow-y-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start",children:[e.jsx(Be,{placeholder:"Buscar",value:m,onChange:v=>u(v.target.value),className:"sm:w-60"}),e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsxs(Nt,{value:g,onValueChange:v=>x(v),children:[e.jsx(xt,{className:"w-32",children:e.jsx(St,{placeholder:"Ordenar"})}),e.jsxs(gt,{children:[e.jsx(Pe,{value:"az",children:"Nombre A-Z"}),e.jsx(Pe,{value:"za",children:"Nombre Z-A"})]})]}),e.jsxs(Nt,{value:h||"all",onValueChange:v=>p(v==="all"?"":v),children:[e.jsx(xt,{className:"w-40",children:e.jsx(St,{placeholder:"Tipo"})}),e.jsxs(gt,{children:[e.jsx(Pe,{value:"all",children:"Todos"}),Object.entries(dn).map(([v,w])=>e.jsx(Pe,{value:v,children:w.title},v))]})]})]})]}),b.length===0?e.jsx("p",{className:"text-center text-gray-500",children:"No hay recetas guardadas"}):e.jsx("div",{className:"space-y-4",children:b.map(v=>e.jsxs(Ne,{children:[e.jsxs(Vt,{className:"flex flex-row items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(Wt,{className:"text-base",children:v.name}),e.jsx(fi,{children:dn[v.mealType].title})]}),e.jsx(z,{variant:"ghost",size:"sm",onClick:()=>{c(v),r(!0)},children:"Editar"})]}),e.jsxs(De,{className:"space-y-2",children:[v.description&&e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:v.description}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Dificultad:"})," ",v.difficulty||"N/A"," |"," ",e.jsx("span",{className:"font-medium",children:"Tiempo:"})," ",v.prepTime?`${v.prepTime} min`:"N/A"]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Ingredientes:"}),e.jsx("ul",{className:"list-disc pl-4 text-sm",children:v.ingredients.map((w,N)=>e.jsxs("li",{children:[w.quantity," ",w.name]},N))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Instrucciones:"}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:v.instructions})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Información Nutricional:"}),e.jsxs("p",{className:"text-sm",children:[v.nutrition.calories," kcal |"," ",v.nutrition.protein,"g P |"," ",v.nutrition.carbs,"g C |"," ",v.nutrition.fat,"g G"]})]})]})]},v.id))})]})}),e.jsx(mB,{open:a,onOpenChange:v=>{v||c(null),r(v)},onSave:j,recipe:l||void 0})]})},pB=()=>e.jsx(Xs,{noPadding:!0,className:"h-full",children:e.jsx(fB,{})}),xB=({open:t,onOpenChange:s,onSave:n,meal:a})=>{const[r,o]=f.useState(""),[l,c]=f.useState("");f.useEffect(()=>{a?(o(a.name),c(a.portions!==void 0?String(a.portions):"")):(o(""),c(""))},[a,t]);const m=()=>{const u={name:r};l&&(u.portions=Number(l)),n(u,a==null?void 0:a.id),s(!1)};return e.jsx(Rt,{open:t,onOpenChange:s,children:e.jsxs(Ct,{className:"sm:max-w-md",children:[e.jsx(_t,{children:e.jsxs(Pt,{children:[a?"Editar":"Agregar"," Comida Preparada"]})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(Fe,{htmlFor:"pm-name",children:"Nombre"}),e.jsx(Be,{id:"pm-name",value:r,onChange:u=>o(u.target.value)})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Fe,{htmlFor:"pm-portions",children:"Cantidad/Porciones (opcional)"}),e.jsx(Be,{id:"pm-portions",type:"number",value:l,onChange:u=>c(u.target.value)})]})]}),e.jsx(wn,{children:e.jsx(z,{onClick:m,children:"Guardar"})})]})})},gB=()=>{const{meals:t,addMeal:s,updateMeal:n,deleteMeal:a}=ex(),[r,o]=f.useState(!1),l=jn(),[c,m]=f.useState(null),u=(h,p)=>{p?n(p,h):s(h)};return e.jsxs("div",{className:"w-full h-full flex flex-col",children:[e.jsxs(Ju,{title:"Comidas Preparadas",children:[e.jsx(xa,{children:e.jsx("div",{className:"hidden md:flex items-center gap-2",children:e.jsxs(Ms,{children:[e.jsx(Is,{asChild:!0,children:e.jsxs(z,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>o(!0),children:[e.jsx(as,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Agregar"})]})}),e.jsx(ks,{children:e.jsx("p",{children:"Agregar"})})]})})}),e.jsxs(Ba,{children:[e.jsx(Ha,{asChild:!0,children:e.jsxs(z,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 md:hidden",children:[e.jsx(Nc,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Opciones"})]})}),e.jsxs(pa,{align:"end",children:[e.jsxs(Lt,{onClick:()=>o(!0),children:[e.jsx(as,{className:"mr-2 h-4 w-4"}),"Agregar"]}),e.jsx(el,{}),l.pathname!=="/meal"&&e.jsx(Lt,{asChild:!0,children:e.jsxs(un,{to:"/meal",className:"flex items-center",children:[e.jsx(ns,{className:"mr-2 h-4 w-4"}),"Plan de Comidas"]})}),l.pathname!=="/shopping-list"&&e.jsx(Lt,{asChild:!0,children:e.jsxs(un,{to:"/shopping-list",className:"flex items-center",children:[e.jsx(ir,{className:"mr-2 h-4 w-4"}),"Lista de Compras"]})}),l.pathname!=="/recipes"&&e.jsx(Lt,{asChild:!0,children:e.jsxs(un,{to:"/recipes",className:"flex items-center",children:[e.jsx(Go,{className:"mr-2 h-4 w-4"}),"Recetas"]})}),l.pathname!=="/prepared-meals"&&e.jsx(Lt,{asChild:!0,children:e.jsxs(un,{to:"/prepared-meals",className:"flex items-center",children:[e.jsx(Si,{className:"mr-2 h-4 w-4"}),"Comidas Preparadas"]})})]})]})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx("div",{className:"p-4 space-y-4 h-full overflow-y-auto",children:t.length===0?e.jsx("p",{className:"text-center text-gray-500",children:"No hay comidas guardadas"}):e.jsx("div",{className:"space-y-2",children:t.map(h=>e.jsxs("div",{className:"flex justify-between items-center border p-2 rounded",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:h.name}),h.portions!==void 0&&e.jsxs("p",{className:"text-sm text-gray-500",children:["Porciones: ",h.portions]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{variant:"ghost",size:"sm",onClick:()=>{m(h),o(!0)},children:"Editar"}),e.jsx(z,{variant:"ghost",size:"sm",onClick:()=>a(h.id),children:"Eliminar"})]})]},h.id))})})}),e.jsx(xB,{open:r||!!c,onOpenChange:h=>{h||m(null),o(h)},onSave:u,meal:c||void 0})]})},vB=()=>e.jsx(Xs,{noPadding:!0,className:"h-full",children:e.jsx(gB,{})}),yB=t=>{const[s,n]=f.useState(null),[a,r]=f.useState("idle"),[o,l]=f.useState(null),{user:c}=qe(),m=b=>b.reduce((j,v)=>{const w=ji.find(S=>S.id===v.exerciseId);if(!w)return j;j.totalCalories+=v.calories||0,j.totalSteps+=v.steps||0,j.totalDuration+=v.duration||0,j.totalDistance+=v.distance||0;const N=j.categoryStats[w.category];return N.count+=1,N.duration+=v.duration||0,N.calories+=v.calories||0,j},{totalCalories:0,totalSteps:0,totalDuration:0,totalDistance:0,categoryStats:{cardio:{count:0,duration:0,calories:0},strength:{count:0,duration:0,calories:0},flexibility:{count:0,duration:0,calories:0}}}),u=f.useCallback(async()=>{if(c){r("loading"),l(null);try{const b=$e(t);Me.logRead("exercises","useExerciseData.loadData",`${c.uid}_${b}`);const j=Te(fe,"exercises",`${c.uid}_${b}`),v=await st(j);v.exists()?n(v.data()):n(null),r("saved")}catch(b){l(b instanceof Error?b.message:"Error al cargar ejercicios"),r("error")}}},[c,t]);f.useEffect(()=>{u()},[u]);const h=async b=>{if(!c)return;r("saving"),l(null);const j=$e(t),v=Te(fe,"exercises",`${c.uid}_${j}`),w=(s==null?void 0:s.exercises)||[];w.push(b);const N=m(w),S={userId:c.uid,date:j,exercises:w,summary:N,createdAt:(s==null?void 0:s.createdAt)||dt(),updatedAt:dt()};n(S),r("saved");try{Me.logWrite("exercises","useExerciseData.logExercise",`${c.uid}_${j}`),await qt(v,S)}catch(E){n(s),l(E instanceof Error?E.message:"Error al guardar ejercicio"),r("error")}},p=async(b,j)=>{if(!c||!s)return;r("saving"),l(null);const v=s,w=[...s.exercises];w[b]={...w[b],...j};const N=m(w),S={...s,exercises:w,summary:N,updatedAt:dt()};n(S),r("saved");try{const E=$e(t),T=Te(fe,"exercises",`${c.uid}_${E}`);Me.logWrite("exercises","useExerciseData.updateExerciseLog",`${c.uid}_${E}`),await qt(T,S)}catch(E){n(v),l(E instanceof Error?E.message:"Error al actualizar ejercicio"),r("error")}},g=async b=>{if(!c||!s)return;r("saving"),l(null);const j=s,v=s.exercises.filter((w,N)=>N!==b);if(v.length===0)n(null);else{const w=m(v),N={...s,exercises:v,summary:w,updatedAt:dt()};n(N)}r("saved");try{const w=$e(t),N=Te(fe,"exercises",`${c.uid}_${w}`);if(v.length===0)Me.logDelete("exercises","useExerciseData.deleteExerciseLog.delete",`${c.uid}_${w}`),await ao(N);else{const S=m(v),E={...s,exercises:v,summary:S,updatedAt:dt()};Me.logWrite("exercises","useExerciseData.deleteExerciseLog.update",`${c.uid}_${w}`),await qt(N,E)}}catch(w){n(j),l(w instanceof Error?w.message:"Error al eliminar ejercicio"),r("error")}},x=dr("Exercise data");return{exerciseLogs:(s==null?void 0:s.exercises)||[],summary:s==null?void 0:s.summary,status:a,error:o,logExercise:h,updateExerciseLog:p,deleteExerciseLog:g,loadExerciseData:u,resync:x}},bB=({exerciseLogs:t,onUpdate:s,onDelete:n,isLoading:a})=>{if(a)return e.jsx("div",{className:"text-center py-8",children:"Cargando ejercicios..."});if(t.length===0)return e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No hay ejercicios registrados para este día"});const r=c=>{if(!ji.find(h=>h.id===c.exerciseId))return"";const u=[];return c.sets&&c.reps&&u.push(`${c.sets} series x ${c.reps} repeticiones`),c.duration&&u.push(`${c.duration} minutos`),c.distance&&u.push(`${(c.distance/1e3).toFixed(2)} km`),c.steps&&u.push(`${c.steps.toLocaleString()} pasos`),c.weight&&u.push(`${c.weight}kg`),u.join(" • ")},o=c=>{const m=ji.find(u=>u.id===c.exerciseId);return m?m.defaultDuration&&c.duration?c.duration/m.defaultDuration*100:m.defaultDistance&&c.distance?c.distance/m.defaultDistance*100:m.defaultSets&&m.defaultReps&&c.sets&&c.reps?c.sets*c.reps/(m.defaultSets*m.defaultReps)*100:100:0},l=()=>{const c=t.reduce((h,p)=>h+(p.calories||0),0),m=t.reduce((h,p)=>h+(p.steps||0),0),u=t.reduce((h,p)=>h+(p.duration||0),0);return c===0&&m===0?null:e.jsx(Ne,{className:"mb-6",children:e.jsxs(De,{className:"p-4",children:[e.jsx("h3",{className:"text-sm font-medium mb-3",children:"Resumen del día"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[c>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oc,{className:"w-4 h-4 text-orange-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:c}),e.jsx("p",{className:"text-xs text-gray-500",children:"calorías"})]})]}),m>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Tb,{className:"w-4 h-4 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:m.toLocaleString()}),e.jsx("p",{className:"text-xs text-gray-500",children:"pasos"})]})]}),u>0&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:u}),e.jsx("p",{className:"text-xs text-gray-500",children:"minutos"})]})})]})]})})};return e.jsxs("div",{className:"space-y-4",children:[l(),t.map((c,m)=>{const u=ji.find(h=>h.id===c.exerciseId);return u?e.jsx(Ne,{children:e.jsxs(De,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:u.icon}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:u.name}),e.jsx("p",{className:"text-sm text-gray-500",children:r(c)})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{variant:"ghost",size:"icon",onClick:()=>s(m),children:e.jsx(RR,{className:"w-4 h-4"})}),e.jsx(z,{variant:"ghost",size:"icon",onClick:()=>n(m),children:e.jsx(Zi,{className:"w-4 h-4 text-red-500"})})]})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("div",{className:"flex justify-between text-sm",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("span",{className:`px-2 py-1 rounded-full ${GO[u.category]} text-white`,children:u.category}),c.calories&&e.jsxs("span",{className:"flex items-center gap-1 text-orange-500",children:[e.jsx(oc,{className:"w-4 h-4"}),c.calories," kcal"]})]})}),e.jsx(Vn,{value:o(c),className:"h-2"}),c.notes&&e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:c.notes})]})]})},m):null})]})},vy=({isOpen:t,onClose:s,onSubmit:n,initialData:a})=>{var x,b,j,v,w,N,S;const[r,o]=Z.useState(a?ji.find(E=>E.id===a.exerciseId):null),[l,c]=Z.useState({sets:((x=a==null?void 0:a.sets)==null?void 0:x.toString())||"",reps:((b=a==null?void 0:a.reps)==null?void 0:b.toString())||"",weight:((j=a==null?void 0:a.weight)==null?void 0:j.toString())||"",duration:((v=a==null?void 0:a.duration)==null?void 0:v.toString())||"",distance:((w=a==null?void 0:a.distance)==null?void 0:w.toString())||"",steps:((N=a==null?void 0:a.steps)==null?void 0:N.toString())||"",calories:((S=a==null?void 0:a.calories)==null?void 0:S.toString())||"",notes:(a==null?void 0:a.notes)||""}),[m,u]=Z.useState(0),h=f.useCallback(()=>{if(!(r!=null&&r.caloriesPerHour))return;let E=parseInt(l.duration)||0;!E&&l.sets&&l.reps&&(E=parseInt(l.sets)*parseInt(l.reps)*3/60);let T=r.caloriesPerHour*E/60;if(l.weight&&r.category==="strength"){const D=parseInt(l.weight)/5;T*=1+D*.1}const k=Math.round(T);u(k),c(D=>({...D,calories:k.toString()}))},[r,l.duration,l.sets,l.reps,l.weight,c]);f.useEffect(()=>{if(h(),r!=null&&r.stepsPerKm&&l.distance){const E=parseFloat(l.distance),T=Math.round(E*r.stepsPerKm);c(k=>({...k,steps:T.toString()}))}},[h,l.distance,l.duration,l.weight,r]);const p=E=>{var T,k,D;o(E),c({sets:((T=E.defaultSets)==null?void 0:T.toString())||"",reps:((k=E.defaultReps)==null?void 0:k.toString())||"",weight:"",duration:((D=E.defaultDuration)==null?void 0:D.toString())||"",distance:E.defaultDistance?(E.defaultDistance/1e3).toString():"",steps:"",calories:"",notes:""})},g=E=>{if(E.preventDefault(),!r)return;const T={exerciseId:r.id,calories:l.calories?parseInt(l.calories):m,...l.sets&&{sets:parseInt(l.sets)},...l.reps&&{reps:parseInt(l.reps)},...l.weight&&{weight:parseFloat(l.weight)},...l.duration&&{duration:parseInt(l.duration)},...l.distance&&{distance:parseFloat(l.distance)*1e3},...l.steps&&{steps:parseInt(l.steps)},...l.notes&&{notes:l.notes}};n(T),s()};return e.jsx(Rt,{open:t,onOpenChange:s,children:e.jsxs(Ct,{className:"sm:max-w-[700px] max-h-[90vh] sm:h-auto overflow-y-auto",children:[e.jsx(_t,{className:"sticky top-0 bg-background z-10 pb-4 mb-4 border-b",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs(Pt,{className:"flex items-center gap-2 text-xl",children:[r&&!a&&e.jsx(z,{type:"button",variant:"ghost",size:"icon",onClick:()=>o(null),className:"h-8 w-8",children:e.jsx(Po,{className:"h-5 w-5"})}),a?"Editar ejercicio":"Agregar ejercicio"]})})}),e.jsx("form",{onSubmit:g,className:"space-y-6 pt-2",children:r?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("span",{className:"text-3xl",children:r.icon}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-lg",children:r.name}),e.jsx("p",{className:"text-sm text-gray-500",children:r.description})]})]}),r.category==="strength"&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Fe,{htmlFor:"sets",children:"Series"}),e.jsx(Be,{id:"sets",type:"number",min:"1",value:l.sets,onChange:E=>c(T=>({...T,sets:E.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Fe,{htmlFor:"reps",children:"Repeticiones"}),e.jsx(Be,{id:"reps",type:"number",min:"1",value:l.reps,onChange:E=>c(T=>({...T,reps:E.target.value}))})]}),r.name==="Pesas de mano"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Fe,{htmlFor:"weight",children:"Peso (kg)"}),e.jsx(Be,{id:"weight",type:"number",min:"0",step:"0.5",value:l.weight,onChange:E=>c(T=>({...T,weight:E.target.value}))})]})]}),(r.category==="cardio"||r.category==="flexibility")&&e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Fe,{htmlFor:"duration",children:"Duración (min)"}),e.jsx(Be,{id:"duration",type:"number",min:"1",value:l.duration,onChange:E=>c(T=>({...T,duration:E.target.value}))})]}),r.category==="cardio"&&r.name!=="Natación"&&r.name!=="Tenis"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Fe,{htmlFor:"distance",children:"Distancia (km)"}),e.jsx(Be,{id:"distance",type:"number",min:"0",step:"0.1",value:l.distance,onChange:E=>c(T=>({...T,distance:E.target.value}))})]})]}),r.stepsPerKm&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(Fe,{htmlFor:"steps",children:["Pasos ",l.steps&&`(calculado: ${l.steps})`]}),e.jsx(Be,{id:"steps",type:"number",min:"0",value:l.steps,onChange:E=>c(T=>({...T,steps:E.target.value})),placeholder:"Número de pasos"})]}),m>0&&e.jsx("div",{className:"p-4 bg-muted rounded-md",children:e.jsxs("p",{className:"text-sm font-medium text-muted-foreground",children:["Calorías estimadas: ",m," kcal"]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Fe,{htmlFor:"calories",children:"Calorías"}),e.jsx(Be,{id:"calories",type:"number",min:"0",value:l.calories,onChange:E=>c(T=>({...T,calories:E.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Fe,{htmlFor:"notes",children:"Notas"}),e.jsx(kt,{id:"notes",value:l.notes,onChange:E=>c(T=>({...T,notes:E.target.value})),placeholder:"Añade notas sobre el ejercicio..."})]}),e.jsxs(wn,{className:"gap-3 sm:gap-0",children:[e.jsx(z,{type:"button",variant:"outline",className:"flex-1 sm:flex-none",onClick:s,children:"Cancelar"}),e.jsx(z,{type:"submit",className:"flex-1 sm:flex-none",children:a?"Actualizar":"Guardar"})]})]}):e.jsxs(Ga,{defaultValue:"cardio",className:"w-full",children:[e.jsx(qa,{className:"w-full h-12 grid grid-cols-3 mb-4",children:Object.entries(hf).map(([E,T])=>e.jsxs(js,{value:E,className:"flex items-center gap-2 text-base p-3",children:[e.jsx("span",{className:"text-xl",children:T.icon}),e.jsx("span",{children:T.name})]},E))}),Object.entries(hf).map(([E])=>e.jsx(hs,{value:E,className:"mt-4",children:e.jsx("div",{className:"grid grid-cols-2 gap-3",children:ji.filter(T=>T.category===E).map(T=>e.jsxs(z,{type:"button",variant:"outline",className:"flex flex-col items-center p-6 h-auto gap-3",onClick:()=>p(T),children:[e.jsx("span",{className:"text-3xl",children:T.icon}),e.jsx("span",{className:"text-sm font-normal text-center",children:T.name})]},T.id))})},E))]})})]})})},jB=({exerciseLogs:t,summary:s})=>{const n=Z.useMemo(()=>s||{totalCalories:t.reduce((l,c)=>l+(c.calories||0),0),totalSteps:t.reduce((l,c)=>l+(c.steps||0),0),totalDuration:t.reduce((l,c)=>l+(c.duration||0),0),totalDistance:t.reduce((l,c)=>l+(c.distance||0),0),categoryStats:t.reduce((l,c)=>{const m=ji.find(u=>u.id===c.exerciseId);return m&&(l[m.category]||(l[m.category]={count:0,duration:0,calories:0}),l[m.category].count+=1,l[m.category].duration+=c.duration||0,l[m.category].calories+=c.calories||0),l},{})},[t,s]),a=l=>new Date(l).toLocaleDateString("es-ES",{month:"short",day:"numeric"}),r=(l,c)=>typeof l=="string"?new Date(l).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}):[l.toLocaleString(),c],o=Z.useMemo(()=>{const l=new Date,c=[];for(let m=6;m>=0;m--){const u=new Date(l);u.setDate(u.getDate()-m);const h=$e(u);c.push({date:h,calories:0,steps:0,duration:0,distance:0})}return t.forEach(m=>{const u=c.find(h=>h.date===$e(new Date));u&&(u.calories+=m.calories||0,u.steps+=m.steps||0,u.duration+=m.duration||0,u.distance+=(m.distance||0)/1e3)}),c},[t]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(Ne,{children:e.jsxs(De,{className:"p-6 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-muted rounded-lg",children:e.jsx(oc,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Calorías"}),e.jsx("h4",{className:"text-2xl font-bold",children:n.totalCalories})]})]})}),e.jsx(Ne,{children:e.jsxs(De,{className:"p-6 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-muted rounded-lg",children:e.jsx(Tb,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Pasos"}),e.jsx("h4",{className:"text-2xl font-bold",children:n.totalSteps.toLocaleString()})]})]})}),e.jsx(Ne,{children:e.jsxs(De,{className:"p-6 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-muted rounded-lg",children:e.jsx(Ji,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Tiempo"}),e.jsxs("h4",{className:"text-2xl font-bold",children:[n.totalDuration," min"]})]})]})}),e.jsx(Ne,{children:e.jsxs(De,{className:"p-6 flex items-center gap-4",children:[e.jsx("div",{className:"p-3 bg-muted rounded-lg",children:e.jsx(_R,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Distancia"}),e.jsxs("h4",{className:"text-2xl font-bold",children:[(n.totalDistance/1e3).toFixed(1)," km"]})]})]})})]}),e.jsxs(Ne,{children:[e.jsx(Vt,{children:e.jsx(Wt,{children:"Progreso"})}),e.jsx(De,{children:e.jsxs(Ga,{defaultValue:"calories",children:[e.jsxs(qa,{className:"grid grid-cols-4 h-12",children:[e.jsx(js,{value:"calories",className:"text-base",children:"Calorías"}),e.jsx(js,{value:"steps",className:"text-base",children:"Pasos"}),e.jsx(js,{value:"duration",className:"text-base",children:"Tiempo"}),e.jsx(js,{value:"distance",className:"text-base",children:"Distancia"})]}),e.jsx(hs,{value:"calories",className:"h-[300px] pt-4",children:e.jsx(gn,{width:"100%",height:"100%",children:e.jsxs(qi,{data:o,children:[e.jsx(sr,{strokeDasharray:"3 3"}),e.jsx(Ma,{dataKey:"date",tickFormatter:a}),e.jsx(ma,{}),e.jsx(vn,{formatter:r,labelFormatter:a}),e.jsx(_r,{}),e.jsx(gi,{type:"monotone",dataKey:"calories",stroke:"#f97316",name:"Calorías",dot:!0})]})})}),e.jsx(hs,{value:"steps",className:"h-[300px] pt-4",children:e.jsx(gn,{width:"100%",height:"100%",children:e.jsxs(qi,{data:o,children:[e.jsx(sr,{strokeDasharray:"3 3"}),e.jsx(Ma,{dataKey:"date",tickFormatter:a}),e.jsx(ma,{}),e.jsx(vn,{formatter:r,labelFormatter:a}),e.jsx(_r,{}),e.jsx(gi,{type:"monotone",dataKey:"steps",stroke:"#3b82f6",name:"Pasos",dot:!0})]})})}),e.jsx(hs,{value:"duration",className:"h-[300px] pt-4",children:e.jsx(gn,{width:"100%",height:"100%",children:e.jsxs(qi,{data:o,children:[e.jsx(sr,{strokeDasharray:"3 3"}),e.jsx(Ma,{dataKey:"date",tickFormatter:a}),e.jsx(ma,{}),e.jsx(vn,{formatter:r,labelFormatter:a}),e.jsx(_r,{}),e.jsx(gi,{type:"monotone",dataKey:"duration",stroke:"#22c55e",name:"Minutos",dot:!0})]})})}),e.jsx(hs,{value:"distance",className:"h-[300px] pt-4",children:e.jsx(gn,{width:"100%",height:"100%",children:e.jsxs(qi,{data:o,children:[e.jsx(sr,{strokeDasharray:"3 3"}),e.jsx(Ma,{dataKey:"date",tickFormatter:a}),e.jsx(ma,{}),e.jsx(vn,{formatter:r,labelFormatter:a}),e.jsx(_r,{}),e.jsx(gi,{type:"monotone",dataKey:"distance",stroke:"#a855f7",name:"Kilómetros",dot:!0})]})})})]})})]}),e.jsxs(Ne,{children:[e.jsx(Vt,{children:e.jsx(Wt,{children:"Resumen por categoría"})}),e.jsx(De,{children:e.jsx("div",{className:"h-[300px]",children:e.jsx(gn,{width:"100%",height:"100%",children:e.jsxs(Nu,{data:Object.entries(hf).map(([l,c])=>{const m=n.categoryStats[l]||{duration:0,calories:0};return{category:c.name,minutos:m.duration,calorias:m.calories}}),children:[e.jsx(sr,{strokeDasharray:"3 3"}),e.jsx(Ma,{dataKey:"category"}),e.jsx(ma,{yAxisId:"left",orientation:"left",stroke:"#f97316"}),e.jsx(ma,{yAxisId:"right",orientation:"right",stroke:"#22c55e"}),e.jsx(vn,{}),e.jsx(_r,{}),e.jsx(rc,{yAxisId:"left",dataKey:"calorias",fill:"#f97316",name:"Calorías"}),e.jsx(rc,{yAxisId:"right",dataKey:"minutos",fill:"#22c55e",name:"Minutos"})]})})})})]})]})},wB=(t,s)=>{const[n,a]=f.useState(null),[r,o]=f.useState(!0),[l,c]=f.useState(null),{user:m}=qe();return f.useEffect(()=>{(async()=>{if(a(null),!!m){o(!0),c(null);try{const h=[],p=new Date(t);for(;p<=s;)h.push($e(p)),p.setDate(p.getDate()+1);const x=(await Promise.all(h.map(b=>st(Te(fe,"exercises",`${m.uid}_${b}`))))).map((b,j)=>{var v;return{date:h[j],calories:b.exists()&&((v=b.data().summary)==null?void 0:v.totalCalories)||0}});a({dailyStats:x})}catch(h){console.error("Error al cargar estadísticas:",h),c(h instanceof Error?h.message:"Error al cargar estadísticas")}finally{o(!1)}}})()},[m,t,s]),{stats:n,loading:r,error:l}},NB=({selectedDate:t,goal:s=500})=>{const[n,a]=f.useState(ts(t));f.useEffect(()=>{a(ts(t))},[t]);const r=f.useMemo(()=>ts(n),[n]),o=f.useMemo(()=>ea(n),[n]),{stats:l,loading:c}=wB(r,o),m=f.useMemo(()=>{const h={};return l==null||l.dailyStats.forEach(({date:p,calories:g})=>{h[p]=g}),h},[l]),u=h=>{const p=$e(h.date),g=m[p]||0,x=Math.min(g/s,1),b=28,j=3,v=(b-j)/2,w=2*Math.PI*v,N=w-x*w,S=g>=s;return e.jsxs("div",{className:"relative flex items-center justify-center w-7 h-7",children:[e.jsxs("svg",{width:b,height:b,className:"absolute",children:[e.jsx("circle",{cx:b/2,cy:b/2,r:v,stroke:S?"#fed7aa":"#e5e7eb",strokeWidth:j,fill:"none"}),e.jsx("circle",{cx:b/2,cy:b/2,r:v,stroke:S?"#f97316":"#9ca3af",strokeWidth:j,fill:"none",strokeDasharray:w,strokeDashoffset:N,strokeLinecap:"round",style:{transform:"rotate(-90deg)",transformOrigin:"50% 50%"}})]}),e.jsx("span",{className:"text-[10px] font-medium z-10",children:h.date.getDate()})]})};return e.jsxs(Ne,{className:"w-full",children:[e.jsxs(Vt,{className:"flex flex-col items-center gap-2",children:[e.jsx(oc,{className:"w-5 h-5 text-orange-600"}),e.jsx(Wt,{className:"text-center",children:"Historial Mensual"})]}),e.jsxs(De,{className:"relative p-4",children:[c&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white/50 z-10",children:e.jsx(ls,{className:"w-6 h-6 animate-spin"})}),e.jsx(Ac,{month:n,onMonthChange:a,showOutsideDays:!0,components:{DayContent:u},className:"p-0 w-full"})]})]})},oC=f.forwardRef(({selectedDate:t},s)=>{const{user:n}=qe(),{exerciseLogs:a,summary:r,status:o,error:l,logExercise:c,updateExerciseLog:m,deleteExerciseLog:u,resync:h}=yB(t),{isOnline:p}=Va(),[g,x]=f.useState(!1),[b,j]=f.useState(null);return f.useImperativeHandle(s,()=>({openAddExercise:()=>x(!0)})),n?e.jsxs(Ne,{className:"w-full",children:[e.jsxs(De,{className:"p-6",children:[e.jsxs(Ga,{defaultValue:"list",className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(qa,{children:[e.jsx(js,{value:"list",children:"Lista"}),e.jsxs(js,{value:"stats",className:"gap-2",children:[e.jsx(Ff,{className:"w-4 h-4"}),"Estadísticas"]})]}),e.jsxs(z,{onClick:()=>x(!0),className:"gap-2 hidden sm:flex",disabled:o==="saving"||!p,children:[e.jsx(as,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Agregar"})]})]}),e.jsx(hs,{value:"list",className:"m-0",children:e.jsx(bB,{exerciseLogs:a,onUpdate:j,onDelete:u,isLoading:o==="loading"})}),e.jsx(hs,{value:"stats",className:"m-0",children:e.jsx(jB,{exerciseLogs:a,summary:r})})]}),l&&e.jsx("p",{className:"mt-4 text-sm text-red-500",children:l}),e.jsx(vy,{isOpen:g,onClose:()=>x(!1),onSubmit:c,selectedDate:t}),b!==null&&e.jsx(vy,{isOpen:!0,onClose:()=>j(null),onSubmit:v=>{m(b,v),j(null)},initialData:a[b],selectedDate:t})]}),e.jsxs(bn,{className:"justify-center gap-2 text-xs p-2",children:[o==="saving"&&e.jsx("span",{className:"text-blue-500",children:"Guardando..."}),o==="pending"&&e.jsx("span",{className:"text-yellow-600",children:"Pendiente de sincronizar"}),o==="saved"&&e.jsx("span",{className:"text-green-600",children:"Sincronizado"}),o==="error"&&e.jsx("span",{className:"text-red-600",children:"Error de sincronización"}),!p&&e.jsx("span",{className:"text-orange-600",children:"Offline"}),e.jsx(z,{onClick:h,variant:"link",className:"p-0 h-auto",children:"Reintentar"})]})]}):e.jsx(Ne,{className:"w-full",children:e.jsx(De,{className:"p-4 text-center",children:e.jsx("p",{children:"Inicia sesión para registrar tus ejercicios"})})})});oC.displayName="Exercise";const SB=()=>{const[t,s]=f.useState(new Date),{user:n}=qe(),a=f.useRef(null),r=f.useMemo(()=>({dailyCalories:500}),[]),{settings:o,saveSettings:l}=lN("exercise",r),[c,m]=f.useState(o.dailyCalories);f.useEffect(()=>{m(o.dailyCalories)},[o.dailyCalories]);const u=()=>{var h;(h=a.current)==null||h.openAddExercise()};return n?e.jsxs(Xs,{showFloatingButton:!0,onFloatingButtonClick:u,floatingButtonLabel:"Agregar ejercicio",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Registro de Ejercicio"}),e.jsx("p",{className:"text-gray-500",children:"Registra y monitorea tus actividades físicas diarias"})]}),e.jsxs(Ga,{defaultValue:"daily",className:"w-full",children:[e.jsxs(qa,{className:"mb-6",children:[e.jsx(js,{value:"daily",children:"Registro Diario"}),e.jsx(js,{value:"settings",children:"Configuración"})]}),e.jsxs(hs,{value:"daily",children:[e.jsx(or,{selectedDate:t,onChange:s}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-[1fr_300px] mt-4",children:[e.jsx(oC,{ref:a,selectedDate:t}),e.jsx(NB,{selectedDate:t,goal:o.dailyCalories})]})]}),e.jsx(hs,{value:"settings",className:"space-y-4",children:e.jsx(Ne,{children:e.jsxs(De,{className:"pt-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx(Fe,{htmlFor:"calGoal",children:"Calorías diarias objetivo"}),e.jsx(Be,{id:"calGoal",type:"number",value:c,onChange:h=>m(Number(h.target.value))})]}),e.jsx(z,{onClick:()=>l({dailyCalories:c}),children:"Guardar"})]})})})]})]}):e.jsx("div",{className:"container max-w-4xl mx-auto py-6",children:e.jsx(Ne,{children:e.jsxs(De,{className:"p-8 text-center",children:[e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Inicia sesión"}),e.jsx("p",{className:"text-gray-500",children:"Necesitas iniciar sesión para registrar y ver tus ejercicios"})]})})})},ax=(t,s)=>Te(fe,"negative-habits",`${t}_${s}`),CB=async(t,s,n,a,r,o)=>{const l={habitId:a,timestamp:new Date().getTime(),...o?{note:o}:{}},m={...r[n]||{},[a]:l},u={userId:t,yearMonth:s,habits:{...r,[n]:m},updatedAt:dt()},h=ax(t,s);await qt(h,u,{merge:!0})},EB=async(t,s,n,a,r)=>{const o={...r[n]||{}};delete o[a];const l={userId:t,yearMonth:s,habits:{...r,[n]:o},updatedAt:dt()},c=ax(t,s);await qt(c,l,{merge:!0})},TB=async(t,s)=>{const n={},a=$t(fe,"negative-habits");for(const r of s)try{(await an(nn(a,wt("userId","==",t),wt("yearMonth","==",r)))).forEach(l=>{const c=l.data();n[r]=c.habits||{}})}catch(o){console.error(`Error fetching month ${r}:`,o)}return n},rx=t=>{const s={totalCount:0,byHabitId:{},byDate:{}};return Object.entries(t).forEach(([n])=>{const[a,r]=n.split("_"),o=parseInt(a);s.totalCount++,s.byHabitId[o]=(s.byHabitId[o]||0)+1,s.byDate[r]=(s.byDate[r]||0)+1}),s},DB=(t,s=5)=>{const n=rx(t);return Object.entries(n.byHabitId).sort(([,a],[,r])=>r-a).slice(0,s).map(([a,r])=>({habitId:parseInt(a),count:r}))},kB=(t,s=3)=>{const n=rx(t);return Object.entries(n.byDate).sort(([,a],[,r])=>r-a).slice(0,s).map(([a,r])=>({date:a,count:r}))},AB=t=>{const s=[],n=new Date(t),a=n.getDay(),r=a===0?-6:1-a;n.setDate(n.getDate()+r);for(let o=0;o<7;o++){const l=new Date(n);l.setDate(n.getDate()+o),s.push({dayName:l.toLocaleDateString("es-ES",{weekday:"short"}),fullDate:$e(l)})}return s},RB=t=>{const s=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0");return`${s}-${n}`},_B=t=>{const s=t.getFullYear(),n=t.getMonth()+1,a=[];for(let r=1;r<=n;r++){const o=String(r).padStart(2,"0");a.push(`${s}-${o}`)}return a},PB=()=>{const[t,s]=f.useState({}),[n,a]=f.useState("idle"),[r,o]=f.useState(null),{user:l}=qe(),c=f.useMemo(()=>{const x={};return Object.values(t).forEach(b=>{Object.entries(b).forEach(([j,v])=>{Object.entries(v).forEach(([w,N])=>{x[`${w}_${j}`]=N})})}),x},[t]),m=f.useMemo(()=>({...rx(c),topHabits:DB(c),frequentDays:kB(c)}),[c,t]),u=f.useCallback(async()=>{if(!l)return;a("loading"),o(null);const x=new Date,b=RB(x);try{Me.logRead("negative-habits","useNegativeHabitData.loadCurrentMonth");const j=await st(ax(l.uid,b));let v={};if(j.exists()){const S=j.data();v[b]=S.habits||{}}const w=_B(x),N=await TB(l.uid,w);v={...v,...N},s(v),a("saved")}catch(j){console.error("Error loading negative habit data:",j),o(j instanceof Error?j.message:"Error al cargar los datos"),a("error")}},[l]);f.useEffect(()=>{u()},[u]);const h=f.useCallback(async(x,b,j)=>{if(!l)return;a("saving"),o(null);const[v,w]=b.split("-"),N=`${v}-${w}`,S=t[N]||{},E={timestamp:Date.now(),habitId:x,...j?{note:j}:{}},T={...S,[b]:{...S[b],[x]:E}};s(k=>({...k,[N]:T}));try{await CB(l.uid,N,b,x,S,j),a("saved")}catch(k){console.error("Error logging negative habit:",k),s(D=>({...D,[N]:S})),o(k instanceof Error?k.message:"Error al guardar"),a("error")}},[l,t]),p=f.useCallback(async(x,b)=>{if(!l)return;a("saving"),o(null);const[j,v]=b.split("-"),w=`${j}-${v}`,N=t[w]||{},S={...N};if(S[b]){const E={...S[b]};delete E[x],Object.keys(E).length===0?delete S[b]:S[b]=E}s(E=>({...E,[w]:S}));try{await EB(l.uid,w,b,x,N),a("saved")}catch(E){console.error("Error removing negative habit:",E),s(T=>({...T,[w]:N})),o(E instanceof Error?E.message:"Error al eliminar"),a("error")}},[l,t]),g=dr("Negative habit data");return{habits:c,status:n,error:r,stats:m,logHabit:h,removeLog:p,loadNegativeHabitData:u,resync:g}},MB=({view:t,onViewChange:s})=>e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(z,{variant:t==="weekly"?"default":"outline",size:"sm",onClick:()=>s("weekly"),className:"gap-2",children:[e.jsx(ns,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Semanal"})]}),e.jsxs(z,{variant:t==="yearly"?"default":"outline",size:"sm",onClick:()=>s("yearly"),className:"gap-2",children:[e.jsx(Nb,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Anual"})]})]}),yy=({habits:t,completedHabits:s,weekDays:n,onLogHabit:a,onRemoveLog:r,disabled:o})=>e.jsx(xa,{children:e.jsxs("div",{className:"grid grid-cols-[minmax(100px,1fr)_repeat(7,minmax(32px,1fr))] gap-1",children:[e.jsx("div",{}),n.map(l=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-medium",children:l.dayName}),e.jsx("div",{className:"text-[10px] text-gray-400",children:l.fullDate.split("-").slice(1).join("/")})]},l.fullDate)),t.map(l=>e.jsxs(Z.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:l.icon}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm",children:l.name}),e.jsx("span",{className:"text-xs text-gray-500",children:l.category})]})]}),n.map(c=>{const m=`${l.id}_${c.fullDate}`,u=s[m];return e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs(Ms,{children:[e.jsx(Is,{asChild:!0,children:e.jsx(z,{variant:u?"destructive":"outline",size:"icon",className:"w-8 h-8 p-0",onClick:()=>u?r(l.id,c.fullDate):a(l.id,c.fullDate),disabled:o,children:u?e.jsx(Ws,{className:"w-4 h-4 text-white"}):e.jsx(yc,{className:"w-4 h-4 text-muted-foreground"})})}),e.jsx(ks,{children:u?"Eliminar registro":"Registrar hábito"})]})},m)})]},l.id))]})}),ko={health:{icon:"🏥",label:"Salud",description:"Hábitos que afectan tu salud física"},productivity:{icon:"⏰",label:"Productividad",description:"Hábitos que reducen tu eficiencia"},social:{icon:"👥",label:"Social",description:"Hábitos que afectan tus relaciones"},emotional:{icon:"😔",label:"Emocional",description:"Hábitos que afectan tu bienestar emocional"},finance:{icon:"💰",label:"Finanzas",description:"Hábitos que impactan tus finanzas"},digital:{icon:"📱",label:"Digital",description:"Hábitos digitales nocivos"},environment:{icon:"🌍",label:"Ambiente",description:"Hábitos que impactan al medio ambiente"}},yi=[{id:1,name:"Saltarse comidas",icon:"🍽️",category:"health"},{id:2,name:"Dormir poco",icon:"😴",category:"health"},{id:3,name:"No hacer ejercicio",icon:"🏃",category:"health"},{id:4,name:"Comer en exceso",icon:"🫃🏻",category:"health"},{id:25,name:"Comida chatarra",icon:"🍔",category:"health"},{id:26,name:"Exceso de azúcar",icon:"🍭",category:"health"},{id:27,name:"Masturbación",icon:"🍆",category:"health"},{id:5,name:"Procrastinar",icon:"⏰",category:"productivity"},{id:6,name:"Distracciones",icon:"🎯",category:"productivity"},{id:7,name:"Multitarea",icon:"🔄",category:"productivity"},{id:8,name:"Desorganización",icon:"📋",category:"productivity"},{id:24,name:"Exceso de trabajo (Workaholic)",icon:"🍽️",category:"productivity"},{id:9,name:"Aislamiento",icon:"🚶",category:"social"},{id:10,name:"Conflictos",icon:"💢",category:"social"},{id:11,name:"No escuchar",icon:"👂",category:"social"},{id:29,name:"Dejar en visto",icon:"👀",category:"social"},{id:15,name:"Sobrepensar cosas",icon:"😰",category:"emotional"},{id:16,name:"Negatividad / Pesimismo",icon:"🌧️",category:"emotional"},{id:17,name:"Ser grosero/estresarme",icon:"🤬",category:"emotional"},{id:28,name:"Celos compulsivos",icon:"💁🏻‍♂️",category:"emotional"},{id:12,name:"Gastos impulsivos",icon:"💳",category:"finance"},{id:13,name:"No ahorrar",icon:"💰",category:"finance"},{id:14,name:"Más Deudas",icon:"📉",category:"finance"},{id:18,name:"Exceso de Redes sociales",icon:"📱",category:"digital"},{id:19,name:"Exceso de Videojuegos",icon:"🎮",category:"digital"},{id:20,name:"Exceso de Netflix",icon:"🎬",category:"digital"},{id:21,name:"Desperdiciar agua",icon:"💧",category:"environment"},{id:22,name:"No reciclar",icon:"♻️",category:"environment"},{id:23,name:"Consumo excesivo",icon:"🛍️",category:"environment"}],IB=({habits:t,onLogHabit:s,onRemoveLog:n,disabled:a})=>{const r=AB(new Date),[o,l]=f.useState(""),[c,m]=f.useState(["health"]),[u,h]=f.useState(!1),p=f.useMemo(()=>{const j={};return yi.forEach(v=>{j[v.category]||(j[v.category]=[]),!(o&&!v.name.toLowerCase().includes(o.toLowerCase()))&&j[v.category].push(v)}),j},[o]),g=f.useMemo(()=>{const j=yi.length,v=Object.values(p).reduce((S,E)=>S+E.length,0),w={},N=new Date().toISOString().split("T")[0];return Object.entries(t).forEach(([S])=>{const[E,T]=S.split("_");if(T===N){const k=yi.find(D=>D.id===Number(E));k&&(w[k.category]=(w[k.category]||0)+1)}}),{totalHabits:j,filteredHabits:v,loggedByCategory:w,isFiltered:o.length>0}},[p,t,o]),x=f.useMemo(()=>{const j=new Map;return Object.entries(t).forEach(([v])=>{const[w]=v.split("_"),N=j.get(Number(w))||0;j.set(Number(w),N+1)}),yi.filter(v=>j.has(v.id)).sort((v,w)=>(j.get(w.id)||0)-(j.get(v.id)||0)).slice(0,5)},[t]),b=j=>{m(v=>v.includes(j)?v.filter(w=>w!==j):[...v,j])};return e.jsxs("div",{className:"space-y-4",children:["      ",e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsxs("div",{className:"relative w-full sm:w-64",children:[e.jsx(Vo,{className:"absolute left-2 top-2.5 h-4 w-4 text-gray-500"}),e.jsx(Be,{placeholder:"Buscar hábito...",value:o,onChange:j=>l(j.target.value),className:"pl-8 pr-16"}),g.isFiltered&&e.jsxs("div",{className:"absolute right-2 top-2 bg-blue-100 text-blue-800 px-2 py-0.5 rounded-md text-xs font-medium",children:[g.filteredHabits,"/",g.totalHabits]})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsx(z,{variant:"outline",onClick:()=>h(!u),className:"flex-1 sm:flex-none",children:u?"Mostrar más frecuentes":"Mostrar todos"}),Object.keys(g.loggedByCategory).length>0&&e.jsxs("div",{className:"bg-green-100 text-green-800 px-3 py-1.5 rounded-md text-sm font-medium",children:[Object.values(g.loggedByCategory).reduce((j,v)=>j+v,0)," hoy"]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"sm:min-w-[640px]",children:u?e.jsx("div",{className:"space-y-6",children:Object.entries(p).map(([j,v])=>{if(v.length===0)return null;const w=c.includes(j),N=ko[j];return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(z,{variant:"ghost",onClick:()=>b(j),className:"w-full flex items-center justify-between p-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:N.icon}),e.jsx("span",{className:"font-medium",children:N.label}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",v.length,")"]}),g.loggedByCategory[j]&&e.jsxs("span",{className:"bg-red-100 text-red-800 px-2 py-0.5 rounded-full text-xs font-medium ml-1",children:[g.loggedByCategory[j]," hoy"]})]}),w?e.jsx(_n,{size:20}):e.jsx(rr,{size:20})]}),w&&e.jsx(yy,{habits:v,completedHabits:t,weekDays:r,onLogHabit:s,onRemoveLog:n,disabled:a})]},j)})}):e.jsx(yy,{habits:x,completedHabits:t,weekDays:r,onLogHabit:s,onRemoveLog:n,disabled:a})})}),"      ",e.jsxs(Zo,{variant:"destructive",children:[" ",e.jsx(Qo,{children:u?`Visualización completa de hábitos agrupados por categoría${g.isFiltered?` (${g.filteredHabits} de ${g.totalHabits} hábitos mostrados)`:""}. Usa el buscador para encontrar hábitos específicos.`:`Mostrando solo tus ${x.length} hábitos más frecuentes. Haz clic en "Mostrar todos" para ver la lista completa.`})]})]})},by=({habits:t,completedHabits:s,onLogHabit:n,onRemoveLog:a})=>{const r=new Date().getFullYear();return e.jsx(xa,{children:e.jsx("div",{className:"space-y-6",children:t.map(o=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 sticky top-0 bg-white z-10 py-2",children:[e.jsx("span",{className:"text-xl",children:o.icon}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:o.name}),e.jsx("p",{className:"text-sm text-gray-500",children:o.category})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx(US,{year:r,renderCell:l=>{const c=`${o.id}_${l}`,m=s[c],u=new Date().toISOString().split("T")[0]===l;return e.jsxs(Ms,{children:[e.jsx(Is,{asChild:!0,children:e.jsx(z,{variant:m?"destructive":"ghost",onClick:()=>m?a(o.id,l):n(o.id,l),className:ce("w-1 h-1 p-0 rounded-full border transition-all duration-200 hover:scale-110",m?"bg-red-600 border-red-700 hover:bg-red-700":"bg-gray-100 border-gray-200 hover:bg-gray-200 hover:border-gray-300",u&&"ring-2 ring-blue-400 ring-offset-1"),"aria-label":m?"Eliminar registro":"Registrar hábito"})}),e.jsx(ks,{children:e.jsx("p",{className:"text-sm",children:new Date(l).toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})})]},l)}})})]},o.id))})})},OB=({habits:t,onLogHabit:s,onRemoveLog:n})=>{const[a,r]=f.useState(""),[o,l]=f.useState("all"),[c,m]=f.useState(["health"]),[u,h]=f.useState(!1),p=f.useMemo(()=>{const b=new Map;return Object.entries(t).forEach(([j])=>{const[v]=j.split("_"),w=b.get(Number(v))||0;b.set(Number(v),w+1)}),yi.filter(j=>b.has(j.id)).sort((j,v)=>(b.get(v.id)||0)-(b.get(j.id)||0)).slice(0,5)},[t]),g=f.useMemo(()=>{const b={};return yi.forEach(j=>{a&&!j.name.toLowerCase().includes(a.toLowerCase())||o!=="all"&&j.category!==o||(b[j.category]||(b[j.category]=[]),b[j.category].push(j))}),b},[a,o]),x=b=>{m(j=>j.includes(b)?j.filter(v=>v!==b):[...j,b])};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Vo,{className:"absolute left-2 top-2.5 h-4 w-4 text-gray-500"}),e.jsx(Be,{placeholder:"Buscar hábito...",value:a,onChange:b=>r(b.target.value),className:"pl-8"})]}),e.jsxs(Nt,{value:o,onValueChange:l,children:[e.jsx(xt,{className:"w-full sm:w-[180px]",children:e.jsx(St,{placeholder:"Categoría"})}),e.jsxs(gt,{children:[e.jsx(Pe,{value:"all",children:"Todas las categorías"}),Object.keys(ko).map(b=>e.jsx(Pe,{value:b,children:ko[b].label},b))]})]}),e.jsx(z,{variant:"outline",onClick:()=>h(!u),className:"whitespace-nowrap",children:u?"Ver frecuentes":"Ver todos"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"sm:min-w-[800px] pb-4",children:u?e.jsx("div",{className:"space-y-8",children:Object.entries(g).map(([b,j])=>{if(j.length===0)return null;const v=c.includes(b),w=ko[b];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs(z,{variant:"ghost",onClick:()=>x(b),className:"w-full flex items-center justify-between p-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:w.icon}),e.jsx("span",{className:"font-medium",children:w.label}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",j.length,")"]})]}),v?e.jsx(_n,{size:20}):e.jsx(rr,{size:20})]}),v&&e.jsx(by,{habits:j,completedHabits:t,onLogHabit:s,onRemoveLog:n})]},b)})}):e.jsx(by,{habits:p,completedHabits:t,onLogHabit:s,onRemoveLog:n})})}),e.jsxs(Zo,{variant:"destructive",children:[" ",e.jsx(Qo,{children:u?"Vista completa de hábitos por categoría. Usa los filtros para encontrar hábitos específicos.":'Mostrando tus hábitos más frecuentes. Cambia a "Ver todos" para la lista completa.'})]})]})},LB=({category:t,habits:s,onSelectHabit:n})=>{const a=ko[t];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:a.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:a.label}),e.jsx("p",{className:"text-sm text-gray-500",children:a.description})]})]}),e.jsx($u,{className:"h-[300px] pr-4",children:e.jsx("div",{className:"grid grid-cols-2 gap-2 sm:grid-cols-3",children:s.map(r=>e.jsxs(z,{variant:"outline",className:"h-auto py-3 px-2 flex flex-col items-center gap-2 group",onClick:()=>n(r.id),children:[e.jsx("span",{className:"text-2xl group-hover:scale-110 transition-transform",children:r.icon}),e.jsx("span",{className:"text-xs text-center line-clamp-2",children:r.name})]},r.id))})})]})},$B=({onSelectHabit:t})=>{const[s,n]=f.useState("health"),a=yi.reduce((r,o)=>(r[o.category]||(r[o.category]=[]),r[o.category].push(o),r),{});return e.jsx("div",{className:"w-full",children:e.jsxs(Ga,{defaultValue:s,onValueChange:r=>n(r),className:"w-full",children:[e.jsx(qa,{className:"grid grid-cols-4 gap-2 h-auto sm:grid-cols-7",children:Object.entries(ko).map(([r,{icon:o,label:l}])=>e.jsxs(js,{value:r,className:"text-sm flex flex-col gap-1 py-2 h-auto",children:[e.jsx("span",{className:"text-xl",children:o}),e.jsx("span",{className:"hidden sm:inline text-xs",children:l})]},r))}),Object.entries(a).map(([r,o])=>e.jsx(hs,{value:r,className:"mt-4",children:e.jsx(LB,{category:r,habits:o,onSelectHabit:t})},r))]})})},zB=({isOpen:t,onClose:s,onLogHabit:n,selectedDate:a})=>e.jsx(Rt,{open:t,onOpenChange:s,children:e.jsxs(Ct,{className:"sm:max-w-[600px] max-h-[90vh] flex flex-col",children:[e.jsxs(_t,{children:[e.jsx(Pt,{children:"Registrar Hábito Negativo"}),e.jsx("p",{className:"text-sm text-gray-500",children:Zd(a)})]}),e.jsx("div",{className:"flex-1 overflow-hidden py-4",children:e.jsx($B,{onSelectHabit:n})})]})}),Pa=va("negativeHabit"),FB=Pa?`https://generativelanguage.googleapis.com/v1beta/models/${Pa.model}:generateContent`:"",BB=({habits:t,open:s,onOpenChange:n})=>{var k,D;const[a,r]=f.useState(!1),o=s!==void 0?s:a,l=n??r,[c,m]=f.useState(""),[u,h]=f.useState(""),[p,g]=f.useState(!1),[x,b]=f.useState(0),j="AIzaSyAW4Ot-z7OH4ZR3OeaN7vcbkEDlWpo1aMY",v=((k=Pa==null?void 0:Pa.prompts)==null?void 0:k.impact)??"Explica el impacto de mis hábitos negativos de acuerdo con mis registros.",w=((D=Pa==null?void 0:Pa.prompts)==null?void 0:D.action)??"Recomienda acciones para reducirlos cada vez que los registro.",N=Pa==null?void 0:Pa.params;f.useEffect(()=>{if(o){const P=S();h(`${v}
${w}
${P}`)}else h(""),m("")},[o,t]),f.useEffect(()=>{b(ba(u))},[u]);const S=()=>{const P={};let _=null,B=null;Object.keys(t).forEach(M=>{const[W,H]=M.split("_"),L=parseInt(W,10);P[L]=(P[L]||0)+1,(!_||H<_)&&(_=H),(!B||H>B)&&(B=H)});const I=_&&B?`Datos del ${_} al ${B}`:"Sin registros",R=yi.map(M=>`- ${M.name}: ${P[M.id]||0}`).join(`
`);return`${I}
${R}`},E=async()=>{var P,_,B,I,R;g(!0);try{const W=await(await fetch(`${FB}?key=${j}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:u}]}],...N})})).json(),H=(R=(I=(B=(_=(P=W==null?void 0:W.candidates)==null?void 0:P[0])==null?void 0:_.content)==null?void 0:B.parts)==null?void 0:I[0])==null?void 0:R.text;m(H||"No se pudo obtener sugerencia")}catch{m("Error al consultar la API")}finally{g(!1)}},T=()=>{l(!1),m(""),h(""),b(0)};return e.jsxs(Rt,{open:o,onOpenChange:P=>P?l(!0):T(),children:[s===void 0&&e.jsxs(z,{size:"sm",variant:"outline",onClick:()=>l(!0),className:"flex items-center gap-2",children:[e.jsx($s,{className:"w-4 h-4"}),"Analizar hábitos"]}),e.jsxs(Ct,{className:"w-[95vw] h-[90vh] max-w-none max-h-none overflow-hidden flex flex-col sm:w-[90vw] sm:h-[85vh]",children:[e.jsxs(_t,{className:"flex-shrink-0",children:[e.jsx(Pt,{className:"text-xl",children:"Análisis de Hábitos Negativos con IA"}),e.jsx(rn,{children:"La IA analizará el impacto de tus hábitos negativos y te recomendará acciones específicas para reducirlos. Usa el panel izquierdo para editar el prompt y visualiza el resultado en el panel derecho."})]}),e.jsxs("div",{className:"flex-1 flex flex-col sm:flex-row gap-4 min-h-0 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[e.jsxs("div",{className:"flex-1 flex flex-col mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2 flex-shrink-0",children:"Prompt para IA"}),e.jsx(kt,{value:u,onChange:P=>h(P.target.value),className:"flex-1 resize-none min-h-0",placeholder:"Datos de hábitos negativos para analizar..."})]}),e.jsxs("div",{className:"flex flex-col gap-3 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("span",{className:"text-gray-500",children:["Tokens: ",x]}),x>3500&&e.jsx("span",{className:"text-red-500 font-medium",children:"¡Prompt demasiado largo!"})]}),e.jsxs(z,{onClick:E,disabled:p||!j||x>3500,className:"w-full flex items-center justify-center gap-2",size:"lg",children:[p&&e.jsx(ls,{className:"w-4 h-4 animate-spin"}),e.jsx($s,{className:"w-4 h-4"}),p?"Consultando IA...":"Obtener análisis"]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 sm:border-l sm:border-gray-200 sm:pl-4 border-t sm:border-t-0 border-gray-200 pt-4 sm:pt-0",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Impacto y recomendaciones"}),c&&e.jsxs(z,{type:"button",size:"sm",variant:"outline",onClick:()=>{navigator.clipboard.writeText(c),vt.success("Análisis copiado al portapapeles")},className:"flex items-center gap-1",children:[e.jsx(Ua,{className:"w-4 h-4"}),"Copiar"]})]}),e.jsx("div",{className:"flex-1 flex flex-col min-h-0",children:e.jsx("div",{className:"flex-1 bg-gray-50 border border-gray-200 rounded-md p-4 overflow-auto",children:c?e.jsx("div",{className:"prose prose-sm max-w-none text-gray-700",dangerouslySetInnerHTML:{__html:Fr.sanitize(c.replace(/\n/g,"<br>"))}}):p?e.jsx("div",{className:"text-sm text-gray-500",children:"Analizando impacto de hábitos negativos..."}):e.jsx("div",{className:"text-sm text-gray-500",children:"El análisis del impacto de tus hábitos negativos aparecerá aquí. La IA te dará recomendaciones específicas para reducir cada hábito."})})})]})]}),e.jsx("div",{className:"flex-shrink-0 mt-4 pt-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 text-xs text-gray-500",children:[e.jsx("span",{children:"💡 Tip: Sé honesto con tus registros para obtener mejores recomendaciones"}),!j]})})]})]})},HB=({habits:t})=>{const[s,n]=f.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsxs(Ba,{children:[e.jsx(Ha,{asChild:!0,children:e.jsxs(z,{size:"sm",variant:"outline",className:"flex items-center gap-2 text-blue-600",children:[e.jsx($s,{className:"w-4 h-4"}),"IA"]})}),e.jsx(pa,{align:"end",children:e.jsx(Lt,{onSelect:()=>n(!0),children:"Analizar hábitos"})})]}),e.jsx(BB,{habits:t,open:s,onOpenChange:n})]})},WB=()=>{const[t,s]=f.useState("weekly"),[n,a]=f.useState(new Date),[r,o]=f.useState(!1),{user:l}=qe(),{habits:c,status:m,error:u,logHabit:h,removeLog:p,resync:g}=PB(),{isOnline:x}=Va(),b=async(j,v)=>{await h(j,$e(n),v),o(!1)};return l?e.jsxs(Xs,{children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Hábitos Negativos"}),e.jsx("p",{className:"text-gray-500",children:"Identifica y reduce comportamientos que quieres cambiar"})]}),e.jsx(or,{selectedDate:n,onChange:a}),e.jsxs(Ne,{className:"w-full",children:[e.jsxs(De,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"font-medium text-lg",children:"Registro de Hábitos"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Identifica y registra los hábitos que deseas cambiar"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(HB,{habits:c}),e.jsx(MB,{view:t,onViewChange:s})]})]}),t==="weekly"?e.jsx(IB,{habits:c,onLogHabit:h,onRemoveLog:p,disabled:m==="saving"||!x}):e.jsx(OB,{habits:c,onLogHabit:h,onRemoveLog:p}),u&&e.jsx("p",{className:"mt-4 text-sm text-red-500",children:u})]}),e.jsxs(bn,{className:"justify-center gap-2 text-xs p-2",children:[m==="saving"&&e.jsx("span",{className:"text-blue-500",children:"Guardando..."}),m==="pending"&&e.jsx("span",{className:"text-yellow-600",children:"Pendiente de sincronizar"}),m==="saved"&&e.jsx("span",{className:"text-green-600",children:"Sincronizado"}),m==="error"&&e.jsx("span",{className:"text-red-600",children:"Error de sincronización"}),!x&&e.jsx("span",{className:"text-orange-600",children:"Offline"}),e.jsx(z,{onClick:g,variant:"link",className:"p-0 h-auto",children:"Reintentar"})]})]}),e.jsx(zB,{isOpen:r,onClose:()=>o(!1),onLogHabit:b,selectedDate:n})]}):e.jsx(Xs,{children:e.jsx(Ne,{className:"w-full",children:e.jsx(De,{className:"p-4 text-center",children:e.jsx("p",{children:"Inicia sesión para registrar tus hábitos negativos"})})})})},jy={journal:{words:0},mood:{count:0,average:0,highest:0,lowest:0},habits:{completed:0,total:18,incompletedByTimeOfDay:[]},negativeHabits:{count:0},exercise:{minutes:0,calories:0},tasks:{completed:0,activeAndOverdue:0,todayPending:0,overdue:0},pomodoro:{count:0,expectedMinutes:0,workMinutes:0,completionRate:0,averageSessionLength:0},water:{intake:0,drinkDetails:[]}},UB=t=>{const{user:s}=qe(),[n,a]=f.useState({daily:[],totals:{...jy}}),[r,o]=f.useState(!0),[l,c]=f.useState(null),m=f.useCallback(async()=>{if(!s){o(!1);return}o(!0),c(null);try{const h=[];for(let v=0;v<7;v++){const w=new Date(t);w.setDate(t.getDate()+v),h.push(w)}const p=h.map(v=>Dj(s.uid,v)),g=await Promise.all(p),x=[],b={...jy};h.forEach((v,w)=>{const N=$e(v),S=g[w];x.push({date:N,summary:S}),b.journal.words+=S.journal.words,b.mood.count+=S.mood.count,b.habits.completed+=S.habits.completed,b.negativeHabits.count+=S.negativeHabits.count,b.exercise.minutes+=S.exercise.minutes,b.exercise.calories+=S.exercise.calories,b.water.intake+=S.water.intake,b.tasks.completed+=S.tasks.completed,b.tasks.activeAndOverdue+=S.tasks.activeAndOverdue,b.tasks.todayPending+=S.tasks.todayPending,b.tasks.overdue+=S.tasks.overdue,b.pomodoro.count+=S.pomodoro.count,b.pomodoro.workMinutes+=S.pomodoro.workMinutes});const j=300*7;b.pomodoro.expectedMinutes=j,b.pomodoro.completionRate=j>0?Math.min(100,b.pomodoro.workMinutes/j*100):0,b.pomodoro.averageSessionLength=b.pomodoro.count>0?b.pomodoro.workMinutes/b.pomodoro.count:0,b.pomodoro.completionRate=parseFloat(b.pomodoro.completionRate.toFixed(1)),b.pomodoro.averageSessionLength=parseFloat(b.pomodoro.averageSessionLength.toFixed(1)),a({daily:x,totals:b}),o(!1)}catch(h){console.error("Error loading weekly summary:",h),c(h instanceof Error?h.message:"Error loading weekly summary"),o(!1)}},[s,t]);f.useEffect(()=>{m()},[m]);const u=f.useCallback(()=>{m()},[m]);return{summary:n,loading:r,error:l,refetch:u}},VB=f.lazy(()=>Ko(()=>import("../chunks/DailySummary-rbKYXQn_.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(t=>({default:t.DailySummary}))),GB=f.lazy(()=>Ko(()=>import("../chunks/WeeklySummary-CyIkJVNt.js"),__vite__mapDeps([8,1,2,3,7,5,6])).then(t=>({default:t.WeeklySummary}))),wy=f.lazy(()=>Ko(()=>import("../chunks/AiInsightCard-BYL9F76a.js"),__vite__mapDeps([9,1,2,3,5,6])).then(t=>({default:t.AiInsightCard}))),qB=f.lazy(()=>Ko(()=>import("../chunks/DailyDashboard-Cj8t_bBz.js"),__vite__mapDeps([10,1,2,3,4,5,6])).then(t=>({default:t.DailyDashboard}))),YB=f.lazy(()=>Ko(()=>import("../chunks/WeeklyDashboard-DZGnH1G0.js"),__vite__mapDeps([11,1,2,3,4,5,6])).then(t=>({default:t.WeeklyDashboard}))),Ny=t=>at(t,"PP",{locale:kn}),KB=()=>{const[t,s]=f.useState(new Date),[n,a]=f.useState(()=>{const o=new Date;return o.setDate(o.getDate()-o.getDay()),o}),{summary:r}=UB(n);return e.jsxs(Xs,{children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Estadísticas"})}),e.jsxs(Ga,{defaultValue:"daily",className:"space-y-4",children:[e.jsxs(qa,{children:[e.jsx(js,{value:"daily",children:"Diario"}),e.jsx(js,{value:"weekly",children:"Semanal"})]}),e.jsxs(hs,{value:"daily",className:"space-y-4",children:[e.jsx(or,{selectedDate:t,onChange:s}),e.jsx(f.Suspense,{fallback:e.jsx("div",{className:"h-24"}),children:e.jsx(qB,{date:t})}),e.jsx(f.Suspense,{fallback:e.jsx("div",{className:"h-24"}),children:e.jsx(VB,{date:t})}),e.jsx(f.Suspense,{fallback:e.jsx("div",{className:"h-24"}),children:e.jsx(wy,{date:Ny(t),dayDate:t})})]}),e.jsxs(hs,{value:"weekly",className:"space-y-4",children:[e.jsx(or,{selectedDate:n,onChange:a}),e.jsx(f.Suspense,{fallback:e.jsx("div",{className:"h-24"}),children:e.jsx(YB,{startDate:n})}),e.jsx(f.Suspense,{fallback:e.jsx("div",{className:"h-24"}),children:e.jsx(GB,{startDate:n})}),e.jsx(f.Suspense,{fallback:e.jsx("div",{className:"h-24"}),children:e.jsx(wy,{data:r,date:`Semana del ${Ny(n)}`})})]})]})]})};var Lc=t=>t.type==="checkbox",Ki=t=>t instanceof Date,Dn=t=>t==null;const lC=t=>typeof t=="object";var Ls=t=>!Dn(t)&&!Array.isArray(t)&&lC(t)&&!Ki(t),JB=t=>Ls(t)&&t.target?Lc(t.target)?t.target.checked:t.target.value:t,XB=t=>t.substring(0,t.search(/\.\d+(\.|$)/))||t,ZB=(t,s)=>t.has(XB(s)),QB=t=>{const s=t.constructor&&t.constructor.prototype;return Ls(s)&&s.hasOwnProperty("isPrototypeOf")},ix=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function en(t){let s;const n=Array.isArray(t),a=typeof FileList<"u"?t instanceof FileList:!1;if(t instanceof Date)s=new Date(t);else if(!(ix&&(t instanceof Blob||a))&&(n||Ls(t)))if(s=n?[]:{},!n&&!QB(t))s=t;else for(const r in t)t.hasOwnProperty(r)&&(s[r]=en(t[r]));else return t;return s}var Xu=t=>/^\w*$/.test(t),Hs=t=>t===void 0,ox=t=>Array.isArray(t)?t.filter(Boolean):[],lx=t=>ox(t.replace(/["|']|\]/g,"").split(/\.|\[/)),ze=(t,s,n)=>{if(!s||!Ls(t))return n;const a=(Xu(s)?[s]:lx(s)).reduce((r,o)=>Dn(r)?r:r[o],t);return Hs(a)||a===t?Hs(t[s])?n:t[s]:a},er=t=>typeof t=="boolean",bs=(t,s,n)=>{let a=-1;const r=Xu(s)?[s]:lx(s),o=r.length,l=o-1;for(;++a<o;){const c=r[a];let m=n;if(a!==l){const u=t[c];m=Ls(u)||Array.isArray(u)?u:isNaN(+r[a+1])?{}:[]}if(c==="__proto__"||c==="constructor"||c==="prototype")return;t[c]=m,t=t[c]}};const Sy={BLUR:"blur",FOCUS_OUT:"focusout"},Oa={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},Ar={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},eH=Z.createContext(null);eH.displayName="HookFormContext";var tH=(t,s,n,a=!0)=>{const r={defaultValues:s._defaultValues};for(const o in t)Object.defineProperty(r,o,{get:()=>{const l=o;return s._proxyFormState[l]!==Oa.all&&(s._proxyFormState[l]=!a||Oa.all),t[l]}});return r};const sH=typeof window<"u"?f.useLayoutEffect:f.useEffect;var nr=t=>typeof t=="string",nH=(t,s,n,a,r)=>nr(t)?(a&&s.watch.add(t),ze(n,t,r)):Array.isArray(t)?t.map(o=>(a&&s.watch.add(o),ze(n,o))):(a&&(s.watchAll=!0),n),aH=(t,s,n,a,r)=>s?{...n[t],types:{...n[t]&&n[t].types?n[t].types:{},[a]:r||!0}}:{},Ql=t=>Array.isArray(t)?t:[t],Cy=()=>{let t=[];return{get observers(){return t},next:r=>{for(const o of t)o.next&&o.next(r)},subscribe:r=>(t.push(r),{unsubscribe:()=>{t=t.filter(o=>o!==r)}}),unsubscribe:()=>{t=[]}}},Rf=t=>Dn(t)||!lC(t);function pi(t,s,n=new WeakSet){if(Rf(t)||Rf(s))return t===s;if(Ki(t)&&Ki(s))return t.getTime()===s.getTime();const a=Object.keys(t),r=Object.keys(s);if(a.length!==r.length)return!1;if(n.has(t)||n.has(s))return!0;n.add(t),n.add(s);for(const o of a){const l=t[o];if(!r.includes(o))return!1;if(o!=="ref"){const c=s[o];if(Ki(l)&&Ki(c)||Ls(l)&&Ls(c)||Array.isArray(l)&&Array.isArray(c)?!pi(l,c,n):l!==c)return!1}}return!0}var Fn=t=>Ls(t)&&!Object.keys(t).length,cx=t=>t.type==="file",La=t=>typeof t=="function",hu=t=>{if(!ix)return!1;const s=t?t.ownerDocument:0;return t instanceof(s&&s.defaultView?s.defaultView.HTMLElement:HTMLElement)},cC=t=>t.type==="select-multiple",dx=t=>t.type==="radio",rH=t=>dx(t)||Lc(t),zh=t=>hu(t)&&t.isConnected;function iH(t,s){const n=s.slice(0,-1).length;let a=0;for(;a<n;)t=Hs(t)?a++:t[s[a++]];return t}function oH(t){for(const s in t)if(t.hasOwnProperty(s)&&!Hs(t[s]))return!1;return!0}function Bs(t,s){const n=Array.isArray(s)?s:Xu(s)?[s]:lx(s),a=n.length===1?t:iH(t,n),r=n.length-1,o=n[r];return a&&delete a[o],r!==0&&(Ls(a)&&Fn(a)||Array.isArray(a)&&oH(a))&&Bs(t,n.slice(0,-1)),t}var dC=t=>{for(const s in t)if(La(t[s]))return!0;return!1};function fu(t,s={}){const n=Array.isArray(t);if(Ls(t)||n)for(const a in t)Array.isArray(t[a])||Ls(t[a])&&!dC(t[a])?(s[a]=Array.isArray(t[a])?[]:{},fu(t[a],s[a])):Dn(t[a])||(s[a]=!0);return s}function uC(t,s,n){const a=Array.isArray(t);if(Ls(t)||a)for(const r in t)Array.isArray(t[r])||Ls(t[r])&&!dC(t[r])?Hs(s)||Rf(n[r])?n[r]=Array.isArray(t[r])?fu(t[r],[]):{...fu(t[r])}:uC(t[r],Dn(s)?{}:s[r],n[r]):n[r]=!pi(t[r],s[r]);return n}var Fl=(t,s)=>uC(t,s,fu(s));const Ey={value:!1,isValid:!1},Ty={value:!0,isValid:!0};var mC=t=>{if(Array.isArray(t)){if(t.length>1){const s=t.filter(n=>n&&n.checked&&!n.disabled).map(n=>n.value);return{value:s,isValid:!!s.length}}return t[0].checked&&!t[0].disabled?t[0].attributes&&!Hs(t[0].attributes.value)?Hs(t[0].value)||t[0].value===""?Ty:{value:t[0].value,isValid:!0}:Ty:Ey}return Ey},hC=(t,{valueAsNumber:s,valueAsDate:n,setValueAs:a})=>Hs(t)?t:s?t===""?NaN:t&&+t:n&&nr(t)?new Date(t):a?a(t):t;const Dy={isValid:!1,value:null};var fC=t=>Array.isArray(t)?t.reduce((s,n)=>n&&n.checked&&!n.disabled?{isValid:!0,value:n.value}:s,Dy):Dy;function ky(t){const s=t.ref;return cx(s)?s.files:dx(s)?fC(t.refs).value:cC(s)?[...s.selectedOptions].map(({value:n})=>n):Lc(s)?mC(t.refs).value:hC(Hs(s.value)?t.ref.value:s.value,t)}var lH=(t,s,n,a)=>{const r={};for(const o of t){const l=ze(s,o);l&&bs(r,o,l._f)}return{criteriaMode:n,names:[...t],fields:r,shouldUseNativeValidation:a}},pu=t=>t instanceof RegExp,Bl=t=>Hs(t)?t:pu(t)?t.source:Ls(t)?pu(t.value)?t.value.source:t.value:t,Ay=t=>({isOnSubmit:!t||t===Oa.onSubmit,isOnBlur:t===Oa.onBlur,isOnChange:t===Oa.onChange,isOnAll:t===Oa.all,isOnTouch:t===Oa.onTouched});const Ry="AsyncFunction";var cH=t=>!!t&&!!t.validate&&!!(La(t.validate)&&t.validate.constructor.name===Ry||Ls(t.validate)&&Object.values(t.validate).find(s=>s.constructor.name===Ry)),dH=t=>t.mount&&(t.required||t.min||t.max||t.maxLength||t.minLength||t.pattern||t.validate),_y=(t,s,n)=>!n&&(s.watchAll||s.watch.has(t)||[...s.watch].some(a=>t.startsWith(a)&&/^\.\w+/.test(t.slice(a.length))));const ec=(t,s,n,a)=>{for(const r of n||Object.keys(t)){const o=ze(t,r);if(o){const{_f:l,...c}=o;if(l){if(l.refs&&l.refs[0]&&s(l.refs[0],r)&&!a)return!0;if(l.ref&&s(l.ref,l.name)&&!a)return!0;if(ec(c,s))break}else if(Ls(c)&&ec(c,s))break}}};function Py(t,s,n){const a=ze(t,n);if(a||Xu(n))return{error:a,name:n};const r=n.split(".");for(;r.length;){const o=r.join("."),l=ze(s,o),c=ze(t,o);if(l&&!Array.isArray(l)&&n!==o)return{name:n};if(c&&c.type)return{name:o,error:c};if(c&&c.root&&c.root.type)return{name:`${o}.root`,error:c.root};r.pop()}return{name:n}}var uH=(t,s,n,a)=>{n(t);const{name:r,...o}=t;return Fn(o)||Object.keys(o).length>=Object.keys(s).length||Object.keys(o).find(l=>s[l]===(!a||Oa.all))},mH=(t,s,n)=>!t||!s||t===s||Ql(t).some(a=>a&&(n?a===s:a.startsWith(s)||s.startsWith(a))),hH=(t,s,n,a,r)=>r.isOnAll?!1:!n&&r.isOnTouch?!(s||t):(n?a.isOnBlur:r.isOnBlur)?!t:(n?a.isOnChange:r.isOnChange)?t:!0,fH=(t,s)=>!ox(ze(t,s)).length&&Bs(t,s),pH=(t,s,n)=>{const a=Ql(ze(t,n));return bs(a,"root",s[n]),bs(t,n,a),t},Vd=t=>nr(t);function My(t,s,n="validate"){if(Vd(t)||Array.isArray(t)&&t.every(Vd)||er(t)&&!t)return{type:n,message:Vd(t)?t:"",ref:s}}var So=t=>Ls(t)&&!pu(t)?t:{value:t,message:""},Iy=async(t,s,n,a,r,o)=>{const{ref:l,refs:c,required:m,maxLength:u,minLength:h,min:p,max:g,pattern:x,validate:b,name:j,valueAsNumber:v,mount:w}=t._f,N=ze(n,j);if(!w||s.has(j))return{};const S=c?c[0]:l,E=R=>{r&&S.reportValidity&&(S.setCustomValidity(er(R)?"":R||""),S.reportValidity())},T={},k=dx(l),D=Lc(l),P=k||D,_=(v||cx(l))&&Hs(l.value)&&Hs(N)||hu(l)&&l.value===""||N===""||Array.isArray(N)&&!N.length,B=aH.bind(null,j,a,T),I=(R,M,W,H=Ar.maxLength,L=Ar.minLength)=>{const $=R?M:W;T[j]={type:R?H:L,message:$,ref:l,...B(R?H:L,$)}};if(o?!Array.isArray(N)||!N.length:m&&(!P&&(_||Dn(N))||er(N)&&!N||D&&!mC(c).isValid||k&&!fC(c).isValid)){const{value:R,message:M}=Vd(m)?{value:!!m,message:m}:So(m);if(R&&(T[j]={type:Ar.required,message:M,ref:S,...B(Ar.required,M)},!a))return E(M),T}if(!_&&(!Dn(p)||!Dn(g))){let R,M;const W=So(g),H=So(p);if(!Dn(N)&&!isNaN(N)){const L=l.valueAsNumber||N&&+N;Dn(W.value)||(R=L>W.value),Dn(H.value)||(M=L<H.value)}else{const L=l.valueAsDate||new Date(N),$=Y=>new Date(new Date().toDateString()+" "+Y),q=l.type=="time",re=l.type=="week";nr(W.value)&&N&&(R=q?$(N)>$(W.value):re?N>W.value:L>new Date(W.value)),nr(H.value)&&N&&(M=q?$(N)<$(H.value):re?N<H.value:L<new Date(H.value))}if((R||M)&&(I(!!R,W.message,H.message,Ar.max,Ar.min),!a))return E(T[j].message),T}if((u||h)&&!_&&(nr(N)||o&&Array.isArray(N))){const R=So(u),M=So(h),W=!Dn(R.value)&&N.length>+R.value,H=!Dn(M.value)&&N.length<+M.value;if((W||H)&&(I(W,R.message,M.message),!a))return E(T[j].message),T}if(x&&!_&&nr(N)){const{value:R,message:M}=So(x);if(pu(R)&&!N.match(R)&&(T[j]={type:Ar.pattern,message:M,ref:l,...B(Ar.pattern,M)},!a))return E(M),T}if(b){if(La(b)){const R=await b(N,n),M=My(R,S);if(M&&(T[j]={...M,...B(Ar.validate,M.message)},!a))return E(M.message),T}else if(Ls(b)){let R={};for(const M in b){if(!Fn(R)&&!a)break;const W=My(await b[M](N,n),S,M);W&&(R={...W,...B(M,W.message)},E(W.message),a&&(T[j]=R))}if(!Fn(R)&&(T[j]={ref:S,...R},!a))return T}}return E(!0),T};const xH={mode:Oa.onSubmit,reValidateMode:Oa.onChange,shouldFocusError:!0};function gH(t={}){let s={...xH,...t},n={submitCount:0,isDirty:!1,isReady:!1,isLoading:La(s.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:s.errors||{},disabled:s.disabled||!1},a={},r=Ls(s.defaultValues)||Ls(s.values)?en(s.defaultValues||s.values)||{}:{},o=s.shouldUnregister?{}:en(r),l={action:!1,mount:!1,watch:!1},c={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},m,u=0;const h={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let p={...h};const g={array:Cy(),state:Cy()},x=s.criteriaMode===Oa.all,b=G=>te=>{clearTimeout(u),u=setTimeout(G,te)},j=async G=>{if(!s.disabled&&(h.isValid||p.isValid||G)){const te=s.resolver?Fn((await D()).errors):await _(a,!0);te!==n.isValid&&g.state.next({isValid:te})}},v=(G,te)=>{!s.disabled&&(h.isValidating||h.validatingFields||p.isValidating||p.validatingFields)&&((G||Array.from(c.mount)).forEach(le=>{le&&(te?bs(n.validatingFields,le,te):Bs(n.validatingFields,le))}),g.state.next({validatingFields:n.validatingFields,isValidating:!Fn(n.validatingFields)}))},w=(G,te=[],le,Ce,Se=!0,be=!0)=>{if(Ce&&le&&!s.disabled){if(l.action=!0,be&&Array.isArray(ze(a,G))){const Re=le(ze(a,G),Ce.argA,Ce.argB);Se&&bs(a,G,Re)}if(be&&Array.isArray(ze(n.errors,G))){const Re=le(ze(n.errors,G),Ce.argA,Ce.argB);Se&&bs(n.errors,G,Re),fH(n.errors,G)}if((h.touchedFields||p.touchedFields)&&be&&Array.isArray(ze(n.touchedFields,G))){const Re=le(ze(n.touchedFields,G),Ce.argA,Ce.argB);Se&&bs(n.touchedFields,G,Re)}(h.dirtyFields||p.dirtyFields)&&(n.dirtyFields=Fl(r,o)),g.state.next({name:G,isDirty:I(G,te),dirtyFields:n.dirtyFields,errors:n.errors,isValid:n.isValid})}else bs(o,G,te)},N=(G,te)=>{bs(n.errors,G,te),g.state.next({errors:n.errors})},S=G=>{n.errors=G,g.state.next({errors:n.errors,isValid:!1})},E=(G,te,le,Ce)=>{const Se=ze(a,G);if(Se){const be=ze(o,G,Hs(le)?ze(r,G):le);Hs(be)||Ce&&Ce.defaultChecked||te?bs(o,G,te?be:ky(Se._f)):W(G,be),l.mount&&j()}},T=(G,te,le,Ce,Se)=>{let be=!1,Re=!1;const Ve={name:G};if(!s.disabled){if(!le||Ce){(h.isDirty||p.isDirty)&&(Re=n.isDirty,n.isDirty=Ve.isDirty=I(),be=Re!==Ve.isDirty);const Qe=pi(ze(r,G),te);Re=!!ze(n.dirtyFields,G),Qe?Bs(n.dirtyFields,G):bs(n.dirtyFields,G,!0),Ve.dirtyFields=n.dirtyFields,be=be||(h.dirtyFields||p.dirtyFields)&&Re!==!Qe}if(le){const Qe=ze(n.touchedFields,G);Qe||(bs(n.touchedFields,G,le),Ve.touchedFields=n.touchedFields,be=be||(h.touchedFields||p.touchedFields)&&Qe!==le)}be&&Se&&g.state.next(Ve)}return be?Ve:{}},k=(G,te,le,Ce)=>{const Se=ze(n.errors,G),be=(h.isValid||p.isValid)&&er(te)&&n.isValid!==te;if(s.delayError&&le?(m=b(()=>N(G,le)),m(s.delayError)):(clearTimeout(u),m=null,le?bs(n.errors,G,le):Bs(n.errors,G)),(le?!pi(Se,le):Se)||!Fn(Ce)||be){const Re={...Ce,...be&&er(te)?{isValid:te}:{},errors:n.errors,name:G};n={...n,...Re},g.state.next(Re)}},D=async G=>{v(G,!0);const te=await s.resolver(o,s.context,lH(G||c.mount,a,s.criteriaMode,s.shouldUseNativeValidation));return v(G),te},P=async G=>{const{errors:te}=await D(G);if(G)for(const le of G){const Ce=ze(te,le);Ce?bs(n.errors,le,Ce):Bs(n.errors,le)}else n.errors=te;return te},_=async(G,te,le={valid:!0})=>{for(const Ce in G){const Se=G[Ce];if(Se){const{_f:be,...Re}=Se;if(be){const Ve=c.array.has(be.name),Qe=Se._f&&cH(Se._f);Qe&&h.validatingFields&&v([Ce],!0);const Yt=await Iy(Se,c.disabled,o,x,s.shouldUseNativeValidation&&!te,Ve);if(Qe&&h.validatingFields&&v([Ce]),Yt[be.name]&&(le.valid=!1,te))break;!te&&(ze(Yt,be.name)?Ve?pH(n.errors,Yt,be.name):bs(n.errors,be.name,Yt[be.name]):Bs(n.errors,be.name))}!Fn(Re)&&await _(Re,te,le)}}return le.valid},B=()=>{for(const G of c.unMount){const te=ze(a,G);te&&(te._f.refs?te._f.refs.every(le=>!zh(le)):!zh(te._f.ref))&&ae(G)}c.unMount=new Set},I=(G,te)=>!s.disabled&&(G&&te&&bs(o,G,te),!pi(Y(),r)),R=(G,te,le)=>nH(G,c,{...l.mount?o:Hs(te)?r:nr(G)?{[G]:te}:te},le,te),M=G=>ox(ze(l.mount?o:r,G,s.shouldUnregister?ze(r,G,[]):[])),W=(G,te,le={})=>{const Ce=ze(a,G);let Se=te;if(Ce){const be=Ce._f;be&&(!be.disabled&&bs(o,G,hC(te,be)),Se=hu(be.ref)&&Dn(te)?"":te,cC(be.ref)?[...be.ref.options].forEach(Re=>Re.selected=Se.includes(Re.value)):be.refs?Lc(be.ref)?be.refs.forEach(Re=>{(!Re.defaultChecked||!Re.disabled)&&(Array.isArray(Se)?Re.checked=!!Se.find(Ve=>Ve===Re.value):Re.checked=Se===Re.value||!!Se)}):be.refs.forEach(Re=>Re.checked=Re.value===Se):cx(be.ref)?be.ref.value="":(be.ref.value=Se,be.ref.type||g.state.next({name:G,values:en(o)})))}(le.shouldDirty||le.shouldTouch)&&T(G,Se,le.shouldTouch,le.shouldDirty,!0),le.shouldValidate&&re(G)},H=(G,te,le)=>{for(const Ce in te){if(!te.hasOwnProperty(Ce))return;const Se=te[Ce],be=G+"."+Ce,Re=ze(a,be);(c.array.has(G)||Ls(Se)||Re&&!Re._f)&&!Ki(Se)?H(be,Se,le):W(be,Se,le)}},L=(G,te,le={})=>{const Ce=ze(a,G),Se=c.array.has(G),be=en(te);bs(o,G,be),Se?(g.array.next({name:G,values:en(o)}),(h.isDirty||h.dirtyFields||p.isDirty||p.dirtyFields)&&le.shouldDirty&&g.state.next({name:G,dirtyFields:Fl(r,o),isDirty:I(G,be)})):Ce&&!Ce._f&&!Dn(be)?H(G,be,le):W(G,be,le),_y(G,c)&&g.state.next({...n}),g.state.next({name:l.mount?G:void 0,values:en(o)})},$=async G=>{l.mount=!0;const te=G.target;let le=te.name,Ce=!0;const Se=ze(a,le),be=Qe=>{Ce=Number.isNaN(Qe)||Ki(Qe)&&isNaN(Qe.getTime())||pi(Qe,ze(o,le,Qe))},Re=Ay(s.mode),Ve=Ay(s.reValidateMode);if(Se){let Qe,Yt;const Cs=te.type?ky(Se._f):JB(G),Ut=G.type===Sy.BLUR||G.type===Sy.FOCUS_OUT,Us=!dH(Se._f)&&!s.resolver&&!ze(n.errors,le)&&!Se._f.deps||hH(Ut,ze(n.touchedFields,le),n.isSubmitted,Ve,Re),Fs=_y(le,c,Ut);bs(o,le,Cs),Ut?(Se._f.onBlur&&Se._f.onBlur(G),m&&m(0)):Se._f.onChange&&Se._f.onChange(G);const ss=T(le,Cs,Ut),Rs=!Fn(ss)||Fs;if(!Ut&&g.state.next({name:le,type:G.type,values:en(o)}),Us)return(h.isValid||p.isValid)&&(s.mode==="onBlur"?Ut&&j():Ut||j()),Rs&&g.state.next({name:le,...Fs?{}:ss});if(!Ut&&Fs&&g.state.next({...n}),s.resolver){const{errors:Es}=await D([le]);if(be(Cs),Ce){const Nn=Py(n.errors,a,le),We=Py(Es,a,Nn.name||le);Qe=We.error,le=We.name,Yt=Fn(Es)}}else v([le],!0),Qe=(await Iy(Se,c.disabled,o,x,s.shouldUseNativeValidation))[le],v([le]),be(Cs),Ce&&(Qe?Yt=!1:(h.isValid||p.isValid)&&(Yt=await _(a,!0)));Ce&&(Se._f.deps&&re(Se._f.deps),k(le,Yt,Qe,ss))}},q=(G,te)=>{if(ze(n.errors,te)&&G.focus)return G.focus(),1},re=async(G,te={})=>{let le,Ce;const Se=Ql(G);if(s.resolver){const be=await P(Hs(G)?G:Se);le=Fn(be),Ce=G?!Se.some(Re=>ze(be,Re)):le}else G?(Ce=(await Promise.all(Se.map(async be=>{const Re=ze(a,be);return await _(Re&&Re._f?{[be]:Re}:Re)}))).every(Boolean),!(!Ce&&!n.isValid)&&j()):Ce=le=await _(a);return g.state.next({...!nr(G)||(h.isValid||p.isValid)&&le!==n.isValid?{}:{name:G},...s.resolver||!G?{isValid:le}:{},errors:n.errors}),te.shouldFocus&&!Ce&&ec(a,q,G?Se:c.mount),Ce},Y=G=>{const te={...l.mount?o:r};return Hs(G)?te:nr(G)?ze(te,G):G.map(le=>ze(te,le))},se=(G,te)=>({invalid:!!ze((te||n).errors,G),isDirty:!!ze((te||n).dirtyFields,G),error:ze((te||n).errors,G),isValidating:!!ze(n.validatingFields,G),isTouched:!!ze((te||n).touchedFields,G)}),ie=G=>{G&&Ql(G).forEach(te=>Bs(n.errors,te)),g.state.next({errors:G?n.errors:{}})},U=(G,te,le)=>{const Ce=(ze(a,G,{_f:{}})._f||{}).ref,Se=ze(n.errors,G)||{},{ref:be,message:Re,type:Ve,...Qe}=Se;bs(n.errors,G,{...Qe,...te,ref:Ce}),g.state.next({name:G,errors:n.errors,isValid:!1}),le&&le.shouldFocus&&Ce&&Ce.focus&&Ce.focus()},ee=(G,te)=>La(G)?g.state.subscribe({next:le=>G(R(void 0,te),le)}):R(G,te,!0),me=G=>g.state.subscribe({next:te=>{mH(G.name,te.name,G.exact)&&uH(te,G.formState||h,ot,G.reRenderRoot)&&G.callback({values:{...o},...n,...te})}}).unsubscribe,ue=G=>(l.mount=!0,p={...p,...G.formState},me({...G,formState:p})),ae=(G,te={})=>{for(const le of G?Ql(G):c.mount)c.mount.delete(le),c.array.delete(le),te.keepValue||(Bs(a,le),Bs(o,le)),!te.keepError&&Bs(n.errors,le),!te.keepDirty&&Bs(n.dirtyFields,le),!te.keepTouched&&Bs(n.touchedFields,le),!te.keepIsValidating&&Bs(n.validatingFields,le),!s.shouldUnregister&&!te.keepDefaultValue&&Bs(r,le);g.state.next({values:en(o)}),g.state.next({...n,...te.keepDirty?{isDirty:I()}:{}}),!te.keepIsValid&&j()},ge=({disabled:G,name:te})=>{(er(G)&&l.mount||G||c.disabled.has(te))&&(G?c.disabled.add(te):c.disabled.delete(te))},je=(G,te={})=>{let le=ze(a,G);const Ce=er(te.disabled)||er(s.disabled);return bs(a,G,{...le||{},_f:{...le&&le._f?le._f:{ref:{name:G}},name:G,mount:!0,...te}}),c.mount.add(G),le?ge({disabled:er(te.disabled)?te.disabled:s.disabled,name:G}):E(G,!0,te.value),{...Ce?{disabled:te.disabled||s.disabled}:{},...s.progressive?{required:!!te.required,min:Bl(te.min),max:Bl(te.max),minLength:Bl(te.minLength),maxLength:Bl(te.maxLength),pattern:Bl(te.pattern)}:{},name:G,onChange:$,onBlur:$,ref:Se=>{if(Se){je(G,te),le=ze(a,G);const be=Hs(Se.value)&&Se.querySelectorAll&&Se.querySelectorAll("input,select,textarea")[0]||Se,Re=rH(be),Ve=le._f.refs||[];if(Re?Ve.find(Qe=>Qe===be):be===le._f.ref)return;bs(a,G,{_f:{...le._f,...Re?{refs:[...Ve.filter(zh),be,...Array.isArray(ze(r,G))?[{}]:[]],ref:{type:be.type,name:G}}:{ref:be}}}),E(G,!1,void 0,be)}else le=ze(a,G,{}),le._f&&(le._f.mount=!1),(s.shouldUnregister||te.shouldUnregister)&&!(ZB(c.array,G)&&l.action)&&c.unMount.add(G)}}},we=()=>s.shouldFocusError&&ec(a,q,c.mount),ke=G=>{er(G)&&(g.state.next({disabled:G}),ec(a,(te,le)=>{const Ce=ze(a,le);Ce&&(te.disabled=Ce._f.disabled||G,Array.isArray(Ce._f.refs)&&Ce._f.refs.forEach(Se=>{Se.disabled=Ce._f.disabled||G}))},0,!1))},de=(G,te)=>async le=>{let Ce;le&&(le.preventDefault&&le.preventDefault(),le.persist&&le.persist());let Se=en(o);if(g.state.next({isSubmitting:!0}),s.resolver){const{errors:be,values:Re}=await D();n.errors=be,Se=en(Re)}else await _(a);if(c.disabled.size)for(const be of c.disabled)Bs(Se,be);if(Bs(n.errors,"root"),Fn(n.errors)){g.state.next({errors:{}});try{await G(Se,le)}catch(be){Ce=be}}else te&&await te({...n.errors},le),we(),setTimeout(we);if(g.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:Fn(n.errors)&&!Ce,submitCount:n.submitCount+1,errors:n.errors}),Ce)throw Ce},J=(G,te={})=>{ze(a,G)&&(Hs(te.defaultValue)?L(G,en(ze(r,G))):(L(G,te.defaultValue),bs(r,G,en(te.defaultValue))),te.keepTouched||Bs(n.touchedFields,G),te.keepDirty||(Bs(n.dirtyFields,G),n.isDirty=te.defaultValue?I(G,en(ze(r,G))):I()),te.keepError||(Bs(n.errors,G),h.isValid&&j()),g.state.next({...n}))},ve=(G,te={})=>{const le=G?en(G):r,Ce=en(le),Se=Fn(G),be=Se?r:Ce;if(te.keepDefaultValues||(r=le),!te.keepValues){if(te.keepDirtyValues){const Re=new Set([...c.mount,...Object.keys(Fl(r,o))]);for(const Ve of Array.from(Re))ze(n.dirtyFields,Ve)?bs(be,Ve,ze(o,Ve)):L(Ve,ze(be,Ve))}else{if(ix&&Hs(G))for(const Re of c.mount){const Ve=ze(a,Re);if(Ve&&Ve._f){const Qe=Array.isArray(Ve._f.refs)?Ve._f.refs[0]:Ve._f.ref;if(hu(Qe)){const Yt=Qe.closest("form");if(Yt){Yt.reset();break}}}}if(te.keepFieldsRef)for(const Re of c.mount)L(Re,ze(be,Re));else a={}}o=s.shouldUnregister?te.keepDefaultValues?en(r):{}:en(be),g.array.next({values:{...be}}),g.state.next({values:{...be}})}c={mount:te.keepDirtyValues?c.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},l.mount=!h.isValid||!!te.keepIsValid||!!te.keepDirtyValues,l.watch=!!s.shouldUnregister,g.state.next({submitCount:te.keepSubmitCount?n.submitCount:0,isDirty:Se?!1:te.keepDirty?n.isDirty:!!(te.keepDefaultValues&&!pi(G,r)),isSubmitted:te.keepIsSubmitted?n.isSubmitted:!1,dirtyFields:Se?{}:te.keepDirtyValues?te.keepDefaultValues&&o?Fl(r,o):n.dirtyFields:te.keepDefaultValues&&G?Fl(r,G):te.keepDirty?n.dirtyFields:{},touchedFields:te.keepTouched?n.touchedFields:{},errors:te.keepErrors?n.errors:{},isSubmitSuccessful:te.keepIsSubmitSuccessful?n.isSubmitSuccessful:!1,isSubmitting:!1})},ft=(G,te)=>ve(La(G)?G(o):G,te),pt=(G,te={})=>{const le=ze(a,G),Ce=le&&le._f;if(Ce){const Se=Ce.refs?Ce.refs[0]:Ce.ref;Se.focus&&(Se.focus(),te.shouldSelect&&La(Se.select)&&Se.select())}},ot=G=>{n={...n,...G}},gs={control:{register:je,unregister:ae,getFieldState:se,handleSubmit:de,setError:U,_subscribe:me,_runSchema:D,_focusError:we,_getWatch:R,_getDirty:I,_setValid:j,_setFieldArray:w,_setDisabledField:ge,_setErrors:S,_getFieldArray:M,_reset:ve,_resetDefaultValues:()=>La(s.defaultValues)&&s.defaultValues().then(G=>{ft(G,s.resetOptions),g.state.next({isLoading:!1})}),_removeUnmounted:B,_disableForm:ke,_subjects:g,_proxyFormState:h,get _fields(){return a},get _formValues(){return o},get _state(){return l},set _state(G){l=G},get _defaultValues(){return r},get _names(){return c},set _names(G){c=G},get _formState(){return n},get _options(){return s},set _options(G){s={...s,...G}}},subscribe:ue,trigger:re,register:je,handleSubmit:de,watch:ee,setValue:L,getValues:Y,reset:ft,resetField:J,clearErrors:ie,unregister:ae,setError:U,setFocus:pt,getFieldState:se};return{...gs,formControl:gs}}function vH(t={}){const s=Z.useRef(void 0),n=Z.useRef(void 0),[a,r]=Z.useState({isDirty:!1,isValidating:!1,isLoading:La(t.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1,isReady:!1,defaultValues:La(t.defaultValues)?void 0:t.defaultValues});if(!s.current)if(t.formControl)s.current={...t.formControl,formState:a},t.defaultValues&&!La(t.defaultValues)&&t.formControl.reset(t.defaultValues,t.resetOptions);else{const{formControl:l,...c}=gH(t);s.current={...c,formState:a}}const o=s.current.control;return o._options=t,sH(()=>{const l=o._subscribe({formState:o._proxyFormState,callback:()=>r({...o._formState}),reRenderRoot:!0});return r(c=>({...c,isReady:!0})),o._formState.isReady=!0,l},[o]),Z.useEffect(()=>o._disableForm(t.disabled),[o,t.disabled]),Z.useEffect(()=>{t.mode&&(o._options.mode=t.mode),t.reValidateMode&&(o._options.reValidateMode=t.reValidateMode)},[o,t.mode,t.reValidateMode]),Z.useEffect(()=>{t.errors&&(o._setErrors(t.errors),o._focusError())},[o,t.errors]),Z.useEffect(()=>{t.shouldUnregister&&o._subjects.state.next({values:o._getWatch()})},[o,t.shouldUnregister]),Z.useEffect(()=>{if(o._proxyFormState.isDirty){const l=o._getDirty();l!==a.isDirty&&o._subjects.state.next({isDirty:l})}},[o,a.isDirty]),Z.useEffect(()=>{t.values&&!pi(t.values,n.current)?(o._reset(t.values,{keepFieldsRef:!0,...o._options.resetOptions}),n.current=t.values,r(l=>({...l}))):o._resetDefaultValues()},[o,t.values]),Z.useEffect(()=>{o._state.mount||(o._setValid(),o._state.mount=!0),o._state.watch&&(o._state.watch=!1,o._subjects.state.next({...o._formState})),o._removeUnmounted()}),s.current.formState=tH(a,o),s.current}const yH={"--background":"0 0% 100%","--foreground":"222.2 84% 4.9%","--card":"0 0% 100%","--card-foreground":"222.2 84% 4.9%","--popover":"0 0% 100%","--popover-foreground":"222.2 84% 4.9%","--primary":"262.1 83.3% 57.8%","--primary-foreground":"210 40% 98%","--secondary":"220 14.3% 95.9%","--secondary-foreground":"222.2 47.4% 11.2%","--muted":"220 14.3% 95.9%","--muted-foreground":"220 8.9% 46.1%","--accent":"220 14.3% 95.9%","--accent-foreground":"222.2 47.4% 11.2%","--destructive":"0 84.2% 60.2%","--destructive-foreground":"210 40% 98%","--border":"220 13% 91%","--input":"220 13% 91%","--ring":"262.1 83.3% 57.8%","--radius":"0.75rem","--chart-1":"262.1 83.3% 57.8%","--chart-2":"173 58% 39%","--chart-3":"197 37% 24%","--chart-4":"43 74% 66%","--chart-5":"27 87% 67%","--desktop-nav-width":"64px","--font-family":"system-ui, sans-serif"},bH={"--background":"0 0% 100%","--foreground":"222.2 84% 4.9%","--primary":"212 100% 50%","--primary-foreground":"210 40% 98%","--secondary":"220 14% 95%","--secondary-foreground":"222.2 47.4% 11.2%","--muted":"220 14.3% 95.9%","--muted-foreground":"220 8.9% 46.1%","--accent":"212 100% 50%","--accent-foreground":"210 40% 98%","--border":"220 13% 91%","--input":"220 13% 91%","--ring":"212 100% 60%","--font-family":"'Menlo', 'Courier New', monospace"},Oy={default:yH,programmer:bH},pC=f.createContext(null),jH=()=>{const t=f.useContext(pC);if(!t)throw new Error("useTheme must be used within ThemeProvider");return t},wH=({children:t,defaultTheme:s="default"})=>{const{user:n}=qe(),[a,r]=f.useState(s),o=f.useCallback(async()=>{if(n)try{const c=Te(fe,"settings",n.uid);Me.logRead("settings","ThemeProvider.loadTheme",n.uid);const m=await st(c);if(m.exists()){const u=m.data();r((u==null?void 0:u.theme)||s)}else r(s)}catch(c){console.error("Error loading theme:",c),r(s)}},[n,s]);f.useEffect(()=>{o()},[o]),f.useEffect(()=>{const c=Oy[a]||Oy[s];Object.entries(c).forEach(([m,u])=>{document.documentElement.style.setProperty(m,u)})},[a,s]);const l=f.useCallback(async c=>{if(r(c),n)try{const m=Te(fe,"settings",n.uid);Me.logWrite("settings","ThemeProvider.updateTheme",n.uid),await qt(m,{userId:n.uid,theme:c},{merge:!0})}catch(m){console.error("Error saving theme:",m)}},[n]);return e.jsx(pC.Provider,{value:{theme:a,setTheme:l},children:t})};function NH(){const{user:t}=qe(),[s,n]=f.useState(null),[a,r]=f.useState(!0),[o,l]=f.useState(null),c=f.useCallback(async()=>{if(!t){r(!1);return}r(!0),l(null);try{const u=Te(fe,"settings",t.uid);Me.logRead("settings","useUserSettings.loadSettings",t.uid);const h=await st(u);n(h.exists()?h.data():null),r(!1)}catch(u){l(u instanceof Error?u.message:"Error loading settings"),r(!1)}},[t]);return f.useEffect(()=>{c()},[c]),{settings:s,loading:a,error:o,saveSettings:async u=>{if(!t)return;const h=s;try{const p={...s,...u};n(p);const g=Te(fe,"settings",t.uid);Me.logWrite("settings","useUserSettings.saveSettings",t.uid),await qt(g,{userId:t.uid,...u},{merge:!0})}catch(p){throw n(h),l(p instanceof Error?p.message:"Error saving settings"),p}},refetch:c}}const SH=()=>{const{settings:t,saveSettings:s}=NH(),{setTheme:n}=jH(),{user:a,signOut:r}=qe(),o=Xt(),{register:l,handleSubmit:c,reset:m}=vH();f.useEffect(()=>{t&&m(t)},[t,m]);const u=async g=>{await s(g),g.theme&&n(g.theme)},h=async()=>{try{await r(),o("/login")}catch(g){console.error("Error al cerrar sesión:",g)}},p=g=>g?g.split(" ").map(x=>x.charAt(0)).join("").toUpperCase().slice(0,2):"U";return e.jsx(Xs,{children:e.jsxs("div",{className:"space-y-6 max-w-md",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Perfil y Configuración"}),e.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-white rounded-lg shadow-sm border",children:[e.jsxs("div",{className:"relative",children:[a!=null&&a.photoURL?e.jsx("img",{src:a.photoURL,alt:"Profile",className:"w-16 h-16 rounded-full border-2 border-gray-200",onError:g=>{var x;g.currentTarget.style.display="none",(x=g.currentTarget.nextElementSibling)==null||x.classList.remove("hidden")}}):null,e.jsx("div",{className:`w-16 h-16 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold text-xl border-2 border-gray-200 ${a!=null&&a.photoURL?"hidden":""}`,children:p((a==null?void 0:a.displayName)||(a==null?void 0:a.email)||null)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:(a==null?void 0:a.displayName)||"Usuario"}),e.jsx("p",{className:"text-sm text-gray-600",children:a==null?void 0:a.email})]})]}),e.jsxs("form",{onSubmit:c(u),className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Fe,{htmlFor:"name",children:"Nombre"}),e.jsx(Be,{id:"name",...l("name")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Fe,{htmlFor:"birthDate",children:"Fecha de nacimiento"}),e.jsx(Be,{id:"birthDate",type:"date",...l("birthDate")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Fe,{htmlFor:"theme",children:"Tema"}),e.jsxs("select",{id:"theme",className:"border rounded-md p-2",...l("theme"),children:[e.jsx("option",{value:"default",children:"Default"}),e.jsx("option",{value:"programmer",children:"Programador Claro"})]})]}),e.jsx(z,{type:"submit",children:"Guardar"})]}),e.jsx("div",{className:"pt-4 border-t",children:e.jsxs(z,{variant:"destructive",onClick:h,className:"w-full",children:[e.jsx(PR,{className:"w-4 h-4 mr-2"}),"Cerrar Sesión"]})})]})})},CH=({taskId:t,onComplete:s})=>{const[n,a]=f.useState(0),[r,o]=f.useState(!1),[l,c]=f.useState(!1),[m,u]=f.useState(null),[h,p]=f.useState(0),[g,x]=f.useState(null),b=f.useRef(),j=f.useRef(),v=f.useRef(!1),w=f.useCallback(()=>{b.current&&(clearInterval(b.current),b.current=void 0),j.current&&(clearInterval(j.current),j.current=void 0)},[]),N=f.useCallback(()=>{if(!r||l||!m)return h;const _=Date.now(),B=Math.floor((_-m)/1e3);return h+B},[r,l,m,h]);f.useEffect(()=>{if(!r||l){w();return}return b.current=setInterval(()=>{a(N())},1e3),w},[r,l,N,w]),f.useEffect(()=>((async()=>{try{Me.logRead("tasks","useTaskTimer.loadTaskData",t);const B=Te(fe,"tasks",t),I=await st(B);if(!I.exists())return;const R=I.data();if(o(R.timerActive||!1),c(R.timerPaused||!1),p(R.elapsedSeconds||0),x({title:R.title||"",description:R.description||""}),R.timerActive&&!R.timerPaused&&R.timerStartTime){const M=Date.now(),W=Math.floor((M-R.timerStartTime.timestamp)/1e3);u(M-W*1e3),a(R.elapsedSeconds||0)}else u(null),a(R.elapsedSeconds||0)}catch(B){console.error("Error loading task data:",B)}})(),w),[t,w]),f.useEffect(()=>{if(!r||l||v.current){j.current&&(clearInterval(j.current),j.current=void 0);return}return j.current=setInterval(async()=>{try{const _=N();_-h>30&&(Me.logWrite("tasks","useTaskTimer.autoSave",t),await Hn(Te(fe,"tasks",t),{elapsedSeconds:_}),p(_))}catch(_){console.error("Error saving timer progress:",_)}},3e5),()=>{j.current&&(clearInterval(j.current),j.current=void 0)}},[r,l,t,N,h]);const S=f.useCallback(async()=>{if(!(r||v.current)){v.current=!0;try{const _=Date.now(),B=new Date,I=cn(B,B.getHours(),B.getMinutes());o(!0),c(!1),u(_),Me.logWrite("tasks","useTaskTimer.startTimer",t),await Hn(Te(fe,"tasks",t),{timerStartTime:I,timerActive:!0,timerPaused:!1,pausedDuration:0})}catch(_){console.error("Error starting timer:",_),o(!1),u(null)}finally{v.current=!1}}},[r,t]),E=f.useCallback(async()=>{if(!(!r||l||v.current)){v.current=!0;try{const _=N();c(!0),p(_),Me.logWrite("tasks","useTaskTimer.pauseTimer",t),await Hn(Te(fe,"tasks",t),{elapsedSeconds:_,timerPaused:!0})}catch(_){console.error("Error pausing timer:",_),c(!1)}finally{v.current=!1}}},[r,l,t,N]),T=f.useCallback(async()=>{if(!(!r||!l||v.current)){v.current=!0;try{const _=Date.now(),B=new Date,I=cn(B,B.getHours(),B.getMinutes());c(!1),u(_),Me.logWrite("tasks","useTaskTimer.resumeTimer",t),await Hn(Te(fe,"tasks",t),{timerStartTime:I,timerPaused:!1})}catch(_){console.error("Error resuming timer:",_),c(!0)}finally{v.current=!1}}},[r,l,t]),k=f.useCallback(async()=>{if(!(!r||v.current)){v.current=!0;try{const _=N();o(!1),c(!1),u(null),p(_),a(_),Me.logWrite("tasks","useTaskTimer.stopTimer",t),await Hn(Te(fe,"tasks",t),{elapsedSeconds:_,timerActive:!1,timerPaused:!1,timerStartTime:null})}catch(_){console.error("Error stopping timer:",_),o(!0)}finally{v.current=!1}}},[r,t,N]),D=f.useCallback(async()=>{if(!v.current){v.current=!0;try{const _=N();o(!1),c(!1),u(null),p(_),a(_),Me.logWrite("tasks","useTaskTimer.completeTask",t),await Hn(Te(fe,"tasks",t),{completed:!0,elapsedSeconds:_,timerActive:!1,timerPaused:!1,timerStartTime:null,progress:100}),s(_)}catch(_){console.error("Error completing task:",_)}finally{v.current=!1}}},[t,N,s]);return{time:n,isActive:r,isPaused:l,formattedTime:(_=>{const B=Math.floor(_/3600),I=Math.floor(_%3600/60),R=_%60;return[B,I,R].map(W=>String(W).padStart(2,"0")).join(":")})(n),taskData:g,startTimer:S,pauseTimer:E,resumeTimer:T,stopTimer:k,completeTask:D}},EH=t=>{const[s,n]=f.useState(null),[a,r]=f.useState(!0),[o,l]=f.useState(null),{user:c}=qe(),m=f.useCallback(async()=>{var h,p,g,x,b;if(!c||!t){n(null),r(!1);return}const u=typeof t=="string"?parseInt(t,10):t;if(isNaN(u)||u<1e4||u>99999){l("Código de tarea inválido. Debe ser un número de 5 dígitos."),r(!1);return}r(!0),l(null);try{Me.logRead("tasks",`useTaskByCode.fetchTaskByCode - taskCode: ${u}`);const j=$t(fe,"tasks"),v=nn(j,wt("userId","==",c.uid),wt("taskCode","==",u),db(1)),w=await an(v);if(w.empty){l("Tarea no encontrada"),n(null),r(!1);return}const N=w.docs[0],S=N.data(),E={id:N.id,taskCode:S.taskCode||0,title:S.title,description:S.description||"",completed:S.completed,createdAt:S.createdAt,updatedAt:(h=S.updatedAt)==null?void 0:h.toDate(),startDate:((p=S.startDate)==null?void 0:p.toDate())||((g=S.dueDate)==null?void 0:g.toDate()),endDate:(x=S.endDate)==null?void 0:x.toDate(),isRecurrent:S.isRecurrent||!1,isPrivate:S.isPrivate||!1,category:S.category||"other",priority:S.priority||"delete",size:S.size||"pequeña",estimatedTime:S.estimatedTime,timeOfDay:S.timeOfDay,elapsedSeconds:S.elapsedSeconds||0,progress:typeof S.progress=="number"?S.progress:ai(S.description||""),timerStartTime:S.timerStartTime,timerPaused:S.timerPaused||!1,pausedDuration:S.pausedDuration||0,timerActive:S.timerActive||!1,recurrence:S.recurrence?{frequency:S.recurrence.frequency,pattern:S.recurrence.pattern,customDays:S.recurrence.customDays,nextDate:(b=S.recurrence.nextDate)==null?void 0:b.toDate()}:void 0};n(E),r(!1)}catch(j){console.error("Error fetching task by code:",j),l(j instanceof Error?j.message:"Error al cargar la tarea"),n(null),r(!1)}},[c,t]);return f.useEffect(()=>{m()},[m]),{task:s,loading:a,error:o,refetch:m}},TH=t=>{const s=t.split(`
`),n=[],a=[];for(const r of s){const o=r.match(/^\s*- \[( |x|X)\] ?(.*)/);o?a.push({text:o[2],checked:o[1].toLowerCase()==="x"}):n.push(r)}return{body:n.join(`
`),checklist:a}},DH=(t,s)=>{const n=t?t.split(`
`):[],a=s.map(r=>`- [${r.checked?"x":" "}] ${r.text}`);return[...n,...a].join(`
`).trim()},kH=t=>{const s=["bg-gradient-to-br from-slate-800 via-slate-900 to-black","bg-gradient-to-br from-blue-900 via-blue-950 to-slate-900","bg-gradient-to-br from-indigo-900 via-purple-900 to-slate-900","bg-gradient-to-br from-emerald-900 via-teal-900 to-slate-900","bg-gradient-to-br from-purple-900 via-indigo-900 to-slate-900","bg-gradient-to-br from-teal-900 via-cyan-900 to-slate-900","bg-gradient-to-br from-gray-900 via-slate-900 to-zinc-900","bg-gradient-to-br from-neutral-900 via-gray-900 to-black","bg-gradient-to-br from-stone-900 via-neutral-900 to-slate-900","bg-gradient-to-br from-zinc-900 via-gray-900 to-black"],n=t%s.length;return s[n]};function AH(){const{taskCode:t}=Jf(),s=Xt(),{task:n,loading:a,error:r,refetch:o}=EH(t||""),{showRecurrenceModal:l,currentTask:c,modalMode:m,addTask:u,editTask:h,completeRecurrentTask:p,setShowRecurrenceModal:g,openEditModal:x}=oo(),{formattedTime:b,isActive:j,isPaused:v,startTimer:w,pauseTimer:N,resumeTimer:S,stopTimer:E,completeTask:T}=CH({taskId:(n==null?void 0:n.id)||"",onComplete:()=>s(-1)}),k=n,{body:D,checklist:P}=f.useMemo(()=>TH((k==null?void 0:k.description)||""),[k==null?void 0:k.description]),[_,B]=f.useState([]);f.useEffect(()=>{B(P)},[P]);const I=f.useMemo(()=>kH((k==null?void 0:k.taskCode)||0),[k==null?void 0:k.taskCode]),R=async M=>{if(!(k!=null&&k.id))return;const W=_.map((L,$)=>$===M?{...L,checked:!L.checked}:L);B(W);const H=DH(D,W);await Hn(Te(fe,"tasks",k.id),{description:H,progress:ai(H)})};return a?e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-slate-900 text-white p-6",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-white mb-4"}),e.jsx("p",{className:"text-xl",children:"Cargando tarea..."})]}):r||!k?e.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-slate-900 text-white p-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Tarea no encontrada"}),e.jsx("p",{className:"text-xl text-gray-300",children:r||"No se pudo encontrar la tarea solicitada"}),e.jsx(z,{variant:"outline",className:"text-white border-white hover:bg-white/20",onClick:()=>s(-1),children:"← Volver"})]})}):e.jsx("div",{className:`min-h-screen flex flex-col items-center ${I} text-white p-6`,children:e.jsxs("div",{className:"w-full max-w-4xl space-y-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(z,{variant:"ghost",className:"text-white hover:bg-white/20 text-lg font-semibold drop-shadow-lg px-6 py-3",onClick:()=>s(-1),children:"← Volver"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-lg font-mono font-semibold drop-shadow-lg bg-black/30 px-4 py-2 rounded-lg backdrop-blur-sm border border-white/20",children:["#",k.taskCode]}),e.jsx("div",{className:"text-4xl font-mono font-bold drop-shadow-xl bg-black/30 px-6 py-2 rounded-lg backdrop-blur-sm border border-white/20",children:b})]})]}),e.jsx("h1",{className:"text-5xl font-bold break-words drop-shadow-xl text-center leading-tight",children:(k==null?void 0:k.title)||""}),D&&e.jsx("div",{className:"prose prose-xl max-w-none text-white drop-shadow-md prose-headings:drop-shadow-lg prose-headings:text-white prose-p:text-white prose-strong:text-white prose-em:text-white",dangerouslySetInnerHTML:{__html:Tj(D)}}),_.length>0&&e.jsx("div",{className:"space-y-6",children:_.map((M,W)=>e.jsxs("label",{className:"flex items-center space-x-4 text-2xl bg-black/20 p-4 rounded-lg backdrop-blur-sm",children:[e.jsx(As,{checked:M.checked,onCheckedChange:()=>R(W),className:"scale-125"}),e.jsx("span",{className:"select-none drop-shadow-md font-medium",children:M.text})]},W))}),e.jsxs("div",{className:"flex flex-col gap-6 mt-12",children:[e.jsx("div",{className:"flex gap-4 justify-center",children:j?e.jsxs(e.Fragment,{children:[v?e.jsxs(z,{onClick:S,className:"bg-green-700 hover:bg-green-800 text-white px-8 py-4 text-xl font-semibold shadow-xl drop-shadow-lg border border-green-600",children:[e.jsx(yn,{className:"w-6 h-6 mr-3"}),"Reanudar"]}):e.jsxs(z,{onClick:N,className:"bg-amber-600 hover:bg-amber-700 text-white px-8 py-4 text-xl font-semibold shadow-xl drop-shadow-lg border border-amber-500",children:[e.jsx(Vf,{className:"w-6 h-6 mr-3"}),"Pausar"]}),e.jsxs(z,{onClick:E,className:"bg-red-700 hover:bg-red-800 text-white px-8 py-4 text-xl font-semibold shadow-xl drop-shadow-lg border border-red-600",children:[e.jsx(Wf,{className:"w-6 h-6 mr-3"}),"Detener"]})]}):e.jsxs(z,{onClick:w,className:"bg-green-700 hover:bg-green-800 text-white px-8 py-4 text-xl font-semibold shadow-xl drop-shadow-lg border border-green-600",children:[e.jsx(yn,{className:"w-6 h-6 mr-3"}),"Iniciar"]})}),e.jsxs(Ur,{children:[e.jsx(ki,{asChild:!0,children:e.jsxs(z,{className:"bg-blue-700 hover:bg-blue-800 text-white px-8 py-4 text-xl font-semibold w-full shadow-xl drop-shadow-lg border border-blue-600",children:[e.jsx(za,{className:"w-6 h-6 mr-3"}),"Completar Tarea"]})}),e.jsxs(mr,{children:[e.jsxs(hr,{children:[e.jsx(pr,{children:"Completar Tarea"}),e.jsx(xr,{children:"¿Estás seguro de que quieres completar esta tarea? El timer se detendrá automáticamente y la tarea será marcada como completada."})]}),e.jsxs(fr,{children:[e.jsx(vr,{children:"Cancelar"}),e.jsx(gr,{onClick:T,className:"bg-blue-600 hover:bg-blue-700",children:"Sí, completar"})]})]})]}),e.jsxs(z,{onClick:()=>x(k),className:"bg-gray-700 hover:bg-gray-800 text-white px-8 py-4 text-xl font-semibold w-full shadow-xl drop-shadow-lg border border-gray-600",children:[e.jsx(sa,{className:"w-6 h-6 mr-3"}),"Editar"]})]}),e.jsx(tl,{isOpen:l,onClose:()=>g(),onConfirm:async M=>{m==="complete"?await p(M):m==="edit"?(await h(c.id,M),o()):await u(M)},task:c||k||{id:"",taskCode:0,title:"",completed:!1,category:"personal",createdAt:{seconds:Date.now()/1e3}},mode:m})]})})}const RH=({autoStart:t=!0}={})=>{const[s,n]=f.useState(0),[a,r]=f.useState(!1),[o,l]=f.useState(!1),[c,m]=f.useState(null),[u,h]=f.useState(0),p=f.useRef(null),g=f.useCallback(N=>{const S=Math.floor(N/3600),E=Math.floor(N%3600/60),T=N%60;return[S,E,T].map(D=>String(D).padStart(2,"0")).join(":")},[]),x=f.useCallback(()=>{r(!0),l(!1),m(Date.now())},[]),b=f.useCallback(()=>{if(a&&!o&&c){l(!0);const N=Date.now(),S=Math.floor((N-c)/1e3);h(E=>E+S)}},[a,o,c]),j=f.useCallback(()=>{a&&o&&(l(!1),m(Date.now()))},[a,o]),v=f.useCallback(()=>{p.current&&(clearInterval(p.current),p.current=null),r(!1),l(!1),h(0),m(null),n(0)},[]),w=f.useCallback(()=>{v(),t&&setTimeout(()=>x(),50)},[t,x,v]);return f.useEffect(()=>(a&&!o&&c?p.current=window.setInterval(()=>{const N=Date.now(),S=Math.floor((N-c)/1e3);n(u+S)},1e3):p.current&&(window.clearInterval(p.current),p.current=null),()=>{p.current&&(window.clearInterval(p.current),p.current=null)}),[a,o,c,u]),f.useEffect(()=>{t&&x()},[t,x]),f.useEffect(()=>()=>{p.current&&(window.clearInterval(p.current),p.current=null)},[]),{time:s,isActive:a,isPaused:o,formattedTime:g(s),startTimer:x,pauseTimer:b,resumeTimer:j,stopTimer:v,resetTimer:w}},_H=t=>{const s=["bg-gradient-to-br from-blue-900 via-blue-950 to-slate-900","bg-gradient-to-br from-emerald-900 via-teal-900 to-slate-900","bg-gradient-to-br from-purple-900 via-indigo-900 to-slate-900","bg-gradient-to-br from-amber-900 via-orange-900 to-slate-900","bg-gradient-to-br from-rose-900 via-pink-900 to-slate-900","bg-gradient-to-br from-cyan-900 via-blue-900 to-slate-900","bg-gradient-to-br from-violet-900 via-purple-900 to-slate-900","bg-gradient-to-br from-teal-900 via-emerald-900 to-slate-900","bg-gradient-to-br from-indigo-900 via-blue-900 to-slate-900","bg-gradient-to-br from-green-900 via-emerald-900 to-slate-900"];return s[t%s.length]};function PH(){var I;const{habitId:t}=Jf(),s=Xt(),n=jn(),a=new Date(((I=n.state)==null?void 0:I.date)||new Date),{completedHabits:r,toggleHabit:o}=ep(a),[l,c]=f.useState([]),{formattedTime:m,isActive:u,isPaused:h,startTimer:p,pauseTimer:g,resumeTimer:x,stopTimer:b}=RH(),j=Rn.find(R=>R.id===Number(t)),v=$e(a),w=`${t}_${v}`,N=r[w]||!1,S=f.useMemo(()=>_H(Number(t)),[t]),E=(j==null?void 0:j.steps)||[],T=E.length;if(f.useEffect(()=>{l.length===0&&T>0&&c(new Array(T).fill(!1))},[l.length,T]),!j)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-900 text-white",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Hábito no encontrado"}),e.jsx(z,{onClick:()=>s(-1),variant:"outline",className:"text-white border-white hover:bg-white hover:text-gray-900",children:"Volver"})]})});const k=R=>{const M=[...l];M[R]=!M[R],c(M)},D=()=>{u?h?x():g():p()},P=async()=>{try{b(),await o(Number(t),v),s(-1)}catch(R){console.error("Error completing habit:",R)}},_=l.filter(Boolean).length,B=T>0?_/T*100:0;return e.jsx("div",{className:`min-h-screen flex flex-col ${S} text-white`,children:e.jsxs("div",{className:"flex-1 flex flex-col p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs(z,{variant:"ghost",className:"text-white hover:bg-white/20 text-lg font-semibold drop-shadow-lg px-6 py-3",onClick:()=>s(-1),children:[e.jsx(Po,{className:"w-5 h-5 mr-2"}),"Volver"]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-6xl font-mono font-bold drop-shadow-xl bg-black/30 px-6 py-3 rounded-lg backdrop-blur-sm border border-white/20",children:m}),e.jsx("div",{className:"mt-2",children:e.jsx(z,{onClick:D,className:"bg-white/20 hover:bg-white/30 text-white px-4 py-2 text-sm font-semibold backdrop-blur-sm",children:u?h?e.jsxs(e.Fragment,{children:[e.jsx(yn,{className:"w-4 h-4 mr-2"}),"Reanudar"]}):e.jsxs(e.Fragment,{children:[e.jsx(Vf,{className:"w-4 h-4 mr-2"}),"Pausar"]}):e.jsxs(e.Fragment,{children:[e.jsx(yn,{className:"w-4 h-4 mr-2"}),"Iniciar"]})})})]})]}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"text-8xl mb-4",children:j.icon}),e.jsx("h1",{className:"text-4xl font-bold drop-shadow-xl mb-2",children:j.name}),e.jsx("p",{className:"text-xl text-white/80 drop-shadow-lg",children:j.goal})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"w-full bg-black/20 rounded-full h-3 backdrop-blur-sm",children:e.jsx("div",{className:"bg-white h-3 rounded-full transition-all duration-300",style:{width:`${B}%`}})}),e.jsxs("div",{className:"text-center mt-2 text-white/80",children:[B.toFixed(0),"% completado"]})]}),T>0&&e.jsx("div",{className:"flex-1 mb-8",children:e.jsxs("div",{className:"bg-black/20 backdrop-blur-sm rounded-2xl p-6 mx-auto max-w-3xl",children:[e.jsx("h2",{className:"text-2xl font-semibold drop-shadow-lg mb-6 text-center",children:"Pasos a seguir"}),e.jsx("div",{className:"space-y-4",children:E.map((R,M)=>e.jsxs("div",{className:`flex items-center gap-4 p-4 rounded-lg transition-all duration-200 ${l[M]?"bg-green-500/20 border border-green-400/30":"bg-white/10 border border-white/20 hover:bg-white/20"}`,children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(As,{checked:l[M]||!1,onCheckedChange:()=>k(M),className:"scale-125"})}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm font-medium text-white/60 min-w-[60px]",children:["Paso ",M+1]}),e.jsx("p",{className:`text-lg font-medium drop-shadow-lg ${l[M]?"line-through text-white/70":"text-white"}`,children:R})]})})]},M))})]})}),e.jsx("div",{className:"mt-auto",children:e.jsxs(Ur,{children:[e.jsx(ki,{asChild:!0,children:e.jsxs(z,{className:"w-full bg-green-600 hover:bg-green-700 text-white px-8 py-4 text-xl font-semibold shadow-xl drop-shadow-lg border border-green-500",children:[e.jsx(za,{className:"w-6 h-6 mr-3"}),N?"Hábito Completado":"Completar Hábito"]})}),e.jsxs(mr,{children:[e.jsxs(hr,{children:[e.jsx(pr,{children:N?"Desmarcar Hábito":"Completar Hábito"}),e.jsx(xr,{children:N?"¿Estás seguro de que quieres desmarcar este hábito como completado?":"¿Estás seguro de que quieres marcar este hábito como completado?"})]}),e.jsxs(fr,{children:[e.jsx(vr,{children:"Cancelar"}),e.jsx(gr,{onClick:P,className:"bg-green-600 hover:bg-green-700",children:N?"Sí, desmarcar":"Sí, completar"})]})]})]})})]})})}const MH=({onComplete:t}={})=>{const[s,n]=f.useState(null),[a,r]=f.useState(0),[o,l]=f.useState(!1),[c,m]=f.useState(!1),u=f.useRef(null);f.useEffect(()=>(o&&!c&&s?u.current=window.setInterval(()=>{r(Date.now()-s)},1e3):u.current&&(window.clearInterval(u.current),u.current=null),()=>{u.current&&window.clearInterval(u.current)}),[o,c,s]);const h=v=>{const w=Math.floor(v/1e3),N=Math.floor(w/3600),S=Math.floor(w%3600/60),E=w%60;return N>0?`${N.toString().padStart(2,"0")}:${S.toString().padStart(2,"0")}:${E.toString().padStart(2,"0")}`:`${S.toString().padStart(2,"0")}:${E.toString().padStart(2,"0")}`},p=()=>{const v=Date.now();n(v),r(0),l(!0),m(!1)},g=()=>{m(!0)},x=()=>{if(s){const v=Date.now();n(v-a),m(!1)}},b=()=>{l(!1),m(!1),n(null),r(0)},j=()=>{b(),t==null||t()};return{formattedTime:h(a),elapsedTime:a,isActive:o,isPaused:c,startTimer:p,pauseTimer:g,resumeTimer:x,stopTimer:b,completeSession:j}},IH=["Éxito","D1","Ara","Dollarcity","Olimpica (SAO)","Jumbo","Plaza de mercado","Panadería","Droguería","Otro"],OH=t=>{const s=["bg-gradient-to-br from-slate-800 via-slate-900 to-black","bg-gradient-to-br from-blue-900 via-blue-950 to-slate-900","bg-gradient-to-br from-indigo-900 via-purple-900 to-slate-900","bg-gradient-to-br from-emerald-900 via-teal-900 to-slate-900","bg-gradient-to-br from-purple-900 via-indigo-900 to-slate-900","bg-gradient-to-br from-teal-900 via-cyan-900 to-slate-900","bg-gradient-to-br from-gray-900 via-slate-900 to-zinc-900","bg-gradient-to-br from-orange-900 via-red-900 to-slate-900"],a=t.split("").reduce((r,o)=>r+o.charCodeAt(0),0)%s.length;return s[a]};function LH(){const t=Xt(),{items:s}=al(),[n,a]=f.useState(""),[r,o]=f.useState(!0),[l,c]=f.useState([]),{formattedTime:m,isActive:u,isPaused:h,startTimer:p,pauseTimer:g,resumeTimer:x,stopTimer:b,completeSession:j}=MH({onComplete:()=>t(-1)}),v=f.useMemo(()=>n?s.filter(D=>D.place===n&&D.toBuy>0).map(D=>({...D,purchased:!1})):[],[s,n]);f.useEffect(()=>{c(v)},[v]);const w=f.useMemo(()=>{const D=l.reduce((B,I)=>I.price?B+I.price*I.toBuy:B,0),P=l.reduce((B,I)=>I.purchased&&I.price?B+I.price*I.toBuy:B,0),_=l.reduce((B,I)=>!I.purchased&&I.price?B+I.price*I.toBuy:B,0);return{totalEstimated:D,totalPurchased:P,totalRemaining:_}},[l]),N=f.useMemo(()=>OH(n),[n]),S=new Intl.NumberFormat("es-CO",{style:"currency",currency:"COP"}),E=D=>{a(D),o(!1),p()},T=D=>{c(P=>P.map(_=>_.id===D?{..._,purchased:!_.purchased}:_))},k=()=>{j()};return r?e.jsx(Rt,{open:r,onOpenChange:o,children:e.jsxs(Ct,{className:"sm:max-w-md",children:[e.jsx(_t,{children:e.jsx(Pt,{children:"¿En qué tienda vas a comprar?"})}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs(Nt,{onValueChange:E,children:[e.jsx(xt,{children:e.jsx(St,{placeholder:"Selecciona una tienda"})}),e.jsx(gt,{children:IH.map(D=>e.jsx(Pe,{value:D,children:D},D))})]})}),e.jsx(wn,{children:e.jsx(z,{variant:"outline",onClick:()=>t(-1),children:"Cancelar"})})]})}):l.length===0?e.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-slate-900 text-white p-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(ir,{className:"w-16 h-16 mx-auto text-gray-400"}),e.jsx("h1",{className:"text-3xl font-bold",children:"No hay productos para comprar"}),e.jsxs("p",{className:"text-xl text-gray-300",children:["No tienes productos marcados para comprar en ",n]}),e.jsx(z,{variant:"outline",className:"text-white border-white hover:bg-white/20",onClick:()=>t(-1),children:"← Volver"})]})}):e.jsxs("div",{className:`min-h-screen flex flex-col ${N} text-white`,children:[e.jsxs("div",{className:"flex justify-between items-center p-4 bg-black/20 backdrop-blur-sm",children:[e.jsxs(z,{variant:"ghost",className:"text-white hover:bg-white/20 text-lg font-semibold",onClick:()=>t(-1),children:[e.jsx(Po,{className:"w-5 h-5 mr-2"}),"Volver"]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-white/80 mb-1",children:n}),e.jsx("div",{className:"text-3xl font-mono font-bold bg-black/30 px-4 py-2 rounded-lg backdrop-blur-sm border border-white/20",children:m})]}),e.jsx("div",{className:"w-20"})," "]}),e.jsx("div",{className:"flex gap-2 justify-center p-4 bg-black/10",children:u?e.jsxs(e.Fragment,{children:[h?e.jsxs(z,{onClick:x,className:"bg-green-700 hover:bg-green-800 text-white px-6 py-2 font-semibold",children:[e.jsx(yn,{className:"w-4 h-4 mr-2"}),"Reanudar"]}):e.jsxs(z,{onClick:g,className:"bg-amber-600 hover:bg-amber-700 text-white px-6 py-2 font-semibold",children:[e.jsx(Vf,{className:"w-4 h-4 mr-2"}),"Pausar"]}),e.jsxs(z,{onClick:b,className:"bg-red-700 hover:bg-red-800 text-white px-6 py-2 font-semibold",children:[e.jsx(Wf,{className:"w-4 h-4 mr-2"}),"Detener"]})]}):e.jsxs(z,{onClick:p,className:"bg-green-700 hover:bg-green-800 text-white px-6 py-2 font-semibold",children:[e.jsx(yn,{className:"w-4 h-4 mr-2"}),"Iniciar"]})}),e.jsx("div",{className:"flex-1 overflow-auto p-4 space-y-3",children:l.map(D=>e.jsx("div",{className:`bg-black/20 backdrop-blur-sm border border-white/20 rounded-lg p-4 transition-all duration-300 ${D.purchased?"opacity-60 bg-green-900/20":""}`,children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(As,{checked:D.purchased,onCheckedChange:()=>T(D.id),className:"scale-125"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:`text-lg font-medium ${D.purchased?"line-through text-white/70":""}`,children:D.name}),e.jsxs("div",{className:"text-sm text-white/80",children:["Cantidad: ",D.toBuy,D.price&&e.jsxs("span",{className:"ml-4",children:["Precio unitario: ",S.format(D.price)]})]})]}),D.price&&e.jsx("div",{className:`text-right ${D.purchased?"line-through text-white/70":""}`,children:e.jsx("div",{className:"text-lg font-bold",children:S.format(D.price*D.toBuy)})})]})},D.id))}),e.jsxs("div",{className:"bg-black/30 backdrop-blur-sm border-t border-white/20 p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between text-sm text-white/80",children:[e.jsx("span",{children:"Total estimado:"}),e.jsx("span",{children:S.format(w.totalEstimated)})]}),e.jsxs("div",{className:"flex justify-between text-sm text-green-400",children:[e.jsx("span",{children:"Ya comprado:"}),e.jsx("span",{children:S.format(w.totalPurchased)})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold border-t border-white/20 pt-3",children:[e.jsx("span",{children:"Falta por comprar:"}),e.jsx("span",{children:S.format(w.totalRemaining)})]}),e.jsxs(Ur,{children:[e.jsx(ki,{asChild:!0,children:e.jsxs(z,{className:"w-full bg-blue-700 hover:bg-blue-800 text-white py-3 text-lg font-semibold mt-4",children:[e.jsx(ir,{className:"w-5 h-5 mr-2"}),"Terminar Compras"]})}),e.jsxs(mr,{children:[e.jsxs(hr,{children:[e.jsx(pr,{children:"Terminar Compras"}),e.jsx(xr,{children:"¿Estás seguro de que quieres terminar la sesión de compras? El cronómetro se detendrá y volverás a la vista anterior."})]}),e.jsxs(fr,{children:[e.jsx(vr,{children:"Continuar comprando"}),e.jsx(gr,{onClick:k,className:"bg-blue-600 hover:bg-blue-700",children:"Sí, terminar"})]})]})]})]})]})}const $H=()=>{const{user:t}=qe(),[s,n]=f.useState([]),[a,r]=f.useState("idle"),[o,l]=f.useState(null),c=f.useCallback(async()=>{if(t){r("loading"),l(null);try{Me.logRead("goals","useGoals.loadGoals");const v=nn($t(fe,"goals"),wt("userId","==",t.uid)),N=(await an(v)).docs.map(S=>{const E=S.data();return{id:S.id,userId:E.userId,title:E.title,description:E.description,status:E.status,startDate:E.startDate||null,dueDate:E.dueDate||null,tasks:E.tasks||[],entries:E.entries||[],positiveCount:E.positiveCount||0,negativeCount:E.negativeCount||0,numericGoal:E.numericGoal||void 0,numericEntries:E.numericEntries||[],createdAt:E.createdAt,updatedAt:E.updatedAt}});n(N),r("idle")}catch(v){l(v instanceof Error?v.message:"Error al cargar"),r("error")}}},[t]);f.useEffect(()=>{if(!t){n([]);return}c()},[t,c]);const m=async v=>{if(t){r("saving"),l(null);try{const w={...v,userId:t.uid,positiveCount:0,negativeCount:0,numericEntries:[],createdAt:dt(),updatedAt:dt()};Me.logWrite("goals","useGoals.addGoal");const N=await Ao($t(fe,"goals"),w);n(S=>[...S,{...v,id:N.id,userId:t.uid,positiveCount:0,negativeCount:0,numericEntries:[],createdAt:"",updatedAt:""}]),r("idle")}catch(w){l(w instanceof Error?w.message:"Error al guardar"),r("error")}}},u=async(v,w)=>{if(!t)return;r("saving"),l(null);const N=s.find(E=>E.id===v);if(!N)return;const S={...N,...w};n(E=>E.map(T=>T.id===v?S:T));try{const E=Te(fe,"goals",v),T={...w,updatedAt:dt()};Me.logWrite("goals","useGoals.updateGoal",v),await Hn(E,T),r("idle")}catch(E){n(T=>T.map(k=>k.id===v?N:k)),l(E instanceof Error?E.message:"Error al actualizar"),r("error")}};return{goals:s,status:a,error:o,addGoal:m,updateGoal:u,addTask:async(v,w)=>{const N=s.find(T=>T.id===v);if(!N||!t)return;const S={title:w,done:!1,createdAt:new Date().toISOString()},E=[...N.tasks,S];await u(v,{tasks:E})},toggleTask:async(v,w)=>{const N=s.find(T=>T.id===v);if(!N||!t)return;const S=[...N.tasks],E=S[w];E&&(S[w]={...E,done:!E.done,completedAt:E.done?null:new Date().toISOString()},await u(v,{tasks:S}))},addEntry:async(v,w)=>{const N=s.find(T=>T.id===v);if(!N||!t)return;const S={text:w.text,date:w.date||new Date().toISOString(),isMilestone:w.isMilestone},E=[...N.entries,S].sort((T,k)=>T.date.localeCompare(k.date));await u(v,{entries:E})},incrementPositiveCount:async v=>{const w=s.find(S=>S.id===v);if(!w||!t)return;const N=(w.positiveCount||0)+1;await u(v,{positiveCount:N})},incrementNegativeCount:async v=>{const w=s.find(S=>S.id===v);if(!w||!t)return;const N=(w.negativeCount||0)+1;await u(v,{negativeCount:N})},addNumericEntry:async(v,w)=>{const N=s.find(k=>k.id===v);if(!N||!t)return;const S={value:w.value,date:w.date||new Date().toISOString(),note:w.note},E=[...N.numericEntries||[],S].sort((k,D)=>k.date.localeCompare(D.date)),T=N.numericGoal?{...N.numericGoal,currentValue:w.value}:void 0;await u(v,{numericEntries:E,numericGoal:T})},loadGoals:c}},zH=({goals:t,onSelect:s,onIncrementPositive:n,onIncrementNegative:a,onEdit:r})=>{if(t.length===0)return e.jsx(Ne,{className:"p-6 text-center",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsx(Uo,{className:"h-12 w-12 text-gray-400"}),e.jsxs("div",{children:[e.jsx(Wt,{className:"text-lg text-gray-600",children:"No hay objetivos"}),e.jsx(fi,{className:"mt-2",children:"Comienza creando tu primer objetivo para alcanzar tus metas"})]})]})});const o=(u,h)=>{if(u===h)return 100;if(u>h){const g=h===0?0:(u-h)/u*100;return Math.max(0,Math.min(100,100-g))}else{const g=h===0?0:u/h*100;return Math.max(0,Math.min(100,g))}},l=u=>{switch(u){case"completed":return"default";case"active":return"secondary";case"abandoned":return"destructive";default:return"outline"}},c=u=>{switch(u){case"completed":return e.jsx(za,{className:"h-3 w-3"});case"active":return e.jsx(Js,{className:"h-3 w-3"});case"abandoned":return e.jsx(fb,{className:"h-3 w-3"});default:return null}},m=u=>{switch(u){case"completed":return"Completado";case"active":return"Activo";case"abandoned":return"Abandonado";default:return u}};return e.jsx(Ne,{children:e.jsxs(De,{className:"p-0",children:[e.jsxs("div",{className:"hidden md:grid grid-cols-12 gap-4 p-4 bg-gray-50 border-b text-sm font-medium text-gray-700",children:[e.jsx("div",{className:"col-span-4",children:"Objetivo"}),e.jsx("div",{className:"col-span-2 text-center",children:"Estado"}),e.jsx("div",{className:"col-span-2 text-center",children:"Progreso"}),e.jsx("div",{className:"col-span-2 text-center",children:"Fecha Límite"}),e.jsx("div",{className:"col-span-2 text-center",children:"Acciones"})]}),e.jsx("div",{className:"divide-y divide-gray-100",children:t.map((u,h)=>{var w;const p=u.tasks.filter(N=>N.done).length,g=u.tasks.length,x=g>0?p/g*100:0,b=(w=u.numericGoal)==null?void 0:w.enabled,j=b?o(u.numericGoal.currentValue,u.numericGoal.targetValue):0,v=b?j:x;return e.jsxs("div",{className:`p-4 hover:bg-gray-50 transition-colors cursor-pointer ${h%2===0?"bg-white":"bg-gray-50/50"}`,onClick:()=>s(u.id),children:[e.jsxs("div",{className:"md:hidden space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-2 flex-1",children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:c(u.status)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 truncate",children:u.title}),u.description&&e.jsx("p",{className:"text-xs text-gray-500 mt-1 line-clamp-1",children:u.description})]})]}),e.jsx(Ht,{variant:l(u.status),className:"text-xs",children:e.jsx("span",{children:m(u.status)})})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:b?"Meta":"Tareas"}),e.jsx("span",{className:"font-medium",children:b?`${Math.round(j)}%`:`${p}/${g}`})]}),e.jsx(Vn,{value:v,className:"h-2"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3 text-xs text-gray-500",children:[e.jsxs("span",{children:[g," tareas"]}),u.entries.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{children:[u.entries.length," avances"]})]}),u.dueDate&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsx("span",{children:new Date(u.dueDate).toLocaleDateString()})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(z,{variant:"ghost",size:"sm",onClick:N=>{N.stopPropagation(),n(u.id)},className:"h-6 w-6 p-0 text-green-600",children:e.jsx(qh,{className:"h-3 w-3"})}),e.jsx("span",{className:"text-xs text-green-600",children:u.positiveCount||0}),e.jsx(z,{variant:"ghost",size:"sm",onClick:N=>{N.stopPropagation(),a(u.id)},className:"h-6 w-6 p-0 text-red-600",children:e.jsx(qd,{className:"h-3 w-3"})}),e.jsx("span",{className:"text-xs text-red-600",children:u.negativeCount||0}),e.jsx(z,{variant:"ghost",size:"sm",onClick:N=>{N.stopPropagation(),r(u)},className:"h-6 w-6 p-0 text-blue-600 ml-1",children:e.jsx(sa,{className:"h-3 w-3"})})]})]})]}),e.jsxs("div",{className:"hidden md:grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:c(u.status)}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 truncate",children:u.title}),u.description&&e.jsx("p",{className:"text-xs text-gray-500 mt-1 line-clamp-1",children:u.description}),e.jsx("div",{className:"flex items-center gap-3 mt-1",children:e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsxs("span",{children:[g," tareas"]}),u.entries.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{children:[u.entries.length," avances"]})]})]})})]})]})}),e.jsx("div",{className:"col-span-2 flex justify-center",children:e.jsx(Ht,{variant:l(u.status),className:"text-xs",children:e.jsx("span",{children:m(u.status)})})}),e.jsx("div",{className:"col-span-2",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-gray-600",children:b?"Meta":"Tareas"}),e.jsx("span",{className:"font-medium",children:b?`${Math.round(j)}%`:`${p}/${g}`})]}),e.jsx(Vn,{value:v,className:"h-2"})]})}),e.jsx("div",{className:"col-span-2 flex justify-center items-center",children:u.dueDate?e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-600",children:[e.jsx(ns,{className:"h-3 w-3"}),e.jsx("span",{children:new Date(u.dueDate).toLocaleDateString()})]}):e.jsx("span",{className:"text-xs text-gray-400",children:"Sin fecha"})}),e.jsxs("div",{className:"col-span-2 flex justify-center items-center gap-1",children:[e.jsx(z,{variant:"ghost",size:"sm",onClick:N=>{N.stopPropagation(),n(u.id)},className:"h-7 w-7 p-0 text-green-600 hover:text-green-700 hover:bg-green-50",title:"Voto positivo",children:e.jsx(qh,{className:"h-3 w-3"})}),e.jsx("span",{className:"text-xs text-green-600 min-w-[1rem] text-center",children:u.positiveCount||0}),e.jsx(z,{variant:"ghost",size:"sm",onClick:N=>{N.stopPropagation(),a(u.id)},className:"h-7 w-7 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",title:"Voto negativo",children:e.jsx(qd,{className:"h-3 w-3"})}),e.jsx("span",{className:"text-xs text-red-600 min-w-[1rem] text-center",children:u.negativeCount||0}),e.jsx(z,{variant:"ghost",size:"sm",onClick:N=>{N.stopPropagation(),r(u)},className:"h-7 w-7 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50 ml-1",title:"Editar objetivo",children:e.jsx(sa,{className:"h-3 w-3"})}),e.jsx(z,{variant:"ghost",size:"sm",onClick:N=>{N.stopPropagation(),s(u.id)},className:"h-7 w-7 p-0 text-gray-600 hover:text-gray-700 hover:bg-gray-100",title:"Ver detalles",children:e.jsx(ac,{className:"h-3 w-3"})})]})]})]},u.id)})})]})})};var FH="Separator",Ly="horizontal",BH=["horizontal","vertical"],xC=f.forwardRef((t,s)=>{const{decorative:n,orientation:a=Ly,...r}=t,o=HH(a)?a:Ly,c=n?{role:"none"}:{"aria-orientation":o==="vertical"?o:void 0,role:"separator"};return e.jsx(At.div,{"data-orientation":o,...c,...r,ref:s})});xC.displayName=FH;function HH(t){return BH.includes(t)}var gC=xC;const tc=f.forwardRef(({className:t,orientation:s="horizontal",decorative:n=!0,...a},r)=>e.jsx(gC,{ref:r,decorative:n,orientation:s,className:ce("shrink-0 bg-border",s==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",t),...a}));tc.displayName=gC.displayName;const WH=({goal:t,isOpen:s,onClose:n})=>{var j;const[a,r]=f.useState(""),[o,l]=f.useState(""),[c,m]=f.useState(!1),[u,h]=f.useState(null),[p,g]=f.useState(0);f.useEffect(()=>{var v;if(s){const w=t.tasks.filter(P=>P.done).length,N=t.tasks.length,S=N>0?Math.round(w/N*100):0,E=(v=t.numericGoal)!=null&&v.enabled?`
Meta numérica: ${t.numericGoal.currentValue.toLocaleString()} / ${t.numericGoal.targetValue.toLocaleString()} ${t.numericGoal.unit} (${Math.round(t.numericGoal.currentValue/t.numericGoal.targetValue*100)}% completado)`:"",T=t.tasks.length>0?`
Tareas actuales:
${t.tasks.map((P,_)=>`${_+1}. ${P.title} ${P.done?"✓":"○"}`).join(`
`)}`:`
No hay tareas definidas aún.`,k=t.entries.length>0?`
Avances registrados:
${t.entries.slice(-5).map((P,_)=>`${_+1}. ${P.text} ${P.isMilestone?"⭐":""} (${new Date(P.date).toLocaleDateString()})`).join(`
`)}`:`
No hay avances registrados aún.`,D=`OBJETIVO: ${t.title}
${t.description?`DESCRIPCIÓN: ${t.description}`:""}
ESTADO: ${t.status}
PROGRESO DE TAREAS: ${S}% (${w}/${N} completadas)${E}
FECHA LÍMITE: ${t.dueDate?new Date(t.dueDate).toLocaleDateString():"No definida"}
${T}
${k}

Por favor, sugiere tareas específicas y accionables que me ayuden a avanzar hacia este objetivo. Considera el progreso actual y las tareas existentes para evitar duplicados.`;l(D)}else l(""),r(""),h(null)},[s,t]),f.useEffect(()=>{g(ba(o))},[o]);const x=async()=>{var v,w,N;if(o){m(!0),h(null);try{const S={...Wl.goals,prompt:(v=Wl.goals.prompts)==null?void 0:v.taskSuggestions},E=await Aj(o,S,{temperature:(w=Wl.goals.params)==null?void 0:w.temperature,topP:(N=Wl.goals.params)==null?void 0:N.top_p});r(E)}catch(S){h(S instanceof Error?S.message:"Error al generar sugerencias"),console.error("Error generating AI suggestions:",S)}finally{m(!1)}}},b=()=>{r(""),l(""),h(null),g(0),n()};return e.jsx(Rt,{open:s,onOpenChange:v=>v?n():b(),children:e.jsxs(Ct,{className:"w-[95vw] h-[90vh] max-w-none max-h-none overflow-hidden flex flex-col sm:w-[90vw] sm:h-[85vh]",children:[e.jsxs(_t,{className:"flex-shrink-0",children:[e.jsxs(Pt,{className:"flex items-center gap-2",children:[e.jsx(Pr,{className:"h-5 w-5 text-purple-600"}),'Sugerencias de IA para "',t.title,'"']}),e.jsx(rn,{children:"Obtén ideas inteligentes para tareas que te ayuden a completar tu objetivo"})]}),e.jsx(Ne,{className:"flex-shrink-0",children:e.jsx(De,{className:"p-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-medium",children:"Resumen del objetivo"}),e.jsxs(Ht,{variant:"secondary",children:[t.tasks.filter(v=>v.done).length,"/",t.tasks.length," tareas"]})]}),t.description&&e.jsx("p",{className:"text-sm text-gray-600",children:t.description}),((j=t.numericGoal)==null?void 0:j.enabled)&&e.jsxs("p",{className:"text-sm text-blue-600",children:["Meta: ",t.numericGoal.currentValue.toLocaleString()," / ",t.numericGoal.targetValue.toLocaleString()," ",t.numericGoal.unit]})]})})}),e.jsxs("div",{className:"flex-1 flex flex-col sm:flex-row gap-4 min-h-0 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[e.jsxs("div",{className:"flex-1 flex flex-col mb-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2 flex-shrink-0",children:"Prompt para IA"}),e.jsx(kt,{value:o,onChange:v=>l(v.target.value),className:"flex-1 resize-none min-h-0",placeholder:"Contexto del objetivo..."})]}),e.jsxs("div",{className:"flex-shrink-0 space-y-3",children:[e.jsxs("p",{className:"text-xs text-right",children:["Tokens: ",p," ",p>3500&&e.jsx("span",{className:"text-red-500",children:"¡Prompt demasiado largo!"})]}),e.jsxs(z,{onClick:x,disabled:c||!1||p>3500,className:"w-full flex items-center justify-center gap-2 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700",children:[c&&e.jsx(ls,{className:"w-4 h-4 animate-spin"}),e.jsx(Pr,{className:"h-4 w-4"}),c?"Generando sugerencias...":"Generar sugerencias con IA"]}),c&&e.jsx(lr,{className:"mt-2"})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 sm:border-l sm:border-gray-200 sm:pl-4 border-t sm:border-t-0 border-gray-200 pt-4 sm:pt-0",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between flex-shrink-0",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-700 flex items-center gap-2",children:[e.jsx(Pr,{className:"h-4 w-4 text-purple-600"}),"Sugerencias de tareas"]}),a&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{type:"button",size:"icon",variant:"ghost",onClick:()=>{navigator.clipboard.writeText(a),vt.success("Sugerencias copiadas")},children:e.jsx(Ua,{className:"w-4 h-4"})}),e.jsxs(z,{variant:"outline",size:"sm",onClick:x,disabled:c,children:[e.jsx(_o,{className:"h-3 w-3 mr-1"}),"Regenerar"]})]})]}),e.jsx("div",{className:"flex-1 flex flex-col min-h-0",children:u?e.jsx(Ne,{className:"border-red-200 bg-red-50",children:e.jsxs(De,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-700",children:[e.jsx("span",{className:"font-medium",children:"Error:"}),e.jsx("span",{className:"text-sm",children:u})]}),e.jsxs(z,{variant:"outline",size:"sm",onClick:x,className:"mt-2",children:[e.jsx(_o,{className:"h-3 w-3 mr-1"}),"Reintentar"]})]})}):a?e.jsx(kt,{readOnly:!0,value:a,className:"flex-1 resize-none bg-gray-50 border-gray-200 min-h-0 whitespace-pre-wrap"}):e.jsx("div",{className:"flex-1 flex items-center justify-center text-gray-500 text-sm",children:"Las sugerencias aparecerán aquí una vez generadas"})})]})]}),e.jsx("div",{className:"flex justify-end space-x-2 pt-4 flex-shrink-0",children:e.jsx(z,{variant:"outline",onClick:b,children:"Cerrar"})})]})})},UH=({goal:t,onAddTask:s,onToggleTask:n,onAddEntry:a,onIncrementPositive:r,onIncrementNegative:o,onAddNumericEntry:l,onEdit:c})=>{var q,re;const m=(Y,se)=>{if(Y===se)return 100;if(Y>se){const U=se===0?0:(Y-se)/Y*100;return Math.max(0,Math.min(100,100-U))}else{const U=se===0?0:Y/se*100;return Math.max(0,Math.min(100,U))}},[u,h]=f.useState(""),[p,g]=f.useState(""),[x,b]=f.useState(new Date().toISOString().split("T")[0]),[j,v]=f.useState(!1),[w,N]=f.useState(""),[S,E]=f.useState(""),[T,k]=f.useState(new Date().toISOString().split("T")[0]),[D,P]=f.useState(!1),_=t.tasks.filter(Y=>Y.done).length,B=t.tasks.length,I=B>0?_/B*100:0,R=Y=>{switch(Y){case"completed":return"default";case"active":return"secondary";case"abandoned":return"destructive";default:return"outline"}},M=Y=>{switch(Y){case"completed":return e.jsx($0,{className:"h-4 w-4"});case"active":return e.jsx(Js,{className:"h-4 w-4"});case"abandoned":return e.jsx(Uo,{className:"h-4 w-4"});default:return null}},W=Y=>{switch(Y){case"completed":return"Completado";case"active":return"Activo";case"abandoned":return"Abandonado";default:return Y}},H=()=>{u.trim()&&(s(u.trim()),h(""))},L=()=>{p.trim()&&(a(p.trim(),x,j),g(""),b(new Date().toISOString().split("T")[0]),v(!1))},$=()=>{const Y=parseFloat(w);!isNaN(Y)&&Y>=0&&(l(Y,S.trim()||void 0,T),N(""),E(""),k(new Date().toISOString().split("T")[0]))};return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(Ne,{children:e.jsx(Vt,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(Wt,{className:"text-xl",children:t.title}),t.description&&e.jsx(fi,{className:"mt-2",children:t.description})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ht,{variant:R(t.status),children:e.jsxs("div",{className:"flex items-center gap-1",children:[M(t.status),e.jsx("span",{children:W(t.status)})]})}),e.jsx(z,{variant:"outline",size:"sm",onClick:c,children:e.jsx(sa,{className:"h-4 w-4"})})]})]})})}),e.jsxs(Ne,{children:[e.jsx(Vt,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(Wt,{className:"flex items-center gap-2",children:[e.jsx(Yd,{className:"h-5 w-5"}),"Tareas"]}),e.jsxs(fi,{children:[_," de ",B," tareas completadas"]})]}),e.jsxs(z,{variant:"outline",size:"sm",onClick:()=>P(!0),className:"bg-gradient-to-r from-purple-50 to-blue-50 hover:from-purple-100 hover:to-blue-100 border-purple-200",children:[e.jsx(Pr,{className:"h-4 w-4 mr-2 text-purple-600"}),e.jsx("span",{className:"text-purple-700",children:"Ideas con IA"})]})]})}),e.jsxs(De,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Vn,{value:I,className:"h-2"}),e.jsxs("p",{className:"text-sm text-gray-600 text-center",children:[Math.round(I),"% completado"]})]}),e.jsx("div",{className:"space-y-2",children:t.tasks.length>0?t.tasks.map((Y,se)=>e.jsxs("div",{className:"flex items-center space-x-2 p-2 rounded hover:bg-gray-50",children:[e.jsx(As,{id:`task-${se}`,checked:Y.done,onCheckedChange:()=>n(se)}),e.jsx(Fe,{htmlFor:`task-${se}`,className:`flex-1 cursor-pointer ${Y.done?"line-through text-gray-500":""}`,children:Y.title}),Y.done&&e.jsx($0,{className:"h-4 w-4 text-green-500"})]},se)):e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No hay tareas aún. Agrega la primera tarea para empezar."})}),e.jsx(tc,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Fe,{htmlFor:"new-task",children:"Nueva tarea"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Be,{id:"new-task",value:u,onChange:Y=>h(Y.target.value),placeholder:"Escribe una nueva tarea...",onKeyPress:Y=>Y.key==="Enter"&&H()}),e.jsx(z,{onClick:H,disabled:!u.trim(),children:e.jsx(as,{className:"h-4 w-4"})})]})]})]})]}),((q=t.numericGoal)==null?void 0:q.enabled)&&e.jsxs(Ne,{children:[e.jsxs(Vt,{children:[e.jsxs(Wt,{className:"flex items-center gap-2",children:[e.jsx(z0,{className:"h-5 w-5"}),"Meta Numérica"]}),e.jsxs(fi,{children:["Progreso hacia ",t.numericGoal.targetValue.toLocaleString()," ",t.numericGoal.unit]})]}),e.jsxs(De,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Progreso"}),e.jsxs("span",{className:"font-medium",children:[t.numericGoal.currentValue.toLocaleString()," / ",t.numericGoal.targetValue.toLocaleString()," ",t.numericGoal.unit]})]}),e.jsx(Vn,{value:m(t.numericGoal.currentValue,t.numericGoal.targetValue),className:"h-3"}),e.jsxs("p",{className:"text-sm text-gray-600 text-center",children:[Math.round(m(t.numericGoal.currentValue,t.numericGoal.targetValue)),"% completado"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Fe,{className:"text-sm font-medium",children:"Historial de valores"}),e.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:t.numericEntries&&t.numericEntries.length>0?t.numericEntries.sort((Y,se)=>new Date(se.date).getTime()-new Date(Y.date).getTime()).map((Y,se)=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg border bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-medium",children:[Y.value.toLocaleString()," ",t.numericGoal.unit]}),Y.note&&e.jsxs("span",{className:"text-xs text-gray-500",children:["- ",Y.note]})]}),e.jsx("span",{className:"text-xs text-gray-500",children:new Date(Y.date).toLocaleDateString()})]},se)):e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No hay registros numéricos aún"})})]}),e.jsx(tc,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Fe,{htmlFor:"numeric-value",children:"Actualizar valor"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(Be,{id:"numeric-value",type:"number",min:"0",step:"0.01",value:w,onChange:Y=>N(Y.target.value),placeholder:`Valor en ${t.numericGoal.unit}`}),e.jsx(Be,{type:"date",value:T,onChange:Y=>k(Y.target.value)})]}),e.jsx(Be,{value:S,onChange:Y=>E(Y.target.value),placeholder:"Nota opcional..."}),e.jsxs(z,{onClick:$,disabled:!w||isNaN(parseFloat(w)),className:"w-full",children:[e.jsx(as,{className:"h-4 w-4 mr-2"}),"Registrar valor"]})]})]})]}),e.jsxs(Ne,{children:[e.jsxs(Vt,{children:[e.jsxs(Wt,{className:"flex items-center gap-2",children:[e.jsx(Ro,{className:"h-5 w-5"}),"Historial de Avances"]}),e.jsx(fi,{children:"Registra tu progreso y logros importantes"})]}),e.jsxs(De,{className:"space-y-4",children:[e.jsx("div",{className:"space-y-3",children:t.entries.length>0?t.entries.sort((Y,se)=>new Date(se.date).getTime()-new Date(Y.date).getTime()).map((Y,se)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg border bg-gray-50",children:[e.jsx("div",{className:"flex-shrink-0",children:Y.isMilestone?e.jsx(Eb,{className:"h-4 w-4 text-yellow-500 mt-1"}):e.jsx(ns,{className:"h-4 w-4 text-gray-400 mt-1"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm",children:Y.text}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:new Date(Y.date).toLocaleDateString()})]}),Y.isMilestone&&e.jsx(Ht,{variant:"secondary",className:"text-xs",children:"Hito"})]},se)):e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No hay avances registrados. Comparte tu progreso aquí."})}),e.jsx(tc,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Fe,{htmlFor:"new-entry",children:"Nuevo avance"}),e.jsx(kt,{id:"new-entry",value:p,onChange:Y=>g(Y.target.value),placeholder:"Describe tu progreso...",className:"min-h-[60px]"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{htmlFor:"entry-date",className:"text-sm",children:"Fecha:"}),e.jsx(Be,{id:"entry-date",type:"date",value:x,onChange:Y=>b(Y.target.value),className:"w-auto"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(As,{id:"milestone",checked:j,onCheckedChange:Y=>v(Y)}),e.jsx(Fe,{htmlFor:"milestone",className:"text-sm",children:"Marcar como hito"})]})]}),e.jsxs(z,{onClick:L,disabled:!p.trim(),children:[e.jsx(as,{className:"h-4 w-4 mr-2"}),"Registrar avance"]})]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(Ne,{children:[e.jsx(Vt,{children:e.jsx(Wt,{className:"text-lg",children:"Estadísticas"})}),e.jsxs(De,{className:"space-y-4",children:[(t.startDate||t.dueDate)&&e.jsxs("div",{className:"space-y-2",children:[t.startDate&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ns,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:"Inicio:"}),e.jsx("span",{children:new Date(t.startDate).toLocaleDateString()})]}),t.dueDate&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ns,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:"Límite:"}),e.jsx("span",{children:new Date(t.dueDate).toLocaleDateString()})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Yd,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:"Tareas:"}),e.jsxs("span",{children:[_,"/",B]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Ro,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:"Avances:"}),e.jsx("span",{children:t.entries.length})]}),((re=t.numericGoal)==null?void 0:re.enabled)&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(z0,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:"Progreso:"}),e.jsxs("span",{children:[Math.round(m(t.numericGoal.currentValue,t.numericGoal.targetValue)),"%"]})]})]})]})]}),e.jsxs(Ne,{children:[e.jsxs(Vt,{children:[e.jsx(Wt,{className:"text-lg",children:"Motivación"}),e.jsx(fi,{children:"Registra tu estado de ánimo hacia este objetivo"})]}),e.jsx(De,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(z,{variant:"outline",className:"flex-1",onClick:r,children:[e.jsx(qh,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:t.positiveCount||0})]}),e.jsxs(z,{variant:"outline",className:"flex-1",onClick:o,children:[e.jsx(qd,{className:"h-4 w-4 mr-2"}),e.jsx("span",{children:t.negativeCount||0})]})]})})]})]}),e.jsx(WH,{goal:t,isOpen:D,onClose:()=>P(!1)})]})},$y=({goal:t,isOpen:s,onClose:n,onSave:a})=>{var w,N,S,E,T;const[r,o]=f.useState({title:(t==null?void 0:t.title)||"",description:(t==null?void 0:t.description)||"",status:(t==null?void 0:t.status)||"active",startDate:(t==null?void 0:t.startDate)||"",dueDate:(t==null?void 0:t.dueDate)||""}),[l,c]=f.useState({enabled:((w=t==null?void 0:t.numericGoal)==null?void 0:w.enabled)||!1,targetValue:((N=t==null?void 0:t.numericGoal)==null?void 0:N.targetValue)||0,currentValue:((S=t==null?void 0:t.numericGoal)==null?void 0:S.currentValue)||0,unit:((E=t==null?void 0:t.numericGoal)==null?void 0:E.unit)||"",unitType:((T=t==null?void 0:t.numericGoal)==null?void 0:T.unitType)||"quantity"}),[m,u]=f.useState(!1),[h,p]=f.useState({});f.useEffect(()=>{var k,D,P,_,B;o({title:(t==null?void 0:t.title)||"",description:(t==null?void 0:t.description)||"",status:(t==null?void 0:t.status)||"active",startDate:(t==null?void 0:t.startDate)||"",dueDate:(t==null?void 0:t.dueDate)||""}),c({enabled:((k=t==null?void 0:t.numericGoal)==null?void 0:k.enabled)||!1,targetValue:((D=t==null?void 0:t.numericGoal)==null?void 0:D.targetValue)||0,currentValue:((P=t==null?void 0:t.numericGoal)==null?void 0:P.currentValue)||0,unit:((_=t==null?void 0:t.numericGoal)==null?void 0:_.unit)||"",unitType:((B=t==null?void 0:t.numericGoal)==null?void 0:B.unitType)||"quantity"}),p({})},[t]);const g=()=>{const k={};if(r.title.trim()||(k.title="El título es requerido"),r.startDate&&r.dueDate){const D=new Date(r.startDate),P=new Date(r.dueDate);D>P&&(k.dueDate="La fecha límite debe ser posterior a la fecha de inicio")}return l.enabled&&(l.targetValue<=0&&(k.targetValue="El valor objetivo debe ser mayor a 0"),l.unit.trim()||(k.unit="La unidad es requerida para metas numéricas"),l.currentValue<0&&(k.currentValue="El valor actual no puede ser negativo")),p(k),Object.keys(k).length===0},x=async k=>{if(k.preventDefault(),!!g()){u(!0);try{await a({...r,description:r.description.trim()||void 0,startDate:r.startDate||null,dueDate:r.dueDate||null,numericGoal:l.enabled?l:void 0,numericEntries:(t==null?void 0:t.numericEntries)||[]}),n()}catch(D){console.error("Error saving goal:",D)}finally{u(!1)}}},b=()=>{const k=r.title.trim().length>0,D=!l.enabled||l.targetValue>0&&l.unit.trim().length>0;return k&&D&&Object.keys(h).length===0},j=()=>{var k,D,P,_,B;o({title:(t==null?void 0:t.title)||"",description:(t==null?void 0:t.description)||"",status:(t==null?void 0:t.status)||"active",startDate:(t==null?void 0:t.startDate)||"",dueDate:(t==null?void 0:t.dueDate)||""}),c({enabled:((k=t==null?void 0:t.numericGoal)==null?void 0:k.enabled)||!1,targetValue:((D=t==null?void 0:t.numericGoal)==null?void 0:D.targetValue)||0,currentValue:((P=t==null?void 0:t.numericGoal)==null?void 0:P.currentValue)||0,unit:((_=t==null?void 0:t.numericGoal)==null?void 0:_.unit)||"",unitType:((B=t==null?void 0:t.numericGoal)==null?void 0:B.unitType)||"quantity"}),p({}),n()},v=k=>{switch(k){case"currency":return"Ej: COP, USD, EUR";case"weight":return"Ej: kg, lb, g";case"quantity":return"Ej: unidades, piezas";case"percentage":return"%";case"custom":return"Ej: horas, días";default:return"Unidad"}};return e.jsx(Rt,{open:s,onOpenChange:j,children:e.jsxs(Ct,{className:"sm:max-w-[900px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(_t,{children:[e.jsxs(Pt,{className:"flex items-center gap-2",children:[e.jsx(Uo,{className:"h-5 w-5"}),t?"Editar objetivo":"Crear nuevo objetivo"]}),e.jsx(rn,{children:t?"Modifica los detalles de tu objetivo":"Define un nuevo objetivo para alcanzar tus metas"})]}),e.jsxs("form",{onSubmit:x,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Fe,{htmlFor:"title",children:"Título *"}),e.jsx(Be,{id:"title",value:r.title,onChange:k=>{o({...r,title:k.target.value}),h.title&&k.target.value.trim()&&p({...h,title:""})},placeholder:"Ej. Aprender React avanzado",className:h.title?"border-destructive":"",required:!0}),h.title&&e.jsx("p",{className:"text-sm text-destructive",children:h.title})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Fe,{htmlFor:"description",children:"Descripción"}),e.jsx(kt,{id:"description",value:r.description,onChange:k=>o({...r,description:k.target.value}),placeholder:"Describe tu objetivo con más detalle...",className:"min-h-[80px]"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Fe,{htmlFor:"status",children:"Estado"}),e.jsxs(Nt,{value:r.status,onValueChange:k=>o({...r,status:k}),children:[e.jsx(xt,{children:e.jsx(St,{})}),e.jsxs(gt,{children:[e.jsx(Pe,{value:"active",children:"Activo"}),e.jsx(Pe,{value:"completed",children:"Completado"}),e.jsx(Pe,{value:"abandoned",children:"Abandonado"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Fe,{htmlFor:"startDate",children:"Fecha de inicio"}),e.jsx(Be,{id:"startDate",type:"date",value:r.startDate,onChange:k=>o({...r,startDate:k.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Fe,{htmlFor:"dueDate",children:"Fecha límite"}),e.jsx(Be,{id:"dueDate",type:"date",value:r.dueDate,onChange:k=>o({...r,dueDate:k.target.value}),className:h.dueDate?"border-destructive":""}),h.dueDate&&e.jsx("p",{className:"text-sm text-destructive",children:h.dueDate})]})]}),e.jsx(tc,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(As,{id:"numericGoal",checked:l.enabled,onCheckedChange:k=>c({...l,enabled:k})}),e.jsxs(Fe,{htmlFor:"numericGoal",className:"flex items-center gap-2",children:[e.jsx(Ro,{className:"h-4 w-4"}),"Agregar meta numérica"]})]}),l.enabled&&e.jsxs("div",{className:"space-y-4 p-4 border rounded-lg bg-gray-50",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Fe,{htmlFor:"targetValue",children:"Valor objetivo *"}),e.jsx(Be,{id:"targetValue",type:"number",min:"0",step:"0.01",value:l.targetValue,onChange:k=>{const D=parseFloat(k.target.value)||0;c({...l,targetValue:D}),h.targetValue&&D>0&&p({...h,targetValue:""})},placeholder:"Ej: 2000000",className:h.targetValue?"border-destructive":"",required:l.enabled}),h.targetValue&&e.jsx("p",{className:"text-sm text-destructive",children:h.targetValue})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Fe,{htmlFor:"currentValue",children:"Valor actual"}),e.jsx(Be,{id:"currentValue",type:"number",min:"0",step:"0.01",value:l.currentValue,onChange:k=>c({...l,currentValue:parseFloat(k.target.value)||0}),placeholder:"Ej: 500000",className:h.currentValue?"border-destructive":""}),h.currentValue&&e.jsx("p",{className:"text-sm text-destructive",children:h.currentValue})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Fe,{htmlFor:"unitType",children:"Tipo de unidad"}),e.jsxs(Nt,{value:l.unitType,onValueChange:k=>c({...l,unitType:k,unit:""}),children:[e.jsx(xt,{children:e.jsx(St,{})}),e.jsxs(gt,{children:[e.jsx(Pe,{value:"currency",children:"Moneda"}),e.jsx(Pe,{value:"weight",children:"Peso"}),e.jsx(Pe,{value:"quantity",children:"Cantidad"}),e.jsx(Pe,{value:"percentage",children:"Porcentaje"}),e.jsx(Pe,{value:"custom",children:"Personalizada"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Fe,{htmlFor:"unit",children:"Unidad *"}),e.jsx(Be,{id:"unit",value:l.unit,onChange:k=>{c({...l,unit:k.target.value}),h.unit&&k.target.value.trim()&&p({...h,unit:""})},placeholder:v(l.unitType),className:h.unit?"border-destructive":"",required:l.enabled}),h.unit&&e.jsx("p",{className:"text-sm text-destructive",children:h.unit})]})]}),e.jsxs("div",{className:"text-sm text-gray-600 bg-white p-3 rounded-md",children:[e.jsx("p",{className:"font-medium mb-1",children:"Ejemplos:"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-1 text-xs",children:[e.jsx("span",{children:"• Comprar colchón: 2,000,000 COP"}),e.jsx("span",{children:"• Bajar peso: 3 kg"}),e.jsx("span",{children:"• Ahorrar dinero: 500,000 COP"}),e.jsx("span",{children:"• Completar curso: 100 %"})]})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(z,{type:"button",variant:"outline",onClick:j,disabled:m,children:"Cancelar"}),e.jsx(z,{type:"submit",disabled:m||!b(),children:m?"Guardando...":t?"Actualizar":"Crear"})]})]})]})})},VH=()=>{const{goalId:t}=Jf(),s=Xt(),{goals:n,status:a,error:r,addGoal:o,updateGoal:l,addTask:c,toggleTask:m,addEntry:u,incrementPositiveCount:h,incrementNegativeCount:p,addNumericEntry:g}=$H(),[x,b]=f.useState(t||null),[j,v]=f.useState(!1),[w,N]=f.useState(void 0),[S,E]=f.useState(""),[T,k]=f.useState("all"),D=n.find(H=>H.id===x)||null;f.useEffect(()=>{t&&t!==x&&b(t)},[t,x]),f.useEffect(()=>{t&&n.length>0&&!n.find(H=>H.id===t)&&s("/goals")},[t,n,s]);const P=n.filter(H=>{var q;const L=H.title.toLowerCase().includes(S.toLowerCase())||((q=H.description)==null?void 0:q.toLowerCase().includes(S.toLowerCase())),$=T==="all"||H.status===T;return L&&$}),_=async H=>{await o({title:H.title||"",description:H.description,status:H.status||"active",startDate:H.startDate,dueDate:H.dueDate,tasks:[],entries:[]})},B=async H=>{w&&await l(w.id,H)},I=H=>{N(H),v(!0)},R=()=>{v(!1),N(void 0)},M=()=>{b(null),s("/goals")},W=H=>{b(H),s(`/goals/${H}`)};return D?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs(z,{variant:"outline",size:"sm",onClick:M,className:"flex items-center gap-2",children:[e.jsx(Po,{className:"h-4 w-4"}),"Volver a objetivos"]})}),e.jsx(UH,{goal:D,onAddTask:H=>c(D.id,H),onToggleTask:H=>m(D.id,H),onAddEntry:(H,L,$)=>u(D.id,{text:H,date:L,isMilestone:$}),onIncrementPositive:()=>h(D.id),onIncrementNegative:()=>p(D.id),onAddNumericEntry:(H,L,$)=>g(D.id,{value:H,note:L,date:$}),onEdit:()=>I(D)}),e.jsx($y,{goal:w,isOpen:j,onClose:R,onSave:w?B:_})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-6",children:[e.jsx(Ne,{children:e.jsx(Vt,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsxs(Wt,{className:"flex items-center gap-2",children:[e.jsx(Uo,{className:"h-5 w-5"}),"Objetivos"]})}),e.jsxs(z,{onClick:()=>v(!0),children:[e.jsx(as,{className:"h-4 w-4 mr-2"}),"Nuevo objetivo"]})]})})}),e.jsx(Ne,{children:e.jsx(De,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Vo,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(Be,{placeholder:"Buscar objetivos...",value:S,onChange:H=>E(H.target.value),className:"pl-9"})]})}),e.jsxs("div",{className:"flex items-center gap-2 sm:w-48",children:[e.jsx(Cu,{className:"h-4 w-4 text-gray-400"}),e.jsxs(Nt,{value:T,onValueChange:k,children:[e.jsx(xt,{children:e.jsx(St,{})}),e.jsxs(gt,{children:[e.jsx(Pe,{value:"all",children:"Todos"}),e.jsx(Pe,{value:"active",children:"Activos"}),e.jsx(Pe,{value:"completed",children:"Completados"}),e.jsx(Pe,{value:"abandoned",children:"Abandonados"})]})]})]})]})})}),e.jsxs("div",{children:[a==="loading"&&e.jsx(Ne,{className:"p-6 text-center",children:e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Cargando objetivos..."})]})}),r&&e.jsx(Ne,{className:"p-6 text-center",children:e.jsxs("div",{className:"text-red-600",children:[e.jsx("p",{className:"font-medium",children:"Error al cargar objetivos"}),e.jsx("p",{className:"text-sm mt-1",children:r})]})}),a!=="loading"&&!r&&e.jsx(zH,{goals:P,onSelect:W,onIncrementPositive:h,onIncrementNegative:p,onEdit:I})]}),S||T!=="all"?e.jsx(Ne,{children:e.jsx(De,{className:"p-4",children:e.jsx("p",{className:"text-sm text-gray-600",children:P.length===0?"No se encontraron objetivos que coincidan con los filtros":`Mostrando ${P.length} de ${n.length} objetivos`})})}):null]}),e.jsx($y,{goal:w,isOpen:j,onClose:R,onSave:w?B:_})]})},zy=()=>e.jsx(Xs,{children:e.jsx(VH,{})});function GH(){return e.jsxs(T_,{children:[e.jsxs(is,{path:"/",element:e.jsx(vI,{}),children:[e.jsx(is,{index:!0,element:e.jsx(e4,{})}),e.jsx(is,{path:"habit",element:e.jsx(CF,{})}),e.jsx(is,{path:"task",element:e.jsx(mh,{to:"/task/list",replace:!0})}),e.jsx(is,{path:"task/list",element:e.jsx(uy,{})}),e.jsx(is,{path:"task/kanban",element:e.jsx(uy,{})}),e.jsx(is,{path:"task/calendar",element:e.jsx(hF,{})}),e.jsx(is,{path:"tasks/calendar",element:e.jsx(mh,{to:"/task/calendar",replace:!0})}),e.jsx(is,{path:"kanban",element:e.jsx(mh,{to:"/task/kanban",replace:!0})}),e.jsx(is,{path:"journal",element:e.jsx(mF,{})}),e.jsx(is,{path:"mood",element:e.jsx(YL,{})}),e.jsx(is,{path:"water",element:e.jsx(q3,{})}),e.jsx(is,{path:"pomodoro",element:e.jsx(CL,{})}),e.jsx(is,{path:"exercise",element:e.jsx(SB,{})}),e.jsx(is,{path:"negative",element:e.jsx(WB,{})}),e.jsx(is,{path:"stats",element:e.jsx(KB,{})}),e.jsx(is,{path:"meal",element:e.jsx(YF,{})}),e.jsx(is,{path:"shopping-list",element:e.jsx(uB,{})}),e.jsx(is,{path:"recipes",element:e.jsx(pB,{})}),e.jsx(is,{path:"prepared-meals",element:e.jsx(vB,{})}),e.jsx(is,{path:"settings",element:e.jsx(SH,{})}),e.jsx(is,{path:"goals",element:e.jsx(zy,{})}),e.jsx(is,{path:"goals/:goalId",element:e.jsx(zy,{})})]}),e.jsx(is,{path:"task/:taskCode/run",element:e.jsx(AH,{})}),e.jsx(is,{path:"habit/:habitId/run",element:e.jsx(PH,{})}),e.jsx(is,{path:"shopping/run",element:e.jsx(LH,{})})]})}class Co{static startDiagnostic(){var s,n,a,r,o,l;typeof window>"u"||(console.log("🔍 Iniciando diagnóstico de escrituras Firestore..."),(n=(s=window.firebase)==null?void 0:s.firestore)!=null&&n.setDoc&&!this.originalSetDoc&&(this.originalSetDoc=window.firebase.firestore.setDoc,window.firebase.firestore.setDoc=this.wrapWriteFunction("setDoc",this.originalSetDoc)),(r=(a=window.firebase)==null?void 0:a.firestore)!=null&&r.updateDoc&&!this.originalUpdateDoc&&(this.originalUpdateDoc=window.firebase.firestore.updateDoc,window.firebase.firestore.updateDoc=this.wrapWriteFunction("updateDoc",this.originalUpdateDoc)),(l=(o=window.firebase)==null?void 0:o.firestore)!=null&&l.addDoc&&!this.originalAddDoc&&(this.originalAddDoc=window.firebase.firestore.addDoc,window.firebase.firestore.addDoc=this.wrapWriteFunction("addDoc",this.originalAddDoc)),setInterval(()=>{this.reportCurrentStats()},3e4),console.log("✅ Diagnóstico iniciado. Usa FirestoreWriteDiagnostic.getReport() para ver estadísticas."))}static wrapWriteFunction(s,n){return(...a)=>{var u;this.writeCount++;const r=a[0],o=((u=r==null?void 0:r.path)==null?void 0:u.split("/")[0])||"unknown",l=r==null?void 0:r.id,c=new Error().stack||"";this.writeLog.push({timestamp:new Date,collection:o,docId:l,operation:s,stack:this.extractRelevantStack(c)}),this.writeLog.length>100&&(this.writeLog=this.writeLog.slice(-100));const m=this.writeLog.filter(h=>h.timestamp>new Date(Date.now()-6e4));return m.length>20&&(console.warn(`🚨 ALERTA: ${m.length} escrituras en el último minuto!`),this.analyzeRecentWrites(m)),n.apply(this,a)}}static extractRelevantStack(s){return s.split(`
`).find(r=>!r.includes("wrapWriteFunction")&&!r.includes("firebase")&&r.includes("at "))||"unknown"}static analyzeRecentWrites(s){const n=this.groupBy(s,"collection");console.warn("📊 Escrituras por colección (último minuto):"),Object.entries(n).forEach(([o,l])=>{console.warn(`  ${o}: ${l.length} escrituras`)});const a=this.groupBy(s,"stack");console.warn("📍 Fuentes más activas:"),Object.entries(a).sort(([,o],[,l])=>l.length-o.length).slice(0,5).forEach(([o,l])=>{console.warn(`  ${l.length}x: ${o.substring(0,100)}...`)});const r=new Map;s.forEach(o=>{const l=`${o.collection}/${o.docId}`;r.has(l)||r.set(l,[]),r.get(l).push(o)}),r.forEach((o,l)=>{o.length>5&&console.warn(`🔥 ${o.length} escrituras al documento ${l}`)})}static groupBy(s,n){return s.reduce((a,r)=>{const o=String(r[n]);return a[o]=a[o]||[],a[o].push(r),a},{})}static reportCurrentStats(){const s=new Date,n=this.writeLog.filter(r=>r.timestamp>new Date(s.getTime()-5*60*1e3)),a=this.writeLog.filter(r=>r.timestamp>new Date(s.getTime()-60*1e3));n.length>0&&(console.log("📈 Estadísticas de escrituras:"),console.log(`  Últimos 5 min: ${n.length} escrituras (${(n.length/5).toFixed(1)}/min)`),console.log(`  Último minuto: ${a.length} escrituras`),console.log(`  Total desde inicio: ${this.writeCount} escrituras`))}static getReport(){const s=new Date,n=this.writeLog.filter(o=>o.timestamp>new Date(s.getTime()-5*60*1e3)),a=this.writeLog.filter(o=>o.timestamp>new Date(s.getTime()-60*1e3)),r={totalWrites:this.writeCount,last5Minutes:n.length,lastMinute:a.length,ratePerMinute:n.length/5,byCollection:this.groupBy(n,"collection"),byOperation:this.groupBy(n,"operation"),topSources:Object.entries(this.groupBy(n,"stack")).sort(([,o],[,l])=>l.length-o.length).slice(0,10).map(([o,l])=>({source:o.substring(0,100),count:l.length}))};return console.group("📊 Reporte de Escrituras Firestore"),console.log("Total de escrituras desde inicio:",r.totalWrites),console.log("Últimos 5 minutos:",r.last5Minutes),console.log("Último minuto:",r.lastMinute),console.log("Tasa actual:",r.ratePerMinute.toFixed(1),"escrituras/minuto"),r.ratePerMinute>10&&console.warn("🚨 Tasa de escrituras muy alta (>10/min)"),console.log("Por colección:",r.byCollection),console.log("Por operación:",r.byOperation),console.log("Fuentes más activas:",r.topSources),console.groupEnd(),r}static stopDiagnostic(){var s,n,a;this.originalSetDoc&&((s=window.firebase)!=null&&s.firestore)&&(window.firebase.firestore.setDoc=this.originalSetDoc),this.originalUpdateDoc&&((n=window.firebase)!=null&&n.firestore)&&(window.firebase.firestore.updateDoc=this.originalUpdateDoc),this.originalAddDoc&&((a=window.firebase)!=null&&a.firestore)&&(window.firebase.firestore.addDoc=this.originalAddDoc),console.log("🛑 Diagnóstico de escrituras detenido")}static clearLog(){this.writeLog=[],this.writeCount=0,console.log("🧹 Log de escrituras limpiado")}}ht(Co,"originalSetDoc"),ht(Co,"originalUpdateDoc"),ht(Co,"originalAddDoc"),ht(Co,"writeCount",0),ht(Co,"writeLog",[]);typeof window<"u"&&(window.FirestoreWriteDiagnostic=Co);"serviceWorker"in navigator&&H_({onNeedRefresh(){window.dispatchEvent(new CustomEvent("sw-update-available"))},onOfflineReady(){console.log("La aplicación está lista para usar sin conexión"),window.dispatchEvent(new CustomEvent("sw-offline-ready"))},onRegisterError(t){console.warn("Error al registrar el service worker:",t)},immediate:!0});Yh.createRoot(document.getElementById("root")).render(e.jsx(Z.StrictMode,{children:e.jsx(I_,{basename:"/life-tracker",children:e.jsx(wH,{children:e.jsx(GH,{})})})}));export{z as B,Ne as C,Wn as D,Vn as P,Vt as a,Wt as b,De as c,UB as d,ce as e,va as g,Ec as u};
